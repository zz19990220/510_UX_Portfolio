var qU=Object.defineProperty;var ZU=(r,e,t)=>e in r?qU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var V=(r,e,t)=>ZU(r,typeof e!="symbol"?e+"":e,t);import{r as Bt,at as yr,aT as dt,g as sh,aU as Su,_ as HO,j as Ss,C as Jc,aV as kv,F as hB,aW as Nv,aX as QU,aY as dB,aZ as e5,aE as t5,a_ as r5,n as jO,B as $O,aD as WO,U as r2,a$ as AB,aA as n5,z as i5,b0 as s5,b1 as pB}from"./index.C1z8KpLA.js";import{_ as ls,a as o5,C as a5}from"./toConsumableArray.CgkEPBwD.js";import{a as Xu,b as Ku,_ as ew,c as AA,d as tw}from"./possibleConstructorReturn.nNhsvgRd.js";import{a as c5,T as l5}from"./Toolbar.D9RUZv9G.js";import{E as JO,w as u5}from"./withFullScreenWrapper.Ov13692o.js";import{u as f5}from"./useBasicWidgetState.zXY9CjFS.js";import{u as h5,s as d5}from"./threshold.DjX0wlsa.js";import{a as A5}from"./index.t--hEgTQ.js";import"./FormClearHelper.B67tgll0.js";import"./value.CgPGBV_l.js";function p5(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}const bu={};function jm(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const rw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),gB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);gB&&parseFloat(gB[1]);const Fu=globalThis,Ta=globalThis.process||{},g5=globalThis.navigator||{};function XO(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function il(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||XO()}function m5(r){return il()?XO()?"Electron":(g5.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const sy="4.1.0";function _5(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let y5=class{constructor(e,t,n="sessionStorage"){this.storage=_5(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function v5(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function b5(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var $m;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})($m||($m={}));const x5=10;function mB(r){return typeof r!="string"?r:(r=r.toUpperCase(),$m[r]||$m.WHITE)}function w5(r,e,t){return!il&&typeof r=="string"&&(e&&(r=`\x1B[${mB(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${mB(t)+x5}m${r}\x1B[49m`)),r}function C5(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(c=>o===c)||(i[o]=s.bind(r)))}}function nw(r,e){if(!r)throw new Error("Assertion failed")}function sd(){var e,t,n;let r;if(il()&&Fu.performance)r=(t=(e=Fu==null?void 0:Fu.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Ta){const i=(n=Ta==null?void 0:Ta.hrtime)==null?void 0:n.call(Ta);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const od={debug:il()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},E5={enabled:!0,level:0};function ad(){}const _B={},yB={once:!0};let KO=class{constructor({id:e}={id:""}){this.VERSION=sy,this._startTs=sd(),this._deltaTs=sd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new y5(`__probe-${this.id}__`,E5),this.timeStamp(`${this.id} started`),C5(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((sd()-this._startTs).toPrecision(10))}getDelta(){return Number((sd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,od.warn,arguments,yB)}error(e){return this._getLogFunction(0,e,od.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,od.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,od.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,od.debug||od.info,arguments,yB)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||ad,n&&[n],{tag:B5(t)}):ad}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ad)}group(e,t,n={collapsed:!1}){const i=vB({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ad)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=YO(e)}_getLogFunction(e,t,n,i,o){if(this._shouldLog(e)){o=vB({logLevel:e,message:t,args:i,opts:o}),n=n||o.method,nw(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=sd();const s=o.tag||o.message;if(o.once&&s)if(!_B[s])_B[s]=sd();else return ad;return t=T5(this.id,o.message,o),n.bind(console,t,...o.args)}return ad}};KO.VERSION=sy;function YO(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return nw(Number.isFinite(e)&&e>=0),e}function vB(r){const{logLevel:e,message:t}=r;r.logLevel=YO(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return nw(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function T5(r,e,t){if(typeof e=="string"){const n=t.time?b5(v5(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=w5(e,t.color,t.background)}return e}function B5(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}function S5(r,e){return qO(r||{},e)}function qO(r,e,t=0){if(t>3)return e;const n={...r};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=qO(n[i]||{},e[i],t+1):n[i]=e[i];return n}const I5="latest";function M5(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const P5=M5();function zu(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const Wf=typeof process!="object"||String(process)!=="[object process]"||process.browser,R5=typeof window<"u"&&typeof window.orientation<"u",bB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);bB&&parseFloat(bB[1]);let F5=class{constructor(e,t){V(this,"name");V(this,"workerThread");V(this,"isRunning",!0);V(this,"result");V(this,"_resolve",()=>{});V(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){zu(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){zu(this.isRunning),this.isRunning=!1,this._reject(e)}},Uv=class{terminate(){}};const zv=new Map;function O5(r){zu(r.source&&!r.url||!r.source&&r.url);let e=zv.get(r.source||r.url);return e||(r.url&&(e=D5(r.url),zv.set(r.url,e)),r.source&&(e=ZO(r.source),zv.set(r.source,e))),zu(e),e}function D5(r){if(!r.startsWith("http"))return r;const e=L5(r);return ZO(e)}function ZO(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function L5(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function QO(r,e=!0,t){const n=t||new Set;if(r){if(xB(r))n.add(r);else if(xB(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)QO(r[i],e,n)}}return t===void 0?Array.from(n):[]}function xB(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const Gv=()=>{};let n2=class{constructor(e){V(this,"name");V(this,"source");V(this,"url");V(this,"terminated",!1);V(this,"worker");V(this,"onMessage");V(this,"onError");V(this,"_loadableURL","");const{name:t,source:n,url:i}=e;zu(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Gv,this.onError=o=>console.log(o),this.worker=Wf?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Wf||typeof Uv<"u"&&!Wf}destroy(){this.onMessage=Gv,this.onError=Gv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||QO(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=O5({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Uv(n,{eval:!1})}else if(this.source)e=new Uv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}},k5=class{constructor(e){V(this,"name","unnamed");V(this,"source");V(this,"url");V(this,"maxConcurrency",1);V(this,"maxMobileConcurrency",1);V(this,"onDebug",()=>{});V(this,"reuseWorkers",!0);V(this,"props",{});V(this,"jobQueue",[]);V(this,"idleQueue",[]);V(this,"count",0);V(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return n2.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new F5(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Wf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new n2({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return R5?this.maxMobileConcurrency:this.maxConcurrency}};const N5={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};var ac;let eD=(ac=class{constructor(e){V(this,"props");V(this,"workerPools",new Map);this.props={...N5},this.setProps(e),this.workerPools=new Map}static isSupported(){return n2.isSupported()}static getWorkerFarm(e={}){return ac._workerFarm=ac._workerFarm||new ac({}),ac._workerFarm.setProps(e),ac._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let o=this.workerPools.get(t);return o||(o=new k5({name:t,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}},V(ac,"_workerFarm"),ac);function U5(r,e={}){const t=e[r.id]||{},n=Wf?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Wf?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let o=r.version;o==="latest"&&(o=I5);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${s}/dist/${n}`}return zu(i),i}function z5(r,e=P5){zu(r,"no worker provided");const t=r.version;return!(!e||!t)}function G5(r,e){return!eD.isSupported()||!Wf&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function V5(r,e,t,n,i){const o=r.id,s=U5(r,t),f=eD.getWorkerFarm(t).getWorkerPool({name:o,url:s});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const _=await f.startJob("process-on-worker",H5.bind(null,i));return _.postMessage("process",{input:e,options:t,context:n}),await(await _.result).result}async function H5(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const c=await r(o,s);e.postMessage("done",{id:i,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:i,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function j5(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function $5(...r){return W5(r)}function W5(r){const e=r.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function J5(r){const e=[];for await(const t of r)e.push(t);return $5(...e)}let X5="";const wB={};function K5(r){for(const e in wB)if(r.startsWith(e)){const t=wB[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${X5}${r}`),r}function Y5(r){return r&&typeof r=="object"&&r.isBuffer}function tD(r){if(Y5(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function rD(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function q5(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const Z5=r=>typeof r=="boolean",zp=r=>typeof r=="function",xg=r=>r!==null&&typeof r=="object",CB=r=>xg(r)&&r.constructor==={}.constructor,Q5=r=>!!r&&typeof r[Symbol.iterator]=="function",ez=r=>r&&typeof r[Symbol.asyncIterator]=="function",oh=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,ah=r=>typeof Blob<"u"&&r instanceof Blob,tz=r=>r&&typeof r=="object"&&r.isBuffer,rz=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||xg(r)&&zp(r.tee)&&zp(r.cancel)&&zp(r.getReader),nz=r=>xg(r)&&zp(r.read)&&zp(r.pipe)&&Z5(r.readable),nD=r=>rz(r)||nz(r);let iz=class extends Error{constructor(t,n){super(t);V(this,"reason");V(this,"url");V(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}};const sz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,oz=/^([-\w.]+\/[-\w.+]+)/;function EB(r,e){return r.toLowerCase()===e.toLowerCase()}function az(r){const e=oz.exec(r);return e?e[1]:r}function TB(r){const e=sz.exec(r);return e?e[1]:""}const iD=/\?.*/;function cz(r){const e=r.match(iD);return e&&e[0]}function iw(r){return r.replace(iD,"")}function lz(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function oy(r){return oh(r)?r.url:ah(r)?r.name||"":typeof r=="string"?r:""}function sw(r){if(oh(r)){const e=r,t=e.headers.get("content-type")||"",n=iw(e.url);return az(t)||TB(n)}return ah(r)?r.type||"":typeof r=="string"?TB(r):""}function uz(r){return oh(r)?r.headers["content-length"]||-1:ah(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function sD(r){if(oh(r))return r;const e={},t=uz(r);t>=0&&(e["content-length"]=String(t));const n=oy(r),i=sw(r);i&&(e["content-type"]=i);const o=await dz(r);o&&(e["x-first-bytes"]=o),typeof r=="string"&&(r=new TextEncoder().encode(r));const s=new Response(r,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function fz(r){if(!r.ok)throw await hz(r)}async function hz(r){const e=lz(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=i!=null&&i.includes("application/json")?await r.json():r.text()}catch{}return new iz(t,n)}async function dz(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=o=>{var s;return n((s=o==null?void 0:o.target)==null?void 0:s.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${Az(t)}`}return null}function Az(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function pz(r){return!gz(r)&&!mz(r)}function gz(r){return r.startsWith("http:")||r.startsWith("https:")}function mz(r){return r.startsWith("data:")}async function BB(r,e){var t,n;if(typeof r=="string"){const i=K5(r);return pz(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await sD(r)}const x0=globalThis,cd=globalThis.process||{};function _z(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function ow(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||_z()}const oD="4.0.7";function yz(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let vz=class{constructor(e,t,n="sessionStorage"){this.storage=yz(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function bz(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function xz(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Wm;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Wm||(Wm={}));const wz=10;function SB(r){return typeof r!="string"?r:(r=r.toUpperCase(),Wm[r]||Wm.WHITE)}function Cz(r,e,t){return!ow&&typeof r=="string"&&(e&&(r=`\x1B[${SB(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${SB(t)+wz}m${r}\x1B[49m`)),r}function Ez(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(c=>o===c)||(i[o]=s.bind(r)))}}function aw(r,e){if(!r)throw new Error("Assertion failed")}function ld(){var e,t,n;let r;if(ow()&&x0.performance)r=(t=(e=x0==null?void 0:x0.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in cd){const i=(n=cd==null?void 0:cd.hrtime)==null?void 0:n.call(cd);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const ud={debug:ow()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Tz={enabled:!0,level:0};function fd(){}const IB={},MB={once:!0};let cw=class{constructor({id:e}={id:""}){this.VERSION=oD,this._startTs=ld(),this._deltaTs=ld(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new vz(`__probe-${this.id}__`,Tz),this.timeStamp(`${this.id} started`),Ez(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ld()-this._startTs).toPrecision(10))}getDelta(){return Number((ld()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ud.warn,arguments,MB)}error(e){return this._getLogFunction(0,e,ud.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,ud.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ud.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ud.debug||ud.info,arguments,MB)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||fd,n&&[n],{tag:Sz(t)}):fd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||fd)}group(e,t,n={collapsed:!1}){const i=PB({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||fd)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=aD(e)}_getLogFunction(e,t,n,i,o){if(this._shouldLog(e)){o=PB({logLevel:e,message:t,args:i,opts:o}),n=n||o.method,aw(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=ld();const s=o.tag||o.message;if(o.once&&s)if(!IB[s])IB[s]=ld();else return fd;return t=Bz(this.id,o.message,o),n.bind(console,t,...o.args)}return fd}};cw.VERSION=oD;function aD(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return aw(Number.isFinite(e)&&e>=0),e}function PB(r){const{logLevel:e,message:t}=r;r.logLevel=aD(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return aw(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function Bz(r,e,t){if(typeof e=="string"){const n=t.time?xz(bz(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=Cz(e,t.color,t.background)}return e}function Sz(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const RB=new cw({id:"loaders.gl"});let Iz=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},Mz=class{constructor(){V(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};const cD={fetch:null,mimeType:void 0,nothrow:!1,log:new Mz,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:rw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Pz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function lD(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function uD(){const r=lD();return r.globalOptions=r.globalOptions||{...cD},r.globalOptions}function Rz(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],Fz(r,t),Dz(e,r,n)}function Fz(r,e){FB(r,null,cD,Pz,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};FB(n,t.id,i,o,e)}}function FB(r,e,t,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const c in r){const f=!e&&xg(r[c]),_=c==="baseUri"&&!e,b=c==="workerUrl"&&e;if(!(c in t)&&!_&&!b){if(c in n)RB.warn(`${o} loader option '${s}${c}' no longer supported, use '${n[c]}'`)();else if(!f){const T=Oz(c,i);RB.warn(`${o} loader option '${s}${c}' not recognized. ${T}`)()}}}}function Oz(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(r===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(t.startsWith(s)||s.startsWith(t))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function Dz(r,e,t){const i={...r.options||{}};return Lz(i,t),i.log===null&&(i.log=new Iz),OB(i,uD()),OB(i,e),i}function OB(r,e){for(const t in e)if(t in e){const n=e[t];CB(n)&&CB(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function Lz(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function lw(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function uw(r){jm(r,"null loader"),jm(lw(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const fD=()=>{const r=lD();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function kz(r){const e=fD();r=Array.isArray(r)?r:[r];for(const t of r){const n=uw(t);e.find(i=>n===i)||e.unshift(n)}}function Nz(){return fD()}const Uz=new cw({id:"loaders.gl"}),zz=/\.([^.]+)$/;async function Gz(r,e=[],t,n){if(!hD(r))return null;let i=DB(r,e,{...t,nothrow:!0},n);if(i)return i;if(ah(r)&&(r=await r.slice(0,10).arrayBuffer(),i=DB(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(dD(r));return i}function DB(r,e=[],t,n){if(!hD(r))return null;if(e&&!Array.isArray(e))return uw(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...Nz()),Hz(i);const o=Vz(r,i,t,n);if(!o&&!(t!=null&&t.nothrow))throw new Error(dD(r));return o}function Vz(r,e,t,n){const i=oy(r),o=sw(r),s=iw(i)||(n==null?void 0:n.url);let c=null,f="";return t!=null&&t.mimeType&&(c=Vv(e,t==null?void 0:t.mimeType),f=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),c=c||jz(e,s),f=f||(c?`matched url ${s}`:""),c=c||Vv(e,o),f=f||(c?`matched MIME type ${o}`:""),c=c||Wz(e,r),f=f||(c?`matched initial data ${AD(r)}`:""),t!=null&&t.fallbackMimeType&&(c=c||Vv(e,t==null?void 0:t.fallbackMimeType),f=f||(c?`matched fallback MIME type ${o}`:"")),f&&Uz.log(1,`selectLoader selected ${c==null?void 0:c.name}: ${f}.`),c}function hD(r){return!(r instanceof Response&&r.status===204)}function dD(r){const e=oy(r),t=sw(r);let n="No valid loader found (";n+=e?`${rD(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?AD(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function Hz(r){for(const e of r)uw(e)}function jz(r,e){const t=e&&zz.exec(e),n=t&&t[1];return n?$z(r,n):null}function $z(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function Vv(r,e){var t;for(const n of r)if((t=n.mimeTypes)!=null&&t.some(i=>EB(e,i))||EB(e,`application/x.${n.id}`))return n;return null}function Wz(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(Jz(e,t))return t}else if(ArrayBuffer.isView(e)){if(LB(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&LB(e,0,t))return t;return null}function Jz(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function LB(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>Xz(r,e,t,i))}function Xz(r,e,t,n){if(n instanceof ArrayBuffer)return j5(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=i2(r,e,n.length);return n===i;default:return!1}}function AD(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?i2(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?i2(r,0,e):""}function i2(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const Kz=256*1024;function*Yz(r,e){const t=(e==null?void 0:e.chunkSize)||Kz;let n=0;const i=new TextEncoder;for(;n<r.length;){const o=Math.min(r.length-n,t),s=r.slice(n,n+o);n+=o,yield i.encode(s)}}const qz=256*1024;function*Zz(r,e={}){const{chunkSize:t=qz}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),o=new ArrayBuffer(i),s=new Uint8Array(r,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const Qz=1024*1024;async function*eG(r,e){const t=(e==null?void 0:e.chunkSize)||Qz;let n=0;for(;n<r.size;){const i=n+t,o=await r.slice(n,i).arrayBuffer();n=i,yield o}}function kB(r,e){return rw?tG(r,e):rG(r)}async function*tG(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:o,value:s}=await i;if(o)return;yield tD(s)}}catch{t.releaseLock()}}async function*rG(r,e){for await(const t of r)yield tD(t)}function nG(r,e){if(typeof r=="string")return Yz(r,e);if(r instanceof ArrayBuffer)return Zz(r,e);if(ah(r))return eG(r,e);if(nD(r))return kB(r,e);if(oh(r))return kB(r.body,e);throw new Error("makeIterator")}const pD="Cannot convert supplied data type";function iG(r,e,t){if(e.text&&typeof r=="string")return r;if(tz(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(pD)}async function sG(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return iG(r,e);if(ah(r)&&(r=await sD(r)),oh(r)){const i=r;return await fz(i),e.binary?await i.arrayBuffer():await i.text()}if(nD(r)&&(r=nG(r,t)),Q5(r)||ez(r))return J5(r);throw new Error(pD)}function gD(r,e){const t=uD(),n=r||t;return typeof n.fetch=="function"?n.fetch:xg(n.fetch)?i=>BB(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:BB}function oG(r,e,t){if(t)return t;const n={fetch:gD(e,r),...r};if(n.url){const i=iw(n.url);n.baseUrl=i,n.queryString=cz(n.url),n.filename=rD(i),n.baseUrl=q5(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function aG(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function Jm(r,e,t,n){e&&!Array.isArray(e)&&!lw(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=oy(r),s=aG(e,n),c=await Gz(r,s,t);return c?(t=Rz(t,c,s,i),n=oG({url:i,_parse:Jm,loaders:s},t,n||null),await cG(c,r,t,n)):null}async function cG(r,e,t,n){if(z5(r),t=S5(r.options,t),oh(e)){const o=e,{ok:s,redirected:c,status:f,statusText:_,type:b,url:T}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:c,status:f,statusText:_,type:b,url:T}}e=await sG(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(G5(r,t))return await V5(r,e,t,n,Jm);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw zu(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function s2(r,e,t,n){let i,o;!Array.isArray(e)&&!lw(e)?(i=[],o=e):(i=e,o=t);const s=gD(o);let c=r;return typeof r=="string"&&(c=await s(r)),ah(r)&&(c=await s(r)),Array.isArray(i)?await Jm(c,i,o):await Jm(c,i,o)}const lG="4.2.4";var zO;const uG=(zO=globalThis.loaders)==null?void 0:zO.parseImageNode,o2=typeof Image<"u",a2=typeof ImageBitmap<"u",fG=!!uG,c2=rw?!0:fG;function hG(r){switch(r){case"auto":return a2||o2||c2;case"imagebitmap":return a2;case"image":return o2;case"data":return c2;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function dG(){if(a2)return"imagebitmap";if(o2)return"image";if(c2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function AG(r){const e=gG(r);if(!e)throw new Error("Not an image");return e}function pG(r){switch(AG(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function gG(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const mG=/^data:image\/svg\+xml/,_G=/\.svg((\?|#).*)?$/;function fw(r){return r&&(mG.test(r)||_G.test(r))}function yG(r,e){if(fw(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return mD(r,e)}function mD(r,e){if(fw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function _D(r,e,t){const n=yG(r,t),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await vG(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function vG(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const bG={};let NB=!0;async function xG(r,e,t){let n;fw(t)?n=await _D(r,e,t):n=mD(r,t);const i=e&&e.imagebitmap;return await wG(n,i)}async function wG(r,e=null){if((CG(e)||!NB)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),NB=!1}return await createImageBitmap(r)}function CG(r){for(const e in r||bG)return!1;return!0}function EG(r){return!IG(r,"ftyp",4)||(r[8]&96)===0?null:TG(r)}function TG(r){switch(BG(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function BG(r,e,t){return String.fromCharCode(...r.slice(e,t))}function SG(r){return[...r].map(e=>e.charCodeAt(0))}function IG(r,e,t=0){const n=SG(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Xc=!1,Gp=!0;function yD(r){const e=wg(r);return PG(e)||OG(e)||RG(e)||FG(e)||MG(e)}function MG(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=EG(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function PG(r){const e=wg(r);return e.byteLength>=24&&e.getUint32(0,Xc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Xc),height:e.getUint32(20,Xc)}:null}function RG(r){const e=wg(r);return e.byteLength>=10&&e.getUint32(0,Xc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Gp),height:e.getUint16(8,Gp)}:null}function FG(r){const e=wg(r);return e.byteLength>=14&&e.getUint16(0,Xc)===16973&&e.getUint32(2,Gp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Gp),height:e.getUint32(22,Gp)}:null}function OG(r){const e=wg(r);if(!(e.byteLength>=3&&e.getUint16(0,Xc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=DG();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,Xc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Xc),width:e.getUint16(o+7,Xc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,Xc)}return null}function DG(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function wg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function LG(r,e){var i;const{mimeType:t}=yD(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return jm(n),await n(r,t)}async function kG(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},s=NG(i);let c;switch(s){case"imagebitmap":c=await xG(r,e,o);break;case"image":c=await _D(r,e,o);break;case"data":c=await LG(r);break;default:jm(!1)}return i==="data"&&(c=pG(c)),c}function NG(r){switch(r){case"auto":case"data":return dG();default:return hG(r),r}}const UG=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],zG=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],GG={image:{type:"auto",decode:!0}},VG={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:lG,mimeTypes:zG,extensions:UG,parse:kG,tests:[r=>!!yD(new DataView(r))],options:GG},$r=new KO({id:"deck"});let l2={};function HG(r){l2=r}function oo(r,e,t,n){$r.level>0&&l2[r]&&l2[r].call(null,e,t,n)}function jG(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const $G={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:jG,parseTextSync:JSON.parse};function WG(){const r="9.1.11",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||($r.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:$r,_registerLoggers:HG},kz([$G,[VG,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const JG=WG();function hw(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const Hv={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function XG(r){const e={};for(const[t,n]of Object.entries(r))e[t]=KG(n);return e}function KG(r){let e=UB(r);if(e!=="object")return{value:r,...Hv[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...Hv[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=UB(r.value),{...r,...Hv[e],type:e}):{type:"object",value:null};throw new Error("props")}function UB(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const YG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,qG=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,ZG={vertex:YG,fragment:qG},zB=/void\s+main\s*\([^)]*\)\s*\{\n?/,GB=/}\n?[^{}]*$/,jv=[],wm="__LUMA_INJECT_DECLARATIONS__";function QG(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const i=e7(t);typeof n=="string"&&(n={order:0,injection:n}),e[i][t]=n}return e}function e7(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Xm(r,e,t,n=!1){const i=e==="vertex";for(const o in t){const s=t[o];s.sort((f,_)=>f.order-_.order),jv.length=s.length;for(let f=0,_=s.length;f<_;++f)jv[f]=s[f].injection;const c=`${jv.join(`
`)}
`;switch(o){case"vs:#decl":i&&(r=r.replace(wm,c));break;case"vs:#main-start":i&&(r=r.replace(zB,f=>f+c));break;case"vs:#main-end":i&&(r=r.replace(GB,f=>c+f));break;case"fs:#decl":i||(r=r.replace(wm,c));break;case"fs:#main-start":i||(r=r.replace(zB,f=>f+c));break;case"fs:#main-end":i||(r=r.replace(GB,f=>c+f));break;default:r=r.replace(o,f=>f+c)}}return r=r.replace(wm,""),n&&(r=r.replace(/\}\s*$/,o=>o+ZG[e])),r}function Km(r){r.map(e=>vD(e))}function vD(r){if(r.instance)return;Km(r.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=r,i={normalizedInjections:QG(n),parsedDeprecations:t7(t)};e&&(i.propValidators=XG(e)),r.instance=i;let o={};e&&(o=Object.entries(e).reduce((s,[c,f])=>{const _=f==null?void 0:f.value;return _&&(s[c]=_),s},{})),r.defaultUniforms={...r.defaultUniforms,...o}}function bD(r,e,t){var n;(n=r.deprecations)==null||n.forEach(i=>{var o;(o=i.regex)!=null&&o.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function t7(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function dw(r){Km(r);const e={},t={};xD({modules:r,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((i,o)=>t[o]-t[i]).map(i=>e[i]);return Km(n),n}function xD(r){const{modules:e,level:t,moduleMap:n,moduleDepth:i}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(i[o.name]===void 0||i[o.name]<t)&&(i[o.name]=t);for(const o of e)o.dependencies&&xD({modules:o.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function r7(r){switch(r==null?void 0:r.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function n7(r,e){var n;if(Number(((n=r.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=VB(r,i7),r;case"fragment":return r=VB(r,s7),r;default:throw new Error(e)}}const wD=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],i7=[...wD,[u2("attribute"),"in $1"],[u2("varying"),"out $1"]],s7=[...wD,[u2("varying"),"in $1"]];function VB(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function u2(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function CD(r,e){let t="";for(const n in r){const i=r[n];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[n]){const o=e[n];o.sort((s,c)=>s.order-c.order);for(const s of o)t+=`  ${s.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function ED(r){const e={vertex:{},fragment:{}};for(const t of r){let n,i;typeof t!="string"?(n=t,i=n.hook):(n={},i=t),i=i.trim();const[o,s]=i.split(":"),c=i.replace(/\(.+/,""),f=Object.assign(n,{signature:s});switch(o){case"vs":e.vertex[c]=f;break;case"fs":e.fragment[c]=f;break;default:throw new Error(o)}}return e}function o7(r,e){return{name:a7(r,e),language:"glsl",version:c7(r)}}function a7(r,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function c7(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const TD=`

${wm}
`,l7=`precision highp float;
`;function u7(r){const e=dw(r.modules||[]);return{source:h7(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:BD(e)}}function f7(r){const{vs:e,fs:t}=r,n=dw(r.modules||[]);return{vs:HB(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:HB(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:BD(n)}}function h7(r,e){var G;const{source:t,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:c}=e;hw(typeof t=="string","shader source must be a string");const f=t;let _="";const b=ED(o),T={},S={},D={};for(const W in s){const z=typeof s[W]=="string"?{injection:s[W],order:0}:s[W],j=/^(v|f)s:(#)?([\w-]+)$/.exec(W);if(j){const K=j[2],fe=j[3];K?fe==="decl"?S[W]=[z]:D[W]=[z]:T[W]=[z]}else D[W]=[z]}const N=i;for(const W of N){c&&bD(W,f,c);const z=SD(W,"wgsl");_+=z;const j=((G=W.injections)==null?void 0:G[n])||{};for(const K in j){const fe=/^(v|f)s:#([\w-]+)$/.exec(K);if(fe){const ae=fe[2]==="decl"?S:D;ae[K]=ae[K]||[],ae[K].push(j[K])}else T[K]=T[K]||[],T[K].push(j[K])}}return _+=TD,_=Xm(_,n,S),_+=CD(b[n],T),_+=f,_=Xm(_,n,D),_}function HB(r,e){var Be;const{id:t,source:n,stage:i,language:o="glsl",modules:s,defines:c={},hookFunctions:f=[],inject:_={},prologue:b=!0,log:T}=e;hw(typeof n=="string","shader source must be a string");const S=o==="glsl"?o7(n).version:-1,D=r.shaderLanguageVersion,N=S===100?"#version 100":"#version 300 es",W=n.split(`
`).slice(1).join(`
`),z={};s.forEach(Le=>{Object.assign(z,Le.defines)}),Object.assign(z,c);let j="";switch(o){case"wgsl":break;case"glsl":j=b?`${N}

// ----- PROLOGUE -------------------------
${d7({id:t,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${r7(r)}
${i==="fragment"?l7:""}

// ----- APPLICATION DEFINES -------------------------

${A7(z)}

`:`${N}
`;break}const K=ED(f),fe={},Z={},ae={};for(const Le in _){const de=typeof _[Le]=="string"?{injection:_[Le],order:0}:_[Le],_e=/^(v|f)s:(#)?([\w-]+)$/.exec(Le);if(_e){const pe=_e[2],J=_e[3];pe?J==="decl"?Z[Le]=[de]:ae[Le]=[de]:fe[Le]=[de]}else ae[Le]=[de]}for(const Le of s){T&&bD(Le,W,T);const de=SD(Le,i);j+=de;const _e=((Be=Le.instance)==null?void 0:Be.normalizedInjections[i])||{};for(const pe in _e){const J=/^(v|f)s:#([\w-]+)$/.exec(pe);if(J){const ye=J[2]==="decl"?Z:ae;ye[pe]=ye[pe]||[],ye[pe].push(_e[pe])}else fe[pe]=fe[pe]||[],fe[pe].push(_e[pe])}}return j+="// ----- MAIN SHADER SOURCE -------------------------",j+=TD,j=Xm(j,i,Z),j+=CD(K[i],fe),j+=W,j=Xm(j,i,ae),o==="glsl"&&S!==D&&(j=n7(j,i)),j.trim()}function BD(r){return function(t){var i;const n={};for(const o of r){const s=(i=o.getUniforms)==null?void 0:i.call(o,t,n);Object.assign(n,s)}return n}}function d7(r){const{id:e,source:t,stage:n}=r;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function A7(r={}){let e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function SD(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:hw(!1)}if(!r.name)throw new Error("Shader module must have a name");const n=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${t}
`,i}const p7=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,g7=/^\s*\#\s*endif\s*$/;function m7(r,e){var s;const t=r.split(`
`),n=[];let i=!0,o=null;for(const c of t){const f=c.match(p7),_=c.match(g7);f?(o=f[1],i=!!((s=e==null?void 0:e.defines)!=null&&s[o])):_?i=!0:i&&n.push(c)}return n.join(`
`)}const zf=class zf{constructor(){V(this,"_hookFunctions",[]);V(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return zf.defaultShaderAssembler=zf.defaultShaderAssembler||new zf,zf.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:o}=u7({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?m7(i):i,getUniforms:o,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...f7({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const c=this._defaultModules[o],f=c.name;t[i++]=c,n[f]=!0}for(let o=0,s=e.length;o<s;++o){const c=e[o],f=c.name;n[f]||(t[i++]=c,n[f]=!0)}return t.length=i,Km(t),t}};V(zf,"defaultShaderAssembler");let Ym=zf;const _7=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,y7=`#version 300 es
${_7}`;function ID(r){const{input:e,inputChannels:t,output:n}=r||{};if(!e)return y7;if(!t)throw new Error("inputChannels");const i=v7(t),o=b7(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function v7(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function b7(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}function jB(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let $B=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=jB(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(jB()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},x7=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof $B?i=e:i=new $B(t,n),this.stats[t]=i),i}};class w7{constructor(){V(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new x7({id:e})),this.stats.get(e)}}const MD=new w7;function C7(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let E7=class{constructor(e,t,n="sessionStorage"){this.storage=C7(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function T7(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function B7(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var qm;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(qm||(qm={}));const S7=10;function WB(r){return typeof r!="string"?r:(r=r.toUpperCase(),qm[r]||qm.WHITE)}function I7(r,e,t){return!il&&typeof r=="string"&&(e&&(r=`\x1B[${WB(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${WB(t)+S7}m${r}\x1B[49m`)),r}function M7(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(c=>o===c)||(i[o]=s.bind(r)))}}function Aw(r,e){if(!r)throw new Error("Assertion failed")}function hd(){var e,t,n;let r;if(il()&&Fu.performance)r=(t=(e=Fu==null?void 0:Fu.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Ta){const i=(n=Ta==null?void 0:Ta.hrtime)==null?void 0:n.call(Ta);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const dd={debug:il()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},P7={enabled:!0,level:0};function Ad(){}const JB={},XB={once:!0};let PD=class{constructor({id:e}={id:""}){this.VERSION=sy,this._startTs=hd(),this._deltaTs=hd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new E7(`__probe-${this.id}__`,P7),this.timeStamp(`${this.id} started`),M7(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((hd()-this._startTs).toPrecision(10))}getDelta(){return Number((hd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,dd.warn,arguments,XB)}error(e){return this._getLogFunction(0,e,dd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,dd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,dd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,dd.debug||dd.info,arguments,XB)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||Ad,n&&[n],{tag:F7(t)}):Ad}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Ad)}group(e,t,n={collapsed:!1}){const i=KB({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ad)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=RD(e)}_getLogFunction(e,t,n,i,o){if(this._shouldLog(e)){o=KB({logLevel:e,message:t,args:i,opts:o}),n=n||o.method,Aw(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=hd();const s=o.tag||o.message;if(o.once&&s)if(!JB[s])JB[s]=hd();else return Ad;return t=R7(this.id,o.message,o),n.bind(console,t,...o.args)}return Ad}};PD.VERSION=sy;function RD(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return Aw(Number.isFinite(e)&&e>=0),e}function KB(r){const{logLevel:e,message:t}=r;r.logLevel=RD(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return Aw(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function R7(r,e,t){if(typeof e=="string"){const n=t.time?B7(T7(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=I7(e,t.color,t.background)}return e}function F7(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const Yt=new PD({id:"luma.gl"}),$v={};function ay(r="id"){$v[r]=$v[r]||1;const e=$v[r]++;return`${r}-${e}`}var t2;let li=(t2=class{constructor(e,t,n){V(this,"id");V(this,"props");V(this,"userData",{});V(this,"_device");V(this,"destroyed",!1);V(this,"allocatedBytes",0);V(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=O7(t,n);const i=this.props.id!=="undefined"?this.props.id:ay(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},V(t2,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),t2);function O7(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}var os;let Ni=(os=class extends li{constructor(t,n){const i={...n};(n.usage||0)&os.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(t,i,os.defaultProps);V(this,"usage");V(this,"indexType");V(this,"updateTimestamp");V(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,n){throw new Error("not implemented")}_setDebugData(t,n,i){const o=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:i,os.DEBUG_DATA_MAX_LENGTH);o===null?this.debugData=new ArrayBuffer(s):n===0&&i===o.byteLength?this.debugData=o.slice(0,s):this.debugData=o.slice(n,n+s)}},V(os,"defaultProps",{...li.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),V(os,"MAP_READ",1),V(os,"MAP_WRITE",2),V(os,"COPY_SRC",4),V(os,"COPY_DST",8),V(os,"INDEX",16),V(os,"VERTEX",32),V(os,"UNIFORM",64),V(os,"STORAGE",128),V(os,"INDIRECT",256),V(os,"QUERY_RESOLVE",512),V(os,"DEBUG_DATA_MAX_LENGTH",32),os);function FD(r){const e=YB[r],t=D7(e),n=r.includes("norm"),i=!n&&!r.startsWith("float"),o=r.startsWith("s");return{dataType:YB[r],byteLength:t,integer:i,signed:o,normalized:n}}function D7(r){return L7[r]}const YB={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},L7={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},no="texture-compression-bc",oi="texture-compression-astc",Vc="texture-compression-etc2",k7="texture-compression-etc1-webgl",w0="texture-compression-pvrtc-webgl",Wv="texture-compression-atc-webgl",C0="float32-renderable-webgl",Jv="float16-renderable-webgl",N7="rgb9e5ufloat-renderable-webgl",Xv="snorm8-renderable-webgl",yp="norm16-renderable-webgl",Kv="snorm16-renderable-webgl",E0="float32-filterable",qB="float16-filterable-webgl";function OD(r){const e=U7[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const U7={r8unorm:{},r8snorm:{render:Xv},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Xv},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Jv,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:yp},"r16snorm-webgl":{f:Kv},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Xv},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Jv,filter:qB},"rg16unorm-webgl":{render:yp},"rg16snorm-webgl":{render:Kv},r32uint:{},r32sint:{},r32float:{render:C0,filter:E0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:N7},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:C0},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:yp},"rgb16snorm-webgl":{f:yp},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:E0},rgba16uint:{},rgba16sint:{},rgba16float:{render:Jv,filter:qB},"rgba16unorm-webgl":{render:yp},"rgba16snorm-webgl":{render:Kv},"rgb32float-webgl":{render:C0,filter:E0},rgba32uint:{},rgba32sint:{},rgba32float:{render:C0,filter:E0},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:no},"bc1-rgb-unorm-srgb-webgl":{f:no},"bc1-rgba-unorm":{f:no},"bc1-rgba-unorm-srgb":{f:no},"bc2-rgba-unorm":{f:no},"bc2-rgba-unorm-srgb":{f:no},"bc3-rgba-unorm":{f:no},"bc3-rgba-unorm-srgb":{f:no},"bc4-r-unorm":{f:no},"bc4-r-snorm":{f:no},"bc5-rg-unorm":{f:no},"bc5-rg-snorm":{f:no},"bc6h-rgb-ufloat":{f:no},"bc6h-rgb-float":{f:no},"bc7-rgba-unorm":{f:no},"bc7-rgba-unorm-srgb":{f:no},"etc2-rgb8unorm":{f:Vc},"etc2-rgb8unorm-srgb":{f:Vc},"etc2-rgb8a1unorm":{f:Vc},"etc2-rgb8a1unorm-srgb":{f:Vc},"etc2-rgba8unorm":{f:Vc},"etc2-rgba8unorm-srgb":{f:Vc},"eac-r11unorm":{f:Vc},"eac-r11snorm":{f:Vc},"eac-rg11unorm":{f:Vc},"eac-rg11snorm":{f:Vc},"astc-4x4-unorm":{f:oi},"astc-4x4-unorm-srgb":{f:oi},"astc-5x4-unorm":{f:oi},"astc-5x4-unorm-srgb":{f:oi},"astc-5x5-unorm":{f:oi},"astc-5x5-unorm-srgb":{f:oi},"astc-6x5-unorm":{f:oi},"astc-6x5-unorm-srgb":{f:oi},"astc-6x6-unorm":{f:oi},"astc-6x6-unorm-srgb":{f:oi},"astc-8x5-unorm":{f:oi},"astc-8x5-unorm-srgb":{f:oi},"astc-8x6-unorm":{f:oi},"astc-8x6-unorm-srgb":{f:oi},"astc-8x8-unorm":{f:oi},"astc-8x8-unorm-srgb":{f:oi},"astc-10x5-unorm":{f:oi},"astc-10x5-unorm-srgb":{f:oi},"astc-10x6-unorm":{f:oi},"astc-10x6-unorm-srgb":{f:oi},"astc-10x8-unorm":{f:oi},"astc-10x8-unorm-srgb":{f:oi},"astc-10x10-unorm":{f:oi},"astc-10x10-unorm-srgb":{f:oi},"astc-12x10-unorm":{f:oi},"astc-12x10-unorm-srgb":{f:oi},"astc-12x12-unorm":{f:oi},"astc-12x12-unorm-srgb":{f:oi},"pvrtc-rgb4unorm-webgl":{f:w0},"pvrtc-rgba4unorm-webgl":{f:w0},"pvrtc-rbg2unorm-webgl":{f:w0},"pvrtc-rgba2unorm-webgl":{f:w0},"etc1-rbg-unorm-webgl":{f:k7},"atc-rgb-unorm-webgl":{f:Wv},"atc-rgba-unorm-webgl":{f:Wv},"atc-rgbai-unorm-webgl":{f:Wv}},z7=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],G7=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function DD(r){return z7.some(e=>r.startsWith(e))}function pw(r){let e=V7(r);if(DD(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=H7(r);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=G7.exec(r);if(t){const[,n,i,o,s,c]=t,f=`${o}${i}`,_=FD(f),b=_.byteLength*8,T=n.length,S=[b,T>=2?b:0,T>=3?b:0,T>=4?b:0];e={format:r,attachment:e.attachment,dataType:_.dataType,components:T,channels:n,integer:_.integer,signed:_.signed,normalized:_.normalized,bitsPerChannel:S,bytesPerPixel:_.byteLength*n.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),s==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function V7(r){var o;const e=OD(r),t=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((o=e.channels)==null?void 0:o.length)||1,bytesPerPixel:t,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function H7(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,n,i]=t;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function j7(r){const e=OD(r),t={format:r,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=pw(r),i=r.startsWith("depth")||r.startsWith("stencil"),o=n==null?void 0:n.signed,s=n==null?void 0:n.integer,c=n==null?void 0:n.webgl;return t.render&&(t.render=!o),t.filter&&(t.filter=!i&&!o&&!s&&!c),t}class $7{}class W7{constructor(e=[],t){V(this,"features");V(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const j_=class j_{constructor(e){V(this,"id");V(this,"props");V(this,"userData",{});V(this,"statsManager",MD);V(this,"timestamp",0);V(this,"_reused",!1);V(this,"_lumaData",{});this.props={...j_.defaultProps,...e},this.id=this.props.id||ay(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=j7(e),n=s=>(typeof s=="string"?this.features.has(s):s)??!0,i=n(t.create),o={format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return DD(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ni.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Yt.warn("indices buffer content must be of integer type")()),t}};V(j_,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Yt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Yt.get("debug")||void 0,debugShaders:Yt.get("debug-shaders")||void 0,debugFramebuffers:!!Yt.get("debug-framebuffers"),debugWebGL:!!Yt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let ku=j_;const J7=il()&&typeof document<"u",X7=()=>J7&&document.readyState==="complete",K7="set luma.log.level=1 (or higher) to trace rendering",ZB="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Pu=class Pu{constructor(){V(this,"stats",MD);V(this,"log",Yt);V(this,"VERSION","9.1.5");V(this,"spector");V(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Yt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Yt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Yt.error("This version of luma.gl has already been initialized")()}Yt.log(1,`${this.VERSION} - ${K7}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,n])=>n).filter(n=>{var i;return(i=n.isSupported)==null?void 0:i.call(n)}).map(n=>n.type)}getBestAvailableAdapter(e=[]){var n,i,o,s;const t=this.getAdapterMap(e);return(i=(n=t.get("webgpu"))==null?void 0:n.isSupported)!=null&&i.call(n)?"webgpu":(s=(o=t.get("webgl"))==null?void 0:o.isSupported)!=null&&s.call(o)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Pu.defaultProps,e)}async createDevice(e={}){var c;e={...Pu.defaultProps,...e},e.waitForPageLoad&&await Pu.pageLoaded;const t=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const o=(this.getAdapterMap(e.adapters)||t).get(n),s=await((c=o==null?void 0:o.create)==null?void 0:c.call(o,e));if(s)return s;throw new Error(ZB)}async attachDevice(e){var s;const t=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Pu.pageLoaded,e.handle===null&&(n="unknown");const i=t.get(n),o=await((s=i==null?void 0:i.attach)==null?void 0:s.call(i,null));if(o)return o;throw new Error(ZB)}enforceWebGL2(e=!0,t=[]){var o;const i=this.getAdapterMap(t).get("webgl");i||Yt.warn("enforceWebGL2: webgl adapter not found")(),(o=i==null?void 0:i.enforceWebGL2)==null||o.call(i,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){Yt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const n=t.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};V(Pu,"defaultProps",{...ku.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),V(Pu,"pageLoaded",Y7().then(()=>{Yt.probe(2,"DOM is loaded")()}));let f2=Pu;const h2=new f2;function Y7(){return X7()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}class q7{}const $_=class $_{constructor(e){V(this,"id");V(this,"props");V(this,"canvas");V(this,"htmlCanvas");V(this,"offscreenCanvas");V(this,"type");V(this,"width",1);V(this,"height",1);V(this,"resizeObserver");V(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...$_.defaultProps,...e},e=this.props,!il()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Q7(e.canvas):this.canvas=e.canvas;else{const t=eV(e),n=Z7((e==null?void 0:e.container)||null);n.insertBefore(t,n.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?t/n:1}catch{return 1}}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return tV(e,n,i,o,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Yt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==e){let s=e;const c=Math.floor(n*s),f=Math.floor(i*s);if(this.htmlCanvas.width=c,this.htmlCanvas.height=f,this.device.gl){const[b,T]=this.getDrawingBufferSize();(b!==c||T!==f)&&(s=Math.min(b/n,T/i),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(i*s),Yt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};V($_,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let d2=$_;function Z7(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}else if(r)return r;return document.body}function Q7(r){const e=document.getElementById(r);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function eV(r){const{width:e,height:t}=r,n=document.createElement("canvas");return n.id=ay("lumagl-auto-created-canvas"),n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",n}function tV(r,e,t,n,i){const o=r,s=QB(o[0],e,t);let c=eS(o[1],e,n,i),f=QB(o[0]+1,e,t);const _=f===t-1?f:f-1;f=eS(o[1]+1,e,n,i);let b;return i?(f=f===0?f:f+1,b=c,c=f):b=f===n-1?f:f-1,{x:s,y:c,width:Math.max(_-s+1,1),height:Math.max(b-c+1,1)}}function QB(r,e,t){return Math.min(Math.round(r*e),t-1)}function eS(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}const Vs=class Vs extends li{constructor(t,n){n=Vs.normalizeProps(t,n);super(t,n,Vs.defaultProps);V(this,"dimension");V(this,"format");V(this,"width");V(this,"height");V(this,"depth");V(this,"mipLevels");V(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Vs.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Vs.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const n=t==null?void 0:t.data;return ArrayBuffer.isView(n)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Vs.getTextureDataSize(t[0]);if(Vs.isExternalImage(t))return Vs.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,n){let i;return ArrayBuffer.isView(t)?i=[{data:t,width:n.width,height:n.height}]:Array.isArray(t)?i=t:i=[t],i}static getMipLevelCount(t,n){return Math.floor(Math.log2(Math.max(t,n)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,n){var f,_;const i={...n},o=((_=(f=t==null?void 0:t.props)==null?void 0:f._resourceDefaults)==null?void 0:_.texture)||{};Object.assign(i,o);const{width:s,height:c}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof c=="number"&&(i.height=Math.max(1,Math.ceil(c))),i}};V(Vs,"COPY_SRC",1),V(Vs,"COPY_DST",2),V(Vs,"TEXTURE",4),V(Vs,"STORAGE",8),V(Vs,"RENDER_ATTACHMENT",16),V(Vs,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),V(Vs,"defaultProps",{...li.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),V(Vs,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ki=Vs;const W_=class W_ extends li{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,W_.defaultProps)}};V(W_,"defaultProps",{...li.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Zm=W_;function rV(r,e,t){let n="";const i=e.split(/\r?\n/),o=r.slice().sort((s,c)=>s.lineNum-c.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let s=0;for(let c=1;c<=i.length;c++)for(n+=LD(i[c-1],c,t);o.length>s&&o[s].lineNum===c;){const f=o[s++];n+=tS(f,i,f.lineNum,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const c of r)n+=tS(c,i,c.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function tS(r,e,t,n){if(n!=null&&n.inlineSource){const o=nV(e,t),s=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${o}${s}${r.type.toUpperCase()}: ${r.message}

`}const i=r.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function nV(r,e,t){let n="";for(let i=e-2;i<=e;i++){const o=r[i-1];o!==void 0&&(n+=LD(o,e,t))}return n}function LD(r,e,t){const n=t!=null&&t.html?sV(r):r;return`${iV(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function iV(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function sV(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const J_=class J_ extends li{constructor(t,n){n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"};super(t,{id:oV(n),...n},J_.defaultProps);V(this,"stage");V(this,"source");V(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();t==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(t){var _;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=kD(this.source),i=`${this.stage} ${n}`;let o=rV(t,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),(_=document.getElementsByClassName("luma-compiler-log-error")[0])==null||_.scrollIntoView(),c.onclick=()=>{const b=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(b)}}};V(J_,"defaultProps",{...li.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Qm=J_;function oV(r){return kD(r.source)||r.id||ay(`unnamed ${r.stage}-shader`)}function kD(r,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}const rg=class rg extends li{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=rg.normalizeProps(e,t),super(e,t,rg.defaultProps)}static normalizeProps(e,t){var o,s;const n=((s=(o=e==null?void 0:e.props)==null?void 0:o._resourceDefaults)==null?void 0:s.sampler)||{};return{...t,...n}}};V(rg,"defaultProps",{...li.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let e_=rg;const X_=class X_ extends li{constructor(t,n={}){super(t,n,X_.defaultProps);V(this,"width");V(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const n=this.colorAttachments.map(o=>o.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:i})}resize(t){let n=!t;if(t){const[i,o]=Array.isArray(t)?t:[t.width,t.height];n=n||o!==this.height||i!==this.width,this.width=i,this.height=o}n&&(Yt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,i)=>{if(typeof n=="string"){const o=this.createColorTexture(n,i);return this.attachResource(o),o.view}return n instanceof ki?n.view:n});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const n=this.createDepthStencilTexture(t);this.attachResource(n),this.depthStencilAttachment=n.view}else t instanceof ki?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:ki.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ki.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const o=this.colorAttachments[i].texture.clone({width:t,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};V(X_,"defaultProps",{...li.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let t_=X_;const K_=class K_ extends li{constructor(t,n){super(t,n,K_.defaultProps);V(this,"shaderLayout");V(this,"bufferLayout");V(this,"linkStatus","pending");V(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};V(K_,"defaultProps",{...li.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let pA=K_;const ec=class ec extends li{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=ec.normalizeProps(e,t),super(e,t,ec.defaultProps)}static normalizeProps(e,t){var o;return{...(o=e.props._resourceDefaults)==null?void 0:o.renderPass,...t}}};V(ec,"defaultClearColor",[0,0,0,1]),V(ec,"defaultClearDepth",1),V(ec,"defaultClearStencil",0),V(ec,"defaultProps",{...li.defaultProps,framebuffer:null,parameters:void 0,clearColor:ec.defaultClearColor,clearColors:void 0,clearDepth:ec.defaultClearDepth,clearStencil:ec.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let A2=ec;const Y_=class Y_ extends li{constructor(t,n){super(t,n,Y_.defaultProps);V(this,"hash","");V(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};V(Y_,"defaultProps",{...li.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let r_=Y_;const q_=class q_ extends li{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,q_.defaultProps)}};V(q_,"defaultProps",{...li.defaultProps,measureExecutionTime:void 0});let p2=q_;const Z_=class Z_ extends li{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Z_.defaultProps)}};V(Z_,"defaultProps",{...li.defaultProps});let g2=Z_;function aV(r){const[e,t]=lV[r],n=e==="i32"||e==="u32",i=e!=="u32",o=uV[e]*t,s=cV(e,t);return{dataType:e,components:t,defaultVertexFormat:s,byteLength:o,integer:n,signed:i}}function cV(r,e){let t;switch(r){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const lV={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},uV={f32:4,f16:2,i32:4,u32:4};function ND(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),i=t,o=n?parseInt(n):1,s=FD(i),c={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(c.webglOnly=!0),c}function UD(r,e){const t={};for(const n of r.attributes){const i=hV(r,e,n.name);i&&(t[n.name]=i)}return t}function fV(r,e,t=16){const n=UD(r,e),i=new Array(t).fill(null);for(const o of Object.values(n))i[o.location]=o;return i}function hV(r,e,t){const n=dV(r,t),i=AV(e,t);if(!n)return null;const o=aV(n.type),s=(i==null?void 0:i.vertexFormat)||o.defaultVertexFormat,c=ND(s);return{attributeName:(i==null?void 0:i.attributeName)||n.name,bufferName:(i==null?void 0:i.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:o.integer,stepMode:(i==null?void 0:i.stepMode)||n.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function dV(r,e){const t=r.attributes.find(n=>n.name===e);return t||Yt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function AV(r,e){pV(r);let t=gV(r,e);return t||(t=mV(r,e),t)?t:(Yt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function pV(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&Yt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function gV(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function mV(r,e){var t;for(const n of r){let i=n.byteStride;if(typeof n.byteStride!="number")for(const s of n.attributes||[]){const c=ND(s.format);i+=c.byteLength}const o=(t=n.attributes)==null?void 0:t.find(s=>s.attribute===e);if(o)return{attributeName:o.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:i}}return null}const Q_=class Q_ extends li{constructor(t,n){super(t,n,Q_.defaultProps);V(this,"maxVertexAttributes");V(this,"attributeInfos");V(this,"indexBuffer",null);V(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:o}=n.renderPipeline||{};if(!i||!o)throw new Error("VertexArray");this.attributeInfos=fV(i,o,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,n){this.device.reportError(new Error("constant attributes not supported"))}};V(Q_,"defaultProps",{...li.defaultProps,renderPipeline:null});let m2=Q_;const ey=class ey extends li{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,ey.defaultProps)}};V(ey,"defaultProps",{...li.defaultProps,layout:void 0,buffers:{}});let _2=ey;const ty=class ty extends li{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,ty.defaultProps)}};V(ty,"defaultProps",{...li.defaultProps,type:void 0,count:void 0});let y2=ty;const _V={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function yV(r){return _V[r]}function vV(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}let T0;function zD(r){return(!T0||T0.byteLength<r)&&(T0=new ArrayBuffer(r)),T0}function bV(r,e){const t=zD(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function xV(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function n_(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":xV(r)}const rS=1024;class wV{constructor(e){V(this,"layout",{});V(this,"byteLength");let t=0;for(const[i,o]of Object.entries(e)){const s=yV(o),{type:c,components:f}=s;t=vV(t,f);const _=t;t+=f,this.layout[i]={type:c,size:f,offset:_}}t+=(4-t%4)%4;const n=t*4;this.byteLength=Math.max(n,rS)}getData(e){const t=Math.max(this.byteLength,rS),n=zD(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[o,s]of Object.entries(e)){const c=this.layout[o];if(!c){Yt.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:f,size:_,offset:b}=c,T=i[f];if(_===1){if(typeof s!="number"&&typeof s!="boolean"){Yt.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}T[b]=Number(s)}else{if(!n_(s)){Yt.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}T.set(s,b)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function CV(r,e,t=16){if(r!==e)return!1;const n=r,i=e;if(!n_(n))return!1;if(n_(i)&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function EV(r){return n_(r)?r.slice():r}class TV{constructor(e){V(this,"name");V(this,"uniforms",{});V(this,"modifiedUniforms",{});V(this,"modified",!0);V(this,"bindingLayout",{});V(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(o=>o.type==="uniform"&&o.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const i=n;for(const o of i.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){CV(this.uniforms[e],t)||(this.uniforms[e]=EV(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class BV{constructor(e){V(this,"uniformBlocks",new Map);V(this,"uniformBufferLayouts",new Map);V(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const i=t,o=new wV(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);const s=new TV({name:t});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,i]of Object.entries(e))(t=this.uniformBlocks.get(n))==null||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var n,i;const t=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:Ni.UNIFORM|Ni.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return o.write(s),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Ni.UNIFORM|Ni.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Yt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var o;const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&(t!=null&&t.needsRedraw)){i||(i=t.needsRedraw);const s=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(s);const c=(o=this.uniformBlocks.get(e))==null?void 0:o.getAllUniforms();Yt.log(4,`Writing to uniform buffer ${String(e)}`,s,c)()}return i}}function GD(r){const e=ArrayBuffer.isView(r)?r.constructor:r;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function VD(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function SV(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=GD(r);if(i==="uint8"&&t&&n===1)return"unorm8-webgl";if(i==="uint8"&&t&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}class Yv{constructor(e){V(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const o=n.findIndex(s=>s.name===i.name);o<0?n.push(i):n[o]=i}return n}}class IV{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Hl{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(i_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(s_.instance)}}}class i_ extends Hl{}i_.instance=new i_;class s_ extends Hl{}s_.instance=new s_;class Ri extends Hl{constructor(){super()}}let v2=class extends Ri{constructor(e,t,n,i,o,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class MV extends Ri{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class PV extends Ri{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class RV extends Ri{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class FV extends Ri{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Nf extends Ri{constructor(e,t,n,i,o){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class HD extends Ri{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class b2 extends Ri{constructor(e,t,n,i,o){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class nS extends Ri{constructor(e,t,n,i,o){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var gA;(function(r){r.increment="++",r.decrement="--"})(gA||(gA={}));(function(r){function e(t){const n=t;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return r[n]}r.parse=e})(gA||(gA={}));class OV extends Ri{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var sg;(function(r){r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(sg||(sg={}));(function(r){function e(t){const n=t;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}r.parse=e})(sg||(sg={}));class DV extends Ri{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class jD extends Ri{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}}class LV extends Ri{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class kV extends Ri{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class NV extends Ri{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class UV extends Ri{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class zV extends Ri{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class GV extends Ri{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class VV extends Ri{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class $D extends Ri{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class HV extends Ri{constructor(){super()}get astNodeType(){return"discard"}}class jV extends Ri{constructor(){super()}get astNodeType(){return"break"}}class $V extends Ri{constructor(){super()}get astNodeType(){return"continue"}}class ch extends Ri{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class kf extends ch{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class WD extends ch{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class WV extends ch{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class JD extends ch{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Pp extends ch{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class mc extends Hl{constructor(){super()}}class iS extends mc{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class jd extends mc{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){e(this);for(const t of this.args)t.search(e)}}class XD extends mc{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const t of this.args)t.search(e);e(this)}}class x2 extends mc{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const t=e.constants.get(this.name);if(!t)throw new Error("Cannot evaluate node");return t.evaluate(e)}}class sS extends mc{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof jd){const i=(t=this.postfix)===null||t===void 0?void 0:t.evaluateString(e),o=(n=this.initializer.type)===null||n===void 0?void 0:n.name,s=e.structs.get(o),c=s==null?void 0:s.getMemberIndex(i);if(c!=-1)return this.initializer.args[c].evaluate(e);console.log(c)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class oS extends mc{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class JV extends mc{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class XV extends mc{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class aS extends mc{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class KV extends mc{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class KD extends mc{constructor(){super()}}class YV extends KD{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Hc extends KD{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class YD extends Hl{constructor(){super()}}class qV extends YD{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class ZV extends YD{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class QV extends Hl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class eH extends Hl{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class tH extends Hl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}let rH=class extends Hl{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}};var gt,st;(function(r){r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(st||(st={}));class ot{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class ke{}gt=ke;ke.none=new ot("",st.reserved,"");ke.eof=new ot("EOF",st.token,"");ke.reserved={asm:new ot("asm",st.reserved,"asm"),bf16:new ot("bf16",st.reserved,"bf16"),do:new ot("do",st.reserved,"do"),enum:new ot("enum",st.reserved,"enum"),f16:new ot("f16",st.reserved,"f16"),f64:new ot("f64",st.reserved,"f64"),handle:new ot("handle",st.reserved,"handle"),i8:new ot("i8",st.reserved,"i8"),i16:new ot("i16",st.reserved,"i16"),i64:new ot("i64",st.reserved,"i64"),mat:new ot("mat",st.reserved,"mat"),premerge:new ot("premerge",st.reserved,"premerge"),regardless:new ot("regardless",st.reserved,"regardless"),typedef:new ot("typedef",st.reserved,"typedef"),u8:new ot("u8",st.reserved,"u8"),u16:new ot("u16",st.reserved,"u16"),u64:new ot("u64",st.reserved,"u64"),unless:new ot("unless",st.reserved,"unless"),using:new ot("using",st.reserved,"using"),vec:new ot("vec",st.reserved,"vec"),void:new ot("void",st.reserved,"void")};ke.keywords={array:new ot("array",st.keyword,"array"),atomic:new ot("atomic",st.keyword,"atomic"),bool:new ot("bool",st.keyword,"bool"),f32:new ot("f32",st.keyword,"f32"),i32:new ot("i32",st.keyword,"i32"),mat2x2:new ot("mat2x2",st.keyword,"mat2x2"),mat2x3:new ot("mat2x3",st.keyword,"mat2x3"),mat2x4:new ot("mat2x4",st.keyword,"mat2x4"),mat3x2:new ot("mat3x2",st.keyword,"mat3x2"),mat3x3:new ot("mat3x3",st.keyword,"mat3x3"),mat3x4:new ot("mat3x4",st.keyword,"mat3x4"),mat4x2:new ot("mat4x2",st.keyword,"mat4x2"),mat4x3:new ot("mat4x3",st.keyword,"mat4x3"),mat4x4:new ot("mat4x4",st.keyword,"mat4x4"),ptr:new ot("ptr",st.keyword,"ptr"),sampler:new ot("sampler",st.keyword,"sampler"),sampler_comparison:new ot("sampler_comparison",st.keyword,"sampler_comparison"),struct:new ot("struct",st.keyword,"struct"),texture_1d:new ot("texture_1d",st.keyword,"texture_1d"),texture_2d:new ot("texture_2d",st.keyword,"texture_2d"),texture_2d_array:new ot("texture_2d_array",st.keyword,"texture_2d_array"),texture_3d:new ot("texture_3d",st.keyword,"texture_3d"),texture_cube:new ot("texture_cube",st.keyword,"texture_cube"),texture_cube_array:new ot("texture_cube_array",st.keyword,"texture_cube_array"),texture_multisampled_2d:new ot("texture_multisampled_2d",st.keyword,"texture_multisampled_2d"),texture_storage_1d:new ot("texture_storage_1d",st.keyword,"texture_storage_1d"),texture_storage_2d:new ot("texture_storage_2d",st.keyword,"texture_storage_2d"),texture_storage_2d_array:new ot("texture_storage_2d_array",st.keyword,"texture_storage_2d_array"),texture_storage_3d:new ot("texture_storage_3d",st.keyword,"texture_storage_3d"),texture_depth_2d:new ot("texture_depth_2d",st.keyword,"texture_depth_2d"),texture_depth_2d_array:new ot("texture_depth_2d_array",st.keyword,"texture_depth_2d_array"),texture_depth_cube:new ot("texture_depth_cube",st.keyword,"texture_depth_cube"),texture_depth_cube_array:new ot("texture_depth_cube_array",st.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ot("texture_depth_multisampled_2d",st.keyword,"texture_depth_multisampled_2d"),texture_external:new ot("texture_external",st.keyword,"texture_external"),u32:new ot("u32",st.keyword,"u32"),vec2:new ot("vec2",st.keyword,"vec2"),vec3:new ot("vec3",st.keyword,"vec3"),vec4:new ot("vec4",st.keyword,"vec4"),bitcast:new ot("bitcast",st.keyword,"bitcast"),block:new ot("block",st.keyword,"block"),break:new ot("break",st.keyword,"break"),case:new ot("case",st.keyword,"case"),continue:new ot("continue",st.keyword,"continue"),continuing:new ot("continuing",st.keyword,"continuing"),default:new ot("default",st.keyword,"default"),diagnostic:new ot("diagnostic",st.keyword,"diagnostic"),discard:new ot("discard",st.keyword,"discard"),else:new ot("else",st.keyword,"else"),enable:new ot("enable",st.keyword,"enable"),fallthrough:new ot("fallthrough",st.keyword,"fallthrough"),false:new ot("false",st.keyword,"false"),fn:new ot("fn",st.keyword,"fn"),for:new ot("for",st.keyword,"for"),function:new ot("function",st.keyword,"function"),if:new ot("if",st.keyword,"if"),let:new ot("let",st.keyword,"let"),const:new ot("const",st.keyword,"const"),loop:new ot("loop",st.keyword,"loop"),while:new ot("while",st.keyword,"while"),private:new ot("private",st.keyword,"private"),read:new ot("read",st.keyword,"read"),read_write:new ot("read_write",st.keyword,"read_write"),return:new ot("return",st.keyword,"return"),requires:new ot("requires",st.keyword,"requires"),storage:new ot("storage",st.keyword,"storage"),switch:new ot("switch",st.keyword,"switch"),true:new ot("true",st.keyword,"true"),alias:new ot("alias",st.keyword,"alias"),type:new ot("type",st.keyword,"type"),uniform:new ot("uniform",st.keyword,"uniform"),var:new ot("var",st.keyword,"var"),override:new ot("override",st.keyword,"override"),workgroup:new ot("workgroup",st.keyword,"workgroup"),write:new ot("write",st.keyword,"write"),r8unorm:new ot("r8unorm",st.keyword,"r8unorm"),r8snorm:new ot("r8snorm",st.keyword,"r8snorm"),r8uint:new ot("r8uint",st.keyword,"r8uint"),r8sint:new ot("r8sint",st.keyword,"r8sint"),r16uint:new ot("r16uint",st.keyword,"r16uint"),r16sint:new ot("r16sint",st.keyword,"r16sint"),r16float:new ot("r16float",st.keyword,"r16float"),rg8unorm:new ot("rg8unorm",st.keyword,"rg8unorm"),rg8snorm:new ot("rg8snorm",st.keyword,"rg8snorm"),rg8uint:new ot("rg8uint",st.keyword,"rg8uint"),rg8sint:new ot("rg8sint",st.keyword,"rg8sint"),r32uint:new ot("r32uint",st.keyword,"r32uint"),r32sint:new ot("r32sint",st.keyword,"r32sint"),r32float:new ot("r32float",st.keyword,"r32float"),rg16uint:new ot("rg16uint",st.keyword,"rg16uint"),rg16sint:new ot("rg16sint",st.keyword,"rg16sint"),rg16float:new ot("rg16float",st.keyword,"rg16float"),rgba8unorm:new ot("rgba8unorm",st.keyword,"rgba8unorm"),rgba8unorm_srgb:new ot("rgba8unorm_srgb",st.keyword,"rgba8unorm_srgb"),rgba8snorm:new ot("rgba8snorm",st.keyword,"rgba8snorm"),rgba8uint:new ot("rgba8uint",st.keyword,"rgba8uint"),rgba8sint:new ot("rgba8sint",st.keyword,"rgba8sint"),bgra8unorm:new ot("bgra8unorm",st.keyword,"bgra8unorm"),bgra8unorm_srgb:new ot("bgra8unorm_srgb",st.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ot("rgb10a2unorm",st.keyword,"rgb10a2unorm"),rg11b10float:new ot("rg11b10float",st.keyword,"rg11b10float"),rg32uint:new ot("rg32uint",st.keyword,"rg32uint"),rg32sint:new ot("rg32sint",st.keyword,"rg32sint"),rg32float:new ot("rg32float",st.keyword,"rg32float"),rgba16uint:new ot("rgba16uint",st.keyword,"rgba16uint"),rgba16sint:new ot("rgba16sint",st.keyword,"rgba16sint"),rgba16float:new ot("rgba16float",st.keyword,"rgba16float"),rgba32uint:new ot("rgba32uint",st.keyword,"rgba32uint"),rgba32sint:new ot("rgba32sint",st.keyword,"rgba32sint"),rgba32float:new ot("rgba32float",st.keyword,"rgba32float"),static_assert:new ot("static_assert",st.keyword,"static_assert")};ke.tokens={decimal_float_literal:new ot("decimal_float_literal",st.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new ot("hex_float_literal",st.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new ot("int_literal",st.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ot("uint_literal",st.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new ot("ident",st.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ot("and",st.token,"&"),and_and:new ot("and_and",st.token,"&&"),arrow:new ot("arrow ",st.token,"->"),attr:new ot("attr",st.token,"@"),forward_slash:new ot("forward_slash",st.token,"/"),bang:new ot("bang",st.token,"!"),bracket_left:new ot("bracket_left",st.token,"["),bracket_right:new ot("bracket_right",st.token,"]"),brace_left:new ot("brace_left",st.token,"{"),brace_right:new ot("brace_right",st.token,"}"),colon:new ot("colon",st.token,":"),comma:new ot("comma",st.token,","),equal:new ot("equal",st.token,"="),equal_equal:new ot("equal_equal",st.token,"=="),not_equal:new ot("not_equal",st.token,"!="),greater_than:new ot("greater_than",st.token,">"),greater_than_equal:new ot("greater_than_equal",st.token,">="),shift_right:new ot("shift_right",st.token,">>"),less_than:new ot("less_than",st.token,"<"),less_than_equal:new ot("less_than_equal",st.token,"<="),shift_left:new ot("shift_left",st.token,"<<"),modulo:new ot("modulo",st.token,"%"),minus:new ot("minus",st.token,"-"),minus_minus:new ot("minus_minus",st.token,"--"),period:new ot("period",st.token,"."),plus:new ot("plus",st.token,"+"),plus_plus:new ot("plus_plus",st.token,"++"),or:new ot("or",st.token,"|"),or_or:new ot("or_or",st.token,"||"),paren_left:new ot("paren_left",st.token,"("),paren_right:new ot("paren_right",st.token,")"),semicolon:new ot("semicolon",st.token,";"),star:new ot("star",st.token,"*"),tilde:new ot("tilde",st.token,"~"),underscore:new ot("underscore",st.token,"_"),xor:new ot("xor",st.token,"^"),plus_equal:new ot("plus_equal",st.token,"+="),minus_equal:new ot("minus_equal",st.token,"-="),times_equal:new ot("times_equal",st.token,"*="),division_equal:new ot("division_equal",st.token,"/="),modulo_equal:new ot("modulo_equal",st.token,"%="),and_equal:new ot("and_equal",st.token,"&="),or_equal:new ot("or_equal",st.token,"|="),xor_equal:new ot("xor_equal",st.token,"^="),shift_right_equal:new ot("shift_right_equal",st.token,">>="),shift_left_equal:new ot("shift_left_equal",st.token,"<<=")};ke.simpleTokens={"@":gt.tokens.attr,"{":gt.tokens.brace_left,"}":gt.tokens.brace_right,":":gt.tokens.colon,",":gt.tokens.comma,"(":gt.tokens.paren_left,")":gt.tokens.paren_right,";":gt.tokens.semicolon};ke.literalTokens={"&":gt.tokens.and,"&&":gt.tokens.and_and,"->":gt.tokens.arrow,"/":gt.tokens.forward_slash,"!":gt.tokens.bang,"[":gt.tokens.bracket_left,"]":gt.tokens.bracket_right,"=":gt.tokens.equal,"==":gt.tokens.equal_equal,"!=":gt.tokens.not_equal,">":gt.tokens.greater_than,">=":gt.tokens.greater_than_equal,">>":gt.tokens.shift_right,"<":gt.tokens.less_than,"<=":gt.tokens.less_than_equal,"<<":gt.tokens.shift_left,"%":gt.tokens.modulo,"-":gt.tokens.minus,"--":gt.tokens.minus_minus,".":gt.tokens.period,"+":gt.tokens.plus,"++":gt.tokens.plus_plus,"|":gt.tokens.or,"||":gt.tokens.or_or,"*":gt.tokens.star,"~":gt.tokens.tilde,_:gt.tokens.underscore,"^":gt.tokens.xor,"+=":gt.tokens.plus_equal,"-=":gt.tokens.minus_equal,"*=":gt.tokens.times_equal,"/=":gt.tokens.division_equal,"%=":gt.tokens.modulo_equal,"&=":gt.tokens.and_equal,"|=":gt.tokens.or_equal,"^=":gt.tokens.xor_equal,">>=":gt.tokens.shift_right_equal,"<<=":gt.tokens.shift_left_equal};ke.regexTokens={decimal_float_literal:gt.tokens.decimal_float_literal,hex_float_literal:gt.tokens.hex_float_literal,int_literal:gt.tokens.int_literal,uint_literal:gt.tokens.uint_literal,ident:gt.tokens.ident};ke.storage_class=[gt.keywords.function,gt.keywords.private,gt.keywords.workgroup,gt.keywords.uniform,gt.keywords.storage];ke.access_mode=[gt.keywords.read,gt.keywords.write,gt.keywords.read_write];ke.sampler_type=[gt.keywords.sampler,gt.keywords.sampler_comparison];ke.sampled_texture_type=[gt.keywords.texture_1d,gt.keywords.texture_2d,gt.keywords.texture_2d_array,gt.keywords.texture_3d,gt.keywords.texture_cube,gt.keywords.texture_cube_array];ke.multisampled_texture_type=[gt.keywords.texture_multisampled_2d];ke.storage_texture_type=[gt.keywords.texture_storage_1d,gt.keywords.texture_storage_2d,gt.keywords.texture_storage_2d_array,gt.keywords.texture_storage_3d];ke.depth_texture_type=[gt.keywords.texture_depth_2d,gt.keywords.texture_depth_2d_array,gt.keywords.texture_depth_cube,gt.keywords.texture_depth_cube_array,gt.keywords.texture_depth_multisampled_2d];ke.texture_external_type=[gt.keywords.texture_external];ke.any_texture_type=[...gt.sampled_texture_type,...gt.multisampled_texture_type,...gt.storage_texture_type,...gt.depth_texture_type,...gt.texture_external_type];ke.texel_format=[gt.keywords.r8unorm,gt.keywords.r8snorm,gt.keywords.r8uint,gt.keywords.r8sint,gt.keywords.r16uint,gt.keywords.r16sint,gt.keywords.r16float,gt.keywords.rg8unorm,gt.keywords.rg8snorm,gt.keywords.rg8uint,gt.keywords.rg8sint,gt.keywords.r32uint,gt.keywords.r32sint,gt.keywords.r32float,gt.keywords.rg16uint,gt.keywords.rg16sint,gt.keywords.rg16float,gt.keywords.rgba8unorm,gt.keywords.rgba8unorm_srgb,gt.keywords.rgba8snorm,gt.keywords.rgba8uint,gt.keywords.rgba8sint,gt.keywords.bgra8unorm,gt.keywords.bgra8unorm_srgb,gt.keywords.rgb10a2unorm,gt.keywords.rg11b10float,gt.keywords.rg32uint,gt.keywords.rg32sint,gt.keywords.rg32float,gt.keywords.rgba16uint,gt.keywords.rgba16sint,gt.keywords.rgba16float,gt.keywords.rgba32uint,gt.keywords.rgba32sint,gt.keywords.rgba32float];ke.const_literal=[gt.tokens.int_literal,gt.tokens.uint_literal,gt.tokens.decimal_float_literal,gt.tokens.hex_float_literal,gt.keywords.true,gt.keywords.false];ke.literal_or_ident=[gt.tokens.ident,gt.tokens.int_literal,gt.tokens.uint_literal,gt.tokens.decimal_float_literal,gt.tokens.hex_float_literal];ke.element_count_expression=[gt.tokens.int_literal,gt.tokens.uint_literal,gt.tokens.ident];ke.template_types=[gt.keywords.vec2,gt.keywords.vec3,gt.keywords.vec4,gt.keywords.mat2x2,gt.keywords.mat2x3,gt.keywords.mat2x4,gt.keywords.mat3x2,gt.keywords.mat3x3,gt.keywords.mat3x4,gt.keywords.mat4x2,gt.keywords.mat4x3,gt.keywords.mat4x4,gt.keywords.atomic,gt.keywords.bitcast,...gt.any_texture_type];ke.attribute_name=[gt.tokens.ident,gt.keywords.block,gt.keywords.diagnostic];ke.assignment_operators=[gt.tokens.equal,gt.tokens.plus_equal,gt.tokens.minus_equal,gt.tokens.times_equal,gt.tokens.division_equal,gt.tokens.modulo_equal,gt.tokens.and_equal,gt.tokens.or_equal,gt.tokens.xor_equal,gt.tokens.shift_right_equal,gt.tokens.shift_left_equal];ke.increment_operators=[gt.tokens.plus_plus,gt.tokens.minus_minus];class cS{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return ke.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ke.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class nH{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new cS(ke.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const t=ke.simpleTokens[e];if(t)return this._addToken(t),!0;let n=ke.none;const i=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(i){const s=ke.keywords[e];if(s)return this._addToken(s),!0}if(i||o)return this._addToken(ke.tokens.ident),!0;for(;;){let s=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(ke.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(ke.tokens.minus_minus),!0;const f=this._tokens.length-1;if((ke.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==ke.tokens.paren_right)&&c!=">")return this._addToken(s),!0}if(e==">"&&(c==">"||c=="=")){let f=!1,_=this._tokens.length-1;for(let b=0;b<5&&_>=0&&ke.assignment_operators.indexOf(this._tokens[_].type)===-1;++b,--_)if(this._tokens[_].type===ke.tokens.less_than){_>0&&this._tokens[_-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(s),!0}if(s===ke.none){let f=e,_=0;const b=2;for(let T=0;T<b;++T)if(f+=this._peekAhead(T),s=this._findType(f),s!==ke.none){_=T;break}if(s===ke.none)return n===ke.none?!1:(this._current--,this._addToken(n),!0);e=f,this._current+=_+1}if(n=s,this._isAtEnd())break;e+=this._advance()}return n===ke.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in ke.regexTokens){const i=ke.regexTokens[n];if(this._match(e,i.rule))return i}const t=ke.literalTokens[e];return t||ke.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new cS(e,t,this._line))}}class iH{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new IV,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,o=n.countNode;if(o instanceof x2){const c=o.name,f=this._context.constants.get(c);if(f)try{const _=f.evaluate(this._context);i.count=_}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new nH(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return{token:e,message:t,toString:function(){return`${t}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ke.eof}_match(e){if(e instanceof ot)return this._check(e)?(this._advance(),!0):!1;for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;return e.indexOf(n)!=-1}return t.type==e}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ke.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ke.keywords.alias)){const t=this._type_alias();return this._consume(ke.tokens.semicolon,"Expected ';'"),t}if(this._match(ke.keywords.diagnostic)){const t=this._diagnostic();return this._consume(ke.tokens.semicolon,"Expected ';'"),t}if(this._match(ke.keywords.requires)){const t=this._requires_directive();return this._consume(ke.tokens.semicolon,"Expected ';'"),t}if(this._match(ke.keywords.enable)){const t=this._enable_directive();return this._consume(ke.tokens.semicolon,"Expected ';'"),t}const e=this._attribute();if(this._check(ke.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(ke.tokens.semicolon,"Expected ';'."),t}if(this._check(ke.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(ke.tokens.semicolon,"Expected ';'."),t}if(this._check(ke.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(ke.tokens.semicolon,"Expected ';'."),t}if(this._check(ke.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(ke.tokens.semicolon,"Expected ';'."),t}if(this._check(ke.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),t}if(this._check(ke.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(ke.keywords.fn))return null;const e=this._currentLine,t=this._consume(ke.tokens.ident,"Expected function name.").toString();this._consume(ke.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ke.tokens.paren_right))do{if(this._check(ke.tokens.paren_right))break;const c=this._attribute(),f=this._consume(ke.tokens.ident,"Expected argument name.").toString();this._consume(ke.tokens.colon,"Expected ':' for argument type.");const _=this._attribute(),b=this._type_decl();b!=null&&(b.attributes=_,n.push(new QV(f,b,c)))}while(this._match(ke.tokens.comma));this._consume(ke.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(ke.tokens.arrow)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}const o=this._compound_statement(),s=this._currentLine;return new v2(t,n,i,o,e,s)}_compound_statement(){const e=[];for(this._consume(ke.tokens.brace_left,"Expected '{' for block.");!this._check(ke.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(ke.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ke.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ke.tokens.attr)&&this._attribute(),this._check(ke.keywords.if))return this._if_statement();if(this._check(ke.keywords.switch))return this._switch_statement();if(this._check(ke.keywords.loop))return this._loop_statement();if(this._check(ke.keywords.for))return this._for_statement();if(this._check(ke.keywords.while))return this._while_statement();if(this._check(ke.keywords.continuing))return this._continuing_statement();if(this._check(ke.keywords.static_assert))return this._static_assert_statement();if(this._check(ke.tokens.brace_left))return this._compound_statement();let e=null;return this._check(ke.keywords.return)?e=this._return_statement():this._check([ke.keywords.var,ke.keywords.let,ke.keywords.const])?e=this._variable_statement():this._match(ke.keywords.discard)?e=new HV:this._match(ke.keywords.break)?e=new jV:this._match(ke.keywords.continue)?e=new $V:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(ke.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ke.keywords.static_assert))return null;const e=this._optional_paren_expression();return new MV(e)}_while_statement(){if(!this._match(ke.keywords.while))return null;const e=this._optional_paren_expression();this._check(ke.tokens.attr)&&this._attribute();const t=this._compound_statement();return new PV(e,t)}_continuing_statement(){if(!this._match(ke.keywords.continuing))return null;const e=this._compound_statement();return new RV(e)}_for_statement(){if(!this._match(ke.keywords.for))return null;this._consume(ke.tokens.paren_left,"Expected '('.");const e=this._check(ke.tokens.semicolon)?null:this._for_init();this._consume(ke.tokens.semicolon,"Expected ';'.");const t=this._check(ke.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ke.tokens.semicolon,"Expected ';'.");const n=this._check(ke.tokens.paren_right)?null:this._for_increment();this._consume(ke.tokens.paren_right,"Expected ')'."),this._check(ke.tokens.attr)&&this._attribute();const i=this._compound_statement();return new FV(e,t,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ke.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ke.tokens.equal)&&(t=this._short_circuit_or_expression()),new Nf(e.name,e.type,e.storage,e.access,t)}if(this._match(ke.keywords.let)){const e=this._consume(ke.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(ke.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(ke.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new b2(e,t,null,null,n)}if(this._match(ke.keywords.const)){const e=this._consume(ke.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(ke.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(ke.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new nS(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(ke.increment_operators))return this._current=e,null;const n=this._consume(ke.increment_operators,"Expected increment operator");return new OV(n.type===ke.tokens.plus_plus?gA.increment:gA.decrement,t)}_assignment_statement(){let e=null;if(this._check(ke.tokens.brace_right))return null;let t=this._match(ke.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const n=this._consume(ke.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new DV(sg.parse(n.lexeme),e,i)}_func_call_statement(){if(!this._check(ke.tokens.ident))return null;const e=this._current,t=this._consume(ke.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new jD(t.lexeme,n)}_loop_statement(){if(!this._match(ke.keywords.loop))return null;this._check(ke.tokens.attr)&&this._attribute(),this._consume(ke.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.push(i);else e.push(t);t=this._statement()}let n=null;return this._match(ke.keywords.continuing)&&(n=this._compound_statement()),this._consume(ke.tokens.brace_right,"Expected '}' for loop."),new LV(e,n)}_switch_statement(){if(!this._match(ke.keywords.switch))return null;const e=this._optional_paren_expression();this._check(ke.tokens.attr)&&this._attribute(),this._consume(ke.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(t==null||t.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ke.tokens.brace_right,"Expected '}' for switch."),new kV(e,t)}_switch_body(){const e=[];if(this._match(ke.keywords.case)){const t=this._case_selectors();this._match(ke.tokens.colon),this._check(ke.tokens.attr)&&this._attribute(),this._consume(ke.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(ke.tokens.brace_right,"Exected '}' for switch case."),e.push(new qV(t,n))}if(this._match(ke.keywords.default)){this._match(ke.tokens.colon),this._check(ke.tokens.attr)&&this._attribute(),this._consume(ke.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(ke.tokens.brace_right,"Exected '}' for switch default."),e.push(new ZV(t))}if(this._check([ke.keywords.default,ke.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(ke.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(ke.keywords.fallthrough))return this._consume(ke.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(ke.keywords.if))return null;const e=this._optional_paren_expression();this._check(ke.tokens.attr)&&this._attribute();const t=this._compound_statement();let n=[];this._match_elseif()&&(this._check(ke.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let i=null;return this._match(ke.keywords.else)&&(this._check(ke.tokens.attr)&&this._attribute(),i=this._compound_statement()),new NV(e,t,n,i)}_match_elseif(){return this._tokens[this._current].type===ke.keywords.else&&this._tokens[this._current+1].type===ke.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new eH(t,n)),this._match_elseif()&&(this._check(ke.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ke.keywords.return))return null;const e=this._short_circuit_or_expression();return new UV(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ke.tokens.or_or);)e=new Hc(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ke.tokens.and_and);)e=new Hc(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ke.tokens.or);)e=new Hc(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ke.tokens.xor);)e=new Hc(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(ke.tokens.and);)e=new Hc(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([ke.tokens.equal_equal,ke.tokens.not_equal])?new Hc(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ke.tokens.less_than,ke.tokens.greater_than,ke.tokens.less_than_equal,ke.tokens.greater_than_equal]);)e=new Hc(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ke.tokens.shift_left,ke.tokens.shift_right]);)e=new Hc(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ke.tokens.plus,ke.tokens.minus]);)e=new Hc(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ke.tokens.star,ke.tokens.forward_slash,ke.tokens.modulo]);)e=new Hc(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([ke.tokens.minus,ke.tokens.bang,ke.tokens.tilde,ke.tokens.star,ke.tokens.and])?new YV(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ke.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ke.tokens.bracket_right,"Expected ']'.");const t=new KV(e),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(ke.tokens.period)){const e=this._consume(ke.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new iS(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(ke.tokens.ident)){const n=this._previous().toString();if(this._check(ke.tokens.paren_left)){const i=this._argument_expression_list(),o=this._getStruct(n);return o!=null?new jd(o,i):new XD(n,i)}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return new sS(n,i.value)}return new x2(n)}if(this._match(ke.const_literal))return new oS(parseFloat(this._previous().toString()));if(this._check(ke.tokens.paren_left))return this._paren_expression();if(this._match(ke.keywords.bitcast)){this._consume(ke.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ke.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new JV(n,i)}const e=this._type_decl(),t=this._argument_expression_list();return new XV(e,t)}_argument_expression_list(){if(!this._match(ke.tokens.paren_left))return null;const e=[];do{if(this._check(ke.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ke.tokens.comma));return this._consume(ke.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ke.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ke.tokens.paren_right),new aS([e])}_paren_expression(){this._consume(ke.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ke.tokens.paren_right,"Expected ')'."),new aS([e])}_struct_decl(){if(!this._match(ke.keywords.struct))return null;const e=this._currentLine,t=this._consume(ke.tokens.ident,"Expected name for struct.").toString();this._consume(ke.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ke.tokens.brace_right);){const s=this._attribute(),c=this._consume(ke.tokens.ident,"Expected variable name.").toString();this._consume(ke.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),_=this._type_decl();_!=null&&(_.attributes=f),this._check(ke.tokens.brace_right)?this._match(ke.tokens.comma):this._consume(ke.tokens.comma,"Expected ',' for struct member."),n.push(new tH(c,_,s))}this._consume(ke.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,o=new kf(t,n,e,i);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(ke.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ke.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(ke.keywords.const))return null;const e=this._consume(ke.tokens.ident,"Expected variable name");let t=null;if(this._match(ke.tokens.colon)){const o=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=o)}let n=null;if(this._match(ke.tokens.equal)){const o=this._short_circuit_or_expression();if(o instanceof jd)n=o;else if(o instanceof sS&&o.initializer instanceof jd)n=o.initializer;else try{const s=o.evaluate(this._context);n=new oS(s)}catch{n=o}}const i=new nS(e.toString(),t,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(ke.keywords.let))return null;const e=this._consume(ke.tokens.ident,"Expected variable name");let t=null;if(this._match(ke.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}let n=null;return this._match(ke.tokens.equal)&&(n=this._const_expression()),new b2(e.toString(),t,"","",n)}_const_expression(){if(this._match(ke.const_literal))return new iS(this._previous().toString());const e=this._type_decl();this._consume(ke.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(ke.tokens.paren_right)&&(t.push(this._const_expression()),!!this._check(ke.tokens.comma));)this._advance();return this._consume(ke.tokens.paren_right,"Expected ')'."),new jd(e,t)}_variable_decl(){if(!this._match(ke.keywords.var))return null;let e="",t="";this._match(ke.tokens.less_than)&&(e=this._consume(ke.storage_class,"Expected storage_class.").toString(),this._match(ke.tokens.comma)&&(t=this._consume(ke.access_mode,"Expected access_mode.").toString()),this._consume(ke.tokens.greater_than,"Expected '>'."));const n=this._consume(ke.tokens.ident,"Expected variable name");let i=null;if(this._match(ke.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}return new Nf(n.toString(),i,e,t,null)}_override_decl(){if(!this._match(ke.keywords.override))return null;const e=this._consume(ke.tokens.ident,"Expected variable name");let t=null;if(this._match(ke.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return new HD(e.toString(),t,null)}_diagnostic(){this._consume(ke.tokens.paren_left,"Expected '('");const e=this._consume(ke.tokens.ident,"Expected severity control name.");this._consume(ke.tokens.comma,"Expected ','");const t=this._consume(ke.tokens.ident,"Expected diagnostic rule name.");return this._consume(ke.tokens.paren_right,"Expected ')'"),new VV(e.toString(),t.toString())}_enable_directive(){const e=this._consume(ke.tokens.ident,"identity expected.");return new zV(e.toString())}_requires_directive(){const e=[this._consume(ke.tokens.ident,"identity expected.").toString()];for(;this._match(ke.tokens.comma);){const t=this._consume(ke.tokens.ident,"identity expected.");e.push(t.toString())}return new GV(e)}_type_alias(){const e=this._consume(ke.tokens.ident,"identity expected.");this._consume(ke.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new $D(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ke.tokens.ident,...ke.texel_format,ke.keywords.bool,ke.keywords.f32,ke.keywords.i32,ke.keywords.u32])){const n=this._advance(),i=n.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new ch(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(ke.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(ke.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(ke.tokens.comma)&&(o=this._consume(ke.access_mode,"Expected access_mode for pointer").toString()),this._consume(ke.tokens.greater_than,"Expected '>' for type.")),new WD(n,i,o)}if(this._match(ke.keywords.ptr)){let n=this._previous().toString();this._consume(ke.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(ke.storage_class,"Expected storage_class for pointer");this._consume(ke.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(ke.tokens.comma)&&(s=this._consume(ke.access_mode,"Expected access_mode for pointer").toString()),this._consume(ke.tokens.greater_than,"Expected '>' for pointer."),new WV(n,i.toString(),o,s)}const t=this._attribute();if(this._match(ke.keywords.array)){let n=null,i=-1;const o=this._previous();let s=null;if(this._match(ke.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let f="";if(this._match(ke.tokens.comma)){s=this._shift_expression();try{f=s.evaluate(this._context).toString(),s=null}catch{f="1"}}this._consume(ke.tokens.greater_than,"Expected '>' for array."),i=f?parseInt(f):0}const c=new JD(o.toString(),t,n,i);return s&&this._deferArrayCountEval.push({arrayType:c,countNode:s}),c}return null}_texture_sampler_types(){if(this._match(ke.sampler_type))return new Pp(this._previous().toString(),null,null);if(this._match(ke.depth_texture_type))return new Pp(this._previous().toString(),null,null);if(this._match(ke.sampled_texture_type)||this._match(ke.multisampled_texture_type)){const e=this._previous();this._consume(ke.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ke.tokens.greater_than,"Expected '>' for sampler type."),new Pp(e.toString(),t,null)}if(this._match(ke.storage_texture_type)){const e=this._previous();this._consume(ke.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ke.texel_format,"Invalid texel format.").toString();this._consume(ke.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ke.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ke.tokens.greater_than,"Expected '>' for sampler type."),new Pp(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(ke.tokens.attr);){const t=this._consume(ke.attribute_name,"Expected attribute name"),n=new rH(t.toString(),null);if(this._match(ke.tokens.paren_left)){if(n.value=this._consume(ke.literal_or_ident,"Expected attribute value").toString(),this._check(ke.tokens.comma)){this._advance();do{const i=this._consume(ke.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(ke.tokens.comma))}this._consume(ke.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class nA{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class lS{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class B0 extends nA{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class qv extends nA{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class uS extends nA{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}}var Mu;(function(r){r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(Mu||(Mu={}));class S0{constructor(e,t,n,i,o,s,c){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class sH{constructor(e,t){this.name=e,this.type=t}}class I0{constructor(e,t){this.align=e,this.size=t}}class oH{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class fS{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class aH{constructor(e,t=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t}}class cH{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class lH{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class uH{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Dl{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new cH,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new iH().parse(e);for(const i of n)i instanceof v2&&this._functions.set(i.name,new uH(i));for(const i of n)if(i instanceof kf){const o=this._getTypeInfo(i,null);o instanceof B0&&this.structs.push(o)}for(const i of n){if(i instanceof $D){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof HD){const o=i,s=this._getAttributeNum(o.attributes,"id",0),c=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new lH(o.name,c,o.attributes,s));continue}if(this._isUniformVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),_=new S0(o.name,f,s,c,o.attributes,Mu.Uniform,o.access);this.uniforms.push(_);continue}if(this._isStorageVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),_=this._isStorageTexture(f),b=new S0(o.name,f,s,c,o.attributes,_?Mu.StorageTexture:Mu.Storage,o.access);this.storage.push(b);continue}if(this._isTextureVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),_=this._isStorageTexture(f),b=new S0(o.name,f,s,c,o.attributes,_?Mu.StorageTexture:Mu.Texture,o.access);_?this.storage.push(b):this.textures.push(b);continue}if(this._isSamplerVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),c=this._getAttributeNum(o.attributes,"binding",0),f=this._getTypeInfo(o.type,o.attributes),_=new S0(o.name,f,s,c,o.attributes,Mu.Sampler,o.access);this.samplers.push(_);continue}if(i instanceof v2){const o=this._getAttribute(i,"vertex"),s=this._getAttribute(i,"fragment"),c=this._getAttribute(i,"compute"),f=o||s||c,_=new aH(i.name,f==null?void 0:f.name);_.startLine=i.startLine,_.endLine=i.endLine,this.functions.push(_),this._functions.get(i.name).info=_,f&&(this._functions.get(i.name).inUse=!0,_.inUse=!0,_.resources=this._findResources(i,!!f),_.inputs=this._getInputs(i.args),_.outputs=this._getOutputs(i.returnType),this.entry[f.name].push(_));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&t.add(o)}}findResource(e,t){for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this._getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,o=[];return e.search(s=>{if(s instanceof i_)o.push({});else if(s instanceof s_)o.pop();else if(s instanceof Nf){const c=s;t&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(s instanceof jd){const c=s;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(s instanceof b2){const c=s;t&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(s instanceof x2){const c=s;if(o.length>0&&o[o.length-1][c.name])return;const f=i._findResource(c.name);f&&n.push(f)}else if(s instanceof XD){const c=s,f=i._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,t)),n.push(...f.resources))}else if(s instanceof jD){const c=s,f=i._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,t)),n.push(...f.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function t(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.storage){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.textures){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.samplers){t(n.group,n.binding);const i=e[n.group];i[n.binding]=n}return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof kf)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof kf)this._getStructOutputs(n.type,t);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const o=this._getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),c=new fS(n.name,o,i.name,s);t.push(c)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new fS("",n,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof kf)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof kf)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),s=new oH(e.name,i,t.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new sH(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof JD){const i=e,o=this._getTypeInfo(i.format,i.attributes),s=new qv(i.name,t);return s.format=o,s.count=i.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof kf){const i=e,o=new B0(i.name,t);o.startLine=i.startLine,o.endLine=i.endLine;for(const s of i.members){const c=this._getTypeInfo(s.type,s.attributes);o.members.push(new lS(s.name,c,s.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Pp){const i=e,o=i.format instanceof ch,s=i.format?o?this._getTypeInfo(i.format,null):new nA(i.format,null):null,c=new uS(i.name,s,t,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof WD){const i=e,o=i.format?this._getTypeInfo(i.format,null):null,s=new uS(i.name,o,t,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new nA(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const i=this._getTypeSize(e);if(e.size=(t=i==null?void 0:i.size)!==null&&t!==void 0?t:0,e instanceof qv){const o=this._getTypeSize(e.format);e.stride=(n=o==null?void 0:o.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof B0&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,o=0,s=0;for(let c=0,f=e.members.length;c<f;++c){const _=e.members[c],b=this._getTypeSize(_);if(!b)continue;(t=this._getAlias(_.type.name))!==null&&t!==void 0||_.type;const T=b.align,S=b.size;n=this._roundUp(T,n+i),i=S,o=n,s=Math.max(s,T),_.offset=n,_.size=S,this._updateTypeInfo(_.type)}e.size=this._roundUp(s,o+i),e.align=s}_getTypeSize(e){var t,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof lS&&(e=e.type),e instanceof nA){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=Dl._typeInfo[e.name];if(s!==void 0){const c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new I0(Math.max(o,s.align/c),Math.max(i,s.size/c))}}{const s=Dl._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const c=e.name[e.name.length-1]==="h"?2:1;return new I0(Math.max(o,s.align/c),Math.max(i,s.size/c))}}if(e instanceof qv){let s=e,c=8,f=8;const _=this._getTypeSize(s.format);_!==null&&(f=_.size,c=_.align);const b=s.count,T=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(c,f));return f=b*T,i&&(f=i),new I0(Math.max(o,c),Math.max(i,f))}if(e instanceof B0){let s=0,c=0,f=0,_=0,b=0;for(const T of e.members){const S=this._getTypeSize(T.type);S!==null&&(s=Math.max(S.align,s),f=this._roundUp(S.align,f+_),_=S.size,b=f)}return c=this._roundUp(s,b+_),new I0(Math.max(o,s),Math.max(i,c))}return null}_isUniformVar(e){return e instanceof Nf&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Nf&&e.storage=="storage"}_isTextureVar(e){return e instanceof Nf&&e.type!==null&&Dl._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Nf&&e.type!==null&&Dl._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let o of i)if(o.name==t)return o;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let i of e)if(i.name==t){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Dl._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Dl._textureTypes=ke.any_texture_type.map(r=>r.name);Dl._samplerTypes=ke.sampler_type.map(r=>r.name);function fH(r){var o;const e={attributes:[],bindings:[]};let t;try{t=hH(r)}catch(s){return Yt.error(s.message)(),e}for(const s of t.uniforms){const c=[];for(const f of((o=s.type)==null?void 0:o.members)||[])c.push({name:f.name,type:hS(f.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:c})}for(const s of t.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of t.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const n=t.entry.vertex[0],i=(n==null?void 0:n.inputs.length)||0;for(let s=0;s<i;s++){const c=n.inputs[s];if(c.locationType==="location"){const f=hS(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:f})}}return e}function hS(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function hH(r){try{return new Dl(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const dH=1/Math.PI*180,AH=1/180*Math.PI,pH={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...pH}};const ms=globalThis.mathgl.config;function gH(r,{precision:e=ms.precision}={}){return r=vH(r),`${parseFloat(r.toPrecision(e))}`}function Gu(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function mH(r){return yH(r)}function _H(r){return nc(r)}function yH(r,e){return gw(r,t=>t*AH,e)}function nc(r,e){return gw(r,t=>t*dH,e)}function Ll(r,e,t){return gw(r,n=>Math.max(e,Math.min(t,n)))}function dc(r,e,t){return Gu(r)?r.map((n,i)=>dc(n,e[i],t)):t*e+(1-t)*r}function aa(r,e,t){const n=ms.EPSILON;t&&(ms.EPSILON=t);try{if(r===e)return!0;if(Gu(r)&&Gu(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!aa(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=ms.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{ms.EPSILON=n}}function vH(r){return Math.round(r/ms.EPSILON)*ms.EPSILON}function bH(r){return r.clone?r.clone():new Array(r.length)}function gw(r,e,t){if(Gu(r)){const n=r;t=t||bH(n);for(let i=0;i<t.length&&i<n.length;++i){const o=typeof r=="number"?r:r[i];t[i]=e(o,i,t)}return t}return e(r)}class mw extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Gu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ms)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+gH(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!aa(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const o=e[i],s=typeof t=="number"?t:t[i];this[i]=o+n*(s-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=t[n];return this.check()}subtract(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=t[n];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ms.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function xH(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function jn(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Vp(r,e,t=""){if(ms.debug&&!xH(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function sc(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class _w extends mw{get x(){return this[0]}set x(e){this[0]=jn(e)}get y(){return this[1]}set y(e){this[1]=jn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return jn(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return jn(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=t[n];return this.check()}divide(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return sc(e>=0&&e<this.ELEMENTS,"index is out of range"),jn(this[e])}setComponent(e,t){return sc(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Hp=1e-6;let pc=typeof Float32Array<"u"?Float32Array:Array;function wH(){const r=new pc(2);return pc!=Float32Array&&(r[0]=0,r[1]=0),r}function dS(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function CH(r,e){return r[0]=-e[0],r[1]=-e[1],r}function qD(r,e,t,n){const i=e[0],o=e[1];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r}function EH(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}function TH(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r}function ZD(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}function QD(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=wH();return function(e,t,n,i,o,s){let c,f;for(t||(t=2),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],o(r,r,s),e[c]=r[0],e[c+1]=r[1];return e}})();function e6(r,e,t){const n=e[0],i=e[1],o=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/o,r[1]=(t[1]*n+t[5]*i)/o,r}function t6(r,e,t){const n=e[0],i=e[1],o=e[2],s=t[3]*n+t[7]*i+t[11]*o||1;return r[0]=(t[0]*n+t[4]*i+t[8]*o)/s,r[1]=(t[1]*n+t[5]*i+t[9]*o)/s,r[2]=(t[2]*n+t[6]*i+t[10]*o)/s,r}function BH(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function SH(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function r6(r,e,t){const n=e[0],i=e[1],o=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*o,r[1]=t[1]*n+t[4]*i+t[7]*o,r[2]=t[2]*n+t[5]*i+t[8]*o,r[3]=e[3],r}class yw extends _w{constructor(e=0,t=0){super(2),Gu(e)&&arguments.length===1?this.copy(e):(ms.debug&&(jn(e),jn(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return ms.debug&&(jn(e.x),jn(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return QD(this,this,e),this.check()}transformAsVector(e){return e6(this,this,e),this.check()}transformByMatrix3(e){return ZD(this,this,e),this.check()}transformByMatrix2x3(e){return TH(this,this,e),this.check()}transformByMatrix2(e){return EH(this,this,e),this.check()}}function n6(){const r=new pc(3);return pc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function i6(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function AS(r,e,t){const n=new pc(3);return n[0]=r,n[1]=e,n[2]=t,n}function IH(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function MH(r){const e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function PH(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function RH(r,e){const t=e[0],n=e[1],i=e[2];let o=t*t+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r}function vw(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Cm(r,e,t){const n=e[0],i=e[1],o=e[2],s=t[0],c=t[1],f=t[2];return r[0]=i*f-o*c,r[1]=o*s-n*f,r[2]=n*c-i*s,r}function FH(r,e,t,n){const i=e[0],o=e[1],s=e[2];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r[2]=s+n*(t[2]-s),r}function bw(r,e,t){const n=e[0],i=e[1],o=e[2];let s=t[3]*n+t[7]*i+t[11]*o+t[15];return s=s||1,r[0]=(t[0]*n+t[4]*i+t[8]*o+t[12])/s,r[1]=(t[1]*n+t[5]*i+t[9]*o+t[13])/s,r[2]=(t[2]*n+t[6]*i+t[10]*o+t[14])/s,r}function s6(r,e,t){const n=e[0],i=e[1],o=e[2];return r[0]=n*t[0]+i*t[3]+o*t[6],r[1]=n*t[1]+i*t[4]+o*t[7],r[2]=n*t[2]+i*t[5]+o*t[8],r}function o6(r,e,t){const n=t[0],i=t[1],o=t[2],s=t[3],c=e[0],f=e[1],_=e[2];let b=i*_-o*f,T=o*c-n*_,S=n*f-i*c,D=i*S-o*T,N=o*b-n*S,G=n*T-i*b;const W=s*2;return b*=W,T*=W,S*=W,D*=2,N*=2,G*=2,r[0]=c+b+D,r[1]=f+T+N,r[2]=_+S+G,r}function OH(r,e,t,n){const i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function DH(r,e,t,n){const i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function LH(r,e,t,n){const i=[],o=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function kH(r,e){const t=r[0],n=r[1],i=r[2],o=e[0],s=e[1],c=e[2],f=Math.sqrt((t*t+n*n+i*i)*(o*o+s*s+c*c)),_=f&&vw(r,e)/f;return Math.acos(Math.min(Math.max(_,-1),1))}const a6=IH,c6=i6,Zv=MH;(function(){const r=n6();return function(e,t,n,i,o,s){let c,f;for(t||(t=3),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2];return e}})();const Qv=[0,0,0];let M0;class ft extends _w{static get ZERO(){return M0||(M0=new ft(0,0,0),Object.freeze(M0)),M0}constructor(e=0,t=0,n=0){super(-0,-0,-0),arguments.length===1&&Gu(e)?this.copy(e):(ms.debug&&(jn(e),jn(t),jn(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ms.debug&&(jn(e.x),jn(e.y),jn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=jn(e)}angle(e){return kH(this,e)}cross(e){return Cm(this,this,e),this.check()}rotateX({radians:e,origin:t=Qv}){return OH(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Qv}){return DH(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Qv}){return LH(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return bw(this,this,e),this.check()}transformAsVector(e){return t6(this,this,e),this.check()}transformByMatrix3(e){return s6(this,this,e),this.check()}transformByMatrix2(e){return BH(this,this,e),this.check()}transformByQuaternion(e){return o6(this,this,e),this.check()}}let P0;class xw extends _w{static get ZERO(){return P0||(P0=new xw(0,0,0,0),Object.freeze(P0)),P0}constructor(e=0,t=0,n=0,i=0){super(-0,-0,-0,-0),Gu(e)&&arguments.length===1?this.copy(e):(ms.debug&&(jn(e),jn(t),jn(n),jn(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ms.debug&&(jn(e.x),jn(e.y),jn(e.z),jn(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=jn(e)}get w(){return this[3]}set w(e){this[3]=jn(e)}transform(e){return bw(this,this,e),this.check()}transformByMatrix3(e){return r6(this,this,e),this.check()}transformByMatrix2(e){return SH(this,this,e),this.check()}transformByQuaternion(e){return o6(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class l6 extends mw{toString(){let e="[";if(ms.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=jn(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function NH(){const r=new pc(9);return pc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function UH(r,e){if(r===e){const t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function zH(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],c=e[5],f=e[6],_=e[7],b=e[8],T=b*s-c*_,S=-b*o+c*f,D=_*o-s*f;let N=t*T+n*S+i*D;return N?(N=1/N,r[0]=T*N,r[1]=(-b*n+i*_)*N,r[2]=(c*n-i*s)*N,r[3]=S*N,r[4]=(b*t-i*f)*N,r[5]=(-c*t+i*o)*N,r[6]=D*N,r[7]=(-_*t+n*f)*N,r[8]=(s*t-n*o)*N,r):null}function GH(r){const e=r[0],t=r[1],n=r[2],i=r[3],o=r[4],s=r[5],c=r[6],f=r[7],_=r[8];return e*(_*o-s*f)+t*(-_*i+s*c)+n*(f*i-o*c)}function pS(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],_=e[6],b=e[7],T=e[8],S=t[0],D=t[1],N=t[2],G=t[3],W=t[4],z=t[5],j=t[6],K=t[7],fe=t[8];return r[0]=S*n+D*s+N*_,r[1]=S*i+D*c+N*b,r[2]=S*o+D*f+N*T,r[3]=G*n+W*s+z*_,r[4]=G*i+W*c+z*b,r[5]=G*o+W*f+z*T,r[6]=j*n+K*s+fe*_,r[7]=j*i+K*c+fe*b,r[8]=j*o+K*f+fe*T,r}function VH(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],_=e[6],b=e[7],T=e[8],S=t[0],D=t[1];return r[0]=n,r[1]=i,r[2]=o,r[3]=s,r[4]=c,r[5]=f,r[6]=S*n+D*s+_,r[7]=S*i+D*c+b,r[8]=S*o+D*f+T,r}function HH(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],_=e[6],b=e[7],T=e[8],S=Math.sin(t),D=Math.cos(t);return r[0]=D*n+S*s,r[1]=D*i+S*c,r[2]=D*o+S*f,r[3]=D*s-S*n,r[4]=D*c-S*i,r[5]=D*f-S*o,r[6]=_,r[7]=b,r[8]=T,r}function gS(r,e,t){const n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function jH(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=t+t,c=n+n,f=i+i,_=t*s,b=n*s,T=n*c,S=i*s,D=i*c,N=i*f,G=o*s,W=o*c,z=o*f;return r[0]=1-T-N,r[3]=b-z,r[6]=S+W,r[1]=b+z,r[4]=1-_-N,r[7]=D-G,r[2]=S-W,r[5]=D+G,r[8]=1-_-T,r}var w2;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(w2||(w2={}));const $H=Object.freeze([1,0,0,0,1,0,0,0,1]);class ci extends l6{static get IDENTITY(){return JH()}static get ZERO(){return WH()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return w2}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy($H)}fromObject(e){return this.check()}fromQuaternion(e){return jH(this,e),this.check()}set(e,t,n,i,o,s,c,f,_){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=c,this[7]=f,this[8]=_,this.check()}setRowMajor(e,t,n,i,o,s,c,f,_){return this[0]=e,this[1]=i,this[2]=c,this[3]=t,this[4]=o,this[5]=f,this[6]=n,this[7]=s,this[8]=_,this.check()}determinant(){return GH(this)}transpose(){return UH(this,this),this.check()}invert(){return zH(this,this),this.check()}multiplyLeft(e){return pS(this,e,this),this.check()}multiplyRight(e){return pS(this,this,e),this.check()}rotate(e){return HH(this,this,e),this.check()}scale(e){return Array.isArray(e)?gS(this,this,e):gS(this,this,[e,e]),this.check()}translate(e){return VH(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=ZD(t||[-0,-0],e,this);break;case 3:n=s6(t||[-0,-0,-0],e,this);break;case 4:n=r6(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vp(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let R0,F0=null;function WH(){return R0||(R0=new ci([0,0,0,0,0,0,0,0,0]),Object.freeze(R0)),R0}function JH(){return F0||(F0=new ci,Object.freeze(F0)),F0}function XH(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function KH(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],o=e[6],s=e[7],c=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=o,r[11]=e[14],r[12]=i,r[13]=s,r[14]=c}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function C2(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],c=e[5],f=e[6],_=e[7],b=e[8],T=e[9],S=e[10],D=e[11],N=e[12],G=e[13],W=e[14],z=e[15],j=t*c-n*s,K=t*f-i*s,fe=t*_-o*s,Z=n*f-i*c,ae=n*_-o*c,Be=i*_-o*f,Le=b*G-T*N,de=b*W-S*N,_e=b*z-D*N,pe=T*W-S*G,J=T*z-D*G,ne=S*z-D*W;let ye=j*ne-K*J+fe*pe+Z*_e-ae*de+Be*Le;return ye?(ye=1/ye,r[0]=(c*ne-f*J+_*pe)*ye,r[1]=(i*J-n*ne-o*pe)*ye,r[2]=(G*Be-W*ae+z*Z)*ye,r[3]=(S*ae-T*Be-D*Z)*ye,r[4]=(f*_e-s*ne-_*de)*ye,r[5]=(t*ne-i*_e+o*de)*ye,r[6]=(W*fe-N*Be-z*K)*ye,r[7]=(b*Be-S*fe+D*K)*ye,r[8]=(s*J-c*_e+_*Le)*ye,r[9]=(n*_e-t*J-o*Le)*ye,r[10]=(N*ae-G*fe+z*j)*ye,r[11]=(T*fe-b*ae-D*j)*ye,r[12]=(c*de-s*pe-f*Le)*ye,r[13]=(t*pe-n*de+i*Le)*ye,r[14]=(G*K-N*Z-W*j)*ye,r[15]=(b*Z-T*K+S*j)*ye,r):null}function YH(r){const e=r[0],t=r[1],n=r[2],i=r[3],o=r[4],s=r[5],c=r[6],f=r[7],_=r[8],b=r[9],T=r[10],S=r[11],D=r[12],N=r[13],G=r[14],W=r[15],z=e*s-t*o,j=e*c-n*o,K=t*c-n*s,fe=_*N-b*D,Z=_*G-T*D,ae=b*G-T*N,Be=e*ae-t*Z+n*fe,Le=o*ae-s*Z+c*fe,de=_*K-b*j+T*z,_e=D*K-N*j+G*z;return f*Be-i*Le+W*de-S*_e}function Jf(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],_=e[6],b=e[7],T=e[8],S=e[9],D=e[10],N=e[11],G=e[12],W=e[13],z=e[14],j=e[15];let K=t[0],fe=t[1],Z=t[2],ae=t[3];return r[0]=K*n+fe*c+Z*T+ae*G,r[1]=K*i+fe*f+Z*S+ae*W,r[2]=K*o+fe*_+Z*D+ae*z,r[3]=K*s+fe*b+Z*N+ae*j,K=t[4],fe=t[5],Z=t[6],ae=t[7],r[4]=K*n+fe*c+Z*T+ae*G,r[5]=K*i+fe*f+Z*S+ae*W,r[6]=K*o+fe*_+Z*D+ae*z,r[7]=K*s+fe*b+Z*N+ae*j,K=t[8],fe=t[9],Z=t[10],ae=t[11],r[8]=K*n+fe*c+Z*T+ae*G,r[9]=K*i+fe*f+Z*S+ae*W,r[10]=K*o+fe*_+Z*D+ae*z,r[11]=K*s+fe*b+Z*N+ae*j,K=t[12],fe=t[13],Z=t[14],ae=t[15],r[12]=K*n+fe*c+Z*T+ae*G,r[13]=K*i+fe*f+Z*S+ae*W,r[14]=K*o+fe*_+Z*D+ae*z,r[15]=K*s+fe*b+Z*N+ae*j,r}function o_(r,e,t){const n=t[0],i=t[1],o=t[2];let s,c,f,_,b,T,S,D,N,G,W,z;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*o+e[12],r[13]=e[1]*n+e[5]*i+e[9]*o+e[13],r[14]=e[2]*n+e[6]*i+e[10]*o+e[14],r[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],c=e[1],f=e[2],_=e[3],b=e[4],T=e[5],S=e[6],D=e[7],N=e[8],G=e[9],W=e[10],z=e[11],r[0]=s,r[1]=c,r[2]=f,r[3]=_,r[4]=b,r[5]=T,r[6]=S,r[7]=D,r[8]=N,r[9]=G,r[10]=W,r[11]=z,r[12]=s*n+b*i+N*o+e[12],r[13]=c*n+T*i+G*o+e[13],r[14]=f*n+S*i+W*o+e[14],r[15]=_*n+D*i+z*o+e[15]),r}function ww(r,e,t){const n=t[0],i=t[1],o=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*o,r[9]=e[9]*o,r[10]=e[10]*o,r[11]=e[11]*o,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function qH(r,e,t,n){let i=n[0],o=n[1],s=n[2],c=Math.sqrt(i*i+o*o+s*s),f,_,b,T,S,D,N,G,W,z,j,K,fe,Z,ae,Be,Le,de,_e,pe,J,ne,ye,Ye;return c<Hp?null:(c=1/c,i*=c,o*=c,s*=c,_=Math.sin(t),f=Math.cos(t),b=1-f,T=e[0],S=e[1],D=e[2],N=e[3],G=e[4],W=e[5],z=e[6],j=e[7],K=e[8],fe=e[9],Z=e[10],ae=e[11],Be=i*i*b+f,Le=o*i*b+s*_,de=s*i*b-o*_,_e=i*o*b-s*_,pe=o*o*b+f,J=s*o*b+i*_,ne=i*s*b+o*_,ye=o*s*b-i*_,Ye=s*s*b+f,r[0]=T*Be+G*Le+K*de,r[1]=S*Be+W*Le+fe*de,r[2]=D*Be+z*Le+Z*de,r[3]=N*Be+j*Le+ae*de,r[4]=T*_e+G*pe+K*J,r[5]=S*_e+W*pe+fe*J,r[6]=D*_e+z*pe+Z*J,r[7]=N*_e+j*pe+ae*J,r[8]=T*ne+G*ye+K*Ye,r[9]=S*ne+W*ye+fe*Ye,r[10]=D*ne+z*ye+Z*Ye,r[11]=N*ne+j*ye+ae*Ye,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function u6(r,e,t){const n=Math.sin(t),i=Math.cos(t),o=e[4],s=e[5],c=e[6],f=e[7],_=e[8],b=e[9],T=e[10],S=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=o*i+_*n,r[5]=s*i+b*n,r[6]=c*i+T*n,r[7]=f*i+S*n,r[8]=_*i-o*n,r[9]=b*i-s*n,r[10]=T*i-c*n,r[11]=S*i-f*n,r}function ZH(r,e,t){const n=Math.sin(t),i=Math.cos(t),o=e[0],s=e[1],c=e[2],f=e[3],_=e[8],b=e[9],T=e[10],S=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*i-_*n,r[1]=s*i-b*n,r[2]=c*i-T*n,r[3]=f*i-S*n,r[8]=o*n+_*i,r[9]=s*n+b*i,r[10]=c*n+T*i,r[11]=f*n+S*i,r}function f6(r,e,t){const n=Math.sin(t),i=Math.cos(t),o=e[0],s=e[1],c=e[2],f=e[3],_=e[4],b=e[5],T=e[6],S=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*i+_*n,r[1]=s*i+b*n,r[2]=c*i+T*n,r[3]=f*i+S*n,r[4]=_*i-o*n,r[5]=b*i-s*n,r[6]=T*i-c*n,r[7]=S*i-f*n,r}function QH(r,e){const t=e[0],n=e[1],i=e[2],o=e[4],s=e[5],c=e[6],f=e[8],_=e[9],b=e[10];return r[0]=Math.sqrt(t*t+n*n+i*i),r[1]=Math.sqrt(o*o+s*s+c*c),r[2]=Math.sqrt(f*f+_*_+b*b),r}function ej(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=t+t,c=n+n,f=i+i,_=t*s,b=n*s,T=n*c,S=i*s,D=i*c,N=i*f,G=o*s,W=o*c,z=o*f;return r[0]=1-T-N,r[1]=b+z,r[2]=S-W,r[3]=0,r[4]=b-z,r[5]=1-_-N,r[6]=D+G,r[7]=0,r[8]=S+W,r[9]=D-G,r[10]=1-_-T,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function tj(r,e,t,n,i,o,s){const c=1/(t-e),f=1/(i-n),_=1/(o-s);return r[0]=o*2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o*2*f,r[6]=0,r[7]=0,r[8]=(t+e)*c,r[9]=(i+n)*f,r[10]=(s+o)*_,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*o*2*_,r[15]=0,r}function rj(r,e,t,n,i){const o=1/Math.tan(e/2);if(r[0]=o/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const s=1/(n-i);r[10]=(i+n)*s,r[14]=2*i*n*s}else r[10]=-1,r[14]=-2*n;return r}const nj=rj;function ij(r,e,t,n,i,o,s){const c=1/(e-t),f=1/(n-i),_=1/(o-s);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*_,r[11]=0,r[12]=(e+t)*c,r[13]=(i+n)*f,r[14]=(s+o)*_,r[15]=1,r}const sj=ij;function oj(r,e,t,n){let i,o,s,c,f,_,b,T,S,D;const N=e[0],G=e[1],W=e[2],z=n[0],j=n[1],K=n[2],fe=t[0],Z=t[1],ae=t[2];return Math.abs(N-fe)<Hp&&Math.abs(G-Z)<Hp&&Math.abs(W-ae)<Hp?XH(r):(T=N-fe,S=G-Z,D=W-ae,i=1/Math.sqrt(T*T+S*S+D*D),T*=i,S*=i,D*=i,o=j*D-K*S,s=K*T-z*D,c=z*S-j*T,i=Math.sqrt(o*o+s*s+c*c),i?(i=1/i,o*=i,s*=i,c*=i):(o=0,s=0,c=0),f=S*c-D*s,_=D*o-T*c,b=T*s-S*o,i=Math.sqrt(f*f+_*_+b*b),i?(i=1/i,f*=i,_*=i,b*=i):(f=0,_=0,b=0),r[0]=o,r[1]=f,r[2]=T,r[3]=0,r[4]=s,r[5]=_,r[6]=S,r[7]=0,r[8]=c,r[9]=b,r[10]=D,r[11]=0,r[12]=-(o*N+s*G+c*W),r[13]=-(f*N+_*G+b*W),r[14]=-(T*N+S*G+D*W),r[15]=1,r)}function aj(){const r=new pc(4);return pc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function cj(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function Cw(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function lj(r){const e=r[0],t=r[1],n=r[2],i=r[3];return Math.sqrt(e*e+t*t+n*n+i*i)}function uj(r){const e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function fj(r,e){const t=e[0],n=e[1],i=e[2],o=e[3];let s=t*t+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),r[0]=t*s,r[1]=n*s,r[2]=i*s,r[3]=o*s,r}function hj(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function dj(r,e,t,n){const i=e[0],o=e[1],s=e[2],c=e[3];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r[2]=s+n*(t[2]-s),r[3]=c+n*(t[3]-c),r}function RA(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*s,r[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*s,r[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*s,r[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*s,r}function Aj(r,e,t){const n=e[0],i=e[1],o=e[2],s=t[0],c=t[1],f=t[2],_=t[3],b=_*n+c*o-f*i,T=_*i+f*n-s*o,S=_*o+s*i-c*n,D=-s*n-c*i-f*o;return r[0]=b*_+D*-s+T*-f-S*-c,r[1]=T*_+D*-c+S*-s-b*-f,r[2]=S*_+D*-f+b*-c-T*-s,r[3]=e[3],r}(function(){const r=aj();return function(e,t,n,i,o,s){let c,f;for(t||(t=4),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],r[3]=e[c+3],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2],e[c+3]=r[3];return e}})();var E2;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(E2||(E2={}));const pj=45*Math.PI/180,gj=1,eb=.1,tb=500,mj=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class dn extends l6{static get IDENTITY(){return yj()}static get ZERO(){return _j()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return E2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,o,s,c,f,_,b,T,S,D,N,G,W){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=c,this[7]=f,this[8]=_,this[9]=b,this[10]=T,this[11]=S,this[12]=D,this[13]=N,this[14]=G,this[15]=W,this.check()}setRowMajor(e,t,n,i,o,s,c,f,_,b,T,S,D,N,G,W){return this[0]=e,this[1]=o,this[2]=_,this[3]=D,this[4]=t,this[5]=s,this[6]=b,this[7]=N,this[8]=n,this[9]=c,this[10]=T,this[11]=G,this[12]=i,this[13]=f,this[14]=S,this[15]=W,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(mj)}fromObject(e){return this.check()}fromQuaternion(e){return ej(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:o,near:s=eb,far:c=tb}=e;return c===1/0?vj(this,t,n,i,o,s):tj(this,t,n,i,o,s,c),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return oj(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:o,near:s=eb,far:c=tb}=e;return sj(this,t,n,i,o,s,c),this.check()}orthographic(e){const{fovy:t=pj,aspect:n=gj,focalDistance:i=1,near:o=eb,far:s=tb}=e;mS(t);const c=t/2,f=i*Math.tan(c),_=f*n;return this.ortho({left:-_,right:_,bottom:-f,top:f,near:o,far:s})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=e;return mS(t),nj(this,t,n,i,o),this.check()}determinant(){return YH(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*s,e}transpose(){return KH(this,this),this.check()}invert(){return C2(this,this),this.check()}multiplyLeft(e){return Jf(this,e,this),this.check()}multiplyRight(e){return Jf(this,this,e),this.check()}rotateX(e){return u6(this,this,e),this.check()}rotateY(e){return ZH(this,this,e),this.check()}rotateZ(e){return f6(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return qH(this,this,e,t),this.check()}scale(e){return ww(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return o_(this,this,e),this.check()}transform(e,t){return e.length===4?(t=RA(t||[-0,-0,-0,-0],e,this),Vp(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=QD(t||[-0,-0],e,this);break;case 3:i=bw(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vp(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=e6(t||[-0,-0],e,this);break;case 3:n=t6(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Vp(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let O0,D0;function _j(){return O0||(O0=new dn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(O0)),O0}function yj(){return D0||(D0=new dn,Object.freeze(D0)),D0}function mS(r){if(r>Math.PI*2)throw Error("expected radians")}function vj(r,e,t,n,i,o){const s=2*o/(t-e),c=2*o/(i-n),f=(t+e)/(t-e),_=(i+n)/(i-n),b=-1,T=-1,S=-2*o;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=f,r[9]=_,r[10]=b,r[11]=T,r[12]=0,r[13]=0,r[14]=S,r[15]=0,r}function _S(){const r=new pc(4);return pc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function bj(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function h6(r,e,t){t=t*.5;const n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function yS(r,e,t){const n=e[0],i=e[1],o=e[2],s=e[3],c=t[0],f=t[1],_=t[2],b=t[3];return r[0]=n*b+s*c+i*_-o*f,r[1]=i*b+s*f+o*c-n*_,r[2]=o*b+s*_+n*f-i*c,r[3]=s*b-n*c-i*f-o*_,r}function xj(r,e,t){t*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],c=Math.sin(t),f=Math.cos(t);return r[0]=n*f+s*c,r[1]=i*f+o*c,r[2]=o*f-i*c,r[3]=s*f-n*c,r}function wj(r,e,t){t*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],c=Math.sin(t),f=Math.cos(t);return r[0]=n*f-o*c,r[1]=i*f+s*c,r[2]=o*f+n*c,r[3]=s*f-i*c,r}function Cj(r,e,t){t*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],c=Math.sin(t),f=Math.cos(t);return r[0]=n*f+i*c,r[1]=i*f-n*c,r[2]=o*f+s*c,r[3]=s*f-o*c,r}function Ej(r,e){const t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function Em(r,e,t,n){const i=e[0],o=e[1],s=e[2],c=e[3];let f=t[0],_=t[1],b=t[2],T=t[3],S,D,N,G,W;return S=i*f+o*_+s*b+c*T,S<0&&(S=-S,f=-f,_=-_,b=-b,T=-T),1-S>Hp?(D=Math.acos(S),W=Math.sin(D),N=Math.sin((1-n)*D)/W,G=Math.sin(n*D)/W):(N=1-n,G=n),r[0]=N*i+G*f,r[1]=N*o+G*_,r[2]=N*s+G*b,r[3]=N*c+G*T,r}function Tj(r,e){const t=e[0],n=e[1],i=e[2],o=e[3],s=t*t+n*n+i*i+o*o,c=s?1/s:0;return r[0]=-t*c,r[1]=-n*c,r[2]=-i*c,r[3]=o*c,r}function Bj(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function d6(r,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[s*3+s]+1),r[i]=.5*n,n=.5/n,r[3]=(e[o*3+s]-e[s*3+o])*n,r[o]=(e[o*3+i]+e[i*3+o])*n,r[s]=(e[s*3+i]+e[i*3+s])*n}return r}const Sj=cj,Ij=Cw,Mj=hj,Pj=dj,Rj=lj,Fj=uj,A6=fj,Oj=function(){const r=n6(),e=AS(1,0,0),t=AS(0,1,0);return function(n,i,o){const s=vw(i,o);return s<-.999999?(Cm(r,e,i),c6(r)<1e-6&&Cm(r,t,i),RH(r,r),h6(n,r,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Cm(r,i,o),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+s,A6(n,n))}}();(function(){const r=_S(),e=_S();return function(t,n,i,o,s,c){return Em(r,n,s,c),Em(e,i,o,c),Em(t,r,e,2*c*(1-c)),t}})();(function(){const r=NH();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],A6(e,d6(e,r))}})();const Dj=[0,0,0,1];class og extends mw{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return d6(this,e),this.check()}fromAxisRotation(e,t){return h6(this,e,t),this.check()}identity(){return bj(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=jn(e)}get y(){return this[1]}set y(e){this[1]=jn(e)}get z(){return this[2]}set z(e){this[2]=jn(e)}get w(){return this[3]}set w(e){this[3]=jn(e)}len(){return Rj(this)}lengthSquared(){return Fj(this)}dot(e){return Mj(this,e)}rotationTo(e,t){return Oj(this,e,t),this.check()}add(e){return Sj(this,this,e),this.check()}calculateW(){return Ej(this,this),this.check()}conjugate(){return Bj(this,this),this.check()}invert(){return Tj(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(Pj(this,e,t,n),this.check())}multiplyRight(e){return yS(this,this,e),this.check()}multiplyLeft(e){return yS(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return xj(this,this,e),this.check()}rotateY(e){return wj(this,this,e),this.check()}rotateZ(e){return Cj(this,this,e),this.check()}scale(e){return Ij(this,this,e),this.check()}slerp(e,t,n){let i,o,s;switch(arguments.length){case 1:({start:i=Dj,target:o,ratio:s}=e);break;case 2:i=this,o=e,s=t;break;default:i=e,o=t,s=n}return Em(this,i,o,s),this.check()}transformVector4(e,t=new xw){return Aj(t,e,this),Vp(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Lj=.1,kj=1e-12,p6=1e-15,Nj=1e-20;function g6(r,e=[],t=0){const n=Math.fround(r),i=r-n;return e[t]=n,e[t+1]=i,e}function Uj(r){return r-Math.fround(r)}function zj(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const i=t*4+n;g6(r[n*4+t],e,i*2)}return e}const Gj=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Vj={name:"fp32",vs:Gj},Hj=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,jj={ONE:1},$j={name:"fp64arithmetic",vs:Hj,defaultUniforms:jj,uniformTypes:{ONE:"f32"},fp64ify:g6,fp64LowPart:Uj,fp64ifyMatrix4:zj},Wj=[0,1,1,1],Jj=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Xj=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,vS={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Wj},vs:Jj,fs:Xj,getUniforms:Kj};function Kj(r={},e){const t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(r.highlightColor){const n=Array.from(r.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}const bS=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,Yj=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,m6=3,qj=255;var ag;(function(r){r[r.POINT=0]="POINT",r[r.DIRECTIONAL=1]="DIRECTIONAL"})(ag||(ag={}));const iA={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:m6},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:ag.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:Yj,vs:bS,fs:bS,getUniforms:Zj};function Zj(r,e={}){if(r=r&&{...r},!r)return{...iA.defaultUniforms};r.lights&&(r={...r,...e$(r.lights),lights:void 0});const{ambientLight:t,pointLights:n,directionalLights:i}=r||{};if(!(t||n&&n.length>0||i&&i.length>0))return{...iA.defaultUniforms,enabled:0};const s={...iA.defaultUniforms,...e,...Qj({ambientLight:t,pointLights:n,directionalLights:i})};return r.enabled!==void 0&&(s.enabled=r.enabled?1:0),s}function Qj({ambientLight:r,pointLights:e=[],directionalLights:t=[]}){const n={};n.ambientLightColor=rb(r);let i=0;for(const o of e){n.lightType=ag.POINT;const s=i;n[`lightColor${s}`]=rb(o),n[`lightPosition${s}`]=o.position,n[`lightAttenuation${s}`]=o.attenuation||[1,0,0],i++}for(const o of t){n.lightType=ag.DIRECTIONAL;const s=i;n[`lightColor${s}`]=rb(o),n[`lightDirection${s}`]=o.direction,i++}return i>m6&&Yt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=t.length,n.pointLightCount=e.length,n}function e$(r){var t,n;const e={pointLights:[],directionalLights:[]};for(const i of r||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(t=e.directionalLights)==null||t.push(i);break;case"point":(n=e.pointLights)==null||n.push(i);break}return e}function rb(r={}){const{color:e=[0,0,0],intensity:t=1}=r;return e.map(n=>n*t/qj)}const _6=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,y6=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,cy={props:{},name:"gouraudMaterial",vs:y6.replace("phongMaterial","gouraudMaterial"),fs:_6.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[iA],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...cy.defaultUniforms,...e}}},t$=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Ew={name:"phongMaterial",dependencies:[iA],source:t$,vs:_6,fs:y6,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Ew.defaultUniforms,...e}}},r$=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,n$=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,xS=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,i$={name:"pbrProjection",vs:xS,fs:xS,getUniforms:r=>r,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},Tw={props:{},uniforms:{},name:"pbrMaterial",dependencies:[iA,i$],vs:r$,fs:n$,defines:{LIGHTING_FRAGMENT:1},getUniforms:r=>r,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},wS=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,s$={name:"layer",vs:wS,fs:wS,getUniforms:r=>({opacity:Math.pow(r.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},o$=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,v6="#define SMOOTH_EDGE_RADIUS 0.5",a$=`${v6}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,c$=`${v6}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,b6={name:"geometry",source:o$,vs:a$,fs:c$},l$=25;var cs;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(cs||(cs={}));var gs;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(gs||(gs={}));var hn;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(hn||(hn={}));const u$="compute",f$="auto",T2="manipulation",Tm="none",B2="pan-x",S2="pan-y";function h$(r){if(r.includes(Tm))return Tm;const e=r.includes(B2),t=r.includes(S2);return e&&t?Tm:e||t?e?B2:S2:r.includes(T2)?T2:f$}class d${constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===u$&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return h$(e.join(" "))}}function a_(r){return r.trim().split(/\s+/g)}function nb(r,e,t){if(r)for(const n of a_(e))r.addEventListener(n,t,!1)}function ib(r,e,t){if(r)for(const n of a_(e))r.removeEventListener(n,t,!1)}function CS(r){return(r.ownerDocument||r).defaultView}function A$(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function x6(r){const e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,n=0,i=0;for(;i<e;)t+=r[i].clientX,n+=r[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(n/e)}}function ES(r){const e=[];let t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:x6(e),deltaX:r.deltaX,deltaY:r.deltaY}}function w6(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.sqrt(t*t+n*n)}function TS(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.sqrt(t*t+n*n)}function p$(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.atan2(n,t)*180/Math.PI}function BS(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.atan2(n,t)*180/Math.PI}function C6(r,e){return r===e?gs.None:Math.abs(r)>=Math.abs(e)?r<0?gs.Left:gs.Right:e<0?gs.Up:gs.Down}function g$(r,e){const t=e.center;let n=r.offsetDelta,i=r.prevDelta;const o=r.prevInput;return(e.eventType===cs.Start||(o==null?void 0:o.eventType)===cs.End)&&(i=r.prevDelta={x:(o==null?void 0:o.deltaX)||0,y:(o==null?void 0:o.deltaY)||0},n=r.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-n.x),deltaY:i.y+(t.y-n.y)}}function E6(r,e,t){return{x:e/r||0,y:t/r||0}}function m$(r,e){return TS(e[0],e[1])/TS(r[0],r[1])}function _$(r,e){return BS(e[1],e[0])-BS(r[1],r[0])}function y$(r,e){const t=r.lastInterval||e,n=e.timeStamp-t.timeStamp;let i,o,s,c;if(e.eventType!==cs.Cancel&&(n>l$||t.velocity===void 0)){const f=e.deltaX-t.deltaX,_=e.deltaY-t.deltaY,b=E6(n,f,_);o=b.x,s=b.y,i=Math.abs(b.x)>Math.abs(b.y)?b.x:b.y,c=C6(f,_),r.lastInterval=e}else i=t.velocity,o=t.velocityX,s=t.velocityY,c=t.direction;e.velocity=i,e.velocityX=o,e.velocityY=s,e.direction=c}function v$(r,e){const{session:t}=r,{pointers:n}=e,{length:i}=n;t.firstInput||(t.firstInput=ES(e)),i>1&&!t.firstMultiple?t.firstMultiple=ES(e):i===1&&(t.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=t,c=s?s.center:o.center,f=e.center=x6(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=p$(c,f),e.distance=w6(c,f);const{deltaX:_,deltaY:b}=g$(t,e);e.deltaX=_,e.deltaY=b,e.offsetDirection=C6(e.deltaX,e.deltaY);const T=E6(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=T.x,e.overallVelocityY=T.y,e.overallVelocity=Math.abs(T.x)>Math.abs(T.y)?T.x:T.y,e.scale=s?m$(s.pointers,n):1,e.rotation=s?_$(s.pointers,n):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let S=r.element;return A$(e.srcEvent.target,S)&&(S=e.srcEvent.target),e.target=S,y$(t,e),e}function b$(r,e,t){const n=t.pointers.length,i=t.changedPointers.length,o=e&cs.Start&&n-i===0,s=e&(cs.End|cs.Cancel)&&n-i===0;t.isFirst=!!o,t.isFinal=!!s,o&&(r.session={}),t.eventType=e;const c=v$(r,t);r.emit("hammer.input",c),r.recognize(c),r.session.prevInput=c}let x$=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){b$(this.manager,e,t)}init(){nb(this.element,this.evEl,this.domHandler),nb(this.target,this.evTarget,this.domHandler),nb(CS(this.element),this.evWin,this.domHandler)}destroy(){ib(this.element,this.evEl,this.domHandler),ib(this.target,this.evTarget,this.domHandler),ib(CS(this.element),this.evWin,this.domHandler)}};const w$={pointerdown:cs.Start,pointermove:cs.Move,pointerup:cs.End,pointercancel:cs.Cancel,pointerout:cs.Cancel},C$="pointerdown",E$="pointermove pointerup pointercancel";class T$ extends x${constructor(e){super(e),this.evEl=C$,this.evWin=E$,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=w$[e.type],o=e.pointerType,s=o==="touch";let c=t.findIndex(f=>f.pointerId===e.pointerId);i&cs.Start&&(e.buttons||s)?c<0&&(t.push(e),c=t.length-1):i&(cs.End|cs.Cancel)&&(n=!0),!(c<0)&&(t[c]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:o,srcEvent:e}),n&&t.splice(c,1))}}const B$=["","webkit","Moz","MS","ms","o"];function S$(r,e){const t=e[0].toUpperCase()+e.slice(1);for(const n of B$){const i=n?n+t:e;if(i in r)return i}}const I$=1,SS=2,IS={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};let M$=class{constructor(e,t){this.options={...IS,...t,cssProps:{...IS.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new T$(this),this.touchAction=new d$(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?SS:I$}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:o}=t;(!o||o&&o.state&hn.Recognized)&&(o=t.curRecognizer=null);let s=0;for(;s<i.length;)n=i[s],t.stopped!==SS&&(!o||n===o||n.canRecognizeWith(o))?n.recognize(e):n.reset(),!o&&n.state&(hn.Began|hn.Changed|hn.Ended)&&(o=t.curRecognizer=n),s++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:n}=this,i=n.indexOf(t);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of a_(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of a_(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let o=0;for(;o<n.length;)n[o](i),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const o=S$(t.style,n);e?(this.oldCssProps[o]=t.style[o],t.style[o]=i):t.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}},P$=1;function R$(){return P$++}function MS(r){return r&hn.Cancelled?"cancel":r&hn.Ended?"end":r&hn.Changed?"move":r&hn.Began?"start":""}class T6{constructor(e){this.options=e,this.id=R$(),this.state=hn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return n.indexOf(t)===-1&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const n=this.requireFail.indexOf(t);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<hn.Ended&&this.manager.emit(this.options.event+MS(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=hn.Ended&&this.manager.emit(this.options.event+MS(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=hn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(hn.Failed|hn.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=hn.Failed;return}this.state&(hn.Recognized|hn.Cancelled|hn.Failed)&&(this.state=hn.Possible),this.state=this.process(t),this.state&(hn.Began|hn.Changed|hn.Ended|hn.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class B6 extends T6{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(hn.Began|hn.Changed),o=this.attrTest(e);return i&&(n&cs.Cancel||!o)?t|hn.Cancelled:i||o?n&cs.End?t|hn.Ended:t&hn.Began?t|hn.Changed:hn.Began:hn.Failed}}class PS extends T6{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[T2]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&cs.Start&&this.count===0)return this.failTimeout();if(i&&o&&n){if(e.eventType!==cs.End)return this.failTimeout();const s=this.pTime?e.timeStamp-this.pTime<t.interval:!0,c=!this.pCenter||w6(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!s?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=hn.Recognized,this.tryEmit(this._input)},t.interval),hn.Began):hn.Recognized}return hn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=hn.Failed},this.options.interval),hn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===hn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const F$=["","start","move","end","cancel","up","down","left","right"];class RS extends B6{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:gs.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&gs.Horizontal&&t.push(S2),e&gs.Vertical&&t.push(B2),t}getEventNames(){return F$.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:o}=e;const s=e.deltaX,c=e.deltaY;return o&t.direction||(t.direction&gs.Horizontal?(o=s===0?gs.None:s<0?gs.Left:gs.Right,n=s!==this.pX,i=Math.abs(e.deltaX)):(o=c===0?gs.None:c<0?gs.Up:gs.Down,n=c!==this.pY,i=Math.abs(e.deltaY))),e.direction=o,n&&i>t.threshold&&!!(o&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&hn.Began)||!(this.state&hn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=gs[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const O$=["","start","move","end","cancel","in","out"];class D$ extends B6{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Tm]}getEventNames(){return O$.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&hn.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}let ly=class{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}};const L$=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",k$=L$.indexOf("firefox")!==-1,FS=4.000244140625,N$=40,U$=.25;let z$=class extends ly{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;globalThis.WheelEvent&&(k$&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=N$)),o!==0&&o%FS===0&&(o=Math.floor(o/FS)),i.shiftKey&&o&&(o=o*U$),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}};const OS=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];let G$=class extends ly{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,OS.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){OS.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}};const DS=["keydown","keyup"];let V$=class extends ly{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",DS.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){DS.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}},H$=class extends ly{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}};const LS=1,I2=2,kS=4,j$={pointerdown:LS,pointermove:I2,pointerup:kS,mousedown:LS,mousemove:I2,mouseup:kS},$$=0,W$=1,J$=2,X$=1,K$=2,Y$=4;function q$(r){const e=j$[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,o=!1,s=!1;return e===I2?(i=!!(t&X$),o=!!(t&Y$),s=!!(t&K$)):(i=n===$$,o=n===W$,s=n===J$),{leftButton:i,middleButton:o,rightButton:s}}function Z$(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/o};return{center:t,offsetCenter:s}}const Q$={srcElement:"root",priority:0};let eW=class{constructor(e,t){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,o=!1){const{handlers:s,handlersByElement:c}=this,f={...Q$,...n};let _=c.get(f.srcElement);_||(_=[],c.set(f.srcElement,_));const b={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};i&&(b.once=!0),o&&(b.passive=!0),s.push(b),this._active=this._active||!b.passive;let T=_.length-1;for(;T>=0&&!(_[T].priority>=b.priority);)T--;_.splice(T+1,0,b)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===e&&s.handler===t){n.splice(o,1);const c=i.get(s.srcElement);c.splice(c.indexOf(s),1),c.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,i=!0},c=[];for(let f=0;f<n.length;f++){const{type:_,handler:b,once:T}=n[f];if(b({...e,type:_,stopPropagation:o,stopImmediatePropagation:s}),T&&c.push(n[f]),i)break}for(let f=0;f<c.length;f++){const{type:_,handler:b}=c[f];this.remove(_,b)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...q$(e),...Z$(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}};function tW(r){if("recognizer"in r)return r;let e;const t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){const n=t.shift(),i=t.shift()||{};e=new n(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}let rW=class{constructor(e=null,t={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new M$(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:o,requireFailure:s}=tW(n);this.manager.add(i),o&&i.recognizeWith(o),s&&i.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new z$(e,this._onOtherEvent,{enable:!1}),this.moveInput=new G$(e,this._onOtherEvent,{enable:!1}),this.keyInput=new V$(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new H$(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var o,s,c,f;const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:t}),n.touchAction.update()),(o=this.wheelInput)==null||o.enableEventType(e,t),(s=this.moveInput)==null||s.enableEventType(e,t),(c=this.keyInput)==null||c.enableEventType(e,t),(f=this.contextmenuInput)==null||f.enableEventType(e,t)}_addEventHandler(e,t,n,i,o){if(typeof e!="string"){n=t;for(const[_,b]of Object.entries(e))this._addEventHandler(_,b,n,i,o);return}const{manager:s,events:c}=this;if(!s)return;let f=c.get(e);if(!f){const _=this._getRecognizerName(e)||e;f=new eW(this,_),c.set(e,f),s&&s.on(e,f.handleEvent)}f.add(e,t,n,i,o),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[o,s]of Object.entries(e))this._removeEventHandler(o,s);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:o}=i;let s=!1;for(const c of n.values())if(c.recognizerName===o&&!c.isEmpty()){s=!0;break}s||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:t.options.event}};const Jr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Jr,"IDENTITY",{get:()=>($r.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const na={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},xo={common:0,meters:1,pixels:2},M2={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},NS={multipan:[RS,{threshold:10,direction:gs.Vertical,pointers:2}],pinch:[D$,{},null,["multipan"]],pan:[RS,{threshold:1},["pinch"],["multipan"]],dblclick:[PS,{event:"dblclick",taps:2}],click:[PS,{event:"click"},null,["dblclick"]]};function nW(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function Cg(r){let e={},t;return n=>{for(const i in n)if(!nW(n[i],e[i])){t=r(n),e=n;break}return t}}const US=[0,0,0,0],iW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],S6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sW=[0,0,0],I6=[0,0,0],oW=Cg(lW);function M6(r,e,t=I6){t.length<3&&(t=[t[0],t[1],0]);let n=t,i,o=!0;switch(e===Jr.LNGLAT_OFFSETS||e===Jr.METER_OFFSETS?i=t:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case na.WEB_MERCATOR:(e===Jr.LNGLAT||e===Jr.CARTESIAN)&&(i=[0,0,0],o=!1);break;case na.WEB_MERCATOR_AUTO_OFFSET:e===Jr.LNGLAT?n=i:e===Jr.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case na.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case na.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function aW(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:o,viewProjectionMatrix:s}=r,c=US,f=US,_=r.cameraPosition;const{geospatialOrigin:b,shaderCoordinateOrigin:T,offsetMode:S}=M6(r,e,t);return S&&(f=r.projectPosition(b||T),_=[_[0]-f[0],_[1]-f[1],_[2]-f[2]],f[3]=1,c=RA([],f,s),o=n||o,s=Jf([],i,o),s=Jf([],s,iW)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:c,originCommon:f,cameraPosCommon:_,shaderCoordinateOrigin:T,geospatialOrigin:b}}function cW({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:n=Jr.DEFAULT,coordinateOrigin:i=I6,autoWrapLongitude:o=!1}){n===Jr.DEFAULT&&(n=r.isGeospatial?Jr.LNGLAT:Jr.CARTESIAN);const s=oW({viewport:r,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return s.wrapLongitude=o,s.modelMatrix=t||S6,s}function lW({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:_}=aW(r,t,n),b=r.getDistanceScales(),T=[r.width*e,r.height*e],S=RA([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,D={coordinateSystem:t,projectionMode:r.projectionMode,coordinateOrigin:f,commonOrigin:s.slice(0,3),center:i,pseudoMeters:!!r._pseudoMeters,viewportSize:T,devicePixelRatio:e,focalDistance:S,commonUnitsPerMeter:b.unitsPerMeter,commonUnitsPerWorldUnit:b.unitsPerMeter,commonUnitsPerWorldUnit2:sW,scale:r.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:S6,cameraPosition:c};if(_){const N=r.getDistanceScales(_);switch(t){case Jr.METER_OFFSETS:D.commonUnitsPerWorldUnit=N.unitsPerMeter,D.commonUnitsPerWorldUnit2=N.unitsPerMeter2;break;case Jr.LNGLAT:case Jr.LNGLAT_OFFSETS:r._pseudoMeters||(D.commonUnitsPerMeter=N.unitsPerMeter),D.commonUnitsPerWorldUnit=N.unitsPerDegree,D.commonUnitsPerWorldUnit2=N.unitsPerDegree2;break;case Jr.CARTESIAN:D.commonUnitsPerWorldUnit=[1,1,N.unitsPerMeter[2]],D.commonUnitsPerWorldUnit2=[0,0,N.unitsPerMeter2[2]];break}}return D}const uW=Object.keys(Jr).map(r=>`const COORDINATE_SYSTEM_${r}: i32 = ${Jr[r]};`).join(""),fW=Object.keys(na).map(r=>`const PROJECTION_MODE_${r}: i32 = ${na[r]};`).join(""),hW=Object.keys(xo).map(r=>`const UNIT_${r.toUpperCase()}: i32 = ${xo[r]};`).join(""),dW=`${uW}
${fW}
${hW}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,AW=`${dW}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,pW=Object.keys(Jr).map(r=>`const int COORDINATE_SYSTEM_${r} = ${Jr[r]};`).join(""),gW=Object.keys(na).map(r=>`const int PROJECTION_MODE_${r} = ${na[r]};`).join(""),mW=Object.keys(xo).map(r=>`const int UNIT_${r.toUpperCase()} = ${xo[r]};`).join(""),_W=`${pW}
${gW}
${mW}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,yW={};function vW(r=yW){return"viewport"in r?cW(r):{}}const uy={name:"project",dependencies:[Vj,b6],source:AW,vs:_W,getUniforms:vW,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},bW=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,xW=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Is={name:"project32",dependencies:[uy],source:bW,vs:xW};function wW(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sA(r,e){const t=RA([],e,r);return Cw(t,t,1/t[3]),t}function zS(r,e){const t=r%e;return t<0?e+t:t}function P2(r,e,t){return r<e?e:r>t?t:r}function CW(r){return Math.log(r)*Math.LOG2E}const Bw=Math.log2||CW;function zl(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const cc=Math.PI,P6=cc/4,Fa=cc/180,R2=180/cc,mA=512,c_=4003e4,F2=85.051129,EW=1.5;function TW(r){return Bw(r)}function Gl(r){const[e,t]=r;zl(Number.isFinite(e)),zl(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*Fa,i=t*Fa,o=mA*(n+cc)/(2*cc),s=mA*(cc+Math.log(Math.tan(P6+i*.5)))/(2*cc);return[o,s]}function tl(r){const[e,t]=r,n=e/mA*(2*cc)-cc,i=2*(Math.atan(Math.exp(t/mA*(2*cc)-cc))-P6);return[n*R2,i*R2]}function BW(r){const{latitude:e}=r;zl(Number.isFinite(e));const t=Math.cos(e*Fa);return TW(c_*t)-9}function sb(r){const e=Math.cos(r*Fa);return mA/c_/e}function O2(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;zl(Number.isFinite(e)&&Number.isFinite(t));const i=mA,o=Math.cos(e*Fa),s=i/360,c=s/o,f=i/c_/o,_={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[s,c,f],degreesPerUnit:[1/s,1/c,1/f]};if(n){const b=Fa*Math.tan(e*Fa)/o,T=s*b/2,S=i/c_*b,D=S/c*f;_.unitsPerDegree2=[0,T,S],_.unitsPerMeter2=[D,0,D]}return _}function R6(r,e){const[t,n,i]=r,[o,s,c]=e,{unitsPerMeter:f,unitsPerMeter2:_}=O2({longitude:t,latitude:n,highPrecision:!0}),b=Gl(r);b[0]+=o*(f[0]+_[0]*s),b[1]+=s*(f[1]+_[1]*s);const T=tl(b),S=(i||0)+(c||0);return Number.isFinite(i)||Number.isFinite(c)?[T[0],T[1],S]:T}function SW(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:o,center:s}=r,c=wW();o_(c,c,[0,0,-i]),u6(c,c,-t*Fa),f6(c,c,n*Fa);const f=o/e;return ww(c,c,[f,f,f]),s&&o_(c,c,PH([],s)),c}function IW(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:o,center:s,scale:c,nearZMultiplier:f=1,farZMultiplier:_=1}=r;let{fovy:b=cg(EW)}=r;n!==void 0&&(b=cg(n));const T=b*Fa,S=i*Fa,D=Sw(b);let N=D;s&&(N+=s[2]*c/Math.cos(S)/t);const G=T*(.5+(o?o[1]:0)/t),W=Math.sin(G)*N/Math.sin(P2(Math.PI/2-S-G,.01,Math.PI-.01)),z=Math.sin(S)*W+N,j=N*10,K=Math.min(z*_,j);return{fov:T,aspect:e/t,focalDistance:D,near:f,far:K}}function cg(r){return 2*Math.atan(.5/r)*R2}function Sw(r){return .5/Math.tan(.5*r*Fa)}function F6(r,e){const[t,n,i=0]=r;return zl(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),sA(e,[t,n,i,1])}function Iw(r,e,t=0){const[n,i,o]=r;if(zl(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return sA(e,[n,i,o,1]);const s=sA(e,[n,i,0,1]),c=sA(e,[n,i,1,1]),f=s[2],_=c[2],b=f===_?0:((t||0)-f)/(_-f);return qD([],s,c,b)}function MW(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=r,[[c,f],[_,b]]=n,T=PW(r.padding),S=Gl([c,P2(b,-85.051129,F2)]),D=Gl([_,P2(f,-85.051129,F2)]),N=[Math.max(Math.abs(D[0]-S[0]),i),Math.max(Math.abs(D[1]-S[1]),i)],G=[e-T.left-T.right-Math.abs(s[0])*2,t-T.top-T.bottom-Math.abs(s[1])*2];zl(G[0]>0&&G[1]>0);const W=G[0]/N[0],z=G[1]/N[1],j=(T.right-T.left)/2/W,K=(T.top-T.bottom)/2/z,fe=[(D[0]+S[0])/2+j,(D[1]+S[1])/2+K],Z=tl(fe),ae=Math.min(o,Bw(Math.abs(Math.min(W,z))));return zl(Number.isFinite(ae)),{longitude:Z[0],latitude:Z[1],zoom:ae}}function PW(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(zl(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const GS=Math.PI/180;function RW(r,e=0){const{width:t,height:n,unproject:i}=r,o={targetZ:e},s=i([0,n],o),c=i([t,n],o);let f,_;const b=r.fovy?.5*r.fovy*GS:Math.atan(.5/r.altitude),T=(90-r.pitch)*GS;return b>T-.01?(f=VS(r,0,e),_=VS(r,t,e)):(f=i([0,0],o),_=i([t,0],o)),[s,c,_,f]}function VS(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=sA(n,[e,0,1,1]),o=sA(n,[e,r.height,1,1]),c=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),f=qD([],i,o,c),_=tl(f);return _.push(t),_}const HS=512;function FW(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:o,zoom:s,bearing:c=0}=r;(i<-180||i>180)&&(i=zS(i+180,360)-180),(c<-180||c>180)&&(c=zS(c+180,360)-180);const f=Bw(t/HS);if(s<=f)s=f,o=0;else{const _=t/2/Math.pow(2,s),b=tl([0,_])[1];if(o<b)o=b;else{const T=tl([0,HS-_])[1];o>T&&(o=T)}}return{width:e,height:t,longitude:i,latitude:o,zoom:s,pitch:n,bearing:c}}const O6=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,OW=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,DW=`
${O6}
${OW}
`,LW=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,kW=`
${O6}
${LW}
`,NW=Cg(HW),UW=Cg(jW),zW=[0,0,0,1],GW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function VW(r,e){const[t,n,i]=r,o=Iw([t,n,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function HW({viewport:r,center:e}){return new dn(r.viewProjectionMatrix).invert().transform(e)}function jW({viewport:r,shadowMatrices:e}){const t=[],n=r.pixelUnprojectionMatrix,i=r.isGeospatial?void 0:1,o=[[0,0,i],[r.width,0,i],[0,r.height,i],[r.width,r.height,i],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(s=>VW(s,n));for(const s of e){const c=s.clone().translate(new ft(r.center).negate()),f=o.map(b=>c.transform(b)),_=new dn().ortho({left:Math.min(...f.map(b=>b[0])),right:Math.max(...f.map(b=>b[0])),bottom:Math.min(...f.map(b=>b[1])),top:Math.max(...f.map(b=>b[1])),near:Math.min(...f.map(b=>-b[2])),far:Math.max(...f.map(b=>-b[2]))});t.push(_.multiplyRight(s))}return t}function $W(r){const{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n=uy.getUniforms(t),i=NW({viewport:t.viewport,center:n.center}),o=[],s=UW({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<r.shadowMatrices.length;f++){const _=s[f],b=_.clone().translate(new ft(t.viewport.center).negate());n.coordinateSystem===Jr.LNGLAT&&n.projectionMode===na.WEB_MERCATOR?(s[f]=b,o[f]=i):(s[f]=_.clone().multiplyRight(GW),o[f]=b.transform(i))}const c={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||zW,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let f=0;f<s.length;f++)c[`viewProjectionMatrix${f}`]=s[f],c[`projectCenter${f}`]=o[f];for(let f=0;f<2;f++)c[`shadow_uShadowMap${f}`]=r.shadowMaps&&r.shadowMaps[f]||r.dummyShadowMap;return c}const jS={name:"shadow",dependencies:[uy],vs:DW,fs:kW,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:$W,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ca={...vS,defaultUniforms:{...vS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},WW=[b6],JW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],XW=[];function KW(r){const e=Ym.getDefaultShaderAssembler();for(const n of WW)e.addDefaultModule(n);const t=r==="glsl"?JW:XW;for(const n of t)e.addShaderHook(n);return e}const YW=[255,255,255],qW=1;let ZW=0;class QW{constructor(e={}){this.type="ambient";const{color:t=YW}=e,{intensity:n=qW}=e;this.id=e.id||`ambient-${ZW++}`,this.color=t,this.intensity=n}}const eJ=[255,255,255],tJ=1,rJ=[0,0,-1];let nJ=0;class $S{constructor(e={}){this.type="directional";const{color:t=eJ}=e,{intensity:n=tJ}=e,{direction:i=rJ}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${nJ++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new ft(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class D6{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class fy extends D6{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,o=e.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,c=i?0:!1,f=e.colorMask??15,_={viewport:[0,0,t,n]};e.colorMask&&(_.colorMask=f),e.scissorRect&&(_.scissorRect=e.scissorRect);const b=this.device.beginRenderPass({framebuffer:e.target,parameters:_,clearColor:o,clearDepth:s,clearStencil:c});try{return this._drawLayers(b,e)}finally{b.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:o,views:s,onViewportActive:c,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const _=[];for(const b of o){const T=s&&s[b.id];c==null||c(b);const S=this._getDrawLayerParams(b,t),D=b.subViewports||[b];for(const N of D){const G=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:N,view:T,pass:t.pass,layers:t.layers},S);_.push(G)}}return _}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:c,shaderModuleProps:f},_=!1){var N;const b=[],T=L6(this._lastRenderIndex+1),S={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:s},D={};for(let G=0;G<t.length;G++){const W=t[G],z=this._shouldDrawLayer(W,S,o,D),j={shouldDrawLayer:z};z&&!_&&(j.shouldDrawLayer=!0,j.layerRenderIndex=T(W,z),j.shaderModuleProps=this._getShaderModuleProps(W,c,n,f),j.layerParameters={...(N=W.context.deck)==null?void 0:N.props.parameters,...this.getLayerParameters(W,G,e)}),b[G]=j}return b}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:i,target:o,viewport:s,view:c},f){const _=iJ(this.device,{shaderModuleProps:n,target:o,viewport:s});if(c&&c.props.clear){const T=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:_,scissorRect:_},clearColor:T.color?[0,0,0,0]:!1,clearDepth:T.depth?1:!1}).end()}const b={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:_});for(let T=0;T<t.length;T++){const S=t[T],D=f[T],{shouldDrawLayer:N}=D;if(N&&S.props.pickable&&b.pickableCount++,S.isComposite&&b.compositeCount++,S.isDrawable&&D.shouldDrawLayer){const{layerRenderIndex:G,shaderModuleProps:W,layerParameters:z}=D;b.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,G),W.project&&(W.project.viewport=s),S.context.renderPass=e;try{S._drawLayer({renderPass:e,shaderModuleProps:W,uniforms:{layerIndex:G},parameters:z})}catch(j){S.raiseError(j,`drawing ${S} to ${i}`)}}}return b}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(t))return!1;t.layer=s,s=s.parent}if(n){const c=t.layer.id;if(c in i||(i[c]=n(t)),!i[c])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){var f,_;const o=this.device.canvasContext.cssToDeviceRatio(),s=((f=e.internalState)==null?void 0:f.propsInTransition)||e.props,c={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const b of t)WS(c,(_=b.getShaderModuleProps)==null?void 0:_.call(b,e,c));return WS(c,this.getShaderModuleProps(e,t,c),i)}}function L6(r=0,e={}){const t={},n=(i,o)=>{const s=i.props._offset,c=i.id,f=i.parent&&i.parent.id;let _;if(f&&!(f in e)&&n(i.parent,!1),f in t){const b=t[f]=t[f]||L6(e[f],e);_=b(i,o),t[c]=b}else Number.isFinite(s)?(_=s+(e[f]||0),t[c]=null):_=r;return o&&_>=r&&(r=_+1),e[c]=_,_};return n}function iJ(r,{shaderModuleProps:e,target:t,viewport:n}){var f;const i=((f=e==null?void 0:e.project)==null?void 0:f.devicePixelRatio)??r.canvasContext.cssToDeviceRatio(),[,o]=r.canvasContext.getDrawingBufferSize(),s=t?t.height:o,c=n;return[c.x*i,s-(c.y+c.height)*i,c.width*i,c.height*i]}function WS(r,...e){for(const t of e)if(t)for(const n in t)r[n]?Object.assign(r[n],t[n]):r[n]=t[n];return r}class sJ extends fy{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],o=i.width*n,s=i.height*n,c=[1,1,1,1];(o!==t.width||s!==t.height)&&t.resize({width:o,height:s}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const oJ={color:[255,255,255],intensity:1},JS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],aJ=[0,0,0,200/255];class k6{constructor(e={}){this.id="lighting-effect",this.shadowColor=aJ,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(jS),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:e})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:n,lighting:i,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(jS))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new dn().lookAt({eye:new ft(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new sJ(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new QW(oJ),this.directionalLights.push(new $S(JS[0]),new $S(JS[1])))}}class cJ{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:c=!1,maxCount:f}){const _=i||e&&e.constructor||Float32Array,b=t*n+o;if(ArrayBuffer.isView(e)){if(b<=e.length)return e;if(b*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new _(e.buffer,0,b)}let T=1/0;f&&(T=f*n+o);const S=this._allocate(_,b,c,T);return e&&s?S.set(e):c||S.fill(0,0,4),this._release(e),S}release(e){this._release(e)}_allocate(e,t,n,i){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>i&&(o=i);const s=this._pool,c=e.BYTES_PER_ELEMENT*o,f=s.findIndex(_=>_.byteLength>=c);if(f>=0){const _=new e(s.splice(f,1)[0],0,o);return n&&_.fill(0),_}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,o=t.findIndex(s=>s.byteLength>=i);o<0?t.push(n):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,n),t.length>this.opts.poolSize&&t.shift()}}const _A=new cJ;function Rp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lJ(r){return[r[12],r[13],r[14]]}function uJ(r){return{left:pd(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:pd(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:pd(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:pd(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:pd(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:pd(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const XS=new ft;function pd(r,e,t,n){XS.set(r,e,t);const i=XS.len();return{distance:n/i,normal:new ft(-r/i,-e/i,-t/i)}}function fJ(r){return r-Math.fround(r)}let vp;function ob(r,e){const{size:t=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:r.length,o=(i-n)/t;vp=_A.allocate(vp,o,{type:Float32Array,size:t*2});let s=n,c=0;for(;s<i;){for(let f=0;f<t;f++){const _=r[s++];vp[c+f]=_,vp[c+f+t]=fJ(_)}c+=t*2}return vp.subarray(0,o*t*2)}function hJ(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const dJ=Math.PI/180,AJ=Rp(),KS=[0,0,0],pJ={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function gJ({width:r,height:e,orthographic:t,fovyRadians:n,focalDistance:i,padding:o,near:s,far:c}){const f=r/e,_=t?new dn().orthographic({fovy:n,aspect:f,focalDistance:i,near:s,far:c}):new dn().perspective({fovy:n,aspect:f,near:s,far:c});if(o){const{left:b=0,right:T=0,top:S=0,bottom:D=0}=o,N=Ll((b+r-T)/2,0,r)-r/2,G=Ll((S+e-D)/2,0,e)-e/2;_[8]-=N*2/r,_[9]+=G*2/e}return _}class jl{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||pJ,this.focalDistance=e.focalDistance||1,this.position=e.position||KS,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?na.WEB_MERCATOR:na.WEB_MERCATOR_AUTO_OFFSET:na.IDENTITY}equals(e){return e instanceof jl?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&aa(e.projectionMatrix,this.projectionMatrix)&&aa(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const n=this.projectPosition(e),i=F6(n,this.pixelProjectionMatrix),[o,s]=i,c=t?s:this.height-s;return e.length===2?[o,c]:[o,c,i[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,o,s]=e,c=t?o:this.height-o,f=n&&n*this.distanceScales.unitsPerMeter[2],_=Iw([i,c,s],this.pixelUnprojectionMatrix,f),[b,T,S]=this.unprojectPosition(_);return Number.isFinite(s)?[b,T,S]:Number.isFinite(n)?[b,T,n]:[b,T]}projectPosition(e){const[t,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,i]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,i]}projectFlat(e){if(this.isGeospatial){const t=Gl(e);return t[1]=Ll(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?tl(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?O2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,uJ(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=BW({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||O2({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:s}=e;let c=KS;if(o&&(c=s?new dn(s).transformAsVector(o,[]):o),this.isGeospatial){const f=this.projectPosition([t,n,0]);this.center=new ft(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:t=AJ,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:c=.1,far:f=1e3,padding:_=null,focalDistance:b=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new dn().multiplyRight(t).translate(new ft(this.center).negate()),this.projectionMatrix=n||gJ({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*dJ,focalDistance:b,padding:_,near:c,far:f});const T=Rp();Jf(T,T,this.projectionMatrix),Jf(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=C2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=lJ(this.viewMatrixInverse);const S=Rp(),D=Rp();ww(S,S,[this.width/2,-this.height/2,1]),o_(S,S,[1,-1,0]),Jf(D,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=C2(Rp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$r.warn("Pixel project matrix not invertible")()}}jl.displayName="Viewport";let lg=class D2 extends jl{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:_,farZ:b,orthographic:T=!1,projectionMatrix:S,repeat:D=!1,worldOffset:N=0,position:G,padding:W,legacyMeterSizes:z=!1}=e;let{width:j,height:K,altitude:fe=1.5}=e;const Z=Math.pow(2,i);j=j||1,K=K||1;let ae,Be=null;if(S)fe=S[5]/2,ae=cg(fe);else{e.fovy?(ae=e.fovy,fe=Sw(ae)):ae=cg(fe);let de;if(W){const{top:_e=0,bottom:pe=0}=W;de=[0,Ll((_e+K-pe)/2,0,K)-K/2]}Be=IW({width:j,height:K,scale:Z,center:G&&[0,0,G[2]*sb(t)],offset:de,pitch:o,fovy:ae,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(_)&&(Be.near=_),Number.isFinite(b)&&(Be.far=b)}let Le=SW({height:K,pitch:o,bearing:s,scale:Z,altitude:fe});N&&(Le=new dn().translate([512*N,0,0]).multiplyLeft(Le)),super({...e,width:j,height:K,viewMatrix:Le,longitude:n,latitude:t,zoom:i,...Be,fovy:ae,focalDistance:fe}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=fe,this.fovy=ae,this.orthographic=T,this._subViewports=D?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const o=i?new D2({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),i=(e[2]||0)*sb(e[1]);return[t,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),i=(e[2]||0)/sb(n);return[t,n,i]}addMetersToLngLat(e,t){return R6(e,t)}panByPosition(e,t){const n=Iw(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=dS([],i,CH([],n)),s=dS([],this.center,o),[c,f]=this.unprojectFlat(s);return{longitude:c,latitude:f}}getBounds(e={}){const t=RW(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:c}=MW({width:n,height:i,bounds:e,...t});return new D2({width:n,height:i,longitude:o,latitude:s,zoom:c})}};lg.displayName="WebMercatorViewport";const YS=[0,0,0];function ab(r,e,t=!1){const n=e.projectPosition(r);if(t&&e instanceof lg){const[i,o,s=0]=r,c=e.getDistanceScales([i,o]);n[2]=s*c.unitsPerMeter[2]}return n}function mJ(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=r;return i===Jr.DEFAULT&&(i=e.isGeospatial?Jr.LNGLAT:Jr.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function N6(r,{viewport:e,modelMatrix:t,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,c,f=0]=r;switch(t&&([s,c,f]=RA([],[s,c,f,1],t)),n){case Jr.LNGLAT:return ab([s,c,f],e,o);case Jr.LNGLAT_OFFSETS:return ab([s+i[0],c+i[1],f+(i[2]||0)],e,o);case Jr.METER_OFFSETS:return ab(R6(i,[s,c,f]),e,o);case Jr.CARTESIAN:default:return e.isGeospatial?[s+i[0],c+i[1],f+i[2]]:e.projectPosition([s,c,f])}}function _J(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:c}=mJ(e),{autoOffset:f=!0}=e,{geospatialOrigin:_=YS,shaderCoordinateOrigin:b=YS,offsetMode:T=!1}=f?M6(t,n,i):{},S=N6(r,{viewport:t,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:T});if(T){const D=t.projectPosition(_||b);a6(S,S,D)}return S}let yJ=1,vJ=1;class U6{constructor(){V(this,"time",0);V(this,"channels",new Map);V(this,"animations",new Map);V(this,"playing",!1);V(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,s=yJ++,c={time:0,delay:t,duration:n,rate:i,repeat:o};return this._setChannelTime(c,this.time),this.channels.set(s,c),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=vJ++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function bJ(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function xJ(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function qS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let ZS=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=qS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(qS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},wJ=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof ZS?i=e:i=new ZS(t,n),this.stats[t]=i),i}},CJ=0;const EJ={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:h2.stats.get(`animation-loop-${CJ++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class TJ{constructor(e){V(this,"device",null);V(this,"canvas",null);V(this,"props");V(this,"animationProps",null);V(this,"timeline",null);V(this,"stats");V(this,"cpuTime");V(this,"gpuTime");V(this,"frameRate");V(this,"display");V(this,"needsRedraw","initialized");V(this,"_initialized",!1);V(this,"_running",!1);V(this,"_animationFrameId",null);V(this,"_nextFramePromise",null);V(this,"_resolveNextFrame",null);V(this,"_cpuStartTime",0);V(this,"_error",null);if(this.props={...EJ,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new wJ({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,i;if(this.props.onError(e),this._error=Error(),((i=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const o=document.createElement("h1");o.innerHTML=e.message,o.style.position="absolute",o.style.top="20%",o.style.left="10px",o.style.color="black",o.style.backgroundColor="red",document.body.appendChild(o)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=bJ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(xJ(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,n;const e=(n=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var o,s,c,f;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((s=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:s.getPixelSize())||[1,1];let n=1;const i=(f=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:f.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const cb={};function lh(r="id"){cb[r]=cb[r]||1;const e=cb[r]++;return`${r}-${e}`}class QS{constructor(e){V(this,"id");V(this,"userData",{});V(this,"topology");V(this,"bufferLayout",[]);V(this,"vertexCount");V(this,"indices");V(this,"attributes");if(this.id=e.id||lh("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ni.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function BJ(r,e){if(e instanceof QS)return e;const t=SJ(r,e),{attributes:n,bufferLayout:i}=IJ(r,e);return new QS({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:n})}function SJ(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:Ni.INDEX,data:t})}function IJ(r,e){const t=[],n={};for(const[o,s]of Object.entries(e.attributes)){let c=o;switch(o){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(s){n[c]=r.createBuffer({data:s.value,id:`${o}-buffer`});const{value:f,size:_,normalized:b}=s;t.push({name:c,format:SV(f,_,b)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:i}}const ry=class ry{constructor(e){V(this,"device");V(this,"destroyPolicy");V(this,"_hashCounter",0);V(this,"_hashes",{});V(this,"_renderPipelineCache",{});V(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new ry(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...pA.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...r_.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof r_?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,n[t].useCount===0&&this.destroyPolicy==="unused"&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${n}V${i}BL${o}`;default:const s=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V${i}T${e.topology}P${s}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};V(ry,"defaultProps",{...pA.defaultProps});let L2=ry;const ny=class ny{constructor(e){V(this,"device");V(this,"destroyPolicy");V(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new ny(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};V(ny,"defaultProps",{...Qm.defaultProps});let k2=ny;function MJ(r,e){var i;const t={},n="Values";if(r.attributes.length===0&&!((i=r.varyings)!=null&&i.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const o of r.attributes)if(o){const s=`${o.location} ${o.name}: ${o.type}`;t[`in ${s}`]={[n]:o.stepMode||"vertex"}}for(const o of r.varyings||[]){const s=`${o.location} ${o.name}`;t[`out ${s}`]={[n]:JSON.stringify(o)}}return t}let Bs=null,If=null;function PJ(r,{id:e,minimap:t,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){Bs||(Bs=document.createElement("canvas"),Bs.id=e,Bs.title=e,Bs.style.zIndex="100",Bs.style.position="absolute",Bs.style.top=i,Bs.style.left=o,Bs.style.border="blue 5px solid",Bs.style.transform="scaleY(-1)",document.body.appendChild(Bs),If=Bs.getContext("2d")),(Bs.width!==r.width||Bs.height!==r.height)&&(Bs.width=r.width/2,Bs.height=r.height/2,Bs.style.width="400px",Bs.style.height="400px");const c=r.device.readPixelsToArrayWebGL(r),f=If==null?void 0:If.createImageData(r.width,r.height);if(f){for(let b=0;b<c.length;b+=4)f.data[0+b+0]=c[b+0]*s,f.data[0+b+1]=c[b+1]*s,f.data[0+b+2]=c[b+2]*s,f.data[0+b+3]=n?255:c[b+3]*s;If==null||If.putImageData(f,0,0)}}function N2(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!N2(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!N2(r[o],e[o],t-1))return!1;return!0}return!1}function RJ(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function FJ(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function z6(r){return RJ(r)||FJ(r)}function OJ(r){return z6(r)||typeof r=="number"||typeof r=="boolean"}function G6(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];OJ(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class DJ{constructor(e,t){V(this,"options",{disableWarnings:!1});V(this,"modules");V(this,"moduleUniforms");V(this,"moduleBindings");Object.assign(this.options,t);const n=dw(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Yt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,o]of Object.entries(e))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&Yt.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,o=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||Yt.warn(`Module ${n} not found`)();continue}const c=this.moduleUniforms[i],f=this.moduleBindings[i],_=((t=s.getUniforms)==null?void 0:t.call(s,o,c))||o,{uniforms:b,bindings:T}=G6(_);this.moduleUniforms[i]={...c,...b},this.moduleBindings[i]={...f,...T}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[o,s]of Object.entries(i))e[`${n}.${o}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[o],value:String(s)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let LJ="";async function kJ(r,e){const t=new Image;return t.crossOrigin="anonymous",t.src=r.startsWith("http")?r:LJ+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class lb{constructor(e,t){V(this,"device");V(this,"id");V(this,"texture");V(this,"sampler");V(this,"view");V(this,"ready");V(this,"isReady",!1);V(this,"destroyed",!1);V(this,"resolveReady",()=>{});V(this,"rejectReady",()=>{});this.device=e,this.id=t.id||lh("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:kJ(t.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,n;const i=e.data,o=await V6(i).then(t,n);if(this.destroyed)return;const s={...e,data:o};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function V6(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(V6));if(r&&typeof r=="object"&&r.constructor===Object){const e=r,t=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let o=0;o<n.length;o++)i[n[o]]=t[o];return i}return r}const Mf=2,NJ=1e4,iy=class iy{constructor(e,t){V(this,"device");V(this,"id");V(this,"source");V(this,"vs");V(this,"fs");V(this,"pipelineFactory");V(this,"shaderFactory");V(this,"userData",{});V(this,"parameters");V(this,"topology");V(this,"bufferLayout");V(this,"isInstanced");V(this,"instanceCount",0);V(this,"vertexCount");V(this,"indexBuffer",null);V(this,"bufferAttributes",{});V(this,"constantAttributes",{});V(this,"bindings",{});V(this,"uniforms",{});V(this,"vertexArray");V(this,"transformFeedback",null);V(this,"pipeline");V(this,"shaderInputs");V(this,"_uniformStore");V(this,"_attributeInfos",{});V(this,"_gpuGeometry",null);V(this,"_getModuleUniforms");V(this,"props");V(this,"_pipelineNeedsUpdate","newly created");V(this,"_needsRedraw","initializing");V(this,"_destroyed",!1);V(this,"_lastDrawTimestamp",-1);V(this,"_lastLogTime",0);V(this,"_logOpen",!1);V(this,"_drawCount",0);var f,_,b,T;this.props={...iy.defaultProps,...t},t=this.props,this.id=t.id||lh("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(((f=this.props.modules)==null?void 0:f.map(S=>[S.name,S]))||[]),i=t.shaderInputs||new DJ(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const o=zJ(e),s=(((_=this.props.modules)==null?void 0:_.length)>0?this.props.modules:(b=this.shaderInputs)==null?void 0:b.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:S,getUniforms:D}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:s});this.source=S,this._getModuleUniforms=D,(T=this.props).shaderLayout||(T.shaderLayout=fH(this.source))}else{const{vs:S,fs:D,getUniforms:N}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:s});this.vs=S,this.fs=D,this._getModuleUniforms=N}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||L2.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||k2.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Yt.info(Mf,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),U2(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const t=e&&BJ(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new Yv(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Yv(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){N2(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new BV(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(UJ(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&Yt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new Yv(this.bufferLayout);for(const[o,s]of Object.entries(e)){const c=i.getBufferLayout(o);if(!c){n||Yt.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const f=i.getAttributeNamesForBuffer(c);let _=!1;for(const b of f){const T=this._attributeInfos[b];T&&(this.vertexArray.setBuffer(T.location,s),_=!0)}!_&&!n&&Yt.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||Yt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){U2(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=G6(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof lb&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof lb?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Zm?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ni||t instanceof ki?e=Math.max(e,t.updateTimestamp):t instanceof lb?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof e_||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Yt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=UD(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Yt.level>3?0:NJ;Yt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Yt.group(Mf,`>>> DRAWING MODEL ${this.id}`,{collapsed:Yt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=MJ(this.pipeline.shaderLayout,this.id);Yt.table(Mf,e)();const t=this.shaderInputs.getDebugTable();for(const[i,o]of Object.entries(this.uniforms))t[i]={value:o};Yt.table(Mf,t)();const n=this._getAttributeDebugTable();Yt.table(Mf,this._attributeInfos)(),Yt.table(Mf,n)(),Yt.groupEnd(Mf)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&PJ(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=VD(t);return(e instanceof Ni?new n(e.debugData):e).toString()}};V(iy,"defaultProps",{...pA.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Ym.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Bi=iy;function UJ(r){return!!(r.uniformTypes&&!U2(r.uniformTypes))}function zJ(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function U2(r){for(const e in r)return!1;return!0}const ng=class ng{constructor(e,t=ng.defaultProps){V(this,"device");V(this,"model");V(this,"transformFeedback");if(!ng.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Bi(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||ID(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ni)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=t;return n.readAsync(i,o)}};V(ng,"defaultProps",{...Bi.defaultProps,outputs:void 0,feedbackBuffers:void 0});let yA=ng;const GJ="transform_output";class eI{constructor(e,t){V(this,"device");V(this,"model");V(this,"sampler");V(this,"currentIndex",0);V(this,"samplerTextureMap",null);V(this,"bindings",[]);V(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Bi(this.device,{id:t.id||"texture-transform-model",fs:t.fs||ID({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:GJ}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){var e;this.model.destroy();for(const t of this.bindings)(e=t.framebuffer)==null||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:n,targetTexture:i}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,t),i){e.targetTexture=i;const{width:o,height:s}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),e.framebuffer.resize({width:o,height:s})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const n in t)t[n].sampler=this.sampler}}class $s{constructor(e){V(this,"id");V(this,"topology");V(this,"vertexCount");V(this,"indices");V(this,"attributes");V(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||lh("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,s]of Object.entries(t)){const c=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!c.size&&(c.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[o]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:o,size:s,constant:c}=i;!c&&o&&s!==void 0&&s>=1&&(n=Math.min(n,o.length/s))}return n}}const VJ=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,HJ=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,tI=[-1,-1,1,-1,-1,1,1,1];class jJ extends Bi{constructor(e,t){const n=tI.map(i=>i===-1?0:i);t.source&&(t={...t,source:`${VJ}
${t.source}`}),super(e,{id:t.id||lh("clip-space"),...t,vs:HJ,vertexCount:4,geometry:new $s({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(tI)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class l_{constructor(e={}){V(this,"id");V(this,"matrix",new dn);V(this,"display",!0);V(this,"position",new ft);V(this,"rotation",new ft);V(this,"scale",new ft(1,1,1));V(this,"userData",{});V(this,"props",{});const{id:t}=e;this.id=t||lh(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:o=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(e={}){const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new dn(e).multiplyRight(t),i=n.invert(),o=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class oA extends l_{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:n=[]}=t;Yt.assert(n.every(i=>i instanceof l_),"every child must an instance of ScenegraphNode");super(t);V(this,"children");this.children=n}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,{worldMatrix:i})=>{const o=n.getBounds();if(!o)return;const[s,c]=o,f=new ft(s).add(c).divide([2,2,2]);i.transformAsPoint(f,f);const _=new ft(c).subtract(s).divide([2,2,2]);i.transformAsVector(_,_);for(let b=0;b<8;b++){const T=new ft(b&1?-1:1,b&2?-1:1,b&4?-1:1).multiply(_).add(f);for(let S=0;S<3;S++)t[0][S]=Math.min(t[0][S],T[S]),t[1][S]=Math.max(t[1][S],T[S])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const n=this.children,i=n.indexOf(t);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:n=new dn}={}){const i=new dn(n).multiplyRight(this.matrix);for(const o of this.children)o instanceof oA?o.traverse(t,{worldMatrix:i}):t(o,{worldMatrix:i})}}class z2 extends l_{constructor(t){super(t);V(this,"model");V(this,"bounds",null);V(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}class H6 extends $s{constructor(e={}){const{id:t=lh("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:t,topology:"triangle-list",indices:{size:1,value:$J},attributes:{...ZJ,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...QJ,...e.attributes}})}}const $J=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),WJ=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),JJ=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),XJ=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),KJ=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),YJ=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),qJ=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),ZJ={POSITION:{size:3,value:WJ},NORMAL:{size:3,value:JJ},TEXCOORD_0:{size:2,value:XJ}},QJ={POSITION:{size:3,value:KJ},TEXCOORD_0:{size:2,value:YJ},COLOR_0:{size:3,value:qJ}},eX=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,tX={name:"screen",fs:eX,uniformTypes:{texSize:"vec2<f32>"}};class rX extends D6{constructor(e,t){super(e,t);const{module:n,fs:i,id:o}=t,s={depthWriteEnabled:!1,depthCompare:"always"};this.model=new jJ(e,{id:o,fs:i,modules:[n,tX],parameters:s})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,t){const{clearCanvas:n,inputBuffer:i,outputBuffer:o}=t,s=[i.width,i.height],c={texSrc:i.colorAttachments[0],texSize:s};this.model.shaderInputs.setProps({screen:c,...t.moduleProps});const f=this.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,...s]},clearColor:n?[0,0,0,0]:!1,clearDepth:1});this.model.draw(f),f.end()}}class nX{constructor(e,t){this.id=`${e.name}-pass`,this.props=t,vD(e),this.module=e}setup({device:e}){this.passes=iX(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const t=this.passes,{target:n}=e;let i=e.inputBuffer,o=e.swapBuffer;for(let s=0;s<t.length;s++){const c=s===t.length-1,f=n!==void 0&&c;f&&(o=n);const _=!f||!!e.clearCanvas,b={},T=this.module.passes[s].uniforms;b[this.module.name]={...this.props,...T},t[s].render({clearCanvas:_,inputBuffer:i,outputBuffer:o,moduleProps:b});const S=o;o=i,i=S}return i}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function iX(r,e,t){return e.passes.map((n,i)=>{const o=aX(e,n),s=`${t}-${i}`;return new rX(r,{id:s,module:e,fs:o})})}const j6=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,sX=r=>`${j6}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${r}(fragColor, screen.texSize, coordinate);
}
`,oX=r=>`${j6}
void main() {
  fragColor = ${r}(texSrc, screen.texSize, coordinate);
}
`;function aX(r,e){if(e.filter){const t=typeof e.filter=="string"?e.filter:`${r.name}_filterColor_ext`;return sX(t)}if(e.sampler){const t=typeof e.sampler=="string"?e.sampler:`${r.name}_sampleColor`;return oX(t)}return""}const cX={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class $6 extends fy{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:c,y:f,width:_,height:b},cullRect:T,effects:S,pass:D="picking",pickZ:N,shaderModuleProps:G}){this.pickZ=N;const W=this._resetColorEncoder(N),z=[c,f,_,b],j=super.render({target:s,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:o,cullRect:T,effects:S==null?void 0:S.filter(fe=>fe.useInPicking),pass:D,isPicking:!0,shaderModuleProps:G,clearColor:[0,0,0,0],colorMask:15,scissorRect:z});return this._colorEncoderState=null,{decodePickingColor:W&&uX.bind(null,W),stats:j}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:o,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:o&&s.includes("draw")&&(Object.assign(i,cX),i.blend=!0,i.blendColor=lX(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function lX(r,e,t){const{byLayer:n,byAlpha:i}=r;let o,s=n.get(e);return s?(s.viewports.push(t),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:e,viewports:[t]},n.set(e,s),i[o]=s):($r.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function uX(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const zd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},u_=Symbol.for("component"),Nu=Symbol.for("propTypes"),ub=Symbol.for("deprecatedProps"),aA=Symbol.for("asyncPropDefaults"),Qf=Symbol.for("asyncPropOriginal"),Ou=Symbol.for("asyncPropResolved");function hy(r,e=()=>!0){return Array.isArray(r)?W6(r,e,[]):e(r)?[r]:[]}function W6(r,e,t){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?W6(i,e,t):e(i)&&t.push(i)}return t}function fX({target:r,source:e,start:t=0,count:n=1}){const i=e.length,o=n*i;let s=0;for(let c=t;s<i;s++)r[c++]=e[s];for(;s<o;)s<o-s?(r.copyWithin(t+s,t,t+s),s*=2):(r.copyWithin(t+s,t,t+o-s),s=o);return r}function rI(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let nI=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=rI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(rI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},J6=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof nI?i=e:i=new nI(t,n),this.stats[t]=i),i}};class hX{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=s2(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class dX{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(t,n):(o=new hX(e,t,this._context),this._resources[e]=o),o.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const n in t){const i=t[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:o,protocol:s}=this;e.startsWith(s)&&(e=e.replace(s,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=o[e];if(this._track(n,i,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const o=this._consumers,s=o[e]=o[e]||{};let c=s[t];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),n&&(c?(c.onChange=i,c.resourceId=n.id):c={onChange:i,resourceId:n.id},s[t]=c,n.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const AX="layerManager.setLayers",pX="layerManager.activateViewport";class gX{constructor(e,t){var c;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{oo(pX,this,f),f&&(this.context.viewport=f)};const{deck:n,stats:i,viewport:o,timeline:s}=t||{};this.layers=[],this.resourceManager=new dX({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:KW(((c=e==null?void 0:e.info)==null?void 0:c.shadingLanguage)||"glsl"),defaultShaderModules:[s$],renderPass:void 0,stats:i||new J6({id:"deck.gl"}),viewport:o||new jl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new U6,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){oo(AX,this,t,e),this._lastRenderedLayers=e;const n=hy(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(i=>i.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const s of e)n[s.id]?$r.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of e)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let o=!1;for(const s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const o=t[i.id];o===null&&$r.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(c){this._handleError("matching",c,i)}s&&this._updateSublayersRecursively(s,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=zd.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=zd.MATCHED,t!==e&&(e.lifecycle=zd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=zd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=zd.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Ki(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!Ki(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!Ki(r[o],e[o],t-1))return!1;return!0}return!1}class mX{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let o=n.length-1;o>=0;--o){const s=n[o];if(s.containsPixel(i)){const c=e.slice();return c[0]-=s.x,c[1]-=s.y,s.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=hy(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ki(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):$r.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var s;return(s=this.getView(e.id))==null?void 0:s.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,n,i){const o=e.controller;if(o&&n){const s={...t,...o,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const o=e[i],s=this.getViewState(o),c=o.makeViewport({viewState:s,width:this.width,height:this.height});let f=t[o.id];const _=!!o.controller;_&&!f&&(n=!0),(n||!_)&&f&&(f.finalize(),f=null),this.controllers[o.id]=this._updateController(o,s,c,f),c&&this._viewports.unshift(c)}for(const i in t){const o=t[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,i)=>!e[i].equals(t[i]))}}const _X=/([0-9]+\.?[0-9]*)(%|px)/;function xu(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=_X.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function wu(r,e){return r.relative?Math.round(r.position*e):r.position}class vA{constructor(e){const{id:t,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xu(n),this._y=xu(i),this._width=xu(o),this._height=xu(s),this._padding=c&&{left:xu(c.left||0),right:xu(c.right||0),top:xu(c.top||0),bottom:xu(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ki(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const o=this.getViewportType(n);return new o({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions({width:e,height:t}){const n={x:wu(this._x,e),y:wu(this._y,t),width:wu(this._width,e),height:wu(this._height,t)};return this._padding&&(n.padding={left:wu(this._padding.left,e),top:wu(this._padding.top,t),right:wu(this._padding.right,e),bottom:wu(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class dy{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(t=this.settings).onStart)==null||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const iI=()=>{},G2={BREAK:1,SNAP_TO_END:2,IGNORE:3},yX=r=>r,vX=G2.BREAK;let bX=class{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:i,startProps:o,endProps:s,duration:c,easing:f}}=t,_=f(n/c),b=i.interpolateProps(o,s,_);this.propsInTransition=this.getControllerState({...this.props,...b}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new dy(e.timeline),this.onViewStateChange=e.onViewStateChange||iI,this.onStateChange=e.onStateChange||iI}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:o,endProps:s}=this.transition.settings;i={...n,...o===G2.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===G2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),o=t.transitionInterpolator,s=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(s===0)return;const c=o.initializeProps(e,i);this.propsInTransition={};const f={duration:s,easing:t.transitionEasing||yX,interpolator:o,interruption:t.transitionInterruption||vX,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}};function js(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}let xX=class{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!aa(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const o of this._propsToExtract)(o in e||o in t)&&(n[o]=e[o],i[o]=t[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];js(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}};const wX=["longitude","latitude","zoom","bearing","pitch"],CX=["longitude","latitude","zoom"];let X6=class extends xX{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:wX,required:CX},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:o}=this.opts;if(i&&o){const s=i(e),c=i(t),f=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:c.project(f),aroundPosition:f,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const o of this._propsToExtract)i[o]=dc(e[o]||0,t[o]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...i});Object.assign(i,o.panByPosition(t.aroundPosition,dc(e.around,t.around,n)))}return i}};const Cu={transitionDuration:0},EX=300,L0=r=>1-(1-r)*(1-r),gd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Pf={};class TX{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new bX({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?EX:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:_=!0}=e,b=!!this.onViewStateChange;this.toggleEvents(gd.WHEEL,b&&n),this.toggleEvents(gd.PAN,b),this.toggleEvents(gd.PINCH,b&&(c||f)),this.toggleEvents(gd.MULTI_PAN,b&&f),this.toggleEvents(gd.DOUBLE_CLICK,b&&s),this.toggleEvents(gd.KEYBOARD,b&&_),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=c,this.touchRotate=f,this.keyboard=_}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),o){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Cu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Cu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:L0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Cu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:L0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);const c=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(c,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Cu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Cu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:L0},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Pf._startPinchRotation=e.rotation,Pf._lastPinchEvent=e,this.updateViewport(n,Cu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Pf._startPinchRotation-n})}return this.updateViewport(t,Cu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Pf;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const s=Math.log2(e.scale),c=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),f=Math.pow(2,s+c*t/2);o=o.zoom({pos:i,scale:f}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:L0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pf._startPinchRotation=null,Pf._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const _={};switch(e.srcEvent.code){case"Minus":f=t?c.zoomOut(n).zoomOut(n):c.zoomOut(n),_.isZooming=!0;break;case"Equal":f=t?c.zoomIn(n).zoomIn(n):c.zoomIn(n),_.isZooming=!0;break;case"ArrowLeft":t?(f=c.rotateLeft(o),_.isRotating=!0):(f=c.moveLeft(i),_.isPanning=!0);break;case"ArrowRight":t?(f=c.rotateRight(o),_.isRotating=!0):(f=c.moveRight(i),_.isPanning=!0);break;case"ArrowUp":t?(f=c.rotateUp(s),_.isRotating=!0):(f=c.moveUp(i),_.isPanning=!0);break;case"ArrowDown":t?(f=c.rotateDown(s),_.isRotating=!0):(f=c.moveDown(i),_.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),_),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Cu:e?{...t,transitionInterpolator:new X6({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class BX{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const sI=5,SX=1.2;let IX=class extends BX{constructor(e){const{width:t,height:n,latitude:i,longitude:o,zoom:s,bearing:c=0,pitch:f=0,altitude:_=1.5,position:b=[0,0,0],maxZoom:T=20,minZoom:S=0,maxPitch:D=60,minPitch:N=0,startPanLngLat:G,startZoomLngLat:W,startRotatePos:z,startBearing:j,startPitch:K,startZoom:fe,normalize:Z=!0}=e;js(Number.isFinite(o)),js(Number.isFinite(i)),js(Number.isFinite(s)),super({width:t,height:n,latitude:i,longitude:o,zoom:s,bearing:c,pitch:f,altitude:_,maxZoom:T,minZoom:S,maxPitch:D,minPitch:N,normalize:Z,position:b},{startPanLngLat:G,startZoomLngLat:W,startRotatePos:z,startBearing:j,startPitch:K,startZoom:fe}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||o===void 0||s===void 0)return this;let c;return e?c=this._getNewRotation(e,i,s,o):c={bearing:o+t,pitch:s+n},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:s,minZoom:c}=this.getViewportProps();let f=i+Math.log2(n);f=Ll(f,c,s);const _=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,..._.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-t.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Ll(i,n,t);const{maxPitch:o,minPitch:s,pitch:c}=e;e.pitch=Ll(c,s,o);const{normalize:f=!0}=e;return f&&Object.assign(e,FW(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const o=e[0]-t[0],s=e[1]-t[1],c=e[1],f=t[1],{width:_,height:b}=this.getViewportProps(),T=o/_;let S=0;s>0?Math.abs(b-f)>sI&&(S=s/(f-b)*SX):s<0&&f>sI&&(S=1-c/f),S=Ll(S,-1,1);const{minPitch:D,maxPitch:N}=this.getViewportProps(),G=i+180*T;let W=n;return S>0?W=n+S*(N-n):S<0&&(W=n-S*(D-n)),{pitch:W,bearing:G}}},MX=class extends TX{constructor(){super(...arguments),this.ControllerState=IX,this.transition={transitionDuration:300,transitionInterpolator:new X6({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class K6 extends vA{constructor(e={}){super(e)}getViewportType(){return lg}get ControllerType(){return MX}}K6.displayName="MapView";const PX=new k6;function RX(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class FX{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(i=>RX(i,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ki(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const o=t[i.id];let s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof k6)||this._resolvedEffects.push(PX),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class OX extends fy{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const DX="deckRenderer.renderLayers";class LX{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new OX(e),this.pickLayersPass=new $6(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,oo(DX,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const o of e)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?t.target:void 0;const s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}}const kX={pickedColor:null,pickedObjectIndex:-1};function NX({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:n,deviceRadius:i,deviceRect:o}){const{x:s,y:c,width:f,height:_}=o;let b=i*i,T=-1,S=0;for(let D=0;D<_;D++){const N=D+c-n,G=N*N;if(G>b)S+=4*f;else for(let W=0;W<f;W++){if(r[S+3]-1>=0){const j=W+s-t,K=j*j+G;K<=b&&(b=K,T=S)}S+=4}}if(T>=0){const D=r.slice(T,T+4),N=e(D);if(N){const G=Math.floor(T/4/f),W=T/4-G*f;return{...N,pickedColor:D,pickedX:s+W,pickedY:c+G}}$r.error("Picked non-existent layer. Is picking buffer corrupt?")()}return kX}function UX({pickedColors:r,decodePickingColor:e}){const t=new Map;if(r){for(let n=0;n<r.length;n+=4)if(r[n+3]-1>=0){const o=r.slice(n,n+4),s=o.join(",");if(!t.has(s)){const c=e(o);c?t.set(s,{...c,color:o}):$r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function Y6({pickInfo:r,viewports:e,pixelRatio:t,x:n,y:i,z:o}){let s=e[0];e.length>1&&(s=GX((r==null?void 0:r.pickedViewports)||e,{x:n,y:i}));let c;if(s){const f=[n-s.x,i-s.y];o!==void 0&&(f[2]=o),c=s.unproject(f)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:c,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function zX(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:i}=r,{pickedColor:o,pickedLayer:s,pickedObjectIndex:c}=e,f=s?[s]:[];if(n==="hover"){const T=t.index,S=t.layerId,D=s?s.props.id:null;if(D!==S||c!==T){if(D!==S){const N=i.find(G=>G.props.id===S);N&&f.unshift(N)}t.layerId=D,t.index=c,t.info=null}}const _=Y6(r),b=new Map;return b.set(null,_),f.forEach(T=>{let S={..._};T===s&&(S.color=o,S.index=c,S.picked=!0),S=q6({layer:T,info:S,mode:n});const D=S.layer;T===s&&n==="hover"&&(t.info=S),b.set(D.id,S),n==="hover"&&D.updateAutoHighlight(S)}),b}function q6({layer:r,info:e,mode:t}){for(;r&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:n}),r=r.parent}return e}function GX(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class VX{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new $6(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},o=this.lastPickedInfo.info){const s=o&&o.layer&&o.layer.id,c=o&&o.viewport&&o.viewport.id,f=s?n.find(S=>S.id===s):null,_=c&&i.find(S=>S.id===c)||i[0],b=_&&_.unproject([e-_.x,t-_.y]);return{...o,...{x:e,y:t,viewport:_,coordinate:b,layer:f}}}_resizeBuffer(){var t,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:o,radius:s=0,depth:c=1,mode:f="query",unproject3D:_,onViewportActive:b,effects:T}){const S=this.device.canvasContext.cssToDeviceRatio(),D=this._getPickable(e);if(!D||n.length===0)return{result:[],emptyInfo:Y6({viewports:n,x:i,y:o,pixelRatio:S})};this._resizeBuffer();const N=this.device.canvasContext.cssToDevicePixels([i,o],!0),G=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],W=Math.round(s*S),{width:z,height:j}=this.pickingFBO,K=this._getPickingRect({deviceX:G[0],deviceY:G[1],deviceRadius:W,deviceWidth:z,deviceHeight:j}),fe={x:i-s,y:o-s,width:s*2+1,height:s*2+1};let Z;const ae=[],Be=new Set;for(let Le=0;Le<c;Le++){let de;if(K){const pe=this._drawAndSample({layers:D,views:t,viewports:n,onViewportActive:b,deviceRect:K,cullRect:fe,effects:T,pass:`picking:${f}`});de=NX({...pe,deviceX:G[0],deviceY:G[1],deviceRadius:W,deviceRect:K})}else de={pickedColor:null,pickedObjectIndex:-1};let _e;if(de.pickedLayer&&_&&this.depthFBO){const{pickedColors:pe}=this._drawAndSample({layers:[de.pickedLayer],views:t,viewports:n,onViewportActive:b,deviceRect:{x:de.pickedX,y:de.pickedY,width:1,height:1},cullRect:fe,effects:T,pass:`picking:${f}:z`},!0);pe[3]&&(_e=pe[0])}de.pickedLayer&&Le+1<c&&(Be.add(de.pickedLayer),de.pickedLayer.disablePickingIndex(de.pickedObjectIndex)),Z=zX({pickInfo:de,lastPickedInfo:this.lastPickedInfo,mode:f,layers:D,viewports:n,x:i,y:o,z:_e,pixelRatio:S});for(const pe of Z.values())pe.layer&&ae.push(pe);if(!de.pickedColor)break}for(const Le of Be)Le.restorePickingColors();return{result:ae,emptyInfo:Z.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:o,width:s=1,height:c=1,mode:f="query",maxObjects:_=null,onViewportActive:b,effects:T}){const S=this._getPickable(e);if(!S||n.length===0)return[];this._resizeBuffer();const D=this.device.canvasContext.cssToDeviceRatio(),N=this.device.canvasContext.cssToDevicePixels([i,o],!0),G=N.x,W=N.y+N.height,z=this.device.canvasContext.cssToDevicePixels([i+s,o+c],!0),j=z.x+z.width,K=z.y,fe={x:G,y:K,width:j-G,height:W-K},Z=this._drawAndSample({layers:S,views:t,viewports:n,onViewportActive:b,deviceRect:fe,cullRect:{x:i,y:o,width:s,height:c},effects:T,pass:`picking:${f}`}),ae=UX(Z),Be=new Map,Le=[],de=Number.isFinite(_);for(let _e=0;_e<ae.length&&!(de&&Le.length>=_);_e++){const pe=ae[_e];let J={color:pe.pickedColor,layer:null,index:pe.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:D};J=q6({layer:pe.pickedLayer,info:J,mode:f});const ne=J.layer.id;Be.has(ne)||Be.set(ne,new Set);const ye=Be.get(ne),Ye=J.object??J.index;ye.has(Ye)||(ye.add(Ye),Le.push(J))}return Le}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:c,pass:f},_=!1){const b=_?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:b,deviceRect:o,cullRect:s,effects:c,pass:f,pickZ:_,preRenderStats:{},isPicking:!0};for(const j of c)j.useInPicking&&(T.preRenderStats[j.id]=j.preRender(T));const{decodePickingColor:S}=this.pickLayersPass.render(T),{x:D,y:N,width:G,height:W}=o,z=new(_?Float32Array:Uint8Array)(G*W*4);return this.device.readPixelsToArrayWebGL(b,{sourceX:D,sourceY:N,sourceWidth:G,sourceHeight:W,target:z}),{pickedColors:z,decodePickingColor:S}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:o}){const s=Math.max(0,e-n),c=Math.max(0,t-n),f=Math.min(i,e+n+1)-s,_=Math.min(o,t+n+1)-c;return f<=0||_<=0?null:{x:s,y:c,width:f,height:_}}}const HX={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},jX="top-left",oI="__root";class $X{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ki(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=t[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const i=t[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=jX}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var s;const n=e||oI;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(s=this.parentElement)==null||s.append(i),this.containers[n]=i);let o=i.querySelector(`.${t}`);return o||(o=document.createElement("div"),o.className=t,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,HX[t]),i.append(o)),o}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,o=n===oI||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:t}px`):s.style.display="none"}}onRedraw({viewports:e,layers:t}){var i,o;const n=e.reduce((s,c)=>(s[c.id]=c,s),{});for(const s of this.getWidgets()){const{viewId:c}=s;if(c){const f=n[c];f&&(s.onViewportChange&&s.onViewportChange(f),(i=s.onRedraw)==null||i.call(s,{viewports:[f],layers:t}))}else{if(s.onViewportChange)for(const f of e)s.onViewportChange(f);(o=s.onRedraw)==null||o.call(s,{viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){var n,i;for(const o of this.getWidgets()){const{viewId:s}=o;(!s||s===((n=e.viewport)==null?void 0:n.id))&&((i=o.onHover)==null||i.call(o,e,t))}}onEvent(e,t){var i,o;const n=M2[t.type];if(n)for(const s of this.getWidgets()){const{viewId:c}=s;(!c||c===((i=e.viewport)==null?void 0:i.id))&&((o=s[n])==null||o.call(s,e,t))}}}const WX={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class JX{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,WX),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var $d;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})($d||($d={}));const Mw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ss=(r,e,t)=>e?r.enable(t):r.disable(t),aI=(r,e,t)=>r.hint(t,e),Qo=(r,e,t)=>r.pixelStorei(t,e),cI=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},bp=(r,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(i,e)};function fb(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const XX={3042:ss,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:ss,2885:(r,e)=>r.cullFace(e),2929:ss,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:ss,35723:aI,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>{var t;return(t=r.bindTransformFeedback)==null?void 0:t.call(r,36386,e)},34229:(r,e)=>r.bindVertexArray(e),36006:cI,36010:cI,34964:bp,36662:bp,36663:bp,35053:bp,35055:bp,2886:(r,e)=>r.frontFace(e),33170:aI,2849:(r,e)=>r.lineWidth(e),32823:ss,32824:"polygonOffset",10752:"polygonOffset",35977:ss,32926:ss,32928:ss,32938:"sampleCoverage",32939:"sampleCoverage",3089:ss,3088:(r,e)=>r.scissor(...e),2960:ss,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:ss,10754:ss,12288:ss,12289:ss,12290:ss,12291:ss,12292:ss,12293:ss,12294:ss,12295:ss,3333:Qo,3317:Qo,37440:Qo,37441:Qo,37443:Qo,3330:Qo,3332:Qo,3331:Qo,3314:Qo,32878:Qo,3316:Qo,3315:Qo,32877:Qo,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=fb(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=fb(e)&&e.length===3?[...e,...e]:e;const[t,n,i,o,s,c]=e;r.stencilFuncSeparate(1028,t,n,i),r.stencilFuncSeparate(1029,o,s,c)},stencilOp:(r,e)=>{e=fb(e)&&e.length===3?[...e,...e]:e;const[t,n,i,o,s,c]=e;r.stencilOpSeparate(1028,t,n,i),r.stencilOpSeparate(1029,o,s,c)},viewport:(r,e)=>r.viewport(...e)};function Xi(r,e,t){return e[r]!==void 0?e[r]:t[r]}const KX={blendEquation:(r,e,t)=>r.blendEquationSeparate(Xi(32777,e,t),Xi(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(Xi(32969,e,t),Xi(32968,e,t),Xi(32971,e,t),Xi(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(Xi(32824,e,t),Xi(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(Xi(32938,e,t),Xi(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,Xi(2962,e,t),Xi(2967,e,t),Xi(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,Xi(34816,e,t),Xi(36003,e,t),Xi(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,Xi(2964,e,t),Xi(2965,e,t),Xi(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,Xi(34817,e,t),Xi(34818,e,t),Xi(34819,e,t))},lI={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,i)=>r({32773:new Float32Array([e,t,n,i])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,i)=>r({32969:e,32968:t,32971:n,32970:i}),clearColor:(r,e,t,n,i)=>r({3106:new Float32Array([e,t,n,i])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,i)=>r({3107:[e,t,n,i]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,i)=>r({3088:new Int32Array([e,t,n,i])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,i)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,i)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(r,e,t,n,i)=>r({2978:[e,t,n,i]})},jc=(r,e)=>r.isEnabled(e),uI={3042:jc,2884:jc,2929:jc,3024:jc,32823:jc,32926:jc,32928:jc,3089:jc,2960:jc,35977:jc},YX=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function FA(r,e){if(ZX(e))return;const t={};for(const i in e){const o=Number(i),s=XX[i];s&&(typeof s=="string"?t[s]=!0:s(r,e[i],o))}const n=r.state&&r.state.cache;if(n)for(const i in t){const o=KX[i];o(r,e,n)}}function Z6(r,e=Mw){if(typeof e=="number"){const i=e,o=uI[i];return o?o(r,i):r.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const i of t){const o=uI[i];n[i]=o?o(r,Number(i)):r.getParameter(Number(i))}return n}function qX(r){FA(r,Mw)}function ZX(r){for(const e in r)return!1;return!0}function QX(r,e){if(r===e)return!0;const t=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&n&&r.length===e.length){for(let i=0;i<r.length;++i)if(r[i]!==e[i])return!1;return!0}return!1}class Xf{constructor(e,t){V(this,"gl");V(this,"program",null);V(this,"stateStack",[]);V(this,"enable",!0);V(this,"cache",null);V(this,"log");V(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];FA(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?Z6(e):Object.assign({},Mw),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,tK(e);for(const n in lI){const i=lI[n];eK(e,n,i)}fI(e,"getParameter"),fI(e,"isEnabled")}_updateCache(e){let t=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const s=e[o],c=this.cache[o];QX(s,c)||(t=!0,n=c,i&&!(o in i)&&(i[o]=c),this.cache[o]=s)}return{valueChanged:t,oldValue:n}}}function fI(r,e){const t=r[e].bind(r);r[e]=function(i){if(i===void 0||YX.has(i))return t(i);const o=Xf.get(r);return i in o.cache||(o.cache[i]=t(i)),o.enable?o.cache[i]:t(i)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function eK(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(...o){const s=Xf.get(r),{valueChanged:c,oldValue:f}=t(s._updateCache,...o);return c&&n(...o),f},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function tK(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const i=Xf.get(r);i.program!==n&&(e(n),i.program=n)}}function rK(r,e,t){let n="";const i={preserveDrawingBuffer:!0,...t};let o=null;if(o||(o=r.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!o&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,o=r.getContext("webgl2",i),o.luma||(o.luma={}),o.luma.softwareRenderer=!0),o||(o=r.getContext("webgl",{}),o&&(o=null,n||(n="Your browser only supports WebGL1"))),!o)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:s,onContextRestored:c}=e;return r.addEventListener("webglcontextlost",f=>s(f),!1),r.addEventListener("webglcontextrestored",f=>c(f),!1),o.luma||(o.luma={}),o}function bA(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function nK(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);bA(r,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,o=r.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=r.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),c=o||t,f=s||n,_=r.getParameter(7938),b=Q6(c,f),T=iK(c,f),S=sK(c,f);return{type:"webgl",gpu:b,gpuType:S,gpuBackend:T,vendor:c,renderer:f,version:_,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Q6(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function iK(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function sK(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(Q6(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function e4(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const Fp="WEBGL_compressed_texture_s3tc",Op="WEBGL_compressed_texture_s3tc_srgb",Wd="EXT_texture_compression_rgtc",Jd="EXT_texture_compression_bptc",oK="WEBGL_compressed_texture_etc",aK="WEBGL_compressed_texture_astc",cK="WEBGL_compressed_texture_etc1",lK="WEBGL_compressed_texture_pvrtc",uK="WEBGL_compressed_texture_atc",hI="EXT_texture_norm16",dI="EXT_render_snorm",fK="EXT_color_buffer_float",Pw={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[dI],"norm16-renderable-webgl":[hI],"snorm16-renderable-webgl":[hI,dI],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Fp,Op,Wd,Jd],"texture-compression-bc5-webgl":[Wd],"texture-compression-bc7-webgl":[Jd],"texture-compression-etc2":[oK],"texture-compression-astc":[aK],"texture-compression-etc1-webgl":[cK],"texture-compression-pvrtc-webgl":[lK],"texture-compression-atc-webgl":[uK]};function hK(r){return r in Pw}function dK(r,e,t){return(Pw[e]||[]).every(i=>bA(r,i,t))}const Rw={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:fK,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Fp},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Op},"bc1-rgba-unorm":{gl:33777,x:Fp},"bc1-rgba-unorm-srgb":{gl:35916,x:Op},"bc2-rgba-unorm":{gl:33778,x:Fp},"bc2-rgba-unorm-srgb":{gl:35918,x:Op},"bc3-rgba-unorm":{gl:33779,x:Fp},"bc3-rgba-unorm-srgb":{gl:35919,x:Op},"bc4-r-unorm":{gl:36283,x:Wd},"bc4-r-snorm":{gl:36284,x:Wd},"bc5-rg-unorm":{gl:36285,x:Wd},"bc5-rg-snorm":{gl:36286,x:Wd},"bc6h-rgb-ufloat":{gl:36495,x:Jd},"bc6h-rgb-float":{gl:36494,x:Jd},"bc7-rgba-unorm":{gl:36492,x:Jd},"bc7-rgba-unorm-srgb":{gl:36493,x:Jd},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function AK(r,e,t){let n=e.create;const i=Rw[e.format];return(i==null?void 0:i.gl)===void 0&&(n=!1),i!=null&&i.x&&(n=n&&!!bA(r,i.x,t)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function t4(r){var i;const e=Rw[r],t=mK(r),n=pw(r);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||gK(n.channels,n.integer,n.normalized,t),type:n.dataType?e4(n.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:n.compressed||!1}}function pK(r){switch(pw(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function gK(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function mK(r){const e=Rw[r],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}const AI={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class _K extends W7{constructor(t,n,i){super([],i);V(this,"gl");V(this,"extensions");V(this,"testedFeatures",new Set);this.gl=t,this.extensions=n,bA(t,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const t=this.getFeatures();for(const n of t)this.has(n)&&(yield n);return[]}has(t){var n;return(n=this.disabledFeatures)!=null&&n[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),hK(t)&&dK(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of t)this.has(n)}getFeatures(){return[...Object.keys(AI),...Object.keys(Pw)]}getWebGLFeature(t){const n=AI[t];return typeof n=="string"?!!bA(this.gl,n,this.extensions):!!n}}class yK extends $7{constructor(t){super();V(this,"gl");V(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class jp extends t_{constructor(t,n){super(t,n);V(this,"device");V(this,"gl");V(this,"handle");V(this,"colorAttachments",[]);V(this,"depthStencilAttachment",null);const i=n.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const i=this.colorAttachments[n];if(i){const o=36064+n;this._attachTextureView(o,i)}}if(this.depthStencilAttachment){const n=pK(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${bK(n)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,n){const{gl:i}=this.device,{texture:o}=n,s=n.props.baseMipLevel,c=n.props.baseArrayLayer;switch(i.bindTexture(o.glTarget,o.handle),o.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,o.handle,s,c);break;case 34067:const f=vK(c);i.framebufferTexture2D(36160,t,f,o.handle,s);break;case 3553:i.framebufferTexture2D(36160,t,3553,o.handle,s);break;default:throw new Error("Illegal texture type")}i.bindTexture(o.glTarget,null)}}function vK(r){return r<34069?r+34069:r}function bK(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class xK extends d2{constructor(t,n){super(n);V(this,"device");V(this,"format","rgba8unorm");V(this,"depthStencilFormat","depth24plus");V(this,"presentationSize");V(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new jp(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(n,t);return}}commit(){}}async function r4(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${r}': ${s}`)),t.appendChild(n)})}const wK=1;let pi=null,pI=!1;const Fw={debugSpectorJS:Yt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function CK(r){if(!globalThis.SPECTOR)try{await r4(r.debugSpectorJSUrl||Fw.debugSpectorJSUrl)}catch(e){Yt.warn(String(e))}}function EK(r){var e;if(r={...Fw,...r},!r.debugSpectorJS)return null;if(!pi&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){Yt.probe(wK,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;pi=new t,globalThis.luma&&(globalThis.luma.spector=pi)}if(!pi)return null;if(pI||(pI=!0,pi.spyCanvases(),pi==null||pi.onCaptureStarted.add(t=>Yt.info("Spector capture started:",t)()),pi==null||pi.onCapture.add(t=>{Yt.info("Spector capture complete:",t)(),pi==null||pi.getResultUI(),pi==null||pi.resultView.display(),pi==null||pi.resultView.addCapture(t)})),r.gl){const t=r.gl,n=t.device;pi==null||pi.startCapture(r.gl,500),t.device=n,new Promise(i=>setTimeout(i,2e3)).then(i=>{Yt.info("Spector capture stopped after 2 seconds")(),pi==null||pi.stopCapture()})}return pi}const TK="https://unpkg.com/webgl-debug@2.0.1/index.js";function n4(r){return r.luma=r.luma||{},r.luma}async function BK(){il()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await r4(TK))}function SK(r,e={}){return e.debugWebGL||e.traceWebGL?MK(r,e):IK(r)}function IK(r){const e=n4(r);return e.realContext?e.realContext:r}function MK(r,e){if(!globalThis.WebGLDebugUtils)return Yt.warn("webgl-debug not loaded")(),r;const t=n4(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...$d,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,PK.bind(null,e),RK.bind(null,e));for(const s in $d)!(s in n)&&typeof $d[s]=="number"&&(n[s]=$d[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(i,n);const o=Object.create(i);return t.realContext=r,t.debugContext=o,o.debug=!0,o}function gI(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function PK(r,e,t,n){n=Array.from(n).map(c=>c===void 0?"undefined":c);const i=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),s=`${i} in gl.${t}(${o})`;Yt.error(s)();debugger}function RK(r,e,t){let n="";Yt.level>=1&&(n=gI(e,t),r.traceWebGL&&Yt.log(1,n)());for(const i of t)if(i===void 0){n=n||gI(e,t);debugger}}const hb={};function FK(r="id"){hb[r]=hb[r]||1;const e=hb[r]++;return`${r}-${e}`}class $p extends Ni{constructor(t,n={}){super(t,n);V(this,"device");V(this,"gl");V(this,"handle");V(this,"glTarget");V(this,"glUsage");V(this,"glIndexType",5123);V(this,"byteLength");V(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=OK(this.props.usage),this.glUsage=DK(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(t,n=0,i=t.byteLength+n){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.glUsage),this.gl.bufferSubData(o,n,t),this.gl.bindBuffer(o,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let n=t;t===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,n,t.byteLength)}async readAsync(t=0,n){return this.readSyncWebGL(t,n)}readSyncWebGL(t=0,n){n=n??this.byteLength-t;const i=new Uint8Array(n),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,o,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,n),i}}function OK(r){return r&Ni.INDEX?34963:r&Ni.VERTEX?34962:r&Ni.UNIFORM?35345:34962}function DK(r){return r&Ni.INDEX||r&Ni.VERTEX?35044:r&Ni.UNIFORM?35048:35044}function LK(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[T,S]=i;t.push({message:S.trim(),type:mI(T),lineNum:0,linePos:0});continue}const[o,s,c,...f]=i;let _=parseInt(c,10);isNaN(_)&&(_=0);let b=parseInt(s,10);isNaN(b)&&(b=0),t.push({message:f.join(":").trim(),type:mI(o),lineNum:_,linePos:b})}return t}function mI(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class kK extends Qm{constructor(t,n){super(t,n);V(this,"device");V(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?LK(t):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Yt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Yt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async o=>await new Promise(s=>setTimeout(s,o));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function NK(r,e,t,n){if(VK(e))return n(r);const i=r;i.pushState();try{return UK(r,e),FA(i.gl,t),n(r)}finally{i.popState()}}function UK(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Kf("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const o=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Kf("provokingVertex",e.provokingVertex,{first:36429,last:36430});o==null||o.provokingVertexWEBGL(s)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Kf("polygonMode",e.polygonMode,{fill:6914,line:6913});o==null||o.polygonModeWEBGL(1028,s),o==null||o.polygonModeWEBGL(1029,s)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(GK("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(V2("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Yt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,o=V2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=db("stencilPassOperation",e.stencilPassOperation),o=db("stencilFailOperation",e.stencilFailOperation),s=db("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=_I("blendColorOperation",e.blendColorOperation||"add"),o=_I("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);const s=k0("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=k0("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=k0("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),_=k0("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,c,f,_)}}function V2(r,e){return Kf(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function db(r,e){return Kf(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function _I(r,e){return Kf(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function k0(r,e){return Kf(r,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function zK(r,e){return`Illegal parameter ${e} for ${r}`}function Kf(r,e,t){if(!(e in t))throw new Error(zK(r,e));return t[e]}function GK(r,e){return e}function VK(r){let e=!0;for(const t in r){e=!1;break}return e}function i4(r){const e={};return r.addressModeU&&(e[10242]=Ab(r.addressModeU)),r.addressModeV&&(e[10243]=Ab(r.addressModeV)),r.addressModeW&&(e[32882]=Ab(r.addressModeW)),r.magFilter&&(e[10240]=H2(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=HK(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=V2("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function Ab(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function H2(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function HK(r,e="none"){if(!e)return H2(r);switch(e){case"none":return H2(r);case"nearest":return r==="nearest"?9984:9986;case"linear":return r==="nearest"?9985:9987}}class j2 extends e_{constructor(t,n){super(t,n);V(this,"device");V(this,"handle");V(this,"parameters");this.device=t,this.parameters=i4(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[n,i]of Object.entries(t)){const o=Number(n);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,i);break;default:this.device.gl.samplerParameteri(this.handle,o,i);break}}}}class Xd extends Zm{constructor(t,n){super(t,{...ki.defaultProps,...n});V(this,"device");V(this,"gl");V(this,"handle");V(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const jK="Failed to deduce GL constant from typed array";function $K(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(jK)}}function WK(r,e){const{clamped:t=!0}=e||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function s4(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function JK(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function f_(r,e,t){if(XK(e))return t(r);const{nocatch:n=!0}=e,i=Xf.get(r);i.push(),FA(r,e);let o;if(n)o=t(r),i.pop();else try{o=t(r)}finally{i.pop()}return o}function XK(r){for(const e in r)return!1;return!0}function KK(r,e,t){const{dimension:n,width:i,height:o,depth:s=0}=t,{glInternalFormat:c}=t,f=t.glTarget;switch(n){case"2d-array":case"3d":r.texStorage3D(f,e,c,i,o,s);break;default:r.texStorage2D(f,e,c,i,o)}}function yI(r,e,t,n){const{width:i,height:o}=n,{dimension:s,depth:c=0,mipLevel:f=0}=n,{x:_=0,y:b=0,z:T=0}=n,{glFormat:S,glType:D}=n,N=o4(n.glTarget,s,c),G=n.flipY?{37440:!0}:{};f_(r,G,()=>{switch(s){case"2d-array":case"3d":r.bindTexture(N,e),r.texSubImage3D(N,f,_,b,T,i,o,c,S,D,t),r.bindTexture(N,null);break;case"2d":case"cube":r.bindTexture(N,e),r.texSubImage2D(N,f,_,b,i,o,S,D,t),r.bindTexture(N,null);break;default:throw new Error(s)}})}function vI(r,e,t){const{dimension:n,width:i,height:o,depth:s=0,mipLevel:c=0,byteOffset:f=0}=t,{x:_=0,y:b=0,z:T=0}=t,{glFormat:S,glType:D,compressed:N}=t,G=o4(t.glTarget,n,s);switch(n){case"2d-array":case"3d":N?r.compressedTexSubImage3D(G,c,_,b,T,i,o,s,S,e,f):r.texSubImage3D(G,c,_,b,T,i,o,s,S,D,e,f);break;case"2d":case"cube":N?r.compressedTexSubImage2D(G,c,_,b,i,o,S,e,f):r.texSubImage2D(G,c,_,b,i,o,S,D,e,f);break;default:throw new Error(n)}}function YK(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(r)}function o4(r,e,t){return e==="cube"?34069+t:r}function qK(r,e){var z;const{sourceX:t=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:o=null,sourceWidth:s,sourceHeight:c,sourceDepth:f,sourceFormat:_,sourceType:b}=e||{};const{framebuffer:T,deleteFramebuffer:S}=a4(r),{gl:D,handle:N}=T;s||(s=T.width),c||(c=T.height);const G=(z=T.colorAttachments[i])==null?void 0:z.texture;if(!G)throw new Error(`Invalid framebuffer attachment ${i}`);f=(G==null?void 0:G.depth)||1,_||(_=(G==null?void 0:G.glFormat)||6408),b||(b=(G==null?void 0:G.glType)||5121),o=eY(o,b,_,s,c),b=b||$K(o);const W=D.bindFramebuffer(36160,N);return D.readBuffer(36064+i),D.readPixels(t,n,s,c,_,b,o),D.readBuffer(36064),D.bindFramebuffer(36160,W||null),S&&T.destroy(),o}function ZK(r,e){const{target:t,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=e||{};let{sourceWidth:c,sourceHeight:f,sourceType:_}=e||{};const{framebuffer:b,deleteFramebuffer:T}=a4(r);c=c||b.width,f=f||b.height;const S=b;_=_||5121;let D=t;if(!D){const G=s4(o),W=JK(_),z=s+c*f*G*W;D=S.device.createBuffer({byteLength:z})}const N=r.device.createCommandEncoder();return N.copyTextureToBuffer({sourceTexture:r,width:c,height:f,origin:[n,i],destinationBuffer:D,byteOffset:s}),N.destroy(),T&&b.destroy(),D}function a4(r){return r instanceof t_?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:QK(r),deleteFramebuffer:!0}}function QK(r,e){const{device:t,width:n,height:i,id:o}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[r]})}function eY(r,e,t,n,i,o){if(r)return r;e||(e=5121);const s=WK(e,{clamped:!1}),c=s4(t);return new s(n*i*c)}class Wp extends ki{constructor(t,n){super(t,n);V(this,"device");V(this,"gl");V(this,"handle");V(this,"sampler");V(this,"view");V(this,"mipmaps");V(this,"compressed");V(this,"glTarget");V(this,"glFormat");V(this,"glType");V(this,"glInternalFormat");V(this,"textureUnit",0);const i={...this.props};i.data=n.data,this.device=t,this.gl=this.device.gl,this.glTarget=YK(this.props.dimension);const o=t4(this.props.format);this.glInternalFormat=o.internalFormat,this.glFormat=o.format,this.glType=o.type,this.compressed=o.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:n,height:i}=t;if(!n||!i){const o=ki.getTextureDataSize(t.data);n=(o==null?void 0:o.width)||1,i=(o==null?void 0:o.height)||1}if(this.width=n,this.height=i,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Xd(this.device,{...this.props,texture:this}),this.bind(),KK(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Xd(this.device,{...t,texture:this})}setSampler(t={}){let n;t instanceof j2?(this.sampler=t,n=t.props):(this.sampler=new j2(this.device,t),n=t);const i=i4(n);this._setSamplerParameters(i)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Yt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Yt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const n=ki.getExternalImageSize(t.image),i={...ki.defaultCopyExternalImageOptions,...n,...t},{image:o,depth:s,mipLevel:c,x:f,y:_,z:b,flipY:T}=i;let{width:S,height:D}=i;const{dimension:N,glTarget:G,glFormat:W,glInternalFormat:z,glType:j}=this;if(S=Math.min(S,this.width-f),D=Math.min(D,this.height-_),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return yI(this.device.gl,this.handle,o,{dimension:N,mipLevel:c,x:f,y:_,z:b,width:S,height:D,depth:s,glFormat:W,glType:j,glTarget:G,flipY:T}),{width:i.width,height:i.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,n=0){this.bind();const i=ki.normalizeTextureData(t,this);i.length>1&&this.props.mipmaps!==!1&&Yt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let o=0;o<i.length;o++){const s=i[o];this._setMipLevel(n,o,s)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),vI(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of ki.CubeFaces)this.setTextureCubeFaceData(t[i],i)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,n,i=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&Yt.warn(`${this.id} has mipmap and multiple LODs.`)();const o=ki.CubeFaces.indexOf(n);this.setTexture2DData(t,o)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:n,width:i,height:o,pixels:s,data:c,format:f=6408,type:_=5121}=t,{gl:b}=this,T=s||c;this.bind(),T instanceof Promise?T.then(S=>this.setImageDataForFace(Object.assign({},t,{face:n,data:S,pixels:S}))):this.width||this.height?b.texImage2D(n,0,f,i,o,0,f,_,T):b.texImage2D(n,0,f,f,_,T)}_getImageDataMap(t){for(let n=0;n<ki.CubeFaces.length;++n){const i=ki.CubeFaces[n];t[i]&&(t[34069+n]=t[i],delete t[i])}return t}_setSamplerParameters(t){Yt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,i]of Object.entries(t)){const o=Number(n),s=i;switch(o){case 33082:case 33083:this.gl.texParameterf(this.glTarget,o,s);break;case 10241:this.gl.texParameteri(this.glTarget,o,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,o,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,o,s);break;default:this.gl.texParameteri(this.glTarget,o,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,n,i,o=this.glTarget){if(ki.isExternalImage(i)){yI(this.device.gl,this.handle,i,{...this,depth:t,mipLevel:n,glTarget:o,flipY:this.props.flipY});return}if(ki.isTextureLevelData(i)){vI(this.device.gl,i.data,{...this,depth:t,mipLevel:n,glTarget:o});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,null),t}}const tY=[1,2,4,8];class rY extends A2{constructor(t,n){var s;super(t,n);V(this,"device");V(this,"glParameters");this.device=t;let i;if(!((s=n==null?void 0:n.parameters)!=null&&s.viewport))if(n!=null&&n.framebuffer){const{width:c,height:f}=n.framebuffer;i=[0,0,c,f]}else{const[c,f]=t.getCanvasContext().getDrawingBufferSize();i=[0,0,c,f]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const o=this.props.framebuffer;if(o!=null&&o.handle)if(this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((f,_)=>36064+_);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(n.viewport=t.viewport.slice(0,4),n.depthRange=[t.viewport[4],t.viewport[5]]):n.viewport=t.viewport),t.scissorRect&&(n.scissorTest=!0,n.scissor=t.scissorRect),t.blendConstant&&(n.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(n.colorMask=tY.map(i=>!!(i&t.colorMask))),this.glParameters=n,FA(this.device.gl,n)}beginOcclusionQuery(t){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((i,o)=>{i&&this.clearColorBuffer(o,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,t.clearStencil=this.props.clearStencil),n!==0&&f_(this.device.gl,t,()=>{this.device.gl.clear(n)})}clearColorBuffer(t=0,n=[0,0,0,0]){f_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function nY(r){return iY.includes(r)}const iY=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],c4={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function l4(r){const e=c4[r];if(!e)throw new Error("uniform");const[t,n,,i]=e;return{format:i,components:n,glType:t}}function sY(r){const e=c4[r];if(!e)throw new Error("attribute");const[,t,,n,i]=e;return{attributeType:n,vertexFormat:i,components:t}}function oY(r,e){const t={attributes:[],bindings:[]};t.attributes=aY(r,e);const n=uY(r,e);for(const c of n){const f=c.uniforms.map(_=>({name:_.name,format:_.format,byteOffset:_.byteOffset,byteStride:_.byteStride,arrayLength:_.arrayLength}));t.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const i=lY(r,e);let o=0;for(const c of i)if(nY(c.type)){const{viewDimension:f,sampleType:_}=hY(c.type);t.bindings.push({type:"texture",name:c.name,group:0,location:o,viewDimension:f,sampleType:_}),c.textureUnit=o,o+=1}i.length&&(t.uniforms=i);const s=cY(r,e);return s!=null&&s.length&&(t.varyings=s),t}function aY(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let i=0;i<n;i++){const o=r.getActiveAttrib(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:c}=o,f=r.getAttribLocation(e,s);if(f>=0){const{attributeType:_}=sY(c),b=/instance/i.test(s)?"instance":"vertex";t.push({name:s,location:f,stepMode:b,type:_})}}return t.sort((i,o)=>i.location-o.location),t}function cY(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let i=0;i<n;i++){const o=r.getTransformFeedbackVarying(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:c,size:f}=o,{glType:_,components:b}=l4(c),T={location:i,name:s,type:_,size:f*b};t.push(T)}return t.sort((i,o)=>i.location-o.location),t}function lY(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let i=0;i<n;i++){const o=r.getActiveUniform(e,i);if(!o)throw new Error("activeInfo");const{name:s,size:c,type:f}=o,{name:_,isArray:b}=dY(s);let T=r.getUniformLocation(e,_);const S={location:T,name:_,size:c,type:f,isArray:b};if(t.push(S),S.size>1)for(let D=0;D<S.size;D++){const N=`${_}[${D}]`;T=r.getUniformLocation(e,N);const G={...S,name:N,location:T};t.push(G)}}return t}function uY(r,e){const t=(o,s)=>r.getActiveUniformBlockParameter(e,o,s),n=[],i=r.getProgramParameter(e,35382);for(let o=0;o<i;o++){const s={name:r.getActiveUniformBlockName(e,o)||"",location:t(o,35391),byteLength:t(o,35392),vertex:t(o,35396),fragment:t(o,35398),uniformCount:t(o,35394),uniforms:[]},c=t(o,35395)||[],f=r.getActiveUniforms(e,c,35383),_=r.getActiveUniforms(e,c,35384),b=r.getActiveUniforms(e,c,35387),T=r.getActiveUniforms(e,c,35388);for(let S=0;S<s.uniformCount;++S){const D=r.getActiveUniform(e,c[S]);if(!D)throw new Error("activeInfo");s.uniforms.push({name:D.name,format:l4(f[S]).format,type:f[S],arrayLength:_[S],byteOffset:b[S],byteStride:T[S]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}const fY={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function hY(r){const e=fY[r];if(!e)throw new Error("sampler");const[t,n]=e;return{viewDimension:t,sampleType:n}}function dY(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function AY(r,e,t,n){const i=r;let o=n;o===!0&&(o=1),o===!1&&(o=0);const s=typeof o=="number"?[o]:o;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,s);case 35664:return r.uniform2fv(e,s);case 35665:return r.uniform3fv(e,s);case 35666:return r.uniform4fv(e,s);case 5124:return r.uniform1iv(e,s);case 35667:return r.uniform2iv(e,s);case 35668:return r.uniform3iv(e,s);case 35669:return r.uniform4iv(e,s);case 35670:return r.uniform1iv(e,s);case 35671:return r.uniform2iv(e,s);case 35672:return r.uniform3iv(e,s);case 35673:return r.uniform4iv(e,s);case 5125:return i.uniform1uiv(e,s,1);case 36294:return i.uniform2uiv(e,s,2);case 36295:return i.uniform3uiv(e,s,3);case 36296:return i.uniform4uiv(e,s,4);case 35674:return r.uniformMatrix2fv(e,!1,s);case 35675:return r.uniformMatrix3fv(e,!1,s);case 35676:return r.uniformMatrix4fv(e,!1,s);case 35685:return i.uniformMatrix2x3fv(e,!1,s);case 35686:return i.uniformMatrix2x4fv(e,!1,s);case 35687:return i.uniformMatrix3x2fv(e,!1,s);case 35688:return i.uniformMatrix3x4fv(e,!1,s);case 35689:return i.uniformMatrix4x2fv(e,!1,s);case 35690:return i.uniformMatrix4x3fv(e,!1,s)}throw new Error("Illegal uniform")}function pY(r){return z6(r)!==null||typeof r=="number"||typeof r=="boolean"}function gY(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];pY(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}function mY(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function _Y(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}const bI=4;class yY extends pA{constructor(t,n){super(t,n);V(this,"device");V(this,"handle");V(this,"vs");V(this,"fs");V(this,"introspectedLayout");V(this,"uniforms",{});V(this,"bindings",{});V(this,"varyings",null);V(this,"_uniformCount",0);V(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:o=35981}=n;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,o)),this._linkShaders(),Yt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=oY(this.device.gl,this.handle),Yt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=vY(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,n){for(const[i,o]of Object.entries(t)){const s=this.shaderLayout.bindings.find(c=>c.name===i)||this.shaderLayout.bindings.find(c=>c.name===`${i}Uniforms`);if(!s){const c=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");n!=null&&n.disableWarnings||Yt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${c}`,o)();continue}switch(o||Yt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(o instanceof $p)&&!(o.buffer instanceof $p))throw new Error("buffer value");break;case"texture":if(!(o instanceof Xd||o instanceof Wp||o instanceof jp))throw new Error("texture value");break;case"sampler":Yt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(s.type)}this.bindings[i]=o}}draw(t){var W;const{renderPass:n,parameters:i=this.props.parameters,topology:o=this.props.topology,vertexArray:s,vertexCount:c,instanceCount:f,isInstanced:_=!1,firstVertex:b=0,transformFeedback:T}=t,S=mY(o),D=!!s.indexBuffer,N=(W=s.indexBuffer)==null?void 0:W.glIndexType;if(this.linkStatus!=="success")return Yt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Yt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(n),T&&T.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const G=n;return NK(this.device,i,G.glParameters,()=>{D&&_?this.device.gl.drawElementsInstanced(S,c||0,N,b,f||0):D?this.device.gl.drawElements(S,c||0,N,b):_?this.device.gl.drawArraysInstanced(S,b,c||0,f||0):this.device.gl.drawArrays(S,b,c||0),T&&T.end()}),s.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:n}=gY(t);Object.keys(n).forEach(i=>{Yt.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Yt.time(bI,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Yt.timeEnd(bI,`linkProgram for ${this.id}`)(),Yt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Yt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Yt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(t){var n;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${i}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async o=>await new Promise(s=>setTimeout(s,o));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(Yt.warn(`Binding ${n.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let n=0,i=0;for(const o of this.shaderLayout.bindings){const s=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:c}=o,f=t.getUniformBlockIndex(this.handle,c);if(f===4294967295)throw new Error(`Invalid uniform block name ${c}`);t.uniformBlockBinding(this.handle,i,f),s instanceof $p?t.bindBufferBase(35345,i,s.handle):t.bindBufferRange(35345,i,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),i+=1;break;case"texture":if(!(s instanceof Xd||s instanceof Wp||s instanceof jp))throw new Error("texture");let _;if(s instanceof Xd)_=s.texture;else if(s instanceof Wp)_=s;else if(s instanceof jp&&s.colorAttachments[0]instanceof Xd)Yt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),_=s.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+n),t.bindTexture(_.glTarget,_.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:o,textureUnit:s}=t,c=this.uniforms[n]??s;c!==void 0&&AY(this.device.gl,i,o,c)}}}function vY(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Yt.warn(`shader layout attribute ${n.name} not present in shader`)}return t}class bY extends g2{constructor(t){super(t,{});V(this,"device");V(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const n of t)switch(n.name){case"copy-buffer-to-buffer":xY(this.device,n.options);break;case"copy-buffer-to-texture":wY(this.device,n.options);break;case"copy-texture-to-buffer":CY(this.device,n.options);break;case"copy-texture-to-texture":EY(this.device,n.options);break;default:throw new Error(n.name)}}}function xY(r,e){const t=e.sourceBuffer,n=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function wY(r,e){throw new Error("Not implemented")}function CY(r,e){const{sourceTexture:t,mipLevel:n=0,aspect:i="all",width:o=e.sourceTexture.width,height:s=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:f=[0,0],destinationBuffer:_,byteOffset:b=0,bytesPerRow:T,rowsPerImage:S}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||c!==0||T||S)throw new Error("not implemented");const{framebuffer:D,destroyFramebuffer:N}=u4(t);let G;try{const W=_,z=o||D.width,j=s||D.height,K=t4(D.colorAttachments[0].texture.props.format),fe=K.format,Z=K.type;r.gl.bindBuffer(35051,W.handle),G=r.gl.bindFramebuffer(36160,D.handle),r.gl.readPixels(f[0],f[1],z,j,fe,Z,b)}finally{r.gl.bindBuffer(35051,null),G!==void 0&&r.gl.bindFramebuffer(36160,G),N&&D.destroy()}}function EY(r,e){const{sourceTexture:t,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=e;let{width:c=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:_,destroyFramebuffer:b}=u4(t),[T,S]=i,[D,N,G]=o,W=r.gl.bindFramebuffer(36160,_.handle);let z=null,j;if(s instanceof Wp)z=s,c=Number.isFinite(c)?c:z.width,f=Number.isFinite(f)?f:z.height,z.bind(0),j=z.glTarget;else throw new Error("invalid destination");switch(j){case 3553:case 34067:r.gl.copyTexSubImage2D(j,n,D,N,T,S,c,f);break;case 35866:case 32879:r.gl.copyTexSubImage3D(j,n,D,N,G,T,S,c,f);break}z&&z.unbind(),r.gl.bindFramebuffer(36160,W),b&&_.destroy()}function u4(r){if(r instanceof ki){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}class TY extends p2{constructor(t,n){super(t,n);V(this,"device");V(this,"commandBuffer");this.device=t,this.commandBuffer=new bY(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,n,i){}}function BY(r){const{target:e,source:t,start:n=0,count:i=1}=r,o=t.length,s=i*o;let c=0;for(let f=n;c<o;c++)e[f++]=t[c];for(;c<s;)c<s-c?(e.copyWithin(n+c,n,n+c),c*=2):(e.copyWithin(n+c,n,n+s-c),c=s);return r.target}class Ow extends m2{constructor(t,n){super(t,n);V(this,"device");V(this,"handle");V(this,"buffer",null);V(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return m5()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const n=t;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(t,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:s,stride:c,offset:f,normalized:_,integer:b,divisor:T}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),b?this.device.gl.vertexAttribIPointer(t,o,s,c,f):this.device.gl.vertexAttribPointer(t,o,s,_,c,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,T||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,n){this._enable(t,!1),this.attributes[t]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const n=this.attributes[t];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(t,n)}}_getAccessor(t){const n=this.attributeInfos[t];if(!n)throw new Error(`Unknown attribute location ${t}`);const i=e4(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(t,n=!0){const o=Ow.isConstantAttributeZeroSupported(this.device)||t!==0;(n||o)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,n){const i=SY(n),o=i.byteLength*t,s=i.length*t;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),c=c||!IY(i,this.bufferValue),c){const f=bV(n.constructor,s);BY({target:f,source:i,start:0,count:s}),this.buffer.write(f),this.bufferValue=n}return this.buffer}}function SY(r){return Array.isArray(r)?new Float32Array(r):r}function IY(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class MY extends _2{constructor(t,n){super(t,n);V(this,"device");V(this,"gl");V(this,"handle");V(this,"layout");V(this,"buffers",{});V(this,"unusedBuffers",{});V(this,"bindOnUse",!0);V(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(_Y(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])})}setBuffer(t,n){const i=this._getVaryingIndex(t),{buffer:o,byteLength:s,byteOffset:c}=this._getBufferRange(n);if(i<0){this.unusedBuffers[t]=o,Yt.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:o,byteLength:s,byteOffset:c},this.bindOnUse||this._bindBuffer(i,o,c,s)}getBuffer(t){if(xI(t))return this.buffers[t]||null;const n=this._getVaryingIndex(t);return n>=0?this.buffers[n]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let n;return this._bound?n=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof $p)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:n,byteOffset:i=0,byteLength:o=t.buffer.byteLength}=t;return{buffer:n,byteOffset:i,byteLength:o}}_getVaryingIndex(t){if(xI(t))return Number(t);for(const n of this.layout.varyings)if(t===n.name)return n.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:n,byteLength:i,byteOffset:o}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),n,o,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,n,i=0,o){const s=n&&n.handle;!s||o===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,i,o)}}function xI(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class PY extends y2{constructor(t,n){super(t,n);V(this,"device");V(this,"handle");V(this,"target",null);V(this,"_queryPending",!1);V(this,"_pollingPromise",null);if(this.device=t,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>t?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class Kd extends ku{constructor(t){var T,S;super({...t,id:t.id||FK("webgl-device")});V(this,"type","webgl");V(this,"handle");V(this,"features");V(this,"limits");V(this,"info");V(this,"canvasContext");V(this,"lost");V(this,"_resolveContextLost");V(this,"gl");V(this,"debug",!1);V(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});V(this,"_extensions",{});V(this,"_polyfilled",!1);V(this,"spectorJS");V(this,"renderPass",null);V(this,"_constants");const n=ku._getCanvasContextProps(t);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(S=(T=n.canvas)==null?void 0:T.gl)==null?void 0:S.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new xK(this,n),this.lost=new Promise(D=>{this._resolveContextLost=D});const o={...t.webgl};n.alphaMode==="premultiplied"&&(o.premultipliedAlpha=!0),t.powerPreference!==void 0&&(o.powerPreference=t.powerPreference);const c=this.props._handle||rK(this.canvasContext.canvas,{onContextLost:D=>{var N;return(N=this._resolveContextLost)==null?void 0:N.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:D=>console.log("WebGL context restored")},o);if(!c)throw new Error("WebGL context creation failed");if(i=c.device,i){if(t._reuseDevices)return Yt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=c,this.gl=c,this.spectorJS=EK({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=nK(this.gl,this._extensions),this.limits=new yK(this.gl),this.features=new _K(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new Xf(this.gl,{log:(...D)=>Yt.log(1,...D)()}).trackState(this.gl,{copyState:!1});const _=t.debugWebGL||t.debug,b=t.debugWebGL;_&&(this.gl=SK(this.gl,{debugWebGL:_,traceWebGL:b}),Yt.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(Yt.level=Math.max(Yt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const n=this._normalizeBufferProps(t);return new $p(this,n)}createTexture(t){return new Wp(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new j2(this,t)}createShader(t){return new kK(this,t)}createFramebuffer(t){return new jp(this,t)}createVertexArray(t){return new Ow(this,t)}createTransformFeedback(t){return new MY(this,t)}createQuerySet(t){return new PY(this,t)}createRenderPipeline(t){return new yY(this,t)}beginRenderPass(t){return new rY(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new TY(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,n){return qK(t,n)}readPixelsToBufferWebGL(t,n){return ZK(t,n)}setParametersWebGL(t){FA(this.gl,t)}getParametersWebGL(t){return Z6(this.gl,t)}withParametersWebGL(t,n){return f_(this.gl,t,n)}resetWebGL(){Yt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),qX(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return AK(this.gl,t,this._extensions)}loseDevice(){var o;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(o=this._resolveContextLost)==null||o.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Xf.get(this.gl).push()}popState(){Xf.get(this.gl).pop()}setSpectorMetadata(t,n){t.__SPECTOR_Metadata=n}getGLKey(t,n){const i=Number(t);for(const o in this.gl)if(this.gl[o]===i)return`GL.${o}`;return n!=null&&n.emptyIfUnknown?"":String(t)}getGLKeys(t){const n={emptyIfUnknown:!0};return Object.entries(t).reduce((i,[o,s])=>(i[`${o}:${this.getGLKey(o,n)}`]=`${s}:${this.getGLKey(s,n)}`,i),{})}setConstantAttributeWebGL(t,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const o=this._constants[t];switch(o&&DY(o,n)&&Yt.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=n,n.constructor){case Float32Array:RY(this,t,n);break;case Int32Array:FY(this,t,n);break;case Uint32Array:OY(this,t,n);break;default:throw new Error("constant")}}getExtension(t){return bA(this.gl,t,this._extensions),this._extensions}}function RY(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break}}function FY(r,e,t){r.gl.vertexAttribI4iv(e,t)}function OY(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function DY(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}const LY={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},kY=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),NY=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),UY=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return r.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return r.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return r.vertexAttribDivisor(...e)}});function zY(r=!0){const e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&GY(i),i}return this.originalGetContext(t,n)}}function GY(r){r.getExtension("EXT_color_buffer_float");const e={...LY,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:kY(r),OES_vertex_array_object:NY(r),ANGLE_instanced_arrays:UY(r)},t=r.getExtension;r.getExtension=function(i){const o=t.call(r,i);return o||(i in e?e[i]:null)};const n=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=n.apply(r)||[];return i==null?void 0:i.concat(Object.keys(e))}}const N0=1;class VY extends q7{constructor(){super();V(this,"type","webgl");ku.defaultProps={...ku.defaultProps,...Fw},Kd.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){zY(t)}async attach(t){if(t instanceof Kd)return t;if((t==null?void 0:t.device)instanceof ku)return t.device;if(!HY(t))throw new Error("Invalid WebGL2RenderingContext");return new Kd({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){Yt.groupCollapsed(N0,"WebGLDevice created")();const n=[];(t.debugWebGL||t.debug)&&n.push(BK()),t.debugSpectorJS&&n.push(CK(t));const i=await Promise.allSettled(n);for(const c of i)c.status==="rejected"&&Yt.error(`Failed to initialize debug libraries ${c.reason}`)();const o=new Kd(t),s=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Yt.probe(N0,s)(),Yt.table(N0,o.info)(),Yt.groupEnd(N0)(),o}}function HY(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}const wI=new VY;function Eu(){}const jY=({isDragging:r})=>r?"grabbing":"grab",f4={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Eu,onWebGLInitialized:Eu,onResize:Eu,onViewStateChange:Eu,onInteractionStateChange:Eu,onBeforeRender:Eu,onAfterRender:Eu,onLoad:Eu,onError:r=>$r.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:jY,getTooltip:null,debug:!1,drawPickingColors:!1};class Dw{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new J6({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=M2[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const s=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:f}=c,_=f&&(f[i]||f.props[i]),b=this.props[i];let T=!1;_&&(T=_.call(f,c,n)),T||(b==null||b(c,n),this.widgetManager.onEvent(c,n))},this._onPointerDown=n=>{var s;if(((s=this.device)==null?void 0:s.type)==="webgpu")return;const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...f4,...e},e=this.props,e.viewState&&e.initialViewState&&$r.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&$r.error("WebGL1 context not supported.")(),t=wI.attach(e.gl)),t||(t=h2.createDevice({type:"best-available",_reuseDevices:!0,adapters:[wI],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&_A.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,o,s,c,f,_,b;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(o=this.effectManager)==null||o.finalize(),this.effectManager=null,(s=this.deckRenderer)==null||s.finalize(),this.deckRenderer=null,(c=this.deckPicker)==null||c.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(_=this.widgetManager)==null||_.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((b=this.canvas.parentElement)==null||b.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&$r.removed("onLayerHover","onHover")(),"onLayerClick"in e&&$r.removed("onLayerClick","onClick")(),e.initialViewState&&!Ki(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||n||i||o||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return js(this.viewManager),this.viewManager.views}getViewports(e){return js(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,n){js(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),js(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const o=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=o}if(n||n===0){const o=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var i,o;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,(i=this.viewManager)==null||i.setProps({width:t,height:n}),(o=this.layerManager)==null||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:o}=t;return new TJ({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new K6({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,n,i,o;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:c}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let f=c,_=!1;for(const b of s)f=b,_=((n=b.layer)==null?void 0:n.onHover(b,e.event))||_;_||((o=(i=this.props).onHover)==null||o.call(i,f,e.event),this.widgetManager.onHover(f,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,o;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new U6;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new rW(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(NS).map(s=>{var D;const[c,f,_,b]=NS[s],T=(D=this.props.eventRecognizerOptions)==null?void 0:D[s],S={...f,...T,event:s};return{recognizer:new c(S),recognizeWith:_,requestFailure:b}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in M2)this.eventManager.on(s,this._onEvent);this.viewManager=new mX({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new gX(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new FX({deck:this,device:this.device}),this.deckRenderer=new LX(this.device),this.deckPicker=new VX(this.device),this.widgetManager=new $X({deck:this,parentElement:(o=this.canvas)==null?void 0:o.parentElement}),this.widgetManager.addDefault(new JX),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var s;const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(s=this.deckRenderer)==null||s.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$r.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=h2.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Dw.defaultProps=f4;Dw.VERSION=JG;function $Y(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return VD(r)}}const WY=GD;function U0(r,e,t){const n=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:r,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Gf(r){return r.stride||r.size*r.bytesPerElement}function JY(r,e){return r.type===e.type&&r.size===e.size&&Gf(r)===Gf(e)&&(r.offset||0)===(e.offset||0)}function $2(r,e){e.offset&&$r.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Gf(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,i=e.elementOffset||0,o=n*t+i*r.bytesPerElement+(r.offset||0);return{...e,offset:o,stride:t}}function XY(r,e){const t=$2(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class KY{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,o=i==="float64";let{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let c;o?c="float32":!i&&t.isIndexed?c="uint32":c=i||"float32";let f=$Y(i||c);this.doublePrecision=o,o&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:s,logicalType:i,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Gf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),_A.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const o=$2(this.getAccessor(),t),s=o.offset/i.BYTES_PER_ELEMENT,c=o.size||this.size;n[e]=i.subarray(s,s+c)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],o={name:this.id,byteStride:Gf(n),attributes:i};if(this.doublePrecision){const s=XY(n,t||{});i.push(U0(e,{...n,...s.high},this.device.type),U0(`${e}64Low`,{...n,...s.low},this.device.type))}else if(t){const s=$2(n,t);i.push(U0(e,{...n,...s},this.device.type))}else i.push(U0(e,n,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,o=n*i;if(t&&o&&t.length>=o){const s=new Array(i).fill(1/0),c=new Array(i).fill(-1/0);for(let f=0;f<o;)for(let _=0;_<i;_++){const b=t[f++];b<s[_]&&(s[_]=b),b>c[_]&&(c[_]=b)}e=[s,c]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Ni?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const s=WY(n.value);i.type=i.normalized?s.replace("int","norm"):s}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Gf(i)}if(t.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;t.externalBuffer=o,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;t.externalBuffer=null,t.constant=!1,this.value=o;let{buffer:s}=this;const c=Gf(i),f=(i.vertexOffset||0)*c;if(this.doublePrecision&&o instanceof Float64Array&&(o=ob(o,i)),this.settings.isIndexed){const b=this.settings.defaultType;o.constructor!==b&&(o=new b(o))}const _=o.byteLength+f+c*2;(!s||s.byteLength<_)&&(s=this._createBuffer(_)),s.write(o,f)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?ob(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,o=_A.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{byteOffset:s}=this;let{buffer:c}=this;return(!c||c.byteLength<o.byteLength+s)&&(c=this._createBuffer(o.byteLength+s),t&&i&&c.write(i instanceof Float64Array?ob(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&$r.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let s=o;for(;--s>=0;)t[n+s]=i[s];return t}switch(o){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=o;for(;--s>=0;)t[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(t?Ni.INDEX:Ni.VERTEX)|Ni.COPY_DST,indexType:t?n:void 0,byteLength:e}),this._buffer}}const CI=[],EI=[];function sl(r,e=0,t=1/0){let n=CI;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(EI.length=r.length,n=EI):n=CI,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),i.index=e-1),{iterable:n,objectInfo:i}}function h4(r){return r&&r[Symbol.asyncIterator]}function d4(r,e){const{size:t,stride:n,offset:i,startIndices:o,nested:s}=e,c=r.BYTES_PER_ELEMENT,f=n?n/c:t,_=i?i/c:0,b=Math.floor((r.length-_)/f);return(T,{index:S,target:D})=>{if(!o){const z=S*f+_;for(let j=0;j<t;j++)D[j]=r[z+j];return D}const N=o[S],G=o[S+1]||b;let W;if(s){W=new Array(G-N);for(let z=N;z<G;z++){const j=z*f+_;D=new Array(t);for(let K=0;K<t;K++)D[K]=r[j+K];W[z-N]=D}}else if(f===t)W=r.subarray(N*t+_,G*t+_);else{W=new r.constructor((G-N)*t);let z=0;for(let j=N;j<G;j++){const K=j*f+_;for(let fe=0;fe<t;fe++)W[z++]=r[K+fe]}}return W}}const YY=[],Bm=[[0,1/0]];function qY(r,e){if(r===Bm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let i=0;for(let o=0;o<n;o++){const s=r[o];s[1]<e[0]?(t.push(s),i=o+1):s[0]>e[1]?t.push(s):e=[Math.min(s[0],e[0]),Math.max(s[1],e[1])]}return t.splice(i,0,e),t}const ZY={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function A4(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...ZY[t],...e,...r,type:t}}class p4 extends KY{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Bm}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!JY(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return A4(i,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:i=1/0}=t;this.state.updateRanges=qY(this.state.updateRanges,[n,i])}else this.state.updateRanges=Bm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=YY}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==Bm),!0):!1}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:c}}=this;let f=!0;if(s){for(const[_,b]of o)s.call(i,this,{data:t,startRow:_,endRow:b,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[_,b]of o){const T=Number.isFinite(_)?this.getVertexOffset(_):0,S=Number.isFinite(b)?this.getVertexOffset(b):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:S})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const s=e;js(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);const c=!!s.size&&s.size!==this.size;return n.binaryAccessor=d4(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!t)return n;for(const o in t){const s=super._getBufferLayout(o,t[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:o,numInstances:s}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:c,state:f,value:_,size:b,startIndices:T}=e,{accessor:S,transform:D}=c;let N=f.binaryAccessor||(typeof S=="function"?S:o[S]);typeof N!="function"&&(N=()=>N),js(typeof N=="function",`accessor "${S}" is not a function`);let G=e.getVertexOffset(n);const{iterable:W,objectInfo:z}=sl(t,n,i);for(const j of W){z.index++;let K=N(j,z);if(D&&(K=D.call(this,K)),T){const fe=(z.index<T.length-1?T[z.index+1]:s)-T[z.index];if(K&&Array.isArray(K[0])){let Z=G;for(const ae of K)e._normalizeValue(ae,_,Z),Z+=b}else K&&K.length>b?_.set(K,G):(e._normalizeValue(K,z.target,0),fX({target:_,source:z.target,start:G,count:fe}));G+=fe*b}else e._normalizeValue(K,_,G),G+=b}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function pb(r){const{source:e,target:t,start:n=0,size:i,getData:o}=r,s=r.end||t.length,c=e.length,f=s-n;if(c>f){t.set(e.subarray(0,f),n);return}if(t.set(e,n),!o)return;let _=c;for(;_<f;){const b=o(_,e);for(let T=0;T<i;T++)t[n+_]=b[T]||0,_++}}function QY({source:r,target:e,size:t,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return pb({source:r,target:e,size:t,getData:n}),e;let s=0,c=0;const f=n&&((b,T)=>n(b+c,T)),_=Math.min(i.length,o.length);for(let b=1;b<_;b++){const T=i[b]*t,S=o[b]*t;pb({source:r.subarray(s,T),target:e,start:c,end:S,size:t,getData:f}),s=T,c=S}return c<e.length&&pb({source:[],target:e,start:c,size:t,getData:f}),e}function eq(r){const{device:e,settings:t,value:n}=r,i=new p4(e,t);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function g4(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function m4(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function _4(r){r.push(r.shift())}function tq(r,e){const{doublePrecision:t,settings:n,value:i,size:o}=r,s=t&&i instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=r.settings;if(f)for(const _ of Object.values(f))c=Math.max(c,_.vertexOffset??0);return(n.noAlloc?i.length:(e+c)*o)*s}function y4({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function v4({device:r,buffer:e,attribute:t,fromLength:n,toLength:i,fromStartIndices:o,getData:s=c=>c}){const c=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*c,_=t.byteOffset,b=t.settings.bytesPerElement<4?_/t.settings.bytesPerElement*4:_,T=t.startIndices,S=o&&T,D=t.isConstant;if(!S&&e&&n>=i)return e;const N=t.value instanceof Float64Array?Float32Array:t.value.constructor,G=D?t.value:new N(t.getBuffer().readSyncWebGL(_,i*N.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!D){const K=s;s=(fe,Z)=>t.normalizeConstant(K(fe,Z))}const W=D?(K,fe)=>s(G,fe):(K,fe)=>s(G.subarray(K+_,K+_+f),fe),z=e?new Float32Array(e.readSyncWebGL(b,n*4).buffer):new Float32Array(0),j=new Float32Array(i);return QY({source:z,target:j,sourceStartIndices:o,targetStartIndices:T,size:f,getData:W}),(!e||e.byteLength<j.byteLength+b)&&(e==null||e.destroy(),e=r.createBuffer({byteLength:j.byteLength+b,usage:35050})),e.write(j,b),e}class b4{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new dy(n),this.attribute=t,this.attributeInTransition=eq(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=tq(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class rq extends b4{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=oq(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:s}=this;_4(o),o[0]=v4({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),o[1]=y4({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:c}=this,f=c.model;let _=Math.floor(this.currentLength/s.size);x4(s)&&(_/=2),f.setVertexCount(_),s.isConstant?(f.setAttributes({aFrom:o[0]}),f.setConstantAttributes({aTo:s.value})):f.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:o}=this.transform,s={time:i};o.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const nq=`uniform interpolationUniforms {
  float time;
} interpolation;
`,TI={name:"interpolation",vs:nq,uniformTypes:{time:"f32"}},iq=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,sq=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function x4(r){return r.doublePrecision&&r.value instanceof Float64Array}function oq(r,e){const t=e.size,n=g4(t),i=m4(t),o=e.getBufferLayout();return x4(e)?new yA(r,{vs:sq,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[$j,TI],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new yA(r,{vs:iq,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[TI],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class aq extends b4{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=dq(e),this.framebuffer=Aq(e,this.texture),this.transform=hq(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:o,attribute:s}=this;for(let f=0;f<2;f++)o[f]=v4({device:this.device,buffer:o[f],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});o[2]=y4({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?c.setConstantAttributes({aTo:s.value}):c.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,o=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const s={stiffness:o.stiffness,damping:o.damping};t.model.shaderInputs.setProps({spring:s}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),_4(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const cq=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,lq={name:"spring",vs:cq,uniformTypes:{damping:"f32",stiffness:"f32"}},uq=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fq=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function hq(r,e){const t=g4(e.size),n=m4(e.size);return new yA(r,{vs:uq,fs:fq,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[lq],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function dq(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Aq(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const pq={interpolation:rq,spring:aq};class gq{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const i in e){const o=e[i],s=o.getTransitionSetting(t);s&&this._updateAttribute(i,o,s)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let o=!i||i.type!==n.type;if(o){i&&this._removeTransition(e);const s=pq[n.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):($r.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const BI="attributeManager.invalidate",mq="attributeManager.updateStart",_q="attributeManager.updateEnd",yq="attribute.updateStart",vq="attribute.allocate",bq="attribute.updateEnd";class Ay{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=Cg(hJ),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new gq(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);oo(BI,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);oo(BI,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:c={}}){let f=!1;oo(mq,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const _ in this.attributes){const b=this.attributes[_],T=b.settings.accessor;b.startIndices=n,b.numInstances=t,o[_]&&$r.removed(`props.${_}`,`data.attributes.${_}`)(),b.setExternalBuffer(s[_])||b.setBinaryValue(typeof T=="string"?s[T]:void 0,e.startIndices)||typeof T=="string"&&!s[T]&&b.setConstantValue(o[T])||b.needsUpdate()&&(f=!0,this._updateAttribute({attribute:b,numInstances:t,data:e,props:o,context:c})),this.needsRedraw=this.needsRedraw||b.needsRedraw()}f&&oo(_q,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>{var i;return(i=this.attributes[n])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const o in t){const s=t[o];s.needsRedraw(e)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...t};this.attributes[n]=new p4(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,o=i[e];return o&&o.forEach(s=>{const c=n[s];c&&c.setNeedsUpdate(c.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(oo(yq,t),t.constant){t.setConstantValue(t.value);return}t.allocate(n)&&oo(vq,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,oo(bq,t,n))}}class xq extends dy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:o}}=this,s=o(e/i);this._value=dc(t,n,s)}}const SI=1e-5;function II(r,e,t,n,i){const o=e-r,c=(t-e)*i,f=-o*n;return c+f+o+e}function wq(r,e,t,n,i){if(Array.isArray(t)){const o=[];for(let s=0;s<t.length;s++)o[s]=II(r[s],e[s],t[s],n,i);return o}return II(r,e,t,n,i)}function MI(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const i=r[n]-e[n];t+=i*i}return Math.sqrt(t)}return Math.abs(r-e)}class Cq extends dy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:s=e}=this;let c=wq(o,s,t,n,i);const f=MI(c,t),_=MI(c,s);f<SI&&_<SI&&(c=t,this.end()),this._prevValue=s,this._currValue=c}}const Eq={interpolation:xq,spring:Cq};class Tq{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:o}=this;if(o.has(e)){const f=o.get(e),{value:_=f.settings.fromValue}=f;t=_,this.remove(e)}if(i=A4(i),!i)return;const s=Eq[i.type];if(!s){$r.error(`unsupported transition type '${i.type}'`)();return}const c=new s(this.timeline);c.start({...i,fromValue:t,toValue:n}),o.set(e,c)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Bq(r){const e=r[Nu];for(const t in e){const n=e[t],{validate:i}=n;if(i&&!i(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function Sq(r,e){const t=Lw({newProps:r,oldProps:e,propTypes:r[Nu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Mq(r,e);let i=!1;return n||(i=Pq(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:i,extensionsChanged:Rq(r,e),transitionsChanged:Iq(r,e)}}function Iq(r,e){if(!r.transitions)return!1;const t={},n=r[Nu];let i=!1;for(const o in r.transitions){const s=n[o],c=s&&s.type;(c==="number"||c==="color"||c==="array")&&W2(r[o],e[o],s)&&(t[o]=!0,i=!0)}return i?t:!1}function Lw({newProps:r,oldProps:e,ignoreProps:t={},propTypes:n={},triggerName:i="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const o of Object.keys(r))if(!(o in t)){if(!(o in e))return`${i}.${o} added`;const s=W2(r[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}for(const o of Object.keys(e))if(!(o in t)){if(!(o in r))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(r,o)){const s=W2(r[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function W2(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function Mq(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(r.data,e.data)||t),t}function Pq(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&PI(r,e,"all"))return{all:!0};const t={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&PI(r,e,i)&&(t[i]=!0,n=!0);return n?t:!1}function Rq(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(t[i]))return!0;return!1}function PI(r,e,t){let n=r.updateTriggers[t];n=n??{};let i=e.updateTriggers[t];return i=i??{},Lw({oldProps:i,newProps:n,triggerName:t})}const Fq="count(): argument not an object",Oq="count(): argument not a container";function Dq(r){if(!kq(r))throw new Error(Fq);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(Lq(r))return Object.keys(r).length;throw new Error(Oq)}function Lq(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function kq(r){return r!==null&&typeof r=="object"}function RI(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(i=>i.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];t.inject=n}return t}const Nq={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},J2={};function Uq(r,e,t,n){if(t instanceof ki)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const o=e.createTexture({...t,sampler:{...Nq,...i,...n},mipmaps:!0});return J2[o.id]=r,o}function zq(r,e){!e||!(e instanceof ki)||J2[e.id]===r&&(e.delete(),delete J2[e.id])}const Gq={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||X2(r)&&(r.length===3||r.length===4)},equal(r,e,t){return Ki(r,e,1)}},accessor:{validate(r,e){const t=h_(r);return t==="function"||t===h_(e.value)},equal(r,e,t){return typeof e=="function"?!0:Ki(r,e,1)}},array:{validate(r,e){return e.optional&&!r||X2(r)},equal(r,e,t){const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?Ki(r,e,i):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?Ki(r,e,i):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:Uq(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{zq(t.id,r)}}};function Vq(r){const e={},t={},n={};for(const[i,o]of Object.entries(r)){const s=o==null?void 0:o.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{const c=Hq(i,o);e[i]=c,t[i]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function Hq(r,e){switch(h_(e)){case"object":return xp(r,e);case"array":return xp(r,{type:"array",value:e,compare:!1});case"boolean":return xp(r,{type:"boolean",value:e});case"number":return xp(r,{type:"number",value:e});case"function":return xp(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function xp(r,e){return"type"in e?{name:r,...Gq[e.type],...e}:"value"in e?{name:r,type:h_(e.value),...e}:{name:r,type:"object",value:e}}function X2(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function h_(r){return X2(r)?"array":r===null?"null":typeof r}function jq(r,e){let t;for(let o=e.length-1;o>=0;o--){const s=e[o];"extensions"in s&&(t=s.extensions)}const n=K2(r.constructor,t),i=Object.create(n);i[u_]=r,i[Qf]={},i[Ou]={};for(let o=0;o<e.length;++o){const s=e[o];for(const c in s)i[c]=s[c]}return Object.freeze(i),i}const $q="_mergedDefaultProps";function K2(r,e){if(!(r instanceof py.constructor))return{};let t=$q;if(e)for(const i of e){const o=i.constructor;o&&(t+=`:${o.extensionName||o.name}`)}const n=w4(r,t);return n||(r[t]=Wq(r,e||[]))}function Wq(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=K2(n),o=w4(r,"defaultProps")||{},s=Vq(o),c=Object.assign(Object.create(null),i,s.defaultProps),f=Object.assign(Object.create(null),i==null?void 0:i[Nu],s.propTypes),_=Object.assign(Object.create(null),i==null?void 0:i[ub],s.deprecatedProps);for(const b of e){const T=K2(b.constructor);T&&(Object.assign(c,T),Object.assign(f,T[Nu]),Object.assign(_,T[ub]))}return Jq(c,r),Kq(c,f),Xq(c,_),c[Nu]=f,c[ub]=_,e.length===0&&!kw(r,"_propTypes")&&(r._propTypes=f),c}function Jq(r,e){const t=qq(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function Xq(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const i=`${this.id}: ${t}`;for(const o of e[t])kw(this,o)||(this[o]=n);$r.deprecated(i,e[t].join("/"))()}})}function Kq(r,e){const t={},n={};for(const i in e){const o=e[i],{name:s,value:c}=o;o.async&&(t[s]=c,n[s]=Yq(s))}r[aA]=t,r[Qf]={},Object.defineProperties(r,n)}function Yq(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||h4(e)?this[Qf][r]=e:this[Ou][r]=e},get(){if(this[Ou]){if(r in this[Ou])return this[Ou][r]||this[aA][r];if(r in this[Qf]){const e=this[u_]&&this[u_].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[aA][r]}}return this[aA][r]}}}function kw(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function w4(r,e){return kw(r,e)&&r[e]}function qq(r){const e=r.componentName;return e||$r.warn(`${r.name}.componentName not specified`)(),e||r.name}let Zq=0;class py{constructor(...e){this.props=jq(this,e),this.id=this.props.id,this.count=Zq++}clone(e){const{props:t}=this,n={};for(const i in t[aA])i in t[Ou]?n[i]=t[Ou][i]:i in t[Qf]&&(n[i]=t[Qf][i]);return new this.constructor({...t,...n,...e})}}py.componentName="Component";py.defaultProps={};const Qq=Object.freeze({});class eZ{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Qq}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[u_]||this.component;const t=e[Ou]||{},n=e[Qf]||e,i=e[aA]||{};for(const o in t){const s=t[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),t[o]=this.getAsyncProp(o)}for(const o in n){const s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(h4(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let o=[],s=0;for await(const c of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?o=f(c,o):o=o.concat(c),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Nu];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class tZ extends eZ{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const rZ="layer.changeFlag",nZ="layer.initialize",iZ="layer.update",sZ="layer.finalize",oZ="layer.matched",FI=2**24-1,aZ=Object.freeze([]),cZ=Cg(({oldViewport:r,viewport:e})=>r.equals(e));let qa=new Uint8ClampedArray(0);const lZ={data:{type:"data",value:aZ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:n,loadOptions:i,signal:o})=>{const{resourceManager:s}=t.context;i=i||t.getLoadOptions(),n=n||t.props.loaders,o&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:o}});let c=s.contains(r);return!c&&!i&&(s.add({resourceId:r,data:s2(r,n),persistent:!1}),c=!0),c?s.subscribe({resourceId:r,onChange:f=>{var _;return(_=t.internalState)==null?void 0:_.reloadAsyncProp(e,f)},consumerId:t.id,requestId:e}):s2(r,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Jr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class _s extends py{constructor(){super(...arguments),this.internalState=null,this.lifecycle=zd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){js(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=N6(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=F6(n,t.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,s]}unproject(e){return js(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){js(this.internalState);const n=this.internalState.viewport||this.context.viewport;return _J(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Jr.DEFAULT||e===Jr.LNGLAT||e===Jr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){js(e instanceof Uint8Array);const[t,n,i]=e;return t+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Dq(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=RI(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=RI(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(o!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:c,instancePickingColors:f}=t.attributes,_=c||f;_&&(s&&_.constant&&(_.constant=!1,t.invalidate(_.id)),!_.value&&!s&&(_.constant=!0,_.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var n,i,o,s;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(n=this.props).onError)!=null&&i.call(n,e)||(s=(o=this.context)==null?void 0:o.onError)==null||s.call(o,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!cZ({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const i in t)Object.defineProperty(n,i,{value:t[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(qa.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>FI&&$r.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qa=_A.allocate(qa,t,{size:4,copy:!0,maxCount:Math.max(t,FI)});const i=Math.floor(qa.length/4),o=[0,0,0];for(let s=n;s<i;s++)this.encodePickingColor(s,o),qa[s*4+0]=o[0],qa[s*4+1]=o[1],qa[s*4+2]=o[2],qa[s*4+3]=0}e.value=qa.subarray(0,t*4)}_setModelAttributes(e,t,n=!1){var c;if(!Object.keys(t).length)return;if(n){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),t=f.getAttributes()}const i=((c=e.userData)==null?void 0:c.excludeAttributes)||{},o={},s={};for(const f in t){if(i[f])continue;const _=t[f].getValue();for(const b in _){const T=_[b];T instanceof Ni?t[f].settings.isIndexed?e.setIndexBuffer(T):o[b]=T:T&&(s[b]=T)}}e.setAttributes(o),e.setConstantAttributes(s)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&t.attributes&&t.attributes[o.id];if(s&&s.value){const c=s.value,f=this.encodePickingColor(e);for(let _=0;_<t.length;_++){const b=o.getVertexOffset(_);c[b]===f[0]&&c[b+1]===f[1]&&c[b+2]===f[2]&&this._disablePickingIndex(_)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const o=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==qa.buffer&&(n.value=qa.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){js(!this.internalState),js(Number.isFinite(this.props.coordinateSystem)),oo(nZ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new tZ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($r.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Tq(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){oo(oZ,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(oo(iZ,this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{const c=this._getUpdateParams(),f=this.getModels();if(n.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const b of this.props.extensions)b.updateState.call(this,c,b);this.setNeedsRedraw(),this._updateAttributes();const _=this.getModels()[0]!==f[0];this._postUpdate(c,_)}finally{n.viewport=o,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){oo(sZ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:c}=this.props,f=c&&c(n)||[0,0];s.device instanceof Kd&&s.device.setParametersWebGL({polygonOffset:f});for(const _ of this.getModels())_.device.type==="webgpu"?_.setParameters({..._.parameters,...i}):_.setParameters(i);if(s.device instanceof Kd)s.device.withParametersWebGL(i,()=>{const _={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:s};for(const b of this.props.extensions)b.draw.call(this,_,b);this.draw(_)});else{const _={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:s};for(const b of this.props.extensions)b.draw.call(this,_,b);this.draw(_)}}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const s=e[i],c=t[i];s&&Array.isArray(c)&&(t.dataChanged=Array.isArray(s)?c.concat(s):s,o=!0);default:t[i]||(t[i]=e[i],o=!0)}o&&oo(rZ,this,i,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const n=Sq(e,t);if(n.updateTriggersChanged)for(const o in n.updateTriggersChanged)n.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(n.transitionsChanged)for(const o in n.transitionsChanged)this.internalState.uniformTransitions.add(o,t[o],e[o],(i=e.transitions)==null?void 0:i[o]);return this.setChangeFlags(n)}validateProps(){Bq(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Ay(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,o=this.state.model;o!=null&&o.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:c,highlightColor:f}=n;if(t||i.autoHighlight!==s||i.highlightedObjectIndex!==c||i.highlightColor!==f){const _={};Array.isArray(f)&&(_.highlightColor=f),(t||i.autoHighlight!==s||c!==i.highlightedObjectIndex)&&(_.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:_})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(t=t||i,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}_s.defaultProps=lZ;_s.layerName="Layer";const uZ="compositeLayer.renderLayers";class ys extends _s{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){var Be;const{opacity:t,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:c,autoHighlight:f,highlightColor:_,coordinateSystem:b,coordinateOrigin:T,wrapLongitude:S,positionFormat:D,modelMatrix:N,extensions:G,fetch:W,operation:z,_subLayerProps:j}=this.props,K={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:c,autoHighlight:f,highlightColor:_,coordinateSystem:b,coordinateOrigin:T,wrapLongitude:S,positionFormat:D,modelMatrix:N,extensions:G,fetch:W,operation:z},fe=j&&e.id&&j[e.id],Z=fe&&fe.updateTriggers,ae=e.id||"sublayer";if(fe){const Le=this.props[Nu],de=e.type?e.type._propTypes:{};for(const _e in fe){const pe=de[_e]||Le[_e];pe&&pe.type==="accessor"&&(fe[_e]=this.getSubLayerAccessor(fe[_e]))}}Object.assign(K,e,fe),K.id=`${this.props.id}-${ae}`,K.updateTriggers={all:(Be=this.props.updateTriggers)==null?void 0:Be.all,...e.updateTriggers,...Z};for(const Le of G){const de=Le.getSubLayerProps.call(this,Le);de&&Object.assign(K,de,{updateTriggers:Object.assign(K.updateTriggers,de.updateTriggers)})}return K}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const o=this.renderLayers();n=hy(o,Boolean),this.internalState.subLayers=n}oo(uZ,this,i,n);for(const o of n)o.parent=this}}ys.layerName="CompositeLayer";const z0=Math.PI/180,OI=180/Math.PI,Sm=6370972,Yd=256;function fZ(){const r=Yd/Sm,e=Math.PI/180*Yd;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class hZ extends jl{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:o=1,resolution:s=10}=e;let{latitude:c=0,height:f,altitude:_=1.5,fovy:b}=e;c=Math.max(Math.min(c,F2),-85.051129),f=f||1,b?_=Sw(b):b=cg(_);const T=1/Math.PI/Math.cos(c*Math.PI/180),S=Math.pow(2,n)*T,D=e.nearZ??i,N=e.farZ??(_+Yd*2*S/f)*o,G=new dn().lookAt({eye:[0,-_,0],up:[0,0,1]});G.rotateX(c*z0),G.rotateZ(-t*z0),G.scale(S/f),super({...e,height:f,viewMatrix:G,longitude:t,latitude:c,zoom:n,distanceScales:fZ(),fovy:b,focalDistance:_,near:D,far:N}),this.scale=S,this.latitude=c,this.longitude=t,this.resolution=s}get projectionMode(){return na.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),o=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return o[0]<this.longitude&&(o[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],o[0],i[0],s[0]),Math.min(n[1],o[1],i[1],s[1]),Math.max(n[0],o[0],i[0],s[0]),Math.max(n[1],o[1],i[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,o,s]=e,c=t?o:this.height-o,{pixelUnprojectionMatrix:f}=this;let _;if(Number.isFinite(s))_=gb(f,[i,c,s,1]);else{const D=gb(f,[i,c,-1,1]),N=gb(f,[i,c,1,1]),G=((n||0)/Sm+1)*Yd,W=Zv(a6([],D,N)),z=Zv(D),j=Zv(N),fe=4*((4*z*j-(W-z-j)**2)/16)/W,Z=Math.sqrt(z-fe),ae=Math.sqrt(Math.max(0,G*G-fe)),Be=(Z-ae)/Math.sqrt(W);_=FH([],D,N,Be)}const[b,T,S]=this.unprojectPosition(_);return Number.isFinite(s)?[b,T,S]:Number.isFinite(n)?[b,T,n]:[b,T]}projectPosition(e){const[t,n,i=0]=e,o=t*z0,s=n*z0,c=Math.cos(s),f=(i/Sm+1)*Yd;return[Math.sin(o)*c*f,-Math.cos(o)*c*f,Math.sin(s)*f]}unprojectPosition(e){const[t,n,i]=e,o=c6(e),s=Math.asin(i/o),f=Math.atan2(t,-n)*OI,_=s*OI,b=(o/Yd-1)*Sm;return[f,_,b]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function gb(r,e){const t=RA([],e,r);return Cw(t,t,1/t[3]),t}class gy{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ki(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,n={updateTriggers:{}};for(const i in t)if(i in this.props){const o=t[i],s=this.props[i];n[i]=s,o&&o.type==="accessor"&&(n.updateTriggers[i]=this.props.updateTriggers[i],typeof s=="function"&&(n[i]=this.getSubLayerAccessor(s)))}return n}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}gy.defaultProps={};gy.extensionName="LayerExtension";class C4{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=_A,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:o,positionFormat:s,dataChanged:c,normalize:f=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=o&&o.size||(s==="XY"?2:3),this.buffers=n,this.normalize=f,o&&(js(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),f||(n.vertexPositions=o)),this.geometryBuffer=n.vertexPositions,Array.isArray(c))for(const _ of c)this._rebuildGeometry(_);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?d4(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:o,typedArrayManager:s}=this;for(const c in o)if(c in i)s.release(n[c]),n[c]=null;else{const f=o[c];f.copy=t,n[c]=s.allocate(n[c],e,f)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:o}=this,{iterable:s,objectInfo:c}=sl(i,t,n);for(const f of s){c.index++;const _=o?o(f,c):null;e(_,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:o,geometryBuffer:s}=this,{startRow:c=0,endRow:f=1/0}=e||{},_={};if(e||(t=[0],n=[0]),this.normalize||!s)this._forEachGeometry((T,S)=>{const D=T&&this.normalizeGeometry(T);_[S]=D,n[S+1]=n[S]+(D?this.getGeometrySize(D):0)},c,f),i=n[n.length-1];else if(n=o.startIndices,i=n[o.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Ni){const T=this.positionSize*4;i=i||s.byteLength/T}else if(s.buffer){const T=s.stride||this.positionSize*4;i=i||s.buffer.byteLength/T}else if(s.value){const T=s.value,S=s.stride/T.BYTES_PER_ELEMENT||this.positionSize;i=i||T.length/S}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const b={};this._forEachGeometry((T,S)=>{const D=_[S]||T;b.vertexStart=n[S],b.indexStart=t[S];const N=S<n.length-1?n[S+1]:i;b.geometrySize=N-n[S],b.geometryIndex=S,this.updateGeometryAttributes(D,b)},c,f),this.vertexCount=t[t.length-1]}}const dZ=typeof window<"u"?Bt.useLayoutEffect:Bt.useEffect;function d_(r,e){for(;r;){if(r===e)return!0;r=Object.getPrototypeOf(r)}return!1}const AZ={position:"absolute",zIndex:-1};function E4(r,e){if(typeof r=="function")return r(e);if(Array.isArray(r))return r.map(t=>E4(t,e));if(my(r)){if(pZ(r))return e.style=AZ,Bt.cloneElement(r,e);if(gZ(r))return Bt.cloneElement(r,e)}return r}function my(r){return r&&typeof r=="object"&&"type"in r||!1}function pZ(r){var e;return(e=r.props)==null?void 0:e.mapStyle}function gZ(r){const e=r.type;return e&&e.deckGLViewProps}function Y2(r){if(typeof r=="function")return Bt.createElement(vA,{},r);if(Array.isArray(r))return r.map(Y2);if(my(r)){if(r.type===Bt.Fragment)return Y2(r.props.children);if(d_(r.type,vA))return r}return r}function mZ({children:r,layers:e=[],views:t=null}){const n=[],i=[],o={};return Bt.Children.forEach(Y2(r),s=>{if(my(s)){const c=s.type;if(d_(c,_s)){const f=_Z(c,s.props);i.push(f)}else n.push(s);if(d_(c,vA)&&c!==vA&&s.props.id){const f=new c(s.props);o[f.id]=f}}else s&&n.push(s)}),Object.keys(o).length>0&&(Array.isArray(t)?t.forEach(s=>{o[s.id]=s}):t&&(o[t.id]=t),t=Object.values(o)),e=i.length>0?[...i,...e]:e,{layers:e,children:n,views:t}}function _Z(r,e){const t={},n=r.defaultProps||{};for(const i in e)n[i]!==e[i]&&(t[i]=e[i]);return new r(t)}const yZ=Bt.createContext();function vZ({children:r,deck:e,ContextProvider:t=yZ.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const i={},o=n.views[0].id;for(const s of r){let c=o,f=s;my(s)&&d_(s.type,vA)&&(c=s.props.id||o,f=s.props.children);const _=n.getViewport(c),b=n.getViewState(c);if(_){b.padding=_.padding;const{x:T,y:S,width:D,height:N}=_;f=E4(f,{x:T,y:S,width:D,height:N,viewport:_,viewState:b}),i[c]||(i[c]={viewport:_,children:[]}),i[c].children.push(f)}}return Object.keys(i).map(s=>{const{viewport:c,children:f}=i[s],{x:_,y:b,width:T,height:S}=c,D={position:"absolute",left:_,top:b,width:T,height:S},N=`view-${s}`,G=Bt.createElement("div",{key:N,id:N,style:D},...f),W={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:j=>{j.viewId=s,e._onViewStateChange(j)},widgets:[]},z=`view-${s}-context`;return Bt.createElement(t,{key:z,value:W},G)})}const bZ={mixBlendMode:null};function xZ({width:r,height:e,style:t}){const n={position:"absolute",zIndex:0,left:0,top:0,width:r,height:e},i={left:0,top:0};if(t)for(const o in t)o in bZ?i[o]=t[o]:n[o]=t[o];return{containerStyle:n,canvasStyle:i}}function wZ(r){return{get deck(){return r.deck},pickObject:e=>r.deck.pickObject(e),pickMultipleObjects:e=>r.deck.pickMultipleObjects(e),pickObjects:e=>r.deck.pickObjects(e)}}function T4(r){r.redrawReason&&(r.deck._drawLayers(r.redrawReason),r.redrawReason=null)}function CZ(r,e,t){var i,o,s;const n=new e({...t,_customRender:((s=(o=(i=t.deviceProps)==null?void 0:i.adapters)==null?void 0:o[0])==null?void 0:s.type)==="webgpu"?void 0:c=>{r.redrawReason=c;const f=n.getViewports();r.lastRenderedViewports!==f?r.forceUpdate():T4(r)}});return n}function EZ(r,e){const[t,n]=Bt.useState(0),o=Bt.useRef({control:null,version:t,forceUpdate:()=>n(Z=>Z+1)}).current,s=Bt.useRef(null),c=Bt.useRef(null),f=Bt.useMemo(()=>mZ(r),[r.layers,r.views,r.children]);let _=!0;const b=Z=>{var ae;return _&&r.viewState?(o.viewStateUpdateRequested=Z,null):(o.viewStateUpdateRequested=null,(ae=r.onViewStateChange)==null?void 0:ae.call(r,Z))},T=Z=>{var ae;_?o.interactionStateUpdateRequested=Z:(o.interactionStateUpdateRequested=null,(ae=r.onInteractionStateChange)==null||ae.call(r,Z))},S=Bt.useMemo(()=>{const Z={widgets:[],...r,style:null,width:"100%",height:"100%",parent:s.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:b,onInteractionStateChange:T};return delete Z._customRender,o.deck&&o.deck.setProps(Z),Z},[r]);Bt.useEffect(()=>{const Z=r.Deck||Dw;return o.deck=CZ(o,Z,{...S,parent:s.current,canvas:c.current}),()=>{var ae;return(ae=o.deck)==null?void 0:ae.finalize()}},[]),dZ(()=>{T4(o);const{viewStateUpdateRequested:Z,interactionStateUpdateRequested:ae}=o;Z&&b(Z),ae&&T(ae)}),Bt.useImperativeHandle(e,()=>wZ(o),[]);const D=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:N,width:G="100%",height:W="100%",id:z,style:j}=r,{containerStyle:K,canvasStyle:fe}=Bt.useMemo(()=>xZ({width:G,height:W,style:j}),[G,W,j]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===D||o.version!==t){o.lastRenderedViewports=D,o.version=t;const Z=vZ({children:f.children,deck:o.deck,ContextProvider:N}),ae=Bt.createElement("canvas",{key:"canvas",id:z||"deckgl-overlay",ref:c,style:fe});o.control=Bt.createElement("div",{id:`${z||"deckgl"}-wrapper`,ref:s,style:K},[ae,Z])}return _=!1,o.control}const TZ=Bt.forwardRef(EZ);var io=1e-6,xA=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function BZ(){var r=new xA(4);return xA!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function SZ(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function IZ(r,e,t){var n=e[0],i=e[1],o=e[2],s=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*s,r[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*s,r[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*s,r[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*s,r}(function(){var r=BZ();return function(e,t,n,i,o,s){var c,f;for(t||(t=4),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],r[3]=e[c+3],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2],e[c+3]=r[3];return e}})();function Im(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cA(r,e){const t=IZ([],e,r);return SZ(t,t,1/t[3]),t}function DI(r,e){const t=r%e;return t<0?e+t:t}function MZ(r,e,t){return t*e+(1-t)*r}function q2(r,e,t){return r<e?e:r>t?t:r}function PZ(r){return Math.log(r)*Math.LOG2E}const Nw=Math.log2||PZ;function RZ(r,e){var t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],c=e[5],f=e[6],_=e[7],b=e[8],T=e[9],S=e[10],D=e[11],N=e[12],G=e[13],W=e[14],z=e[15],j=t*c-n*s,K=t*f-i*s,fe=t*_-o*s,Z=n*f-i*c,ae=n*_-o*c,Be=i*_-o*f,Le=b*G-T*N,de=b*W-S*N,_e=b*z-D*N,pe=T*W-S*G,J=T*z-D*G,ne=S*z-D*W,ye=j*ne-K*J+fe*pe+Z*_e-ae*de+Be*Le;return ye?(ye=1/ye,r[0]=(c*ne-f*J+_*pe)*ye,r[1]=(i*J-n*ne-o*pe)*ye,r[2]=(G*Be-W*ae+z*Z)*ye,r[3]=(S*ae-T*Be-D*Z)*ye,r[4]=(f*_e-s*ne-_*de)*ye,r[5]=(t*ne-i*_e+o*de)*ye,r[6]=(W*fe-N*Be-z*K)*ye,r[7]=(b*Be-S*fe+D*K)*ye,r[8]=(s*J-c*_e+_*Le)*ye,r[9]=(n*_e-t*J-o*Le)*ye,r[10]=(N*ae-G*fe+z*j)*ye,r[11]=(T*fe-b*ae-D*j)*ye,r[12]=(c*de-s*pe-f*Le)*ye,r[13]=(t*pe-n*de+i*Le)*ye,r[14]=(G*K-N*Z-W*j)*ye,r[15]=(b*Z-T*K+S*j)*ye,r):null}function mb(r,e,t){var n=e[0],i=e[1],o=e[2],s=e[3],c=e[4],f=e[5],_=e[6],b=e[7],T=e[8],S=e[9],D=e[10],N=e[11],G=e[12],W=e[13],z=e[14],j=e[15],K=t[0],fe=t[1],Z=t[2],ae=t[3];return r[0]=K*n+fe*c+Z*T+ae*G,r[1]=K*i+fe*f+Z*S+ae*W,r[2]=K*o+fe*_+Z*D+ae*z,r[3]=K*s+fe*b+Z*N+ae*j,K=t[4],fe=t[5],Z=t[6],ae=t[7],r[4]=K*n+fe*c+Z*T+ae*G,r[5]=K*i+fe*f+Z*S+ae*W,r[6]=K*o+fe*_+Z*D+ae*z,r[7]=K*s+fe*b+Z*N+ae*j,K=t[8],fe=t[9],Z=t[10],ae=t[11],r[8]=K*n+fe*c+Z*T+ae*G,r[9]=K*i+fe*f+Z*S+ae*W,r[10]=K*o+fe*_+Z*D+ae*z,r[11]=K*s+fe*b+Z*N+ae*j,K=t[12],fe=t[13],Z=t[14],ae=t[15],r[12]=K*n+fe*c+Z*T+ae*G,r[13]=K*i+fe*f+Z*S+ae*W,r[14]=K*o+fe*_+Z*D+ae*z,r[15]=K*s+fe*b+Z*N+ae*j,r}function Z2(r,e,t){var n=t[0],i=t[1],o=t[2],s,c,f,_,b,T,S,D,N,G,W,z;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*o+e[12],r[13]=e[1]*n+e[5]*i+e[9]*o+e[13],r[14]=e[2]*n+e[6]*i+e[10]*o+e[14],r[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],c=e[1],f=e[2],_=e[3],b=e[4],T=e[5],S=e[6],D=e[7],N=e[8],G=e[9],W=e[10],z=e[11],r[0]=s,r[1]=c,r[2]=f,r[3]=_,r[4]=b,r[5]=T,r[6]=S,r[7]=D,r[8]=N,r[9]=G,r[10]=W,r[11]=z,r[12]=s*n+b*i+N*o+e[12],r[13]=c*n+T*i+G*o+e[13],r[14]=f*n+S*i+W*o+e[14],r[15]=_*n+D*i+z*o+e[15]),r}function B4(r,e,t){var n=t[0],i=t[1],o=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*o,r[9]=e[9]*o,r[10]=e[10]*o,r[11]=e[11]*o,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function FZ(r,e,t){var n=Math.sin(t),i=Math.cos(t),o=e[4],s=e[5],c=e[6],f=e[7],_=e[8],b=e[9],T=e[10],S=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=o*i+_*n,r[5]=s*i+b*n,r[6]=c*i+T*n,r[7]=f*i+S*n,r[8]=_*i-o*n,r[9]=b*i-s*n,r[10]=T*i-c*n,r[11]=S*i-f*n,r}function OZ(r,e,t){var n=Math.sin(t),i=Math.cos(t),o=e[0],s=e[1],c=e[2],f=e[3],_=e[4],b=e[5],T=e[6],S=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*i+_*n,r[1]=s*i+b*n,r[2]=c*i+T*n,r[3]=f*i+S*n,r[4]=_*i-o*n,r[5]=b*i-s*n,r[6]=T*i-c*n,r[7]=S*i-f*n,r}function DZ(r,e,t,n,i){var o=1/Math.tan(e/2),s;return r[0]=o/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(n-i),r[10]=(i+n)*s,r[14]=2*i*n*s):(r[10]=-1,r[14]=-2*n),r}var LZ=DZ;function LI(r,e){var t=r[0],n=r[1],i=r[2],o=r[3],s=r[4],c=r[5],f=r[6],_=r[7],b=r[8],T=r[9],S=r[10],D=r[11],N=r[12],G=r[13],W=r[14],z=r[15],j=e[0],K=e[1],fe=e[2],Z=e[3],ae=e[4],Be=e[5],Le=e[6],de=e[7],_e=e[8],pe=e[9],J=e[10],ne=e[11],ye=e[12],Ye=e[13],we=e[14],Ne=e[15];return Math.abs(t-j)<=io*Math.max(1,Math.abs(t),Math.abs(j))&&Math.abs(n-K)<=io*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(i-fe)<=io*Math.max(1,Math.abs(i),Math.abs(fe))&&Math.abs(o-Z)<=io*Math.max(1,Math.abs(o),Math.abs(Z))&&Math.abs(s-ae)<=io*Math.max(1,Math.abs(s),Math.abs(ae))&&Math.abs(c-Be)<=io*Math.max(1,Math.abs(c),Math.abs(Be))&&Math.abs(f-Le)<=io*Math.max(1,Math.abs(f),Math.abs(Le))&&Math.abs(_-de)<=io*Math.max(1,Math.abs(_),Math.abs(de))&&Math.abs(b-_e)<=io*Math.max(1,Math.abs(b),Math.abs(_e))&&Math.abs(T-pe)<=io*Math.max(1,Math.abs(T),Math.abs(pe))&&Math.abs(S-J)<=io*Math.max(1,Math.abs(S),Math.abs(J))&&Math.abs(D-ne)<=io*Math.max(1,Math.abs(D),Math.abs(ne))&&Math.abs(N-ye)<=io*Math.max(1,Math.abs(N),Math.abs(ye))&&Math.abs(G-Ye)<=io*Math.max(1,Math.abs(G),Math.abs(Ye))&&Math.abs(W-we)<=io*Math.max(1,Math.abs(W),Math.abs(we))&&Math.abs(z-Ne)<=io*Math.max(1,Math.abs(z),Math.abs(Ne))}function kZ(){var r=new xA(2);return xA!=Float32Array&&(r[0]=0,r[1]=0),r}function Q2(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function NZ(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r}function UZ(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r}function zZ(r){var e=r[0],t=r[1];return Math.hypot(e,t)}function GZ(r,e){return r[0]=-e[0],r[1]=-e[1],r}function S4(r,e,t,n){var i=e[0],o=e[1];return r[0]=i+n*(t[0]-i),r[1]=o+n*(t[1]-o),r}var VZ=NZ;(function(){var r=kZ();return function(e,t,n,i,o,s){var c,f;for(t||(t=2),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],o(r,r,s),e[c]=r[0],e[c+1]=r[1];return e}})();function HZ(){var r=new xA(3);return xA!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function jZ(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function $Z(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function WZ(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}var JZ=$Z;(function(){var r=HZ();return function(e,t,n,i,o,s){var c,f;for(t||(t=3),n||(n=0),i?f=Math.min(i*t+n,e.length):f=e.length,c=n;c<f;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],o(r,r,s),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2];return e}})();function Vu(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const lc=Math.PI,I4=lc/4,Qc=lc/180,ex=180/lc,ug=512,kI=4003e4,NI=85.051129,M4=1.5;function tx(r){return Math.pow(2,r)}function XZ(r){return Nw(r)}function Du(r){const[e,t]=r;Vu(Number.isFinite(e)),Vu(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*Qc,i=t*Qc,o=ug*(n+lc)/(2*lc),s=ug*(lc+Math.log(Math.tan(I4+i*.5)))/(2*lc);return[o,s]}function Uu(r){const[e,t]=r,n=e/ug*(2*lc)-lc,i=2*(Math.atan(Math.exp(t/ug*(2*lc)-lc))-I4);return[n*ex,i*ex]}function KZ(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;Vu(Number.isFinite(e)&&Number.isFinite(t));const i=ug,o=Math.cos(e*Qc),s=i/360,c=s/o,f=i/kI/o,_={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[s,c,f],degreesPerUnit:[1/s,1/c,1/f]};if(n){const b=Qc*Math.tan(e*Qc)/o,T=s*b/2,S=i/kI*b,D=S/c*f;_.unitsPerDegree2=[0,T,S],_.unitsPerMeter2=[D,0,D]}return _}function YZ(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:o,center:s}=r,c=Im();Z2(c,c,[0,0,-i]),FZ(c,c,-t*Qc),OZ(c,c,n*Qc);const f=o/e;return B4(c,c,[f,f,f]),s&&Z2(c,c,WZ([],s)),c}function qZ(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:o,center:s,scale:c,nearZMultiplier:f=1,farZMultiplier:_=1}=r;let{fovy:b=A_(M4)}=r;n!==void 0&&(b=A_(n));const T=b*Qc,S=i*Qc,D=P4(b);let N=D;s&&(N+=s[2]*c/Math.cos(S)/t);const G=T*(.5+(o?o[1]:0)/t),W=Math.sin(G)*N/Math.sin(q2(Math.PI/2-S-G,.01,Math.PI-.01)),z=Math.sin(S)*W+N,j=N*10,K=Math.min(z*_,j);return{fov:T,aspect:e/t,focalDistance:D,near:f,far:K}}function ZZ(r){const{fov:e,aspect:t,near:n,far:i}=qZ(r);return LZ([],e,t,n,i)}function A_(r){return 2*Math.atan(.5/r)*ex}function P4(r){return .5/Math.tan(.5*r*Qc)}function QZ(r,e){const[t,n,i=0]=r;return Vu(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),cA(e,[t,n,i,1])}function UI(r,e,t=0){const[n,i,o]=r;if(Vu(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return cA(e,[n,i,o,1]);const s=cA(e,[n,i,0,1]),c=cA(e,[n,i,1,1]),f=s[2],_=c[2],b=f===_?0:((t||0)-f)/(_-f);return S4([],s,c,b)}function eQ(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=r,[[c,f],[_,b]]=n,T=tQ(r.padding),S=Du([c,q2(b,-85.051129,NI)]),D=Du([_,q2(f,-85.051129,NI)]),N=[Math.max(Math.abs(D[0]-S[0]),i),Math.max(Math.abs(D[1]-S[1]),i)],G=[e-T.left-T.right-Math.abs(s[0])*2,t-T.top-T.bottom-Math.abs(s[1])*2];Vu(G[0]>0&&G[1]>0);const W=G[0]/N[0],z=G[1]/N[1],j=(T.right-T.left)/2/W,K=(T.top-T.bottom)/2/z,fe=[(D[0]+S[0])/2+j,(D[1]+S[1])/2+K],Z=Uu(fe),ae=Math.min(o,Nw(Math.abs(Math.min(W,z))));return Vu(Number.isFinite(ae)),{longitude:Z[0],latitude:Z[1],zoom:ae}}function tQ(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(Vu(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const zI=Math.PI/180;function rQ(r,e=0){const{width:t,height:n,unproject:i}=r,o={targetZ:e},s=i([0,n],o),c=i([t,n],o);let f,_;const b=r.fovy?.5*r.fovy*zI:Math.atan(.5/r.altitude),T=(90-r.pitch)*zI;return b>T-.01?(f=GI(r,0,e),_=GI(r,t,e)):(f=i([0,0],o),_=i([t,0],o)),[s,c,_,f]}function GI(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=cA(n,[e,0,1,1]),o=cA(n,[e,r.height,1,1]),c=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),f=S4([],i,o,c),_=Uu(f);return _.push(t),_}class el{constructor(e={width:1,height:1}){yr(this,"latitude",void 0),yr(this,"longitude",void 0),yr(this,"zoom",void 0),yr(this,"pitch",void 0),yr(this,"bearing",void 0),yr(this,"altitude",void 0),yr(this,"fovy",void 0),yr(this,"meterOffset",void 0),yr(this,"center",void 0),yr(this,"width",void 0),yr(this,"height",void 0),yr(this,"scale",void 0),yr(this,"distanceScales",void 0),yr(this,"viewMatrix",void 0),yr(this,"projectionMatrix",void 0),yr(this,"viewProjectionMatrix",void 0),yr(this,"pixelProjectionMatrix",void 0),yr(this,"pixelUnprojectionMatrix",void 0),yr(this,"equals",z=>z instanceof el?z.width===this.width&&z.height===this.height&&LI(z.projectionMatrix,this.projectionMatrix)&&LI(z.viewMatrix,this.viewMatrix):!1),yr(this,"project",(z,j={})=>{const{topLeft:K=!0}=j,fe=this.projectPosition(z),Z=QZ(fe,this.pixelProjectionMatrix),[ae,Be]=Z,Le=K?Be:this.height-Be;return z.length===2?[ae,Le]:[ae,Le,Z[2]]}),yr(this,"unproject",(z,j={})=>{const{topLeft:K=!0,targetZ:fe=void 0}=j,[Z,ae,Be]=z,Le=K?ae:this.height-ae,de=fe&&fe*this.distanceScales.unitsPerMeter[2],_e=UI([Z,Le,Be],this.pixelUnprojectionMatrix,de),[pe,J,ne]=this.unprojectPosition(_e);return Number.isFinite(Be)?[pe,J,ne]:Number.isFinite(fe)?[pe,J,fe]:[pe,J]}),yr(this,"projectPosition",z=>{const[j,K]=Du(z),fe=(z[2]||0)*this.distanceScales.unitsPerMeter[2];return[j,K,fe]}),yr(this,"unprojectPosition",z=>{const[j,K]=Uu(z),fe=(z[2]||0)*this.distanceScales.metersPerUnit[2];return[j,K,fe]});let{width:t,height:n,altitude:i=null,fovy:o=null}=e;const{latitude:s=0,longitude:c=0,zoom:f=0,pitch:_=0,bearing:b=0,position:T=null,nearZMultiplier:S=.02,farZMultiplier:D=1.01}=e;t=t||1,n=n||1,o===null&&i===null?(i=M4,o=A_(i)):o===null?o=A_(i):i===null&&(i=P4(o));const N=tx(f);i=Math.max(.75,i);const G=KZ({longitude:c,latitude:s}),W=Du([c,s]);W.push(0),T&&jZ(W,W,JZ([],T,G.unitsPerMeter)),this.projectionMatrix=ZZ({width:t,height:n,scale:N,center:W,pitch:_,fovy:o,nearZMultiplier:S,farZMultiplier:D}),this.viewMatrix=YZ({height:n,scale:N,center:W,pitch:_,bearing:b,altitude:i}),this.width=t,this.height=n,this.scale=N,this.latitude=s,this.longitude=c,this.zoom=f,this.pitch=_,this.bearing=b,this.altitude=i,this.fovy=o,this.center=W,this.meterOffset=T||[0,0,0],this.distanceScales=G,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:t,projectionMatrix:n,viewMatrix:i}=this,o=Im();mb(o,o,n),mb(o,o,i),this.viewProjectionMatrix=o;const s=Im();B4(s,s,[e/2,-t/2,1]),Z2(s,s,[1,-1,0]),mb(s,s,o);const c=RZ(Im(),s);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=c}projectFlat(e){return Du(e)}unprojectFlat(e){return Uu(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const n=UI(t,this.pixelUnprojectionMatrix),i=Du(e),o=Q2([],i,GZ([],n)),s=Q2([],this.center,o);return Uu(s)}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:c}=eQ(Object.assign({width:n,height:i,bounds:e},t));return new el({width:n,height:i,longitude:o,latitude:s,zoom:c})}getBounds(e){const t=this.getBoundingRegion(e),n=Math.min(...t.map(c=>c[0])),i=Math.max(...t.map(c=>c[0])),o=Math.min(...t.map(c=>c[1])),s=Math.max(...t.map(c=>c[1]));return[[n,o],[i,s]]}getBoundingRegion(e={}){return rQ(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}}const VI=512;function nQ(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:o,zoom:s,bearing:c=0}=r;(i<-180||i>180)&&(i=DI(i+180,360)-180),(c<-180||c>180)&&(c=DI(c+180,360)-180);const f=Nw(t/VI);if(s<=f)s=f,o=0;else{const _=t/2/Math.pow(2,s),b=Uu([0,_])[1];if(o<b)o=b;else{const T=Uu([0,VI-_])[1];o>T&&(o=T)}}return{width:e,height:t,longitude:i,latitude:o,zoom:s,pitch:n,bearing:c}}const R4=.01,iQ=["longitude","latitude","zoom"],F4={curve:1.414,speed:1.2};function sQ(r,e,t,n){const{startZoom:i,startCenterXY:o,uDelta:s,w0:c,u1:f,S:_,rho:b,rho2:T,r0:S}=O4(r,e,n);if(f<R4){const fe={};for(const Z of iQ){const ae=r[Z],Be=e[Z];fe[Z]=MZ(ae,Be,t)}return fe}const D=t*_,N=Math.cosh(S)/Math.cosh(S+b*D),G=c*((Math.cosh(S)*Math.tanh(S+b*D)-Math.sinh(S))/T)/f,W=1/N,z=i+XZ(W),j=UZ([],s,G);Q2(j,j,o);const K=Uu(j);return{longitude:K[0],latitude:K[1],zoom:z}}function oQ(r,e,t){const n={...F4,...t},{screenSpeed:i,speed:o,maxDuration:s}=n,{S:c,rho:f}=O4(r,e,n),_=1e3*c;let b;return Number.isFinite(i)?b=_/(i/f):b=_/o,Number.isFinite(s)&&b>s?0:b}function O4(r,e,t){t=Object.assign({},F4,t);const n=t.curve,i=r.zoom,o=[r.longitude,r.latitude],s=tx(i),c=e.zoom,f=[e.longitude,e.latitude],_=tx(c-i),b=Du(o),T=Du(f),S=VZ([],T,b),D=Math.max(r.width,r.height),N=D/_,G=zZ(S)*s,W=Math.max(G,R4),z=n*n,j=(N*N-D*D+z*z*W*W)/(2*D*z*W),K=(N*N-D*D-z*z*W*W)/(2*N*z*W),fe=Math.log(Math.sqrt(j*j+1)-j),Z=Math.log(Math.sqrt(K*K+1)-K),ae=(Z-fe)/n;return{startZoom:i,startCenterXY:b,uDelta:S,w0:D,u1:G,S:ae,rho:n,rho2:z,r0:fe,r1:Z}}var D4=function(){if(typeof Map<"u")return Map;function r(e,t){var n=-1;return e.some(function(i,o){return i[0]===t?(n=o,!0):!1}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var n=r(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(t,n){var i=r(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},e.prototype.delete=function(t){var n=this.__entries__,i=r(n,t);~i&&n.splice(i,1)},e.prototype.has=function(t){return!!~r(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,n){n===void 0&&(n=null);for(var i=0,o=this.__entries__;i<o.length;i++){var s=o[i];t.call(n,s[1],s[0])}},e}()}(),rx=typeof window<"u"&&typeof document<"u"&&window.document===document,p_=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),aQ=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(p_):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),cQ=2;function lQ(r,e){var t=!1,n=!1,i=0;function o(){t&&(t=!1,r()),n&&c()}function s(){aQ(o)}function c(){var f=Date.now();if(t){if(f-i<cQ)return;n=!0}else t=!0,n=!1,setTimeout(s,e);i=f}return c}var uQ=20,fQ=["top","right","bottom","left","width","height","size","weight"],hQ=typeof MutationObserver<"u",dQ=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=lQ(this.refresh.bind(this),uQ)}return r.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},r.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},r.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},r.prototype.connect_=function(){!rx||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),hQ?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!rx||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=t===void 0?"":t,i=fQ.some(function(o){return!!~n.indexOf(o)});i&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),L4=function(r,e){for(var t=0,n=Object.keys(e);t<n.length;t++){var i=n[t];Object.defineProperty(r,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return r},wA=function(r){var e=r&&r.ownerDocument&&r.ownerDocument.defaultView;return e||p_},k4=_y(0,0,0,0);function g_(r){return parseFloat(r)||0}function HI(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(n,i){var o=r["border-"+i+"-width"];return n+g_(o)},0)}function AQ(r){for(var e=["top","right","bottom","left"],t={},n=0,i=e;n<i.length;n++){var o=i[n],s=r["padding-"+o];t[o]=g_(s)}return t}function pQ(r){var e=r.getBBox();return _y(0,0,e.width,e.height)}function gQ(r){var e=r.clientWidth,t=r.clientHeight;if(!e&&!t)return k4;var n=wA(r).getComputedStyle(r),i=AQ(n),o=i.left+i.right,s=i.top+i.bottom,c=g_(n.width),f=g_(n.height);if(n.boxSizing==="border-box"&&(Math.round(c+o)!==e&&(c-=HI(n,"left","right")+o),Math.round(f+s)!==t&&(f-=HI(n,"top","bottom")+s)),!_Q(r)){var _=Math.round(c+o)-e,b=Math.round(f+s)-t;Math.abs(_)!==1&&(c-=_),Math.abs(b)!==1&&(f-=b)}return _y(i.left,i.top,c,f)}var mQ=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof wA(r).SVGGraphicsElement}:function(r){return r instanceof wA(r).SVGElement&&typeof r.getBBox=="function"}}();function _Q(r){return r===wA(r).document.documentElement}function yQ(r){return rx?mQ(r)?pQ(r):gQ(r):k4}function vQ(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,s=Object.create(o.prototype);return L4(s,{x:e,y:t,width:n,height:i,top:t,right:e+n,bottom:i+t,left:e}),s}function _y(r,e,t,n){return{x:r,y:e,width:t,height:n}}var bQ=function(){function r(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=_y(0,0,0,0),this.target=e}return r.prototype.isActive=function(){var e=yQ(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},r}(),xQ=function(){function r(e,t){var n=vQ(t);L4(this,{target:e,contentRect:n})}return r}(),wQ=function(){function r(e,t,n){if(this.activeObservations_=[],this.observations_=new D4,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return r.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof wA(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new bQ(e)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof wA(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(n){return new xQ(n.target,n.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),N4=typeof WeakMap<"u"?new WeakMap:new D4,U4=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=dQ.getInstance(),n=new wQ(e,t,this);N4.set(this,n)}return r}();["observe","unobserve","disconnect"].forEach(function(r){U4.prototype[r]=function(){var e;return(e=N4.get(this))[r].apply(e,arguments)}});var CQ=function(){return typeof p_.ResizeObserver<"u"?p_.ResizeObserver:U4}(),Ol=typeof document<"u"?document:{};function jI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function G0(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):jI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function $I(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=EQ(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(_){throw _},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var _=t.next();return o=_.done,_},e:function(_){s=!0,c=_},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function EQ(r,e){if(r){if(typeof r=="string")return WI(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return WI(r,e)}}function WI(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var TQ=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _b(r){if(!r)return null;if(typeof r=="string")return r;r.toJS&&(r=r.toJS());var e={},t=$I(r.layers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;e[i.id]=i}}catch(s){t.e(s)}finally{t.f()}var o=r.layers.map(function(s){var c=e[s.ref],f=null;if("interactive"in s&&(f=G0({},s),delete f.interactive),c){f=f||G0({},s),delete f.ref;var _=$I(TQ),b;try{for(_.s();!(b=_.n()).done;){var T=b.value;T in c&&(f[T]=c[T])}}catch(S){_.e(S)}finally{_.f()}}return f||s});return G0(G0({},r),{},{layers:o})}var JI={};function BQ(){}function SQ(r){r&&console.error(r.error)}var z4={container:dt.object,gl:dt.object,mapboxApiAccessToken:dt.string,mapboxApiUrl:dt.string,attributionControl:dt.bool,preserveDrawingBuffer:dt.bool,reuseMaps:dt.bool,transformRequest:dt.func,mapOptions:dt.object,mapStyle:dt.oneOfType([dt.string,dt.object]),preventStyleDiffing:dt.bool,visible:dt.bool,asyncRender:dt.bool,onLoad:dt.func,onError:dt.func,width:dt.number,height:dt.number,viewState:dt.object,longitude:dt.number,latitude:dt.number,zoom:dt.number,bearing:dt.number,pitch:dt.number,altitude:dt.number},Mm={container:Ol.body,mapboxApiAccessToken:IQ(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:BQ,onError:SQ,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function IQ(){var r=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);r=e&&e[1]}return!r&&typeof process<"u"&&(r=r||JI.MapboxAccessToken||JI.REACT_APP_MAPBOX_ACCESS_TOKEN),r||"no-token"}function XI(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";r.debug&&dt.checkPropTypes(z4,r,"prop",e)}var uh=function(){function r(e){var t=this;if(Ku(this,r),yr(this,"props",Mm),yr(this,"width",0),yr(this,"height",0),yr(this,"_fireLoadEvent",function(){t.props.onLoad({type:"load",target:t._map})}),yr(this,"_handleError",function(n){t.props.onError(n)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,r.initialized||(r.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Xu(r,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=r.savedMap;var n=this._map.getContainer(),i=t.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,r.savedMap=null,t.mapStyle&&this._map.setStyle(_b(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&r.savedMap)this._reuse(t);else{if(t.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,t.gl}}var i={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:_b(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(i.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!r.savedMap?(r.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var n=this;t=Object.assign({},Mm,t),XI(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||Mm.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var i=t,o=i.container;Object.defineProperty(o,"offsetWidth",{configurable:!0,get:function(){return n.width}}),Object.defineProperty(o,"clientWidth",{configurable:!0,get:function(){return n.width}}),Object.defineProperty(o,"offsetHeight",{configurable:!0,get:function(){return n.height}}),Object.defineProperty(o,"clientHeight",{configurable:!0,get:function(){return n.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,n){if(this._map){n=Object.assign({},this.props,n),XI(n,"Mapbox");var i=this._updateMapViewport(t,n),o=this._updateMapSize(t,n);this._updateMapStyle(t,n),!n.asyncRender&&(i||o)&&this.redraw(),this.props=n}}},{key:"_updateMapStyle",value:function(t,n){var i=t.mapStyle!==n.mapStyle;i&&this._map.setStyle(_b(n.mapStyle),{diff:!n.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,n){var i=t.width!==n.width||t.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this._map.resize()),i}},{key:"_updateMapViewport",value:function(t,n){var i=this._getViewState(t),o=this._getViewState(n),s=o.latitude!==i.latitude||o.longitude!==i.longitude||o.zoom!==i.zoom||o.pitch!==i.pitch||o.bearing!==i.bearing||o.altitude!==i.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(o)),o.altitude!==i.altitude&&(this._map.transform.altitude=o.altitude)),s}},{key:"_getViewState",value:function(t){var n=t.viewState||t,i=n.longitude,o=n.latitude,s=n.zoom,c=n.pitch,f=c===void 0?0:c,_=n.bearing,b=_===void 0?0:_,T=n.altitude,S=T===void 0?1.5:T;return{longitude:i,latitude:o,zoom:s,pitch:f,bearing:b,altitude:S}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Ol>"u"))try{var n=Ol.createElement("div");n.className="mapboxgl-map",n.style.display="none",Ol.body.appendChild(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var o=Ol.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),Ol.head.appendChild(o)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),r}();yr(uh,"initialized",!1);yr(uh,"propTypes",z4);yr(uh,"defaultProps",Mm);yr(uh,"savedMap",null);var Pm={exports:{}},MQ=Pm.exports,KI;function PQ(){return KI||(KI=1,function(r,e){(function(t,n){r.exports=n()})(MQ,function(){var t,n,i;function o(s,c){if(!t)t=c;else if(!n)n=c;else{var f="var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk);",_={};t(_),i=c(_),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})))}}return o(["exports"],function(s){function c(a,u){return a(u={exports:{}},u.exports),u.exports}var f=_;function _(a,u,A,x){this.cx=3*a,this.bx=3*(A-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(x-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=A,this.p2y=x}_.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},_.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},_.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},_.prototype.solveCurveX=function(a,u){var A,x,E,I,F;for(u===void 0&&(u=1e-6),E=a,F=0;F<8;F++){if(I=this.sampleCurveX(E)-a,Math.abs(I)<u)return E;var k=this.sampleCurveDerivativeX(E);if(Math.abs(k)<1e-6)break;E-=I/k}if((E=a)<(A=0))return A;if(E>(x=1))return x;for(;A<x;){if(I=this.sampleCurveX(E),Math.abs(I-a)<u)return E;a>I?A=E:x=E,E=.5*(x-A)+A}return E},_.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var b=T;function T(a,u){this.x=a,this.y=u}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,A=a.y-this.y;return u*u+A*A},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),A=Math.sin(a),x=A*this.x+u*this.y;return this.x=u*this.x-A*this.y,this.y=x,this},_rotateAround:function(a,u){var A=Math.cos(a),x=Math.sin(a),E=u.y+x*(this.x-u.x)+A*(this.y-u.y);return this.x=u.x+A*(this.x-u.x)-x*(this.y-u.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(a){return a instanceof T?a:Array.isArray(a)?new T(a[0],a[1]):a};var S=typeof self<"u"?self:{},D=Math.pow(2,53)-1;function N(a,u,A,x){var E=new f(a,u,A,x);return function(I){return E.solve(I)}}var G=N(.25,.1,.25,1);function W(a,u,A){return Math.min(A,Math.max(u,a))}function z(a,u,A){var x=A-u,E=((a-u)%x+x)%x+u;return E===u?A:E}function j(a){for(var u=[],A=arguments.length-1;A-- >0;)u[A]=arguments[A+1];for(var x=0,E=u;x<E.length;x+=1){var I=E[x];for(var F in I)a[F]=I[F]}return a}var K=1;function fe(){return K++}function Z(){return function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function ae(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Be(a,u){a.forEach(function(A){u[A]&&(u[A]=u[A].bind(u))})}function Le(a,u){return a.indexOf(u,a.length-u.length)!==-1}function de(a,u,A){var x={};for(var E in a)x[E]=u.call(A||this,a[E],E,a);return x}function _e(a,u,A){var x={};for(var E in a)u.call(A||this,a[E],E,a)&&(x[E]=a[E]);return x}function pe(a){return Array.isArray(a)?a.map(pe):typeof a=="object"&&a?de(a,pe):a}var J={};function ne(a){J[a]||(typeof console<"u"&&console.warn(a),J[a]=!0)}function ye(a,u,A){return(A.y-a.y)*(u.x-a.x)>(u.y-a.y)*(A.x-a.x)}function Ye(a){for(var u=0,A=0,x=a.length,E=x-1,I=void 0,F=void 0;A<x;E=A++)u+=((F=a[E]).x-(I=a[A]).x)*(I.y+F.y);return u}function we(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ne(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,E,I,F){var k=I||F;return u[E]=!k||k.toLowerCase(),""}),u["max-age"]){var A=parseInt(u["max-age"],10);isNaN(A)?delete u["max-age"]:u["max-age"]=A}return u}var Ge=null;function Qe(a){if(Ge==null){var u=a.navigator?a.navigator.userAgent:null;Ge=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Ge}function rt(a){try{var u=S[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var tt,lt,mt,Tt,nt=S.performance&&S.performance.now?S.performance.now.bind(S.performance):Date.now.bind(Date),cr=S.requestAnimationFrame||S.mozRequestAnimationFrame||S.webkitRequestAnimationFrame||S.msRequestAnimationFrame,Xt=S.cancelAnimationFrame||S.mozCancelAnimationFrame||S.webkitCancelAnimationFrame||S.msCancelAnimationFrame,$t={now:nt,frame:function(a){var u=cr(a);return{cancel:function(){return Xt(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var A=S.document.createElement("canvas"),x=A.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return A.width=a.width,A.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return tt||(tt=S.document.createElement("a")),tt.href=a,tt.href},hardwareConcurrency:S.navigator&&S.navigator.hardwareConcurrency||4,get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(lt==null&&(lt=S.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)}},Lt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},lr={supported:!1,testSupport:function(a){!tn&&Tt&&(Er?Ar(a):mt=a)}},tn=!1,Er=!1;function Ar(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Tt),a.isContextLost())return;lr.supported=!0}catch{}a.deleteTexture(u),tn=!0}S.document&&((Tt=S.document.createElement("img")).onload=function(){mt&&Ar(mt),mt=null,Er=!0},Tt.onerror=function(){tn=!0,mt=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Mn="01",hr=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function pr(a){return a.indexOf("mapbox:")===0}hr.prototype._createSkuToken=function(){var a=function(){for(var u="",A=0;A<10;A++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Mn,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},hr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},hr.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},hr.prototype.normalizeStyleURL=function(a,u){if(!pr(a))return a;var A=$n(a);return A.path="/styles/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||u)},hr.prototype.normalizeGlyphsURL=function(a,u){if(!pr(a))return a;var A=$n(a);return A.path="/fonts/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||u)},hr.prototype.normalizeSourceURL=function(a,u){if(!pr(a))return a;var A=$n(a);return A.path="/v4/"+A.authority+".json",A.params.push("secure"),this._makeAPIURL(A,this._customAccessToken||u)},hr.prototype.normalizeSpriteURL=function(a,u,A,x){var E=$n(a);return pr(a)?(E.path="/styles/v1"+E.path+"/sprite"+u+A,this._makeAPIURL(E,this._customAccessToken||x)):(E.path+=""+u+A,un(E))},hr.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!pr(a))return a;var A=$n(a);A.path=A.path.replace(/(\.(png|jpg)\d*)(?=$)/,($t.devicePixelRatio>=2||u===512?"@2x":"")+(lr.supported?".webp":"$1")),A.path=A.path.replace(/^.+\/v4\//,"/"),A.path="/v4"+A.path;var x=this._customAccessToken||function(E){for(var I=0,F=E;I<F.length;I+=1){var k=F[I].match(/^access_token=(.*)$/);if(k)return k[1]}return null}(A.params)||Lt.ACCESS_TOKEN;return Lt.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&A.params.push("sku="+this._skuToken),this._makeAPIURL(A,x)},hr.prototype.canonicalizeTileURL=function(a,u){var A=$n(a);if(!A.path.match(/(^\/v4\/)/)||!A.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=A.path.replace("/v4/","");var E=A.params;return u&&(E=E.filter(function(I){return!I.match(/^access_token=/)})),E.length&&(x+="?"+E.join("&")),x},hr.prototype.canonicalizeTileset=function(a,u){for(var A=!!u&&pr(u),x=[],E=0,I=a.tiles||[];E<I.length;E+=1){var F=I[E];Sr(F)?x.push(this.canonicalizeTileURL(F,A)):x.push(F)}return x},hr.prototype._makeAPIURL=function(a,u){var A="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=$n(Lt.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var E=a.params.indexOf("secure");E>=0&&a.params.splice(E,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Lt.REQUIRE_ACCESS_TOKEN)return un(a);if(!(u=u||Lt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+A);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+A);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+u),un(a)};var rn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Sr(a){return rn.test(a)}var ei=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $n(a){var u=a.match(ei);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function un(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function Xn(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(u[1]).split("").map(function(A){return"%"+("00"+A.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Nn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Nn.prototype.getStorageKey=function(a){var u,A=Xn(Lt.ACCESS_TOKEN);return u=A&&A.u?S.btoa(encodeURIComponent(A.u).replace(/%([0-9A-F]{2})/g,function(x,E){return String.fromCharCode(+("0x"+E))})):Lt.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},Nn.prototype.fetchEventData=function(){var a=rt("localStorage"),u=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{var x=S.localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));var E=S.localStorage.getItem(A);E&&(this.anonId=E)}catch{ne("Unable to read from LocalStorage")}},Nn.prototype.saveEventData=function(){var a=rt("localStorage"),u=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{S.localStorage.setItem(A,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{ne("Unable to write to LocalStorage")}},Nn.prototype.processRequests=function(a){},Nn.prototype.postEvent=function(a,u,A,x){var E=this;if(Lt.EVENTS_URL){var I=$n(Lt.EVENTS_URL);I.params.push("access_token="+(x||Lt.ACCESS_TOKEN||""));var F={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Mn,userId:this.anonId},k=u?j(F,u):F,H={url:un(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=ct(H,function(Y){E.pendingRequest=null,A(Y),E.saveEventData(),E.processRequests(x)})}},Nn.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var bn,Wn,Ut=function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(A,x,E,I){this.skuToken=E;var F=!(!I&&!Lt.ACCESS_TOKEN),k=Array.isArray(A)&&A.some(function(H){return pr(H)||Sr(H)});Lt.EVENTS_URL&&F&&k&&this.queueRequest({id:x,timestamp:Date.now()},I)},u.prototype.processRequests=function(A){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var E=this.queue.shift(),I=E.id,F=E.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),ae(this.anonId)||(this.anonId=Z()),this.postEvent(F,{skuToken:this.skuToken},function(k){k||I&&(x.success[I]=!0)},A))}},u}(Nn),dr=new(function(a){function u(A){a.call(this,"appUserTurnstile"),this._customAccessToken=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(A,x){Lt.EVENTS_URL&&Lt.ACCESS_TOKEN&&Array.isArray(A)&&A.some(function(E){return pr(E)||Sr(E)})&&this.queueRequest(Date.now(),x)},u.prototype.processRequests=function(A){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var E=Xn(Lt.ACCESS_TOKEN),I=E?E.u:Lt.ACCESS_TOKEN,F=I!==this.eventData.tokenU;ae(this.anonId)||(this.anonId=Z(),F=!0);var k=this.queue.shift();if(this.eventData.lastSuccess){var H=new Date(this.eventData.lastSuccess),Y=new Date(k),ee=(k-this.eventData.lastSuccess)/864e5;F=F||ee>=1||ee<-1||H.getDate()!==Y.getDate()}else F=!0;if(!F)return this.processRequests();this.postEvent(k,{"enabled.telemetry":!1},function(se){se||(x.eventData.lastSuccess=k,x.eventData.tokenU=I)},A)}},u}(Nn)),Tr=dr.postTurnstileEvent.bind(dr),qr=new Ut,ui=qr.postMapLoadEvent.bind(qr),Pe=500,Dt=50;function Vt(){S.caches&&!bn&&(bn=S.caches.open("mapbox-tiles"))}function sr(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var Ze,Mt=1/0;function ge(){return Ze==null&&(Ze=S.OffscreenCanvas&&new S.OffscreenCanvas(1,1).getContext("2d")&&typeof S.createImageBitmap=="function"),Ze}var Nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Nt);var wt=function(a){function u(A,x,E){x===401&&Sr(E)&&(A+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,A),this.status=x,this.url=E,this.name=this.constructor.name,this.message=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),$=we()?function(){return self.worker&&self.worker.referrer}:function(){return(S.location.protocol==="blob:"?S.parent:S).location.href},yt,Et,Te=function(a,u){if(!(/^file:/.test(A=a.url)||/^file:/.test($())&&!/^\w+:/.test(A))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(x,E){var I,F=new S.AbortController,k=new S.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:$(),signal:F.signal}),H=!1,Y=!1,ee=(I=k.url).indexOf("sku=")>0&&Sr(I);x.type==="json"&&k.headers.set("Accept","application/json");var se=function(ve,Ue,ze){if(!Y){if(ve&&ve.message!=="SecurityError"&&ne(ve),Ue&&ze)return he(Ue);var je=Date.now();S.fetch(k).then(function(Ve){if(Ve.ok){var qe=ee?Ve.clone():null;return he(Ve,qe,je)}return E(new wt(Ve.statusText,Ve.status,x.url))}).catch(function(Ve){Ve.code!==20&&E(new Error(Ve.message))})}},he=function(ve,Ue,ze){(x.type==="arrayBuffer"?ve.arrayBuffer():x.type==="json"?ve.json():ve.text()).then(function(je){Y||(Ue&&ze&&function(Ve,qe,at){if(Vt(),bn){var pt={status:qe.status,statusText:qe.statusText,headers:new S.Headers};qe.headers.forEach(function(Pt,Gt){return pt.headers.set(Gt,Pt)});var _t=Ne(qe.headers.get("Cache-Control")||"");_t["no-store"]||(_t["max-age"]&&pt.headers.set("Expires",new Date(at+1e3*_t["max-age"]).toUTCString()),new Date(pt.headers.get("Expires")).getTime()-at<42e4||function(Pt,Gt){if(Wn===void 0)try{new Response(new ReadableStream),Wn=!0}catch{Wn=!1}Wn?Gt(Pt.body):Pt.blob().then(Gt)}(qe,function(Pt){var Gt=new S.Response(Pt,pt);Vt(),bn&&bn.then(function(Jt){return Jt.put(sr(Ve.url),Gt)}).catch(function(Jt){return ne(Jt.message)})}))}}(k,Ue,ze),H=!0,E(null,je,ve.headers.get("Cache-Control"),ve.headers.get("Expires")))}).catch(function(je){Y||E(new Error(je.message))})};return ee?function(ve,Ue){if(Vt(),!bn)return Ue(null);var ze=sr(ve.url);bn.then(function(je){je.match(ze).then(function(Ve){var qe=function(at){if(!at)return!1;var pt=new Date(at.headers.get("Expires")||0),_t=Ne(at.headers.get("Cache-Control")||"");return pt>Date.now()&&!_t["no-cache"]}(Ve);je.delete(ze),qe&&je.put(ze,Ve.clone()),Ue(null,Ve,qe)}).catch(Ue)}).catch(Ue)}(k,se):se(null,null),{cancel:function(){Y=!0,H||F.abort()}}}(a,u);if(we()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var A;return function(x,E){var I=new S.XMLHttpRequest;for(var F in I.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(I.responseType="arraybuffer"),x.headers)I.setRequestHeader(F,x.headers[F]);return x.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=x.credentials==="include",I.onerror=function(){E(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var k=I.response;if(x.type==="json")try{k=JSON.parse(I.response)}catch(H){return E(H)}E(null,k,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else E(new wt(I.statusText,I.status,x.url))},I.send(x.body),{cancel:function(){return I.abort()}}}(a,u)},Je=function(a,u){return Te(j(a,{type:"arrayBuffer"}),u)},ct=function(a,u){return Te(j(a,{method:"POST"}),u)},q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";yt=[],Et=0;var ie=function(a,u){if(lr.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Et>=Lt.MAX_PARALLEL_IMAGE_REQUESTS){var A={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return yt.push(A),A}Et++;var x=!1,E=function(){if(!x)for(x=!0,Et--;yt.length&&Et<Lt.MAX_PARALLEL_IMAGE_REQUESTS;){var F=yt.shift();F.cancelled||(F.cancel=ie(F.requestParameters,F.callback).cancel)}},I=Je(a,function(F,k,H,Y){E(),F?u(F):k&&(ge()?function(ee,se){var he=new S.Blob([new Uint8Array(ee)],{type:"image/png"});S.createImageBitmap(he).then(function(ve){se(null,ve)}).catch(function(ve){se(new Error("Could not load image because of "+ve.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(k,u):function(ee,se,he,ve){var Ue=new S.Image,ze=S.URL;Ue.onload=function(){se(null,Ue),ze.revokeObjectURL(Ue.src),Ue.onload=null,S.requestAnimationFrame(function(){Ue.src=q})},Ue.onerror=function(){return se(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var je=new S.Blob([new Uint8Array(ee)],{type:"image/png"});Ue.cacheControl=he,Ue.expires=ve,Ue.src=ee.byteLength?ze.createObjectURL(je):q}(k,u,H,Y))});return{cancel:function(){I.cancel(),E()}}};function ue(a,u,A){A[a]&&A[a].indexOf(u)!==-1||(A[a]=A[a]||[],A[a].push(u))}function be(a,u,A){if(A&&A[a]){var x=A[a].indexOf(u);x!==-1&&A[a].splice(x,1)}}var De=function(a,u){u===void 0&&(u={}),j(this,u),this.type=a},Ae=function(a){function u(A,x){x===void 0&&(x={}),a.call(this,"error",j({error:A},x))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(De),xe=function(){};xe.prototype.on=function(a,u){return this._listeners=this._listeners||{},ue(a,u,this._listeners),this},xe.prototype.off=function(a,u){return be(a,u,this._listeners),be(a,u,this._oneTimeListeners),this},xe.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},ue(a,u,this._oneTimeListeners),this},xe.prototype.fire=function(a,u){typeof a=="string"&&(a=new De(a,u||{}));var A=a.type;if(this.listens(A)){a.target=this;for(var x=0,E=this._listeners&&this._listeners[A]?this._listeners[A].slice():[];x<E.length;x+=1)E[x].call(this,a);for(var I=0,F=this._oneTimeListeners&&this._oneTimeListeners[A]?this._oneTimeListeners[A].slice():[];I<F.length;I+=1){var k=F[I];be(A,k,this._oneTimeListeners),k.call(this,a)}var H=this._eventedParent;H&&(j(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),H.fire(a))}else a instanceof Ae&&console.error(a.error);return this},xe.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},xe.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Se=function(a,u,A,x){this.message=(a?a+": ":"")+A,x&&(this.identifier=x),u!=null&&u.__line__&&(this.line=u.__line__)};function p(a){var u=a.value;return u?[new Se(a.key,u,"constants have been deprecated as of v8")]:[]}function le(a){for(var u=[],A=arguments.length-1;A-- >0;)u[A]=arguments[A+1];for(var x=0,E=u;x<E.length;x+=1){var I=E[x];for(var F in I)a[F]=I[F]}return a}function vt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ke(a){if(Array.isArray(a))return a.map(Ke);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var A in a)u[A]=Ke(a[A]);return u}return vt(a)}var Ct=function(a){function u(A,x){a.call(this,x),this.message=x,this.key=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Error),It=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var A=0,x=u;A<x.length;A+=1){var E=x[A];this.bindings[E[0]]=E[1]}};It.prototype.concat=function(a){return new It(this,a)},It.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},It.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Ft={kind:"null"},ut={kind:"number"},Ot={kind:"string"},St={kind:"boolean"},zt={kind:"color"},Fr={kind:"object"},qt={kind:"value"},Xr={kind:"collator"},en={kind:"formatted"},zr={kind:"resolvedImage"};function Gr(a,u){return{kind:"array",itemType:a,N:u}}function Lr(a){if(a.kind==="array"){var u=Lr(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var fi=[Ft,ut,Ot,St,zt,en,Fr,Gr(qt),zr];function Vr(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Vr(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var A=0,x=fi;A<x.length;A+=1)if(!Vr(x[A],u))return null}}return"Expected "+Lr(a)+" but found "+Lr(u)+" instead."}function fr(a,u){return u.some(function(A){return A.kind===a.kind})}function Me(a,u){return u.some(function(A){return A==="null"?a===null:A==="array"?Array.isArray(a):A==="object"?a&&!Array.isArray(a)&&typeof a=="object":A===typeof a})}var Wt=c(function(a,u){var A={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(k){return(k=Math.round(k))<0?0:k>255?255:k}function E(k){return x(k[k.length-1]==="%"?parseFloat(k)/100*255:parseInt(k))}function I(k){return(H=k[k.length-1]==="%"?parseFloat(k)/100:parseFloat(k))<0?0:H>1?1:H;var H}function F(k,H,Y){return Y<0?Y+=1:Y>1&&(Y-=1),6*Y<1?k+(H-k)*Y*6:2*Y<1?H:3*Y<2?k+(H-k)*(2/3-Y)*6:k}try{u.parseCSSColor=function(k){var H,Y=k.replace(/ /g,"").toLowerCase();if(Y in A)return A[Y].slice();if(Y[0]==="#")return Y.length===4?(H=parseInt(Y.substr(1),16))>=0&&H<=4095?[(3840&H)>>4|(3840&H)>>8,240&H|(240&H)>>4,15&H|(15&H)<<4,1]:null:Y.length===7&&(H=parseInt(Y.substr(1),16))>=0&&H<=16777215?[(16711680&H)>>16,(65280&H)>>8,255&H,1]:null;var ee=Y.indexOf("("),se=Y.indexOf(")");if(ee!==-1&&se+1===Y.length){var he=Y.substr(0,ee),ve=Y.substr(ee+1,se-(ee+1)).split(","),Ue=1;switch(he){case"rgba":if(ve.length!==4)return null;Ue=I(ve.pop());case"rgb":return ve.length!==3?null:[E(ve[0]),E(ve[1]),E(ve[2]),Ue];case"hsla":if(ve.length!==4)return null;Ue=I(ve.pop());case"hsl":if(ve.length!==3)return null;var ze=(parseFloat(ve[0])%360+360)%360/360,je=I(ve[1]),Ve=I(ve[2]),qe=Ve<=.5?Ve*(je+1):Ve+je-Ve*je,at=2*Ve-qe;return[x(255*F(at,qe,ze+1/3)),x(255*F(at,qe,ze)),x(255*F(at,qe,ze-1/3)),Ue];default:return null}}return null}}catch{}}).parseCSSColor,Kr=function(a,u,A,x){x===void 0&&(x=1),this.r=a,this.g=u,this.b=A,this.a=x};Kr.parse=function(a){if(a){if(a instanceof Kr)return a;if(typeof a=="string"){var u=Wt(a);if(u)return new Kr(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Kr.prototype.toString=function(){var a=this.toArray(),u=a[1],A=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(A)+","+x+")"},Kr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},Kr.black=new Kr(0,0,0,1),Kr.white=new Kr(1,1,1,1),Kr.transparent=new Kr(0,0,0,0),Kr.red=new Kr(1,0,0,1);var Ui=function(a,u,A){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=A,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ui.prototype.compare=function(a,u){return this.collator.compare(a,u)},Ui.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var la=function(a,u,A,x,E){this.text=a,this.image=u,this.scale=A,this.fontStack=x,this.textColor=E},ti=function(a){this.sections=a};ti.fromString=function(a){return new ti([new la(a,null,null,null,null)])},ti.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ti.factory=function(a){return a instanceof ti?a:ti.fromString(a)},ti.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ti.prototype.serialize=function(){for(var a=["format"],u=0,A=this.sections;u<A.length;u+=1){var x=A[u];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var E={};x.fontStack&&(E["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(E["font-scale"]=x.scale),x.textColor&&(E["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(E)}}return a};var Un=function(a){this.name=a.name,this.available=a.available};function Ie(a,u,A,x){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof A=="number"&&A>=0&&A<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,u,A,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,u,A,x]:[a,u,A]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ko(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Kr||a instanceof Ui||a instanceof ti||a instanceof Un)return!0;if(Array.isArray(a)){for(var u=0,A=a;u<A.length;u+=1)if(!ko(A[u]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!ko(a[x]))return!1;return!0}return!1}function zn(a){if(a===null)return Ft;if(typeof a=="string")return Ot;if(typeof a=="boolean")return St;if(typeof a=="number")return ut;if(a instanceof Kr)return zt;if(a instanceof Ui)return Xr;if(a instanceof ti)return en;if(a instanceof Un)return zr;if(Array.isArray(a)){for(var u,A=a.length,x=0,E=a;x<E.length;x+=1){var I=zn(E[x]);if(u){if(u===I)continue;u=qt;break}u=I}return Gr(u||qt,A)}return Fr}function No(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof Kr||a instanceof ti||a instanceof Un?a.toString():JSON.stringify(a)}Un.prototype.toString=function(){return this.name},Un.fromString=function(a){return a?new Un({name:a,available:!1}):null},Un.prototype.serialize=function(){return["image",this.name]};var Si=function(a,u){this.type=a,this.value=u};Si.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!ko(a[1]))return u.error("invalid value");var A=a[1],x=zn(A),E=u.expectedType;return x.kind!=="array"||x.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(x=E),new Si(x,A)},Si.prototype.evaluate=function(){return this.value},Si.prototype.eachChild=function(){},Si.prototype.outputDefined=function(){return!0},Si.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Kr?["rgba"].concat(this.value.toArray()):this.value instanceof ti?this.value.serialize():this.value};var ri=function(a){this.name="ExpressionEvaluationError",this.message=a};ri.prototype.toJSON=function(){return this.message};var xi={string:Ot,number:ut,boolean:St,object:Fr},Bn=function(a,u){this.type=a,this.args=u};Bn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var A,x=1,E=a[0];if(E==="array"){var I,F;if(a.length>2){var k=a[1];if(typeof k!="string"||!(k in xi)||k==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=xi[k],x++}else I=qt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);F=a[2],x++}A=Gr(I,F)}else A=xi[E];for(var H=[];x<a.length;x++){var Y=u.parse(a[x],x,qt);if(!Y)return null;H.push(Y)}return new Bn(A,H)},Bn.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var A=this.args[u].evaluate(a);if(!Vr(this.type,zn(A)))return A;if(u===this.args.length-1)throw new ri("Expected value to be of type "+Lr(this.type)+", but found "+Lr(zn(A))+" instead.")}return null},Bn.prototype.eachChild=function(a){this.args.forEach(a)},Bn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Bn.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var A=a.itemType;if(A.kind==="string"||A.kind==="number"||A.kind==="boolean"){u.push(A.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&u.push(x)}}return u.concat(this.args.map(function(E){return E.serialize()}))};var us=function(a){this.type=en,this.sections=a};us.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var A=a[1];if(!Array.isArray(A)&&typeof A=="object")return u.error("First argument must be an image or text section.");for(var x=[],E=!1,I=1;I<=a.length-1;++I){var F=a[I];if(E&&typeof F=="object"&&!Array.isArray(F)){E=!1;var k=null;if(F["font-scale"]&&!(k=u.parse(F["font-scale"],1,ut)))return null;var H=null;if(F["text-font"]&&!(H=u.parse(F["text-font"],1,Gr(Ot))))return null;var Y=null;if(F["text-color"]&&!(Y=u.parse(F["text-color"],1,zt)))return null;var ee=x[x.length-1];ee.scale=k,ee.font=H,ee.textColor=Y}else{var se=u.parse(a[I],1,qt);if(!se)return null;var he=se.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,x.push({content:se,scale:null,font:null,textColor:null})}}return new us(x)},us.prototype.evaluate=function(a){return new ti(this.sections.map(function(u){var A=u.content.evaluate(a);return zn(A)===zr?new la("",A,null,null,null):new la(No(A),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},us.prototype.eachChild=function(a){for(var u=0,A=this.sections;u<A.length;u+=1){var x=A[u];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},us.prototype.outputDefined=function(){return!1},us.prototype.serialize=function(){for(var a=["format"],u=0,A=this.sections;u<A.length;u+=1){var x=A[u];a.push(x.content.serialize());var E={};x.scale&&(E["font-scale"]=x.scale.serialize()),x.font&&(E["text-font"]=x.font.serialize()),x.textColor&&(E["text-color"]=x.textColor.serialize()),a.push(E)}return a};var zi=function(a){this.type=zr,this.input=a};zi.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var A=u.parse(a[1],1,Ot);return A?new zi(A):u.error("No image name provided.")},zi.prototype.evaluate=function(a){var u=this.input.evaluate(a),A=Un.fromString(u);return A&&a.availableImages&&(A.available=a.availableImages.indexOf(u)>-1),A},zi.prototype.eachChild=function(a){a(this.input)},zi.prototype.outputDefined=function(){return!1},zi.prototype.serialize=function(){return["image",this.input.serialize()]};var Ps={"to-boolean":St,"to-color":zt,"to-number":ut,"to-string":Ot},wn=function(a,u){this.type=a,this.args=u};wn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var A=a[0];if((A==="to-boolean"||A==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var x=Ps[A],E=[],I=1;I<a.length;I++){var F=u.parse(a[I],I,qt);if(!F)return null;E.push(F)}return new wn(x,E)},wn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,A,x=0,E=this.args;x<E.length;x+=1){if(A=null,(u=E[x].evaluate(a))instanceof Kr)return u;if(typeof u=="string"){var I=a.parseColor(u);if(I)return I}else if(Array.isArray(u)&&!(A=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Ie(u[0],u[1],u[2],u[3])))return new Kr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ri(A||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var F=null,k=0,H=this.args;k<H.length;k+=1){if((F=H[k].evaluate(a))===null)return 0;var Y=Number(F);if(!isNaN(Y))return Y}throw new ri("Could not convert "+JSON.stringify(F)+" to number.")}return this.type.kind==="formatted"?ti.fromString(No(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Un.fromString(No(this.args[0].evaluate(a))):No(this.args[0].evaluate(a))},wn.prototype.eachChild=function(a){this.args.forEach(a)},wn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},wn.prototype.serialize=function(){if(this.type.kind==="formatted")return new us([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zi(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var cl=["Unknown","Point","LineString","Polygon"],Ce=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ce.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ce.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?cl[this.feature.type]:this.feature.type:null},Ce.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ce.prototype.canonicalID=function(){return this.canonical},Ce.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ce.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=Kr.parse(a)),u};var Re=function(a,u,A,x){this.name=a,this.type=u,this._evaluate=A,this.args=x};Re.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Re.prototype.eachChild=function(a){this.args.forEach(a)},Re.prototype.outputDefined=function(){return!1},Re.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Re.parse=function(a,u){var A,x=a[0],E=Re.definitions[x];if(!E)return u.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(E)?E[0]:E.type,F=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,k=F.filter(function(br){var tr=br[0];return!Array.isArray(tr)||tr.length===a.length-1}),H=null,Y=0,ee=k;Y<ee.length;Y+=1){var se=ee[Y],he=se[0],ve=se[1];H=new hi(u.registry,u.path,null,u.scope);for(var Ue=[],ze=!1,je=1;je<a.length;je++){var Ve=a[je],qe=Array.isArray(he)?he[je-1]:he.type,at=H.parse(Ve,1+Ue.length,qe);if(!at){ze=!0;break}Ue.push(at)}if(!ze)if(Array.isArray(he)&&he.length!==Ue.length)H.error("Expected "+he.length+" arguments, but found "+Ue.length+" instead.");else{for(var pt=0;pt<Ue.length;pt++){var _t=Array.isArray(he)?he[pt]:he.type,Pt=Ue[pt];H.concat(pt+1).checkSubtype(_t,Pt.type)}if(H.errors.length===0)return new Re(x,I,ve,Ue)}}if(k.length===1)(A=u.errors).push.apply(A,H.errors);else{for(var Gt=(k.length?k:F).map(function(br){var tr;return tr=br[0],Array.isArray(tr)?"("+tr.map(Lr).join(", ")+")":"("+Lr(tr.type)+"...)"}).join(" | "),Jt=[],mr=1;mr<a.length;mr++){var er=u.parse(a[mr],1+Jt.length);if(!er)return null;Jt.push(Lr(er.type))}u.error("Expected arguments of type "+Gt+", but found ("+Jt.join(", ")+") instead.")}return null},Re.register=function(a,u){for(var A in Re.definitions=u,u)a[A]=Re};var $e=function(a,u,A){this.type=Xr,this.locale=A,this.caseSensitive=a,this.diacriticSensitive=u};function At(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function Ht(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function gr(a,u){var A=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,E=Math.pow(2,u.z);return[Math.round(A*E*8192),Math.round(x*E*8192)]}function wr(a,u,A){return u[1]>a[1]!=A[1]>a[1]&&a[0]<(A[0]-u[0])*(a[1]-u[1])/(A[1]-u[1])+u[0]}function ni(a,u){for(var A,x,E,I,F,k,H,Y=!1,ee=0,se=u.length;ee<se;ee++)for(var he=u[ee],ve=0,Ue=he.length;ve<Ue-1;ve++){if((I=(A=a)[0]-(x=he[ve])[0])*(H=A[1]-(E=he[ve+1])[1])-(k=A[0]-E[0])*(F=A[1]-x[1])==0&&I*k<=0&&F*H<=0)return!1;wr(a,he[ve],he[ve+1])&&(Y=!Y)}return Y}function Ii(a,u){for(var A=0;A<u.length;A++)if(ni(a,u[A]))return!0;return!1}function Gi(a,u,A,x){var E=x[0]-A[0],I=x[1]-A[1],F=(a[0]-A[0])*I-E*(a[1]-A[1]),k=(u[0]-A[0])*I-E*(u[1]-A[1]);return F>0&&k<0||F<0&&k>0}function Js(a,u,A){for(var x=0,E=A;x<E.length;x+=1)for(var I=E[x],F=0;F<I.length-1;++F)if((se=[(ee=I[F+1])[0]-(Y=I[F])[0],ee[1]-Y[1]])[0]*(he=[(H=u)[0]-(k=a)[0],H[1]-k[1]])[1]-se[1]*he[0]!=0&&Gi(k,H,Y,ee)&&Gi(Y,ee,k,H))return!0;var k,H,Y,ee,se,he;return!1}function yh(a,u){for(var A=0;A<a.length;++A)if(!ni(a[A],u))return!1;for(var x=0;x<a.length-1;++x)if(Js(a[x],a[x+1],u))return!1;return!0}function nf(a,u){for(var A=0;A<u.length;A++)if(yh(a,u[A]))return!0;return!1}function ua(a,u,A){for(var x=[],E=0;E<a.length;E++){for(var I=[],F=0;F<a[E].length;F++){var k=gr(a[E][F],A);At(u,k),I.push(k)}x.push(I)}return x}function ll(a,u,A){for(var x=[],E=0;E<a.length;E++){var I=ua(a[E],u,A);x.push(I)}return x}function ul(a,u,A,x){if(a[0]<A[0]||a[0]>A[2]){var E=.5*x,I=a[0]-A[0]>E?-x:A[0]-a[0]>E?x:0;I===0&&(I=a[0]-A[2]>E?-x:A[2]-a[0]>E?x:0),a[0]+=I}At(u,a)}function vh(a,u,A,x){for(var E=8192*Math.pow(2,x.z),I=[8192*x.x,8192*x.y],F=[],k=0,H=a;k<H.length;k+=1)for(var Y=0,ee=H[k];Y<ee.length;Y+=1){var se=ee[Y],he=[se.x+I[0],se.y+I[1]];ul(he,u,A,E),F.push(he)}return F}function fl(a,u,A,x){for(var E,I=8192*Math.pow(2,x.z),F=[8192*x.x,8192*x.y],k=[],H=0,Y=a;H<Y.length;H+=1){for(var ee=[],se=0,he=Y[H];se<he.length;se+=1){var ve=he[se],Ue=[ve.x+F[0],ve.y+F[1]];At(u,Ue),ee.push(Ue)}k.push(ee)}if(u[2]-u[0]<=I/2){(E=u)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(var ze=0,je=k;ze<je.length;ze+=1)for(var Ve=0,qe=je[ze];Ve<qe.length;Ve+=1)ul(qe[Ve],u,A,I)}return k}$e.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var A=a[1];if(typeof A!="object"||Array.isArray(A))return u.error("Collator options argument must be an object.");var x=u.parse(A["case-sensitive"]!==void 0&&A["case-sensitive"],1,St);if(!x)return null;var E=u.parse(A["diacritic-sensitive"]!==void 0&&A["diacritic-sensitive"],1,St);if(!E)return null;var I=null;return A.locale&&!(I=u.parse(A.locale,1,Ot))?null:new $e(x,E,I)},$e.prototype.evaluate=function(a){return new Ui(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},$e.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},$e.prototype.outputDefined=function(){return!1},$e.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Rs=function(a,u){this.type=St,this.geojson=a,this.geometries=u};function Uo(a){if(a instanceof Re&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Rs)return!1;var u=!0;return a.eachChild(function(A){u&&!Uo(A)&&(u=!1)}),u}function fa(a){if(a instanceof Re&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(A){u&&!fa(A)&&(u=!1)}),u}function Oa(a,u){if(a instanceof Re&&u.indexOf(a.name)>=0)return!1;var A=!0;return a.eachChild(function(x){A&&!Oa(x,u)&&(A=!1)}),A}Rs.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(ko(a[1])){var A=a[1];if(A.type==="FeatureCollection")for(var x=0;x<A.features.length;++x){var E=A.features[x].geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Rs(A,A.features[x].geometry)}else if(A.type==="Feature"){var I=A.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new Rs(A,A.geometry)}else if(A.type==="Polygon"||A.type==="MultiPolygon")return new Rs(A,A)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Rs.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,A){var x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(A.type==="Polygon"){var F=ua(A.coordinates,E,I),k=vh(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var H=0,Y=k;H<Y.length;H+=1)if(!ni(Y[H],F))return!1}if(A.type==="MultiPolygon"){var ee=ll(A.coordinates,E,I),se=vh(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var he=0,ve=se;he<ve.length;he+=1)if(!Ii(ve[he],ee))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,A){var x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(A.type==="Polygon"){var F=ua(A.coordinates,E,I),k=fl(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var H=0,Y=k;H<Y.length;H+=1)if(!yh(Y[H],F))return!1}if(A.type==="MultiPolygon"){var ee=ll(A.coordinates,E,I),se=fl(u.geometry(),x,E,I);if(!Ht(x,E))return!1;for(var he=0,ve=se;he<ve.length;he+=1)if(!nf(ve[he],ee))return!1}return!0}(a,this.geometries)}return!1},Rs.prototype.eachChild=function(){},Rs.prototype.outputDefined=function(){return!0},Rs.prototype.serialize=function(){return["within",this.geojson]};var ha=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};ha.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var A=a[1];return u.scope.has(A)?new ha(A,u.scope.get(A)):u.error('Unknown variable "'+A+'". Make sure "'+A+'" has been bound in an enclosing "let" expression before using it.',1)},ha.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},ha.prototype.eachChild=function(){},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){return["var",this.name]};var hi=function(a,u,A,x,E){u===void 0&&(u=[]),x===void 0&&(x=new It),E===void 0&&(E=[]),this.registry=a,this.path=u,this.key=u.map(function(I){return"["+I+"]"}).join(""),this.scope=x,this.errors=E,this.expectedType=A};function wo(a,u){for(var A,x=a.length-1,E=0,I=x,F=0;E<=I;)if((A=a[F=Math.floor((E+I)/2)])<=u){if(F===x||u<a[F+1])return F;E=F+1}else{if(!(A>u))throw new ri("Input is not a number.");I=F-1}return 0}hi.prototype.parse=function(a,u,A,x,E){return E===void 0&&(E={}),u?this.concat(u,A,x)._parse(a,E):this._parse(a,E)},hi.prototype._parse=function(a,u){function A(Y,ee,se){return se==="assert"?new Bn(ee,[Y]):se==="coerce"?new wn(ee,[Y]):Y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var E=this.registry[x];if(E){var I=E.parse(a,this);if(!I)return null;if(this.expectedType){var F=this.expectedType,k=I.type;if(F.kind!=="string"&&F.kind!=="number"&&F.kind!=="boolean"&&F.kind!=="object"&&F.kind!=="array"||k.kind!=="value")if(F.kind!=="color"&&F.kind!=="formatted"&&F.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(F,k))return null}else I=A(I,F,u.typeAnnotation||"coerce");else I=A(I,F,u.typeAnnotation||"assert")}if(!(I instanceof Si)&&I.type.kind!=="resolvedImage"&&function Y(ee){if(ee instanceof ha)return Y(ee.boundExpression);if(ee instanceof Re&&ee.name==="error"||ee instanceof $e||ee instanceof Rs)return!1;var se=ee instanceof wn||ee instanceof Bn,he=!0;return ee.eachChild(function(ve){he=se?he&&Y(ve):he&&ve instanceof Si}),!!he&&Uo(ee)&&Oa(ee,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(I)){var H=new Ce;try{I=new Si(I.type,I.evaluate(H))}catch(Y){return this.error(Y.message),null}}return I}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},hi.prototype.concat=function(a,u,A){var x=typeof a=="number"?this.path.concat(a):this.path,E=A?this.scope.concat(A):this.scope;return new hi(this.registry,x,u||null,E,this.errors)},hi.prototype.error=function(a){for(var u=[],A=arguments.length-1;A-- >0;)u[A]=arguments[A+1];var x=""+this.key+u.map(function(E){return"["+E+"]"}).join("");this.errors.push(new Ct(x,a))},hi.prototype.checkSubtype=function(a,u){var A=Vr(a,u);return A&&this.error(A),A};var Ln=function(a,u,A){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var x=0,E=A;x<E.length;x+=1){var I=E[x],F=I[1];this.labels.push(I[0]),this.outputs.push(F)}};function ii(a,u,A){return a*(1-A)+u*A}Ln.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var A=u.parse(a[1],1,ut);if(!A)return null;var x=[],E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(var I=1;I<a.length;I+=2){var F=I===1?-1/0:a[I],k=a[I+1],H=I,Y=I+1;if(typeof F!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(x.length&&x[x.length-1][0]>=F)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',H);var ee=u.parse(k,Y,E);if(!ee)return null;E=E||ee.type,x.push([F,ee])}return new Ln(E,A,x)},Ln.prototype.evaluate=function(a){var u=this.labels,A=this.outputs;if(u.length===1)return A[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return A[0].evaluate(a);var E=u.length;return x>=u[E-1]?A[E-1].evaluate(a):A[wo(u,x)].evaluate(a)},Ln.prototype.eachChild=function(a){a(this.input);for(var u=0,A=this.outputs;u<A.length;u+=1)a(A[u])},Ln.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ln.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var Da=Object.freeze({__proto__:null,number:ii,color:function(a,u,A){return new Kr(ii(a.r,u.r,A),ii(a.g,u.g,A),ii(a.b,u.b,A),ii(a.a,u.a,A))},array:function(a,u,A){return a.map(function(x,E){return ii(x,u[E],A)})}}),hl=6/29*3*(6/29),GA=Math.PI/180,VA=180/Math.PI;function sf(a){return a>.008856451679035631?Math.pow(a,1/3):a/hl+4/29}function Kl(a){return a>6/29?a*a*a:hl*(a-4/29)}function vc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function zo(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function of(a){var u=zo(a.r),A=zo(a.g),x=zo(a.b),E=sf((.4124564*u+.3575761*A+.1804375*x)/.95047),I=sf((.2126729*u+.7151522*A+.072175*x)/1);return{l:116*I-16,a:500*(E-I),b:200*(I-sf((.0193339*u+.119192*A+.9503041*x)/1.08883)),alpha:a.a}}function af(a){var u=(a.l+16)/116,A=isNaN(a.a)?u:u+a.a/500,x=isNaN(a.b)?u:u-a.b/200;return u=1*Kl(u),A=.95047*Kl(A),x=1.08883*Kl(x),new Kr(vc(3.2404542*A-1.5371385*u-.4985314*x),vc(-.969266*A+1.8760108*u+.041556*x),vc(.0556434*A-.2040259*u+1.0572252*x),a.alpha)}function Yl(a,u,A){var x=u-a;return a+A*(x>180||x<-180?x-360*Math.round(x/360):x)}var Ao={forward:of,reverse:af,interpolate:function(a,u,A){return{l:ii(a.l,u.l,A),a:ii(a.a,u.a,A),b:ii(a.b,u.b,A),alpha:ii(a.alpha,u.alpha,A)}}},Xs={forward:function(a){var u=of(a),A=u.l,x=u.a,E=u.b,I=Math.atan2(E,x)*VA;return{h:I<0?I+360:I,c:Math.sqrt(x*x+E*E),l:A,alpha:a.a}},reverse:function(a){var u=a.h*GA,A=a.c;return af({l:a.l,a:Math.cos(u)*A,b:Math.sin(u)*A,alpha:a.alpha})},interpolate:function(a,u,A){return{h:Yl(a.h,u.h,A),c:ii(a.c,u.c,A),l:ii(a.l,u.l,A),alpha:ii(a.alpha,u.alpha,A)}}},cf=Object.freeze({__proto__:null,lab:Ao,hcl:Xs}),Fi=function(a,u,A,x,E){this.type=a,this.operator=u,this.interpolation=A,this.input=x,this.labels=[],this.outputs=[];for(var I=0,F=E;I<F.length;I+=1){var k=F[I],H=k[1];this.labels.push(k[0]),this.outputs.push(H)}};function dl(a,u,A,x){var E=x-A,I=a-A;return E===0?0:u===1?I/E:(Math.pow(u,I)-1)/(Math.pow(u,E)-1)}Fi.interpolationFactor=function(a,u,A,x){var E=0;if(a.name==="exponential")E=dl(u,a.base,A,x);else if(a.name==="linear")E=dl(u,1,A,x);else if(a.name==="cubic-bezier"){var I=a.controlPoints;E=new f(I[0],I[1],I[2],I[3]).solve(dl(u,1,A,x))}return E},Fi.parse=function(a,u){var A=a[0],x=a[1],E=a[2],I=a.slice(3);if(!Array.isArray(x)||x.length===0)return u.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var F=x[1];if(typeof F!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:F}}else{if(x[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(x[0]),1,0);var k=x.slice(1);if(k.length!==4||k.some(function(je){return typeof je!="number"||je<0||je>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:k}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(E=u.parse(E,2,ut)))return null;var H=[],Y=null;A==="interpolate-hcl"||A==="interpolate-lab"?Y=zt:u.expectedType&&u.expectedType.kind!=="value"&&(Y=u.expectedType);for(var ee=0;ee<I.length;ee+=2){var se=I[ee],he=I[ee+1],ve=ee+3,Ue=ee+4;if(typeof se!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ve);if(H.length&&H[H.length-1][0]>=se)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ve);var ze=u.parse(he,Ue,Y);if(!ze)return null;Y=Y||ze.type,H.push([se,ze])}return Y.kind==="number"||Y.kind==="color"||Y.kind==="array"&&Y.itemType.kind==="number"&&typeof Y.N=="number"?new Fi(Y,A,x,E,H):u.error("Type "+Lr(Y)+" is not interpolatable.")},Fi.prototype.evaluate=function(a){var u=this.labels,A=this.outputs;if(u.length===1)return A[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return A[0].evaluate(a);var E=u.length;if(x>=u[E-1])return A[E-1].evaluate(a);var I=wo(u,x),F=Fi.interpolationFactor(this.interpolation,x,u[I],u[I+1]),k=A[I].evaluate(a),H=A[I+1].evaluate(a);return this.operator==="interpolate"?Da[this.type.kind.toLowerCase()](k,H,F):this.operator==="interpolate-hcl"?Xs.reverse(Xs.interpolate(Xs.forward(k),Xs.forward(H),F)):Ao.reverse(Ao.interpolate(Ao.forward(k),Ao.forward(H),F))},Fi.prototype.eachChild=function(a){a(this.input);for(var u=0,A=this.outputs;u<A.length;u+=1)a(A[u])},Fi.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Fi.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],A=0;A<this.labels.length;A++)u.push(this.labels[A],this.outputs[A].serialize());return u};var da=function(a,u){this.type=a,this.args=u};da.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var A=null,x=u.expectedType;x&&x.kind!=="value"&&(A=x);for(var E=[],I=0,F=a.slice(1);I<F.length;I+=1){var k=u.parse(F[I],1+E.length,A,void 0,{typeAnnotation:"omit"});if(!k)return null;A=A||k.type,E.push(k)}var H=x&&E.some(function(Y){return Vr(x,Y.type)});return new da(H?qt:A,E)},da.prototype.evaluate=function(a){for(var u,A=null,x=0,E=0,I=this.args;E<I.length&&(x++,(A=I[E].evaluate(a))&&A instanceof Un&&!A.available&&(u||(u=A.name),A=null,x===this.args.length&&(A=u)),A===null);E+=1);return A},da.prototype.eachChild=function(a){this.args.forEach(a)},da.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},da.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Aa=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};Aa.prototype.evaluate=function(a){return this.result.evaluate(a)},Aa.prototype.eachChild=function(a){for(var u=0,A=this.bindings;u<A.length;u+=1)a(A[u][1]);a(this.result)},Aa.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var A=[],x=1;x<a.length-1;x+=2){var E=a[x];if(typeof E!="string")return u.error("Expected string, but found "+typeof E+" instead.",x);if(/[^a-zA-Z0-9_]/.test(E))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);var I=u.parse(a[x+1],x+1);if(!I)return null;A.push([E,I])}var F=u.parse(a[a.length-1],a.length-1,u.expectedType,A);return F?new Aa(A,F):null},Aa.prototype.outputDefined=function(){return this.result.outputDefined()},Aa.prototype.serialize=function(){for(var a=["let"],u=0,A=this.bindings;u<A.length;u+=1){var x=A[u];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var pa=function(a,u,A){this.type=a,this.index=u,this.input=A};pa.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,ut),x=u.parse(a[2],2,Gr(u.expectedType||qt));return A&&x?new pa(x.type.itemType,A,x):null},pa.prototype.evaluate=function(a){var u=this.index.evaluate(a),A=this.input.evaluate(a);if(u<0)throw new ri("Array index out of bounds: "+u+" < 0.");if(u>=A.length)throw new ri("Array index out of bounds: "+u+" > "+(A.length-1)+".");if(u!==Math.floor(u))throw new ri("Array index must be an integer, but found "+u+" instead.");return A[u]},pa.prototype.eachChild=function(a){a(this.index),a(this.input)},pa.prototype.outputDefined=function(){return!1},pa.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var La=function(a,u){this.type=St,this.needle=a,this.haystack=u};La.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,qt),x=u.parse(a[2],2,qt);return A&&x?fr(A.type,[St,Ot,ut,Ft,qt])?new La(A,x):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Lr(A.type)+" instead"):null},La.prototype.evaluate=function(a){var u=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!A)return!1;if(!Me(u,["boolean","string","number","null"]))throw new ri("Expected first argument to be of type boolean, string, number or null, but found "+Lr(zn(u))+" instead.");if(!Me(A,["string","array"]))throw new ri("Expected second argument to be of type array or string, but found "+Lr(zn(A))+" instead.");return A.indexOf(u)>=0},La.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},La.prototype.outputDefined=function(){return!0},La.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ga=function(a,u,A){this.type=ut,this.needle=a,this.haystack=u,this.fromIndex=A};ga.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,qt),x=u.parse(a[2],2,qt);if(!A||!x)return null;if(!fr(A.type,[St,Ot,ut,Ft,qt]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Lr(A.type)+" instead");if(a.length===4){var E=u.parse(a[3],3,ut);return E?new ga(A,x,E):null}return new ga(A,x)},ga.prototype.evaluate=function(a){var u=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!Me(u,["boolean","string","number","null"]))throw new ri("Expected first argument to be of type boolean, string, number or null, but found "+Lr(zn(u))+" instead.");if(!Me(A,["string","array"]))throw new ri("Expected second argument to be of type array or string, but found "+Lr(zn(A))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return A.indexOf(u,x)}return A.indexOf(u)},ga.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},ga.prototype.outputDefined=function(){return!1},ga.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ka=function(a,u,A,x,E,I){this.inputType=a,this.type=u,this.input=A,this.cases=x,this.outputs=E,this.otherwise=I};ka.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var A,x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E={},I=[],F=2;F<a.length-1;F+=2){var k=a[F],H=a[F+1];Array.isArray(k)||(k=[k]);var Y=u.concat(F);if(k.length===0)return Y.error("Expected at least one branch label.");for(var ee=0,se=k;ee<se.length;ee+=1){var he=se[ee];if(typeof he!="number"&&typeof he!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return Y.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return Y.error("Numeric branch labels must be integer values.");if(A){if(Y.checkSubtype(A,zn(he)))return null}else A=zn(he);if(E[String(he)]!==void 0)return Y.error("Branch labels must be unique.");E[String(he)]=I.length}var ve=u.parse(H,F,x);if(!ve)return null;x=x||ve.type,I.push(ve)}var Ue=u.parse(a[1],1,qt);if(!Ue)return null;var ze=u.parse(a[a.length-1],a.length-1,x);return ze?Ue.type.kind!=="value"&&u.concat(1).checkSubtype(A,Ue.type)?null:new ka(A,x,Ue,E,I,ze):null},ka.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(zn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},ka.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},ka.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},ka.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],A=[],x={},E=0,I=Object.keys(this.cases).sort();E<I.length;E+=1){var F=I[E];(se=x[this.cases[F]])===void 0?(x[this.cases[F]]=A.length,A.push([this.cases[F],[F]])):A[se][1].push(F)}for(var k=function(ve){return a.inputType.kind==="number"?Number(ve):ve},H=0,Y=A;H<Y.length;H+=1){var ee=Y[H],se=ee[0],he=ee[1];u.push(he.length===1?k(he[0]):he.map(k)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Na=function(a,u,A){this.type=a,this.branches=u,this.otherwise=A};Na.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var A;u.expectedType&&u.expectedType.kind!=="value"&&(A=u.expectedType);for(var x=[],E=1;E<a.length-1;E+=2){var I=u.parse(a[E],E,St);if(!I)return null;var F=u.parse(a[E+1],E+1,A);if(!F)return null;x.push([I,F]),A=A||F.type}var k=u.parse(a[a.length-1],a.length-1,A);return k?new Na(A,x,k):null},Na.prototype.evaluate=function(a){for(var u=0,A=this.branches;u<A.length;u+=1){var x=A[u],E=x[1];if(x[0].evaluate(a))return E.evaluate(a)}return this.otherwise.evaluate(a)},Na.prototype.eachChild=function(a){for(var u=0,A=this.branches;u<A.length;u+=1){var x=A[u],E=x[1];a(x[0]),a(E)}a(this.otherwise)},Na.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},Na.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var ma=function(a,u,A,x){this.type=a,this.input=u,this.beginIndex=A,this.endIndex=x};function bh(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function xh(a,u,A,x){return x.compare(u,A)===0}function Cn(a,u,A){var x=a!=="=="&&a!=="!=";return function(){function E(I,F,k){this.type=St,this.lhs=I,this.rhs=F,this.collator=k,this.hasUntypedArgument=I.type.kind==="value"||F.type.kind==="value"}return E.parse=function(I,F){if(I.length!==3&&I.length!==4)return F.error("Expected two or three arguments.");var k=I[0],H=F.parse(I[1],1,qt);if(!H)return null;if(!bh(k,H.type))return F.concat(1).error('"'+k+`" comparisons are not supported for type '`+Lr(H.type)+"'.");var Y=F.parse(I[2],2,qt);if(!Y)return null;if(!bh(k,Y.type))return F.concat(2).error('"'+k+`" comparisons are not supported for type '`+Lr(Y.type)+"'.");if(H.type.kind!==Y.type.kind&&H.type.kind!=="value"&&Y.type.kind!=="value")return F.error("Cannot compare types '"+Lr(H.type)+"' and '"+Lr(Y.type)+"'.");x&&(H.type.kind==="value"&&Y.type.kind!=="value"?H=new Bn(Y.type,[H]):H.type.kind!=="value"&&Y.type.kind==="value"&&(Y=new Bn(H.type,[Y])));var ee=null;if(I.length===4){if(H.type.kind!=="string"&&Y.type.kind!=="string"&&H.type.kind!=="value"&&Y.type.kind!=="value")return F.error("Cannot use collator to compare non-string types.");if(!(ee=F.parse(I[3],3,Xr)))return null}return new E(H,Y,ee)},E.prototype.evaluate=function(I){var F=this.lhs.evaluate(I),k=this.rhs.evaluate(I);if(x&&this.hasUntypedArgument){var H=zn(F),Y=zn(k);if(H.kind!==Y.kind||H.kind!=="string"&&H.kind!=="number")throw new ri('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+H.kind+", "+Y.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var ee=zn(F),se=zn(k);if(ee.kind!=="string"||se.kind!=="string")return u(I,F,k)}return this.collator?A(I,F,k,this.collator.evaluate(I)):u(I,F,k)},E.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},E.prototype.outputDefined=function(){return!0},E.prototype.serialize=function(){var I=[a];return this.eachChild(function(F){I.push(F.serialize())}),I},E}()}ma.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1,qt),x=u.parse(a[2],2,ut);if(!A||!x)return null;if(!fr(A.type,[Gr(qt),Ot,qt]))return u.error("Expected first argument to be of type array or string, but found "+Lr(A.type)+" instead");if(a.length===4){var E=u.parse(a[3],3,ut);return E?new ma(A.type,A,x,E):null}return new ma(A.type,A,x)},ma.prototype.evaluate=function(a){var u=this.input.evaluate(a),A=this.beginIndex.evaluate(a);if(!Me(u,["string","array"]))throw new ri("Expected first argument to be of type array or string, but found "+Lr(zn(u))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return u.slice(A,x)}return u.slice(A)},ma.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ma.prototype.outputDefined=function(){return!1},ma.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ql=Cn("==",function(a,u,A){return u===A},xh),Zl=Cn("!=",function(a,u,A){return u!==A},function(a,u,A,x){return!xh(0,u,A,x)}),wh=Cn("<",function(a,u,A){return u<A},function(a,u,A,x){return x.compare(u,A)<0}),Ch=Cn(">",function(a,u,A){return u>A},function(a,u,A,x){return x.compare(u,A)>0}),bc=Cn("<=",function(a,u,A){return u<=A},function(a,u,A,x){return x.compare(u,A)<=0}),Eh=Cn(">=",function(a,u,A){return u>=A},function(a,u,A,x){return x.compare(u,A)>=0}),Go=function(a,u,A,x,E){this.type=Ot,this.number=a,this.locale=u,this.currency=A,this.minFractionDigits=x,this.maxFractionDigits=E};Go.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var A=u.parse(a[1],1,ut);if(!A)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return u.error("NumberFormat options argument must be an object.");var E=null;if(x.locale&&!(E=u.parse(x.locale,1,Ot)))return null;var I=null;if(x.currency&&!(I=u.parse(x.currency,1,Ot)))return null;var F=null;if(x["min-fraction-digits"]&&!(F=u.parse(x["min-fraction-digits"],1,ut)))return null;var k=null;return x["max-fraction-digits"]&&!(k=u.parse(x["max-fraction-digits"],1,ut))?null:new Go(A,E,I,F,k)},Go.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Go.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Vo=function(a){this.type=ut,this.input=a};Vo.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var A=u.parse(a[1],1);return A?A.type.kind!=="array"&&A.type.kind!=="string"&&A.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Lr(A.type)+" instead."):new Vo(A):null},Vo.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ri("Expected value to be of type string or array, but found "+Lr(zn(u))+" instead.")},Vo.prototype.eachChild=function(a){a(this.input)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ks={"==":ql,"!=":Zl,">":Ch,"<":wh,">=":Eh,"<=":bc,array:Bn,at:pa,boolean:Bn,case:Na,coalesce:da,collator:$e,format:us,image:zi,in:La,"index-of":ga,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:Vo,let:Aa,literal:Si,match:ka,number:Bn,"number-format":Go,object:Bn,slice:ma,step:Ln,string:Bn,"to-boolean":wn,"to-color":wn,"to-number":wn,"to-string":wn,var:ha,within:Rs};function Th(a,u){var A=u[0],x=u[1],E=u[2],I=u[3];A=A.evaluate(a),x=x.evaluate(a),E=E.evaluate(a);var F=I?I.evaluate(a):1,k=Ie(A,x,E,F);if(k)throw new ri(k);return new Kr(A/255*F,x/255*F,E/255*F,F)}function Ql(a,u){return a in u}function eu(a,u){var A=u[a];return A===void 0?null:A}function Ua(a){return{type:a}}function lf(a){return{result:"success",value:a}}function Ho(a){return{result:"error",value:a}}function jo(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Al(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Sn(a){return!!a.expression&&a.expression.interpolated}function Pn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function tu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function HA(a){return a}function xc(a,u,A){return a!==void 0?a:u!==void 0?u:A!==void 0?A:void 0}function Bh(a,u,A,x,E){return xc(typeof A===E?x[A]:void 0,a.default,u.default)}function jA(a,u,A){if(Pn(A)!=="number")return xc(a.default,u.default);var x=a.stops.length;if(x===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[x-1][0])return a.stops[x-1][1];var E=wo(a.stops.map(function(I){return I[0]}),A);return a.stops[E][1]}function Sh(a,u,A){var x=a.base!==void 0?a.base:1;if(Pn(A)!=="number")return xc(a.default,u.default);var E=a.stops.length;if(E===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[E-1][0])return a.stops[E-1][1];var I=wo(a.stops.map(function(se){return se[0]}),A),F=function(se,he,ve,Ue){var ze=Ue-ve,je=se-ve;return ze===0?0:he===1?je/ze:(Math.pow(he,je)-1)/(Math.pow(he,ze)-1)}(A,x,a.stops[I][0],a.stops[I+1][0]),k=a.stops[I][1],H=a.stops[I+1][1],Y=Da[u.type]||HA;if(a.colorSpace&&a.colorSpace!=="rgb"){var ee=cf[a.colorSpace];Y=function(se,he){return ee.reverse(ee.interpolate(ee.forward(se),ee.forward(he),F))}}return typeof k.evaluate=="function"?{evaluate:function(){for(var se=[],he=arguments.length;he--;)se[he]=arguments[he];var ve=k.evaluate.apply(void 0,se),Ue=H.evaluate.apply(void 0,se);if(ve!==void 0&&Ue!==void 0)return Y(ve,Ue,F)}}:Y(k,H,F)}function Yi(a,u,A){return u.type==="color"?A=Kr.parse(A):u.type==="formatted"?A=ti.fromString(A.toString()):u.type==="resolvedImage"?A=Un.fromString(A.toString()):Pn(A)===u.type||u.type==="enum"&&u.values[A]||(A=void 0),xc(A,a.default,u.default)}Re.register(Ks,{error:[{kind:"error"},[Ot],function(a,u){throw new ri(u[0].evaluate(a))}],typeof:[Ot,[qt],function(a,u){return Lr(zn(u[0].evaluate(a)))}],"to-rgba":[Gr(ut,4),[zt],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[zt,[ut,ut,ut],Th],rgba:[zt,[ut,ut,ut,ut],Th],has:{type:St,overloads:[[[Ot],function(a,u){return Ql(u[0].evaluate(a),a.properties())}],[[Ot,Fr],function(a,u){var A=u[1];return Ql(u[0].evaluate(a),A.evaluate(a))}]]},get:{type:qt,overloads:[[[Ot],function(a,u){return eu(u[0].evaluate(a),a.properties())}],[[Ot,Fr],function(a,u){var A=u[1];return eu(u[0].evaluate(a),A.evaluate(a))}]]},"feature-state":[qt,[Ot],function(a,u){return eu(u[0].evaluate(a),a.featureState||{})}],properties:[Fr,[],function(a){return a.properties()}],"geometry-type":[Ot,[],function(a){return a.geometryType()}],id:[qt,[],function(a){return a.id()}],zoom:[ut,[],function(a){return a.globals.zoom}],"heatmap-density":[ut,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[ut,[],function(a){return a.globals.lineProgress||0}],accumulated:[qt,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[ut,Ua(ut),function(a,u){for(var A=0,x=0,E=u;x<E.length;x+=1)A+=E[x].evaluate(a);return A}],"*":[ut,Ua(ut),function(a,u){for(var A=1,x=0,E=u;x<E.length;x+=1)A*=E[x].evaluate(a);return A}],"-":{type:ut,overloads:[[[ut,ut],function(a,u){var A=u[1];return u[0].evaluate(a)-A.evaluate(a)}],[[ut],function(a,u){return-u[0].evaluate(a)}]]},"/":[ut,[ut,ut],function(a,u){var A=u[1];return u[0].evaluate(a)/A.evaluate(a)}],"%":[ut,[ut,ut],function(a,u){var A=u[1];return u[0].evaluate(a)%A.evaluate(a)}],ln2:[ut,[],function(){return Math.LN2}],pi:[ut,[],function(){return Math.PI}],e:[ut,[],function(){return Math.E}],"^":[ut,[ut,ut],function(a,u){var A=u[1];return Math.pow(u[0].evaluate(a),A.evaluate(a))}],sqrt:[ut,[ut],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[ut,[ut],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[ut,[ut],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[ut,[ut],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[ut,[ut],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[ut,[ut],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[ut,[ut],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[ut,[ut],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[ut,[ut],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[ut,[ut],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[ut,Ua(ut),function(a,u){return Math.min.apply(Math,u.map(function(A){return A.evaluate(a)}))}],max:[ut,Ua(ut),function(a,u){return Math.max.apply(Math,u.map(function(A){return A.evaluate(a)}))}],abs:[ut,[ut],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[ut,[ut],function(a,u){var A=u[0].evaluate(a);return A<0?-Math.round(-A):Math.round(A)}],floor:[ut,[ut],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[ut,[ut],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[St,[Ot,qt],function(a,u){var A=u[0],x=u[1];return a.properties()[A.value]===x.value}],"filter-id-==":[St,[qt],function(a,u){var A=u[0];return a.id()===A.value}],"filter-type-==":[St,[Ot],function(a,u){var A=u[0];return a.geometryType()===A.value}],"filter-<":[St,[Ot,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E<I}],"filter-id-<":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x<E}],"filter->":[St,[Ot,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E>I}],"filter-id->":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x>E}],"filter-<=":[St,[Ot,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E<=I}],"filter-id-<=":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x<=E}],"filter->=":[St,[Ot,qt],function(a,u){var A=u[0],x=u[1],E=a.properties()[A.value],I=x.value;return typeof E==typeof I&&E>=I}],"filter-id->=":[St,[qt],function(a,u){var A=u[0],x=a.id(),E=A.value;return typeof x==typeof E&&x>=E}],"filter-has":[St,[qt],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[St,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[St,[Gr(Ot)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[St,[Gr(qt)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[St,[Ot,Gr(qt)],function(a,u){var A=u[0];return u[1].value.indexOf(a.properties()[A.value])>=0}],"filter-in-large":[St,[Ot,Gr(qt)],function(a,u){var A=u[0],x=u[1];return function(E,I,F,k){for(;F<=k;){var H=F+k>>1;if(I[H]===E)return!0;I[H]>E?k=H-1:F=H+1}return!1}(a.properties()[A.value],x.value,0,x.value.length-1)}],all:{type:St,overloads:[[[St,St],function(a,u){var A=u[1];return u[0].evaluate(a)&&A.evaluate(a)}],[Ua(St),function(a,u){for(var A=0,x=u;A<x.length;A+=1)if(!x[A].evaluate(a))return!1;return!0}]]},any:{type:St,overloads:[[[St,St],function(a,u){var A=u[1];return u[0].evaluate(a)||A.evaluate(a)}],[Ua(St),function(a,u){for(var A=0,x=u;A<x.length;A+=1)if(x[A].evaluate(a))return!0;return!1}]]},"!":[St,[St],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[St,[Ot],function(a,u){var A=a.globals&&a.globals.isSupportedScript;return!A||A(u[0].evaluate(a))}],upcase:[Ot,[Ot],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[Ot,[Ot],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[Ot,Ua(qt),function(a,u){return u.map(function(A){return No(A.evaluate(a))}).join("")}],"resolved-locale":[Ot,[Xr],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var _a=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new Ce,this._defaultValue=u?function(A){return A.type==="color"&&tu(A.default)?new Kr(0,0,0,0):A.type==="color"?Kr.parse(A.default)||null:A.default===void 0?null:A.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function po(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ks}function ru(a,u){var A=new hi(Ks,[],u?function(E){var I={color:zt,string:Ot,number:ut,enum:Ot,boolean:St,formatted:en,resolvedImage:zr};return E.type==="array"?Gr(I[E.value]||qt,E.length):I[E.type]}(u):void 0),x=A.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?lf(new _a(x,u)):Ho(A.errors)}_a.prototype.evaluateWithoutErrorHandling=function(a,u,A,x,E,I){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=A,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},_a.prototype.evaluate=function(a,u,A,x,E,I){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=A||null,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=I||null;try{var F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new ri("Expected value to be one of "+Object.keys(this._enumValues).map(function(k){return JSON.stringify(k)}).join(", ")+", but found "+JSON.stringify(F)+" instead.");return F}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}};var za=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!fa(u.expression)};za.prototype.evaluateWithoutErrorHandling=function(a,u,A,x,E,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,A,x,E,I)},za.prototype.evaluate=function(a,u,A,x,E,I){return this._styleExpression.evaluate(a,u,A,x,E,I)};var wc=function(a,u,A,x){this.kind=a,this.zoomStops=A,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!fa(u.expression),this.interpolationType=x};function Fs(a,u){if((a=ru(a,u)).result==="error")return a;var A=a.value.expression,x=Uo(A);if(!x&&!jo(u))return Ho([new Ct("","data expressions not supported")]);var E=Oa(A,["zoom"]);if(!E&&!Al(u))return Ho([new Ct("","zoom expressions not supported")]);var I=function F(k){var H=null;if(k instanceof Aa)H=F(k.result);else if(k instanceof da)for(var Y=0,ee=k.args;Y<ee.length&&!(H=F(ee[Y]));Y+=1);else(k instanceof Ln||k instanceof Fi)&&k.input instanceof Re&&k.input.name==="zoom"&&(H=k);return H instanceof Ct||k.eachChild(function(se){var he=F(se);he instanceof Ct?H=he:!H&&he?H=new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):H&&he&&H!==he&&(H=new Ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),H}(A);return I||E?I instanceof Ct?Ho([I]):I instanceof Fi&&!Sn(u)?Ho([new Ct("",'"interpolate" expressions cannot be used with this property')]):lf(I?new wc(x?"camera":"composite",a.value,I.labels,I instanceof Fi?I.interpolation:void 0):new za(x?"constant":"source",a.value)):Ho([new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}wc.prototype.evaluateWithoutErrorHandling=function(a,u,A,x,E,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,A,x,E,I)},wc.prototype.evaluate=function(a,u,A,x,E,I){return this._styleExpression.evaluate(a,u,A,x,E,I)},wc.prototype.interpolationFactor=function(a,u,A){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,a,u,A):0};var Ga=function(a,u){this._parameters=a,this._specification=u,le(this,function A(x,E){var I,F,k,H=E.type==="color",Y=x.stops&&typeof x.stops[0][0]=="object",ee=Y||!(Y||x.property!==void 0),se=x.type||(Sn(E)?"exponential":"interval");if(H&&((x=le({},x)).stops&&(x.stops=x.stops.map(function(er){return[er[0],Kr.parse(er[1])]})),x.default=Kr.parse(x.default?x.default:E.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!cf[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(se==="exponential")I=Sh;else if(se==="interval")I=jA;else if(se==="categorical"){I=Bh,F=Object.create(null);for(var he=0,ve=x.stops;he<ve.length;he+=1){var Ue=ve[he];F[Ue[0]]=Ue[1]}k=typeof x.stops[0][0]}else{if(se!=="identity")throw new Error('Unknown function type "'+se+'"');I=Yi}if(Y){for(var ze={},je=[],Ve=0;Ve<x.stops.length;Ve++){var qe=x.stops[Ve],at=qe[0].zoom;ze[at]===void 0&&(ze[at]={zoom:at,type:x.type,property:x.property,default:x.default,stops:[]},je.push(at)),ze[at].stops.push([qe[0].value,qe[1]])}for(var pt=[],_t=0,Pt=je;_t<Pt.length;_t+=1){var Gt=Pt[_t];pt.push([ze[Gt].zoom,A(ze[Gt],E)])}var Jt={name:"linear"};return{kind:"composite",interpolationType:Jt,interpolationFactor:Fi.interpolationFactor.bind(void 0,Jt),zoomStops:pt.map(function(er){return er[0]}),evaluate:function(er,br){var tr=er.zoom;return Sh({stops:pt,base:x.base},E,tr).evaluate(tr,br)}}}if(ee){var mr=se==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:mr,interpolationFactor:Fi.interpolationFactor.bind(void 0,mr),zoomStops:x.stops.map(function(er){return er[0]}),evaluate:function(er){return I(x,E,er.zoom,F,k)}}}return{kind:"source",evaluate:function(er,br){var tr=br&&br.properties?br.properties[x.property]:void 0;return tr===void 0?xc(x.default,E.default):I(x,E,tr,F,k)}}}(this._parameters,this._specification))};function Os(a){var u=a.key,A=a.value,x=a.valueSpec||{},E=a.objectElementValidators||{},I=a.style,F=a.styleSpec,k=[],H=Pn(A);if(H!=="object")return[new Se(u,A,"object expected, "+H+" found")];for(var Y in A){var ee=Y.split(".")[0],se=x[ee]||x["*"],he=void 0;if(E[ee])he=E[ee];else if(x[ee])he=nn;else if(E["*"])he=E["*"];else{if(!x["*"]){k.push(new Se(u,A[Y],'unknown property "'+Y+'"'));continue}he=nn}k=k.concat(he({key:(u&&u+".")+Y,value:A[Y],valueSpec:se,style:I,styleSpec:F,object:A,objectKey:Y},A))}for(var ve in x)E[ve]||x[ve].required&&x[ve].default===void 0&&A[ve]===void 0&&k.push(new Se(u,A,'missing required property "'+ve+'"'));return k}function Va(a){var u=a.value,A=a.valueSpec,x=a.style,E=a.styleSpec,I=a.key,F=a.arrayElementValidator||nn;if(Pn(u)!=="array")return[new Se(I,u,"array expected, "+Pn(u)+" found")];if(A.length&&u.length!==A.length)return[new Se(I,u,"array length "+A.length+" expected, length "+u.length+" found")];if(A["min-length"]&&u.length<A["min-length"])return[new Se(I,u,"array length at least "+A["min-length"]+" expected, length "+u.length+" found")];var k={type:A.value,values:A.values};E.$version<7&&(k.function=A.function),Pn(A.value)==="object"&&(k=A.value);for(var H=[],Y=0;Y<u.length;Y++)H=H.concat(F({array:u,arrayIndex:Y,value:u[Y],valueSpec:k,style:x,styleSpec:E,key:I+"["+Y+"]"}));return H}function Cc(a){var u=a.key,A=a.value,x=a.valueSpec,E=Pn(A);return E==="number"&&A!=A&&(E="NaN"),E!=="number"?[new Se(u,A,"number expected, "+E+" found")]:"minimum"in x&&A<x.minimum?[new Se(u,A,A+" is less than the minimum value "+x.minimum)]:"maximum"in x&&A>x.maximum?[new Se(u,A,A+" is greater than the maximum value "+x.maximum)]:[]}function Ec(a){var u,A,x,E=a.valueSpec,I=vt(a.value.type),F={},k=I!=="categorical"&&a.value.property===void 0,H=!k,Y=Pn(a.value.stops)==="array"&&Pn(a.value.stops[0])==="array"&&Pn(a.value.stops[0][0])==="object",ee=Os({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ve){if(I==="identity")return[new Se(ve.key,ve.value,'identity function may not have a "stops" property')];var Ue=[],ze=ve.value;return Ue=Ue.concat(Va({key:ve.key,value:ze,valueSpec:ve.valueSpec,style:ve.style,styleSpec:ve.styleSpec,arrayElementValidator:se})),Pn(ze)==="array"&&ze.length===0&&Ue.push(new Se(ve.key,ze,"array must have at least one stop")),Ue},default:function(ve){return nn({key:ve.key,value:ve.value,valueSpec:E,style:ve.style,styleSpec:ve.styleSpec})}}});return I==="identity"&&k&&ee.push(new Se(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||ee.push(new Se(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!Sn(a.valueSpec)&&ee.push(new Se(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(H&&!jo(a.valueSpec)?ee.push(new Se(a.key,a.value,"property functions not supported")):k&&!Al(a.valueSpec)&&ee.push(new Se(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!Y||a.value.property!==void 0||ee.push(new Se(a.key,a.value,'"property" property is required')),ee;function se(ve){var Ue=[],ze=ve.value,je=ve.key;if(Pn(ze)!=="array")return[new Se(je,ze,"array expected, "+Pn(ze)+" found")];if(ze.length!==2)return[new Se(je,ze,"array length 2 expected, length "+ze.length+" found")];if(Y){if(Pn(ze[0])!=="object")return[new Se(je,ze,"object expected, "+Pn(ze[0])+" found")];if(ze[0].zoom===void 0)return[new Se(je,ze,"object stop key must have zoom")];if(ze[0].value===void 0)return[new Se(je,ze,"object stop key must have value")];if(x&&x>vt(ze[0].zoom))return[new Se(je,ze[0].zoom,"stop zoom values must appear in ascending order")];vt(ze[0].zoom)!==x&&(x=vt(ze[0].zoom),A=void 0,F={}),Ue=Ue.concat(Os({key:je+"[0]",value:ze[0],valueSpec:{zoom:{}},style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{zoom:Cc,value:he}}))}else Ue=Ue.concat(he({key:je+"[0]",value:ze[0],style:ve.style,styleSpec:ve.styleSpec},ze));return po(Ke(ze[1]))?Ue.concat([new Se(je+"[1]",ze[1],"expressions are not allowed in function stops.")]):Ue.concat(nn({key:je+"[1]",value:ze[1],valueSpec:E,style:ve.style,styleSpec:ve.styleSpec}))}function he(ve,Ue){var ze=Pn(ve.value),je=vt(ve.value),Ve=ve.value!==null?ve.value:Ue;if(u){if(ze!==u)return[new Se(ve.key,Ve,ze+" stop domain type must match previous stop domain type "+u)]}else u=ze;if(ze!=="number"&&ze!=="string"&&ze!=="boolean")return[new Se(ve.key,Ve,"stop domain value must be a number, string, or boolean")];if(ze!=="number"&&I!=="categorical"){var qe="number expected, "+ze+" found";return jo(E)&&I===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Se(ve.key,Ve,qe)]}return I!=="categorical"||ze!=="number"||isFinite(je)&&Math.floor(je)===je?I!=="categorical"&&ze==="number"&&A!==void 0&&je<A?[new Se(ve.key,Ve,"stop domain values must appear in ascending order")]:(A=je,I==="categorical"&&je in F?[new Se(ve.key,Ve,"stop domain values must be unique")]:(F[je]=!0,[])):[new Se(ve.key,Ve,"integer expected, found "+je)]}}function Ha(a){var u=(a.expressionContext==="property"?Fs:ru)(Ke(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(x){return new Se(""+a.key+x.key,a.value,x.message)});var A=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!A.outputDefined())return[new Se(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!fa(A))return[new Se(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!fa(A))return[new Se(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Oa(A,["zoom","feature-state"]))return[new Se(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Uo(A))return[new Se(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Tc(a){var u=a.key,A=a.value,x=a.valueSpec,E=[];return Array.isArray(x.values)?x.values.indexOf(vt(A))===-1&&E.push(new Se(u,A,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(A)+" found")):Object.keys(x.values).indexOf(vt(A))===-1&&E.push(new Se(u,A,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(A)+" found")),E}function nu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,A=a.slice(1);u<A.length;u+=1){var x=A[u];if(!nu(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}Ga.deserialize=function(a){return new Ga(a._parameters,a._specification)},Ga.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var pl={type:"boolean",default:!1};function iu(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};nu(a)||(a=gl(a));var u=ru(a,pl);if(u.result==="error")throw new Error(u.value.map(function(A){return A.key+": "+A.message}).join(", "));return{filter:function(A,x,E){return u.value.evaluate(A,x,{},E)},needGeometry:function A(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var E=1;E<x.length;E++)if(A(x[E]))return!0;return!1}(a)}}function $A(a,u){return a<u?-1:a>u?1:0}function gl(a){if(!a)return!0;var u,A=a[0];return a.length<=1?A!=="any":A==="=="?su(a[1],a[2],"=="):A==="!="?ou(su(a[1],a[2],"==")):A==="<"||A===">"||A==="<="||A===">="?su(a[1],a[2],A):A==="any"?(u=a.slice(1),["any"].concat(u.map(gl))):A==="all"?["all"].concat(a.slice(1).map(gl)):A==="none"?["all"].concat(a.slice(1).map(gl).map(ou)):A==="in"?Bc(a[1],a.slice(2)):A==="!in"?ou(Bc(a[1],a.slice(2))):A==="has"?ja(a[1]):A==="!has"?ou(ja(a[1])):A!=="within"||a}function su(a,u,A){switch(a){case"$type":return["filter-type-"+A,u];case"$id":return["filter-id-"+A,u];default:return["filter-"+A,a,u]}}function Bc(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(A){return typeof A!=typeof u[0]})?["filter-in-large",a,["literal",u.sort($A)]]:["filter-in-small",a,["literal",u]]}}function ja(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ou(a){return["!",a]}function $a(a){return nu(Ke(a.value))?Ha(le({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(A){var x=A.value,E=A.key;if(Pn(x)!=="array")return[new Se(E,x,"array expected, "+Pn(x)+" found")];var I,F=A.styleSpec,k=[];if(x.length<1)return[new Se(E,x,"filter array must have at least 1 element")];switch(k=k.concat(Tc({key:E+"[0]",value:x[0],valueSpec:F.filter_operator,style:A.style,styleSpec:A.styleSpec})),vt(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&vt(x[1])==="$type"&&k.push(new Se(E,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&k.push(new Se(E,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(I=Pn(x[1]))!=="string"&&k.push(new Se(E+"[1]",x[1],"string expected, "+I+" found"));for(var H=2;H<x.length;H++)I=Pn(x[H]),vt(x[1])==="$type"?k=k.concat(Tc({key:E+"["+H+"]",value:x[H],valueSpec:F.geometry_type,style:A.style,styleSpec:A.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&k.push(new Se(E+"["+H+"]",x[H],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var Y=1;Y<x.length;Y++)k=k.concat(u({key:E+"["+Y+"]",value:x[Y],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":I=Pn(x[1]),x.length!==2?k.push(new Se(E,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="string"&&k.push(new Se(E+"[1]",x[1],"string expected, "+I+" found"));break;case"within":I=Pn(x[1]),x.length!==2?k.push(new Se(E,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="object"&&k.push(new Se(E+"[1]",x[1],"object expected, "+I+" found"))}return k}(a)}function uf(a,u){var A=a.key,x=a.style,E=a.styleSpec,I=a.value,F=a.objectKey,k=E[u+"_"+a.layerType];if(!k)return[];var H=F.match(/^(.*)-transition$/);if(u==="paint"&&H&&k[H[1]]&&k[H[1]].transition)return nn({key:A,value:I,valueSpec:E.transition,style:x,styleSpec:E});var Y,ee=a.valueSpec||k[F];if(!ee)return[new Se(A,I,'unknown property "'+F+'"')];if(Pn(I)==="string"&&jo(ee)&&!ee.tokens&&(Y=/^{([^}]+)}$/.exec(I)))return[new Se(A,I,'"'+F+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Y[1])+" }`.")];var se=[];return a.layerType==="symbol"&&(F==="text-field"&&x&&!x.glyphs&&se.push(new Se(A,I,'use of "text-field" requires a style "glyphs" property')),F==="text-font"&&tu(Ke(I))&&vt(I.type)==="identity"&&se.push(new Se(A,I,'"text-font" does not support identity functions'))),se.concat(nn({key:a.key,value:I,valueSpec:ee,style:x,styleSpec:E,expressionContext:"property",propertyType:u,propertyKey:F}))}function ff(a){return uf(a,"paint")}function ml(a){return uf(a,"layout")}function Ih(a){var u=[],A=a.value,x=a.key,E=a.style,I=a.styleSpec;A.type||A.ref||u.push(new Se(x,A,'either "type" or "ref" is required'));var F,k=vt(A.type),H=vt(A.ref);if(A.id)for(var Y=vt(A.id),ee=0;ee<a.arrayIndex;ee++){var se=E.layers[ee];vt(se.id)===Y&&u.push(new Se(x,A.id,'duplicate layer id "'+A.id+'", previously used at line '+se.id.__line__))}if("ref"in A)["type","source","source-layer","filter","layout"].forEach(function(Ue){Ue in A&&u.push(new Se(x,A[Ue],'"'+Ue+'" is prohibited for ref layers'))}),E.layers.forEach(function(Ue){vt(Ue.id)===H&&(F=Ue)}),F?F.ref?u.push(new Se(x,A.ref,"ref cannot reference another ref layer")):k=vt(F.type):u.push(new Se(x,A.ref,'ref layer "'+H+'" not found'));else if(k!=="background")if(A.source){var he=E.sources&&E.sources[A.source],ve=he&&vt(he.type);he?ve==="vector"&&k==="raster"?u.push(new Se(x,A.source,'layer "'+A.id+'" requires a raster source')):ve==="raster"&&k!=="raster"?u.push(new Se(x,A.source,'layer "'+A.id+'" requires a vector source')):ve!=="vector"||A["source-layer"]?ve==="raster-dem"&&k!=="hillshade"?u.push(new Se(x,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!A.paint||!A.paint["line-gradient"]||ve==="geojson"&&he.lineMetrics||u.push(new Se(x,A,'layer "'+A.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Se(x,A,'layer "'+A.id+'" must specify a "source-layer"')):u.push(new Se(x,A.source,'source "'+A.source+'" not found'))}else u.push(new Se(x,A,'missing required property "source"'));return u=u.concat(Os({key:x,value:A,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return nn({key:x+".type",value:A.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:A,objectKey:"type"})},filter:$a,layout:function(Ue){return Os({layer:A,key:Ue.key,value:Ue.value,style:Ue.style,styleSpec:Ue.styleSpec,objectElementValidators:{"*":function(ze){return ml(le({layerType:k},ze))}}})},paint:function(Ue){return Os({layer:A,key:Ue.key,value:Ue.value,style:Ue.style,styleSpec:Ue.styleSpec,objectElementValidators:{"*":function(ze){return ff(le({layerType:k},ze))}}})}}}))}function Wa(a){var u=a.value,A=a.key,x=Pn(u);return x!=="string"?[new Se(A,u,"string expected, "+x+" found")]:[]}var Gn={promoteId:function(a){var u=a.key,A=a.value;if(Pn(A)==="string")return Wa({key:u,value:A});var x=[];for(var E in A)x.push.apply(x,Wa({key:u+"."+E,value:A[E]}));return x}};function au(a){var u=a.value,A=a.key,x=a.styleSpec,E=a.style;if(!u.type)return[new Se(A,u,'"type" is required')];var I,F=vt(u.type);switch(F){case"vector":case"raster":case"raster-dem":return Os({key:A,value:u,valueSpec:x["source_"+F.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Gn});case"geojson":if(I=Os({key:A,value:u,valueSpec:x.source_geojson,style:E,styleSpec:x,objectElementValidators:Gn}),u.cluster)for(var k in u.clusterProperties){var H=u.clusterProperties[k],Y=H[0],ee=typeof Y=="string"?[Y,["accumulated"],["get",k]]:Y;I.push.apply(I,Ha({key:A+"."+k+".map",value:H[1],expressionContext:"cluster-map"})),I.push.apply(I,Ha({key:A+"."+k+".reduce",value:ee,expressionContext:"cluster-reduce"}))}return I;case"video":return Os({key:A,value:u,valueSpec:x.source_video,style:E,styleSpec:x});case"image":return Os({key:A,value:u,valueSpec:x.source_image,style:E,styleSpec:x});case"canvas":return[new Se(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tc({key:A+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function $o(a){var u=a.value,A=a.styleSpec,x=A.light,E=a.style,I=[],F=Pn(u);if(u===void 0)return I;if(F!=="object")return I.concat([new Se("light",u,"object expected, "+F+" found")]);for(var k in u){var H=k.match(/^(.*)-transition$/);I=I.concat(H&&x[H[1]]&&x[H[1]].transition?nn({key:k,value:u[k],valueSpec:A.transition,style:E,styleSpec:A}):x[k]?nn({key:k,value:u[k],valueSpec:x[k],style:E,styleSpec:A}):[new Se(k,u[k],'unknown property "'+k+'"')])}return I}var Wo={"*":function(){return[]},array:Va,boolean:function(a){var u=a.value,A=a.key,x=Pn(u);return x!=="boolean"?[new Se(A,u,"boolean expected, "+x+" found")]:[]},number:Cc,color:function(a){var u=a.key,A=a.value,x=Pn(A);return x!=="string"?[new Se(u,A,"color expected, "+x+" found")]:Wt(A)===null?[new Se(u,A,'color expected, "'+A+'" found')]:[]},constants:p,enum:Tc,filter:$a,function:Ec,layer:Ih,object:Os,source:au,light:$o,string:Wa,formatted:function(a){return Wa(a).length===0?[]:Ha(a)},resolvedImage:function(a){return Wa(a).length===0?[]:Ha(a)}};function nn(a){var u=a.value,A=a.valueSpec,x=a.styleSpec;return A.expression&&tu(vt(u))?Ec(a):A.expression&&po(Ke(u))?Ha(a):A.type&&Wo[A.type]?Wo[A.type](a):Os(le({},a,{valueSpec:A.type?x[A.type]:A}))}function Rn(a){var u=a.value,A=a.key,x=Wa(a);return x.length||(u.indexOf("{fontstack}")===-1&&x.push(new Se(A,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&x.push(new Se(A,u,'"glyphs" url must include a "{range}" token'))),x}function Ds(a,u){u===void 0&&(u=ce);var A=[];return A=A.concat(nn({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:Rn,"*":function(){return[]}}})),a.constants&&(A=A.concat(p({key:"constants",value:a.constants}))),_l(A)}function _l(a){return[].concat(a).sort(function(u,A){return u.line-A.line})}function Sc(a){return function(){for(var u=[],A=arguments.length;A--;)u[A]=arguments[A];return _l(a.apply(this,u))}}Ds.source=Sc(au),Ds.light=Sc($o),Ds.layer=Sc(Ih),Ds.filter=Sc($a),Ds.paintProperty=Sc(ff),Ds.layoutProperty=Sc(ml);var yl=Ds,WA=yl.light,JA=yl.paintProperty,Ic=yl.layoutProperty;function vl(a,u){var A=!1;if(u&&u.length)for(var x=0,E=u;x<E.length;x+=1)a.fire(new Ae(new Error(E[x].message))),A=!0;return A}var Co=Fn;function Fn(a,u,A){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var E=new Int32Array(this.arrayBuffer);a=E[0],this.d=(u=E[1])+2*(A=E[2]);for(var I=0;I<this.d*this.d;I++){var F=E[3+I],k=E[3+I+1];x.push(F===k?null:E.subarray(F,k))}var H=E[3+x.length+1];this.keys=E.subarray(E[3+x.length],H),this.bboxes=E.subarray(H),this.insert=this._insertReadonly}else{this.d=u+2*A;for(var Y=0;Y<this.d*this.d;Y++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=A,this.scale=u/a,this.uid=0;var ee=A/u*a;this.min=-ee,this.max=a+ee}Fn.prototype.insert=function(a,u,A,x,E){this._forEachCell(u,A,x,E,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(A),this.bboxes.push(x),this.bboxes.push(E)},Fn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fn.prototype._insertCell=function(a,u,A,x,E,I){this.cells[E].push(I)},Fn.prototype.query=function(a,u,A,x,E){var I=this.min,F=this.max;if(a<=I&&u<=I&&F<=A&&F<=x&&!E)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(a,u,A,x,this._queryCell,k,{},E),k},Fn.prototype._queryCell=function(a,u,A,x,E,I,F,k){var H=this.cells[E];if(H!==null)for(var Y=this.keys,ee=this.bboxes,se=0;se<H.length;se++){var he=H[se];if(F[he]===void 0){var ve=4*he;(k?k(ee[ve+0],ee[ve+1],ee[ve+2],ee[ve+3]):a<=ee[ve+2]&&u<=ee[ve+3]&&A>=ee[ve+0]&&x>=ee[ve+1])?(F[he]=!0,I.push(Y[he])):F[he]=!1}}},Fn.prototype._forEachCell=function(a,u,A,x,E,I,F,k){for(var H=this._convertToCellCoord(a),Y=this._convertToCellCoord(u),ee=this._convertToCellCoord(A),se=this._convertToCellCoord(x),he=H;he<=ee;he++)for(var ve=Y;ve<=se;ve++){var Ue=this.d*ve+he;if((!k||k(this._convertFromCellCoord(he),this._convertFromCellCoord(ve),this._convertFromCellCoord(he+1),this._convertFromCellCoord(ve+1)))&&E.call(this,a,u,A,x,Ue,I,F,k))return}},Fn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Fn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Fn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,A=0,x=0;x<this.cells.length;x++)A+=this.cells[x].length;var E=new Int32Array(u+A+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;for(var I=u,F=0;F<a.length;F++){var k=a[F];E[3+F]=I,E.set(k,I),I+=k.length}return E[3+a.length]=I,E.set(this.keys,I),E[3+a.length+1]=I+=this.keys.length,E.set(this.bboxes,I),I+=this.bboxes.length,E.buffer};var Mc=S.ImageData,Mh=S.ImageBitmap,mi={};function nr(a,u,A){A===void 0&&(A={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),mi[a]={klass:u,omit:A.omit||[],shallow:A.shallow||[]}}for(var vs in nr("Object",Object),Co.serialize=function(a,u){var A=a.toArrayBuffer();return u&&u.push(A),{buffer:A}},Co.deserialize=function(a){return new Co(a.buffer)},nr("Grid",Co),nr("Color",Kr),nr("Error",Error),nr("ResolvedImage",Un),nr("StylePropertyFunction",Ga),nr("StyleExpression",_a,{omit:["_evaluator"]}),nr("ZoomDependentExpression",wc),nr("ZoomConstantExpression",za),nr("CompoundExpression",Re,{omit:["_evaluate"]}),Ks)Ks[vs]._classRegistryKey||nr("Expression_"+vs,Ks[vs]);function cu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ls(a){return Mh&&a instanceof Mh}function Ys(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(cu(a)||Ls(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var A=a;return u&&u.push(A.buffer),A}if(a instanceof Mc)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],E=0,I=a;E<I.length;E+=1)x.push(Ys(I[E],u));return x}if(typeof a=="object"){var F=a.constructor,k=F._classRegistryKey;if(!k)throw new Error("can't serialize object of unregistered class");var H=F.serialize?F.serialize(a,u):{};if(!F.serialize){for(var Y in a)if(a.hasOwnProperty(Y)&&!(mi[k].omit.indexOf(Y)>=0)){var ee=a[Y];H[Y]=mi[k].shallow.indexOf(Y)>=0?ee:Ys(ee,u)}a instanceof Error&&(H.message=a.message)}if(H.$name)throw new Error("$name property is reserved for worker serialization logic.");return k!=="Object"&&(H.$name=k),H}throw new Error("can't serialize object of type "+typeof a)}function fs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||cu(a)||Ls(a)||ArrayBuffer.isView(a)||a instanceof Mc)return a;if(Array.isArray(a))return a.map(fs);if(typeof a=="object"){var u=a.$name||"Object",A=mi[u].klass;if(!A)throw new Error("can't deserialize unregistered class "+u);if(A.deserialize)return A.deserialize(a);for(var x=Object.create(A.prototype),E=0,I=Object.keys(a);E<I.length;E+=1){var F=I[E];if(F!=="$name"){var k=a[F];x[F]=mi[u].shallow.indexOf(F)>=0?k:fs(k)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var hf=function(){this.first=!0};hf.prototype.update=function(a,u){var A=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=A,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=A,!0):(this.lastFloorZoom>A?(this.lastIntegerZoom=A+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<A&&(this.lastIntegerZoom=A,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=A,!0))};var Kt={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function df(a){for(var u=0,A=a;u<A.length;u+=1)if(lu(A[u].charCodeAt(0)))return!0;return!1}function lu(a){return!(a!==746&&a!==747&&(a<4352||!(Kt["Bopomofo Extended"](a)||Kt.Bopomofo(a)||Kt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Kt["CJK Compatibility Ideographs"](a)||Kt["CJK Compatibility"](a)||Kt["CJK Radicals Supplement"](a)||Kt["CJK Strokes"](a)||!(!Kt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Kt["CJK Unified Ideographs Extension A"](a)||Kt["CJK Unified Ideographs"](a)||Kt["Enclosed CJK Letters and Months"](a)||Kt["Hangul Compatibility Jamo"](a)||Kt["Hangul Jamo Extended-A"](a)||Kt["Hangul Jamo Extended-B"](a)||Kt["Hangul Jamo"](a)||Kt["Hangul Syllables"](a)||Kt.Hiragana(a)||Kt["Ideographic Description Characters"](a)||Kt.Kanbun(a)||Kt["Kangxi Radicals"](a)||Kt["Katakana Phonetic Extensions"](a)||Kt.Katakana(a)&&a!==12540||!(!Kt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Kt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Kt["Unified Canadian Aboriginal Syllabics"](a)||Kt["Unified Canadian Aboriginal Syllabics Extended"](a)||Kt["Vertical Forms"](a)||Kt["Yijing Hexagram Symbols"](a)||Kt["Yi Syllables"](a)||Kt["Yi Radicals"](a))))}function Af(a){return!(lu(a)||function(u){return!!(Kt["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Kt["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Kt["Letterlike Symbols"](u)||Kt["Number Forms"](u)||Kt["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Kt["Control Pictures"](u)&&u!==9251||Kt["Optical Character Recognition"](u)||Kt["Enclosed Alphanumerics"](u)||Kt["Geometric Shapes"](u)||Kt["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Kt["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Kt["CJK Symbols and Punctuation"](u)||Kt.Katakana(u)||Kt["Private Use Area"](u)||Kt["CJK Compatibility Forms"](u)||Kt["Small Form Variants"](u)||Kt["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(a))}function qs(a){return a>=1424&&a<=2303||Kt["Arabic Presentation Forms-A"](a)||Kt["Arabic Presentation Forms-B"](a)}function bs(a,u){return!(!u&&qs(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Kt.Khmer(a))}function uu(a){for(var u=0,A=a;u<A.length;u+=1)if(qs(A[u].charCodeAt(0)))return!0;return!1}var fu=null,xs="unavailable",Jo=null,pf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(xs="error"),fu&&fu(a)};function Pc(){_i.fire(new De("pluginStateChange",{pluginStatus:xs,pluginURL:Jo}))}var _i=new xe,gf=function(){return xs},go=function(){if(xs!=="deferred"||!Jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xs="loading",Pc(),Jo&&Je({url:Jo},function(a){a?pf(a):(xs="loaded",Pc())})},qi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return xs==="loaded"||qi.applyArabicShaping!=null},isLoading:function(){return xs==="loading"},setState:function(a){xs=a.pluginStatus,Jo=a.pluginURL},isParsed:function(){return qi.applyArabicShaping!=null&&qi.processBidirectionalText!=null&&qi.processStyledBidirectionalText!=null},getPluginURL:function(){return Jo}},kr=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hf,this.transition={})};kr.prototype.isSupportedScript=function(a){return function(u,A){for(var x=0,E=u;x<E.length;x+=1)if(!bs(E[x].charCodeAt(0),A))return!1;return!0}(a,qi.isLoaded())},kr.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},kr.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),A=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*A}:{fromScale:.5,toScale:1,t:1-(1-A)*u}};var Eo=function(a,u){this.property=a,this.value=u,this.expression=function(A,x){if(tu(A))return new Ga(A,x);if(po(A)){var E=Fs(A,x);if(E.result==="error")throw new Error(E.value.map(function(F){return F.key+": "+F.message}).join(", "));return E.value}var I=A;return typeof A=="string"&&x.type==="color"&&(I=Kr.parse(A)),{kind:"constant",evaluate:function(){return I}}}(u===void 0?a.specification.default:u,a.specification)};Eo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Eo.prototype.possiblyEvaluate=function(a,u,A){return this.property.possiblyEvaluate(this,a,u,A)};var Zs=function(a){this.property=a,this.value=new Eo(a,void 0)};Zs.prototype.transitioned=function(a,u){return new ya(this.property,this.value,u,j({},a.transition,this.transition),a.now)},Zs.prototype.untransitioned=function(){return new ya(this.property,this.value,null,{},0)};var Vi=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Vi.prototype.getValue=function(a){return pe(this._values[a].value.value)},Vi.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Zs(this._values[a].property)),this._values[a].value=new Eo(this._values[a].property,u===null?void 0:pe(u))},Vi.prototype.getTransition=function(a){return pe(this._values[a].transition)},Vi.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Zs(this._values[a].property)),this._values[a].transition=pe(u)||void 0},Vi.prototype.serialize=function(){for(var a={},u=0,A=Object.keys(this._values);u<A.length;u+=1){var x=A[u],E=this.getValue(x);E!==void 0&&(a[x]=E);var I=this.getTransition(x);I!==void 0&&(a[x+"-transition"]=I)}return a},Vi.prototype.transitioned=function(a,u){for(var A=new Xo(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var I=E[x];A._values[I]=this._values[I].transitioned(a,u._values[I])}return A},Vi.prototype.untransitioned=function(){for(var a=new Xo(this._properties),u=0,A=Object.keys(this._values);u<A.length;u+=1){var x=A[u];a._values[x]=this._values[x].untransitioned()}return a};var ya=function(a,u,A,x,E){this.property=a,this.value=u,this.begin=E+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=A)};ya.prototype.possiblyEvaluate=function(a,u,A){var x=a.now||0,E=this.value.possiblyEvaluate(a,u,A),I=this.prior;if(I){if(x>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(x<this.begin)return I.possiblyEvaluate(a,u,A);var F=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,u,A),E,function(k){if(k<=0)return 0;if(k>=1)return 1;var H=k*k,Y=H*k;return 4*(k<.5?Y:3*(k-H)+Y-.75)}(F))}return E};var Xo=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};Xo.prototype.possiblyEvaluate=function(a,u,A){for(var x=new bl(this._properties),E=0,I=Object.keys(this._values);E<I.length;E+=1){var F=I[E];x._values[F]=this._values[F].possiblyEvaluate(a,u,A)}return x},Xo.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var Qs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Qs.prototype.getValue=function(a){return pe(this._values[a].value)},Qs.prototype.setValue=function(a,u){this._values[a]=new Eo(this._values[a].property,u===null?void 0:pe(u))},Qs.prototype.serialize=function(){for(var a={},u=0,A=Object.keys(this._values);u<A.length;u+=1){var x=A[u],E=this.getValue(x);E!==void 0&&(a[x]=E)}return a},Qs.prototype.possiblyEvaluate=function(a,u,A){for(var x=new bl(this._properties),E=0,I=Object.keys(this._values);E<I.length;E+=1){var F=I[E];x._values[F]=this._values[F].possiblyEvaluate(a,u,A)}return x};var Zi=function(a,u,A){this.property=a,this.value=u,this.parameters=A};Zi.prototype.isConstant=function(){return this.value.kind==="constant"},Zi.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Zi.prototype.evaluate=function(a,u,A,x){return this.property.evaluate(this.value,this.parameters,a,u,A,x)};var bl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};bl.prototype.get=function(a){return this._values[a]};var _r=function(a){this.specification=a};_r.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},_r.prototype.interpolate=function(a,u,A){var x=Da[this.specification.type];return x?x(a,u,A):a};var or=function(a,u){this.specification=a,this.overrides=u};or.prototype.possiblyEvaluate=function(a,u,A,x){return new Zi(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},A,x)}:a.expression,u)},or.prototype.interpolate=function(a,u,A){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new Zi(this,{kind:"constant",value:void 0},a.parameters);var x=Da[this.specification.type];return x?new Zi(this,{kind:"constant",value:x(a.value.value,u.value.value,A)},a.parameters):a},or.prototype.evaluate=function(a,u,A,x,E,I){return a.kind==="constant"?a.value:a.evaluate(u,A,x,E,I)};var hu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(A,x,E,I){if(A.value===void 0)return new Zi(this,{kind:"constant",value:void 0},x);if(A.expression.kind==="constant"){var F=A.expression.evaluate(x,null,{},E,I),k=A.property.specification.type==="resolvedImage"&&typeof F!="string"?F.name:F,H=this._calculate(k,k,k,x);return new Zi(this,{kind:"constant",value:H},x)}if(A.expression.kind==="camera"){var Y=this._calculate(A.expression.evaluate({zoom:x.zoom-1}),A.expression.evaluate({zoom:x.zoom}),A.expression.evaluate({zoom:x.zoom+1}),x);return new Zi(this,{kind:"constant",value:Y},x)}return new Zi(this,A.expression,x)},u.prototype.evaluate=function(A,x,E,I,F,k){if(A.kind==="source"){var H=A.evaluate(x,E,I,F,k);return this._calculate(H,H,H,x)}return A.kind==="composite"?this._calculate(A.evaluate({zoom:Math.floor(x.zoom)-1},E,I),A.evaluate({zoom:Math.floor(x.zoom)},E,I),A.evaluate({zoom:Math.floor(x.zoom)+1},E,I),x):A.value},u.prototype._calculate=function(A,x,E,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:A,to:x}:{from:E,to:x}},u.prototype.interpolate=function(A){return A},u}(or),is=function(a){this.specification=a};is.prototype.possiblyEvaluate=function(a,u,A,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var E=a.expression.evaluate(u,null,{},A,x);return this._calculate(E,E,E,u)}return this._calculate(a.expression.evaluate(new kr(Math.floor(u.zoom-1),u)),a.expression.evaluate(new kr(Math.floor(u.zoom),u)),a.expression.evaluate(new kr(Math.floor(u.zoom+1),u)),u)}},is.prototype._calculate=function(a,u,A,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:A,to:u}},is.prototype.interpolate=function(a){return a};var Hi=function(a){this.specification=a};Hi.prototype.possiblyEvaluate=function(a,u,A,x){return!!a.expression.evaluate(u,null,{},A,x)},Hi.prototype.interpolate=function(){return!1};var Vn=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var A=a[u];A.specification.overridable&&this.overridableProperties.push(u);var x=this.defaultPropertyValues[u]=new Eo(A,void 0),E=this.defaultTransitionablePropertyValues[u]=new Zs(A);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate({})}};nr("DataDrivenProperty",or),nr("DataConstantProperty",_r),nr("CrossFadedDataDrivenProperty",hu),nr("CrossFadedProperty",is),nr("ColorRampProperty",Hi);var Or=function(a){function u(A,x){if(a.call(this),this.id=A.id,this.type=A.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},A.type!=="custom"&&(this.metadata=(A=A).metadata,this.minzoom=A.minzoom,this.maxzoom=A.maxzoom,A.type!=="background"&&(this.source=A.source,this.sourceLayer=A["source-layer"],this.filter=A.filter),x.layout&&(this._unevaluatedLayout=new Qs(x.layout)),x.paint)){for(var E in this._transitionablePaint=new Vi(x.paint),A.paint)this.setPaintProperty(E,A.paint[E],{validate:!1});for(var I in A.layout)this.setLayoutProperty(I,A.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bl(x.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(A){return A==="visibility"?this.visibility:this._unevaluatedLayout.getValue(A)},u.prototype.setLayoutProperty=function(A,x,E){E===void 0&&(E={}),x!=null&&this._validate(Ic,"layers."+this.id+".layout."+A,A,x,E)||(A!=="visibility"?this._unevaluatedLayout.setValue(A,x):this.visibility=x)},u.prototype.getPaintProperty=function(A){return Le(A,"-transition")?this._transitionablePaint.getTransition(A.slice(0,-11)):this._transitionablePaint.getValue(A)},u.prototype.setPaintProperty=function(A,x,E){if(E===void 0&&(E={}),x!=null&&this._validate(JA,"layers."+this.id+".paint."+A,A,x,E))return!1;if(Le(A,"-transition"))return this._transitionablePaint.setTransition(A.slice(0,-11),x||void 0),!1;var I=this._transitionablePaint._values[A],F=I.property.specification["property-type"]==="cross-faded-data-driven",k=I.value.isDataDriven(),H=I.value;this._transitionablePaint.setValue(A,x),this._handleSpecialPaintPropertyUpdate(A);var Y=this._transitionablePaint._values[A].value;return Y.isDataDriven()||k||F||this._handleOverridablePaintPropertyUpdate(A,H,Y)},u.prototype._handleSpecialPaintPropertyUpdate=function(A){},u.prototype._handleOverridablePaintPropertyUpdate=function(A,x,E){return!1},u.prototype.isHidden=function(A){return!!(this.minzoom&&A<this.minzoom)||!!(this.maxzoom&&A>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(A){this._transitioningPaint=this._transitionablePaint.transitioned(A,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(A,x){A.getCrossfadeParameters&&(this._crossfadeParameters=A.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(A,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(A,void 0,x)},u.prototype.serialize=function(){var A={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(A.layout=A.layout||{},A.layout.visibility=this.visibility),_e(A,function(x,E){return!(x===void 0||E==="layout"&&!Object.keys(x).length||E==="paint"&&!Object.keys(x).length)})},u.prototype._validate=function(A,x,E,I,F){return F===void 0&&(F={}),(!F||F.validate!==!1)&&vl(this,A.call(yl,{key:x,layerType:this.type,objectKey:E,value:I,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var A in this.paint._values){var x=this.paint.get(A);if(x instanceof Zi&&jo(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},u}(xe),eo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},cn=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Hr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Mi(a,u){u===void 0&&(u=1);var A=0,x=0;return{members:a.map(function(E){var I=eo[E.type].BYTES_PER_ELEMENT,F=A=du(A,Math.max(u,I)),k=E.components||1;return x=Math.max(x,I),A+=I*k,{name:E.name,type:E.type,components:k,offset:F}}),size:du(A,Math.max(x,u)),alignment:u}}function du(a,u){return Math.ceil(a/u)*u}Hr.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Hr.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},Hr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Hr.prototype.clear=function(){this.length=0},Hr.prototype.resize=function(a){this.reserve(a),this.length=a},Hr.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},Hr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ks=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x){var E=this.length;return this.resize(E+1),this.emplace(E,A,x)},u.prototype.emplace=function(A,x,E){var I=2*A;return this.int16[I+0]=x,this.int16[I+1]=E,A},u}(Hr);ks.prototype.bytesPerElement=4,nr("StructArrayLayout2i4",ks);var mf=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I){var F=this.length;return this.resize(F+1),this.emplace(F,A,x,E,I)},u.prototype.emplace=function(A,x,E,I,F){var k=4*A;return this.int16[k+0]=x,this.int16[k+1]=E,this.int16[k+2]=I,this.int16[k+3]=F,A},u}(Hr);mf.prototype.bytesPerElement=8,nr("StructArrayLayout4i8",mf);var si=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k){var H=this.length;return this.resize(H+1),this.emplace(H,A,x,E,I,F,k)},u.prototype.emplace=function(A,x,E,I,F,k,H){var Y=6*A;return this.int16[Y+0]=x,this.int16[Y+1]=E,this.int16[Y+2]=I,this.int16[Y+3]=F,this.int16[Y+4]=k,this.int16[Y+5]=H,A},u}(Hr);si.prototype.bytesPerElement=12,nr("StructArrayLayout2i4i12",si);var Qi=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k){var H=this.length;return this.resize(H+1),this.emplace(H,A,x,E,I,F,k)},u.prototype.emplace=function(A,x,E,I,F,k,H){var Y=4*A,ee=8*A;return this.int16[Y+0]=x,this.int16[Y+1]=E,this.uint8[ee+4]=I,this.uint8[ee+5]=F,this.uint8[ee+6]=k,this.uint8[ee+7]=H,A},u}(Hr);Qi.prototype.bytesPerElement=8,nr("StructArrayLayout2i4ub8",Qi);var mo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x){var E=this.length;return this.resize(E+1),this.emplace(E,A,x)},u.prototype.emplace=function(A,x,E){var I=2*A;return this.float32[I+0]=x,this.float32[I+1]=E,A},u}(Hr);mo.prototype.bytesPerElement=8,nr("StructArrayLayout2f8",mo);var _o=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k,H,Y,ee,se){var he=this.length;return this.resize(he+1),this.emplace(he,A,x,E,I,F,k,H,Y,ee,se)},u.prototype.emplace=function(A,x,E,I,F,k,H,Y,ee,se,he){var ve=10*A;return this.uint16[ve+0]=x,this.uint16[ve+1]=E,this.uint16[ve+2]=I,this.uint16[ve+3]=F,this.uint16[ve+4]=k,this.uint16[ve+5]=H,this.uint16[ve+6]=Y,this.uint16[ve+7]=ee,this.uint16[ve+8]=se,this.uint16[ve+9]=he,A},u}(Hr);_o.prototype.bytesPerElement=20,nr("StructArrayLayout10ui20",_o);var jt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k,H,Y,ee,se,he,ve){var Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,A,x,E,I,F,k,H,Y,ee,se,he,ve)},u.prototype.emplace=function(A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue){var ze=12*A;return this.int16[ze+0]=x,this.int16[ze+1]=E,this.int16[ze+2]=I,this.int16[ze+3]=F,this.uint16[ze+4]=k,this.uint16[ze+5]=H,this.uint16[ze+6]=Y,this.uint16[ze+7]=ee,this.int16[ze+8]=se,this.int16[ze+9]=he,this.int16[ze+10]=ve,this.int16[ze+11]=Ue,A},u}(Hr);jt.prototype.bytesPerElement=24,nr("StructArrayLayout4i4ui4i24",jt);var Zt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var F=3*A;return this.float32[F+0]=x,this.float32[F+1]=E,this.float32[F+2]=I,A},u}(Hr);Zt.prototype.bytesPerElement=12,nr("StructArrayLayout3f12",Zt);var Rc=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},u.prototype.emplace=function(A,x){return this.uint32[1*A+0]=x,A},u}(Hr);Rc.prototype.bytesPerElement=4,nr("StructArrayLayout1ul4",Rc);var xl=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k,H,Y,ee){var se=this.length;return this.resize(se+1),this.emplace(se,A,x,E,I,F,k,H,Y,ee)},u.prototype.emplace=function(A,x,E,I,F,k,H,Y,ee,se){var he=10*A,ve=5*A;return this.int16[he+0]=x,this.int16[he+1]=E,this.int16[he+2]=I,this.int16[he+3]=F,this.int16[he+4]=k,this.int16[he+5]=H,this.uint32[ve+3]=Y,this.uint16[he+8]=ee,this.uint16[he+9]=se,A},u}(Hr);xl.prototype.bytesPerElement=20,nr("StructArrayLayout6i1ul2ui20",xl);var Ko=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k){var H=this.length;return this.resize(H+1),this.emplace(H,A,x,E,I,F,k)},u.prototype.emplace=function(A,x,E,I,F,k,H){var Y=6*A;return this.int16[Y+0]=x,this.int16[Y+1]=E,this.int16[Y+2]=I,this.int16[Y+3]=F,this.int16[Y+4]=k,this.int16[Y+5]=H,A},u}(Hr);Ko.prototype.bytesPerElement=12,nr("StructArrayLayout2i2i2i12",Ko);var To=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F){var k=this.length;return this.resize(k+1),this.emplace(k,A,x,E,I,F)},u.prototype.emplace=function(A,x,E,I,F,k){var H=4*A,Y=8*A;return this.float32[H+0]=x,this.float32[H+1]=E,this.float32[H+2]=I,this.int16[Y+6]=F,this.int16[Y+7]=k,A},u}(Hr);To.prototype.bytesPerElement=16,nr("StructArrayLayout2f1f2i16",To);var Yo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I){var F=this.length;return this.resize(F+1),this.emplace(F,A,x,E,I)},u.prototype.emplace=function(A,x,E,I,F){var k=12*A,H=3*A;return this.uint8[k+0]=x,this.uint8[k+1]=E,this.float32[H+1]=I,this.float32[H+2]=F,A},u}(Hr);Yo.prototype.bytesPerElement=12,nr("StructArrayLayout2ub2f12",Yo);var qo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var F=3*A;return this.uint16[F+0]=x,this.uint16[F+1]=E,this.uint16[F+2]=I,A},u}(Hr);qo.prototype.bytesPerElement=6,nr("StructArrayLayout3ui6",qo);var hs=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze,je,Ve,qe){var at=this.length;return this.resize(at+1),this.emplace(at,A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze,je,Ve,qe)},u.prototype.emplace=function(A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze,je,Ve,qe,at){var pt=24*A,_t=12*A,Pt=48*A;return this.int16[pt+0]=x,this.int16[pt+1]=E,this.uint16[pt+2]=I,this.uint16[pt+3]=F,this.uint32[_t+2]=k,this.uint32[_t+3]=H,this.uint32[_t+4]=Y,this.uint16[pt+10]=ee,this.uint16[pt+11]=se,this.uint16[pt+12]=he,this.float32[_t+7]=ve,this.float32[_t+8]=Ue,this.uint8[Pt+36]=ze,this.uint8[Pt+37]=je,this.uint8[Pt+38]=Ve,this.uint32[_t+10]=qe,this.int16[pt+22]=at,A},u}(Hr);hs.prototype.bytesPerElement=48,nr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",hs);var y=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze,je,Ve,qe,at,pt,_t,Pt,Gt,Jt,mr,er,br,tr,Zr){var Mr=this.length;return this.resize(Mr+1),this.emplace(Mr,A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze,je,Ve,qe,at,pt,_t,Pt,Gt,Jt,mr,er,br,tr,Zr)},u.prototype.emplace=function(A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze,je,Ve,qe,at,pt,_t,Pt,Gt,Jt,mr,er,br,tr,Zr,Mr){var ur=34*A,sn=17*A;return this.int16[ur+0]=x,this.int16[ur+1]=E,this.int16[ur+2]=I,this.int16[ur+3]=F,this.int16[ur+4]=k,this.int16[ur+5]=H,this.int16[ur+6]=Y,this.int16[ur+7]=ee,this.uint16[ur+8]=se,this.uint16[ur+9]=he,this.uint16[ur+10]=ve,this.uint16[ur+11]=Ue,this.uint16[ur+12]=ze,this.uint16[ur+13]=je,this.uint16[ur+14]=Ve,this.uint16[ur+15]=qe,this.uint16[ur+16]=at,this.uint16[ur+17]=pt,this.uint16[ur+18]=_t,this.uint16[ur+19]=Pt,this.uint16[ur+20]=Gt,this.uint16[ur+21]=Jt,this.uint16[ur+22]=mr,this.uint32[sn+12]=er,this.float32[sn+13]=br,this.float32[sn+14]=tr,this.float32[sn+15]=Zr,this.float32[sn+16]=Mr,A},u}(Hr);y.prototype.bytesPerElement=68,nr("StructArrayLayout8i15ui1ul4f68",y);var m=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},u.prototype.emplace=function(A,x){return this.float32[1*A+0]=x,A},u}(Hr);m.prototype.bytesPerElement=4,nr("StructArrayLayout1f4",m);var v=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var F=3*A;return this.int16[F+0]=x,this.int16[F+1]=E,this.int16[F+2]=I,A},u}(Hr);v.prototype.bytesPerElement=6,nr("StructArrayLayout3i6",v);var w=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,E)},u.prototype.emplace=function(A,x,E,I){var F=4*A;return this.uint32[2*A+0]=x,this.uint16[F+2]=E,this.uint16[F+3]=I,A},u}(Hr);w.prototype.bytesPerElement=8,nr("StructArrayLayout1ul2ui8",w);var B=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x){var E=this.length;return this.resize(E+1),this.emplace(E,A,x)},u.prototype.emplace=function(A,x,E){var I=2*A;return this.uint16[I+0]=x,this.uint16[I+1]=E,A},u}(Hr);B.prototype.bytesPerElement=4,nr("StructArrayLayout2ui4",B);var M=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},u.prototype.emplace=function(A,x){return this.uint16[1*A+0]=x,A},u}(Hr);M.prototype.bytesPerElement=2,nr("StructArrayLayout1ui2",M);var O=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(A,x,E,I){var F=this.length;return this.resize(F+1),this.emplace(F,A,x,E,I)},u.prototype.emplace=function(A,x,E,I,F){var k=4*A;return this.float32[k+0]=x,this.float32[k+1]=E,this.float32[k+2]=I,this.float32[k+3]=F,A},u}(Hr);O.prototype.bytesPerElement=16,nr("StructArrayLayout4f16",O);var l=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return A.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},A.x1.get=function(){return this._structArray.int16[this._pos2+2]},A.y1.get=function(){return this._structArray.int16[this._pos2+3]},A.x2.get=function(){return this._structArray.int16[this._pos2+4]},A.y2.get=function(){return this._structArray.int16[this._pos2+5]},A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.anchorPoint.get=function(){return new b(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,A),u}(cn);l.prototype.size=20;var d=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new l(this,A)},u}(xl);nr("CollisionBoxArray",d);var h=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},A.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},A.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},A.segment.get=function(){return this._structArray.uint16[this._pos2+10]},A.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},A.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},A.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},A.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},A.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},A.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},A.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},A.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},A.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},A.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},A.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,A),u}(cn);h.prototype.size=48;var g=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new h(this,A)},u}(hs);nr("PlacedSymbolArray",g);var C=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},A.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},A.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},A.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},A.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},A.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},A.key.get=function(){return this._structArray.uint16[this._pos2+8]},A.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},A.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},A.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},A.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},A.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},A.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},A.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},A.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},A.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},A.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},A.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},A.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},A.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},A.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},A.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},A.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},A.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},A.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,A),u}(cn);C.prototype.size=68;var P=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new C(this,A)},u}(y);nr("SymbolInstanceArray",P);var R=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(A){return this.float32[1*A+0]},u}(m);nr("GlyphOffsetArray",R);var L=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(A){return this.int16[3*A+0]},u.prototype.gety=function(A){return this.int16[3*A+1]},u.prototype.gettileUnitDistanceFromAnchor=function(A){return this.int16[3*A+2]},u}(v);nr("SymbolLineVertexArray",L);var U=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var A={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,A),u}(cn);U.prototype.size=8;var X=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(A){return new U(this,A)},u}(w);nr("FeatureIndexArray",X);var te=Mi([{name:"a_pos",components:2,type:"Int16"}],4).members,Q=function(a){a===void 0&&(a=[]),this.segments=a};function re(a,u){return 256*(a=W(Math.floor(a),0,255))+W(Math.floor(u),0,255)}Q.prototype.prepareSegment=function(a,u,A,x){var E=this.segments[this.segments.length-1];return a>Q.MAX_VERTEX_ARRAY_LENGTH&&ne("Max vertices per segment is "+Q.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!E||E.vertexLength+a>Q.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==x)&&(E={vertexOffset:u.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0},x!==void 0&&(E.sortKey=x),this.segments.push(E)),E},Q.prototype.get=function(){return this.segments},Q.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var A=u[a];for(var x in A.vaos)A.vaos[x].destroy()}},Q.simpleSegment=function(a,u,A,x){return new Q([{vertexOffset:a,primitiveOffset:u,vertexLength:A,primitiveLength:x,vaos:{},sortKey:0}])},Q.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nr("SegmentVector",Q);var oe=Mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ee=c(function(a){a.exports=function(u,A){var x,E,I,F,k,H,Y,ee;for(E=u.length-(x=3&u.length),I=A,k=3432918353,H=461845907,ee=0;ee<E;)Y=255&u.charCodeAt(ee)|(255&u.charCodeAt(++ee))<<8|(255&u.charCodeAt(++ee))<<16|(255&u.charCodeAt(++ee))<<24,++ee,I=27492+(65535&(F=5*(65535&(I=(I^=Y=(65535&(Y=(Y=(65535&Y)*k+(((Y>>>16)*k&65535)<<16)&4294967295)<<15|Y>>>17))*H+(((Y>>>16)*H&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(F>>>16)&65535)<<16);switch(Y=0,x){case 3:Y^=(255&u.charCodeAt(ee+2))<<16;case 2:Y^=(255&u.charCodeAt(ee+1))<<8;case 1:I^=Y=(65535&(Y=(Y=(65535&(Y^=255&u.charCodeAt(ee)))*k+(((Y>>>16)*k&65535)<<16)&4294967295)<<15|Y>>>17))*H+(((Y>>>16)*H&65535)<<16)&4294967295}return I^=u.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),Oe=c(function(a){a.exports=function(u,A){for(var x,E=u.length,I=A^E,F=0;E>=4;)x=1540483477*(65535&(x=255&u.charCodeAt(F)|(255&u.charCodeAt(++F))<<8|(255&u.charCodeAt(++F))<<16|(255&u.charCodeAt(++F))<<24))+((1540483477*(x>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),E-=4,++F;switch(E){case 3:I^=(255&u.charCodeAt(F+2))<<16;case 2:I^=(255&u.charCodeAt(F+1))<<8;case 1:I=1540483477*(65535&(I^=255&u.charCodeAt(F)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),me=Ee,Fe=Oe;me.murmur3=Ee,me.murmur2=Fe;var He=function(){this.ids=[],this.positions=[],this.indexed=!1};He.prototype.add=function(a,u,A,x){this.ids.push(it(a)),this.positions.push(u,A,x)},He.prototype.getPositions=function(a){for(var u=it(a),A=0,x=this.ids.length-1;A<x;){var E=A+x>>1;this.ids[E]>=u?x=E:A=E+1}for(var I=[];this.ids[A]===u;)I.push({index:this.positions[3*A],start:this.positions[3*A+1],end:this.positions[3*A+2]}),A++;return I},He.serialize=function(a,u){var A=new Float64Array(a.ids),x=new Uint32Array(a.positions);return function E(I,F,k,H){for(;k<H;){for(var Y=I[k+H>>1],ee=k-1,se=H+1;;){do ee++;while(I[ee]<Y);do se--;while(I[se]>Y);if(ee>=se)break;Xe(I,ee,se),Xe(F,3*ee,3*se),Xe(F,3*ee+1,3*se+1),Xe(F,3*ee+2,3*se+2)}se-k<H-se?(E(I,F,k,se),k=se+1):(E(I,F,se+1,H),H=se)}}(A,x,0,A.length-1),u&&u.push(A.buffer,x.buffer),{ids:A,positions:x}},He.deserialize=function(a){var u=new He;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var We=Math.pow(2,53)-1;function it(a){var u=+a;return!isNaN(u)&&u<=We?u:me(String(a))}function Xe(a,u,A){var x=a[u];a[u]=a[A],a[A]=x}nr("FeaturePositionMap",He);var et=function(a,u){this.gl=a.gl,this.location=u},ht=function(a){function u(A,x){a.call(this,A,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))},u}(et),Rt=function(a){function u(A,x){a.call(this,A,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1f(this.location,A))},u}(et),xt=function(a){function u(A,x){a.call(this,A,x),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))},u}(et),kt=function(a){function u(A,x){a.call(this,A,x),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))},u}(et),rr=function(a){function u(A,x){a.call(this,A,x),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]&&A[3]===this.current[3]||(this.current=A,this.gl.uniform4f(this.location,A[0],A[1],A[2],A[3]))},u}(et),vr=function(a){function u(A,x){a.call(this,A,x),this.current=Kr.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){A.r===this.current.r&&A.g===this.current.g&&A.b===this.current.b&&A.a===this.current.a||(this.current=A,this.gl.uniform4f(this.location,A.r,A.g,A.b,A.a))},u}(et),Cr=new Float32Array(16),gn=function(a){function u(A,x){a.call(this,A,x),this.current=Cr}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(var x=1;x<16;x++)if(A[x]!==this.current[x]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}},u}(et);function ir(a){return[re(255*a.r,255*a.g),re(255*a.b,255*a.a)]}var Ur=function(a,u,A){this.value=a,this.uniformNames=u.map(function(x){return"u_"+x}),this.type=A};Ur.prototype.setUniform=function(a,u,A){a.set(A.constantOr(this.value))},Ur.prototype.getBinding=function(a,u,A){return this.type==="color"?new vr(a,u):new Rt(a,u)};var Yr=function(a,u){this.uniformNames=u.map(function(A){return"u_"+A}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Yr.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},Yr.prototype.setUniform=function(a,u,A,x){var E=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&a.set(E)},Yr.prototype.getBinding=function(a,u,A){return A.substr(0,9)==="u_pattern"?new rr(a,u):new Rt(a,u)};var Nr=function(a,u,A,x){this.expression=a,this.type=A,this.maxValue=0,this.paintVertexAttributes=u.map(function(E){return{name:"a_"+E,type:"Float32",components:A==="color"?2:1,offset:0}}),this.paintVertexArray=new x};Nr.prototype.populatePaintArray=function(a,u,A,x,E){var I=this.paintVertexArray.length,F=this.expression.evaluate(new kr(0),u,{},x,[],E);this.paintVertexArray.resize(a),this._setPaintValue(I,a,F)},Nr.prototype.updatePaintArray=function(a,u,A,x){var E=this.expression.evaluate({zoom:0},A,x);this._setPaintValue(a,u,E)},Nr.prototype._setPaintValue=function(a,u,A){if(this.type==="color")for(var x=ir(A),E=a;E<u;E++)this.paintVertexArray.emplace(E,x[0],x[1]);else{for(var I=a;I<u;I++)this.paintVertexArray.emplace(I,A);this.maxValue=Math.max(this.maxValue,Math.abs(A))}},Nr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Nr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Dr=function(a,u,A,x,E,I){this.expression=a,this.uniformNames=u.map(function(F){return"u_"+F+"_t"}),this.type=A,this.useIntegerZoom=x,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(function(F){return{name:"a_"+F,type:"Float32",components:A==="color"?4:2,offset:0}}),this.paintVertexArray=new I};Dr.prototype.populatePaintArray=function(a,u,A,x,E){var I=this.expression.evaluate(new kr(this.zoom),u,{},x,[],E),F=this.expression.evaluate(new kr(this.zoom+1),u,{},x,[],E),k=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(k,a,I,F)},Dr.prototype.updatePaintArray=function(a,u,A,x){var E=this.expression.evaluate({zoom:this.zoom},A,x),I=this.expression.evaluate({zoom:this.zoom+1},A,x);this._setPaintValue(a,u,E,I)},Dr.prototype._setPaintValue=function(a,u,A,x){if(this.type==="color")for(var E=ir(A),I=ir(x),F=a;F<u;F++)this.paintVertexArray.emplace(F,E[0],E[1],I[0],I[1]);else{for(var k=a;k<u;k++)this.paintVertexArray.emplace(k,A,x);this.maxValue=Math.max(this.maxValue,Math.abs(A),Math.abs(x))}},Dr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Dr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Dr.prototype.setUniform=function(a,u){var A=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=W(this.expression.interpolationFactor(A,this.zoom,this.zoom+1),0,1);a.set(x)},Dr.prototype.getBinding=function(a,u,A){return new Rt(a,u)};var Wr=function(a,u,A,x,E,I){this.expression=a,this.type=u,this.useIntegerZoom=A,this.zoom=x,this.layerId=I,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E};Wr.prototype.populatePaintArray=function(a,u,A){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,u.patterns&&u.patterns[this.layerId],A)},Wr.prototype.updatePaintArray=function(a,u,A,x,E){this._setPaintValues(a,u,A.patterns&&A.patterns[this.layerId],E)},Wr.prototype._setPaintValues=function(a,u,A,x){if(x&&A){var E=x[A.min],I=x[A.mid],F=x[A.max];if(E&&I&&F)for(var k=a;k<u;k++)this.zoomInPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],I.pixelRatio,F.pixelRatio)}},Wr.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,oe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,oe.members,this.expression.isStateDependent))},Wr.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Pr=function(a,u,A){this.binders={},this._buffers=[];var x=[];for(var E in a.paint._values)if(A(E)){var I=a.paint.get(E);if(I instanceof Zi&&jo(I.property.specification)){var F=ji(E,a.type),k=I.value,H=I.property.specification.type,Y=I.property.useIntegerZoom,ee=I.property.specification["property-type"],se=ee==="cross-faded"||ee==="cross-faded-data-driven";if(k.kind==="constant")this.binders[E]=se?new Yr(k.value,F):new Ur(k.value,F,H),x.push("/u_"+E);else if(k.kind==="source"||se){var he=yi(E,H,"source");this.binders[E]=se?new Wr(k,H,Y,u,he,a.id):new Nr(k,F,H,he),x.push("/a_"+E)}else{var ve=yi(E,H,"composite");this.binders[E]=new Dr(k,F,H,Y,u,ve),x.push("/z_"+E)}}}this.cacheKey=x.sort().join("")};Pr.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof Nr||u instanceof Dr?u.maxValue:0},Pr.prototype.populatePaintArrays=function(a,u,A,x,E){for(var I in this.binders){var F=this.binders[I];(F instanceof Nr||F instanceof Dr||F instanceof Wr)&&F.populatePaintArray(a,u,A,x,E)}},Pr.prototype.setConstantPatternPositions=function(a,u){for(var A in this.binders){var x=this.binders[A];x instanceof Yr&&x.setConstantPatternPositions(a,u)}},Pr.prototype.updatePaintArrays=function(a,u,A,x,E){var I=!1;for(var F in a)for(var k=0,H=u.getPositions(F);k<H.length;k+=1){var Y=H[k],ee=A.feature(Y.index);for(var se in this.binders){var he=this.binders[se];if((he instanceof Nr||he instanceof Dr||he instanceof Wr)&&he.expression.isStateDependent===!0){var ve=x.paint.get(se);he.expression=ve.value,he.updatePaintArray(Y.start,Y.end,ee,a[F],E),I=!0}}}return I},Pr.prototype.defines=function(){var a=[];for(var u in this.binders){var A=this.binders[u];(A instanceof Ur||A instanceof Yr)&&a.push.apply(a,A.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},Pr.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var A=this.binders[u];if(A instanceof Nr||A instanceof Dr)for(var x=0;x<A.paintVertexAttributes.length;x++)a.push(A.paintVertexAttributes[x].name);else if(A instanceof Wr)for(var E=0;E<oe.members.length;E++)a.push(oe.members[E].name)}return a},Pr.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var A=this.binders[u];if(A instanceof Ur||A instanceof Yr||A instanceof Dr)for(var x=0,E=A.uniformNames;x<E.length;x+=1)a.push(E[x])}return a},Pr.prototype.getPaintVertexBuffers=function(){return this._buffers},Pr.prototype.getUniforms=function(a,u){var A=[];for(var x in this.binders){var E=this.binders[x];if(E instanceof Ur||E instanceof Yr||E instanceof Dr)for(var I=0,F=E.uniformNames;I<F.length;I+=1){var k=F[I];if(u[k]){var H=E.getBinding(a,u[k],k);A.push({name:k,property:x,binding:H})}}}return A},Pr.prototype.setUniforms=function(a,u,A,x){for(var E=0,I=u;E<I.length;E+=1){var F=I[E],k=F.name,H=F.property;this.binders[H].setUniform(F.binding,x,A.get(H),k)}},Pr.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var A=this.binders[u];if(a&&A instanceof Wr){var x=a.fromScale===2?A.zoomInPaintVertexBuffer:A.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(A instanceof Nr||A instanceof Dr)&&A.paintVertexBuffer&&this._buffers.push(A.paintVertexBuffer)}},Pr.prototype.upload=function(a){for(var u in this.binders){var A=this.binders[u];(A instanceof Nr||A instanceof Dr||A instanceof Wr)&&A.upload(a)}this.updatePaintBuffers()},Pr.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof Nr||u instanceof Dr||u instanceof Wr)&&u.destroy()}};var Ir=function(a,u,A){A===void 0&&(A=function(){return!0}),this.programConfigurations={};for(var x=0,E=a;x<E.length;x+=1){var I=E[x];this.programConfigurations[I.id]=new Pr(I,u,A)}this.needsUpload=!1,this._featureMap=new He,this._bufferOffset=0};function ji(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function yi(a,u,A){var x={color:{source:mo,composite:O},number:{source:m,composite:mo}},E=function(I){return{"line-pattern":{source:_o,composite:_o},"fill-pattern":{source:_o,composite:_o},"fill-extrusion-pattern":{source:_o,composite:_o}}[I]}(a);return E&&E[A]||x[u][A]}Ir.prototype.populatePaintArrays=function(a,u,A,x,E,I){for(var F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(a,u,x,E,I);u.id!==void 0&&this._featureMap.add(u.id,A,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Ir.prototype.updatePaintArrays=function(a,u,A,x){for(var E=0,I=A;E<I.length;E+=1){var F=I[E];this.needsUpload=this.programConfigurations[F.id].updatePaintArrays(a,this._featureMap,u,F,x)||this.needsUpload}},Ir.prototype.get=function(a){return this.programConfigurations[a]},Ir.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},Ir.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},nr("ConstantBinder",Ur),nr("CrossFadedConstantBinder",Yr),nr("SourceExpressionBinder",Nr),nr("CrossFadedCompositeBinder",Wr),nr("CompositeExpressionBinder",Dr),nr("ProgramConfiguration",Pr,{omit:["_buffers"]}),nr("ProgramConfigurationSet",Ir);var ds=Math.pow(2,14)-1,es=-ds-1;function di(a){for(var u=8192/a.extent,A=a.loadGeometry(),x=0;x<A.length;x++)for(var E=A[x],I=0;I<E.length;I++){var F=E[I],k=Math.round(F.x*u),H=Math.round(F.y*u);F.x=W(k,es,ds),F.y=W(H,es,ds),(k<F.x||k>F.x+1||H<F.y||H>F.y+1)&&ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return A}function wi(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?di(a):[]}}function to(a,u,A,x,E){a.emplaceBack(2*u+(x+1)/2,2*A+(E+1)/2)}var ws=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new ks,this.indexArray=new qo,this.segments=new Q,this.programConfigurations=new Ir(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Fc(a,u){for(var A=0;A<a.length;A++)if(va(u,a[A]))return!0;for(var x=0;x<u.length;x++)if(va(a,u[x]))return!0;return!!_f(a,u)}function Ns(a,u,A){return!!va(a,u)||!!Oc(u,a,A)}function Zo(a,u){if(a.length===1)return yf(u,a[0]);for(var A=0;A<u.length;A++)for(var x=u[A],E=0;E<x.length;E++)if(va(a,x[E]))return!0;for(var I=0;I<a.length;I++)if(yf(u,a[I]))return!0;for(var F=0;F<u.length;F++)if(_f(a,u[F]))return!0;return!1}function Bo(a,u,A){if(a.length>1){if(_f(a,u))return!0;for(var x=0;x<u.length;x++)if(Oc(u[x],a,A))return!0}for(var E=0;E<a.length;E++)if(Oc(a[E],u,A))return!0;return!1}function _f(a,u){if(a.length===0||u.length===0)return!1;for(var A=0;A<a.length-1;A++)for(var x=a[A],E=a[A+1],I=0;I<u.length-1;I++)if(Au(x,E,u[I],u[I+1]))return!0;return!1}function Au(a,u,A,x){return ye(a,A,x)!==ye(u,A,x)&&ye(a,u,A)!==ye(a,u,x)}function Oc(a,u,A){var x=A*A;if(u.length===1)return a.distSqr(u[0])<x;for(var E=1;E<u.length;E++)if(pu(a,u[E-1],u[E])<x)return!0;return!1}function pu(a,u,A){var x=u.distSqr(A);if(x===0)return a.distSqr(u);var E=((a.x-u.x)*(A.x-u.x)+(a.y-u.y)*(A.y-u.y))/x;return a.distSqr(E<0?u:E>1?A:A.sub(u)._mult(E)._add(u))}function yf(a,u){for(var A,x,E,I=!1,F=0;F<a.length;F++)for(var k=0,H=(A=a[F]).length-1;k<A.length;H=k++)(x=A[k]).y>u.y!=(E=A[H]).y>u.y&&u.x<(E.x-x.x)*(u.y-x.y)/(E.y-x.y)+x.x&&(I=!I);return I}function va(a,u){for(var A=!1,x=0,E=a.length-1;x<a.length;E=x++){var I=a[x],F=a[E];I.y>u.y!=F.y>u.y&&u.x<(F.x-I.x)*(u.y-I.y)/(F.y-I.y)+I.x&&(A=!A)}return A}function vf(a,u,A){var x=A[0],E=A[2];if(a.x<x.x&&u.x<x.x||a.x>E.x&&u.x>E.x||a.y<x.y&&u.y<x.y||a.y>E.y&&u.y>E.y)return!1;var I=ye(a,u,A[0]);return I!==ye(a,u,A[1])||I!==ye(a,u,A[2])||I!==ye(a,u,A[3])}function ba(a,u,A){var x=u.paint.get(a).value;return x.kind==="constant"?x.value:A.programConfigurations.get(u.id).getMaxValue(a)}function $i(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Ja(a,u,A,x,E){if(!u[0]&&!u[1])return a;var I=b.convert(u)._mult(E);A==="viewport"&&I._rotate(-x);for(var F=[],k=0;k<a.length;k++)F.push(a[k].sub(I));return F}ws.prototype.populate=function(a,u,A){var x=this.layers[0],E=[],I=null;x.type==="circle"&&(I=x.layout.get("circle-sort-key"));for(var F=0,k=a;F<k.length;F+=1){var H=k[F],Y=H.feature,ee=H.id,se=H.index,he=H.sourceLayerIndex,ve=this.layers[0]._featureFilter.needGeometry,Ue=wi(Y,ve);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),Ue,A)){var ze=I?I.evaluate(Ue,{},A):void 0,je={id:ee,properties:Y.properties,type:Y.type,sourceLayerIndex:he,index:se,geometry:ve?Ue.geometry:di(Y),patterns:{},sortKey:ze};E.push(je)}}I&&E.sort(function(Jt,mr){return Jt.sortKey-mr.sortKey});for(var Ve=0,qe=E;Ve<qe.length;Ve+=1){var at=qe[Ve],pt=at.geometry,_t=at.index,Pt=at.sourceLayerIndex,Gt=a[_t].feature;this.addFeature(at,pt,_t,A),u.featureIndex.insert(Gt,pt,_t,Pt,this.index)}},ws.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},ws.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ws.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ws.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,te),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ws.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ws.prototype.addFeature=function(a,u,A,x){for(var E=0,I=u;E<I.length;E+=1)for(var F=0,k=I[E];F<k.length;F+=1){var H=k[F],Y=H.x,ee=H.y;if(!(Y<0||Y>=8192||ee<0||ee>=8192)){var se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),he=se.vertexLength;to(this.layoutVertexArray,Y,ee,-1,-1),to(this.layoutVertexArray,Y,ee,1,-1),to(this.layoutVertexArray,Y,ee,1,1),to(this.layoutVertexArray,Y,ee,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),se.vertexLength+=4,se.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,{},x)},nr("CircleBucket",ws,{omit:["layers"]});var Dc=new Vn({"circle-sort-key":new or(ce.layout_circle["circle-sort-key"])}),wl={paint:new Vn({"circle-radius":new or(ce.paint_circle["circle-radius"]),"circle-color":new or(ce.paint_circle["circle-color"]),"circle-blur":new or(ce.paint_circle["circle-blur"]),"circle-opacity":new or(ce.paint_circle["circle-opacity"]),"circle-translate":new _r(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new _r(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _r(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _r(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new or(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new or(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new or(ce.paint_circle["circle-stroke-opacity"])}),layout:Dc},vn=typeof Float32Array<"u"?Float32Array:Array;function yo(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Us(a,u,A){var x=u[0],E=u[1],I=u[2],F=u[3],k=u[4],H=u[5],Y=u[6],ee=u[7],se=u[8],he=u[9],ve=u[10],Ue=u[11],ze=u[12],je=u[13],Ve=u[14],qe=u[15],at=A[0],pt=A[1],_t=A[2],Pt=A[3];return a[0]=at*x+pt*k+_t*se+Pt*ze,a[1]=at*E+pt*H+_t*he+Pt*je,a[2]=at*I+pt*Y+_t*ve+Pt*Ve,a[3]=at*F+pt*ee+_t*Ue+Pt*qe,a[4]=(at=A[4])*x+(pt=A[5])*k+(_t=A[6])*se+(Pt=A[7])*ze,a[5]=at*E+pt*H+_t*he+Pt*je,a[6]=at*I+pt*Y+_t*ve+Pt*Ve,a[7]=at*F+pt*ee+_t*Ue+Pt*qe,a[8]=(at=A[8])*x+(pt=A[9])*k+(_t=A[10])*se+(Pt=A[11])*ze,a[9]=at*E+pt*H+_t*he+Pt*je,a[10]=at*I+pt*Y+_t*ve+Pt*Ve,a[11]=at*F+pt*ee+_t*Ue+Pt*qe,a[12]=(at=A[12])*x+(pt=A[13])*k+(_t=A[14])*se+(Pt=A[15])*ze,a[13]=at*E+pt*H+_t*he+Pt*je,a[14]=at*I+pt*Y+_t*ve+Pt*Ve,a[15]=at*F+pt*ee+_t*Ue+Pt*qe,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,A=arguments.length;A--;)u+=a[A]*a[A];return Math.sqrt(u)});var Cl,sv=Us;function Ph(a,u,A){var x=u[0],E=u[1],I=u[2],F=u[3];return a[0]=A[0]*x+A[4]*E+A[8]*I+A[12]*F,a[1]=A[1]*x+A[5]*E+A[9]*I+A[13]*F,a[2]=A[2]*x+A[6]*E+A[10]*I+A[14]*F,a[3]=A[3]*x+A[7]*E+A[11]*I+A[15]*F,a}Cl=new vn(3),vn!=Float32Array&&(Cl[0]=0,Cl[1]=0,Cl[2]=0),function(){var a=new vn(4);vn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var ov=(function(){var a=new vn(2);vn!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function u(A){a.call(this,A,wl)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(A){return new ws(A)},u.prototype.queryRadius=function(A){var x=A;return ba("circle-radius",this,x)+ba("circle-stroke-width",this,x)+$i(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(A,x,E,I,F,k,H,Y){for(var ee=Ja(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,H),se=this.paint.get("circle-radius").evaluate(x,E)+this.paint.get("circle-stroke-width").evaluate(x,E),he=this.paint.get("circle-pitch-alignment")==="map",ve=he?ee:function(Gt,Jt){return Gt.map(function(mr){return bf(mr,Jt)})}(ee,Y),Ue=he?se*H:se,ze=0,je=I;ze<je.length;ze+=1)for(var Ve=0,qe=je[ze];Ve<qe.length;Ve+=1){var at=qe[Ve],pt=he?at:bf(at,Y),_t=Ue,Pt=Ph([],[at.x,at.y,0,1],Y);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_t*=Pt[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_t*=k.cameraToCenterDistance/Pt[3]),Ns(ve,pt,_t))return!0}return!1},u}(Or));function bf(a,u){var A=Ph([],[a.x,a.y,0,1],u);return new b(A[0]/A[3],A[1]/A[3])}var Hg=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(ws);function gu(a,u,A,x){var E=u.width,I=u.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==E*I*A)throw new RangeError("mismatched image size")}else x=new Uint8Array(E*I*A);return a.width=E,a.height=I,a.data=x,a}function Rh(a,u,A){var x=u.width,E=u.height;if(x!==a.width||E!==a.height){var I=gu({},{width:x,height:E},A);av(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,E)},A),a.width=x,a.height=E,a.data=I.data}}function av(a,u,A,x,E,I){if(E.width===0||E.height===0)return u;if(E.width>a.width||E.height>a.height||A.x>a.width-E.width||A.y>a.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>u.width||E.height>u.height||x.x>u.width-E.width||x.y>u.height-E.height)throw new RangeError("out of range destination coordinates for image copy");for(var F=a.data,k=u.data,H=0;H<E.height;H++)for(var Y=((A.y+H)*a.width+A.x)*I,ee=((x.y+H)*u.width+x.x)*I,se=0;se<E.width*I;se++)k[ee+se]=F[Y+se];return u}nr("HeatmapBucket",Hg,{omit:["layers"]});var xf=function(a,u){gu(this,a,1,u)};xf.prototype.resize=function(a){Rh(this,a,1)},xf.prototype.clone=function(){return new xf({width:this.width,height:this.height},new Uint8Array(this.data))},xf.copy=function(a,u,A,x,E){av(a,u,A,x,E,1)};var ro=function(a,u){gu(this,a,4,u)};ro.prototype.resize=function(a){Rh(this,a,4)},ro.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},ro.prototype.clone=function(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))},ro.copy=function(a,u,A,x,E){av(a,u,A,x,E,4)},nr("AlphaImage",xf),nr("RGBAImage",ro);var y9={paint:new Vn({"heatmap-radius":new or(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new or(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _r(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hi(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _r(ce.paint_heatmap["heatmap-opacity"])})};function WE(a){var u={},A=a.resolution||256,x=a.clips?a.clips.length:1,E=a.image||new ro({width:A,height:x}),I=function(Ue,ze,je){u[a.evaluationKey]=je;var Ve=a.expression.evaluate(u);E.data[Ue+ze+0]=Math.floor(255*Ve.r/Ve.a),E.data[Ue+ze+1]=Math.floor(255*Ve.g/Ve.a),E.data[Ue+ze+2]=Math.floor(255*Ve.b/Ve.a),E.data[Ue+ze+3]=Math.floor(255*Ve.a)};if(a.clips)for(var F=0,k=0;F<x;++F,k+=4*A)for(var H=0,Y=0;H<A;H++,Y+=4){var ee=H/(A-1),se=a.clips[F];I(k,Y,se.start*(1-ee)+se.end*ee)}else for(var he=0,ve=0;he<A;he++,ve+=4)I(0,ve,he/(A-1));return E}var v9=function(a){function u(A){a.call(this,A,y9),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(A){return new Hg(A)},u.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=WE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Or),b9={paint:new Vn({"hillshade-illumination-direction":new _r(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _r(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _r(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _r(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _r(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _r(ce.paint_hillshade["hillshade-accent-color"])})},x9=function(a){function u(A){a.call(this,A,b9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Or),w9=Mi([{name:"a_pos",components:2,type:"Int16"}],4).members,cv=jg,C9=jg;function jg(a,u,A){A=A||2;var x,E,I,F,k,H,Y,ee=u&&u.length,se=ee?u[0]*A:a.length,he=JE(a,0,se,A,!0),ve=[];if(!he||he.next===he.prev)return ve;if(ee&&(he=function(ze,je,Ve,qe){var at,pt,_t,Pt=[];for(at=0,pt=je.length;at<pt;at++)(_t=JE(ze,je[at]*qe,at<pt-1?je[at+1]*qe:ze.length,qe,!1))===_t.next&&(_t.steiner=!0),Pt.push(R9(_t));for(Pt.sort(I9),at=0;at<Pt.length;at++)M9(Pt[at],Ve),Ve=mu(Ve,Ve.next);return Ve}(a,u,he,A)),a.length>80*A){x=I=a[0],E=F=a[1];for(var Ue=A;Ue<se;Ue+=A)(k=a[Ue])<x&&(x=k),(H=a[Ue+1])<E&&(E=H),k>I&&(I=k),H>F&&(F=H);Y=(Y=Math.max(I-x,F-E))!==0?1/Y:0}return XA(he,ve,A,x,E,Y),ve}function JE(a,u,A,x,E){var I,F;if(E===fv(a,u,A,x)>0)for(I=u;I<A;I+=x)F=YE(I,a[I],a[I+1],F);else for(I=A-x;I>=u;I-=x)F=YE(I,a[I],a[I+1],F);return F&&$g(F,F.next)&&(YA(F),F=F.next),F}function mu(a,u){if(!a)return a;u||(u=a);var A,x=a;do if(A=!1,x.steiner||!$g(x,x.next)&&Oi(x.prev,x,x.next)!==0)x=x.next;else{if(YA(x),(x=u=x.prev)===x.next)break;A=!0}while(A||x!==u);return u}function XA(a,u,A,x,E,I,F){if(a){!F&&I&&function(ee,se,he,ve){var Ue=ee;do Ue.z===null&&(Ue.z=lv(Ue.x,Ue.y,se,he,ve)),Ue.prevZ=Ue.prev,Ue.nextZ=Ue.next,Ue=Ue.next;while(Ue!==ee);Ue.prevZ.nextZ=null,Ue.prevZ=null,function(ze){var je,Ve,qe,at,pt,_t,Pt,Gt,Jt=1;do{for(Ve=ze,ze=null,pt=null,_t=0;Ve;){for(_t++,qe=Ve,Pt=0,je=0;je<Jt&&(Pt++,qe=qe.nextZ);je++);for(Gt=Jt;Pt>0||Gt>0&&qe;)Pt!==0&&(Gt===0||!qe||Ve.z<=qe.z)?(at=Ve,Ve=Ve.nextZ,Pt--):(at=qe,qe=qe.nextZ,Gt--),pt?pt.nextZ=at:ze=at,at.prevZ=pt,pt=at;Ve=qe}pt.nextZ=null,Jt*=2}while(_t>1)}(Ue)}(a,x,E,I);for(var k,H,Y=a;a.prev!==a.next;)if(k=a.prev,H=a.next,I?T9(a,x,E,I):E9(a))u.push(k.i/A),u.push(a.i/A),u.push(H.i/A),YA(a),a=H.next,Y=H.next;else if((a=H)===Y){F?F===1?XA(a=B9(mu(a),u,A),u,A,x,E,I,2):F===2&&S9(a,u,A,x,E,I):XA(mu(a),u,A,x,E,I,1);break}}}function E9(a){var u=a.prev,A=a,x=a.next;if(Oi(u,A,x)>=0)return!1;for(var E=a.next.next;E!==a.prev;){if(Fh(u.x,u.y,A.x,A.y,x.x,x.y,E.x,E.y)&&Oi(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function T9(a,u,A,x){var E=a.prev,I=a,F=a.next;if(Oi(E,I,F)>=0)return!1;for(var k=E.x>I.x?E.x>F.x?E.x:F.x:I.x>F.x?I.x:F.x,H=E.y>I.y?E.y>F.y?E.y:F.y:I.y>F.y?I.y:F.y,Y=lv(E.x<I.x?E.x<F.x?E.x:F.x:I.x<F.x?I.x:F.x,E.y<I.y?E.y<F.y?E.y:F.y:I.y<F.y?I.y:F.y,u,A,x),ee=lv(k,H,u,A,x),se=a.prevZ,he=a.nextZ;se&&se.z>=Y&&he&&he.z<=ee;){if(se!==a.prev&&se!==a.next&&Fh(E.x,E.y,I.x,I.y,F.x,F.y,se.x,se.y)&&Oi(se.prev,se,se.next)>=0||(se=se.prevZ,he!==a.prev&&he!==a.next&&Fh(E.x,E.y,I.x,I.y,F.x,F.y,he.x,he.y)&&Oi(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;se&&se.z>=Y;){if(se!==a.prev&&se!==a.next&&Fh(E.x,E.y,I.x,I.y,F.x,F.y,se.x,se.y)&&Oi(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;he&&he.z<=ee;){if(he!==a.prev&&he!==a.next&&Fh(E.x,E.y,I.x,I.y,F.x,F.y,he.x,he.y)&&Oi(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function B9(a,u,A){var x=a;do{var E=x.prev,I=x.next.next;!$g(E,I)&&XE(E,x,x.next,I)&&KA(E,I)&&KA(I,E)&&(u.push(E.i/A),u.push(x.i/A),u.push(I.i/A),YA(x),YA(x.next),x=a=I),x=x.next}while(x!==a);return mu(x)}function S9(a,u,A,x,E,I){var F=a;do{for(var k=F.next.next;k!==F.prev;){if(F.i!==k.i&&F9(F,k)){var H=KE(F,k);return F=mu(F,F.next),H=mu(H,H.next),XA(F,u,A,x,E,I),void XA(H,u,A,x,E,I)}k=k.next}F=F.next}while(F!==a)}function I9(a,u){return a.x-u.x}function M9(a,u){if(u=function(x,E){var I,F=E,k=x.x,H=x.y,Y=-1/0;do{if(H<=F.y&&H>=F.next.y&&F.next.y!==F.y){var ee=F.x+(H-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(ee<=k&&ee>Y){if(Y=ee,ee===k){if(H===F.y)return F;if(H===F.next.y)return F.next}I=F.x<F.next.x?F:F.next}}F=F.next}while(F!==E);if(!I)return null;if(k===Y)return I;var se,he=I,ve=I.x,Ue=I.y,ze=1/0;F=I;do k>=F.x&&F.x>=ve&&k!==F.x&&Fh(H<Ue?k:Y,H,ve,Ue,H<Ue?Y:k,H,F.x,F.y)&&(se=Math.abs(H-F.y)/(k-F.x),KA(F,x)&&(se<ze||se===ze&&(F.x>I.x||F.x===I.x&&P9(I,F)))&&(I=F,ze=se)),F=F.next;while(F!==he);return I}(a,u)){var A=KE(u,a);mu(u,u.next),mu(A,A.next)}}function P9(a,u){return Oi(a.prev,a,u.prev)<0&&Oi(u.next,a,a.next)<0}function lv(a,u,A,x,E){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-A)*E)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-x)*E)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function R9(a){var u=a,A=a;do(u.x<A.x||u.x===A.x&&u.y<A.y)&&(A=u),u=u.next;while(u!==a);return A}function Fh(a,u,A,x,E,I,F,k){return(E-F)*(u-k)-(a-F)*(I-k)>=0&&(a-F)*(x-k)-(A-F)*(u-k)>=0&&(A-F)*(I-k)-(E-F)*(x-k)>=0}function F9(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!function(A,x){var E=A;do{if(E.i!==A.i&&E.next.i!==A.i&&E.i!==x.i&&E.next.i!==x.i&&XE(E,E.next,A,x))return!0;E=E.next}while(E!==A);return!1}(a,u)&&(KA(a,u)&&KA(u,a)&&function(A,x){var E=A,I=!1,F=(A.x+x.x)/2,k=(A.y+x.y)/2;do E.y>k!=E.next.y>k&&E.next.y!==E.y&&F<(E.next.x-E.x)*(k-E.y)/(E.next.y-E.y)+E.x&&(I=!I),E=E.next;while(E!==A);return I}(a,u)&&(Oi(a.prev,a,u.prev)||Oi(a,u.prev,u))||$g(a,u)&&Oi(a.prev,a,a.next)>0&&Oi(u.prev,u,u.next)>0)}function Oi(a,u,A){return(u.y-a.y)*(A.x-u.x)-(u.x-a.x)*(A.y-u.y)}function $g(a,u){return a.x===u.x&&a.y===u.y}function XE(a,u,A,x){var E=Jg(Oi(a,u,A)),I=Jg(Oi(a,u,x)),F=Jg(Oi(A,x,a)),k=Jg(Oi(A,x,u));return E!==I&&F!==k||!(E!==0||!Wg(a,A,u))||!(I!==0||!Wg(a,x,u))||!(F!==0||!Wg(A,a,x))||!(k!==0||!Wg(A,u,x))}function Wg(a,u,A){return u.x<=Math.max(a.x,A.x)&&u.x>=Math.min(a.x,A.x)&&u.y<=Math.max(a.y,A.y)&&u.y>=Math.min(a.y,A.y)}function Jg(a){return a>0?1:a<0?-1:0}function KA(a,u){return Oi(a.prev,a,a.next)<0?Oi(a,u,a.next)>=0&&Oi(a,a.prev,u)>=0:Oi(a,u,a.prev)<0||Oi(a,a.next,u)<0}function KE(a,u){var A=new uv(a.i,a.x,a.y),x=new uv(u.i,u.x,u.y),E=a.next,I=u.prev;return a.next=u,u.prev=a,A.next=E,E.prev=A,x.next=A,A.prev=x,I.next=x,x.prev=I,x}function YE(a,u,A,x){var E=new uv(a,u,A);return x?(E.next=x.next,E.prev=x,x.next.prev=E,x.next=E):(E.prev=E,E.next=E),E}function YA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function uv(a,u,A){this.i=a,this.x=u,this.y=A,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fv(a,u,A,x){for(var E=0,I=u,F=A-x;I<A;I+=x)E+=(a[F]-a[I])*(a[I+1]+a[F+1]),F=I;return E}function O9(a,u,A,x,E){(function I(F,k,H,Y,ee){for(;Y>H;){if(Y-H>600){var se=Y-H+1,he=k-H+1,ve=Math.log(se),Ue=.5*Math.exp(2*ve/3),ze=.5*Math.sqrt(ve*Ue*(se-Ue)/se)*(he-se/2<0?-1:1);I(F,k,Math.max(H,Math.floor(k-he*Ue/se+ze)),Math.min(Y,Math.floor(k+(se-he)*Ue/se+ze)),ee)}var je=F[k],Ve=H,qe=Y;for(qA(F,H,k),ee(F[Y],je)>0&&qA(F,H,Y);Ve<qe;){for(qA(F,Ve,qe),Ve++,qe--;ee(F[Ve],je)<0;)Ve++;for(;ee(F[qe],je)>0;)qe--}ee(F[H],je)===0?qA(F,H,qe):qA(F,++qe,Y),qe<=k&&(H=qe+1),k<=qe&&(Y=qe-1)}})(a,u,A,x||a.length-1,E||D9)}function qA(a,u,A){var x=a[u];a[u]=a[A],a[A]=x}function D9(a,u){return a<u?-1:a>u?1:0}function hv(a,u){var A=a.length;if(A<=1)return[a];for(var x,E,I=[],F=0;F<A;F++){var k=Ye(a[F]);k!==0&&(a[F].area=Math.abs(k),E===void 0&&(E=k<0),E===k<0?(x&&I.push(x),x=[a[F]]):x.push(a[F]))}if(x&&I.push(x),u>1)for(var H=0;H<I.length;H++)I[H].length<=u||(O9(I[H],u,1,I[H].length-1,L9),I[H]=I[H].slice(0,u));return I}function L9(a,u){return u.area-a.area}function dv(a,u,A){for(var x=A.patternDependencies,E=!1,I=0,F=u;I<F.length;I+=1){var k=F[I].paint.get(a+"-pattern");k.isConstant()||(E=!0);var H=k.constantOr(null);H&&(E=!0,x[H.to]=!0,x[H.from]=!0)}return E}function Av(a,u,A,x,E){for(var I=E.patternDependencies,F=0,k=u;F<k.length;F+=1){var H=k[F],Y=H.paint.get(a+"-pattern").value;if(Y.kind!=="constant"){var ee=Y.evaluate({zoom:x-1},A,{},E.availableImages),se=Y.evaluate({zoom:x},A,{},E.availableImages),he=Y.evaluate({zoom:x+1},A,{},E.availableImages);se=se&&se.name?se.name:se,he=he&&he.name?he.name:he,I[ee=ee&&ee.name?ee.name:ee]=!0,I[se]=!0,I[he]=!0,A.patterns[H.id]={min:ee,mid:se,max:he}}}return A}jg.deviation=function(a,u,A,x){var E=u&&u.length,I=Math.abs(fv(a,0,E?u[0]*A:a.length,A));if(E)for(var F=0,k=u.length;F<k;F++)I-=Math.abs(fv(a,u[F]*A,F<k-1?u[F+1]*A:a.length,A));var H=0;for(F=0;F<x.length;F+=3){var Y=x[F]*A,ee=x[F+1]*A,se=x[F+2]*A;H+=Math.abs((a[Y]-a[se])*(a[ee+1]-a[Y+1])-(a[Y]-a[ee])*(a[se+1]-a[Y+1]))}return I===0&&H===0?0:Math.abs((H-I)/I)},jg.flatten=function(a){for(var u=a[0][0].length,A={vertices:[],holes:[],dimensions:u},x=0,E=0;E<a.length;E++){for(var I=0;I<a[E].length;I++)for(var F=0;F<u;F++)A.vertices.push(a[E][I][F]);E>0&&A.holes.push(x+=a[E-1].length)}return A},cv.default=C9;var Xa=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ks,this.indexArray=new qo,this.indexArray2=new B,this.programConfigurations=new Ir(a.layers,a.zoom),this.segments=new Q,this.segments2=new Q,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Xa.prototype.populate=function(a,u,A){this.hasPattern=dv("fill",this.layers,u);for(var x=this.layers[0].layout.get("fill-sort-key"),E=[],I=0,F=a;I<F.length;I+=1){var k=F[I],H=k.feature,Y=k.id,ee=k.index,se=k.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,ve=wi(H,he);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),ve,A)){var Ue=x?x.evaluate(ve,{},A,u.availableImages):void 0,ze={id:Y,properties:H.properties,type:H.type,sourceLayerIndex:se,index:ee,geometry:he?ve.geometry:di(H),patterns:{},sortKey:Ue};E.push(ze)}}x&&E.sort(function(Gt,Jt){return Gt.sortKey-Jt.sortKey});for(var je=0,Ve=E;je<Ve.length;je+=1){var qe=Ve[je],at=qe.geometry,pt=qe.index,_t=qe.sourceLayerIndex;if(this.hasPattern){var Pt=Av("fill",this.layers,qe,this.zoom,u);this.patternFeatures.push(Pt)}else this.addFeature(qe,at,pt,A,{});u.featureIndex.insert(a[pt].feature,at,pt,_t,this.index)}},Xa.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},Xa.prototype.addFeatures=function(a,u,A){for(var x=0,E=this.patternFeatures;x<E.length;x+=1){var I=E[x];this.addFeature(I,I.geometry,I.index,u,A)}},Xa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xa.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,w9),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},Xa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Xa.prototype.addFeature=function(a,u,A,x,E){for(var I=0,F=hv(u,500);I<F.length;I+=1){for(var k=F[I],H=0,Y=0,ee=k;Y<ee.length;Y+=1)H+=ee[Y].length;for(var se=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray),he=se.vertexLength,ve=[],Ue=[],ze=0,je=k;ze<je.length;ze+=1){var Ve=je[ze];if(Ve.length!==0){Ve!==k[0]&&Ue.push(ve.length/2);var qe=this.segments2.prepareSegment(Ve.length,this.layoutVertexArray,this.indexArray2),at=qe.vertexLength;this.layoutVertexArray.emplaceBack(Ve[0].x,Ve[0].y),this.indexArray2.emplaceBack(at+Ve.length-1,at),ve.push(Ve[0].x),ve.push(Ve[0].y);for(var pt=1;pt<Ve.length;pt++)this.layoutVertexArray.emplaceBack(Ve[pt].x,Ve[pt].y),this.indexArray2.emplaceBack(at+pt-1,at+pt),ve.push(Ve[pt].x),ve.push(Ve[pt].y);qe.vertexLength+=Ve.length,qe.primitiveLength+=Ve.length}}for(var _t=cv(ve,Ue),Pt=0;Pt<_t.length;Pt+=3)this.indexArray.emplaceBack(he+_t[Pt],he+_t[Pt+1],he+_t[Pt+2]);se.vertexLength+=H,se.primitiveLength+=_t.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,E,x)},nr("FillBucket",Xa,{omit:["layers","patternFeatures"]});var k9=new Vn({"fill-sort-key":new or(ce.layout_fill["fill-sort-key"])}),N9={paint:new Vn({"fill-antialias":new _r(ce.paint_fill["fill-antialias"]),"fill-opacity":new or(ce.paint_fill["fill-opacity"]),"fill-color":new or(ce.paint_fill["fill-color"]),"fill-outline-color":new or(ce.paint_fill["fill-outline-color"]),"fill-translate":new _r(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new _r(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new hu(ce.paint_fill["fill-pattern"])}),layout:k9},U9=function(a){function u(A){a.call(this,A,N9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(A,x){a.prototype.recalculate.call(this,A,x);var E=this.paint._values["fill-outline-color"];E.value.kind==="constant"&&E.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(A){return new Xa(A)},u.prototype.queryRadius=function(){return $i(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(A,x,E,I,F,k,H){return Zo(Ja(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,H),I)},u.prototype.isTileClipped=function(){return!0},u}(Or),z9=Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,qE=Oh;function Oh(a,u,A,x,E){this.properties={},this.extent=A,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=E,a.readFields(G9,this,u)}function G9(a,u,A){a==1?u.id=A.readVarint():a==2?function(x,E){for(var I=x.readVarint()+x.pos;x.pos<I;){var F=E._keys[x.readVarint()],k=E._values[x.readVarint()];E.properties[F]=k}}(A,u):a==3?u.type=A.readVarint():a==4&&(u._geometry=A.pos)}function V9(a){for(var u,A,x=0,E=0,I=a.length,F=I-1;E<I;F=E++)x+=((A=a[F]).x-(u=a[E]).x)*(u.y+A.y);return x}Oh.types=["Unknown","Point","LineString","Polygon"],Oh.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,A=a.readVarint()+a.pos,x=1,E=0,I=0,F=0,k=[];a.pos<A;){if(E<=0){var H=a.readVarint();x=7&H,E=H>>3}if(E--,x===1||x===2)I+=a.readSVarint(),F+=a.readSVarint(),x===1&&(u&&k.push(u),u=[]),u.push(new b(I,F));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&k.push(u),k},Oh.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,A=1,x=0,E=0,I=0,F=1/0,k=-1/0,H=1/0,Y=-1/0;a.pos<u;){if(x<=0){var ee=a.readVarint();A=7&ee,x=ee>>3}if(x--,A===1||A===2)(E+=a.readSVarint())<F&&(F=E),E>k&&(k=E),(I+=a.readSVarint())<H&&(H=I),I>Y&&(Y=I);else if(A!==7)throw new Error("unknown command "+A)}return[F,H,k,Y]},Oh.prototype.toGeoJSON=function(a,u,A){var x,E,I=this.extent*Math.pow(2,A),F=this.extent*a,k=this.extent*u,H=this.loadGeometry(),Y=Oh.types[this.type];function ee(ve){for(var Ue=0;Ue<ve.length;Ue++){var ze=ve[Ue];ve[Ue]=[360*(ze.x+F)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(ze.y+k)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var se=[];for(x=0;x<H.length;x++)se[x]=H[x][0];ee(H=se);break;case 2:for(x=0;x<H.length;x++)ee(H[x]);break;case 3:for(H=function(ve){var Ue=ve.length;if(Ue<=1)return[ve];for(var ze,je,Ve=[],qe=0;qe<Ue;qe++){var at=V9(ve[qe]);at!==0&&(je===void 0&&(je=at<0),je===at<0?(ze&&Ve.push(ze),ze=[ve[qe]]):ze.push(ve[qe]))}return ze&&Ve.push(ze),Ve}(H),x=0;x<H.length;x++)for(E=0;E<H[x].length;E++)ee(H[x][E])}H.length===1?H=H[0]:Y="Multi"+Y;var he={type:"Feature",geometry:{type:Y,coordinates:H},properties:this.properties};return"id"in this&&(he.id=this.id),he};var ZE=QE;function QE(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(H9,this,u),this.length=this._features.length}function H9(a,u,A){a===15?u.version=A.readVarint():a===1?u.name=A.readString():a===5?u.extent=A.readVarint():a===2?u._features.push(A.pos):a===3?u._keys.push(A.readString()):a===4&&u._values.push(function(x){for(var E=null,I=x.readVarint()+x.pos;x.pos<I;){var F=x.readVarint()>>3;E=F===1?x.readString():F===2?x.readFloat():F===3?x.readDouble():F===4?x.readVarint64():F===5?x.readVarint():F===6?x.readSVarint():F===7?x.readBoolean():null}return E}(A))}function j9(a,u,A){if(a===3){var x=new ZE(A,A.readVarint()+A.pos);x.length&&(u[x.name]=x)}}QE.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new qE(this._pbf,u,this.extent,this._keys,this._values)};var Dh={VectorTile:function(a,u){this.layers=a.readFields(j9,{},u)},VectorTileFeature:qE,VectorTileLayer:ZE},$9=Dh.VectorTileFeature.types,pv=Math.pow(2,13);function ZA(a,u,A,x,E,I,F,k){a.emplaceBack(u,A,2*Math.floor(x*pv)+F,E*pv*2,I*pv*2,Math.round(k))}var Ka=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new si,this.indexArray=new qo,this.programConfigurations=new Ir(a.layers,a.zoom),this.segments=new Q,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function W9(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}Ka.prototype.populate=function(a,u,A){this.features=[],this.hasPattern=dv("fill-extrusion",this.layers,u);for(var x=0,E=a;x<E.length;x+=1){var I=E[x],F=I.feature,k=I.id,H=I.index,Y=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=wi(F,ee);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),se,A)){var he={id:k,sourceLayerIndex:Y,index:H,geometry:ee?se.geometry:di(F),properties:F.properties,type:F.type,patterns:{}};this.hasPattern?this.features.push(Av("fill-extrusion",this.layers,he,this.zoom,u)):this.addFeature(he,he.geometry,H,A,{}),u.featureIndex.insert(F,he.geometry,H,Y,this.index,!0)}}},Ka.prototype.addFeatures=function(a,u,A){for(var x=0,E=this.features;x<E.length;x+=1){var I=E[x];this.addFeature(I,I.geometry,I.index,u,A)}},Ka.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},Ka.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ka.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ka.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,z9),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ka.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ka.prototype.addFeature=function(a,u,A,x,E){for(var I=0,F=hv(u,500);I<F.length;I+=1){for(var k=F[I],H=0,Y=0,ee=k;Y<ee.length;Y+=1)H+=ee[Y].length;for(var se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,ve=k;he<ve.length;he+=1){var Ue=ve[he];if(Ue.length!==0&&!((sn=Ue).every(function(jr){return jr.x<0})||sn.every(function(jr){return jr.x>8192})||sn.every(function(jr){return jr.y<0})||sn.every(function(jr){return jr.y>8192})))for(var ze=0,je=0;je<Ue.length;je++){var Ve=Ue[je];if(je>=1){var qe=Ue[je-1];if(!W9(Ve,qe)){se.vertexLength+4>Q.MAX_VERTEX_ARRAY_LENGTH&&(se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var at=Ve.sub(qe)._perp()._unit(),pt=qe.dist(Ve);ze+pt>32768&&(ze=0),ZA(this.layoutVertexArray,Ve.x,Ve.y,at.x,at.y,0,0,ze),ZA(this.layoutVertexArray,Ve.x,Ve.y,at.x,at.y,0,1,ze),ZA(this.layoutVertexArray,qe.x,qe.y,at.x,at.y,0,0,ze+=pt),ZA(this.layoutVertexArray,qe.x,qe.y,at.x,at.y,0,1,ze);var _t=se.vertexLength;this.indexArray.emplaceBack(_t,_t+2,_t+1),this.indexArray.emplaceBack(_t+1,_t+2,_t+3),se.vertexLength+=4,se.primitiveLength+=2}}}}if(se.vertexLength+H>Q.MAX_VERTEX_ARRAY_LENGTH&&(se=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray)),$9[a.type]==="Polygon"){for(var Pt=[],Gt=[],Jt=se.vertexLength,mr=0,er=k;mr<er.length;mr+=1){var br=er[mr];if(br.length!==0){br!==k[0]&&Gt.push(Pt.length/2);for(var tr=0;tr<br.length;tr++){var Zr=br[tr];ZA(this.layoutVertexArray,Zr.x,Zr.y,0,0,1,1,0),Pt.push(Zr.x),Pt.push(Zr.y)}}}for(var Mr=cv(Pt,Gt),ur=0;ur<Mr.length;ur+=3)this.indexArray.emplaceBack(Jt+Mr[ur],Jt+Mr[ur+2],Jt+Mr[ur+1]);se.primitiveLength+=Mr.length/3,se.vertexLength+=H}}var sn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,E,x)},nr("FillExtrusionBucket",Ka,{omit:["layers","features"]});var J9={paint:new Vn({"fill-extrusion-opacity":new _r(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new or(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _r(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _r(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new hu(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new or(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new or(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _r(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},X9=function(a){function u(A){a.call(this,A,J9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(A){return new Ka(A)},u.prototype.queryRadius=function(){return $i(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(A,x,E,I,F,k,H,Y){var ee=Ja(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,H),se=this.paint.get("fill-extrusion-height").evaluate(x,E),he=this.paint.get("fill-extrusion-base").evaluate(x,E),ve=function(ze,je,Ve,qe){for(var at=[],pt=0,_t=ze;pt<_t.length;pt+=1){var Pt=_t[pt],Gt=[Pt.x,Pt.y,0,1];Ph(Gt,Gt,je),at.push(new b(Gt[0]/Gt[3],Gt[1]/Gt[3]))}return at}(ee,Y),Ue=function(ze,je,Ve,qe){for(var at=[],pt=[],_t=qe[8]*je,Pt=qe[9]*je,Gt=qe[10]*je,Jt=qe[11]*je,mr=qe[8]*Ve,er=qe[9]*Ve,br=qe[10]*Ve,tr=qe[11]*Ve,Zr=0,Mr=ze;Zr<Mr.length;Zr+=1){for(var ur=[],sn=[],jr=0,An=Mr[Zr];jr<An.length;jr+=1){var xr=An[jr],_n=xr.x,Yn=xr.y,vi=qe[0]*_n+qe[4]*Yn+qe[12],Ai=qe[1]*_n+qe[5]*Yn+qe[13],qn=qe[2]*_n+qe[6]*Yn+qe[14],bi=qe[3]*_n+qe[7]*Yn+qe[15],Wi=qn+Gt,Ji=bi+Jt,Es=vi+mr,rs=Ai+er,Ts=qn+br,Ci=bi+tr,ns=new b((vi+_t)/Ji,(Ai+Pt)/Ji);ns.z=Wi/Ji,ur.push(ns);var ln=new b(Es/Ci,rs/Ci);ln.z=Ts/Ci,sn.push(ln)}at.push(ur),pt.push(sn)}return[at,pt]}(I,he,se,Y);return function(ze,je,Ve){var qe=1/0;Zo(Ve,je)&&(qe=eT(Ve,je[0]));for(var at=0;at<je.length;at++)for(var pt=je[at],_t=ze[at],Pt=0;Pt<pt.length-1;Pt++){var Gt=pt[Pt],Jt=[Gt,pt[Pt+1],_t[Pt+1],_t[Pt],Gt];Fc(Ve,Jt)&&(qe=Math.min(qe,eT(Ve,Jt)))}return qe!==1/0&&qe}(Ue[0],Ue[1],ve)},u}(Or);function QA(a,u){return a.x*u.x+a.y*u.y}function eT(a,u){if(a.length===1){for(var A,x=0,E=u[x++];!A||E.equals(A);)if(!(A=u[x++]))return 1/0;for(;x<u.length;x++){var I=u[x],F=a[0],k=A.sub(E),H=I.sub(E),Y=F.sub(E),ee=QA(k,k),se=QA(k,H),he=QA(H,H),ve=QA(Y,k),Ue=QA(Y,H),ze=ee*he-se*se,je=(he*ve-se*Ue)/ze,Ve=(ee*Ue-se*ve)/ze,qe=E.z*(1-je-Ve)+A.z*je+I.z*Ve;if(isFinite(qe))return qe}return 1/0}for(var at=1/0,pt=0,_t=u;pt<_t.length;pt+=1)at=Math.min(at,_t[pt].z);return at}var K9=Mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Y9=Mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,q9=Dh.VectorTileFeature.types,Z9=Math.cos(Math.PI/180*37.5),tT=Math.pow(2,14)/.5,zs=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(A){u.gradients[A.id]={}}),this.layoutVertexArray=new Qi,this.layoutVertexArray2=new mo,this.indexArray=new qo,this.programConfigurations=new Ir(a.layers,a.zoom),this.segments=new Q,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id})};zs.prototype.populate=function(a,u,A){this.hasPattern=dv("line",this.layers,u);for(var x=this.layers[0].layout.get("line-sort-key"),E=[],I=0,F=a;I<F.length;I+=1){var k=F[I],H=k.feature,Y=k.id,ee=k.index,se=k.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,ve=wi(H,he);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),ve,A)){var Ue=x?x.evaluate(ve,{},A):void 0,ze={id:Y,properties:H.properties,type:H.type,sourceLayerIndex:se,index:ee,geometry:he?ve.geometry:di(H),patterns:{},sortKey:Ue};E.push(ze)}}x&&E.sort(function(Gt,Jt){return Gt.sortKey-Jt.sortKey});for(var je=0,Ve=E;je<Ve.length;je+=1){var qe=Ve[je],at=qe.geometry,pt=qe.index,_t=qe.sourceLayerIndex;if(this.hasPattern){var Pt=Av("line",this.layers,qe,this.zoom,u);this.patternFeatures.push(Pt)}else this.addFeature(qe,at,pt,A,{});u.featureIndex.insert(a[pt].feature,at,pt,_t,this.index)}},zs.prototype.update=function(a,u,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,A)},zs.prototype.addFeatures=function(a,u,A){for(var x=0,E=this.patternFeatures;x<E.length;x+=1){var I=E[x];this.addFeature(I,I.geometry,I.index,u,A)}},zs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zs.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Y9)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,K9),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zs.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},zs.prototype.addFeature=function(a,u,A,x,E){var I=this.layers[0].layout,F=I.get("line-join").evaluate(a,{}),k=I.get("line-cap"),H=I.get("line-miter-limit"),Y=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var ee=0,se=u;ee<se.length;ee+=1)this.addLine(se[ee],a,F,k,H,Y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,E,x)},zs.prototype.addLine=function(a,u,A,x,E,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var F=0;F<a.length-1;F++)this.totalDistance+=a[F].dist(a[F+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var k=q9[u.type]==="Polygon",H=a.length;H>=2&&a[H-1].equals(a[H-2]);)H--;for(var Y=0;Y<H-1&&a[Y].equals(a[Y+1]);)Y++;if(!(H<(k?3:2))){A==="bevel"&&(E=1.05);var ee,se=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray),ve=void 0,Ue=void 0,ze=void 0,je=void 0;this.e1=this.e2=-1,k&&(je=a[Y].sub(ee=a[H-2])._unit()._perp());for(var Ve=Y;Ve<H;Ve++)if(!(Ue=Ve===H-1?k?a[Y+1]:void 0:a[Ve+1])||!a[Ve].equals(Ue)){je&&(ze=je),ee&&(ve=ee),ee=a[Ve],je=Ue?Ue.sub(ee)._unit()._perp():ze;var qe=(ze=ze||je).add(je);qe.x===0&&qe.y===0||qe._unit();var at=ze.x*je.x+ze.y*je.y,pt=qe.x*je.x+qe.y*je.y,_t=pt!==0?1/pt:1/0,Pt=2*Math.sqrt(2-2*pt),Gt=pt<Z9&&ve&&Ue,Jt=ze.x*je.y-ze.y*je.x>0;if(Gt&&Ve>Y){var mr=ee.dist(ve);if(mr>2*se){var er=ee.sub(ee.sub(ve)._mult(se/mr)._round());this.updateDistance(ve,er),this.addCurrentVertex(er,ze,0,0,he),ve=er}}var br=ve&&Ue,tr=br?A:k?"butt":x;if(br&&tr==="round"&&(_t<I?tr="miter":_t<=2&&(tr="fakeround")),tr==="miter"&&_t>E&&(tr="bevel"),tr==="bevel"&&(_t>2&&(tr="flipbevel"),_t<E&&(tr="miter")),ve&&this.updateDistance(ve,ee),tr==="miter")qe._mult(_t),this.addCurrentVertex(ee,qe,0,0,he);else if(tr==="flipbevel"){if(_t>100)qe=je.mult(-1);else{var Zr=_t*ze.add(je).mag()/ze.sub(je).mag();qe._perp()._mult(Zr*(Jt?-1:1))}this.addCurrentVertex(ee,qe,0,0,he),this.addCurrentVertex(ee,qe.mult(-1),0,0,he)}else if(tr==="bevel"||tr==="fakeround"){var Mr=-Math.sqrt(_t*_t-1),ur=Jt?Mr:0,sn=Jt?0:Mr;if(ve&&this.addCurrentVertex(ee,ze,ur,sn,he),tr==="fakeround")for(var jr=Math.round(180*Pt/Math.PI/20),An=1;An<jr;An++){var xr=An/jr;if(xr!==.5){var _n=xr-.5;xr+=xr*_n*(xr-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*_n*_n+(.848013+at*(.215638*at-1.06021)))}var Yn=je.sub(ze)._mult(xr)._add(ze)._unit()._mult(Jt?-1:1);this.addHalfVertex(ee,Yn.x,Yn.y,!1,Jt,0,he)}Ue&&this.addCurrentVertex(ee,je,-ur,-sn,he)}else if(tr==="butt")this.addCurrentVertex(ee,qe,0,0,he);else if(tr==="square"){var vi=ve?1:-1;this.addCurrentVertex(ee,qe,vi,vi,he)}else tr==="round"&&(ve&&(this.addCurrentVertex(ee,ze,0,0,he),this.addCurrentVertex(ee,ze,1,1,he,!0)),Ue&&(this.addCurrentVertex(ee,je,-1,-1,he,!0),this.addCurrentVertex(ee,je,0,0,he)));if(Gt&&Ve<H-1){var Ai=ee.dist(Ue);if(Ai>2*se){var qn=ee.add(Ue.sub(ee)._mult(se/Ai)._round());this.updateDistance(ee,qn),this.addCurrentVertex(qn,je,0,0,he),ee=qn}}}}},zs.prototype.addCurrentVertex=function(a,u,A,x,E,I){I===void 0&&(I=!1);var F=u.y*x-u.x,k=-u.y-u.x*x;this.addHalfVertex(a,u.x+u.y*A,u.y-u.x*A,I,!1,A,E),this.addHalfVertex(a,F,k,I,!0,-x,E),this.distance>tT/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,A,x,E,I))},zs.prototype.addHalfVertex=function(a,u,A,x,E,I,F){var k=.5*(this.lineClips?this.scaledDistance*(tT-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(E?1:0),Math.round(63*u)+128,Math.round(63*A)+128,1+(I===0?0:I<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var H=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,H),F.primitiveLength++),E?this.e2=H:this.e1=H},zs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},zs.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},nr("LineBucket",zs,{omit:["layers","patternFeatures"]});var Q9=new Vn({"line-cap":new _r(ce.layout_line["line-cap"]),"line-join":new or(ce.layout_line["line-join"]),"line-miter-limit":new _r(ce.layout_line["line-miter-limit"]),"line-round-limit":new _r(ce.layout_line["line-round-limit"]),"line-sort-key":new or(ce.layout_line["line-sort-key"])}),rT={paint:new Vn({"line-opacity":new or(ce.paint_line["line-opacity"]),"line-color":new or(ce.paint_line["line-color"]),"line-translate":new _r(ce.paint_line["line-translate"]),"line-translate-anchor":new _r(ce.paint_line["line-translate-anchor"]),"line-width":new or(ce.paint_line["line-width"]),"line-gap-width":new or(ce.paint_line["line-gap-width"]),"line-offset":new or(ce.paint_line["line-offset"]),"line-blur":new or(ce.paint_line["line-blur"]),"line-dasharray":new is(ce.paint_line["line-dasharray"]),"line-pattern":new hu(ce.paint_line["line-pattern"]),"line-gradient":new Hi(ce.paint_line["line-gradient"])}),layout:Q9},nT=new(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(A,x){return x=new kr(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,A,x)},u.prototype.evaluate=function(A,x,E,I){return x=j({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,A,x,E,I)},u}(or))(rT.paint.properties["line-width"].specification);nT.useIntegerZoom=!0;var eU=function(a){function u(A){a.call(this,A,rT),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ln,this.gradientVersion=(this.gradientVersion+1)%D)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(A,x){a.prototype.recalculate.call(this,A,x),this.paint._values["line-floorwidth"]=nT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,A)},u.prototype.createBucket=function(A){return new zs(A)},u.prototype.queryRadius=function(A){var x=A,E=iT(ba("line-width",this,x),ba("line-gap-width",this,x)),I=ba("line-offset",this,x);return E/2+Math.abs(I)+$i(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(A,x,E,I,F,k,H){var Y=Ja(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,H),ee=H/2*iT(this.paint.get("line-width").evaluate(x,E),this.paint.get("line-gap-width").evaluate(x,E)),se=this.paint.get("line-offset").evaluate(x,E);return se&&(I=function(he,ve){for(var Ue=[],ze=new b(0,0),je=0;je<he.length;je++){for(var Ve=he[je],qe=[],at=0;at<Ve.length;at++){var pt=Ve[at],_t=Ve[at+1],Pt=at===0?ze:pt.sub(Ve[at-1])._unit()._perp(),Gt=at===Ve.length-1?ze:_t.sub(pt)._unit()._perp(),Jt=Pt._add(Gt)._unit();Jt._mult(1/(Jt.x*Gt.x+Jt.y*Gt.y)),qe.push(Jt._mult(ve)._add(pt))}Ue.push(qe)}return Ue}(I,se*H)),function(he,ve,Ue){for(var ze=0;ze<ve.length;ze++){var je=ve[ze];if(he.length>=3){for(var Ve=0;Ve<je.length;Ve++)if(va(he,je[Ve]))return!0}if(Bo(he,je,Ue))return!0}return!1}(Y,I,ee)},u.prototype.isTileClipped=function(){return!0},u}(Or);function iT(a,u){return u>0?u+2*a:a}var tU=Mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rU=Mi([{name:"a_projected_pos",components:3,type:"Float32"}],4),nU=(Mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),sT=(Mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),iU=Mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function sU(a,u,A){return a.sections.forEach(function(x){x.text=function(E,I,F){var k=I.layout.get("text-transform").evaluate(F,{});return k==="uppercase"?E=E.toLocaleUpperCase():k==="lowercase"&&(E=E.toLocaleLowerCase()),qi.applyArabicShaping&&(E=qi.applyArabicShaping(E)),E}(x.text,u,A)}),a}Mi([{name:"triangle",components:3,type:"Uint16"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mi([{type:"Float32",name:"offsetX"}]),Mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ep={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},oT=function(a,u,A,x,E){var I,F,k=8*E-x-1,H=(1<<k)-1,Y=H>>1,ee=-7,se=E-1,he=-1,ve=a[u+se];for(se+=he,I=ve&(1<<-ee)-1,ve>>=-ee,ee+=k;ee>0;I=256*I+a[u+se],se+=he,ee-=8);for(F=I&(1<<-ee)-1,I>>=-ee,ee+=x;ee>0;F=256*F+a[u+se],se+=he,ee-=8);if(I===0)I=1-Y;else{if(I===H)return F?NaN:1/0*(ve?-1:1);F+=Math.pow(2,x),I-=Y}return(ve?-1:1)*F*Math.pow(2,I-x)},aT=function(a,u,A,x,E,I){var F,k,H,Y=8*I-E-1,ee=(1<<Y)-1,se=ee>>1,he=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,ve=0,Ue=1,ze=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(k=isNaN(u)?1:0,F=ee):(F=Math.floor(Math.log(u)/Math.LN2),u*(H=Math.pow(2,-F))<1&&(F--,H*=2),(u+=F+se>=1?he/H:he*Math.pow(2,1-se))*H>=2&&(F++,H/=2),F+se>=ee?(k=0,F=ee):F+se>=1?(k=(u*H-1)*Math.pow(2,E),F+=se):(k=u*Math.pow(2,se-1)*Math.pow(2,E),F=0));E>=8;a[A+ve]=255&k,ve+=Ue,k/=256,E-=8);for(F=F<<E|k,Y+=E;Y>0;a[A+ve]=255&F,ve+=Ue,F/=256,Y-=8);a[A+ve-Ue]|=128*ze},Xg=Hn;function Hn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Hn.Varint=0,Hn.Fixed64=1,Hn.Bytes=2,Hn.Fixed32=5;var cT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function El(a){return a.type===Hn.Bytes?a.readVarint()+a.pos:a.pos+1}function Lh(a,u,A){return A?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function lT(a,u,A){var x=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));A.realloc(x);for(var E=A.pos-1;E>=a;E--)A.buf[E+x]=A.buf[E]}function oU(a,u){for(var A=0;A<a.length;A++)u.writeVarint(a[A])}function aU(a,u){for(var A=0;A<a.length;A++)u.writeSVarint(a[A])}function cU(a,u){for(var A=0;A<a.length;A++)u.writeFloat(a[A])}function lU(a,u){for(var A=0;A<a.length;A++)u.writeDouble(a[A])}function uU(a,u){for(var A=0;A<a.length;A++)u.writeBoolean(a[A])}function fU(a,u){for(var A=0;A<a.length;A++)u.writeFixed32(a[A])}function hU(a,u){for(var A=0;A<a.length;A++)u.writeSFixed32(a[A])}function dU(a,u){for(var A=0;A<a.length;A++)u.writeFixed64(a[A])}function AU(a,u){for(var A=0;A<a.length;A++)u.writeSFixed64(a[A])}function Kg(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function kh(a,u,A){a[A]=u,a[A+1]=u>>>8,a[A+2]=u>>>16,a[A+3]=u>>>24}function uT(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function pU(a,u,A){a===1&&A.readMessage(gU,u)}function gU(a,u,A){if(a===3){var x=A.readMessage(mU,{}),E=x.width,I=x.height,F=x.left,k=x.top,H=x.advance;u.push({id:x.id,bitmap:new xf({width:E+6,height:I+6},x.bitmap),metrics:{width:E,height:I,left:F,top:k,advance:H}})}}function mU(a,u,A){a===1?u.id=A.readVarint():a===2?u.bitmap=A.readBytes():a===3?u.width=A.readVarint():a===4?u.height=A.readVarint():a===5?u.left=A.readSVarint():a===6?u.top=A.readSVarint():a===7&&(u.advance=A.readVarint())}function fT(a){for(var u=0,A=0,x=0,E=a;x<E.length;x+=1){var I=E[x];u+=I.w*I.h,A=Math.max(A,I.w)}a.sort(function(ze,je){return je.h-ze.h});for(var F=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),A),h:1/0}],k=0,H=0,Y=0,ee=a;Y<ee.length;Y+=1)for(var se=ee[Y],he=F.length-1;he>=0;he--){var ve=F[he];if(!(se.w>ve.w||se.h>ve.h)){if(se.x=ve.x,se.y=ve.y,H=Math.max(H,se.y+se.h),k=Math.max(k,se.x+se.w),se.w===ve.w&&se.h===ve.h){var Ue=F.pop();he<F.length&&(F[he]=Ue)}else se.h===ve.h?(ve.x+=se.w,ve.w-=se.w):se.w===ve.w?(ve.y+=se.h,ve.h-=se.h):(F.push({x:ve.x+se.w,y:ve.y,w:ve.w-se.w,h:se.h}),ve.y+=se.h,ve.h-=se.h);break}}return{w:k,h:H,fill:u/(k*H)||0}}Hn.prototype={destroy:function(){this.buf=null},readFields:function(a,u,A){for(A=A||this.length;this.pos<A;){var x=this.readVarint(),E=x>>3,I=this.pos;this.type=7&x,a(E,u,this),this.pos===I&&this.skip(x)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=Kg(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=uT(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Kg(this.buf,this.pos)+4294967296*Kg(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Kg(this.buf,this.pos)+4294967296*uT(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=oT(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=oT(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,A,x=this.buf;return u=127&(A=x[this.pos++]),A<128?u:(u|=(127&(A=x[this.pos++]))<<7,A<128?u:(u|=(127&(A=x[this.pos++]))<<14,A<128?u:(u|=(127&(A=x[this.pos++]))<<21,A<128?u:function(E,I,F){var k,H,Y=F.buf;if(k=(112&(H=Y[F.pos++]))>>4,H<128||(k|=(127&(H=Y[F.pos++]))<<3,H<128)||(k|=(127&(H=Y[F.pos++]))<<10,H<128)||(k|=(127&(H=Y[F.pos++]))<<17,H<128)||(k|=(127&(H=Y[F.pos++]))<<24,H<128)||(k|=(1&(H=Y[F.pos++]))<<31,H<128))return Lh(E,k,I);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(A=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&cT?function(A,x,E){return cT.decode(A.subarray(x,E))}(this.buf,u,a):function(A,x,E){for(var I="",F=x;F<E;){var k,H,Y,ee=A[F],se=null,he=ee>239?4:ee>223?3:ee>191?2:1;if(F+he>E)break;he===1?ee<128&&(se=ee):he===2?(192&(k=A[F+1]))==128&&(se=(31&ee)<<6|63&k)<=127&&(se=null):he===3?(H=A[F+2],(192&(k=A[F+1]))==128&&(192&H)==128&&((se=(15&ee)<<12|(63&k)<<6|63&H)<=2047||se>=55296&&se<=57343)&&(se=null)):he===4&&(H=A[F+2],Y=A[F+3],(192&(k=A[F+1]))==128&&(192&H)==128&&(192&Y)==128&&((se=(15&ee)<<18|(63&k)<<12|(63&H)<<6|63&Y)<=65535||se>=1114112)&&(se=null)),se===null?(se=65533,he=1):se>65535&&(se-=65536,I+=String.fromCharCode(se>>>10&1023|55296),se=56320|1023&se),I+=String.fromCharCode(se),F+=he}return I}(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==Hn.Bytes)return a.push(this.readVarint(u));var A=El(this);for(a=a||[];this.pos<A;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==Hn.Bytes)return a.push(this.readSVarint());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Hn.Bytes)return a.push(this.readBoolean());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Hn.Bytes)return a.push(this.readFloat());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Hn.Bytes)return a.push(this.readDouble());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Hn.Bytes)return a.push(this.readFixed32());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Hn.Bytes)return a.push(this.readSFixed32());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Hn.Bytes)return a.push(this.readFixed64());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Hn.Bytes)return a.push(this.readSFixed64());var u=El(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===Hn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Hn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Hn.Fixed32)this.pos+=4;else{if(u!==Hn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var A=new Uint8Array(u);A.set(this.buf),this.buf=A,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),kh(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),kh(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),kh(this.buf,-1&a,this.pos),kh(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),kh(this.buf,-1&a,this.pos),kh(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(u,A){var x,E;if(u>=0?(x=u%4294967296|0,E=u/4294967296|0):(E=~(-u/4294967296),4294967295^(x=~(-u%4294967296))?x=x+1|0:(x=0,E=E+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");A.realloc(10),function(I,F,k){k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,k.buf[k.pos]=127&(I>>>=7)}(x,0,A),function(I,F){var k=(7&I)<<4;F.buf[F.pos++]|=k|((I>>>=3)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I)))))}(E,A)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=function(x,E,I){for(var F,k,H=0;H<E.length;H++){if((F=E.charCodeAt(H))>55295&&F<57344){if(!k){F>56319||H+1===E.length?(x[I++]=239,x[I++]=191,x[I++]=189):k=F;continue}if(F<56320){x[I++]=239,x[I++]=191,x[I++]=189,k=F;continue}F=k-55296<<10|F-56320|65536,k=null}else k&&(x[I++]=239,x[I++]=191,x[I++]=189,k=null);F<128?x[I++]=F:(F<2048?x[I++]=F>>6|192:(F<65536?x[I++]=F>>12|224:(x[I++]=F>>18|240,x[I++]=F>>12&63|128),x[I++]=F>>6&63|128),x[I++]=63&F|128)}return I}(this.buf,a,this.pos);var A=this.pos-u;A>=128&&lT(u,A,this),this.pos=u-1,this.writeVarint(A),this.pos+=A},writeFloat:function(a){this.realloc(4),aT(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),aT(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var A=0;A<u;A++)this.buf[this.pos++]=a[A]},writeRawMessage:function(a,u){this.pos++;var A=this.pos;a(u,this);var x=this.pos-A;x>=128&&lT(A,x,this),this.pos=A-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,u,A){this.writeTag(a,Hn.Bytes),this.writeRawMessage(u,A)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,oU,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,aU,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,uU,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,cU,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,lU,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,fU,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,hU,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,dU,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,AU,u)},writeBytesField:function(a,u){this.writeTag(a,Hn.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,Hn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,Hn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,Hn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,Hn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,Hn.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,Hn.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,Hn.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,Hn.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,Hn.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var Yg=function(a,u){var A=u.pixelRatio,x=u.version,E=u.stretchX,I=u.stretchY,F=u.content;this.paddedRect=a,this.pixelRatio=A,this.stretchX=E,this.stretchY=I,this.content=F,this.version=x},tp={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};tp.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},tp.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},tp.tlbr.get=function(){return this.tl.concat(this.br)},tp.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Yg.prototype,tp);var rp=function(a,u){var A={},x={};this.haveRenderCallbacks=[];var E=[];this.addImages(a,A,E),this.addImages(u,x,E);var I=fT(E),F=new ro({width:I.w||1,height:I.h||1});for(var k in a){var H=a[k],Y=A[k].paddedRect;ro.copy(H.data,F,{x:0,y:0},{x:Y.x+1,y:Y.y+1},H.data)}for(var ee in u){var se=u[ee],he=x[ee].paddedRect,ve=he.x+1,Ue=he.y+1,ze=se.data.width,je=se.data.height;ro.copy(se.data,F,{x:0,y:0},{x:ve,y:Ue},se.data),ro.copy(se.data,F,{x:0,y:je-1},{x:ve,y:Ue-1},{width:ze,height:1}),ro.copy(se.data,F,{x:0,y:0},{x:ve,y:Ue+je},{width:ze,height:1}),ro.copy(se.data,F,{x:ze-1,y:0},{x:ve-1,y:Ue},{width:1,height:je}),ro.copy(se.data,F,{x:0,y:0},{x:ve+ze,y:Ue},{width:1,height:je})}this.image=F,this.iconPositions=A,this.patternPositions=x};rp.prototype.addImages=function(a,u,A){for(var x in a){var E=a[x],I={x:0,y:0,w:E.data.width+2,h:E.data.height+2};A.push(I),u[x]=new Yg(I,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},rp.prototype.patchUpdatedImages=function(a,u){for(var A in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[A],a.getImage(A),u),this.patchUpdatedImage(this.patternPositions[A],a.getImage(A),u)},rp.prototype.patchUpdatedImage=function(a,u,A){if(a&&u&&a.version!==u.version){a.version=u.version;var x=a.tl;A.update(u.data,void 0,{x:x[0],y:x[1]})}},nr("ImagePosition",Yg),nr("ImageAtlas",rp);var So={horizontal:1,vertical:2,horizontalOnly:3},Nh=function(){this.scale=1,this.fontStack="",this.imageName=null};Nh.forText=function(a,u){var A=new Nh;return A.scale=a||1,A.fontStack=u,A},Nh.forImage=function(a){var u=new Nh;return u.imageName=a,u};var Cs=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function qg(a,u,A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze){var je,Ve=Cs.fromFeature(a,E);se===So.vertical&&Ve.verticalizePunctuation();var qe=qi.processBidirectionalText,at=qi.processStyledBidirectionalText;if(qe&&Ve.sections.length===1){je=[];for(var pt=0,_t=qe(Ve.toString(),gv(Ve,Y,I,u,x,ve,Ue));pt<_t.length;pt+=1){var Pt=_t[pt],Gt=new Cs;Gt.text=Pt,Gt.sections=Ve.sections;for(var Jt=0;Jt<Pt.length;Jt++)Gt.sectionIndex.push(0);je.push(Gt)}}else if(at){je=[];for(var mr=0,er=at(Ve.text,Ve.sectionIndex,gv(Ve,Y,I,u,x,ve,Ue));mr<er.length;mr+=1){var br=er[mr],tr=new Cs;tr.text=br[0],tr.sectionIndex=br[1],tr.sections=Ve.sections,je.push(tr)}}else je=function(ur,sn){for(var jr=[],An=ur.text,xr=0,_n=0,Yn=sn;_n<Yn.length;_n+=1){var vi=Yn[_n];jr.push(ur.substring(xr,vi)),xr=vi}return xr<An.length&&jr.push(ur.substring(xr,An.length)),jr}(Ve,gv(Ve,Y,I,u,x,ve,Ue));var Zr=[],Mr={positionedLines:Zr,text:Ve.toString(),top:ee[1],bottom:ee[1],left:ee[0],right:ee[0],writingMode:se,iconsInText:!1,verticalizable:!1};return function(ur,sn,jr,An,xr,_n,Yn,vi,Ai,qn,bi,Wi){for(var Ji=0,Es=-17,rs=0,Ts=0,Ci=vi==="right"?1:vi==="left"?0:.5,ns=0,ln=0,On=xr;ln<On.length;ln+=1){var En=On[ln];En.trim();var mn=En.getMaxScale(),Gs=24*(mn-1),As={positionedGlyphs:[],lineOffset:0};ur.positionedLines[ns]=As;var Jn=As.positionedGlyphs,Pi=0;if(En.length()){for(var ps=0;ps<En.length();ps++){var yn=En.getSection(ps),Lc=En.getSectionIndex(ps),Io=En.getCharCode(ps),kc=0,Ei=null,Nc=null,xa=null,Wh=24,Tf=!(Ai===So.horizontal||!bi&&!lu(Io)||bi&&(Zg[Io]||(Il=Io,Kt.Arabic(Il)||Kt["Arabic Supplement"](Il)||Kt["Arabic Extended-A"](Il)||Kt["Arabic Presentation Forms-A"](Il)||Kt["Arabic Presentation Forms-B"](Il))));if(yn.imageName){var Jh=An[yn.imageName];if(!Jh)continue;xa=yn.imageName,ur.iconsInText=ur.iconsInText||!0,Nc=Jh.paddedRect;var Sl=Jh.displaySize;yn.scale=24*yn.scale/Wi,kc=Gs+(24-Sl[1]*yn.scale),Wh=(Ei={width:Sl[0],height:Sl[1],left:1,top:-3,advance:Tf?Sl[1]:Sl[0]}).advance;var Xh=Tf?Sl[0]*yn.scale-24*mn:Sl[1]*yn.scale-24*mn;Xh>0&&Xh>Pi&&(Pi=Xh)}else{var a0=jr[yn.fontStack],Kh=a0&&a0[Io];if(Kh&&Kh.rect)Nc=Kh.rect,Ei=Kh.metrics;else{var sp=sn[yn.fontStack],c0=sp&&sp[Io];if(!c0)continue;Ei=c0.metrics}kc=24*(mn-yn.scale)}Tf?(ur.verticalizable=!0,Jn.push({glyph:Io,imageName:xa,x:Ji,y:Es+kc,vertical:Tf,scale:yn.scale,fontStack:yn.fontStack,sectionIndex:Lc,metrics:Ei,rect:Nc}),Ji+=Wh*yn.scale+qn):(Jn.push({glyph:Io,imageName:xa,x:Ji,y:Es+kc,vertical:Tf,scale:yn.scale,fontStack:yn.fontStack,sectionIndex:Lc,metrics:Ei,rect:Nc}),Ji+=Ei.advance*yn.scale+qn)}Jn.length!==0&&(rs=Math.max(Ji-qn,rs),yU(Jn,0,Jn.length-1,Ci,Pi)),Ji=0;var l0=_n*mn+Pi;As.lineOffset=Math.max(Pi,Gs),Es+=l0,Ts=Math.max(l0,Ts),++ns}else Es+=_n,++ns}var Il,op=Es- -17,Yh=mv(Yn),yu=Yh.horizontalAlign,qh=Yh.verticalAlign;(function(u0,f0,ap,cp,h0,lp,up,fp,d0){var Zh,A0=(f0-ap)*h0;Zh=lp!==up?-fp*cp- -17:(-cp*d0+.5)*up;for(var Qh=0,hp=u0;Qh<hp.length;Qh+=1)for(var Bf=0,dp=hp[Qh].positionedGlyphs;Bf<dp.length;Bf+=1){var ed=dp[Bf];ed.x+=A0,ed.y+=Zh}})(ur.positionedLines,Ci,yu,qh,rs,Ts,_n,op,xr.length),ur.top+=-qh*op,ur.bottom=ur.top+op,ur.left+=-yu*rs,ur.right=ur.left+rs}(Mr,u,A,x,je,F,k,H,se,Y,he,ze),!function(ur){for(var sn=0,jr=ur;sn<jr.length;sn+=1)if(jr[sn].positionedGlyphs.length!==0)return!1;return!0}(Zr)&&Mr}Cs.fromFeature=function(a,u){for(var A=new Cs,x=0;x<a.sections.length;x++){var E=a.sections[x];E.image?A.addImageSection(E):A.addTextSection(E,u)}return A},Cs.prototype.length=function(){return this.text.length},Cs.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Cs.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Cs.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Cs.prototype.verticalizePunctuation=function(){this.text=function(a){for(var u="",A=0;A<a.length;A++){var x=a.charCodeAt(A+1)||null,E=a.charCodeAt(A-1)||null;u+=x&&Af(x)&&!ep[a[A+1]]||E&&Af(E)&&!ep[a[A-1]]||!ep[a[A]]?a[A]:ep[a[A]]}return u}(this.text)},Cs.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&Zg[this.text.charCodeAt(u)];u++)a++;for(var A=this.text.length,x=this.text.length-1;x>=0&&x>=a&&Zg[this.text.charCodeAt(x)];x--)A--;this.text=this.text.substring(a,A),this.sectionIndex=this.sectionIndex.slice(a,A)},Cs.prototype.substring=function(a,u){var A=new Cs;return A.text=this.text.substring(a,u),A.sectionIndex=this.sectionIndex.slice(a,u),A.sections=this.sections,A},Cs.prototype.toString=function(){return this.text},Cs.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,A){return Math.max(u,a.sections[A].scale)},0)},Cs.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(Nh.forText(a.scale,a.fontStack||u));for(var A=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(A)},Cs.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var A=this.getNextImageSectionCharCode();A?(this.text+=String.fromCharCode(A),this.sections.push(Nh.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ne("Reached maximum number of images 6401")}else ne("Can't add FormattedSection with an empty image.")},Cs.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Zg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vo={};function hT(a,u,A,x,E,I){if(u.imageName){var F=x[u.imageName];return F?F.displaySize[0]*u.scale*24/I+E:0}var k=A[u.fontStack],H=k&&k[a];return H?H.metrics.advance*u.scale+E:0}function dT(a,u,A,x){var E=Math.pow(a-u,2);return x?a<u?E/2:2*E:E+Math.abs(A)*A}function _U(a,u,A){var x=0;return a===10&&(x-=1e4),A&&(x+=150),a!==40&&a!==65288||(x+=50),u!==41&&u!==65289||(x+=50),x}function AT(a,u,A,x,E,I){for(var F=null,k=dT(u,A,E,I),H=0,Y=x;H<Y.length;H+=1){var ee=Y[H],se=dT(u-ee.x,A,E,I)+ee.badness;se<=k&&(F=ee,k=se)}return{index:a,x:u,priorBreak:F,badness:k}}function gv(a,u,A,x,E,I,F){if(I!=="point")return[];if(!a)return[];for(var k,H=[],Y=function(je,Ve,qe,at,pt,_t){for(var Pt=0,Gt=0;Gt<je.length();Gt++){var Jt=je.getSection(Gt);Pt+=hT(je.getCharCode(Gt),Jt,at,pt,Ve,_t)}return Pt/Math.max(1,Math.ceil(Pt/qe))}(a,u,A,x,E,F),ee=a.text.indexOf("​")>=0,se=0,he=0;he<a.length();he++){var ve=a.getSection(he),Ue=a.getCharCode(he);if(Zg[Ue]||(se+=hT(Ue,ve,x,E,u,F)),he<a.length()-1){var ze=!((k=Ue)<11904||!(Kt["Bopomofo Extended"](k)||Kt.Bopomofo(k)||Kt["CJK Compatibility Forms"](k)||Kt["CJK Compatibility Ideographs"](k)||Kt["CJK Compatibility"](k)||Kt["CJK Radicals Supplement"](k)||Kt["CJK Strokes"](k)||Kt["CJK Symbols and Punctuation"](k)||Kt["CJK Unified Ideographs Extension A"](k)||Kt["CJK Unified Ideographs"](k)||Kt["Enclosed CJK Letters and Months"](k)||Kt["Halfwidth and Fullwidth Forms"](k)||Kt.Hiragana(k)||Kt["Ideographic Description Characters"](k)||Kt["Kangxi Radicals"](k)||Kt["Katakana Phonetic Extensions"](k)||Kt.Katakana(k)||Kt["Vertical Forms"](k)||Kt["Yi Radicals"](k)||Kt["Yi Syllables"](k)));(vo[Ue]||ze||ve.imageName)&&H.push(AT(he+1,se,Y,H,_U(Ue,a.getCharCode(he+1),ze&&ee),!1))}}return function je(Ve){return Ve?je(Ve.priorBreak).concat(Ve.index):[]}(AT(a.length(),se,Y,H,0,!0))}function mv(a){var u=.5,A=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:u,verticalAlign:A}}function yU(a,u,A,x,E){if(x||E)for(var I=a[A],F=(a[A].x+I.metrics.advance*I.scale)*x,k=u;k<=A;k++)a[k].x-=F,a[k].y+=E}function pT(a,u,A,x,E,I){var F,k=a.image;if(k.content){var H=k.content,Y=k.pixelRatio||1;F=[H[0]/Y,H[1]/Y,k.displaySize[0]-H[2]/Y,k.displaySize[1]-H[3]/Y]}var ee,se,he,ve,Ue=u.left*I,ze=u.right*I;A==="width"||A==="both"?(ve=E[0]+Ue-x[3],se=E[0]+ze+x[1]):se=(ve=E[0]+(Ue+ze-k.displaySize[0])/2)+k.displaySize[0];var je=u.top*I,Ve=u.bottom*I;return A==="height"||A==="both"?(ee=E[1]+je-x[0],he=E[1]+Ve+x[2]):he=(ee=E[1]+(je+Ve-k.displaySize[1])/2)+k.displaySize[1],{image:k,top:ee,right:se,bottom:he,left:ve,collisionPadding:F}}vo[10]=!0,vo[32]=!0,vo[38]=!0,vo[40]=!0,vo[41]=!0,vo[43]=!0,vo[45]=!0,vo[47]=!0,vo[173]=!0,vo[183]=!0,vo[8203]=!0,vo[8208]=!0,vo[8211]=!0,vo[8231]=!0;var Uh=function(a){function u(A,x,E,I){a.call(this,A,x),this.angle=E,I!==void 0&&(this.segment=I)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(b);function _v(a,u){var A=u.expression;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new kr(a+1))};if(A.kind==="source")return{kind:"source"};for(var x=A.zoomStops,E=A.interpolationType,I=0;I<x.length&&x[I]<=a;)I++;for(var F=I=Math.max(0,I-1);F<x.length&&x[F]<a+1;)F++;F=Math.min(x.length-1,F);var k=x[I],H=x[F];return A.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:H,interpolationType:E}:{kind:"camera",minZoom:k,maxZoom:H,minSize:A.evaluate(new kr(k)),maxSize:A.evaluate(new kr(H)),interpolationType:E}}function gT(a,u,A){var x=u.uSize,E=A.lowerSize;return a.kind==="source"?E/128:a.kind==="composite"?ii(E/128,A.upperSize/128,u.uSizeT):x}function mT(a,u){var A=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var E=a.interpolationType,I=E?W(Fi.interpolationFactor(E,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=ii(a.minSize,a.maxSize,I):A=I}return{uSizeT:A,uSize:x}}nr("Anchor",Uh);var vU=Object.freeze({__proto__:null,getSizeData:_v,evaluateSizeForFeature:gT,evaluateSizeForZoom:mT,SIZE_PACK_FACTOR:128});function _T(a,u,A,x,E){if(u.segment===void 0)return!0;for(var I=u,F=u.segment+1,k=0;k>-A/2;){if(--F<0)return!1;k-=a[F].dist(I),I=a[F]}k+=a[F].dist(a[F+1]),F++;for(var H=[],Y=0;k<A/2;){var ee=a[F],se=a[F+1];if(!se)return!1;var he=a[F-1].angleTo(ee)-ee.angleTo(se);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),H.push({distance:k,angleDelta:he}),Y+=he;k-H[0].distance>x;)Y-=H.shift().angleDelta;if(Y>E)return!1;F++,k+=ee.dist(se)}return!0}function yT(a){for(var u=0,A=0;A<a.length-1;A++)u+=a[A].dist(a[A+1]);return u}function vT(a,u,A){return a?.6*u*A:0}function bT(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function bU(a,u,A,x,E,I){for(var F=vT(A,E,I),k=bT(A,x)*I,H=0,Y=yT(a)/2,ee=0;ee<a.length-1;ee++){var se=a[ee],he=a[ee+1],ve=se.dist(he);if(H+ve>Y){var Ue=(Y-H)/ve,ze=ii(se.x,he.x,Ue),je=ii(se.y,he.y,Ue),Ve=new Uh(ze,je,he.angleTo(se),ee);return Ve._round(),!F||_T(a,Ve,k,F,u)?Ve:void 0}H+=ve}}function xU(a,u,A,x,E,I,F,k,H){var Y=vT(x,I,F),ee=bT(x,E),se=ee*F,he=a[0].x===0||a[0].x===H||a[0].y===0||a[0].y===H;return u-se<u/4&&(u=se+u/4),function ve(Ue,ze,je,Ve,qe,at,pt,_t,Pt){for(var Gt=at/2,Jt=yT(Ue),mr=0,er=ze-je,br=[],tr=0;tr<Ue.length-1;tr++){for(var Zr=Ue[tr],Mr=Ue[tr+1],ur=Zr.dist(Mr),sn=Mr.angleTo(Zr);er+je<mr+ur;){var jr=((er+=je)-mr)/ur,An=ii(Zr.x,Mr.x,jr),xr=ii(Zr.y,Mr.y,jr);if(An>=0&&An<Pt&&xr>=0&&xr<Pt&&er-Gt>=0&&er+Gt<=Jt){var _n=new Uh(An,xr,sn,tr);_n._round(),Ve&&!_T(Ue,_n,at,Ve,qe)||br.push(_n)}}mr+=ur}return _t||br.length||pt||(br=ve(Ue,mr/2,je,Ve,qe,at,pt,!0,Pt)),br}(a,he?u/2*k%u:(ee/2+2*I)*F*k%u,u,Y,A,se,he,!1,H)}function xT(a,u,A,x,E){for(var I=[],F=0;F<a.length;F++)for(var k=a[F],H=void 0,Y=0;Y<k.length-1;Y++){var ee=k[Y],se=k[Y+1];ee.x<u&&se.x<u||(ee.x<u?ee=new b(u,ee.y+(u-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round():se.x<u&&(se=new b(u,ee.y+(u-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round()),ee.y<A&&se.y<A||(ee.y<A?ee=new b(ee.x+(A-ee.y)/(se.y-ee.y)*(se.x-ee.x),A)._round():se.y<A&&(se=new b(ee.x+(A-ee.y)/(se.y-ee.y)*(se.x-ee.x),A)._round()),ee.x>=x&&se.x>=x||(ee.x>=x?ee=new b(x,ee.y+(x-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round():se.x>=x&&(se=new b(x,ee.y+(x-ee.x)/(se.x-ee.x)*(se.y-ee.y))._round()),ee.y>=E&&se.y>=E||(ee.y>=E?ee=new b(ee.x+(E-ee.y)/(se.y-ee.y)*(se.x-ee.x),E)._round():se.y>=E&&(se=new b(ee.x+(E-ee.y)/(se.y-ee.y)*(se.x-ee.x),E)._round()),H&&ee.equals(H[H.length-1])||I.push(H=[ee]),H.push(se)))))}return I}function wT(a,u,A,x){var E=[],I=a.image,F=I.pixelRatio,k=I.paddedRect.w-2,H=I.paddedRect.h-2,Y=a.right-a.left,ee=a.bottom-a.top,se=I.stretchX||[[0,k]],he=I.stretchY||[[0,H]],ve=function(An,xr){return An+xr[1]-xr[0]},Ue=se.reduce(ve,0),ze=he.reduce(ve,0),je=k-Ue,Ve=H-ze,qe=0,at=Ue,pt=0,_t=ze,Pt=0,Gt=je,Jt=0,mr=Ve;if(I.content&&x){var er=I.content;qe=Qg(se,0,er[0]),pt=Qg(he,0,er[1]),at=Qg(se,er[0],er[2]),_t=Qg(he,er[1],er[3]),Pt=er[0]-qe,Jt=er[1]-pt,Gt=er[2]-er[0]-at,mr=er[3]-er[1]-_t}var br=function(An,xr,_n,Yn){var vi=e0(An.stretch-qe,at,Y,a.left),Ai=t0(An.fixed-Pt,Gt,An.stretch,Ue),qn=e0(xr.stretch-pt,_t,ee,a.top),bi=t0(xr.fixed-Jt,mr,xr.stretch,ze),Wi=e0(_n.stretch-qe,at,Y,a.left),Ji=t0(_n.fixed-Pt,Gt,_n.stretch,Ue),Es=e0(Yn.stretch-pt,_t,ee,a.top),rs=t0(Yn.fixed-Jt,mr,Yn.stretch,ze),Ts=new b(vi,qn),Ci=new b(Wi,qn),ns=new b(Wi,Es),ln=new b(vi,Es),On=new b(Ai/F,bi/F),En=new b(Ji/F,rs/F),mn=u*Math.PI/180;if(mn){var Gs=Math.sin(mn),As=Math.cos(mn),Jn=[As,-Gs,Gs,As];Ts._matMult(Jn),Ci._matMult(Jn),ln._matMult(Jn),ns._matMult(Jn)}var Pi=An.stretch+An.fixed,ps=xr.stretch+xr.fixed;return{tl:Ts,tr:Ci,bl:ln,br:ns,tex:{x:I.paddedRect.x+1+Pi,y:I.paddedRect.y+1+ps,w:_n.stretch+_n.fixed-Pi,h:Yn.stretch+Yn.fixed-ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:On,pixelOffsetBR:En,minFontScaleX:Gt/F/Y,minFontScaleY:mr/F/ee,isSDF:A}};if(x&&(I.stretchX||I.stretchY))for(var tr=CT(se,je,Ue),Zr=CT(he,Ve,ze),Mr=0;Mr<tr.length-1;Mr++)for(var ur=tr[Mr],sn=tr[Mr+1],jr=0;jr<Zr.length-1;jr++)E.push(br(ur,Zr[jr],sn,Zr[jr+1]));else E.push(br({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:H+1}));return E}function Qg(a,u,A){for(var x=0,E=0,I=a;E<I.length;E+=1){var F=I[E];x+=Math.max(u,Math.min(A,F[1]))-Math.max(u,Math.min(A,F[0]))}return x}function CT(a,u,A){for(var x=[{fixed:-1,stretch:0}],E=0,I=a;E<I.length;E+=1){var F=I[E],k=F[0],H=F[1],Y=x[x.length-1];x.push({fixed:k-Y.stretch,stretch:Y.stretch}),x.push({fixed:k-Y.stretch,stretch:Y.stretch+(H-k)})}return x.push({fixed:u+1,stretch:A}),x}function e0(a,u,A,x){return a/u*A+x}function t0(a,u,A,x){return a-u*A/x}var r0=function(a,u,A,x,E,I,F,k,H,Y){if(this.boxStartIndex=a.length,H){var ee=I.top,se=I.bottom,he=I.collisionPadding;he&&(ee-=he[1],se+=he[3]);var ve=se-ee;ve>0&&(ve=Math.max(10,ve),this.circleDiameter=ve)}else{var Ue=I.top*F-k,ze=I.bottom*F+k,je=I.left*F-k,Ve=I.right*F+k,qe=I.collisionPadding;if(qe&&(je-=qe[0]*F,Ue-=qe[1]*F,Ve+=qe[2]*F,ze+=qe[3]*F),Y){var at=new b(je,Ue),pt=new b(Ve,Ue),_t=new b(je,ze),Pt=new b(Ve,ze),Gt=Y*Math.PI/180;at._rotate(Gt),pt._rotate(Gt),_t._rotate(Gt),Pt._rotate(Gt),je=Math.min(at.x,pt.x,_t.x,Pt.x),Ve=Math.max(at.x,pt.x,_t.x,Pt.x),Ue=Math.min(at.y,pt.y,_t.y,Pt.y),ze=Math.max(at.y,pt.y,_t.y,Pt.y)}a.emplaceBack(u.x,u.y,je,Ue,Ve,ze,A,x,E)}this.boxEndIndex=a.length},zh=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=wU),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var A=(this.length>>1)-1;A>=0;A--)this._down(A)};function wU(a,u){return a<u?-1:a>u?1:0}function CU(a,u,A){A===void 0&&(A=!1);for(var x=1/0,E=1/0,I=-1/0,F=-1/0,k=a[0],H=0;H<k.length;H++){var Y=k[H];(!H||Y.x<x)&&(x=Y.x),(!H||Y.y<E)&&(E=Y.y),(!H||Y.x>I)&&(I=Y.x),(!H||Y.y>F)&&(F=Y.y)}var ee=Math.min(I-x,F-E),se=ee/2,he=new zh([],EU);if(ee===0)return new b(x,E);for(var ve=x;ve<I;ve+=ee)for(var Ue=E;Ue<F;Ue+=ee)he.push(new Gh(ve+se,Ue+se,se,a));for(var ze=function(qe){for(var at=0,pt=0,_t=0,Pt=qe[0],Gt=0,Jt=Pt.length,mr=Jt-1;Gt<Jt;mr=Gt++){var er=Pt[Gt],br=Pt[mr],tr=er.x*br.y-br.x*er.y;pt+=(er.x+br.x)*tr,_t+=(er.y+br.y)*tr,at+=3*tr}return new Gh(pt/at,_t/at,0,qe)}(a),je=he.length;he.length;){var Ve=he.pop();(Ve.d>ze.d||!ze.d)&&(ze=Ve,A&&console.log("found best %d after %d probes",Math.round(1e4*Ve.d)/1e4,je)),Ve.max-ze.d<=u||(he.push(new Gh(Ve.p.x-(se=Ve.h/2),Ve.p.y-se,se,a)),he.push(new Gh(Ve.p.x+se,Ve.p.y-se,se,a)),he.push(new Gh(Ve.p.x-se,Ve.p.y+se,se,a)),he.push(new Gh(Ve.p.x+se,Ve.p.y+se,se,a)),je+=4)}return A&&(console.log("num probes: "+je),console.log("best distance: "+ze.d)),ze.p}function EU(a,u){return u.max-a.max}function Gh(a,u,A,x){this.p=new b(a,u),this.h=A,this.d=function(E,I){for(var F=!1,k=1/0,H=0;H<I.length;H++)for(var Y=I[H],ee=0,se=Y.length,he=se-1;ee<se;he=ee++){var ve=Y[ee],Ue=Y[he];ve.y>E.y!=Ue.y>E.y&&E.x<(Ue.x-ve.x)*(E.y-ve.y)/(Ue.y-ve.y)+ve.x&&(F=!F),k=Math.min(k,pu(E,ve,Ue))}return(F?1:-1)*Math.sqrt(k)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}zh.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},zh.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},zh.prototype.peek=function(){return this.data[0]},zh.prototype._up=function(a){for(var u=this.data,A=this.compare,x=u[a];a>0;){var E=a-1>>1,I=u[E];if(A(x,I)>=0)break;u[a]=I,a=E}u[a]=x},zh.prototype._down=function(a){for(var u=this.data,A=this.compare,x=this.length>>1,E=u[a];a<x;){var I=1+(a<<1),F=u[I],k=I+1;if(k<this.length&&A(u[k],F)<0&&(I=k,F=u[k]),A(F,E)>=0)break;u[a]=F,a=I}u[a]=E};var yv=Number.POSITIVE_INFINITY;function ET(a,u){return u[1]!==yv?function(A,x,E){var I=0,F=0;switch(x=Math.abs(x),E=Math.abs(E),A){case"top-right":case"top-left":case"top":F=E-7;break;case"bottom-right":case"bottom-left":case"bottom":F=7-E}switch(A){case"top-right":case"bottom-right":case"right":I=-x;break;case"top-left":case"bottom-left":case"left":I=x}return[I,F]}(a,u[0],u[1]):function(A,x){var E=0,I=0;x<0&&(x=0);var F=x/Math.sqrt(2);switch(A){case"top-right":case"top-left":I=F-7;break;case"bottom-right":case"bottom-left":I=7-F;break;case"bottom":I=7-x;break;case"top":I=x-7}switch(A){case"top-right":case"bottom-right":E=-F;break;case"top-left":case"bottom-left":E=F;break;case"left":E=x;break;case"right":E=-x}return[E,I]}(a,u[0])}function vv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function TT(a,u,A,x,E,I,F,k,H,Y,ee,se,he,ve,Ue){var ze=function(pt,_t,Pt,Gt,Jt,mr,er,br){for(var tr=Gt.layout.get("text-rotate").evaluate(mr,{})*Math.PI/180,Zr=[],Mr=0,ur=_t.positionedLines;Mr<ur.length;Mr+=1)for(var sn=ur[Mr],jr=0,An=sn.positionedGlyphs;jr<An.length;jr+=1){var xr=An[jr];if(xr.rect){var _n=xr.rect||{},Yn=4,vi=!0,Ai=1,qn=0,bi=(Jt||br)&&xr.vertical,Wi=xr.metrics.advance*xr.scale/2;if(br&&_t.verticalizable&&(qn=sn.lineOffset/2-(xr.imageName?-(24-xr.metrics.width*xr.scale)/2:24*(xr.scale-1))),xr.imageName){var Ji=er[xr.imageName];vi=Ji.sdf,Yn=1/(Ai=Ji.pixelRatio)}var Es=Jt?[xr.x+Wi,xr.y]:[0,0],rs=Jt?[0,0]:[xr.x+Wi+Pt[0],xr.y+Pt[1]-qn],Ts=[0,0];bi&&(Ts=rs,rs=[0,0]);var Ci=(xr.metrics.left-Yn)*xr.scale-Wi+rs[0],ns=(-xr.metrics.top-Yn)*xr.scale+rs[1],ln=Ci+_n.w*xr.scale/Ai,On=ns+_n.h*xr.scale/Ai,En=new b(Ci,ns),mn=new b(ln,ns),Gs=new b(Ci,On),As=new b(ln,On);if(bi){var Jn=new b(-Wi,Wi- -17),Pi=-Math.PI/2,ps=12-Wi,yn=new b(22-ps,-(xr.imageName?ps:0)),Lc=new(Function.prototype.bind.apply(b,[null].concat(Ts)));En._rotateAround(Pi,Jn)._add(yn)._add(Lc),mn._rotateAround(Pi,Jn)._add(yn)._add(Lc),Gs._rotateAround(Pi,Jn)._add(yn)._add(Lc),As._rotateAround(Pi,Jn)._add(yn)._add(Lc)}if(tr){var Io=Math.sin(tr),kc=Math.cos(tr),Ei=[kc,-Io,Io,kc];En._matMult(Ei),mn._matMult(Ei),Gs._matMult(Ei),As._matMult(Ei)}var Nc=new b(0,0),xa=new b(0,0);Zr.push({tl:En,tr:mn,bl:Gs,br:As,tex:_n,writingMode:_t.writingMode,glyphOffset:Es,sectionIndex:xr.sectionIndex,isSDF:vi,pixelOffsetTL:Nc,pixelOffsetBR:xa,minFontScaleX:0,minFontScaleY:0})}}return Zr}(0,A,k,E,I,F,x,a.allowVerticalPlacement),je=a.textSizeData,Ve=null;je.kind==="source"?(Ve=[128*E.layout.get("text-size").evaluate(F,{})])[0]>32640&&ne(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):je.kind==="composite"&&((Ve=[128*ve.compositeTextSizes[0].evaluate(F,{},Ue),128*ve.compositeTextSizes[1].evaluate(F,{},Ue)])[0]>32640||Ve[1]>32640)&&ne(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,ze,Ve,k,I,F,Y,u,H.lineStartIndex,H.lineLength,he,Ue);for(var qe=0,at=ee;qe<at.length;qe+=1)se[at[qe]]=a.text.placedSymbolArray.length-1;return 4*ze.length}function BT(a){for(var u in a)return a[u];return null}function TU(a,u,A,x){var E=a.compareText;if(u in E){for(var I=E[u],F=I.length-1;F>=0;F--)if(x.dist(I[F])<A)return!0}else E[u]=[];return E[u].push(x),!1}var BU=Dh.VectorTileFeature.types,SU=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function n0(a,u,A,x,E,I,F,k,H,Y,ee,se,he){var ve=k?Math.min(32640,Math.round(k[0])):0,Ue=k?Math.min(32640,Math.round(k[1])):0;a.emplaceBack(u,A,Math.round(32*x),Math.round(32*E),I,F,(ve<<1)+(H?1:0),Ue,16*Y,16*ee,256*se,256*he)}function bv(a,u,A){a.emplaceBack(u.x,u.y,A),a.emplaceBack(u.x,u.y,A),a.emplaceBack(u.x,u.y,A),a.emplaceBack(u.x,u.y,A)}function IU(a){for(var u=0,A=a.sections;u<A.length;u+=1)if(uu(A[u].text))return!0;return!1}var Vh=function(a){this.layoutVertexArray=new jt,this.indexArray=new qo,this.programConfigurations=a,this.segments=new Q,this.dynamicLayoutVertexArray=new Zt,this.opacityVertexArray=new Rc,this.placedSymbolArray=new g};Vh.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Vh.prototype.upload=function(a,u,A,x){this.isEmpty()||(A&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,tU.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,rU.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,SU,!0),this.opacityVertexBuffer.itemSize=1),(A||x)&&this.programConfigurations.upload(a))},Vh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},nr("SymbolBuffers",Vh);var np=function(a,u,A){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new A,this.segments=new Q,this.collisionVertexArray=new Yo};np.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,nU.members,!0)},np.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},nr("CollisionBuffers",np);var In=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yo([]),this.placementViewportMatrix=yo([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_v(this.zoom,u["text-size"]),this.iconSizeData=_v(this.zoom,u["icon-size"]);var A=this.layers[0].layout,x=A.get("symbol-sort-key"),E=A.get("symbol-z-order");this.canOverlap=A.get("text-allow-overlap")||A.get("icon-allow-overlap")||A.get("text-ignore-placement")||A.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,A.get("symbol-placement")==="point"&&(this.writingModes=A.get("text-writing-mode").map(function(I){return So[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};In.prototype.createArrays=function(){this.text=new Vh(new Ir(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Vh(new Ir(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new R,this.lineVertexArray=new L,this.symbolInstances=new P},In.prototype.calculateGlyphDependencies=function(a,u,A,x,E){for(var I=0;I<a.length;I++)if(u[a.charCodeAt(I)]=!0,(A||x)&&E){var F=ep[a.charAt(I)];F&&(u[F.charCodeAt(0)]=!0)}},In.prototype.populate=function(a,u,A){var x=this.layers[0],E=x.layout,I=E.get("text-font"),F=E.get("text-field"),k=E.get("icon-image"),H=(F.value.kind!=="constant"||F.value.value instanceof ti&&!F.value.value.isEmpty()||F.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),Y=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,ee=E.get("symbol-sort-key");if(this.features=[],H||Y){for(var se=u.iconDependencies,he=u.glyphDependencies,ve=u.availableImages,Ue=new kr(this.zoom),ze=0,je=a;ze<je.length;ze+=1){var Ve=je[ze],qe=Ve.feature,at=Ve.id,pt=Ve.index,_t=Ve.sourceLayerIndex,Pt=x._featureFilter.needGeometry,Gt=wi(qe,Pt);if(x._featureFilter.filter(Ue,Gt,A)){Pt||(Gt.geometry=di(qe));var Jt=void 0;if(H){var mr=x.getValueAndResolveTokens("text-field",Gt,A,ve),er=ti.factory(mr);IU(er)&&(this.hasRTLText=!0),(!this.hasRTLText||gf()==="unavailable"||this.hasRTLText&&qi.isParsed())&&(Jt=sU(er,x,Gt))}var br=void 0;if(Y){var tr=x.getValueAndResolveTokens("icon-image",Gt,A,ve);br=tr instanceof Un?tr:Un.fromString(tr)}if(Jt||br){var Zr=this.sortFeaturesByKey?ee.evaluate(Gt,{},A):void 0;if(this.features.push({id:at,text:Jt,icon:br,index:pt,sourceLayerIndex:_t,geometry:Gt.geometry,properties:qe.properties,type:BU[qe.type],sortKey:Zr}),br&&(se[br.name]=!0),Jt){var Mr=I.evaluate(Gt,{},A).join(","),ur=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(So.vertical)>=0;for(var sn=0,jr=Jt.sections;sn<jr.length;sn+=1){var An=jr[sn];if(An.image)se[An.image.name]=!0;else{var xr=df(Jt.toString()),_n=An.fontStack||Mr,Yn=he[_n]=he[_n]||{};this.calculateGlyphDependencies(An.text,Yn,ur,this.allowVerticalPlacement,xr)}}}}}}E.get("symbol-placement")==="line"&&(this.features=function(vi){var Ai={},qn={},bi=[],Wi=0;function Ji(Jn){bi.push(vi[Jn]),Wi++}function Es(Jn,Pi,ps){var yn=qn[Jn];return delete qn[Jn],qn[Pi]=yn,bi[yn].geometry[0].pop(),bi[yn].geometry[0]=bi[yn].geometry[0].concat(ps[0]),yn}function rs(Jn,Pi,ps){var yn=Ai[Pi];return delete Ai[Pi],Ai[Jn]=yn,bi[yn].geometry[0].shift(),bi[yn].geometry[0]=ps[0].concat(bi[yn].geometry[0]),yn}function Ts(Jn,Pi,ps){var yn=ps?Pi[0][Pi[0].length-1]:Pi[0][0];return Jn+":"+yn.x+":"+yn.y}for(var Ci=0;Ci<vi.length;Ci++){var ns=vi[Ci],ln=ns.geometry,On=ns.text?ns.text.toString():null;if(On){var En=Ts(On,ln),mn=Ts(On,ln,!0);if(En in qn&&mn in Ai&&qn[En]!==Ai[mn]){var Gs=rs(En,mn,ln),As=Es(En,mn,bi[Gs].geometry);delete Ai[En],delete qn[mn],qn[Ts(On,bi[As].geometry,!0)]=As,bi[Gs].geometry=null}else En in qn?Es(En,mn,ln):mn in Ai?rs(En,mn,ln):(Ji(Ci),Ai[En]=Wi-1,qn[mn]=Wi-1)}else Ji(Ci)}return bi.filter(function(Jn){return Jn.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(vi,Ai){return vi.sortKey-Ai.sortKey})}},In.prototype.update=function(a,u,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,A),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,A))},In.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},In.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},In.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},In.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},In.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},In.prototype.addToLineVertexArray=function(a,u){var A=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(u[a.segment+1]),E=a.dist(u[a.segment]),I={},F=a.segment+1;F<u.length;F++)I[F]={x:u[F].x,y:u[F].y,tileUnitDistanceFromAnchor:x},F<u.length-1&&(x+=u[F+1].dist(u[F]));for(var k=a.segment||0;k>=0;k--)I[k]={x:u[k].x,y:u[k].y,tileUnitDistanceFromAnchor:E},k>0&&(E+=u[k-1].dist(u[k]));for(var H=0;H<u.length;H++){var Y=I[H];this.lineVertexArray.emplaceBack(Y.x,Y.y,Y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:A,lineLength:this.lineVertexArray.length-A}},In.prototype.addSymbols=function(a,u,A,x,E,I,F,k,H,Y,ee,se){for(var he=a.indexArray,ve=a.layoutVertexArray,Ue=a.segments.prepareSegment(4*u.length,ve,he,this.canOverlap?I.sortKey:void 0),ze=this.glyphOffsetArray.length,je=Ue.vertexLength,Ve=this.allowVerticalPlacement&&F===So.vertical?Math.PI/2:0,qe=I.text&&I.text.sections,at=0;at<u.length;at++){var pt=u[at],_t=pt.tl,Pt=pt.tr,Gt=pt.bl,Jt=pt.br,mr=pt.tex,er=pt.pixelOffsetTL,br=pt.pixelOffsetBR,tr=pt.minFontScaleX,Zr=pt.minFontScaleY,Mr=pt.glyphOffset,ur=pt.isSDF,sn=pt.sectionIndex,jr=Ue.vertexLength,An=Mr[1];n0(ve,k.x,k.y,_t.x,An+_t.y,mr.x,mr.y,A,ur,er.x,er.y,tr,Zr),n0(ve,k.x,k.y,Pt.x,An+Pt.y,mr.x+mr.w,mr.y,A,ur,br.x,er.y,tr,Zr),n0(ve,k.x,k.y,Gt.x,An+Gt.y,mr.x,mr.y+mr.h,A,ur,er.x,br.y,tr,Zr),n0(ve,k.x,k.y,Jt.x,An+Jt.y,mr.x+mr.w,mr.y+mr.h,A,ur,br.x,br.y,tr,Zr),bv(a.dynamicLayoutVertexArray,k,Ve),he.emplaceBack(jr,jr+1,jr+2),he.emplaceBack(jr+1,jr+2,jr+3),Ue.vertexLength+=4,Ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mr[0]),at!==u.length-1&&sn===u[at+1].sectionIndex||a.programConfigurations.populatePaintArrays(ve.length,I,I.index,{},se,qe&&qe[sn])}a.placedSymbolArray.emplaceBack(k.x,k.y,ze,this.glyphOffsetArray.length-ze,je,H,Y,k.segment,A?A[0]:0,A?A[1]:0,x[0],x[1],F,0,!1,0,ee)},In.prototype._addCollisionDebugVertex=function(a,u,A,x,E,I){return u.emplaceBack(0,0),a.emplaceBack(A.x,A.y,x,E,Math.round(I.x),Math.round(I.y))},In.prototype.addCollisionDebugVertices=function(a,u,A,x,E,I,F){var k=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),H=k.vertexLength,Y=E.layoutVertexArray,ee=E.collisionVertexArray,se=F.anchorX,he=F.anchorY;this._addCollisionDebugVertex(Y,ee,I,se,he,new b(a,u)),this._addCollisionDebugVertex(Y,ee,I,se,he,new b(A,u)),this._addCollisionDebugVertex(Y,ee,I,se,he,new b(A,x)),this._addCollisionDebugVertex(Y,ee,I,se,he,new b(a,x)),k.vertexLength+=4;var ve=E.indexArray;ve.emplaceBack(H,H+1),ve.emplaceBack(H+1,H+2),ve.emplaceBack(H+2,H+3),ve.emplaceBack(H+3,H),k.primitiveLength+=4},In.prototype.addDebugCollisionBoxes=function(a,u,A,x){for(var E=a;E<u;E++){var I=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,x?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,A)}},In.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new np(Ko,sT.members,B),this.iconCollisionBox=new np(Ko,sT.members,B);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},In.prototype._deserializeCollisionBoxesForSymbol=function(a,u,A,x,E,I,F,k,H){for(var Y={},ee=u;ee<A;ee++){var se=a.get(ee);Y.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},Y.textFeatureIndex=se.featureIndex;break}for(var he=x;he<E;he++){var ve=a.get(he);Y.verticalTextBox={x1:ve.x1,y1:ve.y1,x2:ve.x2,y2:ve.y2,anchorPointX:ve.anchorPointX,anchorPointY:ve.anchorPointY},Y.verticalTextFeatureIndex=ve.featureIndex;break}for(var Ue=I;Ue<F;Ue++){var ze=a.get(Ue);Y.iconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},Y.iconFeatureIndex=ze.featureIndex;break}for(var je=k;je<H;je++){var Ve=a.get(je);Y.verticalIconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},Y.verticalIconFeatureIndex=Ve.featureIndex;break}return Y},In.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var A=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,A.textBoxStartIndex,A.textBoxEndIndex,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A.iconBoxStartIndex,A.iconBoxEndIndex,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex))}},In.prototype.hasTextData=function(){return this.text.segments.get().length>0},In.prototype.hasIconData=function(){return this.icon.segments.get().length>0},In.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},In.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},In.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},In.prototype.addIndicesForPlacedSymbol=function(a,u){for(var A=a.placedSymbolArray.get(u),x=A.vertexStartIndex+4*A.numGlyphs,E=A.vertexStartIndex;E<x;E+=4)a.indexArray.emplaceBack(E,E+1,E+2),a.indexArray.emplaceBack(E+1,E+2,E+3)},In.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),A=Math.cos(a),x=[],E=[],I=[],F=0;F<this.symbolInstances.length;++F){I.push(F);var k=this.symbolInstances.get(F);x.push(0|Math.round(u*k.anchorX+A*k.anchorY)),E.push(k.featureIndex)}return I.sort(function(H,Y){return x[H]-x[Y]||E[Y]-E[H]}),I},In.prototype.addToSortKeyRanges=function(a,u){var A=this.sortKeyRanges[this.sortKeyRanges.length-1];A&&A.sortKey===u?A.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},In.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var A=0,x=this.symbolInstanceIndexes;A<x.length;A+=1){var E=this.symbolInstances.get(x[A]);this.featureSortOrder.push(E.featureIndex),[E.rightJustifiedTextSymbolIndex,E.centerJustifiedTextSymbolIndex,E.leftJustifiedTextSymbolIndex].forEach(function(I,F,k){I>=0&&k.indexOf(I)===F&&u.addIndicesForPlacedSymbol(u.text,I)}),E.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,E.verticalPlacedTextSymbolIndex),E.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.placedIconSymbolIndex),E.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},nr("SymbolBucket",In,{omit:["layers","collisionBoxArray","features","compareText"]}),In.MAX_GLYPHS=65535,In.addDynamicAttributes=bv;var MU=new Vn({"symbol-placement":new _r(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new _r(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _r(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new or(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _r(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _r(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _r(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new _r(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _r(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new or(ce.layout_symbol["icon-size"]),"icon-text-fit":new _r(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _r(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new or(ce.layout_symbol["icon-image"]),"icon-rotate":new or(ce.layout_symbol["icon-rotate"]),"icon-padding":new _r(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new _r(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new or(ce.layout_symbol["icon-offset"]),"icon-anchor":new or(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _r(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _r(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _r(ce.layout_symbol["text-rotation-alignment"]),"text-field":new or(ce.layout_symbol["text-field"]),"text-font":new or(ce.layout_symbol["text-font"]),"text-size":new or(ce.layout_symbol["text-size"]),"text-max-width":new or(ce.layout_symbol["text-max-width"]),"text-line-height":new _r(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new or(ce.layout_symbol["text-letter-spacing"]),"text-justify":new or(ce.layout_symbol["text-justify"]),"text-radial-offset":new or(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _r(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new or(ce.layout_symbol["text-anchor"]),"text-max-angle":new _r(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new _r(ce.layout_symbol["text-writing-mode"]),"text-rotate":new or(ce.layout_symbol["text-rotate"]),"text-padding":new _r(ce.layout_symbol["text-padding"]),"text-keep-upright":new _r(ce.layout_symbol["text-keep-upright"]),"text-transform":new or(ce.layout_symbol["text-transform"]),"text-offset":new or(ce.layout_symbol["text-offset"]),"text-allow-overlap":new _r(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _r(ce.layout_symbol["text-ignore-placement"]),"text-optional":new _r(ce.layout_symbol["text-optional"])}),xv={paint:new Vn({"icon-opacity":new or(ce.paint_symbol["icon-opacity"]),"icon-color":new or(ce.paint_symbol["icon-color"]),"icon-halo-color":new or(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new or(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new or(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new _r(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new _r(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new or(ce.paint_symbol["text-opacity"]),"text-color":new or(ce.paint_symbol["text-color"],{runtimeType:zt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new or(ce.paint_symbol["text-halo-color"]),"text-halo-width":new or(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new or(ce.paint_symbol["text-halo-blur"]),"text-translate":new _r(ce.paint_symbol["text-translate"]),"text-translate-anchor":new _r(ce.paint_symbol["text-translate-anchor"])}),layout:MU},Hh=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Ft,this.defaultValue=a};Hh.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Hh.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Hh.prototype.outputDefined=function(){return!1},Hh.prototype.serialize=function(){return null},nr("FormatSectionOverride",Hh,{omit:["defaultValue"]});var PU=function(a){function u(A){a.call(this,A,xv)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(A,x){if(a.prototype.recalculate.call(this,A,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var E=this.layout.get("text-writing-mode");if(E){for(var I=[],F=0,k=E;F<k.length;F+=1){var H=k[F];I.indexOf(H)<0&&I.push(H)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(A,x,E,I){var F=this.layout.get(A).evaluate(x,{},E,I),k=this._unevaluatedLayout._values[A];return k.isDataDriven()||po(k.value)||!F?F:function(H,Y){return Y.replace(/{([^{}]+)}/g,function(ee,se){return se in H?String(H[se]):""})}(x.properties,F)},u.prototype.createBucket=function(A){return new In(A)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var A=0,x=xv.paint.overridableProperties;A<x.length;A+=1){var E=x[A];if(u.hasPaintOverride(this.layout,E)){var I,F=this.paint.get(E),k=new Hh(F),H=new _a(k,F.property.specification);I=F.value.kind==="constant"||F.value.kind==="source"?new za("source",H):new wc("composite",H,F.value.zoomStops,F.value._interpolationType),this.paint._values[E]=new Zi(F.property,I,F.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(A,x,E){return!(!this.layout||x.isDataDriven()||E.isDataDriven())&&u.hasPaintOverride(this.layout,A)},u.hasPaintOverride=function(A,x){var E=A.get("text-field"),I=xv.paint.properties[x],F=!1,k=function(ee){for(var se=0,he=ee;se<he.length;se+=1)if(I.overrides&&I.overrides.hasOverride(he[se]))return void(F=!0)};if(E.value.kind==="constant"&&E.value.value instanceof ti)k(E.value.value.sections);else if(E.value.kind==="source"){var H=function(ee){F||(ee instanceof Si&&zn(ee.value)===en?k(ee.value.sections):ee instanceof us?k(ee.sections):ee.eachChild(H))},Y=E.value;Y._styleExpression&&H(Y._styleExpression.expression)}return F},u}(Or),RU={paint:new Vn({"background-color":new _r(ce.paint_background["background-color"]),"background-pattern":new is(ce.paint_background["background-pattern"]),"background-opacity":new _r(ce.paint_background["background-opacity"])})},FU=function(a){function u(A){a.call(this,A,RU)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Or),OU={paint:new Vn({"raster-opacity":new _r(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new _r(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _r(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _r(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new _r(ce.paint_raster["raster-saturation"]),"raster-contrast":new _r(ce.paint_raster["raster-contrast"]),"raster-resampling":new _r(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new _r(ce.paint_raster["raster-fade-duration"])})},DU=function(a){function u(A){a.call(this,A,OU)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Or),LU=function(a){function u(A){a.call(this,A,{}),this.implementation=A}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(A){this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},u.prototype.onRemove=function(A){this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},u}(Or),kU={circle:ov,heatmap:v9,hillshade:x9,fill:U9,"fill-extrusion":X9,line:eU,symbol:PU,background:FU,raster:DU},ST=S.HTMLImageElement,IT=S.HTMLCanvasElement,MT=S.HTMLVideoElement,PT=S.ImageData,i0=S.ImageBitmap,wf=function(a,u,A,x){this.context=a,this.format=A,this.texture=a.gl.createTexture(),this.update(u,x)};wf.prototype.update=function(a,u,A){var x=a.width,E=a.height,I=!(this.size&&this.size[0]===x&&this.size[1]===E||A),F=this.context,k=F.gl;if(this.useMipmap=!!(u&&u.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),F.pixelStoreUnpackFlipY.set(!1),F.pixelStoreUnpack.set(1),F.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!u||u.premultiply!==!1)),I)this.size=[x,E],a instanceof ST||a instanceof IT||a instanceof MT||a instanceof PT||i0&&a instanceof i0?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,a):k.texImage2D(k.TEXTURE_2D,0,this.format,x,E,0,this.format,k.UNSIGNED_BYTE,a.data);else{var H=A||{x:0,y:0},Y=H.x,ee=H.y;a instanceof ST||a instanceof IT||a instanceof MT||a instanceof PT||i0&&a instanceof i0?k.texSubImage2D(k.TEXTURE_2D,0,Y,ee,k.RGBA,k.UNSIGNED_BYTE,a):k.texSubImage2D(k.TEXTURE_2D,0,Y,ee,x,E,k.RGBA,k.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)},wf.prototype.bind=function(a,u,A){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),A!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(A=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,A||a),this.filter=a),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)},wf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},wf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var wv=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};wv.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},wv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var jh=function(a,u,A){this.target=a,this.parent=u,this.mapId=A,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Be(["receive","process"],this),this.invoker=new wv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=we()?a:S};function RT(a,u,A){var x=2*Math.PI*6378137/256/Math.pow(2,A);return[a*x-2*Math.PI*6378137/2,u*x-2*Math.PI*6378137/2]}jh.prototype.send=function(a,u,A,x,E){var I=this;E===void 0&&(E=!1);var F=Math.round(1e18*Math.random()).toString(36).substring(0,10);A&&(this.callbacks[F]=A);var k=Qe(this.globalScope)?void 0:[];return this.target.postMessage({id:F,type:a,hasCallback:!!A,targetMapId:x,mustQueue:E,sourceMapId:this.mapId,data:Ys(u,k)},k),{cancel:function(){A&&delete I.callbacks[F],I.target.postMessage({id:F,type:"<cancel>",targetMapId:x,sourceMapId:I.mapId})}}},jh.prototype.receive=function(a){var u=a.data,A=u.id;if(A&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[A];var x=this.cancelCallbacks[A];delete this.cancelCallbacks[A],x&&x()}else we()||u.mustQueue?(this.tasks[A]=u,this.taskQueue.push(A),this.invoker.trigger()):this.processTask(A,u)},jh.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},jh.prototype.processTask=function(a,u){var A=this;if(u.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(u.error?x(fs(u.error)):x(null,fs(u.data)))}else{var E=!1,I=Qe(this.globalScope)?void 0:[],F=u.hasCallback?function(ee,se){E=!0,delete A.cancelCallbacks[a],A.target.postMessage({id:a,type:"<response>",sourceMapId:A.mapId,error:ee?Ys(ee):null,data:Ys(se,I)},I)}:function(ee){E=!0},k=null,H=fs(u.data);if(this.parent[u.type])k=this.parent[u.type](u.sourceMapId,H,F);else if(this.parent.getWorkerSource){var Y=u.type.split(".");k=this.parent.getWorkerSource(u.sourceMapId,Y[0],H.source)[Y[1]](H,F)}else F(new Error("Could not find function "+u.type));!E&&k&&k.cancel&&(this.cancelCallbacks[a]=k.cancel)}},jh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Di=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Di.prototype.setNorthEast=function(a){return this._ne=a instanceof Kn?new Kn(a.lng,a.lat):Kn.convert(a),this},Di.prototype.setSouthWest=function(a){return this._sw=a instanceof Kn?new Kn(a.lng,a.lat):Kn.convert(a),this},Di.prototype.extend=function(a){var u,A,x=this._sw,E=this._ne;if(a instanceof Kn)u=a,A=a;else{if(!(a instanceof Di))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Di.convert(a)):this.extend(Kn.convert(a)):this;if(A=a._ne,!(u=a._sw)||!A)return this}return x||E?(x.lng=Math.min(u.lng,x.lng),x.lat=Math.min(u.lat,x.lat),E.lng=Math.max(A.lng,E.lng),E.lat=Math.max(A.lat,E.lat)):(this._sw=new Kn(u.lng,u.lat),this._ne=new Kn(A.lng,A.lat)),this},Di.prototype.getCenter=function(){return new Kn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Di.prototype.getSouthWest=function(){return this._sw},Di.prototype.getNorthEast=function(){return this._ne},Di.prototype.getNorthWest=function(){return new Kn(this.getWest(),this.getNorth())},Di.prototype.getSouthEast=function(){return new Kn(this.getEast(),this.getSouth())},Di.prototype.getWest=function(){return this._sw.lng},Di.prototype.getSouth=function(){return this._sw.lat},Di.prototype.getEast=function(){return this._ne.lng},Di.prototype.getNorth=function(){return this._ne.lat},Di.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Di.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Di.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Di.prototype.contains=function(a){var u=Kn.convert(a),A=u.lng,x=u.lat,E=this._sw.lng<=A&&A<=this._ne.lng;return this._sw.lng>this._ne.lng&&(E=this._sw.lng>=A&&A>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&E},Di.convert=function(a){return!a||a instanceof Di?a:new Di(a)};var Kn=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Kn.prototype.wrap=function(){return new Kn(z(this.lng,-180,180),this.lat)},Kn.prototype.toArray=function(){return[this.lng,this.lat]},Kn.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Kn.prototype.distanceTo=function(a){var u=Math.PI/180,A=this.lat*u,x=a.lat*u,E=Math.sin(A)*Math.sin(x)+Math.cos(A)*Math.cos(x)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(E,1))},Kn.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,A=u/Math.cos(Math.PI/180*this.lat);return new Di(new Kn(this.lng-A,this.lat-u),new Kn(this.lng+A,this.lat+u))},Kn.convert=function(a){if(a instanceof Kn)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Kn(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Kn(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var FT=2*Math.PI*63710088e-1;function OT(a){return FT*Math.cos(a*Math.PI/180)}function DT(a){return(180+a)/360}function LT(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function kT(a,u){return a/OT(u)}function Cv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Cf=function(a,u,A){A===void 0&&(A=0),this.x=+a,this.y=+u,this.z=+A};Cf.fromLngLat=function(a,u){u===void 0&&(u=0);var A=Kn.convert(a);return new Cf(DT(A.lng),LT(A.lat),kT(u,A.lat))},Cf.prototype.toLngLat=function(){return new Kn(360*this.x-180,Cv(this.y))},Cf.prototype.toAltitude=function(){return this.z*OT(Cv(this.y))},Cf.prototype.meterInMercatorCoordinateUnits=function(){return 1/FT*(a=Cv(this.y),1/Math.cos(a*Math.PI/180));var a};var Ef=function(a,u,A){this.z=a,this.x=u,this.y=A,this.key=ip(0,a,a,u,A)};Ef.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Ef.prototype.url=function(a,u){var A,x,E,I,F,k=(x=this.y,E=this.z,I=RT(256*(A=this.x),256*(x=Math.pow(2,E)-x-1),E),F=RT(256*(A+1),256*(x+1),E),I[0]+","+I[1]+","+F[0]+","+F[1]),H=function(Y,ee,se){for(var he,ve="",Ue=Y;Ue>0;Ue--)ve+=(ee&(he=1<<Ue-1)?1:0)+(se&he?2:0);return ve}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",H).replace("{bbox-epsg-3857}",k)},Ef.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new b(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},Ef.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var NT=function(a,u){this.wrap=a,this.canonical=u,this.key=ip(a,u.z,u.z,u.x,u.y)},Li=function(a,u,A,x,E){this.overscaledZ=a,this.wrap=u,this.canonical=new Ef(A,+x,+E),this.key=ip(u,a,A,x,E)};function ip(a,u,A,x,E){(a*=2)<0&&(a=-1*a-1);var I=1<<A;return(I*I*a+I*E+x).toString(36)+A.toString(36)+u.toString(36)}Li.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Li.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new Li(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Li(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},Li.prototype.calculateScaledKey=function(a,u){var A=this.canonical.z-a;return a>this.canonical.z?ip(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):ip(this.wrap*+u,a,a,this.canonical.x>>A,this.canonical.y>>A)},Li.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},Li.prototype.children=function(a){if(this.overscaledZ>=a)return[new Li(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,A=2*this.canonical.x,x=2*this.canonical.y;return[new Li(u,this.wrap,u,A,x),new Li(u,this.wrap,u,A+1,x),new Li(u,this.wrap,u,A,x+1),new Li(u,this.wrap,u,A+1,x+1)]},Li.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Li.prototype.wrapped=function(){return new Li(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Li.prototype.unwrapTo=function(a){return new Li(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Li.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Li.prototype.toUnwrapped=function(){return new NT(this.wrap,this.canonical)},Li.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Li.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Cf(a.x-this.wrap,a.y))},nr("CanonicalTileID",Ef),nr("OverscaledTileID",Li,{omit:["posMatrix"]});var Tl=function(a,u,A){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(A&&A!=="mapbox"&&A!=="terrarium")return ne('"'+A+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var x=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=A||"mapbox";for(var E=0;E<x;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(x,E)]=this.data[this._idx(x-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,x)]=this.data[this._idx(E,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};Tl.prototype.get=function(a,u){var A=new Uint8Array(this.data.buffer),x=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(A[x],A[x+1],A[x+2])},Tl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Tl.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},Tl.prototype._unpackMapbox=function(a,u,A){return(256*a*256+256*u+A)/10-1e4},Tl.prototype._unpackTerrarium=function(a,u,A){return 256*a+u+A/256-32768},Tl.prototype.getPixels=function(){return new ro({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Tl.prototype.backfillBorder=function(a,u,A){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=u*this.dim,E=u*this.dim+this.dim,I=A*this.dim,F=A*this.dim+this.dim;switch(u){case-1:x=E-1;break;case 1:E=x+1}switch(A){case-1:I=F-1;break;case 1:F=I+1}for(var k=-u*this.dim,H=-A*this.dim,Y=I;Y<F;Y++)for(var ee=x;ee<E;ee++)this.data[this._idx(ee,Y)]=a.data[this._idx(ee+k,Y+H)]},nr("DEMData",Tl);var s0=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var A=a[u];this._stringToNumber[A]=u,this._numberToString[u]=A}};s0.prototype.encode=function(a){return this._stringToNumber[a]},s0.prototype.decode=function(a){return this._numberToString[a]};var o0=function(a,u,A,x,E){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=A,a._y=x,this.properties=a.properties,this.id=E},Ev={geometry:{configurable:!0}};Ev.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ev.geometry.set=function(a){this._geometry=a},o0.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(o0.prototype,Ev);var $h=function(){this.state={},this.stateChanges={},this.deletedStates={}};$h.prototype.updateState=function(a,u,A){var x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},j(this.stateChanges[a][x],A),this.deletedStates[a]===null)for(var E in this.deletedStates[a]={},this.state[a])E!==x&&(this.deletedStates[a][E]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var I in this.deletedStates[a][x]={},this.state[a][x])A[I]||(this.deletedStates[a][x][I]=null);else for(var F in A)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][F]===null&&delete this.deletedStates[a][x][F]},$h.prototype.removeFeatureState=function(a,u,A){if(this.deletedStates[a]!==null){var x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},A&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][A]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(A in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][A]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},$h.prototype.getState=function(a,u){var A=String(u),x=j({},(this.state[a]||{})[A],(this.stateChanges[a]||{})[A]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var E=this.deletedStates[a][u];if(E===null)return{};for(var I in E)delete x[I]}return x},$h.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},$h.prototype.coalesceChanges=function(a,u){var A={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var E={};for(var I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),j(this.state[x][I],this.stateChanges[x][I]),E[I]=this.state[x][I];A[x]=E}for(var F in this.deletedStates){this.state[F]=this.state[F]||{};var k={};if(this.deletedStates[F]===null)for(var H in this.state[F])k[H]={},this.state[F][H]={};else for(var Y in this.deletedStates[F]){if(this.deletedStates[F][Y]===null)this.state[F][Y]={};else for(var ee=0,se=Object.keys(this.deletedStates[F][Y]);ee<se.length;ee+=1)delete this.state[F][Y][se[ee]];k[Y]=this.state[F][Y]}A[F]=A[F]||{},j(A[F],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(A).length!==0)for(var he in a)a[he].setFeatureState(A,u)};var Bl=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Co(8192,16,0),this.grid3D=new Co(8192,16,0),this.featureIndexArray=new X,this.promoteId=u};function UT(a,u,A,x,E){return de(a,function(I,F){var k=u instanceof bl?u.get(F):null;return k&&k.evaluate?k.evaluate(A,x,E):k})}function zT(a){for(var u=1/0,A=1/0,x=-1/0,E=-1/0,I=0,F=a;I<F.length;I+=1){var k=F[I];u=Math.min(u,k.x),A=Math.min(A,k.y),x=Math.max(x,k.x),E=Math.max(E,k.y)}return{minX:u,minY:A,maxX:x,maxY:E}}function NU(a,u){return u-a}Bl.prototype.insert=function(a,u,A,x,E,I){var F=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(A,x,E);for(var k=I?this.grid3D:this.grid,H=0;H<u.length;H++){for(var Y=u[H],ee=[1/0,1/0,-1/0,-1/0],se=0;se<Y.length;se++){var he=Y[se];ee[0]=Math.min(ee[0],he.x),ee[1]=Math.min(ee[1],he.y),ee[2]=Math.max(ee[2],he.x),ee[3]=Math.max(ee[3],he.y)}ee[0]<8192&&ee[1]<8192&&ee[2]>=0&&ee[3]>=0&&k.insert(F,ee[0],ee[1],ee[2],ee[3])}},Bl.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Dh.VectorTile(new Xg(this.rawTileData)).layers,this.sourceLayerCoder=new s0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Bl.prototype.query=function(a,u,A,x){var E=this;this.loadVTLayers();for(var I=a.params||{},F=8192/a.tileSize/a.scale,k=iu(I.filter),H=a.queryGeometry,Y=a.queryPadding*F,ee=zT(H),se=this.grid.query(ee.minX-Y,ee.minY-Y,ee.maxX+Y,ee.maxY+Y),he=zT(a.cameraQueryGeometry),ve=this.grid3D.query(he.minX-Y,he.minY-Y,he.maxX+Y,he.maxY+Y,function(pt,_t,Pt,Gt){return function(Jt,mr,er,br,tr){for(var Zr=0,Mr=Jt;Zr<Mr.length;Zr+=1){var ur=Mr[Zr];if(mr<=ur.x&&er<=ur.y&&br>=ur.x&&tr>=ur.y)return!0}var sn=[new b(mr,er),new b(mr,tr),new b(br,tr),new b(br,er)];if(Jt.length>2){for(var jr=0,An=sn;jr<An.length;jr+=1)if(va(Jt,An[jr]))return!0}for(var xr=0;xr<Jt.length-1;xr++)if(vf(Jt[xr],Jt[xr+1],sn))return!0;return!1}(a.cameraQueryGeometry,pt-Y,_t-Y,Pt+Y,Gt+Y)}),Ue=0,ze=ve;Ue<ze.length;Ue+=1)se.push(ze[Ue]);se.sort(NU);for(var je,Ve={},qe=function(pt){var _t=se[pt];if(_t!==je){je=_t;var Pt=E.featureIndexArray.get(_t),Gt=null;E.loadMatchingFeature(Ve,Pt.bucketIndex,Pt.sourceLayerIndex,Pt.featureIndex,k,I.layers,I.availableImages,u,A,x,function(Jt,mr,er){return Gt||(Gt=di(Jt)),mr.queryIntersectsFeature(H,Jt,er,Gt,E.z,a.transform,F,a.pixelPosMatrix)})}},at=0;at<se.length;at++)qe(at);return Ve},Bl.prototype.loadMatchingFeature=function(a,u,A,x,E,I,F,k,H,Y,ee){var se=this.bucketLayerIDs[u];if(!I||function(Jt,mr){for(var er=0;er<Jt.length;er++)if(mr.indexOf(Jt[er])>=0)return!0;return!1}(I,se)){var he=this.sourceLayerCoder.decode(A),ve=this.vtLayers[he].feature(x);if(E.needGeometry){var Ue=wi(ve,!0);if(!E.filter(new kr(this.tileID.overscaledZ),Ue,this.tileID.canonical))return}else if(!E.filter(new kr(this.tileID.overscaledZ),ve))return;for(var ze=this.getId(ve,he),je=0;je<se.length;je++){var Ve=se[je];if(!(I&&I.indexOf(Ve)<0)){var qe=k[Ve];if(qe){var at={};ze!==void 0&&Y&&(at=Y.getState(qe.sourceLayer||"_geojsonTileLayer",ze));var pt=j({},H[Ve]);pt.paint=UT(pt.paint,qe.paint,ve,at,F),pt.layout=UT(pt.layout,qe.layout,ve,at,F);var _t=!ee||ee(ve,qe,at);if(_t){var Pt=new o0(ve,this.z,this.x,this.y,ze);Pt.layer=pt;var Gt=a[Ve];Gt===void 0&&(Gt=a[Ve]=[]),Gt.push({featureIndex:x,feature:Pt,intersectionZ:_t})}}}}}},Bl.prototype.lookupSymbolFeatures=function(a,u,A,x,E,I,F,k){var H={};this.loadVTLayers();for(var Y=iu(E),ee=0,se=a;ee<se.length;ee+=1)this.loadMatchingFeature(H,A,x,se[ee],Y,I,F,k,u);return H},Bl.prototype.hasLayer=function(a){for(var u=0,A=this.bucketLayerIDs;u<A.length;u+=1)for(var x=0,E=A[u];x<E.length;x+=1)if(a===E[x])return!0;return!1},Bl.prototype.getId=function(a,u){var A=a.id;return this.promoteId&&typeof(A=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(A=Number(A)),A},nr("FeatureIndex",Bl,{omit:["rawTileData","sourceLayerCoder"]});var ts=function(a,u){this.tileID=a,this.uid=fe(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ts.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<$t.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},ts.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ts.prototype.loadVectorData=function(a,u,A){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(Y,ee){var se={};if(!ee)return se;for(var he=function(){var ze=Ue[ve],je=ze.layerIds.map(function(at){return ee.getLayer(at)}).filter(Boolean);if(je.length!==0){ze.layers=je,ze.stateDependentLayerIds&&(ze.stateDependentLayers=ze.stateDependentLayerIds.map(function(at){return je.filter(function(pt){return pt.id===at})[0]}));for(var Ve=0,qe=je;Ve<qe.length;Ve+=1)se[qe[Ve].id]=ze}},ve=0,Ue=Y;ve<Ue.length;ve+=1)he();return se}(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var E=this.buckets[x];if(E instanceof In){if(this.hasSymbolBuckets=!0,!A)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var F=this.buckets[I];if(F instanceof In&&F.hasRTLText){this.hasRTLText=!0,qi.isLoading()||qi.isLoaded()||gf()!=="deferred"||go();break}}for(var k in this.queryPadding=0,this.buckets){var H=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(k).queryRadius(H))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},ts.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ts.prototype.getBucket=function(a){return this.buckets[a.id]},ts.prototype.upload=function(a){for(var u in this.buckets){var A=this.buckets[u];A.uploadPending()&&A.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wf(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wf(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},ts.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},ts.prototype.queryRenderedFeatures=function(a,u,A,x,E,I,F,k,H,Y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:E,scale:I,tileSize:this.tileSize,pixelPosMatrix:Y,transform:k,params:F,queryPadding:this.queryPadding*H},a,u,A):{}},ts.prototype.querySourceFeatures=function(a,u){var A=this.latestFeatureIndex;if(A&&A.rawTileData){var x=A.loadVTLayers(),E=u?u.sourceLayer:"",I=x._geojsonTileLayer||x[E];if(I)for(var F=iu(u&&u.filter),k=this.tileID.canonical,H=k.z,Y=k.x,ee=k.y,se={z:H,x:Y,y:ee},he=0;he<I.length;he++){var ve=I.feature(he);if(F.needGeometry){var Ue=wi(ve,!0);if(!F.filter(new kr(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!F.filter(new kr(this.tileID.overscaledZ),ve))continue;var ze=A.getId(ve,E),je=new o0(ve,H,Y,ee,ze);je.tile=se,a.push(je)}}},ts.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ts.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ts.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var A=Ne(a.cacheControl);A["max-age"]&&(this.expirationTime=Date.now()+1e3*A["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),E=!1;if(this.expirationTime>x)E=!1;else if(u)if(this.expirationTime<u)E=!0;else{var I=this.expirationTime-u;I?this.expirationTime=x+Math.max(I,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ts.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ts.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var A=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(u.style.hasLayer(x)){var E=this.buckets[x],I=E.layers[0].sourceLayer||"_geojsonTileLayer",F=A[I],k=a[I];if(F&&k&&Object.keys(k).length!==0){E.update(k,F,this.imageAtlas&&this.imageAtlas.patternPositions||{});var H=u&&u.style&&u.style.getLayer(x);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(E)))}}}},ts.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ts.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$t.now()},ts.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ts.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=$t.now()+a},ts.prototype.setDependencies=function(a,u){for(var A={},x=0,E=u;x<E.length;x+=1)A[E[x]]=!0;this.dependencies[a]=A},ts.prototype.hasDependency=function(a,u){for(var A=0,x=a;A<x.length;A+=1){var E=this.dependencies[x[A]];if(E){for(var I=0,F=u;I<F.length;I+=1)if(E[F[I]])return!0}}return!1};var _u=S.performance,GT=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},_u.mark(this._marks.start)};GT.prototype.finish=function(){_u.mark(this._marks.end);var a=_u.getEntriesByName(this._marks.measure);return a.length===0&&(_u.measure(this._marks.measure,this._marks.start,this._marks.end),a=_u.getEntriesByName(this._marks.measure),_u.clearMarks(this._marks.start),_u.clearMarks(this._marks.end),_u.clearMeasures(this._marks.measure)),a},s.Actor=jh,s.AlphaImage=xf,s.CanonicalTileID=Ef,s.CollisionBoxArray=d,s.Color=Kr,s.DEMData=Tl,s.DataConstantProperty=_r,s.DictionaryCoder=s0,s.EXTENT=8192,s.ErrorEvent=Ae,s.EvaluationParameters=kr,s.Event=De,s.Evented=xe,s.FeatureIndex=Bl,s.FillBucket=Xa,s.FillExtrusionBucket=Ka,s.ImageAtlas=rp,s.ImagePosition=Yg,s.LineBucket=zs,s.LngLat=Kn,s.LngLatBounds=Di,s.MercatorCoordinate=Cf,s.ONE_EM=24,s.OverscaledTileID=Li,s.Point=b,s.Point$1=b,s.Properties=Vn,s.Protobuf=Xg,s.RGBAImage=ro,s.RequestManager=hr,s.RequestPerformance=GT,s.ResourceType=Nt,s.SegmentVector=Q,s.SourceFeatureState=$h,s.StructArrayLayout1ui2=M,s.StructArrayLayout2f1f2i16=To,s.StructArrayLayout2i4=ks,s.StructArrayLayout3ui6=qo,s.StructArrayLayout4i8=mf,s.SymbolBucket=In,s.Texture=wf,s.Tile=ts,s.Transitionable=Vi,s.Uniform1f=Rt,s.Uniform1i=ht,s.Uniform2f=xt,s.Uniform3f=kt,s.Uniform4f=rr,s.UniformColor=vr,s.UniformMatrix4f=gn,s.UnwrappedTileID=NT,s.ValidationError=Se,s.WritingMode=So,s.ZoomHistory=hf,s.add=function(a,u,A){return a[0]=u[0]+A[0],a[1]=u[1]+A[1],a[2]=u[2]+A[2],a},s.addDynamicAttributes=bv,s.asyncAll=function(a,u,A){if(!a.length)return A(null,[]);var x=a.length,E=new Array(a.length),I=null;a.forEach(function(F,k){u(F,function(H,Y){H&&(I=H),E[k]=Y,--x==0&&A(I,E)})})},s.bezier=N,s.bindAll=Be,s.browser=$t,s.cacheEntryPossiblyAdded=function(a){++Mt>Dt&&(a.getActor().send("enforceCacheSizeLimit",Pe),Mt=0)},s.clamp=W,s.clearTileCache=function(a){var u=S.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},s.clipLine=xT,s.clone=function(a){var u=new vn(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},s.clone$1=pe,s.clone$2=function(a){var u=new vn(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},s.collisionCircleLayout=iU,s.config=Lt,s.create=function(){var a=new vn(16);return vn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new vn(9);return vn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new vn(4);return vn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=c,s.createExpression=ru,s.createLayout=Mi,s.createStyleLayer=function(a){return a.type==="custom"?new LU(a):new kU[a.type](a)},s.cross=function(a,u,A){var x=u[0],E=u[1],I=u[2],F=A[0],k=A[1],H=A[2];return a[0]=E*H-I*k,a[1]=I*F-x*H,a[2]=x*k-E*F,a},s.deepEqual=function a(u,A){if(Array.isArray(u)){if(!Array.isArray(A)||u.length!==A.length)return!1;for(var x=0;x<u.length;x++)if(!a(u[x],A[x]))return!1;return!0}if(typeof u=="object"&&u!==null&&A!==null){if(typeof A!="object"||Object.keys(u).length!==Object.keys(A).length)return!1;for(var E in u)if(!a(u[E],A[E]))return!1;return!0}return u===A},s.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},s.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},s.ease=G,s.emitValidationErrors=vl,s.endsWith=Le,s.enforceCacheSizeLimit=function(a){Vt(),bn&&bn.then(function(u){u.keys().then(function(A){for(var x=0;x<A.length-a;x++)u.delete(A[x])})})},s.evaluateSizeForFeature=gT,s.evaluateSizeForZoom=mT,s.evaluateVariableOffset=ET,s.evented=_i,s.extend=j,s.featureFilter=iu,s.filterObject=_e,s.fromRotation=function(a,u){var A=Math.sin(u),x=Math.cos(u);return a[0]=x,a[1]=A,a[2]=0,a[3]=-A,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=mv,s.getAnchorJustification=vv,s.getArrayBuffer=Je,s.getImage=ie,s.getJSON=function(a,u){return Te(j(a,{type:"json"}),u)},s.getRTLTextPluginStatus=gf,s.getReferrer=$,s.getVideo=function(a,u){var A,x,E=S.document.createElement("video");E.muted=!0,E.onloadstart=function(){u(null,E)};for(var I=0;I<a.length;I++){var F=S.document.createElement("source");A=a[I],x=void 0,(x=S.document.createElement("a")).href=A,(x.protocol!==S.document.location.protocol||x.host!==S.document.location.host)&&(E.crossOrigin="Anonymous"),F.src=a[I],E.appendChild(F)}return{cancel:function(){}}},s.identity=yo,s.invert=function(a,u){var A=u[0],x=u[1],E=u[2],I=u[3],F=u[4],k=u[5],H=u[6],Y=u[7],ee=u[8],se=u[9],he=u[10],ve=u[11],Ue=u[12],ze=u[13],je=u[14],Ve=u[15],qe=A*k-x*F,at=A*H-E*F,pt=A*Y-I*F,_t=x*H-E*k,Pt=x*Y-I*k,Gt=E*Y-I*H,Jt=ee*ze-se*Ue,mr=ee*je-he*Ue,er=ee*Ve-ve*Ue,br=se*je-he*ze,tr=se*Ve-ve*ze,Zr=he*Ve-ve*je,Mr=qe*Zr-at*tr+pt*br+_t*er-Pt*mr+Gt*Jt;return Mr?(a[0]=(k*Zr-H*tr+Y*br)*(Mr=1/Mr),a[1]=(E*tr-x*Zr-I*br)*Mr,a[2]=(ze*Gt-je*Pt+Ve*_t)*Mr,a[3]=(he*Pt-se*Gt-ve*_t)*Mr,a[4]=(H*er-F*Zr-Y*mr)*Mr,a[5]=(A*Zr-E*er+I*mr)*Mr,a[6]=(je*pt-Ue*Gt-Ve*at)*Mr,a[7]=(ee*Gt-he*pt+ve*at)*Mr,a[8]=(F*tr-k*er+Y*Jt)*Mr,a[9]=(x*er-A*tr-I*Jt)*Mr,a[10]=(Ue*Pt-ze*pt+Ve*qe)*Mr,a[11]=(se*pt-ee*Pt-ve*qe)*Mr,a[12]=(k*mr-F*br-H*Jt)*Mr,a[13]=(A*br-x*mr+E*Jt)*Mr,a[14]=(ze*at-Ue*_t-je*qe)*Mr,a[15]=(ee*_t-se*at+he*qe)*Mr,a):null},s.isChar=Kt,s.isMapboxURL=pr,s.keysDifference=function(a,u){var A=[];for(var x in a)x in u||A.push(x);return A},s.makeRequest=Te,s.mapObject=de,s.mercatorXfromLng=DT,s.mercatorYfromLat=LT,s.mercatorZfromAltitude=kT,s.mul=sv,s.multiply=Us,s.mvt=Dh,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,u){var A=u[0],x=u[1],E=u[2],I=A*A+x*x+E*E;return I>0&&(I=1/Math.sqrt(I)),a[0]=u[0]*I,a[1]=u[1]*I,a[2]=u[2]*I,a},s.number=ii,s.offscreenCanvasSupported=ge,s.ortho=function(a,u,A,x,E,I,F){var k=1/(u-A),H=1/(x-E),Y=1/(I-F);return a[0]=-2*k,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*H,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*Y,a[11]=0,a[12]=(u+A)*k,a[13]=(E+x)*H,a[14]=(F+I)*Y,a[15]=1,a},s.parseGlyphPBF=function(a){return new Xg(a).readFields(pU,[])},s.pbf=Xg,s.performSymbolLayout=function(a,u,A,x,E,I,F){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var k=a.layers[0].layout,H=a.layers[0]._unevaluatedLayout._values,Y={};if(a.textSizeData.kind==="composite"){var ee=a.textSizeData,se=ee.maxZoom;Y.compositeTextSizes=[H["text-size"].possiblyEvaluate(new kr(ee.minZoom),F),H["text-size"].possiblyEvaluate(new kr(se),F)]}if(a.iconSizeData.kind==="composite"){var he=a.iconSizeData,ve=he.maxZoom;Y.compositeIconSizes=[H["icon-size"].possiblyEvaluate(new kr(he.minZoom),F),H["icon-size"].possiblyEvaluate(new kr(ve),F)]}Y.layoutTextSize=H["text-size"].possiblyEvaluate(new kr(a.zoom+1),F),Y.layoutIconSize=H["icon-size"].possiblyEvaluate(new kr(a.zoom+1),F),Y.textMaxSize=H["text-size"].possiblyEvaluate(new kr(18));for(var Ue=24*k.get("text-line-height"),ze=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",je=k.get("text-keep-upright"),Ve=k.get("text-size"),qe=function(){var _t=pt[at],Pt=k.get("text-font").evaluate(_t,{},F).join(","),Gt=Ve.evaluate(_t,{},F),Jt=Y.layoutTextSize.evaluate(_t,{},F),mr=Y.layoutIconSize.evaluate(_t,{},F),er={horizontal:{},vertical:void 0},br=_t.text,tr=[0,0];if(br){var Zr=br.toString(),Mr=24*k.get("text-letter-spacing").evaluate(_t,{},F),ur=function(ln){for(var On=0,En=ln;On<En.length;On+=1)if(mn=En[On].charCodeAt(0),Kt.Arabic(mn)||Kt["Arabic Supplement"](mn)||Kt["Arabic Extended-A"](mn)||Kt["Arabic Presentation Forms-A"](mn)||Kt["Arabic Presentation Forms-B"](mn))return!1;var mn;return!0}(Zr)?Mr:0,sn=k.get("text-anchor").evaluate(_t,{},F),jr=k.get("text-variable-anchor");if(!jr){var An=k.get("text-radial-offset").evaluate(_t,{},F);tr=An?ET(sn,[24*An,yv]):k.get("text-offset").evaluate(_t,{},F).map(function(ln){return 24*ln})}var xr=ze?"center":k.get("text-justify").evaluate(_t,{},F),_n=k.get("symbol-placement"),Yn=_n==="point"?24*k.get("text-max-width").evaluate(_t,{},F):0,vi=function(){a.allowVerticalPlacement&&df(Zr)&&(er.vertical=qg(br,u,A,E,Pt,Yn,Ue,sn,"left",ur,tr,So.vertical,!0,_n,Jt,Gt))};if(!ze&&jr){for(var Ai=xr==="auto"?jr.map(function(ln){return vv(ln)}):[xr],qn=!1,bi=0;bi<Ai.length;bi++){var Wi=Ai[bi];if(!er.horizontal[Wi])if(qn)er.horizontal[Wi]=er.horizontal[0];else{var Ji=qg(br,u,A,E,Pt,Yn,Ue,"center",Wi,ur,tr,So.horizontal,!1,_n,Jt,Gt);Ji&&(er.horizontal[Wi]=Ji,qn=Ji.positionedLines.length===1)}}vi()}else{xr==="auto"&&(xr=vv(sn));var Es=qg(br,u,A,E,Pt,Yn,Ue,sn,xr,ur,tr,So.horizontal,!1,_n,Jt,Gt);Es&&(er.horizontal[xr]=Es),vi(),df(Zr)&&ze&&je&&(er.vertical=qg(br,u,A,E,Pt,Yn,Ue,sn,xr,ur,tr,So.vertical,!1,_n,Jt,Gt))}}var rs=void 0,Ts=!1;if(_t.icon&&_t.icon.name){var Ci=x[_t.icon.name];Ci&&(rs=function(ln,On,En){var mn=mv(En),Gs=On[0]-ln.displaySize[0]*mn.horizontalAlign,As=On[1]-ln.displaySize[1]*mn.verticalAlign;return{image:ln,top:As,bottom:As+ln.displaySize[1],left:Gs,right:Gs+ln.displaySize[0]}}(E[_t.icon.name],k.get("icon-offset").evaluate(_t,{},F),k.get("icon-anchor").evaluate(_t,{},F)),Ts=Ci.sdf,a.sdfIcons===void 0?a.sdfIcons=Ci.sdf:a.sdfIcons!==Ci.sdf&&ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ci.pixelRatio!==a.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var ns=BT(er.horizontal)||er.vertical;a.iconsInText=!!ns&&ns.iconsInText,(ns||rs)&&function(ln,On,En,mn,Gs,As,Jn,Pi,ps,yn,Lc){var Io=As.textMaxSize.evaluate(On,{});Io===void 0&&(Io=Jn);var kc,Ei=ln.layers[0].layout,Nc=Ei.get("icon-offset").evaluate(On,{},Lc),xa=BT(En.horizontal),Wh=Jn/24,Tf=ln.tilePixelRatio*Wh,Jh=ln.tilePixelRatio*Io/24,Sl=ln.tilePixelRatio*Pi,Xh=ln.tilePixelRatio*Ei.get("symbol-spacing"),a0=Ei.get("text-padding")*ln.tilePixelRatio,Kh=Ei.get("icon-padding")*ln.tilePixelRatio,sp=Ei.get("text-max-angle")/180*Math.PI,c0=Ei.get("text-rotation-alignment")==="map"&&Ei.get("symbol-placement")!=="point",l0=Ei.get("icon-rotation-alignment")==="map"&&Ei.get("symbol-placement")!=="point",Il=Ei.get("symbol-placement"),op=Xh/2,Yh=Ei.get("icon-text-fit");mn&&Yh!=="none"&&(ln.allowVerticalPlacement&&En.vertical&&(kc=pT(mn,En.vertical,Yh,Ei.get("icon-text-fit-padding"),Nc,Wh)),xa&&(mn=pT(mn,xa,Yh,Ei.get("icon-text-fit-padding"),Nc,Wh)));var yu=function(UU,Ap){Ap.x<0||Ap.x>=8192||Ap.y<0||Ap.y>=8192||function(Ti,Ya,zU,vu,Iv,jT,p0,Uc,g0,pp,m0,_0,Mv,$T,gp,WT,JT,XT,KT,YT,Mo,y0,qT,zc,GU){var ZT,Sf,td,rd,nd,id=Ti.addToLineVertexArray(Ya,zU),QT=0,eB=0,tB=0,rB=0,Pv=-1,Rv=-1,Ml={},nB=me(""),Fv=0,Ov=0;if(Uc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Fv=(ZT=Uc.layout.get("text-offset").evaluate(Mo,{},zc).map(function(_p){return 24*_p}))[0],Ov=ZT[1]):(Fv=24*Uc.layout.get("text-radial-offset").evaluate(Mo,{},zc),Ov=yv),Ti.allowVerticalPlacement&&vu.vertical){var iB=Uc.layout.get("text-rotate").evaluate(Mo,{},zc)+90;rd=new r0(g0,Ya,pp,m0,_0,vu.vertical,Mv,$T,gp,iB),p0&&(nd=new r0(g0,Ya,pp,m0,_0,p0,JT,XT,gp,iB))}if(Iv){var Dv=Uc.layout.get("icon-rotate").evaluate(Mo,{}),sB=Uc.layout.get("icon-text-fit")!=="none",oB=wT(Iv,Dv,qT,sB),Lv=p0?wT(p0,Dv,qT,sB):void 0;td=new r0(g0,Ya,pp,m0,_0,Iv,JT,XT,!1,Dv),QT=4*oB.length;var aB=Ti.iconSizeData,mp=null;aB.kind==="source"?(mp=[128*Uc.layout.get("icon-size").evaluate(Mo,{})])[0]>32640&&ne(Ti.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):aB.kind==="composite"&&((mp=[128*y0.compositeIconSizes[0].evaluate(Mo,{},zc),128*y0.compositeIconSizes[1].evaluate(Mo,{},zc)])[0]>32640||mp[1]>32640)&&ne(Ti.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ti.addSymbols(Ti.icon,oB,mp,YT,KT,Mo,!1,Ya,id.lineStartIndex,id.lineLength,-1,zc),Pv=Ti.icon.placedSymbolArray.length-1,Lv&&(eB=4*Lv.length,Ti.addSymbols(Ti.icon,Lv,mp,YT,KT,Mo,So.vertical,Ya,id.lineStartIndex,id.lineLength,-1,zc),Rv=Ti.icon.placedSymbolArray.length-1)}for(var cB in vu.horizontal){var v0=vu.horizontal[cB];if(!Sf){nB=me(v0.text);var VU=Uc.layout.get("text-rotate").evaluate(Mo,{},zc);Sf=new r0(g0,Ya,pp,m0,_0,v0,Mv,$T,gp,VU)}var lB=v0.positionedLines.length===1;if(tB+=TT(Ti,Ya,v0,jT,Uc,gp,Mo,WT,id,vu.vertical?So.horizontal:So.horizontalOnly,lB?Object.keys(vu.horizontal):[cB],Ml,Pv,y0,zc),lB)break}vu.vertical&&(rB+=TT(Ti,Ya,vu.vertical,jT,Uc,gp,Mo,WT,id,So.vertical,["vertical"],Ml,Rv,y0,zc));var HU=Sf?Sf.boxStartIndex:Ti.collisionBoxArray.length,jU=Sf?Sf.boxEndIndex:Ti.collisionBoxArray.length,$U=rd?rd.boxStartIndex:Ti.collisionBoxArray.length,WU=rd?rd.boxEndIndex:Ti.collisionBoxArray.length,JU=td?td.boxStartIndex:Ti.collisionBoxArray.length,XU=td?td.boxEndIndex:Ti.collisionBoxArray.length,KU=nd?nd.boxStartIndex:Ti.collisionBoxArray.length,YU=nd?nd.boxEndIndex:Ti.collisionBoxArray.length,Gc=-1,b0=function(_p,fB){return _p&&_p.circleDiameter?Math.max(_p.circleDiameter,fB):fB};Gc=b0(Sf,Gc),Gc=b0(rd,Gc),Gc=b0(td,Gc);var uB=(Gc=b0(nd,Gc))>-1?1:0;uB&&(Gc*=GU/24),Ti.glyphOffsetArray.length>=In.MAX_GLYPHS&&ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mo.sortKey!==void 0&&Ti.addToSortKeyRanges(Ti.symbolInstances.length,Mo.sortKey),Ti.symbolInstances.emplaceBack(Ya.x,Ya.y,Ml.right>=0?Ml.right:-1,Ml.center>=0?Ml.center:-1,Ml.left>=0?Ml.left:-1,Ml.vertical||-1,Pv,Rv,nB,HU,jU,$U,WU,JU,XU,KU,YU,pp,tB,rB,QT,eB,uB,0,Mv,Fv,Ov,Gc)}(ln,Ap,UU,En,mn,Gs,kc,ln.layers[0],ln.collisionBoxArray,On.index,On.sourceLayerIndex,ln.index,Tf,a0,c0,ps,Sl,Kh,l0,Nc,On,As,yn,Lc,Jn)};if(Il==="line")for(var qh=0,u0=xT(On.geometry,0,0,8192,8192);qh<u0.length;qh+=1)for(var f0=u0[qh],ap=0,cp=xU(f0,Xh,sp,En.vertical||xa,mn,24,Jh,ln.overscaling,8192);ap<cp.length;ap+=1){var h0=cp[ap];xa&&TU(ln,xa.text,op,h0)||yu(f0,h0)}else if(Il==="line-center")for(var lp=0,up=On.geometry;lp<up.length;lp+=1){var fp=up[lp];if(fp.length>1){var d0=bU(fp,sp,En.vertical||xa,mn,24,Jh);d0&&yu(fp,d0)}}else if(On.type==="Polygon")for(var Zh=0,A0=hv(On.geometry,0);Zh<A0.length;Zh+=1){var Qh=A0[Zh],hp=CU(Qh,16);yu(Qh[0],new Uh(hp.x,hp.y,0))}else if(On.type==="LineString")for(var Bf=0,dp=On.geometry;Bf<dp.length;Bf+=1){var ed=dp[Bf];yu(ed,new Uh(ed[0].x,ed[0].y,0))}else if(On.type==="Point")for(var Tv=0,VT=On.geometry;Tv<VT.length;Tv+=1)for(var Bv=0,HT=VT[Tv];Bv<HT.length;Bv+=1){var Sv=HT[Bv];yu([Sv],new Uh(Sv.x,Sv.y,0))}}(a,_t,er,rs,x,Y,Jt,mr,tr,Ts,F)},at=0,pt=a.features;at<pt.length;at+=1)qe();I&&a.generateCollisionDebugBuffers()},s.perspective=function(a,u,A,x,E){var I,F=1/Math.tan(u/2);return a[0]=F/A,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=F,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,E!=null&&E!==1/0?(a[10]=(E+x)*(I=1/(x-E)),a[14]=2*E*x*I):(a[10]=-1,a[14]=-2*x),a},s.pick=function(a,u){for(var A={},x=0;x<u.length;x++){var E=u[x];E in a&&(A[E]=a[E])}return A},s.plugin=qi,s.polygonIntersectsPolygon=Fc,s.postMapLoadEvent=ui,s.postTurnstileEvent=Tr,s.potpack=fT,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=nr,s.registerForPluginStateChange=function(a){return a({pluginStatus:xs,pluginURL:Jo}),_i.on("pluginStateChange",a),a},s.renderColorRamp=WE,s.rotate=function(a,u,A){var x=u[0],E=u[1],I=u[2],F=u[3],k=Math.sin(A),H=Math.cos(A);return a[0]=x*H+I*k,a[1]=E*H+F*k,a[2]=x*-k+I*H,a[3]=E*-k+F*H,a},s.rotateX=function(a,u,A){var x=Math.sin(A),E=Math.cos(A),I=u[4],F=u[5],k=u[6],H=u[7],Y=u[8],ee=u[9],se=u[10],he=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=I*E+Y*x,a[5]=F*E+ee*x,a[6]=k*E+se*x,a[7]=H*E+he*x,a[8]=Y*E-I*x,a[9]=ee*E-F*x,a[10]=se*E-k*x,a[11]=he*E-H*x,a},s.rotateZ=function(a,u,A){var x=Math.sin(A),E=Math.cos(A),I=u[0],F=u[1],k=u[2],H=u[3],Y=u[4],ee=u[5],se=u[6],he=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=I*E+Y*x,a[1]=F*E+ee*x,a[2]=k*E+se*x,a[3]=H*E+he*x,a[4]=Y*E-I*x,a[5]=ee*E-F*x,a[6]=se*E-k*x,a[7]=he*E-H*x,a},s.scale=function(a,u,A){var x=A[0],E=A[1],I=A[2];return a[0]=u[0]*x,a[1]=u[1]*x,a[2]=u[2]*x,a[3]=u[3]*x,a[4]=u[4]*E,a[5]=u[5]*E,a[6]=u[6]*E,a[7]=u[7]*E,a[8]=u[8]*I,a[9]=u[9]*I,a[10]=u[10]*I,a[11]=u[11]*I,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},s.scale$1=function(a,u,A){return a[0]=u[0]*A,a[1]=u[1]*A,a[2]=u[2]*A,a[3]=u[3]*A,a},s.scale$2=function(a,u,A){return a[0]=u[0]*A,a[1]=u[1]*A,a[2]=u[2]*A,a},s.setCacheLimits=function(a,u){Pe=a,Dt=u},s.setRTLTextPlugin=function(a,u,A){if(A===void 0&&(A=!1),xs==="deferred"||xs==="loading"||xs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Jo=$t.resolveURL(a),xs="deferred",fu=u,Pc(),A||go()},s.sphericalToCartesian=function(a){var u=a[0],A=a[1],x=a[2];return A+=90,A*=Math.PI/180,x*=Math.PI/180,{x:u*Math.cos(A)*Math.sin(x),y:u*Math.sin(A)*Math.sin(x),z:u*Math.cos(x)}},s.sqrLen=function(a){var u=a[0],A=a[1];return u*u+A*A},s.styleSpec=ce,s.sub=function(a,u,A){return a[0]=u[0]-A[0],a[1]=u[1]-A[1],a[2]=u[2]-A[2],a},s.symbolSize=vU,s.transformMat3=function(a,u,A){var x=u[0],E=u[1],I=u[2];return a[0]=x*A[0]+E*A[3]+I*A[6],a[1]=x*A[1]+E*A[4]+I*A[7],a[2]=x*A[2]+E*A[5]+I*A[8],a},s.transformMat4=Ph,s.translate=function(a,u,A){var x,E,I,F,k,H,Y,ee,se,he,ve,Ue,ze=A[0],je=A[1],Ve=A[2];return u===a?(a[12]=u[0]*ze+u[4]*je+u[8]*Ve+u[12],a[13]=u[1]*ze+u[5]*je+u[9]*Ve+u[13],a[14]=u[2]*ze+u[6]*je+u[10]*Ve+u[14],a[15]=u[3]*ze+u[7]*je+u[11]*Ve+u[15]):(E=u[1],I=u[2],F=u[3],k=u[4],H=u[5],Y=u[6],ee=u[7],se=u[8],he=u[9],ve=u[10],Ue=u[11],a[0]=x=u[0],a[1]=E,a[2]=I,a[3]=F,a[4]=k,a[5]=H,a[6]=Y,a[7]=ee,a[8]=se,a[9]=he,a[10]=ve,a[11]=Ue,a[12]=x*ze+k*je+se*Ve+u[12],a[13]=E*ze+H*je+he*Ve+u[13],a[14]=I*ze+Y*je+ve*Ve+u[14],a[15]=F*ze+ee*je+Ue*Ve+u[15]),a},s.triggerPluginCompletionEvent=pf,s.uniqueId=fe,s.validateCustomStyleLayer=function(a){var u=[],A=a.id;return A===void 0&&u.push({message:"layers."+A+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+A+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+A+': property "renderingMode" must be either "2d" or "3d"'}),u},s.validateLight=WA,s.validateStyle=yl,s.values=function(a){var u=[];for(var A in a)u.push(a[A]);return u},s.vectorTile=Dh,s.version="1.13.3",s.warnOnce=ne,s.webpSupported=lr,s.window=S,s.wrap=z}),o(["./shared"],function(s){function c(q){var ie=typeof q;if(ie==="number"||ie==="boolean"||ie==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){for(var ue="[",be=0,De=q;be<De.length;be+=1)ue+=c(De[be])+",";return ue+"]"}for(var Ae=Object.keys(q).sort(),xe="{",ce=0;ce<Ae.length;ce++)xe+=JSON.stringify(Ae[ce])+":"+c(q[Ae[ce]])+",";return xe+"}"}function f(q){for(var ie="",ue=0,be=s.refProperties;ue<be.length;ue+=1)ie+="/"+c(q[be[ue]]);return ie}var _=function(q){this.keyCache={},q&&this.replace(q)};_.prototype.replace=function(q){this._layerConfigs={},this._layers={},this.update(q,[])},_.prototype.update=function(q,ie){for(var ue=this,be=0,De=q;be<De.length;be+=1){var Ae=De[be];this._layerConfigs[Ae.id]=Ae;var xe=this._layers[Ae.id]=s.createStyleLayer(Ae);xe._featureFilter=s.featureFilter(xe.filter),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id]}for(var ce=0,Se=ie;ce<Se.length;ce+=1){var p=Se[ce];delete this.keyCache[p],delete this._layerConfigs[p],delete this._layers[p]}this.familiesBySource={};for(var le=0,vt=function(St,zt){for(var Fr={},qt=0;qt<St.length;qt++){var Xr=zt&&zt[St[qt].id]||f(St[qt]);zt&&(zt[St[qt].id]=Xr);var en=Fr[Xr];en||(en=Fr[Xr]=[]),en.push(St[qt])}var zr=[];for(var Gr in Fr)zr.push(Fr[Gr]);return zr}(s.values(this._layerConfigs),this.keyCache);le<vt.length;le+=1){var Ke=vt[le].map(function(St){return ue._layers[St.id]}),Ct=Ke[0];if(Ct.visibility!=="none"){var It=Ct.source||"",Ft=this.familiesBySource[It];Ft||(Ft=this.familiesBySource[It]={});var ut=Ct.sourceLayer||"_geojsonTileLayer",Ot=Ft[ut];Ot||(Ot=Ft[ut]=[]),Ot.push(Ke)}}};var b=function(q){var ie={},ue=[];for(var be in q){var De=q[be],Ae=ie[be]={};for(var xe in De){var ce=De[+xe];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var Se={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};ue.push(Se),Ae[xe]={rect:Se,metrics:ce.metrics}}}}var p=s.potpack(ue),le=new s.AlphaImage({width:p.w||1,height:p.h||1});for(var vt in q){var Ke=q[vt];for(var Ct in Ke){var It=Ke[+Ct];if(It&&It.bitmap.width!==0&&It.bitmap.height!==0){var Ft=ie[vt][Ct].rect;s.AlphaImage.copy(It.bitmap,le,{x:0,y:0},{x:Ft.x+1,y:Ft.y+1},It.bitmap)}}}this.image=le,this.positions=ie};s.register("GlyphAtlas",b);var T=function(q){this.tileID=new s.OverscaledTileID(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId};function S(q,ie,ue){for(var be=new s.EvaluationParameters(ie),De=0,Ae=q;De<Ae.length;De+=1)Ae[De].recalculate(be,ue)}function D(q,ie){var ue=s.getArrayBuffer(q.request,function(be,De,Ae,xe){be?ie(be):De&&ie(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(De)),rawData:De,cacheControl:Ae,expires:xe})});return function(){ue.cancel(),ie()}}T.prototype.parse=function(q,ie,ue,be,De){var Ae=this;this.status="parsing",this.data=q,this.collisionBoxArray=new s.CollisionBoxArray;var xe=new s.DictionaryCoder(Object.keys(q.layers).sort()),ce=new s.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var Se,p,le,vt,Ke={},Ct={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ue},It=ie.familiesBySource[this.source];for(var Ft in It){var ut=q.layers[Ft];if(ut){ut.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+Ft+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ot=xe.encode(Ft),St=[],zt=0;zt<ut.length;zt++){var Fr=ut.feature(zt),qt=ce.getId(Fr,Ft);St.push({feature:Fr,id:qt,index:zt,sourceLayerIndex:Ot})}for(var Xr=0,en=It[Ft];Xr<en.length;Xr+=1){var zr=en[Xr],Gr=zr[0];Gr.minzoom&&this.zoom<Math.floor(Gr.minzoom)||Gr.maxzoom&&this.zoom>=Gr.maxzoom||Gr.visibility!=="none"&&(S(zr,this.zoom,ue),(Ke[Gr.id]=Gr.createBucket({index:ce.bucketLayerIDs.length,layers:zr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ot,sourceID:this.source})).populate(St,Ct,this.tileID.canonical),ce.bucketLayerIDs.push(zr.map(function(Me){return Me.id})))}}}var Lr=s.mapObject(Ct.glyphDependencies,function(Me){return Object.keys(Me).map(Number)});Object.keys(Lr).length?be.send("getGlyphs",{uid:this.uid,stacks:Lr},function(Me,Wt){Se||(Se=Me,p=Wt,fr.call(Ae))}):p={};var fi=Object.keys(Ct.iconDependencies);fi.length?be.send("getImages",{icons:fi,source:this.source,tileID:this.tileID,type:"icons"},function(Me,Wt){Se||(Se=Me,le=Wt,fr.call(Ae))}):le={};var Vr=Object.keys(Ct.patternDependencies);function fr(){if(Se)return De(Se);if(p&&le&&vt){var Me=new b(p),Wt=new s.ImageAtlas(le,vt);for(var Kr in Ke){var Ui=Ke[Kr];Ui instanceof s.SymbolBucket?(S(Ui.layers,this.zoom,ue),s.performSymbolLayout(Ui,p,Me.positions,le,Wt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ui.hasPattern&&(Ui instanceof s.LineBucket||Ui instanceof s.FillBucket||Ui instanceof s.FillExtrusionBucket)&&(S(Ui.layers,this.zoom,ue),Ui.addFeatures(Ct,this.tileID.canonical,Wt.patternPositions))}this.status="done",De(null,{buckets:s.values(Ke).filter(function(la){return!la.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Me.image,imageAtlas:Wt,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?le:null,glyphPositions:this.returnDependencies?Me.positions:null})}}Vr.length?be.send("getImages",{icons:Vr,source:this.source,tileID:this.tileID,type:"patterns"},function(Me,Wt){Se||(Se=Me,vt=Wt,fr.call(Ae))}):vt={},fr.call(this)};var N=function(q,ie,ue,be){this.actor=q,this.layerIndex=ie,this.availableImages=ue,this.loadVectorData=be||D,this.loading={},this.loaded={}};N.prototype.loadTile=function(q,ie){var ue=this,be=q.uid;this.loading||(this.loading={});var De=!!(q&&q.request&&q.request.collectResourceTiming)&&new s.RequestPerformance(q.request),Ae=this.loading[be]=new T(q);Ae.abort=this.loadVectorData(q,function(xe,ce){if(delete ue.loading[be],xe||!ce)return Ae.status="done",ue.loaded[be]=Ae,ie(xe);var Se=ce.rawData,p={};ce.expires&&(p.expires=ce.expires),ce.cacheControl&&(p.cacheControl=ce.cacheControl);var le={};if(De){var vt=De.finish();vt&&(le.resourceTiming=JSON.parse(JSON.stringify(vt)))}Ae.vectorTile=ce.vectorTile,Ae.parse(ce.vectorTile,ue.layerIndex,ue.availableImages,ue.actor,function(Ke,Ct){if(Ke||!Ct)return ie(Ke);ie(null,s.extend({rawTileData:Se.slice(0)},Ct,p,le))}),ue.loaded=ue.loaded||{},ue.loaded[be]=Ae})},N.prototype.reloadTile=function(q,ie){var ue=this,be=this.loaded,De=q.uid,Ae=this;if(be&&be[De]){var xe=be[De];xe.showCollisionBoxes=q.showCollisionBoxes;var ce=function(Se,p){var le=xe.reloadCallback;le&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,Ae.layerIndex,ue.availableImages,Ae.actor,le)),ie(Se,p)};xe.status==="parsing"?xe.reloadCallback=ce:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},N.prototype.abortTile=function(q,ie){var ue=this.loading,be=q.uid;ue&&ue[be]&&ue[be].abort&&(ue[be].abort(),delete ue[be]),ie()},N.prototype.removeTile=function(q,ie){var ue=this.loaded,be=q.uid;ue&&ue[be]&&delete ue[be],ie()};var G=s.window.ImageBitmap,W=function(){this.loaded={}};function z(q,ie){if(q.length!==0){j(q[0],ie);for(var ue=1;ue<q.length;ue++)j(q[ue],!1)}}function j(q,ie){for(var ue=0,be=0,De=0,Ae=q.length,xe=Ae-1;De<Ae;xe=De++){var ce=(q[De][0]-q[xe][0])*(q[xe][1]+q[De][1]),Se=ue+ce;be+=Math.abs(ue)>=Math.abs(ce)?ue-Se+ce:ce-Se+ue,ue=Se}ue+be>=0!=!!ie&&q.reverse()}W.prototype.loadTile=function(q,ie){var ue=q.uid,be=q.encoding,De=q.rawImageData,Ae=G&&De instanceof G?this.getImageData(De):De,xe=new s.DEMData(ue,Ae,be);this.loaded=this.loaded||{},this.loaded[ue]=xe,ie(null,xe)},W.prototype.getImageData=function(q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,q.width+2,q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:ie.width,height:ie.height},ie.data)},W.prototype.removeTile=function(q){var ie=this.loaded,ue=q.uid;ie&&ie[ue]&&delete ie[ue]};var K=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,fe=function(q){this._feature=q,this.extent=s.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))};fe.prototype.loadGeometry=function(){if(this._feature.type===1){for(var q=[],ie=0,ue=this._feature.geometry;ie<ue.length;ie+=1){var be=ue[ie];q.push([new s.Point$1(be[0],be[1])])}return q}for(var De=[],Ae=0,xe=this._feature.geometry;Ae<xe.length;Ae+=1){for(var ce=[],Se=0,p=xe[Ae];Se<p.length;Se+=1){var le=p[Se];ce.push(new s.Point$1(le[0],le[1]))}De.push(ce)}return De},fe.prototype.toGeoJSON=function(q,ie,ue){return K.call(this,q,ie,ue)};var Z=function(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=q.length,this._features=q};Z.prototype.feature=function(q){return new fe(this._features[q])};var ae=s.vectorTile.VectorTileFeature,Be=Le;function Le(q,ie){this.options=ie||{},this.features=q,this.length=q.length}function de(q,ie){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=ie||4096}Le.prototype.feature=function(q){return new de(this.features[q],this.options.extent)},de.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var ie=0;ie<q.length;ie++){for(var ue=q[ie],be=[],De=0;De<ue.length;De++)be.push(new s.Point$1(ue[De][0],ue[De][1]));this.geometry.push(be)}return this.geometry},de.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,ie=1/0,ue=-1/0,be=1/0,De=-1/0,Ae=0;Ae<q.length;Ae++)for(var xe=q[Ae],ce=0;ce<xe.length;ce++){var Se=xe[ce];ie=Math.min(ie,Se.x),ue=Math.max(ue,Se.x),be=Math.min(be,Se.y),De=Math.max(De,Se.y)}return[ie,be,ue,De]},de.prototype.toGeoJSON=ae.prototype.toGeoJSON;var _e=J,pe=Be;function J(q){var ie=new s.pbf;return function(ue,be){for(var De in ue.layers)be.writeMessage(3,ne,ue.layers[De])}(q,ie),ie.finish()}function ne(q,ie){var ue;ie.writeVarintField(15,q.version||1),ie.writeStringField(1,q.name||""),ie.writeVarintField(5,q.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<q.length;ue++)be.feature=q.feature(ue),ie.writeMessage(2,ye,be);var De=be.keys;for(ue=0;ue<De.length;ue++)ie.writeStringField(3,De[ue]);var Ae=be.values;for(ue=0;ue<Ae.length;ue++)ie.writeMessage(4,Qe,Ae[ue])}function ye(q,ie){var ue=q.feature;ue.id!==void 0&&ie.writeVarintField(1,ue.id),ie.writeMessage(2,Ye,q),ie.writeVarintField(3,ue.type),ie.writeMessage(4,Ge,ue)}function Ye(q,ie){var ue=q.feature,be=q.keys,De=q.values,Ae=q.keycache,xe=q.valuecache;for(var ce in ue.properties){var Se=Ae[ce];Se===void 0&&(be.push(ce),Ae[ce]=Se=be.length-1),ie.writeVarint(Se);var p=ue.properties[ce],le=typeof p;le!=="string"&&le!=="boolean"&&le!=="number"&&(p=JSON.stringify(p));var vt=le+":"+p,Ke=xe[vt];Ke===void 0&&(De.push(p),xe[vt]=Ke=De.length-1),ie.writeVarint(Ke)}}function we(q,ie){return(ie<<3)+(7&q)}function Ne(q){return q<<1^q>>31}function Ge(q,ie){for(var ue=q.loadGeometry(),be=q.type,De=0,Ae=0,xe=ue.length,ce=0;ce<xe;ce++){var Se=ue[ce],p=1;be===1&&(p=Se.length),ie.writeVarint(we(1,p));for(var le=be===3?Se.length-1:Se.length,vt=0;vt<le;vt++){vt===1&&be!==1&&ie.writeVarint(we(2,le-1));var Ke=Se[vt].x-De,Ct=Se[vt].y-Ae;ie.writeVarint(Ne(Ke)),ie.writeVarint(Ne(Ct)),De+=Ke,Ae+=Ct}be===3&&ie.writeVarint(we(7,1))}}function Qe(q,ie){var ue=typeof q;ue==="string"?ie.writeStringField(1,q):ue==="boolean"?ie.writeBooleanField(7,q):ue==="number"&&(q%1!=0?ie.writeDoubleField(3,q):q<0?ie.writeSVarintField(6,q):ie.writeVarintField(5,q))}function rt(q,ie,ue,be){tt(q,ue,be),tt(ie,2*ue,2*be),tt(ie,2*ue+1,2*be+1)}function tt(q,ie,ue){var be=q[ie];q[ie]=q[ue],q[ue]=be}function lt(q,ie,ue,be){var De=q-ue,Ae=ie-be;return De*De+Ae*Ae}_e.fromVectorTileJs=J,_e.fromGeojsonVt=function(q,ie){ie=ie||{};var ue={};for(var be in q)ue[be]=new Be(q[be].features,ie),ue[be].name=be,ue[be].version=ie.version,ue[be].extent=ie.extent;return J({layers:ue})},_e.GeoJSONWrapper=pe;var mt=function(q){return q[0]},Tt=function(q){return q[1]},nt=function(q,ie,ue,be,De){ie===void 0&&(ie=mt),ue===void 0&&(ue=Tt),be===void 0&&(be=64),De===void 0&&(De=Float64Array),this.nodeSize=be,this.points=q;for(var Ae=q.length<65536?Uint16Array:Uint32Array,xe=this.ids=new Ae(q.length),ce=this.coords=new De(2*q.length),Se=0;Se<q.length;Se++)xe[Se]=Se,ce[2*Se]=ie(q[Se]),ce[2*Se+1]=ue(q[Se]);(function p(le,vt,Ke,Ct,It,Ft){if(!(It-Ct<=Ke)){var ut=Ct+It>>1;(function Ot(St,zt,Fr,qt,Xr,en){for(;Xr>qt;){if(Xr-qt>600){var zr=Xr-qt+1,Gr=Fr-qt+1,Lr=Math.log(zr),fi=.5*Math.exp(2*Lr/3),Vr=.5*Math.sqrt(Lr*fi*(zr-fi)/zr)*(Gr-zr/2<0?-1:1);Ot(St,zt,Fr,Math.max(qt,Math.floor(Fr-Gr*fi/zr+Vr)),Math.min(Xr,Math.floor(Fr+(zr-Gr)*fi/zr+Vr)),en)}var fr=zt[2*Fr+en],Me=qt,Wt=Xr;for(rt(St,zt,qt,Fr),zt[2*Xr+en]>fr&&rt(St,zt,qt,Xr);Me<Wt;){for(rt(St,zt,Me,Wt),Me++,Wt--;zt[2*Me+en]<fr;)Me++;for(;zt[2*Wt+en]>fr;)Wt--}zt[2*qt+en]===fr?rt(St,zt,qt,Wt):rt(St,zt,++Wt,Xr),Wt<=Fr&&(qt=Wt+1),Fr<=Wt&&(Xr=Wt-1)}})(le,vt,ut,Ct,It,Ft%2),p(le,vt,Ke,Ct,ut-1,Ft+1),p(le,vt,Ke,ut+1,It,Ft+1)}})(xe,ce,be,0,xe.length-1,0)};nt.prototype.range=function(q,ie,ue,be){return function(De,Ae,xe,ce,Se,p,le){for(var vt,Ke,Ct=[0,De.length-1,0],It=[];Ct.length;){var Ft=Ct.pop(),ut=Ct.pop(),Ot=Ct.pop();if(ut-Ot<=le)for(var St=Ot;St<=ut;St++)Ke=Ae[2*St+1],(vt=Ae[2*St])>=xe&&vt<=Se&&Ke>=ce&&Ke<=p&&It.push(De[St]);else{var zt=Math.floor((Ot+ut)/2);Ke=Ae[2*zt+1],(vt=Ae[2*zt])>=xe&&vt<=Se&&Ke>=ce&&Ke<=p&&It.push(De[zt]);var Fr=(Ft+1)%2;(Ft===0?xe<=vt:ce<=Ke)&&(Ct.push(Ot),Ct.push(zt-1),Ct.push(Fr)),(Ft===0?Se>=vt:p>=Ke)&&(Ct.push(zt+1),Ct.push(ut),Ct.push(Fr))}}return It}(this.ids,this.coords,q,ie,ue,be,this.nodeSize)},nt.prototype.within=function(q,ie,ue){return function(be,De,Ae,xe,ce,Se){for(var p=[0,be.length-1,0],le=[],vt=ce*ce;p.length;){var Ke=p.pop(),Ct=p.pop(),It=p.pop();if(Ct-It<=Se)for(var Ft=It;Ft<=Ct;Ft++)lt(De[2*Ft],De[2*Ft+1],Ae,xe)<=vt&&le.push(be[Ft]);else{var ut=Math.floor((It+Ct)/2),Ot=De[2*ut],St=De[2*ut+1];lt(Ot,St,Ae,xe)<=vt&&le.push(be[ut]);var zt=(Ke+1)%2;(Ke===0?Ae-ce<=Ot:xe-ce<=St)&&(p.push(It),p.push(ut-1),p.push(zt)),(Ke===0?Ae+ce>=Ot:xe+ce>=St)&&(p.push(ut+1),p.push(Ct),p.push(zt))}}return le}(this.ids,this.coords,q,ie,ue,this.nodeSize)};var cr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(q){return q}},Xt=function(q){this.options=Mn(Object.create(cr),q),this.trees=new Array(this.options.maxZoom+1)};function $t(q,ie,ue,be,De){return{x:q,y:ie,zoom:1/0,id:ue,parentId:-1,numPoints:be,properties:De}}function Lt(q,ie){var ue=q.geometry.coordinates,be=ue[1];return{x:Er(ue[0]),y:Ar(be),zoom:1/0,index:ie,parentId:-1}}function lr(q){return{type:"Feature",id:q.id,properties:tn(q),geometry:{type:"Point",coordinates:[(be=q.x,360*(be-.5)),(ie=q.y,ue=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(ue))/Math.PI-90)]}};var ie,ue,be}function tn(q){var ie=q.numPoints,ue=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Mn(Mn({},q.properties),{cluster:!0,cluster_id:q.id,point_count:ie,point_count_abbreviated:ue})}function Er(q){return q/360+.5}function Ar(q){var ie=Math.sin(q*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function Mn(q,ie){for(var ue in ie)q[ue]=ie[ue];return q}function hr(q){return q.x}function pr(q){return q.y}function rn(q,ie,ue,be,De,Ae){var xe=De-ue,ce=Ae-be;if(xe!==0||ce!==0){var Se=((q-ue)*xe+(ie-be)*ce)/(xe*xe+ce*ce);Se>1?(ue=De,be=Ae):Se>0&&(ue+=xe*Se,be+=ce*Se)}return(xe=q-ue)*xe+(ce=ie-be)*ce}function Sr(q,ie,ue,be){var De={id:q===void 0?null:q,type:ie,geometry:ue,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ae){var xe=Ae.geometry,ce=Ae.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")ei(Ae,xe);else if(ce==="Polygon"||ce==="MultiLineString")for(var Se=0;Se<xe.length;Se++)ei(Ae,xe[Se]);else if(ce==="MultiPolygon")for(Se=0;Se<xe.length;Se++)for(var p=0;p<xe[Se].length;p++)ei(Ae,xe[Se][p])}(De),De}function ei(q,ie){for(var ue=0;ue<ie.length;ue+=3)q.minX=Math.min(q.minX,ie[ue]),q.minY=Math.min(q.minY,ie[ue+1]),q.maxX=Math.max(q.maxX,ie[ue]),q.maxY=Math.max(q.maxY,ie[ue+1])}function $n(q,ie,ue,be){if(ie.geometry){var De=ie.geometry.coordinates,Ae=ie.geometry.type,xe=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2),ce=[],Se=ie.id;if(ue.promoteId?Se=ie.properties[ue.promoteId]:ue.generateId&&(Se=be||0),Ae==="Point")un(De,ce);else if(Ae==="MultiPoint")for(var p=0;p<De.length;p++)un(De[p],ce);else if(Ae==="LineString")Xn(De,ce,xe,!1);else if(Ae==="MultiLineString"){if(ue.lineMetrics){for(p=0;p<De.length;p++)Xn(De[p],ce=[],xe,!1),q.push(Sr(Se,"LineString",ce,ie.properties));return}Nn(De,ce,xe,!1)}else if(Ae==="Polygon")Nn(De,ce,xe,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(p=0;p<ie.geometry.geometries.length;p++)$n(q,{id:Se,geometry:ie.geometry.geometries[p],properties:ie.properties},ue,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<De.length;p++){var le=[];Nn(De[p],le,xe,!0),ce.push(le)}}q.push(Sr(Se,Ae,ce,ie.properties))}}function un(q,ie){ie.push(bn(q[0])),ie.push(Wn(q[1])),ie.push(0)}function Xn(q,ie,ue,be){for(var De,Ae,xe=0,ce=0;ce<q.length;ce++){var Se=bn(q[ce][0]),p=Wn(q[ce][1]);ie.push(Se),ie.push(p),ie.push(0),ce>0&&(xe+=be?(De*p-Se*Ae)/2:Math.sqrt(Math.pow(Se-De,2)+Math.pow(p-Ae,2))),De=Se,Ae=p}var le=ie.length-3;ie[2]=1,function vt(Ke,Ct,It,Ft){for(var ut,Ot=Ft,St=It-Ct>>1,zt=It-Ct,Fr=Ke[Ct],qt=Ke[Ct+1],Xr=Ke[It],en=Ke[It+1],zr=Ct+3;zr<It;zr+=3){var Gr=rn(Ke[zr],Ke[zr+1],Fr,qt,Xr,en);if(Gr>Ot)ut=zr,Ot=Gr;else if(Gr===Ot){var Lr=Math.abs(zr-St);Lr<zt&&(ut=zr,zt=Lr)}}Ot>Ft&&(ut-Ct>3&&vt(Ke,Ct,ut,Ft),Ke[ut+2]=Ot,It-ut>3&&vt(Ke,ut,It,Ft))}(ie,0,le,ue),ie[le+2]=1,ie.size=Math.abs(xe),ie.start=0,ie.end=ie.size}function Nn(q,ie,ue,be){for(var De=0;De<q.length;De++){var Ae=[];Xn(q[De],Ae,ue,be),ie.push(Ae)}}function bn(q){return q/360+.5}function Wn(q){var ie=Math.sin(q*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function Ut(q,ie,ue,be,De,Ae,xe,ce){if(be/=ie,Ae>=(ue/=ie)&&xe<be)return q;if(xe<ue||Ae>=be)return null;for(var Se=[],p=0;p<q.length;p++){var le=q[p],vt=le.geometry,Ke=le.type,Ct=De===0?le.minX:le.minY,It=De===0?le.maxX:le.maxY;if(Ct>=ue&&It<be)Se.push(le);else if(!(It<ue||Ct>=be)){var Ft=[];if(Ke==="Point"||Ke==="MultiPoint")dr(vt,Ft,ue,be,De);else if(Ke==="LineString")Tr(vt,Ft,ue,be,De,!1,ce.lineMetrics);else if(Ke==="MultiLineString")ui(vt,Ft,ue,be,De,!1);else if(Ke==="Polygon")ui(vt,Ft,ue,be,De,!0);else if(Ke==="MultiPolygon")for(var ut=0;ut<vt.length;ut++){var Ot=[];ui(vt[ut],Ot,ue,be,De,!0),Ot.length&&Ft.push(Ot)}if(Ft.length){if(ce.lineMetrics&&Ke==="LineString"){for(ut=0;ut<Ft.length;ut++)Se.push(Sr(le.id,Ke,Ft[ut],le.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Ft.length===1?(Ke="LineString",Ft=Ft[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Ft.length===3?"Point":"MultiPoint"),Se.push(Sr(le.id,Ke,Ft,le.tags))}}}return Se.length?Se:null}function dr(q,ie,ue,be,De){for(var Ae=0;Ae<q.length;Ae+=3){var xe=q[Ae+De];xe>=ue&&xe<=be&&(ie.push(q[Ae]),ie.push(q[Ae+1]),ie.push(q[Ae+2]))}}function Tr(q,ie,ue,be,De,Ae,xe){for(var ce,Se,p=qr(q),le=De===0?Dt:Vt,vt=q.start,Ke=0;Ke<q.length-3;Ke+=3){var Ct=q[Ke],It=q[Ke+1],Ft=q[Ke+2],ut=q[Ke+3],Ot=q[Ke+4],St=De===0?Ct:It,zt=De===0?ut:Ot,Fr=!1;xe&&(ce=Math.sqrt(Math.pow(Ct-ut,2)+Math.pow(It-Ot,2))),St<ue?zt>ue&&(Se=le(p,Ct,It,ut,Ot,ue),xe&&(p.start=vt+ce*Se)):St>be?zt<be&&(Se=le(p,Ct,It,ut,Ot,be),xe&&(p.start=vt+ce*Se)):Pe(p,Ct,It,Ft),zt<ue&&St>=ue&&(Se=le(p,Ct,It,ut,Ot,ue),Fr=!0),zt>be&&St<=be&&(Se=le(p,Ct,It,ut,Ot,be),Fr=!0),!Ae&&Fr&&(xe&&(p.end=vt+ce*Se),ie.push(p),p=qr(q)),xe&&(vt+=ce)}var qt=q.length-3;Ct=q[qt],It=q[qt+1],Ft=q[qt+2],(St=De===0?Ct:It)>=ue&&St<=be&&Pe(p,Ct,It,Ft),qt=p.length-3,Ae&&qt>=3&&(p[qt]!==p[0]||p[qt+1]!==p[1])&&Pe(p,p[0],p[1],p[2]),p.length&&ie.push(p)}function qr(q){var ie=[];return ie.size=q.size,ie.start=q.start,ie.end=q.end,ie}function ui(q,ie,ue,be,De,Ae){for(var xe=0;xe<q.length;xe++)Tr(q[xe],ie,ue,be,De,Ae,!1)}function Pe(q,ie,ue,be){q.push(ie),q.push(ue),q.push(be)}function Dt(q,ie,ue,be,De,Ae){var xe=(Ae-ie)/(be-ie);return q.push(Ae),q.push(ue+(De-ue)*xe),q.push(1),xe}function Vt(q,ie,ue,be,De,Ae){var xe=(Ae-ue)/(De-ue);return q.push(ie+(be-ie)*xe),q.push(Ae),q.push(1),xe}function sr(q,ie){for(var ue=[],be=0;be<q.length;be++){var De,Ae=q[be],xe=Ae.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")De=Ze(Ae.geometry,ie);else if(xe==="MultiLineString"||xe==="Polygon"){De=[];for(var ce=0;ce<Ae.geometry.length;ce++)De.push(Ze(Ae.geometry[ce],ie))}else if(xe==="MultiPolygon")for(De=[],ce=0;ce<Ae.geometry.length;ce++){for(var Se=[],p=0;p<Ae.geometry[ce].length;p++)Se.push(Ze(Ae.geometry[ce][p],ie));De.push(Se)}ue.push(Sr(Ae.id,xe,De,Ae.tags))}return ue}function Ze(q,ie){var ue=[];ue.size=q.size,q.start!==void 0&&(ue.start=q.start,ue.end=q.end);for(var be=0;be<q.length;be+=3)ue.push(q[be]+ie,q[be+1],q[be+2]);return ue}function Mt(q,ie){if(q.transformed)return q;var ue,be,De,Ae=1<<q.z,xe=q.x,ce=q.y;for(ue=0;ue<q.features.length;ue++){var Se=q.features[ue],p=Se.geometry,le=Se.type;if(Se.geometry=[],le===1)for(be=0;be<p.length;be+=2)Se.geometry.push(ge(p[be],p[be+1],ie,Ae,xe,ce));else for(be=0;be<p.length;be++){var vt=[];for(De=0;De<p[be].length;De+=2)vt.push(ge(p[be][De],p[be][De+1],ie,Ae,xe,ce));Se.geometry.push(vt)}}return q.transformed=!0,q}function ge(q,ie,ue,be,De,Ae){return[Math.round(ue*(q*be-De)),Math.round(ue*(ie*be-Ae))]}function Nt(q,ie,ue,be,De){for(var Ae=ie===De.maxZoom?0:De.tolerance/((1<<ie)*De.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ue,y:be,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<q.length;ce++){xe.numFeatures++,wt(xe,q[ce],Ae,De);var Se=q[ce].minX,p=q[ce].minY,le=q[ce].maxX,vt=q[ce].maxY;Se<xe.minX&&(xe.minX=Se),p<xe.minY&&(xe.minY=p),le>xe.maxX&&(xe.maxX=le),vt>xe.maxY&&(xe.maxY=vt)}return xe}function wt(q,ie,ue,be){var De=ie.geometry,Ae=ie.type,xe=[];if(Ae==="Point"||Ae==="MultiPoint")for(var ce=0;ce<De.length;ce+=3)xe.push(De[ce]),xe.push(De[ce+1]),q.numPoints++,q.numSimplified++;else if(Ae==="LineString")$(xe,De,q,ue,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(ce=0;ce<De.length;ce++)$(xe,De[ce],q,ue,Ae==="Polygon",ce===0);else if(Ae==="MultiPolygon")for(var Se=0;Se<De.length;Se++){var p=De[Se];for(ce=0;ce<p.length;ce++)$(xe,p[ce],q,ue,!0,ce===0)}if(xe.length){var le=ie.tags||null;if(Ae==="LineString"&&be.lineMetrics){for(var vt in le={},ie.tags)le[vt]=ie.tags[vt];le.mapbox_clip_start=De.start/De.size,le.mapbox_clip_end=De.end/De.size}var Ke={geometry:xe,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:le};ie.id!==null&&(Ke.id=ie.id),q.features.push(Ke)}}function $(q,ie,ue,be,De,Ae){var xe=be*be;if(be>0&&ie.size<(De?xe:be))ue.numPoints+=ie.length/3;else{for(var ce=[],Se=0;Se<ie.length;Se+=3)(be===0||ie[Se+2]>xe)&&(ue.numSimplified++,ce.push(ie[Se]),ce.push(ie[Se+1])),ue.numPoints++;De&&function(p,le){for(var vt=0,Ke=0,Ct=p.length,It=Ct-2;Ke<Ct;It=Ke,Ke+=2)vt+=(p[Ke]-p[It])*(p[Ke+1]+p[It+1]);if(vt>0===le)for(Ke=0,Ct=p.length;Ke<Ct/2;Ke+=2){var Ft=p[Ke],ut=p[Ke+1];p[Ke]=p[Ct-2-Ke],p[Ke+1]=p[Ct-1-Ke],p[Ct-2-Ke]=Ft,p[Ct-1-Ke]=ut}}(ce,Ae),q.push(ce)}}function yt(q,ie){var ue=(ie=this.options=function(De,Ae){for(var xe in Ae)De[xe]=Ae[xe];return De}(Object.create(this.options),ie)).debug;if(ue&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var be=function(De,Ae){var xe=[];if(De.type==="FeatureCollection")for(var ce=0;ce<De.features.length;ce++)$n(xe,De.features[ce],Ae,ce);else $n(xe,De.type==="Feature"?De:{geometry:De},Ae);return xe}(q,ie);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(be=function(De,Ae){var xe=Ae.buffer/Ae.extent,ce=De,Se=Ut(De,1,-1-xe,xe,0,-1,2,Ae),p=Ut(De,1,1-xe,2+xe,0,-1,2,Ae);return(Se||p)&&(ce=Ut(De,1,-xe,1+xe,0,-1,2,Ae)||[],Se&&(ce=sr(Se,1).concat(ce)),p&&(ce=ce.concat(sr(p,-1)))),ce}(be,ie)).length&&this.splitTile(be,0,0,0),ue&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Et(q,ie,ue){return 32*((1<<q)*ue+ie)+q}function Te(q,ie){var ue=q.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var be=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!be)return ie(null,null);var De=new Z(be.features),Ae=_e(De);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),ie(null,{vectorTile:De,rawData:Ae.buffer})}Xt.prototype.load=function(q){var ie=this.options,ue=ie.log,be=ie.minZoom,De=ie.maxZoom,Ae=ie.nodeSize;ue&&console.time("total time");var xe="prepare "+q.length+" points";ue&&console.time(xe),this.points=q;for(var ce=[],Se=0;Se<q.length;Se++)q[Se].geometry&&ce.push(Lt(q[Se],Se));this.trees[De+1]=new nt(ce,hr,pr,Ae,Float32Array),ue&&console.timeEnd(xe);for(var p=De;p>=be;p--){var le=+Date.now();ce=this._cluster(ce,p),this.trees[p]=new nt(ce,hr,pr,Ae,Float32Array),ue&&console.log("z%d: %d clusters in %dms",p,ce.length,+Date.now()-le)}return ue&&console.timeEnd("total time"),this},Xt.prototype.getClusters=function(q,ie){var ue=((q[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,q[1])),De=q[2]===180?180:((q[2]+180)%360+360)%360-180,Ae=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ue=-180,De=180;else if(ue>De){var xe=this.getClusters([ue,be,180,Ae],ie),ce=this.getClusters([-180,be,De,Ae],ie);return xe.concat(ce)}for(var Se=this.trees[this._limitZoom(ie)],p=[],le=0,vt=Se.range(Er(ue),Ar(Ae),Er(De),Ar(be));le<vt.length;le+=1){var Ke=Se.points[vt[le]];p.push(Ke.numPoints?lr(Ke):this.points[Ke.index])}return p},Xt.prototype.getChildren=function(q){var ie=this._getOriginId(q),ue=this._getOriginZoom(q),be="No cluster with the specified id.",De=this.trees[ue];if(!De)throw new Error(be);var Ae=De.points[ie];if(!Ae)throw new Error(be);for(var xe=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),ce=[],Se=0,p=De.within(Ae.x,Ae.y,xe);Se<p.length;Se+=1){var le=De.points[p[Se]];le.parentId===q&&ce.push(le.numPoints?lr(le):this.points[le.index])}if(ce.length===0)throw new Error(be);return ce},Xt.prototype.getLeaves=function(q,ie,ue){var be=[];return this._appendLeaves(be,q,ie=ie||10,ue=ue||0,0),be},Xt.prototype.getTile=function(q,ie,ue){var be=this.trees[this._limitZoom(q)],De=Math.pow(2,q),Ae=this.options,xe=Ae.radius/Ae.extent,ce=(ue-xe)/De,Se=(ue+1+xe)/De,p={features:[]};return this._addTileFeatures(be.range((ie-xe)/De,ce,(ie+1+xe)/De,Se),be.points,ie,ue,De,p),ie===0&&this._addTileFeatures(be.range(1-xe/De,ce,1,Se),be.points,De,ue,De,p),ie===De-1&&this._addTileFeatures(be.range(0,ce,xe/De,Se),be.points,-1,ue,De,p),p.features.length?p:null},Xt.prototype.getClusterExpansionZoom=function(q){for(var ie=this._getOriginZoom(q)-1;ie<=this.options.maxZoom;){var ue=this.getChildren(q);if(ie++,ue.length!==1)break;q=ue[0].properties.cluster_id}return ie},Xt.prototype._appendLeaves=function(q,ie,ue,be,De){for(var Ae=0,xe=this.getChildren(ie);Ae<xe.length;Ae+=1){var ce=xe[Ae],Se=ce.properties;if(Se&&Se.cluster?De+Se.point_count<=be?De+=Se.point_count:De=this._appendLeaves(q,Se.cluster_id,ue,be,De):De<be?De++:q.push(ce),q.length===ue)break}return De},Xt.prototype._addTileFeatures=function(q,ie,ue,be,De,Ae){for(var xe=0,ce=q;xe<ce.length;xe+=1){var Se=ie[ce[xe]],p=Se.numPoints,le={type:1,geometry:[[Math.round(this.options.extent*(Se.x*De-ue)),Math.round(this.options.extent*(Se.y*De-be))]],tags:p?tn(Se):this.points[Se.index].properties},vt=void 0;p?vt=Se.id:this.options.generateId?vt=Se.index:this.points[Se.index].id&&(vt=this.points[Se.index].id),vt!==void 0&&(le.id=vt),Ae.features.push(le)}},Xt.prototype._limitZoom=function(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))},Xt.prototype._cluster=function(q,ie){for(var ue=[],be=this.options,De=be.reduce,Ae=be.minPoints,xe=be.radius/(be.extent*Math.pow(2,ie)),ce=0;ce<q.length;ce++){var Se=q[ce];if(!(Se.zoom<=ie)){Se.zoom=ie;for(var p=this.trees[ie+1],le=p.within(Se.x,Se.y,xe),vt=Se.numPoints||1,Ke=vt,Ct=0,It=le;Ct<It.length;Ct+=1){var Ft=p.points[It[Ct]];Ft.zoom>ie&&(Ke+=Ft.numPoints||1)}if(Ke>=Ae){for(var ut=Se.x*vt,Ot=Se.y*vt,St=De&&vt>1?this._map(Se,!0):null,zt=(ce<<5)+(ie+1)+this.points.length,Fr=0,qt=le;Fr<qt.length;Fr+=1){var Xr=p.points[qt[Fr]];if(!(Xr.zoom<=ie)){Xr.zoom=ie;var en=Xr.numPoints||1;ut+=Xr.x*en,Ot+=Xr.y*en,Xr.parentId=zt,De&&(St||(St=this._map(Se,!0)),De(St,this._map(Xr)))}}Se.parentId=zt,ue.push($t(ut/Ke,Ot/Ke,zt,Ke,St))}else if(ue.push(Se),Ke>1)for(var zr=0,Gr=le;zr<Gr.length;zr+=1){var Lr=p.points[Gr[zr]];Lr.zoom<=ie||(Lr.zoom=ie,ue.push(Lr))}}}return ue},Xt.prototype._getOriginId=function(q){return q-this.points.length>>5},Xt.prototype._getOriginZoom=function(q){return(q-this.points.length)%32},Xt.prototype._map=function(q,ie){if(q.numPoints)return ie?Mn({},q.properties):q.properties;var ue=this.points[q.index].properties,be=this.options.map(ue);return ie&&be===ue?Mn({},be):be},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(q,ie,ue,be,De,Ae,xe){for(var ce=[q,ie,ue,be],Se=this.options,p=Se.debug;ce.length;){be=ce.pop(),ue=ce.pop(),ie=ce.pop(),q=ce.pop();var le=1<<ie,vt=Et(ie,ue,be),Ke=this.tiles[vt];if(!Ke&&(p>1&&console.time("creation"),Ke=this.tiles[vt]=Nt(q,ie,ue,be,Se),this.tileCoords.push({z:ie,x:ue,y:be}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ue,be,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var Ct="z"+ie;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(Ke.source=q,De){if(ie===Se.maxZoom||ie===De)continue;var It=1<<De-ie;if(ue!==Math.floor(Ae/It)||be!==Math.floor(xe/It))continue}else if(ie===Se.indexMaxZoom||Ke.numPoints<=Se.indexMaxPoints)continue;if(Ke.source=null,q.length!==0){p>1&&console.time("clipping");var Ft,ut,Ot,St,zt,Fr,qt=.5*Se.buffer/Se.extent,Xr=.5-qt,en=.5+qt,zr=1+qt;Ft=ut=Ot=St=null,zt=Ut(q,le,ue-qt,ue+en,0,Ke.minX,Ke.maxX,Se),Fr=Ut(q,le,ue+Xr,ue+zr,0,Ke.minX,Ke.maxX,Se),q=null,zt&&(Ft=Ut(zt,le,be-qt,be+en,1,Ke.minY,Ke.maxY,Se),ut=Ut(zt,le,be+Xr,be+zr,1,Ke.minY,Ke.maxY,Se),zt=null),Fr&&(Ot=Ut(Fr,le,be-qt,be+en,1,Ke.minY,Ke.maxY,Se),St=Ut(Fr,le,be+Xr,be+zr,1,Ke.minY,Ke.maxY,Se),Fr=null),p>1&&console.timeEnd("clipping"),ce.push(Ft||[],ie+1,2*ue,2*be),ce.push(ut||[],ie+1,2*ue,2*be+1),ce.push(Ot||[],ie+1,2*ue+1,2*be),ce.push(St||[],ie+1,2*ue+1,2*be+1)}}},yt.prototype.getTile=function(q,ie,ue){var be=this.options,De=be.extent,Ae=be.debug;if(q<0||q>24)return null;var xe=1<<q,ce=Et(q,ie=(ie%xe+xe)%xe,ue);if(this.tiles[ce])return Mt(this.tiles[ce],De);Ae>1&&console.log("drilling down to z%d-%d-%d",q,ie,ue);for(var Se,p=q,le=ie,vt=ue;!Se&&p>0;)p--,le=Math.floor(le/2),vt=Math.floor(vt/2),Se=this.tiles[Et(p,le,vt)];return Se&&Se.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",p,le,vt),Ae>1&&console.time("drilling down"),this.splitTile(Se.source,p,le,vt,q,ie,ue),Ae>1&&console.timeEnd("drilling down"),this.tiles[ce]?Mt(this.tiles[ce],De):null):null};var Je=function(q){function ie(ue,be,De,Ae){q.call(this,ue,be,De,Te),Ae&&(this.loadGeoJSON=Ae)}return q&&(ie.__proto__=q),(ie.prototype=Object.create(q&&q.prototype)).constructor=ie,ie.prototype.loadData=function(ue,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=be,this._pendingLoadDataParams=ue,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var ue=this;if(this._pendingCallback&&this._pendingLoadDataParams){var be=this._pendingCallback,De=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ae=!!(De&&De.request&&De.request.collectResourceTiming)&&new s.RequestPerformance(De.request);this.loadGeoJSON(De,function(xe,ce){if(xe||!ce)return be(xe);if(typeof ce!="object")return be(new Error("Input data given to '"+De.source+"' is not a valid GeoJSON object."));(function Ke(Ct,It){var Ft,ut=Ct&&Ct.type;if(ut==="FeatureCollection")for(Ft=0;Ft<Ct.features.length;Ft++)Ke(Ct.features[Ft],It);else if(ut==="GeometryCollection")for(Ft=0;Ft<Ct.geometries.length;Ft++)Ke(Ct.geometries[Ft],It);else if(ut==="Feature")Ke(Ct.geometry,It);else if(ut==="Polygon")z(Ct.coordinates,It);else if(ut==="MultiPolygon")for(Ft=0;Ft<Ct.coordinates.length;Ft++)z(Ct.coordinates[Ft],It);return Ct})(ce,!0);try{if(De.filter){var Se=s.createExpression(De.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(function(Ke){return Ke.key+": "+Ke.message}).join(", "));var p=ce.features.filter(function(Ke){return Se.value.evaluate({zoom:0},Ke)});ce={type:"FeatureCollection",features:p}}ue._geoJSONIndex=De.cluster?new Xt(function(Ke){var Ct=Ke.superclusterOptions,It=Ke.clusterProperties;if(!It||!Ct)return Ct;for(var Ft={},ut={},Ot={accumulated:null,zoom:0},St={properties:null},zt=Object.keys(It),Fr=0,qt=zt;Fr<qt.length;Fr+=1){var Xr=qt[Fr],en=It[Xr],zr=en[0],Gr=s.createExpression(en[1]),Lr=s.createExpression(typeof zr=="string"?[zr,["accumulated"],["get",Xr]]:zr);Ft[Xr]=Gr.value,ut[Xr]=Lr.value}return Ct.map=function(fi){St.properties=fi;for(var Vr={},fr=0,Me=zt;fr<Me.length;fr+=1){var Wt=Me[fr];Vr[Wt]=Ft[Wt].evaluate(Ot,St)}return Vr},Ct.reduce=function(fi,Vr){St.properties=Vr;for(var fr=0,Me=zt;fr<Me.length;fr+=1){var Wt=Me[fr];Ot.accumulated=fi[Wt],fi[Wt]=ut[Wt].evaluate(Ot,St)}},Ct}(De)).load(ce.features):function(Ke,Ct){return new yt(Ke,Ct)}(ce,De.geojsonVtOptions)}catch(Ke){return be(Ke)}ue.loaded={};var le={};if(Ae){var vt=Ae.finish();vt&&(le.resourceTiming={},le.resourceTiming[De.source]=JSON.parse(JSON.stringify(vt)))}be(null,le)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(ue,be){var De=this.loaded;return De&&De[ue.uid]?q.prototype.reloadTile.call(this,ue,be):this.loadTile(ue,be)},ie.prototype.loadGeoJSON=function(ue,be){if(ue.request)s.getJSON(ue.request,be);else{if(typeof ue.data!="string")return be(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."));try{return be(null,JSON.parse(ue.data))}catch{return be(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(ue,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),be()},ie.prototype.getClusterExpansionZoom=function(ue,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(ue.clusterId))}catch(De){be(De)}},ie.prototype.getClusterChildren=function(ue,be){try{be(null,this._geoJSONIndex.getChildren(ue.clusterId))}catch(De){be(De)}},ie.prototype.getClusterLeaves=function(ue,be){try{be(null,this._geoJSONIndex.getLeaves(ue.clusterId,ue.limit,ue.offset))}catch(De){be(De)}},ie}(N),ct=function(q){var ie=this;this.self=q,this.actor=new s.Actor(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:N,geojson:Je},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ue,be){if(ie.workerSourceTypes[ue])throw new Error('Worker source with name "'+ue+'" already registered.');ie.workerSourceTypes[ue]=be},this.self.registerRTLTextPlugin=function(ue){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=ue.applyArabicShaping,s.plugin.processBidirectionalText=ue.processBidirectionalText,s.plugin.processStyledBidirectionalText=ue.processStyledBidirectionalText}};return ct.prototype.setReferrer=function(q,ie){this.referrer=ie},ct.prototype.setImages=function(q,ie,ue){for(var be in this.availableImages[q]=ie,this.workerSources[q]){var De=this.workerSources[q][be];for(var Ae in De)De[Ae].availableImages=ie}ue()},ct.prototype.setLayers=function(q,ie,ue){this.getLayerIndex(q).replace(ie),ue()},ct.prototype.updateLayers=function(q,ie,ue){this.getLayerIndex(q).update(ie.layers,ie.removedIds),ue()},ct.prototype.loadTile=function(q,ie,ue){this.getWorkerSource(q,ie.type,ie.source).loadTile(ie,ue)},ct.prototype.loadDEMTile=function(q,ie,ue){this.getDEMWorkerSource(q,ie.source).loadTile(ie,ue)},ct.prototype.reloadTile=function(q,ie,ue){this.getWorkerSource(q,ie.type,ie.source).reloadTile(ie,ue)},ct.prototype.abortTile=function(q,ie,ue){this.getWorkerSource(q,ie.type,ie.source).abortTile(ie,ue)},ct.prototype.removeTile=function(q,ie,ue){this.getWorkerSource(q,ie.type,ie.source).removeTile(ie,ue)},ct.prototype.removeDEMTile=function(q,ie){this.getDEMWorkerSource(q,ie.source).removeTile(ie)},ct.prototype.removeSource=function(q,ie,ue){if(this.workerSources[q]&&this.workerSources[q][ie.type]&&this.workerSources[q][ie.type][ie.source]){var be=this.workerSources[q][ie.type][ie.source];delete this.workerSources[q][ie.type][ie.source],be.removeSource!==void 0?be.removeSource(ie,ue):ue()}},ct.prototype.loadWorkerSource=function(q,ie,ue){try{this.self.importScripts(ie.url),ue()}catch(be){ue(be.toString())}},ct.prototype.syncRTLPluginState=function(q,ie,ue){try{s.plugin.setState(ie);var be=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&be!=null){this.self.importScripts(be);var De=s.plugin.isParsed();ue(De?void 0:new Error("RTL Text Plugin failed to import scripts from "+be),De)}}catch(Ae){ue(Ae.toString())}},ct.prototype.getAvailableImages=function(q){var ie=this.availableImages[q];return ie||(ie=[]),ie},ct.prototype.getLayerIndex=function(q){var ie=this.layerIndexes[q];return ie||(ie=this.layerIndexes[q]=new _),ie},ct.prototype.getWorkerSource=function(q,ie,ue){var be=this;return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][ie]||(this.workerSources[q][ie]={}),this.workerSources[q][ie][ue]||(this.workerSources[q][ie][ue]=new this.workerSourceTypes[ie]({send:function(De,Ae,xe){be.actor.send(De,Ae,xe,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][ie][ue]},ct.prototype.getDEMWorkerSource=function(q,ie){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][ie]||(this.demWorkerSources[q][ie]=new W),this.demWorkerSources[q][ie]},ct.prototype.enforceCacheSizeLimit=function(q,ie){s.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ct(self)),ct}),o(["./shared"],function(s){var c=s.createCommonjsModule(function(l){function d(C){return!h(C)}function h(C){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,L,U=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(U);try{L=new Worker(X),R=!0}catch{R=!1}return L&&L.terminate(),URL.revokeObjectURL(X),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var L=R.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===R.width}()?(g[P=C&&C.failIfMajorPerformanceCaveat]===void 0&&(g[P]=function(R){var L=function(X){var te=document.createElement("canvas"),Q=Object.create(d.webGLContextAttributes);return Q.failIfMajorPerformanceCaveat=X,te.probablySupportsContext?te.probablySupportsContext("webgl",Q)||te.probablySupportsContext("experimental-webgl",Q):te.supportsContext?te.supportsContext("webgl",Q)||te.supportsContext("experimental-webgl",Q):te.getContext("webgl",Q)||te.getContext("experimental-webgl",Q)}(R);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(P)),g[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}l.exports?l.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),f={create:function(l,d,h){var g=s.window.document.createElement(l);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(l,d){return s.window.document.createElementNS(l,d)}},_=s.window.document&&s.window.document.documentElement.style;function b(l){if(!_)return l[0];for(var d=0;d<l.length;d++)if(l[d]in _)return l[d];return l[0]}var T,S=b(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);f.disableDrag=function(){_&&S&&(T=_[S],_[S]="none")},f.enableDrag=function(){_&&S&&(_[S]=T)};var D=b(["transform","WebkitTransform"]);f.setTransform=function(l,d){l.style[D]=d};var N=!1;try{var G=Object.defineProperty({},"passive",{get:function(){N=!0}});s.window.addEventListener("test",G,G),s.window.removeEventListener("test",G,G)}catch{N=!1}f.addEventListener=function(l,d,h,g){g===void 0&&(g={}),l.addEventListener(d,h,"passive"in g&&N?g:g.capture)},f.removeEventListener=function(l,d,h,g){g===void 0&&(g={}),l.removeEventListener(d,h,"passive"in g&&N?g:g.capture)};var W=function(l){l.preventDefault(),l.stopPropagation(),s.window.removeEventListener("click",W,!0)};function z(l){var d=l.userImage;return!!(d&&d.render&&d.render())&&(l.data.replace(new Uint8Array(d.data.buffer)),!0)}f.suppressClick=function(){s.window.addEventListener("click",W,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",W,!0)},0)},f.mousePos=function(l,d){var h=l.getBoundingClientRect();return new s.Point(d.clientX-h.left-l.clientLeft,d.clientY-h.top-l.clientTop)},f.touchPos=function(l,d){for(var h=l.getBoundingClientRect(),g=[],C=0;C<d.length;C++)g.push(new s.Point(d[C].clientX-h.left-l.clientLeft,d[C].clientY-h.top-l.clientTop));return g},f.mouseButton=function(l){return s.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},f.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var j=function(l){function d(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,C=this.requestors;g<C.length;g+=1){var P=C[g];this._notify(P.ids,P.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var C=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),C=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),C=!1),this._validateContent(g.content,g)||(this.fire(new s.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),C=!1),C},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var C=0,P=0,R=h;P<R.length;P+=1){var L=R[P];if(L[0]<C||L[1]<L[0]||g<L[1])return!1;C=L[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var C=!0;if(!this.isLoaded())for(var P=0,R=h;P<R.length;P+=1)this.images[R[P]]||(C=!1);this.isLoaded()||C?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var C={},P=0,R=h;P<R.length;P+=1){var L=R[P];this.images[L]||this.fire(new s.Event("styleimagemissing",{id:L}));var U=this.images[L];U?C[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:!!(U.userImage&&U.userImage.render)}:s.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,C)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],C=this.getImage(h);if(!C)return null;if(g&&g.position.version===C.version)return g.position;if(g)g.position.version=C.version;else{var P={w:C.data.width+2,h:C.data.height+2,x:0,y:0},R=new s.ImagePosition(P,C);this.patterns[h]={bin:P,position:R}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var C=s.potpack(h),P=C.w,R=C.h,L=this.atlasImage;for(var U in L.resize({width:P||1,height:R||1}),this.patterns){var X=this.patterns[U].bin,te=X.x+1,Q=X.y+1,re=this.images[U].data,oe=re.width,Ee=re.height;s.RGBAImage.copy(re,L,{x:0,y:0},{x:te,y:Q},{width:oe,height:Ee}),s.RGBAImage.copy(re,L,{x:0,y:Ee-1},{x:te,y:Q-1},{width:oe,height:1}),s.RGBAImage.copy(re,L,{x:0,y:0},{x:te,y:Q+Ee},{width:oe,height:1}),s.RGBAImage.copy(re,L,{x:oe-1,y:0},{x:te-1,y:Q},{width:1,height:Ee}),s.RGBAImage.copy(re,L,{x:0,y:0},{x:te+oe,y:Q},{width:1,height:Ee})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,C=h;g<C.length;g+=1){var P=C[g];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var R=this.images[P];z(R)&&this.updateImage(P,R)}}},d}(s.Evented),K=ae,fe=ae,Z=1e20;function ae(l,d,h,g,C,P){this.fontSize=l||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=C||"sans-serif",this.fontWeight=P||"normal",this.radius=h||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Be(l,d,h,g,C,P,R){for(var L=0;L<d;L++){for(var U=0;U<h;U++)g[U]=l[U*d+L];for(Le(g,C,P,R,h),U=0;U<h;U++)l[U*d+L]=C[U]}for(U=0;U<h;U++){for(L=0;L<d;L++)g[L]=l[U*d+L];for(Le(g,C,P,R,d),L=0;L<d;L++)l[U*d+L]=Math.sqrt(C[L])}}function Le(l,d,h,g,C){h[0]=0,g[0]=-1e20,g[1]=1e20;for(var P=1,R=0;P<C;P++){for(var L=(l[P]+P*P-(l[h[R]]+h[R]*h[R]))/(2*P-2*h[R]);L<=g[R];)R--,L=(l[P]+P*P-(l[h[R]]+h[R]*h[R]))/(2*P-2*h[R]);h[++R]=P,g[R]=L,g[R+1]=1e20}for(P=0,R=0;P<C;P++){for(;g[R+1]<P;)R++;d[P]=(P-h[R])*(P-h[R])+l[h[R]]}}ae.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var C=d.data[4*g+3]/255;this.gridOuter[g]=C===1?0:C===0?Z:Math.pow(Math.max(0,.5-C),2),this.gridInner[g]=C===1?Z:C===0?0:Math.pow(Math.max(0,C-.5),2)}for(Be(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Be(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},K.default=fe;var de=function(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}};de.prototype.setURL=function(l){this.url=l},de.prototype.getGlyphs=function(l,d){var h=this,g=[];for(var C in l)for(var P=0,R=l[C];P<R.length;P+=1)g.push({stack:C,id:R[P]});s.asyncAll(g,function(L,U){var X=L.stack,te=L.id,Q=h.entries[X];Q||(Q=h.entries[X]={glyphs:{},requests:{},ranges:{}});var re=Q.glyphs[te];if(re===void 0){if(re=h._tinySDF(Q,X,te))return Q.glyphs[te]=re,void U(null,{stack:X,id:te,glyph:re});var oe=Math.floor(te/256);if(256*oe>65535)U(new Error("glyphs > 65535 not supported"));else if(Q.ranges[oe])U(null,{stack:X,id:te,glyph:re});else{var Ee=Q.requests[oe];Ee||(Ee=Q.requests[oe]=[],de.loadGlyphRange(X,oe,h.url,h.requestManager,function(Oe,me){if(me){for(var Fe in me)h._doesCharSupportLocalGlyph(+Fe)||(Q.glyphs[+Fe]=me[+Fe]);Q.ranges[oe]=!0}for(var He=0,We=Ee;He<We.length;He+=1)(0,We[He])(Oe,me);delete Q.requests[oe]})),Ee.push(function(Oe,me){Oe?U(Oe):me&&U(null,{stack:X,id:te,glyph:me[te]||null})})}}else U(null,{stack:X,id:te,glyph:re})},function(L,U){if(L)d(L);else if(U){for(var X={},te=0,Q=U;te<Q.length;te+=1){var re=Q[te],oe=re.stack,Ee=re.id,Oe=re.glyph;(X[oe]||(X[oe]={}))[Ee]=Oe&&{id:Oe.id,bitmap:Oe.bitmap.clone(),metrics:Oe.metrics}}d(null,X)}})},de.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](l)||s.isChar["Hangul Syllables"](l)||s.isChar.Hiragana(l)||s.isChar.Katakana(l))},de.prototype._tinySDF=function(l,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var C=l.tinySDF;if(!C){var P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),C=l.tinySDF=new de.TinySDF(24,3,8,.25,g,P)}return{id:h,bitmap:new s.AlphaImage({width:30,height:30},C.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},de.loadGlyphRange=function(l,d,h,g,C){var P=256*d,R=P+255,L=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",l).replace("{range}",P+"-"+R),s.ResourceType.Glyphs);s.getArrayBuffer(L,function(U,X){if(U)C(U);else if(X){for(var te={},Q=0,re=s.parseGlyphPBF(X);Q<re.length;Q+=1){var oe=re[Q];te[oe.id]=oe}C(null,te)}})},de.TinySDF=K;var _e=function(){this.specification=s.styleSpec.light.position};_e.prototype.possiblyEvaluate=function(l,d){return s.sphericalToCartesian(l.expression.evaluate(d))},_e.prototype.interpolate=function(l,d,h){return{x:s.number(l.x,d.x,h),y:s.number(l.y,d.y,h),z:s.number(l.z,d.z,h)}};var pe=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new _e,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),J=function(l){function d(h){l.call(this),this._transitionable=new s.Transitionable(pe),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(s.validateLight,h,g))for(var C in h){var P=h[C];s.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),P):this._transitionable.setValue(C,P)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,C){return(!C||C.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},d}(s.Evented),ne=function(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ne.prototype.getDash=function(l,d){var h=l.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(l,d)),this.dashEntry[h]},ne.prototype.getDashRanges=function(l,d,h){var g=[],C=l.length%2==1?-l[l.length-1]*h:0,P=l[0]*h,R=!0;g.push({left:C,right:P,isDash:R,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var X=l[U];g.push({left:C=L*h,right:P=(L+=X)*h,isDash:R=!R,zeroLength:X===0})}return g},ne.prototype.addRoundDash=function(l,d,h){for(var g=d/2,C=-h;C<=h;C++)for(var P=this.width*(this.nextRow+h+C),R=0,L=l[R],U=0;U<this.width;U++){U/L.right>1&&(L=l[++R]);var X=Math.abs(U-L.left),te=Math.abs(U-L.right),Q=Math.min(X,te),re=void 0,oe=C/h*(g+1);if(L.isDash){var Ee=g-Math.abs(oe);re=Math.sqrt(Q*Q+Ee*Ee)}else re=g-Math.sqrt(Q*Q+oe*oe);this.data[P+U]=Math.max(0,Math.min(255,re+128))}},ne.prototype.addRegularDash=function(l){for(var d=l.length-1;d>=0;--d){var h=l[d],g=l[d+1];h.zeroLength?l.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,l.splice(d,1))}var C=l[0],P=l[l.length-1];C.isDash===P.isDash&&(C.left=P.left-this.width,P.right=C.right+this.width);for(var R=this.width*this.nextRow,L=0,U=l[L],X=0;X<this.width;X++){X/U.right>1&&(U=l[++L]);var te=Math.abs(X-U.left),Q=Math.abs(X-U.right),re=Math.min(te,Q);this.data[R+X]=Math.max(0,Math.min(255,(U.isDash?re:-re)+128))}},ne.prototype.addDash=function(l,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var C=0,P=0;P<l.length;P++)C+=l[P];if(C!==0){var R=this.width/C,L=this.getDashRanges(l,this.width,R);d?this.addRoundDash(L,R,h):this.addRegularDash(L)}var U={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:C};return this.nextRow+=g,this.dirty=!0,U},ne.prototype.bind=function(l){var d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var ye=function l(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var g=this.workerPool.acquire(this.id),C=0;C<g.length;C++){var P=new l.Actor(g[C],h,this.id);P.name="Worker "+C,this.actors.push(P)}};function Ye(l,d,h){var g=function(C,P){if(C)return h(C);if(P){var R=s.pick(s.extend(P,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(R.vectorLayers=P.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(L){return L.id})),R.tiles=d.canonicalizeTileset(R,l.url),h(null,R)}};return l.url?s.getJSON(d.transformRequest(d.normalizeSourceURL(l.url),s.ResourceType.Source),g):s.browser.frame(function(){return g(null,l)})}ye.prototype.broadcast=function(l,d,h){s.asyncAll(this.actors,function(g,C){g.send(l,d,C)},h=h||function(){})},ye.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},ye.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},ye.Actor=s.Actor;var we=function(l,d,h){this.bounds=s.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=h||24};we.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},we.prototype.contains=function(l){var d=Math.pow(2,l.z),h=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*d),C=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=h&&l.x<C&&l.y>=g&&l.y<P};var Ne=function(l){function d(h,g,C,P){if(l.call(this),this.id=h,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(g,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ye(this._options,this.map._requestManager,function(g,C){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new s.ErrorEvent(g)):C&&(s.extend(h,C),C.bounds&&(h.tileBounds=new we(C.bounds,h.minzoom,h.maxzoom)),s.postTurnstileEvent(C.tiles,h.map._requestManager._customAccessToken),s.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return s.extend({},this._options)},d.prototype.loadTile=function(h,g){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(C,s.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(L,U){return delete h.request,h.aborted?g(null):L&&L.status!==404?g(L):(U&&U.resourceTiming&&(h.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&h.setExpiryData(U),h.loadVectorData(U,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",P,R.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",P,R.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(s.Evented),Ge=function(l){function d(h,g,C,P){l.call(this),this.id=h,this.dispatcher=C,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},g),s.extend(this,s.pick(g,["url","scheme","tileSize"]))}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ye(this._options,this.map._requestManager,function(g,C){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new s.ErrorEvent(g)):C&&(s.extend(h,C),C.bounds&&(h.tileBounds=new we(C.bounds,h.minzoom,h.maxzoom)),s.postTurnstileEvent(C.tiles),s.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return s.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var C=this,P=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=s.getImage(this.map._requestManager.transformRequest(P,s.ResourceType.Tile),function(R,L){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(R)h.state="errored",g(R);else if(L){C.map._refreshExpiredTiles&&h.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=C.map.painter.context,X=U.gl;h.texture=C.map.painter.getTileTexture(L.width),h.texture?h.texture.update(L,{useMipmap:!0}):(h.texture=new s.Texture(U,L,X.RGBA,{useMipmap:!0}),h.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),h.state="loaded",s.cacheEntryPossiblyAdded(C.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(s.Evented),Qe=function(l){function d(h,g,C,P){l.call(this,h,g,C,P),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(R,L){R&&(h.state="errored",g(R)),L&&(h.dem=L,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=s.getImage(this.map._requestManager.transformRequest(C,s.ResourceType.Tile),(function(R,L){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(R)h.state="errored",g(R);else if(L){this.map._refreshExpiredTiles&&h.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=s.window.ImageBitmap&&L instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?L:s.browser.getImageData(L,1),X={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:U,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",X,P.bind(this)))}}).bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,C=Math.pow(2,g.z),P=(g.x-1+C)%C,R=g.x===0?h.wrap-1:h.wrap,L=(g.x+1+C)%C,U=g.x+1===C?h.wrap+1:h.wrap,X={};return X[new s.OverscaledTileID(h.overscaledZ,R,g.z,P,g.y).key]={backfilled:!1},X[new s.OverscaledTileID(h.overscaledZ,U,g.z,L,g.y).key]={backfilled:!1},g.y>0&&(X[new s.OverscaledTileID(h.overscaledZ,R,g.z,P,g.y-1).key]={backfilled:!1},X[new s.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},X[new s.OverscaledTileID(h.overscaledZ,U,g.z,L,g.y-1).key]={backfilled:!1}),g.y+1<C&&(X[new s.OverscaledTileID(h.overscaledZ,R,g.z,P,g.y+1).key]={backfilled:!1},X[new s.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},X[new s.OverscaledTileID(h.overscaledZ,U,g.z,L,g.y+1).key]={backfilled:!1}),X},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(Ge),rt=function(l){function d(h,g,C,P){l.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=C.getActor(),this.setEventedParent(P),this._data=g.data,this._options=s.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:s.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new s.ErrorEvent(g));else{var C={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(C.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new s.Event("data",C))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(C){if(C)g.fire(new s.ErrorEvent(C));else{var P={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(P.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new s.Event("data",P))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,C,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:C},P),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var C=s.extend({},this.workerOptions),P=this._data;typeof P=="string"?(C.request=this.map._requestManager.transformRequest(s.browser.resolveURL(P),s.ResourceType.Source),C.request.collectResourceTiming=this._collectResourceTiming):C.data=JSON.stringify(P),this.actor.send(this.type+".loadData",C,function(R,L){g._removed||L&&L.abandoned||(g._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[g.id]&&(g._resourceTiming=L.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:C.source},null),h(R))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var C=this,P=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(P,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,L){return delete h.request,h.unloadVectorData(),h.aborted?g(null):R?g(R):(h.loadVectorData(L,C.map.painter,P==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(s.Evented),tt=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),lt=function(l){function d(h,g,C,P){l.call(this),this.id=h,this.dispatcher=C,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=g}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(h,g){var C=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(P,R){C._loaded=!0,P?C.fire(new s.ErrorEvent(P)):R&&(C.image=R,h&&(C.coordinates=h),g&&g(),C._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var C=h.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var L=1/0,U=1/0,X=-1/0,te=-1/0,Q=0,re=R;Q<re.length;Q+=1){var oe=re[Q];L=Math.min(L,oe.x),U=Math.min(U,oe.y),X=Math.max(X,oe.x),te=Math.max(te,oe.y)}var Ee=Math.max(X-L,te-U),Oe=Math.max(0,Math.floor(-Math.log(Ee)/Math.LN2)),me=Math.pow(2,Oe);return new s.CanonicalTileID(Oe,Math.floor((L+X)/2*me),Math.floor((U+te)/2*me))}(C),this.minzoom=this.maxzoom=this.tileID.z;var P=C.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(s.Evented),mt=function(l){function d(h,g,C,P){l.call(this,h,g,C,P),this.roundZoom=!0,this.type="video",this.options=g}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var C=0,P=g.urls;C<P.length;C+=1)this.urls.push(this.map._requestManager.transformRequest(P[C],s.ResourceType.Source).url);s.getVideo(this.urls,function(R,L){h._loaded=!0,R?h.fire(new s.ErrorEvent(R)):L&&(h.video=L,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(lt),Tt=function(l){function d(h,g,C,P){l.call(this,h,g,C,P),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(L){return typeof L!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,C=g.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(g,this.canvas,C.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[P];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var C=g[h];if(isNaN(C)||C<=0)return!0}return!1},d}(lt),nt={vector:Ne,raster:Ge,"raster-dem":Qe,geojson:rt,video:mt,image:lt,canvas:Tt};function cr(l,d){var h=s.identity([]);return s.translate(h,h,[1,1,0]),s.scale(h,h,[.5*l.width,.5*l.height,1]),s.multiply(h,h,l.calculatePosMatrix(d.toUnwrapped()))}function Xt(l,d,h,g,C,P){var R=function(Oe,me,Fe){if(Oe)for(var He=0,We=Oe;He<We.length;He+=1){var it=me[We[He]];if(it&&it.source===Fe&&it.type==="fill-extrusion")return!0}else for(var Xe in me){var et=me[Xe];if(et.source===Fe&&et.type==="fill-extrusion")return!0}return!1}(C&&C.layers,d,l.id),L=P.maxPitchScaleFactor(),U=l.tilesIn(g,L,R);U.sort($t);for(var X=[],te=0,Q=U;te<Q.length;te+=1){var re=Q[te];X.push({wrappedTileID:re.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(d,h,l._state,re.queryGeometry,re.cameraQueryGeometry,re.scale,C,P,L,cr(l.transform,re.tileID))})}var oe=function(Oe){for(var me={},Fe={},He=0,We=Oe;He<We.length;He+=1){var it=We[He],Xe=it.queryResults,et=it.wrappedTileID,ht=Fe[et]=Fe[et]||{};for(var Rt in Xe)for(var xt=Xe[Rt],kt=ht[Rt]=ht[Rt]||{},rr=me[Rt]=me[Rt]||[],vr=0,Cr=xt;vr<Cr.length;vr+=1){var gn=Cr[vr];kt[gn.featureIndex]||(kt[gn.featureIndex]=!0,rr.push(gn))}}return me}(X);for(var Ee in oe)oe[Ee].forEach(function(Oe){var me=Oe.feature,Fe=l.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Fe});return oe}function $t(l,d){var h=l.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var Lt=function(l,d){this.max=l,this.onRemove=d,this.reset()};Lt.prototype.reset=function(){for(var l in this.data)for(var d=0,h=this.data[l];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Lt.prototype.add=function(l,d,h){var g=this,C=l.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);var P={value:d,timeout:void 0};if(h!==void 0&&(P.timeout=setTimeout(function(){g.remove(l,P)},h)),this.data[C].push(P),this.order.push(C),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Lt.prototype.has=function(l){return l.wrapped().key in this.data},Lt.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Lt.prototype._getAndRemoveByKey=function(l){var d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value},Lt.prototype.getByKey=function(l){var d=this.data[l];return d?d[0].value:null},Lt.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Lt.prototype.remove=function(l,d){if(!this.has(l))return this;var h=l.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),C=this.data[h][g];return this.data[h].splice(g,1),C.timeout&&clearTimeout(C.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(C.value),this.order.splice(this.order.indexOf(h),1),this},Lt.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Lt.prototype.filter=function(l){var d=[];for(var h in this.data)for(var g=0,C=this.data[h];g<C.length;g+=1){var P=C[g];l(P.value)||d.push(P)}for(var R=0,L=d;R<L.length;R+=1){var U=L[R];this.remove(U.value.tileID,U)}};var lr=function(l,d,h){this.context=l;var g=l.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};lr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},lr.prototype.updateData=function(l){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},lr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var tn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Er=function(l,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=l;var C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Er.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Er.prototype.updateData=function(l){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)},Er.prototype.enableAttributes=function(l,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&l.enableVertexAttribArray(g)}},Er.prototype.setVertexAttribPointers=function(l,d,h){for(var g=0;g<this.attributes.length;g++){var C=this.attributes[g],P=d.attributes[C.name];P!==void 0&&l.vertexAttribPointer(P,C.components,l[tn[C.type]],!1,this.itemSize,C.offset+this.itemSize*(h||0))}},Er.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ar=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ar.prototype.get=function(){return this.current},Ar.prototype.set=function(l){},Ar.prototype.getDefault=function(){return this.default},Ar.prototype.setDefault=function(){this.set(this.default)};var Mn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return s.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Ar),hr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(Ar),pr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(Ar),rn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Ar),Sr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(Ar),ei=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(Ar),$n=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(Ar),un=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(Ar),Xn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(Ar),Nn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Ar),bn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(Ar),Wn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(Ar),Ut=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(Ar),dr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Ar),Tr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return s.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Ar),qr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(Ar),ui=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(Ar),Pe=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(Ar),Dt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(Ar),Vt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(Ar),sr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(Ar),Ze=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Ar),Mt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(Ar),ge=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Ar),Nt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(Ar),wt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(Ar),$=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(Ar),yt=function(l){function d(h){l.call(this,h),this.vao=h.extVertexArrayObject}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(Ar),Et=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(Ar),Te=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(Ar),Je=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(Ar),ct=function(l){function d(h,g){l.call(this,h),this.context=h,this.parent=g}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(Ar),q=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(ct),ie=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(ct),ue=function(l,d,h,g){this.context=l,this.width=d,this.height=h;var C=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new q(l,C),g&&(this.depthAttachment=new ie(l,C))};ue.prototype.destroy=function(){var l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&l.deleteRenderbuffer(h)}l.deleteFramebuffer(this.framebuffer)};var be=function(l,d,h){this.func=l,this.mask=d,this.range=h};be.ReadOnly=!1,be.ReadWrite=!0,be.disabled=new be(519,be.ReadOnly,[0,1]);var De=function(l,d,h,g,C,P){this.test=l,this.ref=d,this.mask=h,this.fail=g,this.depthFail=C,this.pass=P};De.disabled=new De({func:519,mask:0},0,0,7680,7680,7680);var Ae=function(l,d,h){this.blendFunction=l,this.blendColor=d,this.mask=h};Ae.disabled=new Ae(Ae.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),Ae.unblended=new Ae(Ae.Replace,s.Color.transparent,[!0,!0,!0,!0]),Ae.alphaBlended=new Ae([1,771],s.Color.transparent,[!0,!0,!0,!0]);var xe=function(l,d,h){this.enable=l,this.mode=d,this.frontFace=h};xe.disabled=new xe(!1,1029,2305),xe.backCCW=new xe(!0,1029,2305);var ce=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Mn(this),this.clearDepth=new hr(this),this.clearStencil=new pr(this),this.colorMask=new rn(this),this.depthMask=new Sr(this),this.stencilMask=new ei(this),this.stencilFunc=new $n(this),this.stencilOp=new un(this),this.stencilTest=new Xn(this),this.depthRange=new Nn(this),this.depthTest=new bn(this),this.depthFunc=new Wn(this),this.blend=new Ut(this),this.blendFunc=new dr(this),this.blendColor=new Tr(this),this.blendEquation=new qr(this),this.cullFace=new ui(this),this.cullFaceSide=new Pe(this),this.frontFace=new Dt(this),this.program=new Vt(this),this.activeTexture=new sr(this),this.viewport=new Ze(this),this.bindFramebuffer=new Mt(this),this.bindRenderbuffer=new ge(this),this.bindTexture=new Nt(this),this.bindVertexBuffer=new wt(this),this.bindElementBuffer=new $(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new Et(this),this.pixelStoreUnpackPremultiplyAlpha=new Te(this),this.pixelStoreUnpackFlipY=new Je(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(l,d){return new lr(this,l,d)},ce.prototype.createVertexBuffer=function(l,d,h){return new Er(this,l,d,h)},ce.prototype.createRenderbuffer=function(l,d,h){var g=this.gl,C=g.createRenderbuffer();return this.bindRenderbuffer.set(C),g.renderbufferStorage(g.RENDERBUFFER,l,d,h),this.bindRenderbuffer.set(null),C},ce.prototype.createFramebuffer=function(l,d,h){return new ue(this,l,d,h)},ce.prototype.clear=function(l){var d=l.color,h=l.depth,g=this.gl,C=0;d&&(C|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(C|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(C)},ce.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ce.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(l){s.deepEqual(l.blendFunction,Ae.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Se=function(l){function d(h,g,C){var P=this;l.call(this),this.id=h,this.dispatcher=C,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=function(R,L,U,X){var te=new nt[L.type](R,L,U,X);if(te.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+te.id);return s.bindAll(["load","abort","unload","serialize","prepare"],te),te}(h,g,C,this),this._tiles={},this._cache=new Lt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var C=this._tiles[g];C.upload(h),C.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return s.values(this._tiles).map(function(h){return h.tileID}).sort(p).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,C=[];for(var P in this._tiles)this._isIdRenderable(P,h)&&C.push(this._tiles[P]);return h?C.sort(function(R,L){var U=R.tileID,X=L.tileID,te=new s.Point(U.canonical.x,U.canonical.y)._rotate(g.transform.angle),Q=new s.Point(X.canonical.x,X.canonical.y)._rotate(g.transform.angle);return U.overscaledZ-X.overscaledZ||Q.y-te.y||Q.x-te.x}).map(function(R){return R.tileID.key}):C.map(function(R){return R.tileID}).sort(p).map(function(R){return R.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var C=this._tiles[h];C&&(C.state!=="loading"&&(C.state=g),this._loadTile(C,this._tileLoaded.bind(this,C,h,g)))},d.prototype._tileLoaded=function(h,g,C,P){if(P)return h.state="errored",void(P.status!==404?this._source.fire(new s.ErrorEvent(P,{tile:h})):this.update(this.transform));h.timeAdded=s.browser.now(),C==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),C=0;C<g.length;C++){var P=g[C];if(h.neighboringTiles&&h.neighboringTiles[P]){var R=this.getTileByID(P);L(h,R),L(R,h)}}function L(U,X){U.needsHillshadePrepare=!0;var te=X.tileID.canonical.x-U.tileID.canonical.x,Q=X.tileID.canonical.y-U.tileID.canonical.y,re=Math.pow(2,U.tileID.canonical.z),oe=X.tileID.key;te===0&&Q===0||Math.abs(Q)>1||(Math.abs(te)>1&&(Math.abs(te+re)===1?te+=re:Math.abs(te-re)===1&&(te-=re)),X.dem&&U.dem&&(U.dem.backfillBorder(X.dem,te,Q),U.neighboringTiles&&U.neighboringTiles[oe]&&(U.neighboringTiles[oe].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,C,P){for(var R in this._tiles){var L=this._tiles[R];if(!(P[R]||!L.hasData()||L.tileID.overscaledZ<=g||L.tileID.overscaledZ>C)){for(var U=L.tileID;L&&L.tileID.overscaledZ>g+1;){var X=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[X.key])&&L.hasData()&&(U=X)}for(var te=U;te.overscaledZ>g;)if(h[(te=te.scaledTo(te.overscaledZ-1)).key]){P[U.key]=U;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var C=this._loadedParentTiles[h.key];return C&&C.tileID.overscaledZ>=g?C:null}for(var P=h.overscaledZ-1;P>=g;P--){var R=h.scaledTo(P),L=this._getLoadedTile(R);if(L)return L}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,C=Math.ceil(h.height/this._source.tileSize)+1,P=Math.floor(g*C*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(R)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var C={};for(var P in this._tiles){var R=this._tiles[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),C[R.tileID.key]=R}for(var L in this._tiles=C,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var C;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?C=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ht){return new s.OverscaledTileID(ht.canonical.z,ht.wrap,ht.canonical.z,ht.canonical.x,ht.canonical.y)}):(C=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(C=C.filter(function(ht){return g._source.hasTile(ht)}))):C=[];var P=h.coveringZoomLevel(this._source),R=Math.max(P-d.maxOverzooming,this._source.minzoom),L=Math.max(P+d.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(C,P);if(le(this._source.type)){for(var X={},te={},Q=0,re=Object.keys(U);Q<re.length;Q+=1){var oe=re[Q],Ee=U[oe],Oe=this._tiles[oe];if(Oe&&!(Oe.fadeEndTime&&Oe.fadeEndTime<=s.browser.now())){var me=this.findLoadedParent(Ee,R);me&&(this._addTile(me.tileID),X[me.tileID.key]=me.tileID),te[oe]=Ee}}for(var Fe in this._retainLoadedChildren(te,P,L,U),X)U[Fe]||(this._coveredTiles[Fe]=!0,U[Fe]=X[Fe])}for(var He in U)this._tiles[He].clearFadeHold();for(var We=0,it=s.keysDifference(this._tiles,U);We<it.length;We+=1){var Xe=it[We],et=this._tiles[Xe];et.hasSymbolBuckets&&!et.holdingForFade()?et.setHoldDuration(this.map._fadeDuration):et.hasSymbolBuckets&&!et.symbolFadeFinished()||this._removeTile(Xe)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var C={},P={},R=Math.max(g-d.maxOverzooming,this._source.minzoom),L=Math.max(g+d.maxUnderzooming,this._source.minzoom),U={},X=0,te=h;X<te.length;X+=1){var Q=te[X],re=this._addTile(Q);C[Q.key]=Q,re.hasData()||g<this._source.maxzoom&&(U[Q.key]=Q)}this._retainLoadedChildren(U,g,L,C);for(var oe=0,Ee=h;oe<Ee.length;oe+=1){var Oe=Ee[oe],me=this._tiles[Oe.key];if(!me.hasData()){if(g+1>this._source.maxzoom){var Fe=Oe.children(this._source.maxzoom)[0],He=this.getTile(Fe);if(He&&He.hasData()){C[Fe.key]=Fe;continue}}else{var We=Oe.children(this._source.maxzoom);if(C[We[0].key]&&C[We[1].key]&&C[We[2].key]&&C[We[3].key])continue}for(var it=me.wasRequested(),Xe=Oe.overscaledZ-1;Xe>=R;--Xe){var et=Oe.scaledTo(Xe);if(P[et.key]||(P[et.key]=!0,!(me=this.getTile(et))&&it&&(me=this._addTile(et)),me&&(C[et.key]=et,it=me.wasRequested(),me.hasData())))break}}}return C},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],C=void 0,P=this._tiles[h].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){C=this._loadedParentTiles[P.key];break}g.push(P.key);var R=P.scaledTo(P.overscaledZ-1);if(C=this._getLoadedTile(R))break;P=R}for(var L=0,U=g;L<U.length;L+=1)this._loadedParentTiles[U[L]]=C}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var C=!!g;return C||(g=new s.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,C||this._source.fire(new s.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var C=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var P=g.getExpiryTimeout();P&&(this._timers[h]=setTimeout(function(){C._reloadTile(h,"expired"),delete C._timers[h]},P))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,C){var P=this,R=[],L=this.transform;if(!L)return R;for(var U=C?L.getCameraQueryGeometry(h):h,X=h.map(function(Xe){return L.pointCoordinate(Xe)}),te=U.map(function(Xe){return L.pointCoordinate(Xe)}),Q=this.getIds(),re=1/0,oe=1/0,Ee=-1/0,Oe=-1/0,me=0,Fe=te;me<Fe.length;me+=1){var He=Fe[me];re=Math.min(re,He.x),oe=Math.min(oe,He.y),Ee=Math.max(Ee,He.x),Oe=Math.max(Oe,He.y)}for(var We=function(Xe){var et=P._tiles[Q[Xe]];if(!et.holdingForFade()){var ht=et.tileID,Rt=Math.pow(2,L.zoom-et.tileID.overscaledZ),xt=g*et.queryPadding*s.EXTENT/et.tileSize/Rt,kt=[ht.getTilePoint(new s.MercatorCoordinate(re,oe)),ht.getTilePoint(new s.MercatorCoordinate(Ee,Oe))];if(kt[0].x-xt<s.EXTENT&&kt[0].y-xt<s.EXTENT&&kt[1].x+xt>=0&&kt[1].y+xt>=0){var rr=X.map(function(Cr){return ht.getTilePoint(Cr)}),vr=te.map(function(Cr){return ht.getTilePoint(Cr)});R.push({tile:et,tileID:ht,queryGeometry:rr,cameraQueryGeometry:vr,scale:Rt})}}},it=0;it<Q.length;it++)We(it);return R},d.prototype.getVisibleCoordinates=function(h){for(var g=this,C=this.getRenderableIds(h).map(function(U){return g._tiles[U].tileID}),P=0,R=C;P<R.length;P+=1){var L=R[P];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return C},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(le(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=s.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,C){this._state.updateState(h=h||"_geojsonTileLayer",g,C)},d.prototype.removeFeatureState=function(h,g,C){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,C)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,C){var P=this._tiles[h];P&&P.setDependencies(g,C)},d.prototype.reloadTilesForDependencies=function(h,g){for(var C in this._tiles)this._tiles[C].hasDependency(h,g)&&this._reloadTile(C,"reloading");this._cache.filter(function(P){return!P.hasDependency(h,g)})},d}(s.Evented);function p(l,d){var h=Math.abs(2*l.wrap)-+(l.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return l.overscaledZ-d.overscaledZ||g-h||d.canonical.y-l.canonical.y||d.canonical.x-l.canonical.x}function le(l){return l==="raster"||l==="image"||l==="video"}function vt(){return new s.window.Worker(O.workerUrl)}Se.maxOverzooming=10,Se.maxUnderzooming=3;var Ke="mapboxgl_preloaded_worker_pool",Ct=function(){this.active={}};Ct.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<Ct.workerCount;)this.workers.push(new vt);return this.active[l]=!0,this.workers.slice()},Ct.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Ct.prototype.isPreloaded=function(){return!!this.active[Ke]},Ct.prototype.numActive=function(){return Object.keys(this.active).length};var It,Ft=Math.floor(s.browser.hardwareConcurrency/2);function ut(){return It||(It=new Ct),It}function Ot(l,d){var h={};for(var g in l)g!=="ref"&&(h[g]=l[g]);return s.refProperties.forEach(function(C){C in d&&(h[C]=d[C])}),h}function St(l){l=l.slice();for(var d=Object.create(null),h=0;h<l.length;h++)d[l[h].id]=l[h];for(var g=0;g<l.length;g++)"ref"in l[g]&&(l[g]=Ot(l[g],d[l[g].ref]));return l}Ct.workerCount=Math.max(Math.min(Ft,6),1);var zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Fr(l,d,h){h.push({command:zt.addSource,args:[l,d[l]]})}function qt(l,d,h){d.push({command:zt.removeSource,args:[l]}),h[l]=!0}function Xr(l,d,h,g){qt(l,h,g),Fr(l,d,h)}function en(l,d,h){var g;for(g in l[h])if(l[h].hasOwnProperty(g)&&g!=="data"&&!s.deepEqual(l[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!s.deepEqual(l[h][g],d[h][g]))return!1;return!0}function zr(l,d,h,g,C,P){var R;for(R in d=d||{},l=l||{})l.hasOwnProperty(R)&&(s.deepEqual(l[R],d[R])||h.push({command:P,args:[g,R,d[R],C]}));for(R in d)d.hasOwnProperty(R)&&!l.hasOwnProperty(R)&&(s.deepEqual(l[R],d[R])||h.push({command:P,args:[g,R,d[R],C]}))}function Gr(l){return l.id}function Lr(l,d){return l[d.id]=d,l}var fi=function(l,d){this.reset(l,d)};fi.prototype.reset=function(l,d){this.points=l||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},fi.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=s.clamp(l,0,1);for(var d=1,h=this._distances[d],g=l*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var C=d-1,P=this._distances[C],R=h-P,L=R>0?(g-P)/R:0;return this.points[C].mult(1-L).add(this.points[d].mult(L))};var Vr=function(l,d,h){var g=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(l/h),this.yCellCount=Math.ceil(d/h);for(var P=0;P<this.xCellCount*this.yCellCount;P++)g.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function fr(l,d,h,g,C){var P=s.create();return d?(s.scale(P,P,[1/C,1/C,1]),h||s.rotateZ(P,P,g.angle)):s.multiply(P,g.labelPlaneMatrix,l),P}function Me(l,d,h,g,C){if(d){var P=s.clone(l);return s.scale(P,P,[C,C,1]),h||s.rotateZ(P,P,-g.angle),P}return g.glCoordMatrix}function Wt(l,d){var h=[l.x,l.y,0,1];ri(h,h,d);var g=h[3];return{point:new s.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function Kr(l,d){return .5+l/d*.5}function Ui(l,d){var h=l[0]/l[3],g=l[1]/l[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function la(l,d,h,g,C,P,R,L){var U=g?l.textSizeData:l.iconSizeData,X=s.evaluateSizeForZoom(U,h.transform.zoom),te=[256/h.width*2+1,256/h.height*2+1],Q=g?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Q.clear();for(var re=l.lineVertexArray,oe=g?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ee=h.transform.width/h.transform.height,Oe=!1,me=0;me<oe.length;me++){var Fe=oe.get(me);if(Fe.hidden||Fe.writingMode===s.WritingMode.vertical&&!Oe)Si(Fe.numGlyphs,Q);else{Oe=!1;var He=[Fe.anchorX,Fe.anchorY,0,1];if(s.transformMat4(He,He,d),Ui(He,te)){var We=Kr(h.transform.cameraToCenterDistance,He[3]),it=s.evaluateSizeForFeature(U,X,Fe),Xe=R?it/We:it*We,et=new s.Point(Fe.anchorX,Fe.anchorY),ht=Wt(et,C).point,Rt={},xt=Ie(Fe,Xe,!1,L,d,C,P,l.glyphOffsetArray,re,Q,ht,et,Rt,Ee);Oe=xt.useVertical,(xt.notEnoughRoom||Oe||xt.needsFlipping&&Ie(Fe,Xe,!0,L,d,C,P,l.glyphOffsetArray,re,Q,ht,et,Rt,Ee).notEnoughRoom)&&Si(Fe.numGlyphs,Q)}else Si(Fe.numGlyphs,Q)}}g?l.text.dynamicLayoutVertexBuffer.updateData(Q):l.icon.dynamicLayoutVertexBuffer.updateData(Q)}function ti(l,d,h,g,C,P,R,L,U,X,te){var Q=L.glyphStartIndex+L.numGlyphs,re=L.lineStartIndex,oe=L.lineStartIndex+L.lineLength,Ee=d.getoffsetX(L.glyphStartIndex),Oe=d.getoffsetX(Q-1),me=zn(l*Ee,h,g,C,P,R,L.segment,re,oe,U,X,te);if(!me)return null;var Fe=zn(l*Oe,h,g,C,P,R,L.segment,re,oe,U,X,te);return Fe?{first:me,last:Fe}:null}function Un(l,d,h,g){return l===s.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(l===s.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function Ie(l,d,h,g,C,P,R,L,U,X,te,Q,re,oe){var Ee,Oe=d/24,me=l.lineOffsetX*Oe,Fe=l.lineOffsetY*Oe;if(l.numGlyphs>1){var He=l.glyphStartIndex+l.numGlyphs,We=l.lineStartIndex,it=l.lineStartIndex+l.lineLength,Xe=ti(Oe,L,me,Fe,h,te,Q,l,U,P,re);if(!Xe)return{notEnoughRoom:!0};var et=Wt(Xe.first.point,R).point,ht=Wt(Xe.last.point,R).point;if(g&&!h){var Rt=Un(l.writingMode,et,ht,oe);if(Rt)return Rt}Ee=[Xe.first];for(var xt=l.glyphStartIndex+1;xt<He-1;xt++)Ee.push(zn(Oe*L.getoffsetX(xt),me,Fe,h,te,Q,l.segment,We,it,U,P,re));Ee.push(Xe.last)}else{if(g&&!h){var kt=Wt(Q,C).point,rr=l.lineStartIndex+l.segment+1,vr=new s.Point(U.getx(rr),U.gety(rr)),Cr=Wt(vr,C),gn=Cr.signedDistanceFromCamera>0?Cr.point:ko(Q,vr,kt,1,C),ir=Un(l.writingMode,kt,gn,oe);if(ir)return ir}var Ur=zn(Oe*L.getoffsetX(l.glyphStartIndex),me,Fe,h,te,Q,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,P,re);if(!Ur)return{notEnoughRoom:!0};Ee=[Ur]}for(var Yr=0,Nr=Ee;Yr<Nr.length;Yr+=1){var Dr=Nr[Yr];s.addDynamicAttributes(X,Dr.point,Dr.angle)}return{}}function ko(l,d,h,g,C){var P=Wt(l.add(l.sub(d)._unit()),C).point,R=h.sub(P);return h.add(R._mult(g/R.mag()))}function zn(l,d,h,g,C,P,R,L,U,X,te,Q){var re=g?l-d:l+d,oe=re>0?1:-1,Ee=0;g&&(oe*=-1,Ee=Math.PI),oe<0&&(Ee+=Math.PI);for(var Oe=oe>0?L+R:L+R+1,me=C,Fe=C,He=0,We=0,it=Math.abs(re),Xe=[];He+We<=it;){if((Oe+=oe)<L||Oe>=U)return null;if(Fe=me,Xe.push(me),(me=Q[Oe])===void 0){var et=new s.Point(X.getx(Oe),X.gety(Oe)),ht=Wt(et,te);if(ht.signedDistanceFromCamera>0)me=Q[Oe]=ht.point;else{var Rt=Oe-oe;me=ko(He===0?P:new s.Point(X.getx(Rt),X.gety(Rt)),et,Fe,it-He+1,te)}}He+=We,We=Fe.dist(me)}var xt=(it-He)/We,kt=me.sub(Fe),rr=kt.mult(xt)._add(Fe);rr._add(kt._unit()._perp()._mult(h*oe));var vr=Ee+Math.atan2(me.y-Fe.y,me.x-Fe.x);return Xe.push(rr),{point:rr,angle:vr,path:Xe}}Vr.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Vr.prototype.insert=function(l,d,h,g,C){this._forEachCell(d,h,g,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(C)},Vr.prototype.insertCircle=function(l,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Vr.prototype._insertBoxCell=function(l,d,h,g,C,P){this.boxCells[C].push(P)},Vr.prototype._insertCircleCell=function(l,d,h,g,C,P){this.circleCells[C].push(P)},Vr.prototype._query=function(l,d,h,g,C,P){if(h<0||l>this.width||g<0||d>this.height)return!C&&[];var R=[];if(l<=0&&d<=0&&this.width<=h&&this.height<=g){if(C)return!0;for(var L=0;L<this.boxKeys.length;L++)R.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var X=this.circles[3*U],te=this.circles[3*U+1],Q=this.circles[3*U+2];R.push({key:this.circleKeys[U],x1:X-Q,y1:te-Q,x2:X+Q,y2:te+Q})}return P?R.filter(P):R}return this._forEachCell(l,d,h,g,this._queryCell,R,{hitTest:C,seenUids:{box:{},circle:{}}},P),C?R.length>0:R},Vr.prototype._queryCircle=function(l,d,h,g,C){var P=l-h,R=l+h,L=d-h,U=d+h;if(R<0||P>this.width||U<0||L>this.height)return!g&&[];var X=[];return this._forEachCell(P,L,R,U,this._queryCellCircle,X,{hitTest:g,circle:{x:l,y:d,radius:h},seenUids:{box:{},circle:{}}},C),g?X.length>0:X},Vr.prototype.query=function(l,d,h,g,C){return this._query(l,d,h,g,!1,C)},Vr.prototype.hitTest=function(l,d,h,g,C){return this._query(l,d,h,g,!0,C)},Vr.prototype.hitTestCircle=function(l,d,h,g){return this._queryCircle(l,d,h,!0,g)},Vr.prototype._queryCell=function(l,d,h,g,C,P,R,L){var U=R.seenUids,X=this.boxCells[C];if(X!==null)for(var te=this.bboxes,Q=0,re=X;Q<re.length;Q+=1){var oe=re[Q];if(!U.box[oe]){U.box[oe]=!0;var Ee=4*oe;if(l<=te[Ee+2]&&d<=te[Ee+3]&&h>=te[Ee+0]&&g>=te[Ee+1]&&(!L||L(this.boxKeys[oe]))){if(R.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[oe],x1:te[Ee],y1:te[Ee+1],x2:te[Ee+2],y2:te[Ee+3]})}}}var Oe=this.circleCells[C];if(Oe!==null)for(var me=this.circles,Fe=0,He=Oe;Fe<He.length;Fe+=1){var We=He[Fe];if(!U.circle[We]){U.circle[We]=!0;var it=3*We;if(this._circleAndRectCollide(me[it],me[it+1],me[it+2],l,d,h,g)&&(!L||L(this.circleKeys[We]))){if(R.hitTest)return P.push(!0),!0;var Xe=me[it],et=me[it+1],ht=me[it+2];P.push({key:this.circleKeys[We],x1:Xe-ht,y1:et-ht,x2:Xe+ht,y2:et+ht})}}}},Vr.prototype._queryCellCircle=function(l,d,h,g,C,P,R,L){var U=R.circle,X=R.seenUids,te=this.boxCells[C];if(te!==null)for(var Q=this.bboxes,re=0,oe=te;re<oe.length;re+=1){var Ee=oe[re];if(!X.box[Ee]){X.box[Ee]=!0;var Oe=4*Ee;if(this._circleAndRectCollide(U.x,U.y,U.radius,Q[Oe+0],Q[Oe+1],Q[Oe+2],Q[Oe+3])&&(!L||L(this.boxKeys[Ee])))return P.push(!0),!0}}var me=this.circleCells[C];if(me!==null)for(var Fe=this.circles,He=0,We=me;He<We.length;He+=1){var it=We[He];if(!X.circle[it]){X.circle[it]=!0;var Xe=3*it;if(this._circlesCollide(Fe[Xe],Fe[Xe+1],Fe[Xe+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[it])))return P.push(!0),!0}}},Vr.prototype._forEachCell=function(l,d,h,g,C,P,R,L){for(var U=this._convertToXCellCoord(l),X=this._convertToYCellCoord(d),te=this._convertToXCellCoord(h),Q=this._convertToYCellCoord(g),re=U;re<=te;re++)for(var oe=X;oe<=Q;oe++)if(C.call(this,l,d,h,g,this.xCellCount*oe+re,P,R,L))return},Vr.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Vr.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Vr.prototype._circlesCollide=function(l,d,h,g,C,P){var R=g-l,L=C-d,U=h+P;return U*U>R*R+L*L},Vr.prototype._circleAndRectCollide=function(l,d,h,g,C,P,R){var L=(P-g)/2,U=Math.abs(l-(g+L));if(U>L+h)return!1;var X=(R-C)/2,te=Math.abs(d-(C+X));if(te>X+h)return!1;if(U<=L||te<=X)return!0;var Q=U-L,re=te-X;return Q*Q+re*re<=h*h};var No=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Si(l,d){for(var h=0;h<l;h++){var g=d.length;d.resize(g+4),d.float32.set(No,3*g)}}function ri(l,d,h){var g=d[0],C=d[1];return l[0]=h[0]*g+h[4]*C+h[12],l[1]=h[1]*g+h[5]*C+h[13],l[3]=h[3]*g+h[7]*C+h[15],l}var xi=function(l,d,h){d===void 0&&(d=new Vr(l.width+200,l.height+200,25)),h===void 0&&(h=new Vr(l.width+200,l.height+200,25)),this.transform=l,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Bn(l,d,h){return d*(s.EXTENT/(l.tileSize*Math.pow(2,h-l.tileID.overscaledZ)))}xi.prototype.placeCollisionBox=function(l,d,h,g,C){var P=this.projectAndGetPerspectiveRatio(g,l.anchorPointX,l.anchorPointY),R=h*P.perspectiveRatio,L=l.x1*R+P.point.x,U=l.y1*R+P.point.y,X=l.x2*R+P.point.x,te=l.y2*R+P.point.y;return!this.isInsideGrid(L,U,X,te)||!d&&this.grid.hitTest(L,U,X,te,C)?{box:[],offscreen:!1}:{box:[L,U,X,te],offscreen:this.isOffscreen(L,U,X,te)}},xi.prototype.placeCollisionCircles=function(l,d,h,g,C,P,R,L,U,X,te,Q,re){var oe=[],Ee=new s.Point(d.anchorX,d.anchorY),Oe=Wt(Ee,P),me=Kr(this.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),Fe=(X?C/me:C*me)/s.ONE_EM,He=Wt(Ee,R).point,We=ti(Fe,g,d.lineOffsetX*Fe,d.lineOffsetY*Fe,!1,He,Ee,d,h,R,{}),it=!1,Xe=!1,et=!0;if(We){for(var ht=.5*Q*me+re,Rt=new s.Point(-100,-100),xt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),kt=new fi,rr=We.first,vr=We.last,Cr=[],gn=rr.path.length-1;gn>=1;gn--)Cr.push(rr.path[gn]);for(var ir=1;ir<vr.path.length;ir++)Cr.push(vr.path[ir]);var Ur=2.5*ht;if(L){var Yr=Cr.map(function(Bo){return Wt(Bo,L)});Cr=Yr.some(function(Bo){return Bo.signedDistanceFromCamera<=0})?[]:Yr.map(function(Bo){return Bo.point})}var Nr=[];if(Cr.length>0){for(var Dr=Cr[0].clone(),Wr=Cr[0].clone(),Pr=1;Pr<Cr.length;Pr++)Dr.x=Math.min(Dr.x,Cr[Pr].x),Dr.y=Math.min(Dr.y,Cr[Pr].y),Wr.x=Math.max(Wr.x,Cr[Pr].x),Wr.y=Math.max(Wr.y,Cr[Pr].y);Nr=Dr.x>=Rt.x&&Wr.x<=xt.x&&Dr.y>=Rt.y&&Wr.y<=xt.y?[Cr]:Wr.x<Rt.x||Dr.x>xt.x||Wr.y<Rt.y||Dr.y>xt.y?[]:s.clipLine([Cr],Rt.x,Rt.y,xt.x,xt.y)}for(var Ir=0,ji=Nr;Ir<ji.length;Ir+=1){var yi;kt.reset(ji[Ir],.25*ht),yi=kt.length<=.5*ht?1:Math.ceil(kt.paddedLength/Ur)+1;for(var ds=0;ds<yi;ds++){var es=ds/Math.max(yi-1,1),di=kt.lerp(es),wi=di.x+100,to=di.y+100;oe.push(wi,to,ht,0);var ws=wi-ht,Fc=to-ht,Ns=wi+ht,Zo=to+ht;if(et=et&&this.isOffscreen(ws,Fc,Ns,Zo),Xe=Xe||this.isInsideGrid(ws,Fc,Ns,Zo),!l&&this.grid.hitTestCircle(wi,to,ht,te)&&(it=!0,!U))return{circles:[],offscreen:!1,collisionDetected:it}}}}return{circles:!U&&it||!Xe?[]:oe,offscreen:et,collisionDetected:it}},xi.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,C=-1/0,P=-1/0,R=0,L=l;R<L.length;R+=1){var U=L[R],X=new s.Point(U.x+100,U.y+100);h=Math.min(h,X.x),g=Math.min(g,X.y),C=Math.max(C,X.x),P=Math.max(P,X.y),d.push(X)}for(var te={},Q={},re=0,oe=this.grid.query(h,g,C,P).concat(this.ignoredGrid.query(h,g,C,P));re<oe.length;re+=1){var Ee=oe[re],Oe=Ee.key;if(te[Oe.bucketInstanceId]===void 0&&(te[Oe.bucketInstanceId]={}),!te[Oe.bucketInstanceId][Oe.featureIndex]){var me=[new s.Point(Ee.x1,Ee.y1),new s.Point(Ee.x2,Ee.y1),new s.Point(Ee.x2,Ee.y2),new s.Point(Ee.x1,Ee.y2)];s.polygonIntersectsPolygon(d,me)&&(te[Oe.bucketInstanceId][Oe.featureIndex]=!0,Q[Oe.bucketInstanceId]===void 0&&(Q[Oe.bucketInstanceId]=[]),Q[Oe.bucketInstanceId].push(Oe.featureIndex))}}return Q},xi.prototype.insertCollisionBox=function(l,d,h,g,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:C},l[0],l[1],l[2],l[3])},xi.prototype.insertCollisionCircles=function(l,d,h,g,C){for(var P=d?this.ignoredGrid:this.grid,R={bucketInstanceId:h,featureIndex:g,collisionGroupID:C},L=0;L<l.length;L+=4)P.insertCircle(R,l[L],l[L+1],l[L+2])},xi.prototype.projectAndGetPerspectiveRatio=function(l,d,h){var g=[d,h,0,1];return ri(g,g,l),{point:new s.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},xi.prototype.isOffscreen=function(l,d,h,g){return h<100||l>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},xi.prototype.isInsideGrid=function(l,d,h,g){return h>=0&&l<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},xi.prototype.getViewportMatrix=function(){var l=s.identity([]);return s.translate(l,l,[-100,-100,0]),l};var us=function(l,d,h,g){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):g&&h?1:0,this.placed=h};us.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var zi=function(l,d,h,g,C){this.text=new us(l?l.text:null,d,h,C),this.icon=new us(l?l.icon:null,d,g,C)};zi.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ps=function(l,d,h){this.text=l,this.icon=d,this.skipFade=h},wn=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},cl=function(l,d,h,g,C){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=C},Ce=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Re(l,d,h,g,C){var P=s.getAnchorAlignment(l),R=-(P.horizontalAlign-.5)*d,L=-(P.verticalAlign-.5)*h,U=s.evaluateVariableOffset(l,g);return new s.Point(R+U[0]*C,L+U[1]*C)}function $e(l,d,h,g,C,P){var R=l.x1,L=l.x2,U=l.y1,X=l.y2,te=l.anchorPointX,Q=l.anchorPointY,re=new s.Point(d,h);return g&&re._rotate(C?P:-P),{x1:R+re.x,y1:U+re.y,x2:L+re.x,y2:X+re.y,anchorPointX:te,anchorPointY:Q}}Ce.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[l]};var At=function(l,d,h,g){this.transform=l.clone(),this.collisionIndex=new xi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ce(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Ht(l,d,h,g,C){l.emplaceBack(d?1:0,h?1:0,g||0,C||0),l.emplaceBack(d?1:0,h?1:0,g||0,C||0),l.emplaceBack(d?1:0,h?1:0,g||0,C||0),l.emplaceBack(d?1:0,h?1:0,g||0,C||0)}At.prototype.getBucketParts=function(l,d,h,g){var C=h.getBucket(d),P=h.latestFeatureIndex;if(C&&P&&d.id===C.layerIds[0]){var R=h.collisionBoxArray,L=C.layers[0].layout,U=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),X=h.tileSize/s.EXTENT,te=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Q=L.get("text-pitch-alignment")==="map",re=L.get("text-rotation-alignment")==="map",oe=Bn(h,1,this.transform.zoom),Ee=fr(te,Q,re,this.transform,oe),Oe=null;if(Q){var me=Me(te,Q,re,this.transform,oe);Oe=s.multiply([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[C.bucketInstanceId]=new cl(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,h.tileID);var Fe={bucket:C,layout:L,posMatrix:te,textLabelPlaneMatrix:Ee,labelToScreenMatrix:Oe,scale:U,textPixelRatio:X,holdingForFade:h.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(g)for(var He=0,We=C.sortKeyRanges;He<We.length;He+=1){var it=We[He];l.push({sortKey:it.sortKey,symbolInstanceStart:it.symbolInstanceStart,symbolInstanceEnd:it.symbolInstanceEnd,parameters:Fe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Fe})}},At.prototype.attemptAnchorPlacement=function(l,d,h,g,C,P,R,L,U,X,te,Q,re,oe,Ee){var Oe,me=[Q.textOffset0,Q.textOffset1],Fe=Re(l,h,g,me,C),He=this.collisionIndex.placeCollisionBox($e(d,Fe.x,Fe.y,P,R,this.transform.angle),te,L,U,X.predicate);if(!Ee||this.collisionIndex.placeCollisionBox($e(Ee,Fe.x,Fe.y,P,R,this.transform.angle),te,L,U,X.predicate).box.length!==0)return He.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),this.variableOffsets[Q.crossTileID]={textOffset:me,width:h,height:g,anchor:l,textBoxScale:C,prevAnchor:Oe},this.markUsedJustification(re,l,Q,oe),re.allowVerticalPlacement&&(this.markUsedOrientation(re,oe,Q),this.placedOrientations[Q.crossTileID]=oe),{shift:Fe,placedGlyphBoxes:He}):void 0},At.prototype.placeLayerBucketPart=function(l,d,h){var g=this,C=l.parameters,P=C.bucket,R=C.layout,L=C.posMatrix,U=C.textLabelPlaneMatrix,X=C.labelToScreenMatrix,te=C.textPixelRatio,Q=C.holdingForFade,re=C.collisionBoxArray,oe=C.partiallyEvaluatedTextSize,Ee=C.collisionGroup,Oe=R.get("text-optional"),me=R.get("icon-optional"),Fe=R.get("text-allow-overlap"),He=R.get("icon-allow-overlap"),We=R.get("text-rotation-alignment")==="map",it=R.get("text-pitch-alignment")==="map",Xe=R.get("icon-text-fit")!=="none",et=R.get("symbol-z-order")==="viewport-y",ht=Fe&&(He||!P.hasIconData()||me),Rt=He&&(Fe||!P.hasTextData()||Oe);!P.collisionArrays&&re&&P.deserializeCollisionBoxes(re);var xt=function(ir,Ur){if(!d[ir.crossTileID])if(Q)g.placements[ir.crossTileID]=new Ps(!1,!1,!1);else{var Yr,Nr=!1,Dr=!1,Wr=!0,Pr=null,Ir={box:null,offscreen:null},ji={box:null,offscreen:null},yi=null,ds=null,es=0,di=0,wi=0;Ur.textFeatureIndex?es=Ur.textFeatureIndex:ir.useRuntimeCollisionCircles&&(es=ir.featureIndex),Ur.verticalTextFeatureIndex&&(di=Ur.verticalTextFeatureIndex);var to=Ur.textBox;if(to){var ws=function(vn){var yo=s.WritingMode.horizontal;if(P.allowVerticalPlacement&&!vn&&g.prevPlacement){var Us=g.prevPlacement.placedOrientations[ir.crossTileID];Us&&(g.placedOrientations[ir.crossTileID]=Us,g.markUsedOrientation(P,yo=Us,ir))}return yo},Fc=function(vn,yo){if(P.allowVerticalPlacement&&ir.numVerticalGlyphVertices>0&&Ur.verticalTextBox)for(var Us=0,Cl=P.writingModes;Us<Cl.length&&(Cl[Us]===s.WritingMode.vertical?(Ir=yo(),ji=Ir):Ir=vn(),!(Ir&&Ir.box&&Ir.box.length));Us+=1);else Ir=vn()};if(R.get("text-variable-anchor")){var Ns=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[ir.crossTileID]){var Zo=g.prevPlacement.variableOffsets[ir.crossTileID];Ns.indexOf(Zo.anchor)>0&&(Ns=Ns.filter(function(vn){return vn!==Zo.anchor})).unshift(Zo.anchor)}var Bo=function(vn,yo,Us){for(var Cl=vn.x2-vn.x1,sv=vn.y2-vn.y1,Ph=ir.textBoxScale,ov=Xe&&!He?yo:null,bf={box:[],offscreen:!1},Hg=Fe?2*Ns.length:Ns.length,gu=0;gu<Hg;++gu){var Rh=g.attemptAnchorPlacement(Ns[gu%Ns.length],vn,Cl,sv,Ph,We,it,te,L,Ee,gu>=Ns.length,ir,P,Us,ov);if(Rh&&(bf=Rh.placedGlyphBoxes)&&bf.box&&bf.box.length){Nr=!0,Pr=Rh.shift;break}}return bf};Fc(function(){return Bo(to,Ur.iconBox,s.WritingMode.horizontal)},function(){var vn=Ur.verticalTextBox;return P.allowVerticalPlacement&&!(Ir&&Ir.box&&Ir.box.length)&&ir.numVerticalGlyphVertices>0&&vn?Bo(vn,Ur.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Ir&&(Nr=Ir.box,Wr=Ir.offscreen);var _f=ws(Ir&&Ir.box);if(!Nr&&g.prevPlacement){var Au=g.prevPlacement.variableOffsets[ir.crossTileID];Au&&(g.variableOffsets[ir.crossTileID]=Au,g.markUsedJustification(P,Au.anchor,ir,_f))}}else{var Oc=function(vn,yo){var Us=g.collisionIndex.placeCollisionBox(vn,Fe,te,L,Ee.predicate);return Us&&Us.box&&Us.box.length&&(g.markUsedOrientation(P,yo,ir),g.placedOrientations[ir.crossTileID]=yo),Us};Fc(function(){return Oc(to,s.WritingMode.horizontal)},function(){var vn=Ur.verticalTextBox;return P.allowVerticalPlacement&&ir.numVerticalGlyphVertices>0&&vn?Oc(vn,s.WritingMode.vertical):{box:null,offscreen:null}}),ws(Ir&&Ir.box&&Ir.box.length)}}if(Nr=(Yr=Ir)&&Yr.box&&Yr.box.length>0,Wr=Yr&&Yr.offscreen,ir.useRuntimeCollisionCircles){var pu=P.text.placedSymbolArray.get(ir.centerJustifiedTextSymbolIndex),yf=s.evaluateSizeForFeature(P.textSizeData,oe,pu),va=R.get("text-padding");yi=g.collisionIndex.placeCollisionCircles(Fe,pu,P.lineVertexArray,P.glyphOffsetArray,yf,L,U,X,h,it,Ee.predicate,ir.collisionCircleDiameter,va),Nr=Fe||yi.circles.length>0&&!yi.collisionDetected,Wr=Wr&&yi.offscreen}if(Ur.iconFeatureIndex&&(wi=Ur.iconFeatureIndex),Ur.iconBox){var vf=function(vn){var yo=Xe&&Pr?$e(vn,Pr.x,Pr.y,We,it,g.transform.angle):vn;return g.collisionIndex.placeCollisionBox(yo,He,te,L,Ee.predicate)};Dr=ji&&ji.box&&ji.box.length&&Ur.verticalIconBox?(ds=vf(Ur.verticalIconBox)).box.length>0:(ds=vf(Ur.iconBox)).box.length>0,Wr=Wr&&ds.offscreen}var ba=Oe||ir.numHorizontalGlyphVertices===0&&ir.numVerticalGlyphVertices===0,$i=me||ir.numIconVertices===0;if(ba||$i?$i?ba||(Dr=Dr&&Nr):Nr=Dr&&Nr:Dr=Nr=Dr&&Nr,Nr&&Yr&&Yr.box&&g.collisionIndex.insertCollisionBox(Yr.box,R.get("text-ignore-placement"),P.bucketInstanceId,ji&&ji.box&&di?di:es,Ee.ID),Dr&&ds&&g.collisionIndex.insertCollisionBox(ds.box,R.get("icon-ignore-placement"),P.bucketInstanceId,wi,Ee.ID),yi&&(Nr&&g.collisionIndex.insertCollisionCircles(yi.circles,R.get("text-ignore-placement"),P.bucketInstanceId,es,Ee.ID),h)){var Ja=P.bucketInstanceId,Dc=g.collisionCircleArrays[Ja];Dc===void 0&&(Dc=g.collisionCircleArrays[Ja]=new wn);for(var wl=0;wl<yi.circles.length;wl+=4)Dc.circles.push(yi.circles[wl+0]),Dc.circles.push(yi.circles[wl+1]),Dc.circles.push(yi.circles[wl+2]),Dc.circles.push(yi.collisionDetected?1:0)}g.placements[ir.crossTileID]=new Ps(Nr||ht,Dr||Rt,Wr||P.justReloaded),d[ir.crossTileID]=!0}};if(et)for(var kt=P.getSortedSymbolIndexes(this.transform.angle),rr=kt.length-1;rr>=0;--rr){var vr=kt[rr];xt(P.symbolInstances.get(vr),P.collisionArrays[vr])}else for(var Cr=l.symbolInstanceStart;Cr<l.symbolInstanceEnd;Cr++)xt(P.symbolInstances.get(Cr),P.collisionArrays[Cr]);if(h&&P.bucketInstanceId in this.collisionCircleArrays){var gn=this.collisionCircleArrays[P.bucketInstanceId];s.invert(gn.invProjMatrix,L),gn.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},At.prototype.markUsedJustification=function(l,d,h,g){var C;C=g===s.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(d)];for(var P=0,R=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];P<R.length;P+=1){var L=R[P];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=C>=0&&L!==C?0:h.crossTileID)}},At.prototype.markUsedOrientation=function(l,d,h){for(var g=d===s.WritingMode.horizontal||d===s.WritingMode.horizontalOnly?d:0,C=d===s.WritingMode.vertical?d:0,P=0,R=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];P<R.length;P+=1)l.text.placedSymbolArray.get(R[P]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=C)},At.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(l):1,C=d?d.opacities:{},P=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],X=C[L];X?(this.opacities[L]=new zi(X,g,U.text,U.icon),h=h||U.text!==X.text.placed||U.icon!==X.icon.placed):(this.opacities[L]=new zi(null,g,U.text,U.icon,U.skipFade),h=h||U.text||U.icon)}for(var te in C){var Q=C[te];if(!this.opacities[te]){var re=new zi(Q,g,!1,!1);re.isHidden()||(this.opacities[te]=re,h=h||Q.text.placed||Q.icon.placed)}}for(var oe in P)this.variableOffsets[oe]||!this.opacities[oe]||this.opacities[oe].isHidden()||(this.variableOffsets[oe]=P[oe]);for(var Ee in R)this.placedOrientations[Ee]||!this.opacities[Ee]||this.opacities[Ee].isHidden()||(this.placedOrientations[Ee]=R[Ee]);h?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)},At.prototype.updateLayerOpacities=function(l,d){for(var h={},g=0,C=d;g<C.length;g+=1){var P=C[g],R=P.getBucket(l);R&&P.latestFeatureIndex&&l.id===R.layerIds[0]&&this.updateBucketOpacities(R,h,P.collisionBoxArray)}},At.prototype.updateBucketOpacities=function(l,d,h){var g=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var C=l.layers[0].layout,P=new zi(null,0,!1,!1,!0),R=C.get("text-allow-overlap"),L=C.get("icon-allow-overlap"),U=C.get("text-variable-anchor"),X=C.get("text-rotation-alignment")==="map",te=C.get("text-pitch-alignment")==="map",Q=C.get("icon-text-fit")!=="none",re=new zi(null,0,R&&(L||!l.hasIconData()||C.get("icon-optional")),L&&(R||!l.hasTextData()||C.get("text-optional")),!0);!l.collisionArrays&&h&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(h);for(var oe=function(Fe,He,We){for(var it=0;it<He/4;it++)Fe.opacityVertexArray.emplaceBack(We)},Ee=function(Fe){var He=l.symbolInstances.get(Fe),We=He.numHorizontalGlyphVertices,it=He.numVerticalGlyphVertices,Xe=He.crossTileID,et=g.opacities[Xe];d[Xe]?et=P:et||(g.opacities[Xe]=et=re),d[Xe]=!0;var ht=He.numIconVertices>0,Rt=g.placedOrientations[He.crossTileID],xt=Rt===s.WritingMode.vertical,kt=Rt===s.WritingMode.horizontal||Rt===s.WritingMode.horizontalOnly;if(We>0||it>0){var rr=nf(et.text);oe(l.text,We,xt?ua:rr),oe(l.text,it,kt?ua:rr);var vr=et.text.isHidden();[He.rightJustifiedTextSymbolIndex,He.centerJustifiedTextSymbolIndex,He.leftJustifiedTextSymbolIndex].forEach(function(Ir){Ir>=0&&(l.text.placedSymbolArray.get(Ir).hidden=vr||xt?1:0)}),He.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(He.verticalPlacedTextSymbolIndex).hidden=vr||kt?1:0);var Cr=g.variableOffsets[He.crossTileID];Cr&&g.markUsedJustification(l,Cr.anchor,He,Rt);var gn=g.placedOrientations[He.crossTileID];gn&&(g.markUsedJustification(l,"left",He,gn),g.markUsedOrientation(l,gn,He))}if(ht){var ir=nf(et.icon),Ur=!(Q&&He.verticalPlacedIconSymbolIndex&&xt);He.placedIconSymbolIndex>=0&&(oe(l.icon,He.numIconVertices,Ur?ir:ua),l.icon.placedSymbolArray.get(He.placedIconSymbolIndex).hidden=et.icon.isHidden()),He.verticalPlacedIconSymbolIndex>=0&&(oe(l.icon,He.numVerticalIconVertices,Ur?ua:ir),l.icon.placedSymbolArray.get(He.verticalPlacedIconSymbolIndex).hidden=et.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var Yr=l.collisionArrays[Fe];if(Yr){var Nr=new s.Point(0,0);if(Yr.textBox||Yr.verticalTextBox){var Dr=!0;if(U){var Wr=g.variableOffsets[Xe];Wr?(Nr=Re(Wr.anchor,Wr.width,Wr.height,Wr.textOffset,Wr.textBoxScale),X&&Nr._rotate(te?g.transform.angle:-g.transform.angle)):Dr=!1}Yr.textBox&&Ht(l.textCollisionBox.collisionVertexArray,et.text.placed,!Dr||xt,Nr.x,Nr.y),Yr.verticalTextBox&&Ht(l.textCollisionBox.collisionVertexArray,et.text.placed,!Dr||kt,Nr.x,Nr.y)}var Pr=!!(!kt&&Yr.verticalIconBox);Yr.iconBox&&Ht(l.iconCollisionBox.collisionVertexArray,et.icon.placed,Pr,Q?Nr.x:0,Q?Nr.y:0),Yr.verticalIconBox&&Ht(l.iconCollisionBox.collisionVertexArray,et.icon.placed,!Pr,Q?Nr.x:0,Q?Nr.y:0)}}},Oe=0;Oe<l.symbolInstances.length;Oe++)Ee(Oe);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=me.invProjMatrix,l.placementViewportMatrix=me.viewportMatrix,l.collisionCircleArray=me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},At.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},At.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},At.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},At.prototype.stillRecent=function(l,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>l},At.prototype.setStale=function(){this.stale=!0};var gr=Math.pow(2,25),wr=Math.pow(2,24),ni=Math.pow(2,17),Ii=Math.pow(2,16),Gi=Math.pow(2,9),Js=Math.pow(2,8),yh=Math.pow(2,1);function nf(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var d=l.placed?1:0,h=Math.floor(127*l.opacity);return h*gr+d*wr+h*ni+d*Ii+h*Gi+d*Js+h*yh+d}var ua=0,ll=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ll.prototype.continuePlacement=function(l,d,h,g,C){for(var P=this._bucketParts;this._currentTileIndex<l.length;)if(d.getBucketParts(P,g,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(R,L){return R.sortKey-L.sortKey}));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,C())return!0;return!1};var ul=function(l,d,h,g,C,P,R){this.placement=new At(l,C,P,R),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};ul.prototype.isDone=function(){return this._done},ul.prototype.continuePlacement=function(l,d,h){for(var g=this,C=s.browser.now(),P=function(){var U=s.browser.now()-C;return!g._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var R=d[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ll(R)),this._inProgressLayer.continuePlacement(h[R.source],this.placement,this._showCollisionBoxes,R,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},ul.prototype.commit=function(l){return this.placement.commit(l),this.placement};var vh=512/s.EXTENT/2,fl=function(l,d,h){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var C=d.get(g),P=C.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,l)})}};fl.prototype.getScaledCoordinates=function(l,d){var h=vh/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*s.EXTENT+l.anchorX)*h),y:Math.floor((d.canonical.y*s.EXTENT+l.anchorY)*h)}},fl.prototype.findMatches=function(l,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=0;C<l.length;C++){var P=l.get(C);if(!P.crossTileID){var R=this.indexedSymbolInstances[P.key];if(R)for(var L=this.getScaledCoordinates(P,d),U=0,X=R;U<X.length;U+=1){var te=X[U];if(Math.abs(te.coord.x-L.x)<=g&&Math.abs(te.coord.y-L.y)<=g&&!h[te.crossTileID]){h[te.crossTileID]=!0,P.crossTileID=te.crossTileID;break}}}}};var Rs=function(){this.maxCrossTileID=0};Rs.prototype.generate=function(){return++this.maxCrossTileID};var Uo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Uo.prototype.handleWrapJump=function(l){var d=Math.round((l-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],C={};for(var P in g){var R=g[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),C[R.tileID.key]=R}this.indexes[h]=C}this.lng=l},Uo.prototype.addBucket=function(l,d,h){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var C=this.usedCrossTileIDs[l.overscaledZ];for(var P in this.indexes){var R=this.indexes[P];if(Number(P)>l.overscaledZ)for(var L in R){var U=R[L];U.tileID.isChildOf(l)&&U.findMatches(d.symbolInstances,l,C)}else{var X=R[l.scaledTo(Number(P)).key];X&&X.findMatches(d.symbolInstances,l,C)}}for(var te=0;te<d.symbolInstances.length;te++){var Q=d.symbolInstances.get(te);Q.crossTileID||(Q.crossTileID=h.generate(),C[Q.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new fl(l,d.symbolInstances,d.bucketInstanceId),!0},Uo.prototype.removeBucketCrossTileIDs=function(l,d){for(var h in d.indexedSymbolInstances)for(var g=0,C=d.indexedSymbolInstances[h];g<C.length;g+=1)delete this.usedCrossTileIDs[l][C[g].crossTileID]},Uo.prototype.removeStaleBuckets=function(l){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var C in g)l[g[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[C]),delete g[C],d=!0)}return d};var fa=function(){this.layerIndexes={},this.crossTileIDs=new Rs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};fa.prototype.addLayer=function(l,d,h){var g=this.layerIndexes[l.id];g===void 0&&(g=this.layerIndexes[l.id]=new Uo);var C=!1,P={};g.handleWrapJump(h);for(var R=0,L=d;R<L.length;R+=1){var U=L[R],X=U.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(U.tileID,X,this.crossTileIDs)&&(C=!0),P[X.bucketInstanceId]=!0)}return g.removeStaleBuckets(P)&&(C=!0),C},fa.prototype.pruneUnusedLayers=function(l){var d={};for(var h in l.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var Oa=function(l,d){return s.emitValidationErrors(l,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},ha=s.pick(zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),hi=s.pick(zt,["setCenter","setZoom","setBearing","setPitch"]),wo=function(){var l={},d=s.styleSpec.$version;for(var h in s.styleSpec.$root){var g,C=s.styleSpec.$root[h];C.required&&(g=h==="version"?d:C.type==="array"?[]:{})!=null&&(l[h]=g)}return l}(),Ln=function(l){function d(h,g){var C=this;g===void 0&&(g={}),l.call(this),this.map=h,this.dispatcher=new ye(ut(),this),this.imageManager=new j,this.imageManager.setEventedParent(this),this.glyphManager=new de(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new ne(256,512),this.crossTileSymbolIndex=new fa,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var P=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(R){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(L,U){if(s.triggerPluginCompletionEvent(L),U&&U.every(function(te){return te}))for(var X in P.sourceCaches)P.sourceCaches[X].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var L=C.sourceCaches[R.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var X in C._layers){var te=C._layers[X];te.source===U.id&&C._validateLayer(te)}}}})}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var C=this;g===void 0&&(g={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var P=typeof g.validate=="boolean"?g.validate:!s.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var R=this.map._requestManager.transformRequest(h,s.ResourceType.Style);this._request=s.getJSON(R,function(L,U){C._request=null,L?C.fire(new s.ErrorEvent(L)):U&&C._load(U,P)})},d.prototype.loadJSON=function(h,g){var C=this;g===void 0&&(g={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){C._request=null,C._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(wo,!1)},d.prototype._load=function(h,g){if(!g||!Oa(this,s.validateStyle(h))){for(var C in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(C,h.sources[C],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var P=St(this.stylesheet.layers);this._order=P.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var R=0,L=P;R<L.length;R+=1){var U=L[R];(U=s.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new J(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(C,P,R){var L,U,X,te=s.browser.devicePixelRatio>1?"@2x":"",Q=s.getJSON(P.transformRequest(P.normalizeSpriteURL(C,te,".json"),s.ResourceType.SpriteJSON),function(Ee,Oe){Q=null,X||(X=Ee,L=Oe,oe())}),re=s.getImage(P.transformRequest(P.normalizeSpriteURL(C,te,".png"),s.ResourceType.SpriteImage),function(Ee,Oe){re=null,X||(X=Ee,U=Oe,oe())});function oe(){if(X)R(X);else if(L&&U){var Ee=s.browser.getImageData(U),Oe={};for(var me in L){var Fe=L[me],He=Fe.width,We=Fe.height,it=Fe.x,Xe=Fe.y,et=Fe.sdf,ht=Fe.pixelRatio,Rt=Fe.stretchX,xt=Fe.stretchY,kt=Fe.content,rr=new s.RGBAImage({width:He,height:We});s.RGBAImage.copy(Ee,rr,{x:it,y:Xe},{x:0,y:0},{width:He,height:We}),Oe[me]={data:rr,pixelRatio:ht,sdf:et,stretchX:Rt,stretchY:xt,content:kt}}R(null,Oe)}}return{cancel:function(){Q&&(Q.cancel(),Q=null),re&&(re.cancel(),re=null)}}}(h,this.map._requestManager,function(C,P){if(g._spriteRequest=null,C)g.fire(new s.ErrorEvent(C));else if(P)for(var R in P)g.imageManager.addImage(R,P[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new s.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var C=h.sourceLayer;if(C){var P=g.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(C)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+C+'" does not exist on source "'+P.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],C=0,P=h;C<P.length;C+=1){var R=this._layers[P[C]];R.type!=="custom"&&g.push(R.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var C=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var R in(C.length||P.length)&&this._updateWorkerLayers(C,P),this._updatedSources){var L=this._updatedSources[R];L==="reload"?this._reloadSource(R):L==="clear"&&this._clearSource(R)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var X={};for(var te in this.sourceCaches){var Q=this.sourceCaches[te];X[te]=Q.used,Q.used=!1}for(var re=0,oe=this._order;re<oe.length;re+=1){var Ee=this._layers[oe[re]];Ee.recalculate(h,this._availableImages),!Ee.isHidden(h.zoom)&&Ee.source&&(this.sourceCaches[Ee.source].used=!0)}for(var Oe in X){var me=this.sourceCaches[Oe];X[Oe]!==me.used&&me.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Oe}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new s.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),Oa(this,s.validateStyle(h)))return!1;(h=s.clone$1(h)).layers=St(h.layers);var C=function(R,L){if(!R)return[{command:zt.setStyle,args:[L]}];var U=[];try{if(!s.deepEqual(R.version,L.version))return[{command:zt.setStyle,args:[L]}];s.deepEqual(R.center,L.center)||U.push({command:zt.setCenter,args:[L.center]}),s.deepEqual(R.zoom,L.zoom)||U.push({command:zt.setZoom,args:[L.zoom]}),s.deepEqual(R.bearing,L.bearing)||U.push({command:zt.setBearing,args:[L.bearing]}),s.deepEqual(R.pitch,L.pitch)||U.push({command:zt.setPitch,args:[L.pitch]}),s.deepEqual(R.sprite,L.sprite)||U.push({command:zt.setSprite,args:[L.sprite]}),s.deepEqual(R.glyphs,L.glyphs)||U.push({command:zt.setGlyphs,args:[L.glyphs]}),s.deepEqual(R.transition,L.transition)||U.push({command:zt.setTransition,args:[L.transition]}),s.deepEqual(R.light,L.light)||U.push({command:zt.setLight,args:[L.light]});var X={},te=[];(function(re,oe,Ee,Oe){var me;for(me in oe=oe||{},re=re||{})re.hasOwnProperty(me)&&(oe.hasOwnProperty(me)||qt(me,Ee,Oe));for(me in oe)oe.hasOwnProperty(me)&&(re.hasOwnProperty(me)?s.deepEqual(re[me],oe[me])||(re[me].type==="geojson"&&oe[me].type==="geojson"&&en(re,oe,me)?Ee.push({command:zt.setGeoJSONSourceData,args:[me,oe[me].data]}):Xr(me,oe,Ee,Oe)):Fr(me,oe,Ee))})(R.sources,L.sources,te,X);var Q=[];R.layers&&R.layers.forEach(function(re){X[re.source]?U.push({command:zt.removeLayer,args:[re.id]}):Q.push(re)}),U=U.concat(te),function(re,oe,Ee){oe=oe||[];var Oe,me,Fe,He,We,it,Xe,et=(re=re||[]).map(Gr),ht=oe.map(Gr),Rt=re.reduce(Lr,{}),xt=oe.reduce(Lr,{}),kt=et.slice(),rr=Object.create(null);for(Oe=0,me=0;Oe<et.length;Oe++)xt.hasOwnProperty(Fe=et[Oe])?me++:(Ee.push({command:zt.removeLayer,args:[Fe]}),kt.splice(kt.indexOf(Fe,me),1));for(Oe=0,me=0;Oe<ht.length;Oe++)kt[kt.length-1-Oe]!==(Fe=ht[ht.length-1-Oe])&&(Rt.hasOwnProperty(Fe)?(Ee.push({command:zt.removeLayer,args:[Fe]}),kt.splice(kt.lastIndexOf(Fe,kt.length-me),1)):me++,Ee.push({command:zt.addLayer,args:[xt[Fe],it=kt[kt.length-Oe]]}),kt.splice(kt.length-Oe,0,Fe),rr[Fe]=!0);for(Oe=0;Oe<ht.length;Oe++)if(He=Rt[Fe=ht[Oe]],We=xt[Fe],!rr[Fe]&&!s.deepEqual(He,We))if(s.deepEqual(He.source,We.source)&&s.deepEqual(He["source-layer"],We["source-layer"])&&s.deepEqual(He.type,We.type)){for(Xe in zr(He.layout,We.layout,Ee,Fe,null,zt.setLayoutProperty),zr(He.paint,We.paint,Ee,Fe,null,zt.setPaintProperty),s.deepEqual(He.filter,We.filter)||Ee.push({command:zt.setFilter,args:[Fe,We.filter]}),s.deepEqual(He.minzoom,We.minzoom)&&s.deepEqual(He.maxzoom,We.maxzoom)||Ee.push({command:zt.setLayerZoomRange,args:[Fe,We.minzoom,We.maxzoom]}),He)He.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&(Xe.indexOf("paint.")===0?zr(He[Xe],We[Xe],Ee,Fe,Xe.slice(6),zt.setPaintProperty):s.deepEqual(He[Xe],We[Xe])||Ee.push({command:zt.setLayerProperty,args:[Fe,Xe,We[Xe]]}));for(Xe in We)We.hasOwnProperty(Xe)&&!He.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&(Xe.indexOf("paint.")===0?zr(He[Xe],We[Xe],Ee,Fe,Xe.slice(6),zt.setPaintProperty):s.deepEqual(He[Xe],We[Xe])||Ee.push({command:zt.setLayerProperty,args:[Fe,Xe,We[Xe]]}))}else Ee.push({command:zt.removeLayer,args:[Fe]}),it=kt[kt.lastIndexOf(Fe)+1],Ee.push({command:zt.addLayer,args:[We,it]})}(Q,L.layers,U)}catch(re){console.warn("Unable to compute style diff:",re),U=[{command:zt.setStyle,args:[L]}]}return U}(this.serialize(),h).filter(function(R){return!(R.command in hi)});if(C.length===0)return!1;var P=C.filter(function(R){return!(R.command in ha)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(R){return R.command}).join(", ")+".");return C.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,C){var P=this;if(C===void 0&&(C={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(s.validateStyle.source,"sources."+h,g,null,C))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[h]=new Se(h,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:R.serialize(),sourceId:h}}),R.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new s.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var C=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],C.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),C.setEventedParent(null),C.clearTiles(),C.onRemove&&C.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,C){C===void 0&&(C={}),this._checkLoaded();var P=h.id;if(this.getLayer(P))this.fire(new s.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var R;if(h.type==="custom"){if(Oa(this,s.validateCustomStyleLayer(h)))return;R=s.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(P,h.source),h=s.clone$1(h),h=s.extend(h,{source:P})),this._validate(s.validateStyle.layer,"layers."+P,h,{arrayIndex:-1},C))return;R=s.createStyleLayer(h),this._validateLayer(R),R.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[R.id]=R.serialize()}var L=g?this._order.indexOf(g):this._order.length;if(g&&L===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(L,0,P),this._layerOrderChanged=!0,this._layers[P]=R,this._removedLayers[P]&&R.source&&R.type!=="custom"){var U=this._removedLayers[P];delete this._removedLayers[P],U.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var C=this._order.indexOf(h);this._order.splice(C,1);var P=g?this._order.indexOf(g):this._order.length;g&&P===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(P,0,h),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var C=this._order.indexOf(h);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,C){this._checkLoaded();var P=this.getLayer(h);P?P.minzoom===g&&P.maxzoom===C||(g!=null&&(P.minzoom=g),C!=null&&(P.maxzoom=C),this._updateLayer(P)):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(h);if(P){if(!s.deepEqual(P.filter,g))return g==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(s.validateStyle.filter,"layers."+P.id+".filter",g,null,C)||(P.filter=s.clone$1(g),this._updateLayer(P)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return s.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,C,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(h);R?s.deepEqual(R.getLayoutProperty(g),C)||(R.setLayoutProperty(g,C,P),this._updateLayer(R)):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var C=this.getLayer(h);if(C)return C.getLayoutProperty(g);this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,C,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(h);R?s.deepEqual(R.getPaintProperty(g),C)||(R.setPaintProperty(g,C,P)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var C=h.source,P=h.sourceLayer,R=this.sourceCaches[C];if(R!==void 0){var L=R.getSource().type;L==="geojson"&&P?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||P?(h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(P,h.id,g)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var C=h.source,P=this.sourceCaches[C];if(P!==void 0){var R=P.getSource().type,L=R==="vector"?h.sourceLayer:void 0;R!=="vector"||L?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(L,h.id,g):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,C=h.sourceLayer,P=this.sourceCaches[g];if(P!==void 0){if(P.getSource().type!=="vector"||C)return h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(C,h.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,C=function(Rt){return g._layers[Rt].type==="fill-extrusion"},P={},R=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(C(U)){P[U]=L;for(var X=0,te=h;X<te.length;X+=1){var Q=te[X][U];if(Q)for(var re=0,oe=Q;re<oe.length;re+=1)R.push(oe[re])}}}R.sort(function(Rt,xt){return xt.intersectionZ-Rt.intersectionZ});for(var Ee=[],Oe=this._order.length-1;Oe>=0;Oe--){var me=this._order[Oe];if(C(me))for(var Fe=R.length-1;Fe>=0;Fe--){var He=R[Fe].feature;if(P[He.layer.id]<Oe)break;Ee.push(He),R.pop()}else for(var We=0,it=h;We<it.length;We+=1){var Xe=it[We][me];if(Xe)for(var et=0,ht=Xe;et<ht.length;et+=1)Ee.push(ht[et].feature)}}return Ee},d.prototype.queryRenderedFeatures=function(h,g,C){g&&g.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var P={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,L=g.layers;R<L.length;R+=1){var U=L[R],X=this._layers[U];if(!X)return this.fire(new s.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];P[X.source]=!0}}var te=[];for(var Q in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!P[Q]||te.push(Xt(this.sourceCaches[Q],this._layers,this._serializedLayers,h,g,C));return this.placement&&te.push(function(re,oe,Ee,Oe,me,Fe,He){for(var We={},it=Fe.queryRenderedSymbols(Oe),Xe=[],et=0,ht=Object.keys(it).map(Number);et<ht.length;et+=1)Xe.push(He[ht[et]]);Xe.sort($t);for(var Rt=function(){var Cr=kt[xt],gn=Cr.featureIndex.lookupSymbolFeatures(it[Cr.bucketInstanceId],oe,Cr.bucketIndex,Cr.sourceLayerIndex,me.filter,me.layers,me.availableImages,re);for(var ir in gn){var Ur=We[ir]=We[ir]||[],Yr=gn[ir];Yr.sort(function(Wr,Pr){var Ir=Cr.featureSortOrder;if(Ir){var ji=Ir.indexOf(Wr.featureIndex);return Ir.indexOf(Pr.featureIndex)-ji}return Pr.featureIndex-Wr.featureIndex});for(var Nr=0,Dr=Yr;Nr<Dr.length;Nr+=1)Ur.push(Dr[Nr])}},xt=0,kt=Xe;xt<kt.length;xt+=1)Rt();var rr=function(Cr){We[Cr].forEach(function(gn){var ir=gn.feature,Ur=Ee[re[Cr].source].getFeatureState(ir.layer["source-layer"],ir.id);ir.source=ir.layer.source,ir.layer["source-layer"]&&(ir.sourceLayer=ir.layer["source-layer"]),ir.state=Ur})};for(var vr in We)rr(vr);return We}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(te)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var C=this.sourceCaches[h];return C?function(P,R){for(var L=P.getRenderableIds().map(function(oe){return P.getTileByID(oe)}),U=[],X={},te=0;te<L.length;te++){var Q=L[te],re=Q.tileID.canonical.key;X[re]||(X[re]=!0,Q.querySourceFeatures(U,R))}return U}(C,g):[]},d.prototype.addSourceType=function(h,g,C){return d.getSourceType(h)?C(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},C):C(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var C=this.light.getLight(),P=!1;for(var R in h)if(!s.deepEqual(h[R],C[R])){P=!0;break}if(P){var L={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(L)}},d.prototype._validate=function(h,g,C,P,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Oa(this,h.call(s.validateStyle,s.extend({key:g,style:this.serialize(),value:C,styleSpec:s.styleSpec},P)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,C,P,R){R===void 0&&(R=!1);for(var L=!1,U=!1,X={},te=0,Q=this._order;te<Q.length;te+=1){var re=this._layers[Q[te]];if(re.type==="symbol"){if(!X[re.source]){var oe=this.sourceCaches[re.source];X[re.source]=oe.getRenderableIds(!0).map(function(He){return oe.getTileByID(He)}).sort(function(He,We){return We.tileID.overscaledZ-He.tileID.overscaledZ||(He.tileID.isLessThan(We.tileID)?-1:1)})}var Ee=this.crossTileSymbolIndex.addLayer(re,X[re.source],h.center.lng);L=L||Ee}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||C===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),h.zoom))&&(this.pauseablePlacement=new ul(h,this._order,R,g,C,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Oe=0,me=this._order;Oe<me.length;Oe+=1){var Fe=this._layers[me[Oe]];Fe.type==="symbol"&&this.placement.updateLayerOpacities(Fe,X[Fe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,C){this.imageManager.getImages(g.icons,C),this._updateTilesForChangedImages();var P=this.sourceCaches[g.source];P&&P.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,C){this.glyphManager.getGlyphs(g.stacks,C)},d.prototype.getResource=function(h,g,C){return s.makeRequest(g,C)},d}(s.Evented);Ln.getSourceType=function(l){return nt[l]},Ln.setSourceType=function(l,d){nt[l]=d},Ln.registerForPluginStateChange=s.registerForPluginStateChange;var ii=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),Da=Cn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),hl=Cn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),GA=Cn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),VA=Cn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),sf=Cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Kl=Cn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),vc=Cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),zo=Cn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),of=Cn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),af=Cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Yl=Cn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ao=Cn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Xs=Cn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),cf=Cn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Fi=Cn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),dl=Cn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),da=Cn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Aa=Cn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),pa=Cn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),La=Cn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ga=Cn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ka=Cn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Na=Cn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ma=Cn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),bh=Cn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),xh=Cn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Cn(l,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),C=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=P?P.concat(C):C,L={};return{fragmentSource:l=l.replace(h,function(U,X,te,Q,re){return L[re]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
varying `+te+" "+Q+" "+re+`;
#else
uniform `+te+" "+Q+" u_"+re+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+re+`
    `+te+" "+Q+" "+re+" = u_"+re+`;
#endif
`}),vertexSource:d=d.replace(h,function(U,X,te,Q,re){var oe=Q==="float"?"vec2":"vec4",Ee=re.match(/color/)?"color":oe;return L[re]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+te+" "+oe+" a_"+re+`;
varying `+te+" "+Q+" "+re+`;
#else
uniform `+te+" "+Q+" u_"+re+`;
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = a_"+re+`;
#else
    `+te+" "+Q+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = unpack_mix_"+Ee+"(a_"+re+", u_"+re+`_t);
#else
    `+te+" "+Q+" "+re+" = u_"+re+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+te+" "+oe+" a_"+re+`;
#else
uniform `+te+" "+Q+" u_"+re+`;
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+te+" "+Q+" "+re+" = a_"+re+`;
#else
    `+te+" "+Q+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+te+" "+Q+" "+re+" = unpack_mix_"+Ee+"(a_"+re+", u_"+re+`_t);
#else
    `+te+" "+Q+" "+re+" = u_"+re+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var ql=Object.freeze({__proto__:null,prelude:Da,background:hl,backgroundPattern:GA,circle:VA,clippingMask:sf,heatmap:Kl,heatmapTexture:vc,collisionBox:zo,collisionCircle:of,debug:af,fill:Yl,fillOutline:Ao,fillOutlinePattern:Xs,fillPattern:cf,fillExtrusion:Fi,fillExtrusionPattern:dl,hillshadePrepare:da,hillshade:Aa,line:pa,lineGradient:La,linePattern:ga,lineSDF:ka,raster:Na,symbolIcon:ma,symbolSDF:bh,symbolTextAndIcon:xh}),Zl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function wh(l){for(var d=[],h=0;h<l.length;h++)if(l[h]!==null){var g=l[h].split(" ");d.push(g.pop())}return d}Zl.prototype.bind=function(l,d,h,g,C,P,R,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==g.length,X=0;!U&&X<g.length;X++)this.boundPaintVertexBuffers[X]!==g[X]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!U&&this.boundIndexBuffer===C&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),R&&R.bind(),C&&C.dynamicDraw&&C.bind(),L&&L.bind()):this.freshBind(d,h,g,C,P,R,L)},Zl.prototype.freshBind=function(l,d,h,g,C,P,R){var L,U=l.numAttributes,X=this.context,te=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R;else{L=X.currentNumAttributes||0;for(var Q=U;Q<L;Q++)te.disableVertexAttribArray(Q)}d.enableAttributes(te,l);for(var re=0,oe=h;re<oe.length;re+=1)oe[re].enableAttributes(te,l);P&&P.enableAttributes(te,l),R&&R.enableAttributes(te,l),d.bind(),d.setVertexAttribPointers(te,l,C);for(var Ee=0,Oe=h;Ee<Oe.length;Ee+=1){var me=Oe[Ee];me.bind(),me.setVertexAttribPointers(te,l,C)}P&&(P.bind(),P.setVertexAttribPointers(te,l,C)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(te,l,C)),X.currentNumAttributes=U},Zl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ch=function(l,d,h,g,C,P){var R=l.gl;this.program=R.createProgram();for(var L=wh(h.staticAttributes),U=g?g.getBinderAttributes():[],X=L.concat(U),te=h.staticUniforms?wh(h.staticUniforms):[],Q=g?g.getBinderUniforms():[],re=[],oe=0,Ee=te.concat(Q);oe<Ee.length;oe+=1){var Oe=Ee[oe];re.indexOf(Oe)<0&&re.push(Oe)}var me=g?g.defines():[];P&&me.push("#define OVERDRAW_INSPECTOR;");var Fe=me.concat(Da.fragmentSource,h.fragmentSource).join(`
`),He=me.concat(Da.vertexSource,h.vertexSource).join(`
`),We=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(We,Fe),R.compileShader(We),R.attachShader(this.program,We);var it=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(it,He),R.compileShader(it),R.attachShader(this.program,it),this.attributes={};var Xe={};this.numAttributes=X.length;for(var et=0;et<this.numAttributes;et++)X[et]&&(R.bindAttribLocation(this.program,et,X[et]),this.attributes[X[et]]=et);R.linkProgram(this.program),R.deleteShader(it),R.deleteShader(We);for(var ht=0;ht<re.length;ht++){var Rt=re[ht];if(Rt&&!Xe[Rt]){var xt=R.getUniformLocation(this.program,Rt);xt&&(Xe[Rt]=xt)}}this.fixedUniforms=C(l,Xe),this.binderUniforms=g?g.getUniforms(l,Xe):[]}}};function bc(l,d,h){var g=1/Bn(h,1,d.transform.tileZoom),C=Math.pow(2,h.tileID.overscaledZ),P=h.tileSize*Math.pow(2,d.transform.tileZoom)/C,R=P*(h.tileID.canonical.x+h.tileID.wrap*C),L=P*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[R>>16,L>>16],u_pixel_coord_lower:[65535&R,65535&L]}}Ch.prototype.draw=function(l,d,h,g,C,P,R,L,U,X,te,Q,re,oe,Ee,Oe){var me,Fe=l.gl;if(!this.failedToCreate){for(var He in l.program.set(this.program),l.setDepthMode(h),l.setStencilMode(g),l.setColorMode(C),l.setCullFace(P),this.fixedUniforms)this.fixedUniforms[He].set(R[He]);oe&&oe.setUniforms(l,this.binderUniforms,Q,{zoom:re});for(var We=(me={},me[Fe.LINES]=2,me[Fe.TRIANGLES]=3,me[Fe.LINE_STRIP]=1,me)[d],it=0,Xe=te.get();it<Xe.length;it+=1){var et=Xe[it],ht=et.vaos||(et.vaos={});(ht[L]||(ht[L]=new Zl)).bind(l,this,U,oe?oe.getPaintVertexBuffers():[],X,et.vertexOffset,Ee,Oe),Fe.drawElements(d,et.primitiveLength*We,Fe.UNSIGNED_SHORT,et.primitiveOffset*We*2)}}};var Eh=function(l,d,h,g){var C=d.style.light,P=C.properties.get("position"),R=[P.x,P.y,P.z],L=s.create$1();C.properties.get("anchor")==="viewport"&&s.fromRotation(L,-d.transform.angle),s.transformMat3(R,R,L);var U=C.properties.get("color");return{u_matrix:l,u_lightpos:R,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+h,u_opacity:g}},Go=function(l,d,h,g,C,P,R){return s.extend(Eh(l,d,h,g),bc(P,d,R),{u_height_factor:-Math.pow(2,C.overscaledZ)/R.tileSize/8})},Vo=function(l){return{u_matrix:l}},Ks=function(l,d,h,g){return s.extend(Vo(l),bc(h,d,g))},Th=function(l,d){return{u_matrix:l,u_world:d}},Ql=function(l,d,h,g,C){return s.extend(Ks(l,d,h,g),{u_world:C})},eu=function(l,d,h,g){var C,P,R=l.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var L=Bn(h,1,R.zoom);C=!0,P=[L,L]}else C=!1,P=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:P}},Ua=function(l,d,h){var g=Bn(h,1,d.zoom),C=Math.pow(2,d.zoom-h.tileID.overscaledZ),P=h.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*C),d.pixelsToGLUnits[1]/(g*C)],u_overscale_factor:P}},lf=function(l,d,h){return{u_matrix:l,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Ho=function(l,d,h){return h===void 0&&(h=1),{u_matrix:l,u_color:d,u_overlay:0,u_overlay_scale:h}},jo=function(l){return{u_matrix:l}},Al=function(l,d,h,g){return{u_matrix:l,u_extrude_scale:Bn(d,1,h),u_intensity:g}},Sn=function(l,d,h){var g=l.transform;return{u_matrix:Bh(l,d,h),u_ratio:1/Bn(d,1,g.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Pn=function(l,d,h,g){return s.extend(Sn(l,d,h),{u_image:0,u_image_height:g})},tu=function(l,d,h,g){var C=l.transform,P=xc(d,C);return{u_matrix:Bh(l,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Bn(d,1,C.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[P,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},HA=function(l,d,h,g,C){var P=l.lineAtlas,R=xc(d,l.transform),L=h.layout.get("line-cap")==="round",U=P.getDash(g.from,L),X=P.getDash(g.to,L),te=U.width*C.fromScale,Q=X.width*C.toScale;return s.extend(Sn(l,d,h),{u_patternscale_a:[R/te,-U.height/2],u_patternscale_b:[R/Q,-X.height/2],u_sdfgamma:P.width/(256*Math.min(te,Q)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:X.y,u_mix:C.t})};function xc(l,d){return 1/Bn(l,1,d.tileZoom)}function Bh(l,d,h){return l.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var jA=function(l,d,h,g,C){return{u_matrix:l,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(R=C.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(P=C.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:Sh(C.paint.get("raster-hue-rotate"))};var P,R};function Sh(l){l*=Math.PI/180;var d=Math.sin(l),h=Math.cos(l);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Yi,_a=function(l,d,h,g,C,P,R,L,U,X){var te=C.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:te.width/te.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:R,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+g,u_texsize:X,u_texture:0}},po=function(l,d,h,g,C,P,R,L,U,X,te){var Q=C.transform;return s.extend(_a(l,d,h,g,C,P,R,L,U,X),{u_gamma_scale:g?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},ru=function(l,d,h,g,C,P,R,L,U,X){return s.extend(po(l,d,h,g,C,P,R,L,!0,U),{u_texsize_icon:X,u_texture_icon:1})},za=function(l,d,h){return{u_matrix:l,u_opacity:d,u_color:h}},wc=function(l,d,h,g,C,P){return s.extend(function(R,L,U,X){var te=U.imageManager.getPattern(R.from.toString()),Q=U.imageManager.getPattern(R.to.toString()),re=U.imageManager.getPixelSize(),oe=re.width,Ee=re.height,Oe=Math.pow(2,X.tileID.overscaledZ),me=X.tileSize*Math.pow(2,U.transform.tileZoom)/Oe,Fe=me*(X.tileID.canonical.x+X.tileID.wrap*Oe),He=me*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:te.tl,u_pattern_br_a:te.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[oe,Ee],u_mix:L.t,u_pattern_size_a:te.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Bn(X,1,U.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,He>>16],u_pixel_coord_lower:[65535&Fe,65535&He]}}(g,P,h,C),{u_matrix:l,u_opacity:d})},Fs={fillExtrusion:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_lightpos:new s.Uniform3f(l,d.u_lightpos),u_lightintensity:new s.Uniform1f(l,d.u_lightintensity),u_lightcolor:new s.Uniform3f(l,d.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,d.u_vertical_gradient),u_opacity:new s.Uniform1f(l,d.u_opacity)}},fillExtrusionPattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_lightpos:new s.Uniform3f(l,d.u_lightpos),u_lightintensity:new s.Uniform1f(l,d.u_lightintensity),u_lightcolor:new s.Uniform3f(l,d.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,d.u_vertical_gradient),u_height_factor:new s.Uniform1f(l,d.u_height_factor),u_image:new s.Uniform1i(l,d.u_image),u_texsize:new s.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade),u_opacity:new s.Uniform1f(l,d.u_opacity)}},fill:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},fillPattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_image:new s.Uniform1i(l,d.u_image),u_texsize:new s.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade)}},fillOutline:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_world:new s.Uniform2f(l,d.u_world)}},fillOutlinePattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_world:new s.Uniform2f(l,d.u_world),u_image:new s.Uniform1i(l,d.u_image),u_texsize:new s.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade)}},circle:function(l,d){return{u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(l,d.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(l,d.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},collisionBox:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(l,d.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(l,d.u_extrude_scale),u_overscale_factor:new s.Uniform1f(l,d.u_overscale_factor)}},collisionCircle:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_inv_matrix:new s.UniformMatrix4f(l,d.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(l,d.u_viewport_size)}},debug:function(l,d){return{u_color:new s.UniformColor(l,d.u_color),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_overlay:new s.Uniform1i(l,d.u_overlay),u_overlay_scale:new s.Uniform1f(l,d.u_overlay_scale)}},clippingMask:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},heatmap:function(l,d){return{u_extrude_scale:new s.Uniform1f(l,d.u_extrude_scale),u_intensity:new s.Uniform1f(l,d.u_intensity),u_matrix:new s.UniformMatrix4f(l,d.u_matrix)}},heatmapTexture:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_world:new s.Uniform2f(l,d.u_world),u_image:new s.Uniform1i(l,d.u_image),u_color_ramp:new s.Uniform1i(l,d.u_color_ramp),u_opacity:new s.Uniform1f(l,d.u_opacity)}},hillshade:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_image:new s.Uniform1i(l,d.u_image),u_latrange:new s.Uniform2f(l,d.u_latrange),u_light:new s.Uniform2f(l,d.u_light),u_shadow:new s.UniformColor(l,d.u_shadow),u_highlight:new s.UniformColor(l,d.u_highlight),u_accent:new s.UniformColor(l,d.u_accent)}},hillshadePrepare:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_image:new s.Uniform1i(l,d.u_image),u_dimension:new s.Uniform2f(l,d.u_dimension),u_zoom:new s.Uniform1f(l,d.u_zoom),u_unpack:new s.Uniform4f(l,d.u_unpack)}},line:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels)}},lineGradient:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels),u_image:new s.Uniform1i(l,d.u_image),u_image_height:new s.Uniform1f(l,d.u_image_height)}},linePattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_texsize:new s.Uniform2f(l,d.u_texsize),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_image:new s.Uniform1i(l,d.u_image),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels),u_scale:new s.Uniform3f(l,d.u_scale),u_fade:new s.Uniform1f(l,d.u_fade)}},lineSDF:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_ratio:new s.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,d.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(l,d.u_patternscale_a),u_patternscale_b:new s.Uniform2f(l,d.u_patternscale_b),u_sdfgamma:new s.Uniform1f(l,d.u_sdfgamma),u_image:new s.Uniform1i(l,d.u_image),u_tex_y_a:new s.Uniform1f(l,d.u_tex_y_a),u_tex_y_b:new s.Uniform1f(l,d.u_tex_y_b),u_mix:new s.Uniform1f(l,d.u_mix)}},raster:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_tl_parent:new s.Uniform2f(l,d.u_tl_parent),u_scale_parent:new s.Uniform1f(l,d.u_scale_parent),u_buffer_scale:new s.Uniform1f(l,d.u_buffer_scale),u_fade_t:new s.Uniform1f(l,d.u_fade_t),u_opacity:new s.Uniform1f(l,d.u_opacity),u_image0:new s.Uniform1i(l,d.u_image0),u_image1:new s.Uniform1i(l,d.u_image1),u_brightness_low:new s.Uniform1f(l,d.u_brightness_low),u_brightness_high:new s.Uniform1f(l,d.u_brightness_high),u_saturation_factor:new s.Uniform1f(l,d.u_saturation_factor),u_contrast_factor:new s.Uniform1f(l,d.u_contrast_factor),u_spin_weights:new s.Uniform3f(l,d.u_spin_weights)}},symbolIcon:function(l,d){return{u_is_size_zoom_constant:new s.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,d.u_size_t),u_size:new s.Uniform1f(l,d.u_size),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,d.u_pitch),u_rotate_symbol:new s.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,d.u_fade_change),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new s.Uniform1i(l,d.u_is_text),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_texsize:new s.Uniform2f(l,d.u_texsize),u_texture:new s.Uniform1i(l,d.u_texture)}},symbolSDF:function(l,d){return{u_is_size_zoom_constant:new s.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,d.u_size_t),u_size:new s.Uniform1f(l,d.u_size),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,d.u_pitch),u_rotate_symbol:new s.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,d.u_fade_change),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new s.Uniform1i(l,d.u_is_text),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_texsize:new s.Uniform2f(l,d.u_texsize),u_texture:new s.Uniform1i(l,d.u_texture),u_gamma_scale:new s.Uniform1f(l,d.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,d.u_is_halo)}},symbolTextAndIcon:function(l,d){return{u_is_size_zoom_constant:new s.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,d.u_size_t),u_size:new s.Uniform1f(l,d.u_size),u_camera_to_center_distance:new s.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,d.u_pitch),u_rotate_symbol:new s.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,d.u_fade_change),u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new s.Uniform1i(l,d.u_is_text),u_pitch_with_map:new s.Uniform1i(l,d.u_pitch_with_map),u_texsize:new s.Uniform2f(l,d.u_texsize),u_texsize_icon:new s.Uniform2f(l,d.u_texsize_icon),u_texture:new s.Uniform1i(l,d.u_texture),u_texture_icon:new s.Uniform1i(l,d.u_texture_icon),u_gamma_scale:new s.Uniform1f(l,d.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,d.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,d.u_is_halo)}},background:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_opacity:new s.Uniform1f(l,d.u_opacity),u_color:new s.UniformColor(l,d.u_color)}},backgroundPattern:function(l,d){return{u_matrix:new s.UniformMatrix4f(l,d.u_matrix),u_opacity:new s.Uniform1f(l,d.u_opacity),u_image:new s.Uniform1i(l,d.u_image),u_pattern_tl_a:new s.Uniform2f(l,d.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(l,d.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(l,d.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(l,d.u_pattern_br_b),u_texsize:new s.Uniform2f(l,d.u_texsize),u_mix:new s.Uniform1f(l,d.u_mix),u_pattern_size_a:new s.Uniform2f(l,d.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(l,d.u_pattern_size_b),u_scale_a:new s.Uniform1f(l,d.u_scale_a),u_scale_b:new s.Uniform1f(l,d.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,d.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(l,d.u_tile_units_to_pixels)}}};function Ga(l,d,h,g,C,P,R){for(var L=l.context,U=L.gl,X=l.useProgram("collisionBox"),te=[],Q=0,re=0,oe=0;oe<g.length;oe++){var Ee=g[oe],Oe=d.getTile(Ee),me=Oe.getBucket(h);if(me){var Fe=Ee.posMatrix;C[0]===0&&C[1]===0||(Fe=l.translatePosMatrix(Ee.posMatrix,Oe,C,P));var He=R?me.textCollisionBox:me.iconCollisionBox,We=me.collisionCircleArray;if(We.length>0){var it=s.create(),Xe=Fe;s.mul(it,me.placementInvProjMatrix,l.transform.glCoordMatrix),s.mul(it,it,me.placementViewportMatrix),te.push({circleArray:We,circleOffset:re,transform:Xe,invTransform:it}),re=Q+=We.length/4}He&&X.draw(L,U.LINES,be.disabled,De.disabled,l.colorModeForRenderPass(),xe.disabled,Ua(Fe,l.transform,Oe),h.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,l.transform.zoom,null,null,He.collisionVertexBuffer)}}if(R&&te.length){var et=l.useProgram("collisionCircle"),ht=new s.StructArrayLayout2f1f2i16;ht.resize(4*Q),ht._trim();for(var Rt=0,xt=0,kt=te;xt<kt.length;xt+=1)for(var rr=kt[xt],vr=0;vr<rr.circleArray.length/4;vr++){var Cr=4*vr,gn=rr.circleArray[Cr+0],ir=rr.circleArray[Cr+1],Ur=rr.circleArray[Cr+2],Yr=rr.circleArray[Cr+3];ht.emplace(Rt++,gn,ir,Ur,Yr,0),ht.emplace(Rt++,gn,ir,Ur,Yr,1),ht.emplace(Rt++,gn,ir,Ur,Yr,2),ht.emplace(Rt++,gn,ir,Ur,Yr,3)}(!Yi||Yi.length<2*Q)&&(Yi=function(yi){var ds=2*yi,es=new s.StructArrayLayout3ui6;es.resize(ds),es._trim();for(var di=0;di<ds;di++){var wi=6*di;es.uint16[wi+0]=4*di+0,es.uint16[wi+1]=4*di+1,es.uint16[wi+2]=4*di+2,es.uint16[wi+3]=4*di+2,es.uint16[wi+4]=4*di+3,es.uint16[wi+5]=4*di+0}return es}(Q));for(var Nr=L.createIndexBuffer(Yi,!0),Dr=L.createVertexBuffer(ht,s.collisionCircleLayout.members,!0),Wr=0,Pr=te;Wr<Pr.length;Wr+=1){var Ir=Pr[Wr],ji=lf(Ir.transform,Ir.invTransform,l.transform);et.draw(L,U.TRIANGLES,be.disabled,De.disabled,l.colorModeForRenderPass(),xe.disabled,ji,h.id,Dr,Nr,s.SegmentVector.simpleSegment(0,2*Ir.circleOffset,Ir.circleArray.length,Ir.circleArray.length/2),null,l.transform.zoom,null,null,null)}Dr.destroy(),Nr.destroy()}}var Os=s.identity(new Float32Array(16));function Va(l,d,h,g,C,P){var R=s.getAnchorAlignment(l),L=-(R.horizontalAlign-.5)*d,U=-(R.verticalAlign-.5)*h,X=s.evaluateVariableOffset(l,g);return new s.Point((L/C+X[0])*P,(U/C+X[1])*P)}function Cc(l,d,h,g,C,P,R,L,U,X,te){var Q=l.text.placedSymbolArray,re=l.text.dynamicLayoutVertexArray,oe=l.icon.dynamicLayoutVertexArray,Ee={};re.clear();for(var Oe=0;Oe<Q.length;Oe++){var me=Q.get(Oe),Fe=me.hidden||!me.crossTileID||l.allowVerticalPlacement&&!me.placedOrientation?null:g[me.crossTileID];if(Fe){var He=new s.Point(me.anchorX,me.anchorY),We=Wt(He,h?L:R),it=Kr(P.cameraToCenterDistance,We.signedDistanceFromCamera),Xe=C.evaluateSizeForFeature(l.textSizeData,X,me)*it/s.ONE_EM;h&&(Xe*=l.tilePixelRatio/U);for(var et=Va(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale,Xe),ht=h?Wt(He.add(et),R).point:We.point.add(d?et.rotate(-P.angle):et),Rt=l.allowVerticalPlacement&&me.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,xt=0;xt<me.numGlyphs;xt++)s.addDynamicAttributes(re,ht,Rt);te&&me.associatedIconIndex>=0&&(Ee[me.associatedIconIndex]={shiftedAnchor:ht,angle:Rt})}else Si(me.numGlyphs,re)}if(te){oe.clear();for(var kt=l.icon.placedSymbolArray,rr=0;rr<kt.length;rr++){var vr=kt.get(rr);if(vr.hidden)Si(vr.numGlyphs,oe);else{var Cr=Ee[rr];if(Cr)for(var gn=0;gn<vr.numGlyphs;gn++)s.addDynamicAttributes(oe,Cr.shiftedAnchor,Cr.angle);else Si(vr.numGlyphs,oe)}}l.icon.dynamicLayoutVertexBuffer.updateData(oe)}l.text.dynamicLayoutVertexBuffer.updateData(re)}function Ec(l,d,h){return h.iconsInText&&d?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Ha(l,d,h,g,C,P,R,L,U,X,te,Q){for(var re=l.context,oe=re.gl,Ee=l.transform,Oe=L==="map",me=U==="map",Fe=Oe&&h.layout.get("symbol-placement")!=="point",He=Oe&&!me&&!Fe,We=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,it=!1,Xe=l.depthModeForSublayer(0,be.ReadOnly),et=h.layout.get("text-variable-anchor"),ht=[],Rt=0,xt=g;Rt<xt.length;Rt+=1){var kt=xt[Rt],rr=d.getTile(kt),vr=rr.getBucket(h);if(vr){var Cr=C?vr.text:vr.icon;if(Cr&&Cr.segments.get().length){var gn=Cr.programConfigurations.get(h.id),ir=C||vr.sdfIcons,Ur=C?vr.textSizeData:vr.iconSizeData,Yr=me||Ee.pitch!==0,Nr=l.useProgram(Ec(ir,C,vr),gn),Dr=s.evaluateSizeForZoom(Ur,Ee.zoom),Wr=void 0,Pr=[0,0],Ir=void 0,ji=void 0,yi=null,ds=void 0;if(C)Ir=rr.glyphAtlasTexture,ji=oe.LINEAR,Wr=rr.glyphAtlasTexture.size,vr.iconsInText&&(Pr=rr.imageAtlasTexture.size,yi=rr.imageAtlasTexture,ds=Yr||l.options.rotating||l.options.zooming||Ur.kind==="composite"||Ur.kind==="camera"?oe.LINEAR:oe.NEAREST);else{var es=h.layout.get("icon-size").constantOr(0)!==1||vr.iconsNeedLinear;Ir=rr.imageAtlasTexture,ji=ir||l.options.rotating||l.options.zooming||es||Yr?oe.LINEAR:oe.NEAREST,Wr=rr.imageAtlasTexture.size}var di=Bn(rr,1,l.transform.zoom),wi=fr(kt.posMatrix,me,Oe,l.transform,di),to=Me(kt.posMatrix,me,Oe,l.transform,di),ws=et&&vr.hasTextData(),Fc=h.layout.get("icon-text-fit")!=="none"&&ws&&vr.hasIconData();Fe&&la(vr,kt.posMatrix,l,C,wi,to,me,X);var Ns=l.translatePosMatrix(kt.posMatrix,rr,P,R),Zo=Fe||C&&et||Fc?Os:wi,Bo=l.translatePosMatrix(to,rr,P,R,!0),_f=ir&&h.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Au={program:Nr,buffers:Cr,uniformValues:ir?vr.iconsInText?ru(Ur.kind,Dr,He,me,l,Ns,Zo,Bo,Wr,Pr):po(Ur.kind,Dr,He,me,l,Ns,Zo,Bo,C,Wr):_a(Ur.kind,Dr,He,me,l,Ns,Zo,Bo,C,Wr),atlasTexture:Ir,atlasTextureIcon:yi,atlasInterpolation:ji,atlasInterpolationIcon:ds,isSDF:ir,hasHalo:_f};if(We&&vr.canOverlap){it=!0;for(var Oc=0,pu=Cr.segments.get();Oc<pu.length;Oc+=1){var yf=pu[Oc];ht.push({segments:new s.SegmentVector([yf]),sortKey:yf.sortKey,state:Au})}}else ht.push({segments:Cr.segments,sortKey:0,state:Au})}}}it&&ht.sort(function(Dc,wl){return Dc.sortKey-wl.sortKey});for(var va=0,vf=ht;va<vf.length;va+=1){var ba=vf[va],$i=ba.state;if(re.activeTexture.set(oe.TEXTURE0),$i.atlasTexture.bind($i.atlasInterpolation,oe.CLAMP_TO_EDGE),$i.atlasTextureIcon&&(re.activeTexture.set(oe.TEXTURE1),$i.atlasTextureIcon&&$i.atlasTextureIcon.bind($i.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),$i.isSDF){var Ja=$i.uniformValues;$i.hasHalo&&(Ja.u_is_halo=1,Tc($i.buffers,ba.segments,h,l,$i.program,Xe,te,Q,Ja)),Ja.u_is_halo=0}Tc($i.buffers,ba.segments,h,l,$i.program,Xe,te,Q,$i.uniformValues)}}function Tc(l,d,h,g,C,P,R,L,U){var X=g.context;C.draw(X,X.gl.TRIANGLES,P,R,L,xe.disabled,U,h.id,l.layoutVertexBuffer,l.indexBuffer,d,h.paint,g.transform.zoom,l.programConfigurations.get(h.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function nu(l,d,h,g,C,P,R){var L,U,X,te,Q,re=l.context.gl,oe=h.paint.get("fill-pattern"),Ee=oe&&oe.constantOr(1),Oe=h.getCrossfadeParameters();R?(U=Ee&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=re.LINES):(U=Ee?"fillPattern":"fill",L=re.TRIANGLES);for(var me=0,Fe=g;me<Fe.length;me+=1){var He=Fe[me],We=d.getTile(He);if(!Ee||We.patternsLoaded()){var it=We.getBucket(h);if(it){var Xe=it.programConfigurations.get(h.id),et=l.useProgram(U,Xe);Ee&&(l.context.activeTexture.set(re.TEXTURE0),We.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Xe.updatePaintBuffers(Oe));var ht=oe.constantOr(null);if(ht&&We.imageAtlas){var Rt=We.imageAtlas,xt=Rt.patternPositions[ht.to.toString()],kt=Rt.patternPositions[ht.from.toString()];xt&&kt&&Xe.setConstantPatternPositions(xt,kt)}var rr=l.translatePosMatrix(He.posMatrix,We,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(R){te=it.indexBuffer2,Q=it.segments2;var vr=[re.drawingBufferWidth,re.drawingBufferHeight];X=U==="fillOutlinePattern"&&Ee?Ql(rr,l,Oe,We,vr):Th(rr,vr)}else te=it.indexBuffer,Q=it.segments,X=Ee?Ks(rr,l,Oe,We):Vo(rr);et.draw(l.context,L,C,l.stencilModeForClipping(He),P,xe.disabled,X,h.id,it.layoutVertexBuffer,te,Q,h.paint,l.transform.zoom,Xe)}}}}function pl(l,d,h,g,C,P,R){for(var L=l.context,U=L.gl,X=h.paint.get("fill-extrusion-pattern"),te=X.constantOr(1),Q=h.getCrossfadeParameters(),re=h.paint.get("fill-extrusion-opacity"),oe=0,Ee=g;oe<Ee.length;oe+=1){var Oe=Ee[oe],me=d.getTile(Oe),Fe=me.getBucket(h);if(Fe){var He=Fe.programConfigurations.get(h.id),We=l.useProgram(te?"fillExtrusionPattern":"fillExtrusion",He);te&&(l.context.activeTexture.set(U.TEXTURE0),me.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),He.updatePaintBuffers(Q));var it=X.constantOr(null);if(it&&me.imageAtlas){var Xe=me.imageAtlas,et=Xe.patternPositions[it.to.toString()],ht=Xe.patternPositions[it.from.toString()];et&&ht&&He.setConstantPatternPositions(et,ht)}var Rt=l.translatePosMatrix(Oe.posMatrix,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),xt=h.paint.get("fill-extrusion-vertical-gradient"),kt=te?Go(Rt,l,xt,re,Oe,Q,me):Eh(Rt,l,xt,re);We.draw(L,L.gl.TRIANGLES,C,P,R,xe.backCCW,kt,h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,h.paint,l.transform.zoom,He)}}}function iu(l,d,h,g,C,P){var R=l.context,L=R.gl,U=d.fbo;if(U){var X=l.useProgram("hillshade");R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var te=function(Q,re,oe){var Ee=oe.paint.get("hillshade-shadow-color"),Oe=oe.paint.get("hillshade-highlight-color"),me=oe.paint.get("hillshade-accent-color"),Fe=oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Fe-=Q.transform.angle);var He,We,it,Xe=!Q.options.moving;return{u_matrix:Q.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:(He=re.tileID,We=Math.pow(2,He.canonical.z),it=He.canonical.y,[new s.MercatorCoordinate(0,it/We).toLngLat().lat,new s.MercatorCoordinate(0,(it+1)/We).toLngLat().lat]),u_light:[oe.paint.get("hillshade-exaggeration"),Fe],u_shadow:Ee,u_highlight:Oe,u_accent:me}}(l,d,h);X.draw(R,L.TRIANGLES,g,C,P,xe.disabled,te,h.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function $A(l,d,h,g,C,P){var R=l.context,L=R.gl,U=d.dem;if(U&&U.data){var X=U.dim,te=U.stride,Q=U.getPixels();if(R.activeTexture.set(L.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||l.getTileTexture(te),d.demTexture){var re=d.demTexture;re.update(Q,{premultiply:!1}),re.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else d.demTexture=new s.Texture(R,Q,L.RGBA,{premultiply:!1}),d.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);R.activeTexture.set(L.TEXTURE0);var oe=d.fbo;if(!oe){var Ee=new s.Texture(R,{width:X,height:X,data:null},L.RGBA);Ee.bind(L.LINEAR,L.CLAMP_TO_EDGE),(oe=d.fbo=R.createFramebuffer(X,X,!0)).colorAttachment.set(Ee.texture)}R.bindFramebuffer.set(oe.framebuffer),R.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(R,L.TRIANGLES,g,C,P,xe.disabled,function(Oe,me){var Fe=me.stride,He=s.create();return s.ortho(He,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(He,He,[0,-s.EXTENT,0]),{u_matrix:He,u_image:1,u_dimension:[Fe,Fe],u_zoom:Oe.overscaledZ,u_unpack:me.getUnpackVector()}}(d.tileID,U),h.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function gl(l,d,h,g,C){var P=g.paint.get("raster-fade-duration");if(P>0){var R=s.browser.now(),L=(R-l.timeAdded)/P,U=d?(R-d.timeAdded)/P:-1,X=h.getSource(),te=C.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),Q=!d||Math.abs(d.tileID.overscaledZ-te)>Math.abs(l.tileID.overscaledZ-te),re=Q&&l.refreshedUponExpiration?1:s.clamp(Q?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),d?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}var su=new s.Color(1,0,0,1),Bc=new s.Color(0,1,0,1),ja=new s.Color(0,0,1,1),ou=new s.Color(1,0,1,1),$a=new s.Color(0,1,1,1);function uf(l,d,h,g){ml(l,0,d+h/2,l.transform.width,h,g)}function ff(l,d,h,g){ml(l,d-h/2,0,h,l.transform.height,g)}function ml(l,d,h,g,C,P){var R=l.context,L=R.gl;L.enable(L.SCISSOR_TEST),L.scissor(d*s.browser.devicePixelRatio,h*s.browser.devicePixelRatio,g*s.browser.devicePixelRatio,C*s.browser.devicePixelRatio),R.clear({color:P}),L.disable(L.SCISSOR_TEST)}function Ih(l,d,h){var g=l.context,C=g.gl,P=h.posMatrix,R=l.useProgram("debug"),L=be.disabled,U=De.disabled,X=l.colorModeForRenderPass();g.activeTexture.set(C.TEXTURE0),l.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R.draw(g,C.LINE_STRIP,L,U,X,xe.disabled,Ho(P,s.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var te=d.getTileByID(h.key).latestRawTileData,Q=Math.floor((te&&te.byteLength||0)/1024),re=d.getTile(h).tileSize,oe=512/Math.min(re,512)*(h.overscaledZ/l.transform.zoom)*.5,Ee=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ee+=" => "+h.overscaledZ),function(Oe,me){Oe.initDebugOverlayCanvas();var Fe=Oe.debugOverlayCanvas,He=Oe.context.gl,We=Oe.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,Fe.width,Fe.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(me,5,5),We.strokeText(me,5,5),Oe.debugOverlayTexture.update(Fe),Oe.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(l,Ee+" "+Q+"kb"),R.draw(g,C.TRIANGLES,L,U,Ae.alphaBlended,xe.disabled,Ho(P,s.Color.transparent,oe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Wa={symbol:function(l,d,h,g,C){if(l.renderPass==="translucent"){var P=De.disabled,R=l.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(L,U,X,te,Q,re,oe){for(var Ee=U.transform,Oe=Q==="map",me=re==="map",Fe=0,He=L;Fe<He.length;Fe+=1){var We=He[Fe],it=te.getTile(We),Xe=it.getBucket(X);if(Xe&&Xe.text&&Xe.text.segments.get().length){var et=s.evaluateSizeForZoom(Xe.textSizeData,Ee.zoom),ht=Bn(it,1,U.transform.zoom),Rt=fr(We.posMatrix,me,Oe,U.transform,ht),xt=X.layout.get("icon-text-fit")!=="none"&&Xe.hasIconData();if(et){var kt=Math.pow(2,Ee.zoom-it.tileID.overscaledZ);Cc(Xe,Oe,me,oe,s.symbolSize,Ee,Rt,We.posMatrix,kt,et,xt)}}}}(g,l,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),C),h.paint.get("icon-opacity").constantOr(1)!==0&&Ha(l,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),P,R),h.paint.get("text-opacity").constantOr(1)!==0&&Ha(l,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),P,R),d.map.showCollisionBoxes&&(Ga(l,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Ga(l,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(l,d,h,g){if(l.renderPass==="translucent"){var C=h.paint.get("circle-opacity"),P=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),L=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(C.constantOr(1)!==0||P.constantOr(1)!==0&&R.constantOr(1)!==0){for(var U=l.context,X=U.gl,te=l.depthModeForSublayer(0,be.ReadOnly),Q=De.disabled,re=l.colorModeForRenderPass(),oe=[],Ee=0;Ee<g.length;Ee++){var Oe=g[Ee],me=d.getTile(Oe),Fe=me.getBucket(h);if(Fe){var He=Fe.programConfigurations.get(h.id),We={programConfiguration:He,program:l.useProgram("circle",He),layoutVertexBuffer:Fe.layoutVertexBuffer,indexBuffer:Fe.indexBuffer,uniformValues:eu(l,Oe,me,h)};if(L)for(var it=0,Xe=Fe.segments.get();it<Xe.length;it+=1){var et=Xe[it];oe.push({segments:new s.SegmentVector([et]),sortKey:et.sortKey,state:We})}else oe.push({segments:Fe.segments,sortKey:0,state:We})}}L&&oe.sort(function(rr,vr){return rr.sortKey-vr.sortKey});for(var ht=0,Rt=oe;ht<Rt.length;ht+=1){var xt=Rt[ht],kt=xt.state;kt.program.draw(U,X.TRIANGLES,te,Q,re,xe.disabled,kt.uniformValues,h.id,kt.layoutVertexBuffer,kt.indexBuffer,xt.segments,h.paint,l.transform.zoom,kt.programConfiguration)}}}},heatmap:function(l,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var C=l.context,P=C.gl,R=De.disabled,L=new Ae([P.ONE,P.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(oe,Ee,Oe){var me=oe.gl;oe.activeTexture.set(me.TEXTURE1),oe.viewport.set([0,0,Ee.width/4,Ee.height/4]);var Fe=Oe.heatmapFbo;if(Fe)me.bindTexture(me.TEXTURE_2D,Fe.colorAttachment.get()),oe.bindFramebuffer.set(Fe.framebuffer);else{var He=me.createTexture();me.bindTexture(me.TEXTURE_2D,He),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Fe=Oe.heatmapFbo=oe.createFramebuffer(Ee.width/4,Ee.height/4,!1),function(We,it,Xe,et){var ht=We.gl;ht.texImage2D(ht.TEXTURE_2D,0,ht.RGBA,it.width/4,it.height/4,0,ht.RGBA,We.extRenderToTextureHalfFloat?We.extTextureHalfFloat.HALF_FLOAT_OES:ht.UNSIGNED_BYTE,null),et.colorAttachment.set(Xe)}(oe,Ee,He,Fe)}})(C,l,h),C.clear({color:s.Color.transparent});for(var U=0;U<g.length;U++){var X=g[U];if(!d.hasRenderableParent(X)){var te=d.getTile(X),Q=te.getBucket(h);if(Q){var re=Q.programConfigurations.get(h.id);l.useProgram("heatmap",re).draw(C,P.TRIANGLES,be.disabled,R,L,xe.disabled,Al(X.posMatrix,te,l.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,l.transform.zoom,re)}}}C.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(oe,Ee){var Oe=oe.context,me=Oe.gl,Fe=Ee.heatmapFbo;if(Fe){Oe.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Fe.colorAttachment.get()),Oe.activeTexture.set(me.TEXTURE1);var He=Ee.colorRampTexture;He||(He=Ee.colorRampTexture=new s.Texture(Oe,Ee.colorRamp,me.RGBA)),He.bind(me.LINEAR,me.CLAMP_TO_EDGE),oe.useProgram("heatmapTexture").draw(Oe,me.TRIANGLES,be.disabled,De.disabled,oe.colorModeForRenderPass(),xe.disabled,function(We,it,Xe,et){var ht=s.create();s.ortho(ht,0,We.width,We.height,0,0,1);var Rt=We.context.gl;return{u_matrix:ht,u_world:[Rt.drawingBufferWidth,Rt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:it.paint.get("heatmap-opacity")}}(oe,Ee),Ee.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments,Ee.paint,oe.transform.zoom)}}(l,h))},line:function(l,d,h,g){if(l.renderPass==="translucent"){var C=h.paint.get("line-opacity"),P=h.paint.get("line-width");if(C.constantOr(1)!==0&&P.constantOr(1)!==0)for(var R=l.depthModeForSublayer(0,be.ReadOnly),L=l.colorModeForRenderPass(),U=h.paint.get("line-dasharray"),X=h.paint.get("line-pattern"),te=X.constantOr(1),Q=h.paint.get("line-gradient"),re=h.getCrossfadeParameters(),oe=te?"linePattern":U?"lineSDF":Q?"lineGradient":"line",Ee=l.context,Oe=Ee.gl,me=!0,Fe=0,He=g;Fe<He.length;Fe+=1){var We=He[Fe],it=d.getTile(We);if(!te||it.patternsLoaded()){var Xe=it.getBucket(h);if(Xe){var et=Xe.programConfigurations.get(h.id),ht=l.context.program.get(),Rt=l.useProgram(oe,et),xt=me||Rt.program!==ht,kt=X.constantOr(null);if(kt&&it.imageAtlas){var rr=it.imageAtlas,vr=rr.patternPositions[kt.to.toString()],Cr=rr.patternPositions[kt.from.toString()];vr&&Cr&&et.setConstantPatternPositions(vr,Cr)}var gn=te?tu(l,it,h,re):U?HA(l,it,h,U,re):Q?Pn(l,it,h,Xe.lineClipsArray.length):Sn(l,it,h);if(te)Ee.activeTexture.set(Oe.TEXTURE0),it.imageAtlasTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),et.updatePaintBuffers(re);else if(U&&(xt||l.lineAtlas.dirty))Ee.activeTexture.set(Oe.TEXTURE0),l.lineAtlas.bind(Ee);else if(Q){var ir=Xe.gradients[h.id],Ur=ir.texture;if(h.gradientVersion!==ir.version){var Yr=256;if(h.stepInterpolant){var Nr=d.getSource().maxzoom,Dr=We.canonical.z===Nr?Math.ceil(1<<l.transform.maxZoom-We.canonical.z):1;Yr=s.clamp(s.nextPowerOfTwo(Xe.maxLineLength/s.EXTENT*1024*Dr),256,Ee.maxTextureSize)}ir.gradient=s.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Yr,image:ir.gradient||void 0,clips:Xe.lineClipsArray}),ir.texture?ir.texture.update(ir.gradient):ir.texture=new s.Texture(Ee,ir.gradient,Oe.RGBA),ir.version=h.gradientVersion,Ur=ir.texture}Ee.activeTexture.set(Oe.TEXTURE0),Ur.bind(h.stepInterpolant?Oe.NEAREST:Oe.LINEAR,Oe.CLAMP_TO_EDGE)}Rt.draw(Ee,Oe.TRIANGLES,R,l.stencilModeForClipping(We),L,xe.disabled,gn,h.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,h.paint,l.transform.zoom,et,Xe.layoutVertexBuffer2),me=!1}}}}},fill:function(l,d,h,g){var C=h.paint.get("fill-color"),P=h.paint.get("fill-opacity");if(P.constantOr(1)!==0){var R=l.colorModeForRenderPass(),L=h.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&C.constantOr(s.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?be.ReadWrite:be.ReadOnly);nu(l,d,h,g,X,R,!1)}if(l.renderPass==="translucent"&&h.paint.get("fill-antialias")){var te=l.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,be.ReadOnly);nu(l,d,h,g,te,R,!0)}}},"fill-extrusion":function(l,d,h,g){var C=h.paint.get("fill-extrusion-opacity");if(C!==0&&l.renderPass==="translucent"){var P=new be(l.context.gl.LEQUAL,be.ReadWrite,l.depthRangeFor3D);if(C!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))pl(l,d,h,g,P,De.disabled,Ae.disabled),pl(l,d,h,g,P,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var R=l.colorModeForRenderPass();pl(l,d,h,g,P,De.disabled,R)}}},hillshade:function(l,d,h,g){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var C=l.context,P=l.depthModeForSublayer(0,be.ReadOnly),R=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(g):[{},g],U=L[0],X=0,te=L[1];X<te.length;X+=1){var Q=te[X],re=d.getTile(Q);re.needsHillshadePrepare&&l.renderPass==="offscreen"?$A(l,re,h,P,De.disabled,R):l.renderPass==="translucent"&&iu(l,re,h,P,U[Q.overscaledZ],R)}C.viewport.set([0,0,l.width,l.height])}},raster:function(l,d,h,g){if(l.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var C=l.context,P=C.gl,R=d.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),X=R instanceof lt?[{},g]:l.stencilConfigForOverlap(g),te=X[0],Q=X[1],re=Q[Q.length-1].overscaledZ,oe=!l.options.moving,Ee=0,Oe=Q;Ee<Oe.length;Ee+=1){var me=Oe[Ee],Fe=l.depthModeForSublayer(me.overscaledZ-re,h.paint.get("raster-opacity")===1?be.ReadWrite:be.ReadOnly,P.LESS),He=d.getTile(me),We=l.transform.calculatePosMatrix(me.toUnwrapped(),oe);He.registerFadeDuration(h.paint.get("raster-fade-duration"));var it=d.findLoadedParent(me,0),Xe=gl(He,it,d,h,l.transform),et=void 0,ht=void 0,Rt=h.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;C.activeTexture.set(P.TEXTURE0),He.texture.bind(Rt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(P.TEXTURE1),it?(it.texture.bind(Rt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),et=Math.pow(2,it.tileID.overscaledZ-He.tileID.overscaledZ),ht=[He.tileID.canonical.x*et%1,He.tileID.canonical.y*et%1]):He.texture.bind(Rt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var xt=jA(We,ht||[0,0],et||1,Xe,h);R instanceof lt?L.draw(C,P.TRIANGLES,Fe,De.disabled,U,xe.disabled,xt,h.id,R.boundsBuffer,l.quadTriangleIndexBuffer,R.boundsSegments):L.draw(C,P.TRIANGLES,Fe,te[me.overscaledZ],U,xe.disabled,xt,h.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,d,h){var g=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(C!==0){var P=l.context,R=P.gl,L=l.transform,U=L.tileSize,X=h.paint.get("background-pattern");if(!l.isPatternMissing(X)){var te=!X&&g.a===1&&C===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===te){var Q=De.disabled,re=l.depthModeForSublayer(0,te==="opaque"?be.ReadWrite:be.ReadOnly),oe=l.colorModeForRenderPass(),Ee=l.useProgram(X?"backgroundPattern":"background"),Oe=L.coveringTiles({tileSize:U});X&&(P.activeTexture.set(R.TEXTURE0),l.imageManager.bind(l.context));for(var me=h.getCrossfadeParameters(),Fe=0,He=Oe;Fe<He.length;Fe+=1){var We=He[Fe],it=l.transform.calculatePosMatrix(We.toUnwrapped()),Xe=X?wc(it,C,l,X,{tileID:We,tileSize:U},me):za(it,C,g);Ee.draw(P,R.TRIANGLES,re,Q,oe,xe.disabled,Xe,h.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,d,h){for(var g=0;g<h.length;g++)Ih(l,d,h[g])},custom:function(l,d,h){var g=l.context,C=h.implementation;if(l.renderPass==="offscreen"){var P=C.prerender;P&&(l.setCustomLayerDefaults(),g.setColorMode(l.colorModeForRenderPass()),P.call(C,g.gl,l.transform.customLayerMatrix()),g.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),g.setColorMode(l.colorModeForRenderPass()),g.setStencilMode(De.disabled);var R=C.renderingMode==="3d"?new be(l.context.gl.LEQUAL,be.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,be.ReadOnly);g.setDepthMode(R),C.render(g.gl,l.transform.customLayerMatrix()),g.setDirty(),l.setBaseState(),g.bindFramebuffer.set(null)}}},Gn=function(l,d){this.context=new ce(l),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=Se.maxUnderzooming+Se.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fa,this.gpuTimers={}};Gn.prototype.resize=function(l,d){if(this.width=l*s.browser.devicePixelRatio,this.height=d*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},Gn.prototype.setup=function(){var l=this.context,d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,ii.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=l.createVertexBuffer(h,ii.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var g=new s.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(s.EXTENT,0,s.EXTENT,0),g.emplaceBack(0,s.EXTENT,0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(g,tt.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var C=new s.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(C,ii.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var P=new s.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);var R=new s.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(R),this.emptyTexture=new s.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new De({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Gn.prototype.clearStencil=function(){var l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=s.create();s.ortho(h,0,this.width,this.height,0,0,1),s.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,be.disabled,this.stencilClearMode,Ae.disabled,xe.disabled,jo(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Gn.prototype._renderTileClippingMasks=function(l,d){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&d&&d.length){this.currentStencilSource=l.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(Ae.disabled),h.setDepthMode(be.disabled);var C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,R=d;P<R.length;P+=1){var L=R[P],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;C.draw(h,g.TRIANGLES,be.disabled,new De({func:g.ALWAYS,mask:0},U,255,g.KEEP,g.KEEP,g.REPLACE),Ae.disabled,xe.disabled,jo(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Gn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,d=this.context.gl;return new De({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)},Gn.prototype.stencilModeForClipping=function(l){var d=this.context.gl;return new De({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)},Gn.prototype.stencilConfigForOverlap=function(l){var d,h=this.context.gl,g=l.sort(function(U,X){return X.overscaledZ-U.overscaledZ}),C=g[g.length-1].overscaledZ,P=g[0].overscaledZ-C+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var R={},L=0;L<P;L++)R[L+C]=new De({func:h.GEQUAL,mask:255},L+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=P,[R,g]}return[(d={},d[C]=De.disabled,d),g]},Gn.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ae([l.CONSTANT_COLOR,l.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ae.unblended:Ae.alphaBlended},Gn.prototype.depthModeForSublayer=function(l,d,h){if(!this.opaquePassEnabledForLayer())return be.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new be(h||this.context.gl.LEQUAL,d,[g,g])},Gn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Gn.prototype.render=function(l,d){var h=this;this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var g=this.style._order,C=this.style.sourceCaches;for(var P in C){var R=C[P];R.used&&R.prepare(this.context)}var L,U,X={},te={},Q={};for(var re in C){var oe=C[re];X[re]=oe.getVisibleCoordinates(),te[re]=X[re].slice().reverse(),Q[re]=oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ee=0;Ee<g.length;Ee++)if(this.style._layers[g[Ee]].is3D()){this.opaquePassCutoff=Ee;break}this.renderPass="offscreen";for(var Oe=0,me=g;Oe<me.length;Oe+=1){var Fe=this.style._layers[me[Oe]];if(Fe.hasOffscreenPass()&&!Fe.isHidden(this.transform.zoom)){var He=te[Fe.source];(Fe.type==="custom"||He.length)&&this.renderLayer(this,C[Fe.source],Fe,He)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var We=this.style._layers[g[this.currentLayer]],it=C[We.source],Xe=X[We.source];this._renderTileClippingMasks(We,Xe),this.renderLayer(this,it,We,Xe)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var et=this.style._layers[g[this.currentLayer]],ht=C[et.source],Rt=(et.type==="symbol"?Q:te)[et.source];this._renderTileClippingMasks(et,X[et.source]),this.renderLayer(this,ht,et,Rt)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(xt){xt.source&&!xt.isHidden(h.transform.zoom)&&(xt.source!==(U&&U.id)&&(U=h.style.sourceCaches[xt.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&Wa.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(xt){var kt=xt.transform.padding;uf(xt,xt.transform.height-(kt.top||0),3,su),uf(xt,kt.bottom||0,3,Bc),ff(xt,kt.left||0,3,ja),ff(xt,xt.transform.width-(kt.right||0),3,ou);var rr=xt.transform.centerPoint;(function(vr,Cr,gn,ir){ml(vr,Cr-1,gn-10,2,20,ir),ml(vr,Cr-10,gn-1,20,2,ir)})(xt,rr.x,xt.transform.height-rr.y,$a)}(this),this.context.setDefault()},Gn.prototype.renderLayer=function(l,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),Wa[h.type](l,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Gn.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[l.id];h||(h=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Gn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Gn.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Gn.prototype.queryGpuTimers=function(l){var d={};for(var h in l){var g=l[h],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(g.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(g.query),d[h]=P}return d},Gn.prototype.translatePosMatrix=function(l,d,h,g,C){if(!h[0]&&!h[1])return l;var P=C?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(P){var R=Math.sin(P),L=Math.cos(P);h=[h[0]*L-h[1]*R,h[0]*R+h[1]*L]}var U=[C?h[0]:Bn(d,h[0],this.transform.zoom),C?h[1]:Bn(d,h[1],this.transform.zoom),0],X=new Float32Array(16);return s.translate(X,l,U),X},Gn.prototype.saveTileTexture=function(l){var d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]},Gn.prototype.getTileTexture=function(l){var d=this._tileTextures[l];return d&&d.length>0?d.pop():null},Gn.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var d=this.imageManager.getPattern(l.from.toString()),h=this.imageManager.getPattern(l.to.toString());return!d||!h},Gn.prototype.useProgram=function(l,d){this.cache=this.cache||{};var h=""+l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new Ch(this.context,l,ql[l],d,Fs[l],this._showOverdrawInspector)),this.cache[h]},Gn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Gn.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Gn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Gn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var au=function(l,d){this.points=l,this.planes=d};au.fromInvProjectionMatrix=function(l,d,h){var g=Math.pow(2,h),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return s.transformMat4([],R,l)}).map(function(R){return s.scale$1([],R,1/R[3]/d*g)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var L=s.sub([],C[R[0]],C[R[1]]),U=s.sub([],C[R[2]],C[R[1]]),X=s.normalize([],s.cross([],L,U)),te=-s.dot(X,C[R[1]]);return X.concat(te)});return new au(C,P)};var $o=function(l,d){this.min=l,this.max=d,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};$o.prototype.quadrant=function(l){for(var d=[l%2==0,l<2],h=s.clone$2(this.min),g=s.clone$2(this.max),C=0;C<d.length;C++)h[C]=d[C]?this.min[C]:this.center[C],g[C]=d[C]?this.center[C]:this.max[C];return g[2]=this.max[2],new $o(h,g)},$o.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},$o.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},$o.prototype.intersects=function(l){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<l.planes.length;g++){for(var C=l.planes[g],P=0,R=0;R<d.length;R++)P+=s.dot$1(C,d[R])>=0;if(P===0)return 0;P!==d.length&&(h=!1)}if(h)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,X=-Number.MAX_VALUE,te=0;te<l.points.length;te++){var Q=l.points[te][L]-this.min[L];U=Math.min(U,Q),X=Math.max(X,Q)}if(X<0||U>this.max[L]-this.min[L])return 0}return 1};var Wo=function(l,d,h,g){if(l===void 0&&(l=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(l)||l<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=h,this.right=g};Wo.prototype.interpolate=function(l,d,h){return d.top!=null&&l.top!=null&&(this.top=s.number(l.top,d.top,h)),d.bottom!=null&&l.bottom!=null&&(this.bottom=s.number(l.bottom,d.bottom,h)),d.left!=null&&l.left!=null&&(this.left=s.number(l.left,d.left,h)),d.right!=null&&l.right!=null&&(this.right=s.number(l.right,d.right,h)),this},Wo.prototype.getCenter=function(l,d){var h=s.clamp((this.left+l-this.right)/2,0,l),g=s.clamp((this.top+d-this.bottom)/2,0,d);return new s.Point(h,g)},Wo.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Wo.prototype.clone=function(){return new Wo(this.top,this.bottom,this.left,this.right)},Wo.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var nn=function(l,d,h,g,C){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=C===void 0||C,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=h??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Wo,this._posMatrixCache={},this._alignedPosMatrixCache={}},Rn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};nn.prototype.clone=function(){var l=new nn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Rn.minZoom.get=function(){return this._minZoom},Rn.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Rn.maxZoom.get=function(){return this._maxZoom},Rn.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Rn.minPitch.get=function(){return this._minPitch},Rn.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Rn.maxPitch.get=function(){return this._maxPitch},Rn.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Rn.renderWorldCopies.get=function(){return this._renderWorldCopies},Rn.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Rn.worldSize.get=function(){return this.tileSize*this.scale},Rn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Rn.size.get=function(){return new s.Point(this.width,this.height)},Rn.bearing.get=function(){return-this.angle/Math.PI*180},Rn.bearing.set=function(l){var d=-s.wrap(l,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Rn.pitch.get=function(){return this._pitch/Math.PI*180},Rn.pitch.set=function(l){var d=s.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Rn.fov.get=function(){return this._fov/Math.PI*180},Rn.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Rn.zoom.get=function(){return this._zoom},Rn.zoom.set=function(l){var d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Rn.center.get=function(){return this._center},Rn.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Rn.padding.get=function(){return this._edgeInsets.toJSON()},Rn.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Rn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},nn.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},nn.prototype.interpolatePadding=function(l,d,h){this._unmodified=!1,this._edgeInsets.interpolate(l,d,h),this._constrain(),this._calcMatrices()},nn.prototype.coveringZoomLevel=function(l){var d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)},nn.prototype.getVisibleUnwrappedCoordinates=function(l){var d=[new s.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new s.Point(0,0)),g=this.pointCoordinate(new s.Point(this.width,0)),C=this.pointCoordinate(new s.Point(this.width,this.height)),P=this.pointCoordinate(new s.Point(0,this.height)),R=Math.floor(Math.min(h.x,g.x,C.x,P.x)),L=Math.floor(Math.max(h.x,g.x,C.x,P.x)),U=R-1;U<=L+1;U++)U!==0&&d.push(new s.UnwrappedTileID(U,l));return d},nn.prototype.coveringTiles=function(l){var d=this.coveringZoomLevel(l),h=d;if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);var g=s.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,d),P=[C*g.x,C*g.y,0],R=au.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=d);var U=function(xt){return{aabb:new $o([xt*C,0,0],[(xt+1)*C,C,0]),zoom:0,x:0,y:0,wrap:xt,fullyVisible:!1}},X=[],te=[],Q=d,re=l.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var oe=1;oe<=3;oe++)X.push(U(-oe)),X.push(U(oe));for(X.push(U(0));X.length>0;){var Ee=X.pop(),Oe=Ee.x,me=Ee.y,Fe=Ee.fullyVisible;if(!Fe){var He=Ee.aabb.intersects(R);if(He===0)continue;Fe=He===2}var We=Ee.aabb.distanceX(P),it=Ee.aabb.distanceY(P),Xe=Math.max(Math.abs(We),Math.abs(it));if(Ee.zoom===Q||Xe>3+(1<<Q-Ee.zoom)-2&&Ee.zoom>=L)te.push({tileID:new s.OverscaledTileID(Ee.zoom===Q?re:Ee.zoom,Ee.wrap,Ee.zoom,Oe,me),distanceSq:s.sqrLen([P[0]-.5-Oe,P[1]-.5-me])});else for(var et=0;et<4;et++){var ht=(Oe<<1)+et%2,Rt=(me<<1)+(et>>1);X.push({aabb:Ee.aabb.quadrant(et),zoom:Ee.zoom+1,x:ht,y:Rt,wrap:Ee.wrap,fullyVisible:Fe})}}return te.sort(function(xt,kt){return xt.distanceSq-kt.distanceSq}).map(function(xt){return xt.tileID})},nn.prototype.resize=function(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()},Rn.unmodified.get=function(){return this._unmodified},nn.prototype.zoomScale=function(l){return Math.pow(2,l)},nn.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},nn.prototype.project=function(l){var d=s.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(l.lng)*this.worldSize,s.mercatorYfromLat(d)*this.worldSize)},nn.prototype.unproject=function(l){return new s.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Rn.point.get=function(){return this.project(this.center)},nn.prototype.setLocationAtPoint=function(l,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(l),P=new s.MercatorCoordinate(C.x-(h.x-g.x),C.y-(h.y-g.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},nn.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},nn.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},nn.prototype.locationCoordinate=function(l){return s.MercatorCoordinate.fromLngLat(l)},nn.prototype.coordinateLocation=function(l){return l.toLngLat()},nn.prototype.pointCoordinate=function(l){var d=[l.x,l.y,0,1],h=[l.x,l.y,1,1];s.transformMat4(d,d,this.pixelMatrixInverse),s.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],C=h[3],P=d[1]/g,R=h[1]/C,L=d[2]/g,U=h[2]/C,X=L===U?0:(0-L)/(U-L);return new s.MercatorCoordinate(s.number(d[0]/g,h[0]/C,X)/this.worldSize,s.number(P,R,X)/this.worldSize)},nn.prototype.coordinatePoint=function(l){var d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.transformMat4(d,d,this.pixelMatrix),new s.Point(d[0]/d[3],d[1]/d[3])},nn.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},nn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},nn.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},nn.prototype.calculatePosMatrix=function(l,d){d===void 0&&(d=!1);var h=l.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var C=l.canonical,P=this.worldSize/this.zoomScale(C.z),R=C.x+Math.pow(2,C.z)*l.wrap,L=s.identity(new Float64Array(16));return s.translate(L,L,[R*P,C.y*P,0]),s.scale(L,L,[P/s.EXTENT,P/s.EXTENT,1]),s.multiply(L,d?this.alignedProjMatrix:this.projMatrix,L),g[h]=new Float32Array(L),g[h]},nn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},nn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,d,h,g,C=-90,P=90,R=-180,L=180,U=this.size,X=this._unmodified;if(this.latRange){var te=this.latRange;C=s.mercatorYfromLat(te[1])*this.worldSize,l=(P=s.mercatorYfromLat(te[0])*this.worldSize)-C<U.y?U.y/(P-C):0}if(this.lngRange){var Q=this.lngRange;R=s.mercatorXfromLng(Q[0])*this.worldSize,d=(L=s.mercatorXfromLng(Q[1])*this.worldSize)-R<U.x?U.x/(L-R):0}var re=this.point,oe=Math.max(d||0,l||0);if(oe)return this.center=this.unproject(new s.Point(d?(L+R)/2:re.x,l?(P+C)/2:re.y)),this.zoom+=this.scaleZoom(oe),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Ee=re.y,Oe=U.y/2;Ee-Oe<C&&(g=C+Oe),Ee+Oe>P&&(g=P-Oe)}if(this.lngRange){var me=re.x,Fe=U.x/2;me-Fe<R&&(h=R+Fe),me+Fe>L&&(h=L-Fe)}h===void 0&&g===void 0||(this.center=this.unproject(new s.Point(h!==void 0?h:re.x,g!==void 0?g:re.y))),this._unmodified=X,this._constraining=!1}},nn.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+l.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-d-h,.01,Math.PI-.01)),C=this.point,P=C.x,R=C.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),U=this.height/50,X=new Float64Array(16);s.perspective(X,this._fov,this.width/this.height,U,L),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,s.scale(X,X,[1,-1,1]),s.translate(X,X,[0,0,-this.cameraToCenterDistance]),s.rotateX(X,X,this._pitch),s.rotateZ(X,X,this.angle),s.translate(X,X,[-P,-R,0]),this.mercatorMatrix=s.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),s.scale(X,X,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=s.invert([],this.projMatrix);var te=this.width%2/2,Q=this.height%2/2,re=Math.cos(this.angle),oe=Math.sin(this.angle),Ee=P-Math.round(P)+re*te+oe*Q,Oe=R-Math.round(R)+re*Q+oe*te,me=new Float64Array(X);if(s.translate(me,me,[Ee>.5?Ee-1:Ee,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=me,X=s.create(),s.scale(X,X,[this.width/2,-this.height/2,1]),s.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=s.create(),s.scale(X,X,[1,-1,1]),s.translate(X,X,[-1,-1,0]),s.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},nn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new s.Point(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},nn.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,l))},nn.prototype.getCameraQueryGeometry=function(l){var d=this.getCameraPoint();if(l.length===1)return[l[0],d];for(var h=d.x,g=d.y,C=d.x,P=d.y,R=0,L=l;R<L.length;R+=1){var U=L[R];h=Math.min(h,U.x),g=Math.min(g,U.y),C=Math.max(C,U.x),P=Math.max(P,U.y)}return[new s.Point(h,g),new s.Point(C,g),new s.Point(C,P),new s.Point(h,P),new s.Point(h,g)]},Object.defineProperties(nn.prototype,Rn);var Ds=function(l){var d,h,g,C;this._hashName=l&&encodeURIComponent(l),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,C=function(){g=null,h&&(d(),g=setTimeout(C,300),h=!1)},function(){return h=!0,g||C(),g})};Ds.prototype.addTo=function(l){return this._map=l,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ds.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ds.prototype.getHashString=function(l){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,g),P=Math.round(d.lng*C)/C,R=Math.round(d.lat*C)/C,L=this._map.getBearing(),U=this._map.getPitch(),X="";if(X+=l?"/"+P+"/"+R+"/"+h:h+"/"+R+"/"+P,(L||U)&&(X+="/"+Math.round(10*L)/10),U&&(X+="/"+Math.round(U)),this._hashName){var te=this._hashName,Q=!1,re=s.window.location.hash.slice(1).split("&").map(function(oe){var Ee=oe.split("=")[0];return Ee===te?(Q=!0,Ee+"="+X):oe}).filter(function(oe){return oe});return Q||re.push(te+"="+X),"#"+re.join("&")}return"#"+X},Ds.prototype._getCurrentHash=function(){var l,d=this,h=s.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(l=g)}),(l&&l[1]||"").split("/")):h.split("/")},Ds.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1},Ds.prototype._updateHashUnthrottled=function(){var l=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,l)}catch{}};var _l={linearity:.3,easing:s.bezier(0,0,.3,1)},Sc=s.extend({deceleration:2500,maxSpeed:1400},_l),yl=s.extend({deceleration:20,maxSpeed:1400},_l),WA=s.extend({deceleration:1e3,maxSpeed:360},_l),JA=s.extend({deceleration:1e3,maxSpeed:90},_l),Ic=function(l){this._map=l,this.clear()};function vl(l,d){(!l.duration||l.duration<d.duration)&&(l.duration=d.duration,l.easing=d.easing)}function Co(l,d,h){var g=h.maxSpeed,C=h.linearity,P=h.deceleration,R=s.clamp(l*C/(d/1e3),-g,g),L=Math.abs(R)/(P*C);return{easing:h.easing,duration:1e3*L,amount:R*(L/2)}}Ic.prototype.clear=function(){this._inertiaBuffer=[]},Ic.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:l})},Ic.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,d=s.browser.now();l.length>0&&d-l[0].time>160;)l.shift()},Ic.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var C=g[h].settings;d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(d.pan.mag()){var L=Co(d.pan.mag(),P,s.extend({},Sc,l||{}));R.offset=d.pan.mult(L.amount/d.pan.mag()),R.center=this._map.transform.center,vl(R,L)}if(d.zoom){var U=Co(d.zoom,P,yl);R.zoom=this._map.transform.zoom+U.amount,vl(R,U)}if(d.bearing){var X=Co(d.bearing,P,WA);R.bearing=this._map.transform.bearing+s.clamp(X.amount,-179,179),vl(R,X)}if(d.pitch){var te=Co(d.pitch,P,JA);R.pitch=this._map.transform.pitch+te.amount,vl(R,te)}if(R.zoom||R.bearing){var Q=d.pinchAround===void 0?d.around:d.pinchAround;R.around=Q?this._map.unproject(Q):this._map.getCenter()}return this.clear(),s.extend(R,{noMoveStart:!0})}};var Fn=function(l){function d(g,C,P,R){R===void 0&&(R={});var L=f.mousePos(C.getCanvasContainer(),P),U=C.unproject(L);l.call(this,g,s.extend({point:L,lngLat:U,originalEvent:P},R)),this._defaultPrevented=!1,this.target=C}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(s.Event),Mc=function(l){function d(g,C,P){var R=g==="touchend"?P.changedTouches:P.touches,L=f.touchPos(C.getCanvasContainer(),R),U=L.map(function(Q){return C.unproject(Q)}),X=L.reduce(function(Q,re,oe,Ee){return Q.add(re.div(Ee.length))},new s.Point(0,0)),te=C.unproject(X);l.call(this,g,{points:L,point:X,lngLats:U,lngLat:te,originalEvent:P}),this._defaultPrevented=!1}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(s.Event),Mh=function(l){function d(g,C,P){l.call(this,g,{originalEvent:P}),this._defaultPrevented=!1}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(s.Event),mi=function(l,d){this._map=l,this._clickTolerance=d.clickTolerance};mi.prototype.reset=function(){delete this._mousedownPos},mi.prototype.wheel=function(l){return this._firePreventable(new Mh(l.type,this._map,l))},mi.prototype.mousedown=function(l,d){return this._mousedownPos=d,this._firePreventable(new Fn(l.type,this._map,l))},mi.prototype.mouseup=function(l){this._map.fire(new Fn(l.type,this._map,l))},mi.prototype.click=function(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Fn(l.type,this._map,l))},mi.prototype.dblclick=function(l){return this._firePreventable(new Fn(l.type,this._map,l))},mi.prototype.mouseover=function(l){this._map.fire(new Fn(l.type,this._map,l))},mi.prototype.mouseout=function(l){this._map.fire(new Fn(l.type,this._map,l))},mi.prototype.touchstart=function(l){return this._firePreventable(new Mc(l.type,this._map,l))},mi.prototype.touchmove=function(l){this._map.fire(new Mc(l.type,this._map,l))},mi.prototype.touchend=function(l){this._map.fire(new Mc(l.type,this._map,l))},mi.prototype.touchcancel=function(l){this._map.fire(new Mc(l.type,this._map,l))},mi.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},mi.prototype.isEnabled=function(){return!0},mi.prototype.isActive=function(){return!1},mi.prototype.enable=function(){},mi.prototype.disable=function(){};var nr=function(l){this._map=l};nr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},nr.prototype.mousemove=function(l){this._map.fire(new Fn(l.type,this._map,l))},nr.prototype.mousedown=function(){this._delayContextMenu=!0},nr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},nr.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Fn(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},nr.prototype.isEnabled=function(){return!0},nr.prototype.isActive=function(){return!1},nr.prototype.enable=function(){},nr.prototype.disable=function(){};var vs=function(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1};function cu(l,d){for(var h={},g=0;g<l.length;g++)h[l[g].identifier]=d[g];return h}vs.prototype.isEnabled=function(){return!!this._enabled},vs.prototype.isActive=function(){return!!this._active},vs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},vs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},vs.prototype.mousedown=function(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(f.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},vs.prototype.mousemoveWindow=function(l,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=f.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var C=Math.min(g.x,h.x),P=Math.max(g.x,h.x),R=Math.min(g.y,h.y),L=Math.max(g.y,h.y);f.setTransform(this._box,"translate("+C+"px,"+R+"px)"),this._box.style.width=P-C+"px",this._box.style.height=L-R+"px"}}},vs.prototype.mouseupWindow=function(l,d){var h=this;if(this._active&&l.button===0){var g=this._startPos,C=d;if(this.reset(),f.suppressClick(),g.x!==C.x||g.y!==C.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(P){return P.fitScreenCoordinates(g,C,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},vs.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},vs.prototype.blur=function(){this.reset()},vs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(f.remove(this._box),this._box=null),f.enableDrag(),delete this._startPos,delete this._lastPos},vs.prototype._fireEvent=function(l,d){return this._map.fire(new s.Event(l,{originalEvent:d}))};var Ls=function(l){this.reset(),this.numTouches=l.numTouches};Ls.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ls.prototype.touchstart=function(l,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var C=new s.Point(0,0),P=0,R=g;P<R.length;P+=1)C._add(R[P]);return C.div(g.length)}(d),this.touches=cu(h,d)))},Ls.prototype.touchmove=function(l,d,h){if(!this.aborted&&this.centroid){var g=cu(h,d);for(var C in this.touches){var P=g[C];(!P||P.dist(this.touches[C])>30)&&(this.aborted=!0)}}},Ls.prototype.touchend=function(l,d,h){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var Ys=function(l){this.singleTap=new Ls(l),this.numTaps=l.numTaps,this.reset()};Ys.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ys.prototype.touchstart=function(l,d,h){this.singleTap.touchstart(l,d,h)},Ys.prototype.touchmove=function(l,d,h){this.singleTap.touchmove(l,d,h)},Ys.prototype.touchend=function(l,d,h){var g=this.singleTap.touchend(l,d,h);if(g){var C=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(g)<30;if(C&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var fs=function(){this._zoomIn=new Ys({numTouches:1,numTaps:2}),this._zoomOut=new Ys({numTouches:2,numTaps:1}),this.reset()};fs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},fs.prototype.touchstart=function(l,d,h){this._zoomIn.touchstart(l,d,h),this._zoomOut.touchstart(l,d,h)},fs.prototype.touchmove=function(l,d,h){this._zoomIn.touchmove(l,d,h),this._zoomOut.touchmove(l,d,h)},fs.prototype.touchend=function(l,d,h){var g=this,C=this._zoomIn.touchend(l,d,h),P=this._zoomOut.touchend(l,d,h);return C?(this._active=!0,l.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(C)},{originalEvent:l})}}):P?(this._active=!0,l.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(P)},{originalEvent:l})}}):void 0},fs.prototype.touchcancel=function(){this.reset()},fs.prototype.enable=function(){this._enabled=!0},fs.prototype.disable=function(){this._enabled=!1,this.reset()},fs.prototype.isEnabled=function(){return this._enabled},fs.prototype.isActive=function(){return this._active};var hf={0:1,2:2},Kt=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kt.prototype.blur=function(){this.reset()},Kt.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kt.prototype._correctButton=function(l,d){return!1},Kt.prototype._move=function(l,d){return{}},Kt.prototype.mousedown=function(l,d){if(!this._lastPoint){var h=f.mouseButton(l);this._correctButton(l,h)&&(this._lastPoint=d,this._eventButton=h)}},Kt.prototype.mousemoveWindow=function(l,d){var h=this._lastPoint;if(h){if(l.preventDefault(),function(g,C){var P=hf[C];return g.buttons===void 0||(g.buttons&P)!==P}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},Kt.prototype.mouseupWindow=function(l){this._lastPoint&&f.mouseButton(l)===this._eventButton&&(this._moved&&f.suppressClick(),this.reset())},Kt.prototype.enable=function(){this._enabled=!0},Kt.prototype.disable=function(){this._enabled=!1,this.reset()},Kt.prototype.isEnabled=function(){return this._enabled},Kt.prototype.isActive=function(){return this._active};var df=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.mousedown=function(h,g){l.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(Kt),lu=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var C=.8*(g.x-h.x);if(C)return this._active=!0,{bearingDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Kt),Af=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var C=-.5*(g.y-h.y);if(C)return this._active=!0,{pitchDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Kt),qs=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};qs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},qs.prototype.touchstart=function(l,d,h){return this._calculateTransform(l,d,h)},qs.prototype.touchmove=function(l,d,h){if(this._active&&!(h.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,d,h)},qs.prototype.touchend=function(l,d,h){this._calculateTransform(l,d,h),this._active&&h.length<this._minTouches&&this.reset()},qs.prototype.touchcancel=function(){this.reset()},qs.prototype._calculateTransform=function(l,d,h){h.length>0&&(this._active=!0);var g=cu(h,d),C=new s.Point(0,0),P=new s.Point(0,0),R=0;for(var L in g){var U=g[L],X=this._touches[L];X&&(C._add(U),P._add(U.sub(X)),R++,g[L]=U)}if(this._touches=g,!(R<this._minTouches)&&P.mag()){var te=P.div(R);if(this._sum._add(te),!(this._sum.mag()<this._clickTolerance))return{around:C.div(R),panDelta:te}}},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active};var bs=function(){this.reset()};function uu(l,d,h){for(var g=0;g<l.length;g++)if(l[g].identifier===h)return d[g]}function fu(l,d){return Math.log(l/d)/Math.LN2}bs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},bs.prototype._start=function(l){},bs.prototype._move=function(l,d,h){return{}},bs.prototype.touchstart=function(l,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},bs.prototype.touchmove=function(l,d,h){if(this._firstTwoTouches){l.preventDefault();var g=this._firstTwoTouches,C=g[1],P=uu(h,d,g[0]),R=uu(h,d,C);if(P&&R){var L=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],L,l)}}},bs.prototype.touchend=function(l,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,C=g[1],P=uu(h,d,g[0]),R=uu(h,d,C);P&&R||(this._active&&f.suppressClick(),this.reset())}},bs.prototype.touchcancel=function(){this.reset()},bs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},bs.prototype.disable=function(){this._enabled=!1,this.reset()},bs.prototype.isEnabled=function(){return this._enabled},bs.prototype.isActive=function(){return this._active};var xs=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var C=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(fu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fu(this._distance,C),pinchAround:g}},d}(bs);function Jo(l,d){return 180*l.angleWith(d)/Math.PI}var pf=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var C=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Jo(this._vector,C),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,C=Jo(h,this._startVector);return Math.abs(C)<g},d}(bs);function Pc(l){return Math.abs(l.y)>Math.abs(l.x)}var _i=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Pc(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,C){var P=h[0].sub(this._lastPoints[0]),R=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,R,C.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(P.y+R.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,C){if(this._valid!==void 0)return this._valid;var P=h.mag()>=2,R=g.mag()>=2;if(P||R){if(!P||!R)return this._firstMove===void 0&&(this._firstMove=C),C-this._firstMove<100&&void 0;var L=h.y>0==g.y>0;return Pc(h)&&Pc(g)&&L}},d}(bs),gf={panStep:100,bearingStep:15,pitchStep:10},go=function(){var l=gf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function qi(l){return l*(2-l)}go.prototype.blur=function(){this.reset()},go.prototype.reset=function(){this._active=!1},go.prototype.keydown=function(l){var d=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var h=0,g=0,C=0,P=0,R=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?g=-1:(l.preventDefault(),P=-1);break;case 39:l.shiftKey?g=1:(l.preventDefault(),P=1);break;case 38:l.shiftKey?C=1:(l.preventDefault(),R=-1);break;case 40:l.shiftKey?C=-1:(l.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,C=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:qi,zoom:h?Math.round(U)+h*(l.shiftKey?2:1):U,bearing:L.getBearing()+g*d._bearingStep,pitch:L.getPitch()+C*d._pitchStep,offset:[-P*d._panStep,-R*d._panStep],center:L.getCenter()},{originalEvent:l})}}}},go.prototype.enable=function(){this._enabled=!0},go.prototype.disable=function(){this._enabled=!1,this.reset()},go.prototype.isEnabled=function(){return this._enabled},go.prototype.isActive=function(){return this._active},go.prototype.disableRotation=function(){this._rotationDisabled=!0},go.prototype.enableRotation=function(){this._rotationDisabled=!1};var kr=function(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};kr.prototype.setZoomRate=function(l){this._defaultZoomRate=l},kr.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},kr.prototype.isEnabled=function(){return!!this._enabled},kr.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},kr.prototype.isZooming=function(){return!!this._zooming},kr.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},kr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},kr.prototype.wheel=function(l){if(this.isEnabled()){var d=l.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,h=s.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}},kr.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},kr.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=f.mousePos(this._el,l);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},kr.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var C=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(C*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,R=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,L=this._startZoom,U=this._easing,X=!1;if(this._type==="wheel"&&L&&U){var te=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),Q=U(te);P=s.number(L,R,Q),te<1?this._frameId||(this._frameId=!0):X=!0}else P=R,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:P-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},kr.prototype._smoothOutEasing=function(l){var d=s.ease;if(this._prevEase){var h=this._prevEase,g=(s.browser.now()-h.start)/h.duration,C=h.easing(g+.01)-h.easing(g),P=.27/Math.sqrt(C*C+1e-4)*.01,R=Math.sqrt(.0729-P*P);d=s.bezier(P,R,.25,1)}return this._prevEase={start:s.browser.now(),duration:l,easing:d},d},kr.prototype.blur=function(){this.reset()},kr.prototype.reset=function(){this._active=!1};var Eo=function(l,d){this._clickZoom=l,this._tapZoom=d};Eo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Eo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Eo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Eo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Zs=function(){this.reset()};Zs.prototype.reset=function(){this._active=!1},Zs.prototype.blur=function(){this.reset()},Zs.prototype.dblclick=function(l,d){return l.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(l.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:l})}}},Zs.prototype.enable=function(){this._enabled=!0},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var Vi=function(){this._tap=new Ys({numTouches:1,numTaps:1}),this.reset()};Vi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Vi.prototype.touchstart=function(l,d,h){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(l,d,h))},Vi.prototype.touchmove=function(l,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],C=g.y-this._swipePoint.y;return this._swipePoint=g,l.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(l,d,h)},Vi.prototype.touchend=function(l,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(l,d,h)&&(this._tapTime=l.timeStamp)},Vi.prototype.touchcancel=function(){this.reset()},Vi.prototype.enable=function(){this._enabled=!0},Vi.prototype.disable=function(){this._enabled=!1,this.reset()},Vi.prototype.isEnabled=function(){return this._enabled},Vi.prototype.isActive=function(){return this._active};var ya=function(l,d,h){this._el=l,this._mousePan=d,this._touchPan=h};ya.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},ya.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},ya.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},ya.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Xo=function(l,d,h){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};Xo.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Xo.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Xo.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Xo.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Qs=function(l,d,h,g){this._el=l,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Qs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Qs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Qs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Qs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Qs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Qs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Zi=function(l){return l.zoom||l.drag||l.pitch||l.rotate},bl=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d}(s.Event);function _r(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var or=function(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ic(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),s.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[s.window,"blur",void 0]];for(var g=0,C=this._listeners;g<C.length;g+=1){var P=C[g],R=P[0];f.addEventListener(R,P[1],R===s.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};or.prototype.destroy=function(){for(var l=0,d=this._listeners;l<d.length;l+=1){var h=d[l],g=h[0];f.removeEventListener(g,h[1],g===s.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},or.prototype._addDefaultHandlers=function(l){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new mi(d,l));var g=d.boxZoom=new vs(d,l);this._add("boxZoom",g);var C=new fs,P=new Zs;d.doubleClickZoom=new Eo(P,C),this._add("tapZoom",C),this._add("clickZoom",P);var R=new Vi;this._add("tapDragZoom",R);var L=d.touchPitch=new _i;this._add("touchPitch",L);var U=new lu(l),X=new Af(l);d.dragRotate=new Xo(l,U,X),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var te=new df(l),Q=new qs(l);d.dragPan=new ya(h,te,Q),this._add("mousePan",te),this._add("touchPan",Q,["touchZoom","touchRotate"]);var re=new pf,oe=new xs;d.touchZoomRotate=new Qs(h,oe,re,R),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]);var Ee=d.scrollZoom=new kr(d,this);this._add("scrollZoom",Ee,["mousePan"]);var Oe=d.keyboard=new go;this._add("keyboard",Oe),this._add("blockableMapEvent",new nr(d));for(var me=0,Fe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];me<Fe.length;me+=1){var He=Fe[me];l.interactive&&l[He]&&d[He].enable(l[He])}},or.prototype._add=function(l,d,h){this._handlers.push({handlerName:l,handler:d,allowed:h}),this._handlersById[l]=d},or.prototype.stop=function(l){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},or.prototype.isActive=function(){for(var l=0,d=this._handlers;l<d.length;l+=1)if(d[l].handler.isActive())return!0;return!1},or.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},or.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},or.prototype.isMoving=function(){return!!Zi(this._eventsInProgress)||this.isZooming()},or.prototype._blockedByActive=function(l,d,h){for(var g in l)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},or.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},or.prototype._getMapTouches=function(l){for(var d=[],h=0,g=l;h<g.length;h+=1){var C=g[h];this._el.contains(C.target)&&d.push(C)}return d},or.prototype.handleEvent=function(l,d){this._updatingCamera=!0;for(var h=l.type==="renderFrame"?void 0:l,g={needsRenderFrame:!1},C={},P={},R=l.touches?this._getMapTouches(l.touches):void 0,L=R?f.touchPos(this._el,R):f.mousePos(this._el,l),U=0,X=this._handlers;U<X.length;U+=1){var te=X[U],Q=te.handlerName,re=te.handler,oe=te.allowed;if(re.isEnabled()){var Ee=void 0;this._blockedByActive(P,oe,Q)?re.reset():re[d||l.type]&&(Ee=re[d||l.type](l,L,R),this.mergeHandlerResult(g,C,Ee,Q,h),Ee&&Ee.needsRenderFrame&&this._triggerRenderFrame()),(Ee||re.isActive())&&(P[Q]=re)}}var Oe={};for(var me in this._previousActiveHandlers)P[me]||(Oe[me]=h);this._previousActiveHandlers=P,(Object.keys(Oe).length||_r(g))&&(this._changes.push([g,C,Oe]),this._triggerRenderFrame()),(Object.keys(P).length||_r(g))&&this._map._stop(!0),this._updatingCamera=!1;var Fe=g.cameraAnimation;Fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Fe(this._map))},or.prototype.mergeHandlerResult=function(l,d,h,g,C){if(h){s.extend(l,h);var P={handlerName:g,originalEvent:h.originalEvent||C};h.zoomDelta!==void 0&&(d.zoom=P),h.panDelta!==void 0&&(d.drag=P),h.pitchDelta!==void 0&&(d.pitch=P),h.bearingDelta!==void 0&&(d.rotate=P)}},or.prototype._applyChanges=function(){for(var l={},d={},h={},g=0,C=this._changes;g<C.length;g+=1){var P=C[g],R=P[0],L=P[1],U=P[2];R.panDelta&&(l.panDelta=(l.panDelta||new s.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(l.around=R.around),R.pinchAround!==void 0&&(l.pinchAround=R.pinchAround),R.noInertia&&(l.noInertia=R.noInertia),s.extend(d,L),s.extend(h,U)}this._updateMapTransform(l,d,h),this._changes=[]},or.prototype._updateMapTransform=function(l,d,h){var g=this._map,C=g.transform;if(!_r(l))return this._fireEvents(d,h,!0);var P=l.panDelta,R=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,X=l.around,te=l.pinchAround;te!==void 0&&(X=te),g._stop(!0),X=X||g.transform.centerPoint;var Q=C.pointLocation(P?X.sub(P):X);L&&(C.bearing+=L),U&&(C.pitch+=U),R&&(C.zoom+=R),C.setLocationAtPoint(Q,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,h,!0)},or.prototype._fireEvents=function(l,d,h){var g=this,C=Zi(this._eventsInProgress),P=Zi(l),R={};for(var L in l)this._eventsInProgress[L]||(R[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!C&&P&&this._fireEvent("movestart",P.originalEvent),R)this._fireEvent(U,R[U]);for(var X in P&&this._fireEvent("move",P.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var te,Q={};for(var re in this._eventsInProgress){var oe=this._eventsInProgress[re],Ee=oe.handlerName,Oe=oe.originalEvent;this._handlersById[Ee].isActive()||(delete this._eventsInProgress[re],Q[re+"end"]=te=d[Ee]||Oe)}for(var me in Q)this._fireEvent(me,Q[me]);var Fe=Zi(this._eventsInProgress);if(h&&(C||P)&&!Fe){this._updatingCamera=!0;var He=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),We=function(it){return it!==0&&-g._bearingSnap<it&&it<g._bearingSnap};He?(We(He.bearing||this._map.getBearing())&&(He.bearing=0),this._map.easeTo(He,{originalEvent:te})):(this._map.fire(new s.Event("moveend",{originalEvent:te})),We(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},or.prototype._fireEvent=function(l,d){this._map.fire(new s.Event(l,d?{originalEvent:d}:{}))},or.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete l._frameId,l.handleEvent(new bl("renderFrame",{timeStamp:d})),l._applyChanges()})},or.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var hu=function(l){function d(h,g){l.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,C){return h=s.Point.convert(h).mult(-1),this.panTo(this.transform.center,s.extend({offset:h},g),C)},d.prototype.panTo=function(h,g,C){return this.easeTo(s.extend({center:h},g),C)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,C){return this.easeTo(s.extend({zoom:h},g),C)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,C){return this.easeTo(s.extend({bearing:h},g),C)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,s.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=s.LngLatBounds.convert(h);var C=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),C,g)},d.prototype._cameraForBoxAndBearing=function(h,g,C,P){var R={top:0,bottom:0,right:0,left:0};if(typeof(P=s.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var L=P.padding;P.padding={top:L,bottom:L,right:L,left:L}}P.padding=s.extend(R,P.padding);var U=this.transform,X=U.padding,te=U.project(s.LngLat.convert(h)),Q=U.project(s.LngLat.convert(g)),re=te.rotate(-C*Math.PI/180),oe=Q.rotate(-C*Math.PI/180),Ee=new s.Point(Math.max(re.x,oe.x),Math.max(re.y,oe.y)),Oe=new s.Point(Math.min(re.x,oe.x),Math.min(re.y,oe.y)),me=Ee.sub(Oe),Fe=(U.width-(X.left+X.right+P.padding.left+P.padding.right))/me.x,He=(U.height-(X.top+X.bottom+P.padding.top+P.padding.bottom))/me.y;if(!(He<0||Fe<0)){var We=Math.min(U.scaleZoom(U.scale*Math.min(Fe,He)),P.maxZoom),it=typeof P.offset.x=="number"?new s.Point(P.offset.x,P.offset.y):s.Point.convert(P.offset),Xe=new s.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(C*Math.PI/180),et=it.add(Xe).mult(U.scale/U.zoomScale(We));return{center:U.unproject(te.add(Q).div(2).sub(et)),zoom:We,bearing:C}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,C){return this._fitInternal(this.cameraForBounds(h,g),g,C)},d.prototype.fitScreenCoordinates=function(h,g,C,P,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(h)),this.transform.pointLocation(s.Point.convert(g)),C,P),P,R)},d.prototype._fitInternal=function(h,g,C){return h?(delete(g=s.extend(h,g)).padding,g.linear?this.easeTo(g,C):this.flyTo(g,C)):this},d.prototype.jumpTo=function(h,g){this.stop();var C=this.transform,P=!1,R=!1,L=!1;return"zoom"in h&&C.zoom!==+h.zoom&&(P=!0,C.zoom=+h.zoom),h.center!==void 0&&(C.center=s.LngLat.convert(h.center)),"bearing"in h&&C.bearing!==+h.bearing&&(R=!0,C.bearing=+h.bearing),"pitch"in h&&C.pitch!==+h.pitch&&(L=!0,C.pitch=+h.pitch),h.padding==null||C.isPaddingEqual(h.padding)||(C.padding=h.padding),this.fire(new s.Event("movestart",g)).fire(new s.Event("move",g)),P&&this.fire(new s.Event("zoomstart",g)).fire(new s.Event("zoom",g)).fire(new s.Event("zoomend",g)),R&&this.fire(new s.Event("rotatestart",g)).fire(new s.Event("rotate",g)).fire(new s.Event("rotateend",g)),L&&this.fire(new s.Event("pitchstart",g)).fire(new s.Event("pitch",g)).fire(new s.Event("pitchend",g)),this.fire(new s.Event("moveend",g))},d.prototype.easeTo=function(h,g){var C=this;this._stop(!1,h.easeId),((h=s.extend({offset:[0,0],duration:500,easing:s.ease},h)).animate===!1||!h.essential&&s.browser.prefersReducedMotion)&&(h.duration=0);var P=this.transform,R=this.getZoom(),L=this.getBearing(),U=this.getPitch(),X=this.getPadding(),te="zoom"in h?+h.zoom:R,Q="bearing"in h?this._normalizeBearing(h.bearing,L):L,re="pitch"in h?+h.pitch:U,oe="padding"in h?h.padding:P.padding,Ee=s.Point.convert(h.offset),Oe=P.centerPoint.add(Ee),me=P.pointLocation(Oe),Fe=s.LngLat.convert(h.center||me);this._normalizeCenter(Fe);var He,We,it=P.project(me),Xe=P.project(Fe).sub(it),et=P.zoomScale(te-R);h.around&&(He=s.LngLat.convert(h.around),We=P.locationPoint(He));var ht={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||te!==R,this._rotating=this._rotating||L!==Q,this._pitching=this._pitching||re!==U,this._padding=!P.isPaddingEqual(oe),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,ht),this._ease(function(Rt){if(C._zooming&&(P.zoom=s.number(R,te,Rt)),C._rotating&&(P.bearing=s.number(L,Q,Rt)),C._pitching&&(P.pitch=s.number(U,re,Rt)),C._padding&&(P.interpolatePadding(X,oe,Rt),Oe=P.centerPoint.add(Ee)),He)P.setLocationAtPoint(He,We);else{var xt=P.zoomScale(P.zoom-R),kt=te>R?Math.min(2,et):Math.max(.5,et),rr=Math.pow(kt,1-Rt),vr=P.unproject(it.add(Xe.mult(Rt*rr)).mult(xt));P.setLocationAtPoint(P.renderWorldCopies?vr.wrap():vr,Oe)}C._fireMoveEvents(g)},function(Rt){C._afterEase(g,Rt)},h),this},d.prototype._prepareEase=function(h,g,C){C===void 0&&(C={}),this._moving=!0,g||C.moving||this.fire(new s.Event("movestart",h)),this._zooming&&!C.zooming&&this.fire(new s.Event("zoomstart",h)),this._rotating&&!C.rotating&&this.fire(new s.Event("rotatestart",h)),this._pitching&&!C.pitching&&this.fire(new s.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new s.Event("move",h)),this._zooming&&this.fire(new s.Event("zoom",h)),this._rotating&&this.fire(new s.Event("rotate",h)),this._pitching&&this.fire(new s.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var C=this._zooming,P=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new s.Event("zoomend",h)),P&&this.fire(new s.Event("rotateend",h)),R&&this.fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var C=this;if(!h.essential&&s.browser.prefersReducedMotion){var P=s.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,g)}this.stop(),h=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},h);var R=this.transform,L=this.getZoom(),U=this.getBearing(),X=this.getPitch(),te=this.getPadding(),Q="zoom"in h?s.clamp(+h.zoom,R.minZoom,R.maxZoom):L,re="bearing"in h?this._normalizeBearing(h.bearing,U):U,oe="pitch"in h?+h.pitch:X,Ee="padding"in h?h.padding:R.padding,Oe=R.zoomScale(Q-L),me=s.Point.convert(h.offset),Fe=R.centerPoint.add(me),He=R.pointLocation(Fe),We=s.LngLat.convert(h.center||He);this._normalizeCenter(We);var it=R.project(He),Xe=R.project(We).sub(it),et=h.curve,ht=Math.max(R.width,R.height),Rt=ht/Oe,xt=Xe.mag();if("minZoom"in h){var kt=s.clamp(Math.min(h.minZoom,L,Q),R.minZoom,R.maxZoom),rr=ht/R.zoomScale(kt-L);et=Math.sqrt(rr/xt*2)}var vr=et*et;function Cr(Pr){var Ir=(Rt*Rt-ht*ht+(Pr?-1:1)*vr*vr*xt*xt)/(2*(Pr?Rt:ht)*vr*xt);return Math.log(Math.sqrt(Ir*Ir+1)-Ir)}function gn(Pr){return(Math.exp(Pr)-Math.exp(-Pr))/2}function ir(Pr){return(Math.exp(Pr)+Math.exp(-Pr))/2}var Ur=Cr(0),Yr=function(Pr){return ir(Ur)/ir(Ur+et*Pr)},Nr=function(Pr){return ht*((ir(Ur)*(gn(Ir=Ur+et*Pr)/ir(Ir))-gn(Ur))/vr)/xt;var Ir},Dr=(Cr(1)-Ur)/et;if(Math.abs(xt)<1e-6||!isFinite(Dr)){if(Math.abs(ht-Rt)<1e-6)return this.easeTo(h,g);var Wr=Rt<ht?-1:1;Dr=Math.abs(Math.log(Rt/ht))/et,Nr=function(){return 0},Yr=function(Pr){return Math.exp(Wr*et*Pr)}}return h.duration="duration"in h?+h.duration:1e3*Dr/("screenSpeed"in h?+h.screenSpeed/et:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=U!==re,this._pitching=oe!==X,this._padding=!R.isPaddingEqual(Ee),this._prepareEase(g,!1),this._ease(function(Pr){var Ir=Pr*Dr,ji=1/Yr(Ir);R.zoom=Pr===1?Q:L+R.scaleZoom(ji),C._rotating&&(R.bearing=s.number(U,re,Pr)),C._pitching&&(R.pitch=s.number(X,oe,Pr)),C._padding&&(R.interpolatePadding(te,Ee,Pr),Fe=R.centerPoint.add(me));var yi=Pr===1?We:R.unproject(it.add(Xe.mult(Nr(Ir))).mult(ji));R.setLocationAtPoint(R.renderWorldCopies?yi.wrap():yi,Fe),C._fireMoveEvents(g)},function(){return C._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var C=this._onEaseEnd;delete this._onEaseEnd,C.call(this,g)}if(!h){var P=this.handlers;P&&P.stop(!1)}return this},d.prototype._ease=function(h,g,C){C.animate===!1||C.duration===0?(h(1),g()):(this._easeStart=s.browser.now(),this._easeOptions=C,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=s.wrap(h,-180,180);var C=Math.abs(h-g);return Math.abs(h-360-g)<C&&(h-=360),Math.abs(h+360-g)<C&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var C=h.lng-g.center.lng;h.lng+=C>180?-360:C<-180?360:0}},d}(s.Evented),is=function(l){l===void 0&&(l={}),this.options=l,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};is.prototype.getDefaultPosition=function(){return"bottom-right"},is.prototype.onAdd=function(l){var d=this.options&&this.options.compact;return this._map=l,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=f.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=f.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},is.prototype.onRemove=function(){f.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},is.prototype._setElementTitle=function(l,d){var h=this._map._getUIString("AttributionControl."+d);l.title=h,l.setAttribute("aria-label",h)},is.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},is.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(l){var h=d.reduce(function(g,C,P){return C.value&&(g+=C.key+"="+C.value+(P<d.length-1?"&":"")),g},"?");l.href=s.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},is.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},is.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var C=h[g];if(C.used){var P=C.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l.sort(function(L,U){return L.length-U.length});var R=(l=l.filter(function(L,U){for(var X=U+1;X<l.length;X++)if(l[X].indexOf(L)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,l.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},is.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Hi=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};Hi.prototype.onAdd=function(l){this._map=l,this._container=f.create("div","mapboxgl-ctrl");var d=f.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Hi.prototype.onRemove=function(){f.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Hi.prototype.getDefaultPosition=function(){return"bottom-left"},Hi.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Hi.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var d in l)if(l[d].getSource().mapbox_logo)return!0;return!1}},Hi.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Vn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Vn.prototype.add=function(l){var d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d},Vn.prototype.remove=function(l){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var C=g[h];if(C.id===l)return void(C.cancelled=!0)}},Vn.prototype.run=function(l){l===void 0&&(l=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var C=g[h];if(!C.cancelled&&(C.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Vn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Or={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},eo=s.window.HTMLImageElement,cn=s.window.HTMLElement,Hr=s.window.ImageBitmap,Mi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},du=function(l){function d(g){var C=this;if((g=s.extend({},Mi,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new nn(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(l.call(this,P,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Vn,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Or,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new s.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=s.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof cn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return C._update(!1)}),this.on("moveend",function(){return C._update(!1)}),this.on("zoom",function(){return C._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new or(this,g),this._hash=g.hash&&new Ds(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,s.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new is({customAttribution:g.customAttribution})),this.addControl(new Hi,g.logoPosition),this.on("style.load",function(){C.transform.unmodified&&C.jumpTo(C.style.stylesheet)}),this.on("data",function(R){C._update(R.dataType==="style"),C.fire(new s.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){C.fire(new s.Event(R.dataType+"dataloading",R))})}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,C){if(C===void 0&&(C=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[C];return C.indexOf("bottom")!==-1?R.insertBefore(P,R.firstChild):R.appendChild(P),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var C=this._controls.indexOf(g);return C>-1&&this._controls.splice(C,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var C=this._containerDimensions(),P=C[0],R=C[1];if(P===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(P,R),this.transform.resize(P,R),this.painter.resize(P,R);var L=!this._moving;return L&&this.fire(new s.Event("movestart",g)).fire(new s.Event("move",g)),this.fire(new s.Event("resize",g)),L&&this.fire(new s.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(s.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(s.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(s.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,C,P){var R,L=this;if(g==="mouseenter"||g==="mouseover"){var U=!1;return{layer:C,listener:P,delegates:{mousemove:function(te){var Q=L.getLayer(C)?L.queryRenderedFeatures(te.point,{layers:[C]}):[];Q.length?U||(U=!0,P.call(L,new Fn(g,L,te.originalEvent,{features:Q}))):U=!1},mouseout:function(){U=!1}}}}if(g==="mouseleave"||g==="mouseout"){var X=!1;return{layer:C,listener:P,delegates:{mousemove:function(te){(L.getLayer(C)?L.queryRenderedFeatures(te.point,{layers:[C]}):[]).length?X=!0:X&&(X=!1,P.call(L,new Fn(g,L,te.originalEvent)))},mouseout:function(te){X&&(X=!1,P.call(L,new Fn(g,L,te.originalEvent)))}}}}return{layer:C,listener:P,delegates:(R={},R[g]=function(te){var Q=L.getLayer(C)?L.queryRenderedFeatures(te.point,{layers:[C]}):[];Q.length&&(te.features=Q,P.call(L,te),delete te.features)},R)}},d.prototype.on=function(g,C,P){if(P===void 0)return l.prototype.on.call(this,g,C);var R=this._createDelegatedListener(g,C,P);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(L,R.delegates[L]);return this},d.prototype.once=function(g,C,P){if(P===void 0)return l.prototype.once.call(this,g,C);var R=this._createDelegatedListener(g,C,P);for(var L in R.delegates)this.once(L,R.delegates[L]);return this},d.prototype.off=function(g,C,P){var R=this;return P===void 0?l.prototype.off.call(this,g,C):(this._delegatedListeners&&this._delegatedListeners[g]&&function(L){for(var U=L[g],X=0;X<U.length;X++){var te=U[X];if(te.layer===C&&te.listener===P){for(var Q in te.delegates)R.off(Q,te.delegates[Q]);return U.splice(X,1),R}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,C){if(!this.style)return[];var P;if(C!==void 0||g===void 0||g instanceof s.Point||Array.isArray(g)||(C=g,g=void 0),C=C||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof g[0]=="number")P=[s.Point.convert(g)];else{var R=s.Point.convert(g[0]),L=s.Point.convert(g[1]);P=[R,new s.Point(L.x,R.y),L,new s.Point(R.x,L.y),R]}return this.style.queryRenderedFeatures(P,C,this.transform)},d.prototype.querySourceFeatures=function(g,C){return this.style.querySourceFeatures(g,C)},d.prototype.setStyle=function(g,C){return(C=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},C)).diff!==!1&&C.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,C),this):(this._localIdeographFontFamily=C.localIdeographFontFamily,this._updateStyle(g,C))},d.prototype._getUIString=function(g){var C=this._locale[g];if(C==null)throw new Error("Missing UI string '"+g+"'");return C},d.prototype._updateStyle=function(g,C){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Ln(this,C||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,C){var P=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),L=this._requestManager.transformRequest(R,s.ResourceType.Style);s.getJSON(L,function(U,X){U?P.fire(new s.ErrorEvent(U)):X&&P._updateDiff(X,C)})}else typeof g=="object"&&this._updateDiff(g,C)},d.prototype._updateDiff=function(g,C){try{this.style.setState(g)&&this._update(!0)}catch(P){s.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(g,C)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,C){return this._lazyInitEmptyStyle(),this.style.addSource(g,C),this._update(!0)},d.prototype.isSourceLoaded=function(g){var C=this.style&&this.style.sourceCaches[g];if(C!==void 0)return C.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var C in g){var P=g[C]._tiles;for(var R in P){var L=P[R];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,C,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,C,P)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,C,P){P===void 0&&(P={});var R=P.pixelRatio;R===void 0&&(R=1);var L=P.sdf;L===void 0&&(L=!1);var U=P.stretchX,X=P.stretchY,te=P.content;if(this._lazyInitEmptyStyle(),C instanceof eo||Hr&&C instanceof Hr){var Q=s.browser.getImageData(C);this.style.addImage(g,{data:new s.RGBAImage({width:Q.width,height:Q.height},Q.data),pixelRatio:R,stretchX:U,stretchY:X,content:te,sdf:L,version:0})}else{if(C.width===void 0||C.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var re=C;this.style.addImage(g,{data:new s.RGBAImage({width:C.width,height:C.height},new Uint8Array(C.data)),pixelRatio:R,stretchX:U,stretchY:X,content:te,sdf:L,version:0,userImage:re}),re.onAdd&&re.onAdd(this,g)}},d.prototype.updateImage=function(g,C){var P=this.style.getImage(g);if(!P)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=C instanceof eo||Hr&&C instanceof Hr?s.browser.getImageData(C):C,L=R.width,U=R.height,X=R.data;return L===void 0||U===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==P.data.width||U!==P.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace(X,!(C instanceof eo||Hr&&C instanceof Hr)),void this.style.updateImage(g,P))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,C){s.getImage(this._requestManager.transformRequest(g,s.ResourceType.Image),C)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,C){return this._lazyInitEmptyStyle(),this.style.addLayer(g,C),this._update(!0)},d.prototype.moveLayer=function(g,C){return this.style.moveLayer(g,C),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,C,P){return this.style.setLayerZoomRange(g,C,P),this._update(!0)},d.prototype.setFilter=function(g,C,P){return P===void 0&&(P={}),this.style.setFilter(g,C,P),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,C,P,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,C,P,R),this._update(!0)},d.prototype.getPaintProperty=function(g,C){return this.style.getPaintProperty(g,C)},d.prototype.setLayoutProperty=function(g,C,P,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,C,P,R),this._update(!0)},d.prototype.getLayoutProperty=function(g,C){return this.style.getLayoutProperty(g,C)},d.prototype.setLight=function(g,C){return C===void 0&&(C={}),this._lazyInitEmptyStyle(),this.style.setLight(g,C),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,C){return this.style.setFeatureState(g,C),this._update()},d.prototype.removeFeatureState=function(g,C){return this.style.removeFeatureState(g,C),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,C=0;return this._container&&(g=this._container.clientWidth||400,C=this._container.clientHeight||300),[g,C]},d.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=f.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var C=this._canvasContainer=f.create("div","mapboxgl-canvas-container",g);this._interactive&&C.classList.add("mapboxgl-interactive"),this._canvas=f.create("canvas","mapboxgl-canvas",C),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var R=this._controlContainer=f.create("div","mapboxgl-control-container",g),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=f.create("div","mapboxgl-ctrl-"+U,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,C){var P=s.browser.devicePixelRatio||1;this._canvas.width=P*g,this._canvas.height=P*C,this._canvas.style.width=g+"px",this._canvas.style.height=C+"px"},d.prototype._setupPainter=function(){var g=s.extend({},c.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),C=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);C?(this.painter=new Gn(C,this.transform),s.webpSupported.testSupport(C)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var C,P=this,R=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(C=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,C),R=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,te=s.browser.now();this.style.zoomHistory.update(X,te);var Q=new s.EvaluationParameters(X,{now:te,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),re=Q.crossFadingFactor();re===1&&re===this._crossFadingFactor||(U=!0,this._crossFadingFactor=re),this.style.update(Q)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var oe=s.browser.now()-R;L.endQueryEXT(L.TIME_ELAPSED_EXT,C),setTimeout(function(){var me=L.getQueryObjectEXT(C,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(C),P.fire(new s.Event("gpu-timing-frame",{cpuTime:oe,gpuTime:me}))},50)}if(this.listens("gpu-timing-layer")){var Ee=this.painter.collectGpuTimers();setTimeout(function(){var me=P.painter.queryGpuTimers(Ee);P.fire(new s.Event("gpu-timing-layer",{layerTimes:me}))},50)}var Oe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Oe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||Oe||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,C=this._controls;g<C.length;g+=1)C[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),ks(this._canvasContainer),ks(this._controlContainer),ks(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(C){g._frame=null,g._render(C)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,C){s.setCacheLimits(g,C)},h.version.get=function(){return s.version},Object.defineProperties(d.prototype,h),d}(hu);function ks(l){l.parentNode&&l.parentNode.removeChild(l)}var mf={showCompass:!0,showZoom:!0,visualizePitch:!1},si=function(l){var d=this;this.options=s.extend({},mf,l),this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),f.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),f.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=f.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};si.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),d=l===this._map.getMaxZoom(),h=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},si.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},si.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qi(this._map,this._compass,this.options.visualizePitch)),this._container},si.prototype.onRemove=function(){f.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},si.prototype._createButton=function(l,d){var h=f.create("button",l,this._container);return h.type="button",h.addEventListener("click",d),h},si.prototype._setButtonTitle=function(l,d){var h=this._map._getUIString("NavigationControl."+d);l.title=h,l.setAttribute("aria-label",h)};var Qi=function(l,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new lu({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,h&&(this.mousePitch=new Af({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener(d,"mousedown",this.mousedown),f.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),f.addEventListener(d,"touchmove",this.touchmove),f.addEventListener(d,"touchend",this.touchend),f.addEventListener(d,"touchcancel",this.reset)};function mo(l,d,h){if(l=new s.LngLat(l.lng,l.lat),d){var g=new s.LngLat(l.lng-360,l.lat),C=new s.LngLat(l.lng+360,l.lat),P=h.locationPoint(l).distSqr(d);h.locationPoint(g).distSqr(d)<P?l=g:h.locationPoint(C).distSqr(d)<P&&(l=C)}for(;Math.abs(l.lng-h.center.lng)>180;){var R=h.locationPoint(l);if(R.x>=0&&R.y>=0&&R.x<=h.width&&R.y<=h.height)break;l.lng>h.center.lng?l.lng-=360:l.lng+=360}return l}Qi.prototype.down=function(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),f.disableDrag()},Qi.prototype.move=function(l,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(l,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var C=this.mousePitch.mousemoveWindow(l,d);C&&C.pitchDelta&&h.setPitch(h.getPitch()+C.pitchDelta)}},Qi.prototype.off=function(){var l=this.element;f.removeEventListener(l,"mousedown",this.mousedown),f.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),f.removeEventListener(l,"touchmove",this.touchmove),f.removeEventListener(l,"touchend",this.touchend),f.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Qi.prototype.offTemp=function(){f.enableDrag(),f.removeEventListener(s.window,"mousemove",this.mousemove),f.removeEventListener(s.window,"mouseup",this.mouseup)},Qi.prototype.mousedown=function(l){this.down(s.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),f.mousePos(this.element,l)),f.addEventListener(s.window,"mousemove",this.mousemove),f.addEventListener(s.window,"mouseup",this.mouseup)},Qi.prototype.mousemove=function(l){this.move(l,f.mousePos(this.element,l))},Qi.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Qi.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=f.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Qi.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=f.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Qi.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Qi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var _o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jt(l,d,h){var g=l.classList;for(var C in _o)g.remove("mapboxgl-"+h+"-anchor-"+C);g.add("mapboxgl-"+h+"-anchor-"+d)}var Zt,Rc=function(l){function d(h,g){if(l.call(this),(h instanceof s.window.HTMLElement||g)&&(h=s.extend({element:h},g)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=s.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=f.create("div"),this._element.setAttribute("aria-label","Map marker");var C=f.createNS("http://www.w3.org/2000/svg","svg");C.setAttributeNS(null,"display","block"),C.setAttributeNS(null,"height","41px"),C.setAttributeNS(null,"width","27px"),C.setAttributeNS(null,"viewBox","0 0 27 41");var P=f.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var R=f.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var L=f.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<X.length;U+=1){var te=X[U],Q=f.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",te.rx),Q.setAttributeNS(null,"ry",te.ry),L.appendChild(Q)}var re=f.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"fill",this._color);var oe=f.createNS("http://www.w3.org/2000/svg","path");oe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),re.appendChild(oe);var Ee=f.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"fill","#000000");var Oe=f.createNS("http://www.w3.org/2000/svg","path");Oe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ee.appendChild(Oe);var me=f.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");var Fe=f.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var He=f.createNS("http://www.w3.org/2000/svg","circle");He.setAttributeNS(null,"fill","#000000"),He.setAttributeNS(null,"opacity","0.25"),He.setAttributeNS(null,"cx","5.5"),He.setAttributeNS(null,"cy","5.5"),He.setAttributeNS(null,"r","5.4999962");var We=f.createNS("http://www.w3.org/2000/svg","circle");We.setAttributeNS(null,"fill","#FFFFFF"),We.setAttributeNS(null,"cx","5.5"),We.setAttributeNS(null,"cy","5.5"),We.setAttributeNS(null,"r","5.4999962"),Fe.appendChild(He),Fe.appendChild(We),R.appendChild(L),R.appendChild(re),R.appendChild(Ee),R.appendChild(me),R.appendChild(Fe),C.appendChild(R),C.setAttributeNS(null,"height",41*this._scale+"px"),C.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(C),this._offset=s.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(it){it.preventDefault()}),this._element.addEventListener("mousedown",function(it){it.preventDefault()}),jt(this._element,this._anchor,"marker"),this._popup=null}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),f.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,C=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&C!==32&&C!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,C=this._element;this._popup&&(g===C||C.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=mo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),f.setTransform(this._element,_o[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+C+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=s.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(s.Evented),xl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ko=0,To=!1,Yo=function(l){function d(h){l.call(this),this.options=s.extend({},xl,h),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Zt!==void 0?g(Zt):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(C){g(Zt=C.state!=="denied")}):g(Zt=!!s.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),f.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ko=0,To=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),C=h.coords;return g&&(C.longitude<g.getWest()||C.longitude>g.getEast()||C.latitude<g.getSouth()||C.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new s.LngLat(h.coords.longitude,h.coords.latitude),C=h.coords.accuracy,P=this._map.getBearing(),R=s.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(C),R,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new s.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),C=this._map.unproject([1,h]),P=g.distanceTo(C),R=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&To)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=f.create("button","mapboxgl-ctrl-geolocate",this._container),f.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var C=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=f.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Rc(this._dotElement),this._circleElement=f.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new s.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ko--,To=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ko>1?(h={maximumAge:6e5,timeout:0},To=!0):(h=this.options.positionOptions,To=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(s.Evented),qo={maxWidth:100,unit:"metric"},hs=function(l){this.options=s.extend({},qo,l),s.bindAll(["_onMove","setUnit"],this)};function y(l,d,h){var g=h&&h.maxWidth||100,C=l._container.clientHeight/2,P=l.unproject([0,C]),R=l.unproject([g,C]),L=P.distanceTo(R);if(h&&h.unit==="imperial"){var U=3.2808*L;U>5280?m(d,g,U/5280,l._getUIString("ScaleControl.Miles")):m(d,g,U,l._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?m(d,g,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?m(d,g,L/1e3,l._getUIString("ScaleControl.Kilometers")):m(d,g,L,l._getUIString("ScaleControl.Meters"))}function m(l,d,h,g){var C,P,R,L=(C=h,(P=Math.pow(10,(""+Math.floor(C)).length-1))*(R=(R=C/P)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(U){var X=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*X)/X}(R)));l.style.width=d*(L/h)+"px",l.innerHTML=L+"&nbsp;"+g}hs.prototype.getDefaultPosition=function(){return"bottom-left"},hs.prototype._onMove=function(){y(this._map,this._container,this.options)},hs.prototype.onAdd=function(l){return this._map=l,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},hs.prototype.onRemove=function(){f.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},hs.prototype.setUnit=function(l){this.options.unit=l,y(this._map,this._container,this.options)};var v=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof s.window.HTMLElement?this._container=l.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};v.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},v.prototype.onRemove=function(){f.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},v.prototype._setupUI=function(){var l=this._fullscreenButton=f.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);f.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},v.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},v.prototype._isFullscreen=function(){return this._fullscreen},v.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},v.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var w={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},B=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),M=function(l){function d(h){l.call(this),this.options=s.extend(Object.create(w),h),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&f.remove(this._content),this._container&&(f.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(s.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,C=s.window.document.createDocumentFragment(),P=s.window.document.createElement("body");for(P.innerHTML=h;g=P.firstChild;)C.appendChild(g);return this.setDOMContent(C)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=f.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=f.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=f.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=f.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Q){return g._container.classList.add(Q)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var C=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),P=this.options.anchor,R=function Q(re){if(re){if(typeof re=="number"){var oe=Math.round(Math.sqrt(.5*Math.pow(re,2)));return{center:new s.Point(0,0),top:new s.Point(0,re),"top-left":new s.Point(oe,oe),"top-right":new s.Point(-oe,oe),bottom:new s.Point(0,-re),"bottom-left":new s.Point(oe,-oe),"bottom-right":new s.Point(-oe,-oe),left:new s.Point(re,0),right:new s.Point(-re,0)}}if(re instanceof s.Point||Array.isArray(re)){var Ee=s.Point.convert(re);return{center:Ee,top:Ee,"top-left":Ee,"top-right":Ee,bottom:Ee,"bottom-left":Ee,"bottom-right":Ee,left:Ee,right:Ee}}return{center:s.Point.convert(re.center||[0,0]),top:s.Point.convert(re.top||[0,0]),"top-left":s.Point.convert(re["top-left"]||[0,0]),"top-right":s.Point.convert(re["top-right"]||[0,0]),bottom:s.Point.convert(re.bottom||[0,0]),"bottom-left":s.Point.convert(re["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(re["bottom-right"]||[0,0]),left:s.Point.convert(re.left||[0,0]),right:s.Point.convert(re.right||[0,0])}}return Q(new s.Point(0,0))}(this.options.offset);if(!P){var L,U=this._container.offsetWidth,X=this._container.offsetHeight;L=C.y+R.bottom.y<X?["top"]:C.y>this._map.transform.height-X?["bottom"]:[],C.x<U/2?L.push("left"):C.x>this._map.transform.width-U/2&&L.push("right"),P=L.length===0?"bottom":L.join("-")}var te=C.add(R[P]).round();f.setTransform(this._container,_o[P]+" translate("+te.x+"px,"+te.y+"px)"),jt(this._container,P,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(B);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(s.Evented),O={version:s.version,supported:c,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:du,NavigationControl:si,GeolocateControl:Yo,AttributionControl:is,ScaleControl:hs,FullscreenControl:v,Popup:M,Marker:Rc,Style:Ln,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){ut().acquire(Ke)},clearPrewarmedResources:function(){var l=It;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ke),It=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(l){s.config.ACCESS_TOKEN=l},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(l){s.config.API_URL=l},get workerCount(){return Ct.workerCount},set workerCount(l){Ct.workerCount=l},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){s.clearTileCache(l)},workerUrl:""};return O}),i})}(Pm)),Pm.exports}var RQ=PQ();const rl=sh(RQ);var FQ=1e-7;function nx(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function G4(r,e){if(r===e)return!0;if(nx(r)&&nx(e)){if(r.length!==e.length)return!1;for(var t=0;t<r.length;++t)if(!G4(r[t],e[t]))return!1;return!0}return Math.abs(r-e)<=FQ}function V0(r,e,t){return Math.max(e,Math.min(t,r))}function m_(r,e,t){return nx(r)?r.map(function(n,i){return m_(n,e[i],t)}):t*e+(1-t)*r}function rc(r,e){if(!r)throw new Error(e||"react-map-gl: assertion failed.")}function YI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function qI(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):YI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Vf={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},yb={pitch:0,bearing:0,altitude:1.5},ZI=5,OQ=1.2,lA=function(){function r(e){var t=e.width,n=e.height,i=e.latitude,o=e.longitude,s=e.zoom,c=e.bearing,f=c===void 0?yb.bearing:c,_=e.pitch,b=_===void 0?yb.pitch:_,T=e.altitude,S=T===void 0?yb.altitude:T,D=e.maxZoom,N=D===void 0?Vf.maxZoom:D,G=e.minZoom,W=G===void 0?Vf.minZoom:G,z=e.maxPitch,j=z===void 0?Vf.maxPitch:z,K=e.minPitch,fe=K===void 0?Vf.minPitch:K,Z=e.transitionDuration,ae=e.transitionEasing,Be=e.transitionInterpolator,Le=e.transitionInterruption,de=e.startPanLngLat,_e=e.startZoomLngLat,pe=e.startRotatePos,J=e.startBearing,ne=e.startPitch,ye=e.startZoom;Ku(this,r),rc(Number.isFinite(t),"`width` must be supplied"),rc(Number.isFinite(n),"`height` must be supplied"),rc(Number.isFinite(o),"`longitude` must be supplied"),rc(Number.isFinite(i),"`latitude` must be supplied"),rc(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:t,height:n,latitude:i,longitude:o,zoom:s,bearing:f,pitch:b,altitude:S,maxZoom:N,minZoom:W,maxPitch:j,minPitch:fe,transitionDuration:Z,transitionEasing:ae,transitionInterpolator:Be,transitionInterruption:Le}),this._state={startPanLngLat:de,startZoomLngLat:_e,startRotatePos:pe,startBearing:J,startPitch:ne,startZoom:ye}}return Xu(r,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var n=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(n)})}},{key:"pan",value:function(t){var n=t.pos,i=t.startPos,o=this._state.startPanLngLat||this._unproject(i);if(!o)return this;var s=this._calculateNewLngLat({startPanLngLat:o,pos:n}),c=ls(s,2),f=c[0],_=c[1];return this._getUpdatedMapState({longitude:f,latitude:_})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var n=t.pos;return this._getUpdatedMapState({startRotatePos:n,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var n=t.pos,i=t.deltaAngleX,o=i===void 0?0:i,s=t.deltaAngleY,c=s===void 0?0:s,f=this._state,_=f.startRotatePos,b=f.startBearing,T=f.startPitch;if(!Number.isFinite(b)||!Number.isFinite(T))return this;var S;return n?S=this._calculateNewPitchAndBearing(qI(qI({},this._getRotationParams(n,_)),{},{startBearing:b,startPitch:T})):S={bearing:b+o,pitch:T+c},this._getUpdatedMapState(S)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var n=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(n),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var n=t.pos,i=t.startPos,o=t.scale;rc(o>0,"`scale` must be a positive number");var s=this._state,c=s.startZoom,f=s.startZoomLngLat;Number.isFinite(c)||(c=this._viewportProps.zoom,f=this._unproject(i)||this._unproject(n)),rc(f,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var _=this._calculateNewZoom({scale:o,startZoom:c||0}),b=new el(Object.assign({},this._viewportProps,{zoom:_})),T=b.getMapCenterByLngLatPosition({lngLat:f,pos:n}),S=ls(T,2),D=S[0],N=S[1];return this._getUpdatedMapState({zoom:_,longitude:D,latitude:N})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new r(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var n=t.maxZoom,i=t.minZoom,o=t.zoom;t.zoom=V0(o,i,n);var s=t.maxPitch,c=t.minPitch,f=t.pitch;return t.pitch=V0(f,c,s),Object.assign(t,nQ(t)),t}},{key:"_unproject",value:function(t){var n=new el(this._viewportProps);return t&&n.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var n=t.startPanLngLat,i=t.pos,o=new el(this._viewportProps);return o.getMapCenterByLngLatPosition({lngLat:n,pos:i})}},{key:"_calculateNewZoom",value:function(t){var n=t.scale,i=t.startZoom,o=this._viewportProps,s=o.maxZoom,c=o.minZoom,f=i+Math.log2(n);return V0(f,c,s)}},{key:"_calculateNewPitchAndBearing",value:function(t){var n=t.deltaScaleX,i=t.deltaScaleY,o=t.startBearing,s=t.startPitch;i=V0(i,-1,1);var c=this._viewportProps,f=c.minPitch,_=c.maxPitch,b=o+180*n,T=s;return i>0?T=s+i*(_-s):i<0&&(T=s-i*(f-s)),{pitch:T,bearing:b}}},{key:"_getRotationParams",value:function(t,n){var i=t[0]-n[0],o=t[1]-n[1],s=t[1],c=n[1],f=this._viewportProps,_=f.width,b=f.height,T=i/_,S=0;return o>0?Math.abs(b-c)>ZI&&(S=o/(c-b)*OQ):o<0&&c>ZI&&(S=1-s/c),S=Math.min(1,Math.max(-1,S)),{deltaScaleX:T,deltaScaleY:S}}}]),r}();function DQ(r){return r[0].toLowerCase()+r.slice(1)}function LQ(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vf;for(var t in e){var n=t.slice(0,3),i=DQ(t.slice(3));if(n==="min"&&r[i]<e[t]||n==="max"&&r[i]>e[t])return!1}return!0}function QI(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function e3(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?QI(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):QI(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var fh=Bt.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),Uw=fh.Provider;function kQ(r){var e=r.value,t=r.children,n=Bt.useState(null),i=ls(n,2),o=i[0],s=i[1],c=Bt.useContext(fh);return e=e3(e3({setMap:s},c),{},{map:c&&c.map||o},e),Bt.createElement(Uw,{value:e},t)}fh.Provider=kQ;var ix=typeof window<"u"?Bt.useLayoutEffect:Bt.useEffect;function t3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function tc(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?t3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):t3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var NQ="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",V4="A valid API access token is required to use Mapbox data";function UQ(){}function H4(r){var e=r.props,t=r.width,n=r.height;return new el(tc(tc(tc({},e),e.viewState),{},{width:t,height:n}))}var zQ=401,r3={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},GQ=Object.assign({},uh.propTypes,{width:dt.oneOfType([dt.number,dt.string]),height:dt.oneOfType([dt.number,dt.string]),onResize:dt.func,disableTokenWarning:dt.bool,visible:dt.bool,className:dt.string,style:dt.object,visibilityConstraints:dt.object}),VQ=Object.assign({},uh.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:UQ,className:"",style:null,visibilityConstraints:Vf});function HQ(){var r={position:"absolute",left:0,top:0};return Bt.createElement("div",{key:"warning",id:"no-token-warning",style:r},Bt.createElement("h3",{key:"header"},V4),Bt.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Bt.createElement("a",{key:"link",href:NQ},"Note on Map Tokens"))}function jQ(r){return{getMap:function(){return r.current&&r.current.getMap()},queryRenderedFeatures:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.current&&r.current.getMap();return i&&i.queryRenderedFeatures(t,n)}}}var $l=Bt.forwardRef(function(r,e){var t=Bt.useState(!0),n=ls(t,2),i=n[0],o=n[1],s=Bt.useState({width:0,height:0}),c=ls(s,2),f=c[0],_=c[1],b=Bt.useRef(null),T=Bt.useRef(null),S=Bt.useRef(null),D=Bt.useRef(null),N=Bt.useContext(fh);ix(function(){if($l.supported()){var _e=new uh(tc(tc(tc({},r),f),{},{mapboxgl:rl,container:T.current,onError:function(ne){var ye=ne.error&&ne.error.status||ne.status;ye===zQ&&i&&(console.error(V4),o(!1)),r.onError(ne)}}));b.current=_e,N&&N.setMap&&N.setMap(_e.getMap());var pe=new CQ(function(J){if(J[0].contentRect){var ne=J[0].contentRect,ye=ne.width,Ye=ne.height;_({width:ye,height:Ye}),r.onResize({width:ye,height:Ye})}});return pe.observe(S.current),function(){_e.finalize(),b.current=null,pe.disconnect()}}},[]),ix(function(){b.current&&b.current.setProps(tc(tc({},r),f))});var G=b.current&&b.current.getMap();Bt.useImperativeHandle(e,function(){return jQ(b)},[]);var W=Bt.useCallback(function(_e){var pe=_e.target;pe===D.current&&pe.scrollTo(0,0)},[]),z=G&&Bt.createElement(Uw,{value:tc(tc({},N),{},{viewport:N.viewport||H4(tc({map:G,props:r},f)),map:G,container:N.container||S.current})},Bt.createElement("div",{key:"map-overlays",className:"overlays",ref:D,style:r3,onScroll:W},r.children)),j=r.className,K=r.width,fe=r.height,Z=r.style,ae=r.visibilityConstraints,Be=Object.assign({position:"relative"},Z,{width:K,height:fe}),Le=r.visible&&LQ(r.viewState||r,ae),de=Object.assign({},r3,{visibility:Le?"inherit":"hidden"});return Bt.createElement("div",{key:"map-container",ref:S,style:Be},Bt.createElement("div",{key:"map-mapbox",ref:T,style:de,className:j}),z,!i&&!r.disableTokenWarning&&Bt.createElement(HQ,null))});$l.supported=function(){return rl&&rl.supported()};$l.propTypes=GQ;$l.defaultProps=VQ;function $Q(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=WQ(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(_){throw _},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var _=t.next();return o=_.done,_},e:function(_){s=!0,c=_},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function WQ(r,e){if(r){if(typeof r=="string")return n3(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n3(r,e)}}function n3(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var j4=function(){function r(){Ku(this,r),yr(this,"propNames",[])}return Xu(r,[{key:"arePropsEqual",value:function(t,n){var i=$Q(this.propNames||[]),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;if(!G4(t[s],n[s]))return!1}}catch(c){i.e(c)}finally{i.f()}return!0}},{key:"initializeProps",value:function(t,n){return{start:t,end:n}}},{key:"interpolateProps",value:function(t,n,i){rc(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,n){return n.transitionDuration}}]),r}(),JQ={longitude:1,bearing:1};function __(r){return Number.isFinite(r)||Array.isArray(r)}function XQ(r){return r in JQ}function sx(r,e,t){return XQ(r)&&Math.abs(t-e)>180&&(t=t<0?t+360:t-360),t}function vb(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=KQ(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(_){throw _},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var _=t.next();return o=_.done,_},e:function(_){s=!0,c=_},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function KQ(r,e){if(r){if(typeof r=="string")return i3(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i3(r,e)}}function i3(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function YQ(r){var e=qQ();return function(){var n=AA(r),i;if(e){var o=AA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return tw(this,i)}}function qQ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var ZQ=["longitude","latitude","zoom","bearing","pitch"],QQ=["latitude","longitude","zoom","width","height"],s3=["bearing","pitch"],eee={speed:1.2,curve:1.414};(function(r){ew(t,r);var e=YQ(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ku(this,t),n=e.call(this),yr(Su(n),"propNames",ZQ),n.props=Object.assign({},eee,i),n}return Xu(t,[{key:"initializeProps",value:function(i,o){var s={},c={},f=vb(QQ),_;try{for(f.s();!(_=f.n()).done;){var b=_.value,T=i[b],S=o[b];rc(__(T)&&__(S),"".concat(b," must be supplied for transition")),s[b]=T,c[b]=sx(b,T,S)}}catch(j){f.e(j)}finally{f.f()}var D=vb(s3),N;try{for(D.s();!(N=D.n()).done;){var G=N.value,W=i[G]||0,z=o[G]||0;s[G]=W,c[G]=sx(G,W,z)}}catch(j){D.e(j)}finally{D.f()}return{start:s,end:c}}},{key:"interpolateProps",value:function(i,o,s){var c=sQ(i,o,s,this.props),f=vb(s3),_;try{for(f.s();!(_=f.n()).done;){var b=_.value;c[b]=m_(i[b],o[b],s)}}catch(T){f.e(T)}finally{f.f()}return c}},{key:"getDuration",value:function(i,o){var s=o.transitionDuration;return s==="auto"&&(s=oQ(i,o,this.props)),s}}]),t})(j4);function o3(r,e){var t;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=tee(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(_){throw _},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,c;return{s:function(){t=r[Symbol.iterator]()},n:function(){var _=t.next();return o=_.done,_},e:function(_){s=!0,c=_},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw c}}}}function tee(r,e){if(r){if(typeof r=="string")return a3(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return a3(r,e)}}function a3(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function ree(r){var e=nee();return function(){var n=AA(r),i;if(e){var o=AA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return tw(this,i)}}function nee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var iee=["longitude","latitude","zoom","bearing","pitch"],Jp=function(r){ew(t,r);var e=ree(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ku(this,t),n=e.call(this),Array.isArray(i)&&(i={transitionProps:i}),n.propNames=i.transitionProps||iee,i.around&&(n.around=i.around),n}return Xu(t,[{key:"initializeProps",value:function(i,o){var s={},c={};if(this.around){s.around=this.around;var f=new el(i).unproject(this.around);Object.assign(c,o,{around:new el(o).project(f),aroundLngLat:f})}var _=o3(this.propNames),b;try{for(_.s();!(b=_.n()).done;){var T=b.value,S=i[T],D=o[T];rc(__(S)&&__(D),"".concat(T," must be supplied for transition")),s[T]=S,c[T]=sx(T,S,D)}}catch(N){_.e(N)}finally{_.f()}return{start:s,end:c}}},{key:"interpolateProps",value:function(i,o,s){var c={},f=o3(this.propNames),_;try{for(f.s();!(_=f.n()).done;){var b=_.value;c[b]=m_(i[b],o[b],s)}}catch(G){f.e(G)}finally{f.f()}if(o.around){var T=new el(Object.assign({},o,c)).getMapCenterByLngLatPosition({lngLat:o.aroundLngLat,pos:m_(i.around,o.around,s)}),S=ls(T,2),D=S[0],N=S[1];c.longitude=D,c.latitude=N}return c}}]),t}(j4),Xp=function(){};function see(r,e){var t=r(e);return function(n){return 1/(1-t)*(r(n*(1-e)+e)-t)}}var Kp={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},oee={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new Jp,transitionInterruption:Kp.BREAK,onTransitionStart:Xp,onTransitionInterrupt:Xp,onTransitionEnd:Xp},zw=function(){function r(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ku(this,r),yr(this,"_animationFrame",null),yr(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=t.onViewportChange||Xp,this.onStateChange=t.onStateChange||Xp,this.time=t.getTime||Date.now}return Xu(r,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){var i=Object.assign({},n),o=Object.assign({},t);if(this._isTransitionInProgress()&&(n.onTransitionInterrupt(),this.state.interruption===Kp.SNAP_TO_END?Object.assign(i,this.state.endProps):Object.assign(i,this.state.propsInTransition),this.state.interruption===Kp.UPDATE)){var s=this.time(),c=(s-this.state.startTime)/this.state.duration;o.transitionDuration=this.state.duration-(s-this.state.startTime),o.transitionEasing=see(this.state.easing,c),o.transitionInterpolator=i.transitionInterpolator}return o.onTransitionStart(),this._triggerTransition(i,o),!0}return this._isTransitionInProgress()&&(n.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var n=t.transitionDuration,i=t.transitionInterpolator;return(n>0||n==="auto")&&!!i}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,n){return t?this._isTransitionInProgress()?this.state.interruption===Kp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(t,n):!0:!0}},{key:"_triggerTransition",value:function(t,n){rc(this._isTransitionEnabled(n)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var i=n.transitionInterpolator,o=i.getDuration?i.getDuration(t,n):n.transitionDuration;if(o!==0){var s=n.transitionInterpolator.initializeProps(t,n),c={inTransition:!0,isZooming:t.zoom!==n.zoom,isPanning:t.longitude!==n.longitude||t.latitude!==n.latitude,isRotating:t.bearing!==n.bearing||t.pitch!==n.pitch};this.state={duration:o,easing:n.transitionEasing,interpolator:n.transitionInterpolator,interruption:n.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(c)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),n=this.state,i=n.startTime,o=n.duration,s=n.easing,c=n.interpolator,f=n.startProps,_=n.endProps,b=!1,T=(t-i)/o;T>=1&&(T=1,b=!0),T=s(T);var S=c.interpolateProps(f,_,T),D=new lA(Object.assign({},this.props,S));this.state.propsInTransition=D.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),b&&(this._endTransition(),this.props.onTransitionEnd())}}]),r}();yr(zw,"defaultProps",oee);var bb={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var c3;function aee(){return c3||(c3=1,function(r){(function(e,t,n,i){var o=["","webkit","Moz","MS","ms","o"],s=t.createElement("div"),c="function",f=Math.round,_=Math.abs,b=Date.now;function T(Ce,Re,$e){return setTimeout(K(Ce,$e),Re)}function S(Ce,Re,$e){return Array.isArray(Ce)?(D(Ce,$e[Re],$e),!0):!1}function D(Ce,Re,$e){var At;if(Ce)if(Ce.forEach)Ce.forEach(Re,$e);else if(Ce.length!==i)for(At=0;At<Ce.length;)Re.call($e,Ce[At],At,Ce),At++;else for(At in Ce)Ce.hasOwnProperty(At)&&Re.call($e,Ce[At],At,Ce)}function N(Ce,Re,$e){var At="DEPRECATED METHOD: "+Re+`
`+$e+` AT 
`;return function(){var Ht=new Error("get-stack-trace"),gr=Ht&&Ht.stack?Ht.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",wr=e.console&&(e.console.warn||e.console.log);return wr&&wr.call(e.console,At,gr),Ce.apply(this,arguments)}}var G;typeof Object.assign!="function"?G=function(Re){if(Re===i||Re===null)throw new TypeError("Cannot convert undefined or null to object");for(var $e=Object(Re),At=1;At<arguments.length;At++){var Ht=arguments[At];if(Ht!==i&&Ht!==null)for(var gr in Ht)Ht.hasOwnProperty(gr)&&($e[gr]=Ht[gr])}return $e}:G=Object.assign;var W=N(function(Re,$e,At){for(var Ht=Object.keys($e),gr=0;gr<Ht.length;)(!At||At&&Re[Ht[gr]]===i)&&(Re[Ht[gr]]=$e[Ht[gr]]),gr++;return Re},"extend","Use `assign`."),z=N(function(Re,$e){return W(Re,$e,!0)},"merge","Use `assign`.");function j(Ce,Re,$e){var At=Re.prototype,Ht;Ht=Ce.prototype=Object.create(At),Ht.constructor=Ce,Ht._super=At,$e&&G(Ht,$e)}function K(Ce,Re){return function(){return Ce.apply(Re,arguments)}}function fe(Ce,Re){return typeof Ce==c?Ce.apply(Re&&Re[0]||i,Re):Ce}function Z(Ce,Re){return Ce===i?Re:Ce}function ae(Ce,Re,$e){D(_e(Re),function(At){Ce.addEventListener(At,$e,!1)})}function Be(Ce,Re,$e){D(_e(Re),function(At){Ce.removeEventListener(At,$e,!1)})}function Le(Ce,Re){for(;Ce;){if(Ce==Re)return!0;Ce=Ce.parentNode}return!1}function de(Ce,Re){return Ce.indexOf(Re)>-1}function _e(Ce){return Ce.trim().split(/\s+/g)}function pe(Ce,Re,$e){if(Ce.indexOf&&!$e)return Ce.indexOf(Re);for(var At=0;At<Ce.length;){if($e&&Ce[At][$e]==Re||!$e&&Ce[At]===Re)return At;At++}return-1}function J(Ce){return Array.prototype.slice.call(Ce,0)}function ne(Ce,Re,$e){for(var At=[],Ht=[],gr=0;gr<Ce.length;){var wr=Ce[gr][Re];pe(Ht,wr)<0&&At.push(Ce[gr]),Ht[gr]=wr,gr++}return At=At.sort(function(Ii,Gi){return Ii[Re]>Gi[Re]}),At}function ye(Ce,Re){for(var $e,At,Ht=Re[0].toUpperCase()+Re.slice(1),gr=0;gr<o.length;){if($e=o[gr],At=$e?$e+Ht:Re,At in Ce)return At;gr++}return i}var Ye=1;function we(){return Ye++}function Ne(Ce){var Re=Ce.ownerDocument||Ce;return Re.defaultView||Re.parentWindow||e}var Ge=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in e,rt=ye(e,"PointerEvent")!==i,tt=Qe&&Ge.test(navigator.userAgent),lt="touch",mt="pen",Tt="mouse",nt="kinect",cr=25,Xt=1,$t=2,Lt=4,lr=8,tn=1,Er=2,Ar=4,Mn=8,hr=16,pr=Er|Ar,rn=Mn|hr,Sr=pr|rn,ei=["x","y"],$n=["clientX","clientY"];function un(Ce,Re){var $e=this;this.manager=Ce,this.callback=Re,this.element=Ce.element,this.target=Ce.options.inputTarget,this.domHandler=function(At){fe(Ce.options.enable,[Ce])&&$e.handler(At)},this.init()}un.prototype={handler:function(){},init:function(){this.evEl&&ae(this.element,this.evEl,this.domHandler),this.evTarget&&ae(this.target,this.evTarget,this.domHandler),this.evWin&&ae(Ne(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Be(this.element,this.evEl,this.domHandler),this.evTarget&&Be(this.target,this.evTarget,this.domHandler),this.evWin&&Be(Ne(this.element),this.evWin,this.domHandler)}};function Xn(Ce){var Re,$e=Ce.options.inputClass;return $e?Re=$e:rt?Re=Te:tt?Re=Ae:Qe?Re=p:Re=Nt,new Re(Ce,Nn)}function Nn(Ce,Re,$e){var At=$e.pointers.length,Ht=$e.changedPointers.length,gr=Re&Xt&&At-Ht===0,wr=Re&(Lt|lr)&&At-Ht===0;$e.isFirst=!!gr,$e.isFinal=!!wr,gr&&(Ce.session={}),$e.eventType=Re,bn(Ce,$e),Ce.emit("hammer.input",$e),Ce.recognize($e),Ce.session.prevInput=$e}function bn(Ce,Re){var $e=Ce.session,At=Re.pointers,Ht=At.length;$e.firstInput||($e.firstInput=dr(Re)),Ht>1&&!$e.firstMultiple?$e.firstMultiple=dr(Re):Ht===1&&($e.firstMultiple=!1);var gr=$e.firstInput,wr=$e.firstMultiple,ni=wr?wr.center:gr.center,Ii=Re.center=Tr(At);Re.timeStamp=b(),Re.deltaTime=Re.timeStamp-gr.timeStamp,Re.angle=Dt(ni,Ii),Re.distance=Pe(ni,Ii),Wn($e,Re),Re.offsetDirection=ui(Re.deltaX,Re.deltaY);var Gi=qr(Re.deltaTime,Re.deltaX,Re.deltaY);Re.overallVelocityX=Gi.x,Re.overallVelocityY=Gi.y,Re.overallVelocity=_(Gi.x)>_(Gi.y)?Gi.x:Gi.y,Re.scale=wr?sr(wr.pointers,At):1,Re.rotation=wr?Vt(wr.pointers,At):0,Re.maxPointers=$e.prevInput?Re.pointers.length>$e.prevInput.maxPointers?Re.pointers.length:$e.prevInput.maxPointers:Re.pointers.length,Ut($e,Re);var Js=Ce.element;Le(Re.srcEvent.target,Js)&&(Js=Re.srcEvent.target),Re.target=Js}function Wn(Ce,Re){var $e=Re.center,At=Ce.offsetDelta||{},Ht=Ce.prevDelta||{},gr=Ce.prevInput||{};(Re.eventType===Xt||gr.eventType===Lt)&&(Ht=Ce.prevDelta={x:gr.deltaX||0,y:gr.deltaY||0},At=Ce.offsetDelta={x:$e.x,y:$e.y}),Re.deltaX=Ht.x+($e.x-At.x),Re.deltaY=Ht.y+($e.y-At.y)}function Ut(Ce,Re){var $e=Ce.lastInterval||Re,At=Re.timeStamp-$e.timeStamp,Ht,gr,wr,ni;if(Re.eventType!=lr&&(At>cr||$e.velocity===i)){var Ii=Re.deltaX-$e.deltaX,Gi=Re.deltaY-$e.deltaY,Js=qr(At,Ii,Gi);gr=Js.x,wr=Js.y,Ht=_(Js.x)>_(Js.y)?Js.x:Js.y,ni=ui(Ii,Gi),Ce.lastInterval=Re}else Ht=$e.velocity,gr=$e.velocityX,wr=$e.velocityY,ni=$e.direction;Re.velocity=Ht,Re.velocityX=gr,Re.velocityY=wr,Re.direction=ni}function dr(Ce){for(var Re=[],$e=0;$e<Ce.pointers.length;)Re[$e]={clientX:f(Ce.pointers[$e].clientX),clientY:f(Ce.pointers[$e].clientY)},$e++;return{timeStamp:b(),pointers:Re,center:Tr(Re),deltaX:Ce.deltaX,deltaY:Ce.deltaY}}function Tr(Ce){var Re=Ce.length;if(Re===1)return{x:f(Ce[0].clientX),y:f(Ce[0].clientY)};for(var $e=0,At=0,Ht=0;Ht<Re;)$e+=Ce[Ht].clientX,At+=Ce[Ht].clientY,Ht++;return{x:f($e/Re),y:f(At/Re)}}function qr(Ce,Re,$e){return{x:Re/Ce||0,y:$e/Ce||0}}function ui(Ce,Re){return Ce===Re?tn:_(Ce)>=_(Re)?Ce<0?Er:Ar:Re<0?Mn:hr}function Pe(Ce,Re,$e){$e||($e=ei);var At=Re[$e[0]]-Ce[$e[0]],Ht=Re[$e[1]]-Ce[$e[1]];return Math.sqrt(At*At+Ht*Ht)}function Dt(Ce,Re,$e){$e||($e=ei);var At=Re[$e[0]]-Ce[$e[0]],Ht=Re[$e[1]]-Ce[$e[1]];return Math.atan2(Ht,At)*180/Math.PI}function Vt(Ce,Re){return Dt(Re[1],Re[0],$n)+Dt(Ce[1],Ce[0],$n)}function sr(Ce,Re){return Pe(Re[0],Re[1],$n)/Pe(Ce[0],Ce[1],$n)}var Ze={mousedown:Xt,mousemove:$t,mouseup:Lt},Mt="mousedown",ge="mousemove mouseup";function Nt(){this.evEl=Mt,this.evWin=ge,this.pressed=!1,un.apply(this,arguments)}j(Nt,un,{handler:function(Re){var $e=Ze[Re.type];$e&Xt&&Re.button===0&&(this.pressed=!0),$e&$t&&Re.which!==1&&($e=Lt),this.pressed&&($e&Lt&&(this.pressed=!1),this.callback(this.manager,$e,{pointers:[Re],changedPointers:[Re],pointerType:Tt,srcEvent:Re}))}});var wt={pointerdown:Xt,pointermove:$t,pointerup:Lt,pointercancel:lr,pointerout:lr},$={2:lt,3:mt,4:Tt,5:nt},yt="pointerdown",Et="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(yt="MSPointerDown",Et="MSPointerMove MSPointerUp MSPointerCancel");function Te(){this.evEl=yt,this.evWin=Et,un.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}j(Te,un,{handler:function(Re){var $e=this.store,At=!1,Ht=Re.type.toLowerCase().replace("ms",""),gr=wt[Ht],wr=$[Re.pointerType]||Re.pointerType,ni=wr==lt,Ii=pe($e,Re.pointerId,"pointerId");gr&Xt&&(Re.button===0||ni)?Ii<0&&($e.push(Re),Ii=$e.length-1):gr&(Lt|lr)&&(At=!0),!(Ii<0)&&($e[Ii]=Re,this.callback(this.manager,gr,{pointers:$e,changedPointers:[Re],pointerType:wr,srcEvent:Re}),At&&$e.splice(Ii,1))}});var Je={touchstart:Xt,touchmove:$t,touchend:Lt,touchcancel:lr},ct="touchstart",q="touchstart touchmove touchend touchcancel";function ie(){this.evTarget=ct,this.evWin=q,this.started=!1,un.apply(this,arguments)}j(ie,un,{handler:function(Re){var $e=Je[Re.type];if($e===Xt&&(this.started=!0),!!this.started){var At=ue.call(this,Re,$e);$e&(Lt|lr)&&At[0].length-At[1].length===0&&(this.started=!1),this.callback(this.manager,$e,{pointers:At[0],changedPointers:At[1],pointerType:lt,srcEvent:Re})}}});function ue(Ce,Re){var $e=J(Ce.touches),At=J(Ce.changedTouches);return Re&(Lt|lr)&&($e=ne($e.concat(At),"identifier")),[$e,At]}var be={touchstart:Xt,touchmove:$t,touchend:Lt,touchcancel:lr},De="touchstart touchmove touchend touchcancel";function Ae(){this.evTarget=De,this.targetIds={},un.apply(this,arguments)}j(Ae,un,{handler:function(Re){var $e=be[Re.type],At=xe.call(this,Re,$e);At&&this.callback(this.manager,$e,{pointers:At[0],changedPointers:At[1],pointerType:lt,srcEvent:Re})}});function xe(Ce,Re){var $e=J(Ce.touches),At=this.targetIds;if(Re&(Xt|$t)&&$e.length===1)return At[$e[0].identifier]=!0,[$e,$e];var Ht,gr,wr=J(Ce.changedTouches),ni=[],Ii=this.target;if(gr=$e.filter(function(Gi){return Le(Gi.target,Ii)}),Re===Xt)for(Ht=0;Ht<gr.length;)At[gr[Ht].identifier]=!0,Ht++;for(Ht=0;Ht<wr.length;)At[wr[Ht].identifier]&&ni.push(wr[Ht]),Re&(Lt|lr)&&delete At[wr[Ht].identifier],Ht++;if(ni.length)return[ne(gr.concat(ni),"identifier"),ni]}var ce=2500,Se=25;function p(){un.apply(this,arguments);var Ce=K(this.handler,this);this.touch=new Ae(this.manager,Ce),this.mouse=new Nt(this.manager,Ce),this.primaryTouch=null,this.lastTouches=[]}j(p,un,{handler:function(Re,$e,At){var Ht=At.pointerType==lt,gr=At.pointerType==Tt;if(!(gr&&At.sourceCapabilities&&At.sourceCapabilities.firesTouchEvents)){if(Ht)le.call(this,$e,At);else if(gr&&Ke.call(this,At))return;this.callback(Re,$e,At)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function le(Ce,Re){Ce&Xt?(this.primaryTouch=Re.changedPointers[0].identifier,vt.call(this,Re)):Ce&(Lt|lr)&&vt.call(this,Re)}function vt(Ce){var Re=Ce.changedPointers[0];if(Re.identifier===this.primaryTouch){var $e={x:Re.clientX,y:Re.clientY};this.lastTouches.push($e);var At=this.lastTouches,Ht=function(){var gr=At.indexOf($e);gr>-1&&At.splice(gr,1)};setTimeout(Ht,ce)}}function Ke(Ce){for(var Re=Ce.srcEvent.clientX,$e=Ce.srcEvent.clientY,At=0;At<this.lastTouches.length;At++){var Ht=this.lastTouches[At],gr=Math.abs(Re-Ht.x),wr=Math.abs($e-Ht.y);if(gr<=Se&&wr<=Se)return!0}return!1}var Ct=ye(s.style,"touchAction"),It=Ct!==i,Ft="compute",ut="auto",Ot="manipulation",St="none",zt="pan-x",Fr="pan-y",qt=zr();function Xr(Ce,Re){this.manager=Ce,this.set(Re)}Xr.prototype={set:function(Ce){Ce==Ft&&(Ce=this.compute()),It&&this.manager.element.style&&qt[Ce]&&(this.manager.element.style[Ct]=Ce),this.actions=Ce.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ce=[];return D(this.manager.recognizers,function(Re){fe(Re.options.enable,[Re])&&(Ce=Ce.concat(Re.getTouchAction()))}),en(Ce.join(" "))},preventDefaults:function(Ce){var Re=Ce.srcEvent,$e=Ce.offsetDirection;if(this.manager.session.prevented){Re.preventDefault();return}var At=this.actions,Ht=de(At,St)&&!qt[St],gr=de(At,Fr)&&!qt[Fr],wr=de(At,zt)&&!qt[zt];if(Ht){var ni=Ce.pointers.length===1,Ii=Ce.distance<2,Gi=Ce.deltaTime<250;if(ni&&Ii&&Gi)return}if(!(wr&&gr)&&(Ht||gr&&$e&pr||wr&&$e&rn))return this.preventSrc(Re)},preventSrc:function(Ce){this.manager.session.prevented=!0,Ce.preventDefault()}};function en(Ce){if(de(Ce,St))return St;var Re=de(Ce,zt),$e=de(Ce,Fr);return Re&&$e?St:Re||$e?Re?zt:Fr:de(Ce,Ot)?Ot:ut}function zr(){if(!It)return!1;var Ce={},Re=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function($e){Ce[$e]=Re?e.CSS.supports("touch-action",$e):!0}),Ce}var Gr=1,Lr=2,fi=4,Vr=8,fr=Vr,Me=16,Wt=32;function Kr(Ce){this.options=G({},this.defaults,Ce||{}),this.id=we(),this.manager=null,this.options.enable=Z(this.options.enable,!0),this.state=Gr,this.simultaneous={},this.requireFail=[]}Kr.prototype={defaults:{},set:function(Ce){return G(this.options,Ce),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ce){if(S(Ce,"recognizeWith",this))return this;var Re=this.simultaneous;return Ce=ti(Ce,this),Re[Ce.id]||(Re[Ce.id]=Ce,Ce.recognizeWith(this)),this},dropRecognizeWith:function(Ce){return S(Ce,"dropRecognizeWith",this)?this:(Ce=ti(Ce,this),delete this.simultaneous[Ce.id],this)},requireFailure:function(Ce){if(S(Ce,"requireFailure",this))return this;var Re=this.requireFail;return Ce=ti(Ce,this),pe(Re,Ce)===-1&&(Re.push(Ce),Ce.requireFailure(this)),this},dropRequireFailure:function(Ce){if(S(Ce,"dropRequireFailure",this))return this;Ce=ti(Ce,this);var Re=pe(this.requireFail,Ce);return Re>-1&&this.requireFail.splice(Re,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ce){return!!this.simultaneous[Ce.id]},emit:function(Ce){var Re=this,$e=this.state;function At(Ht){Re.manager.emit(Ht,Ce)}$e<Vr&&At(Re.options.event+Ui($e)),At(Re.options.event),Ce.additionalEvent&&At(Ce.additionalEvent),$e>=Vr&&At(Re.options.event+Ui($e))},tryEmit:function(Ce){if(this.canEmit())return this.emit(Ce);this.state=Wt},canEmit:function(){for(var Ce=0;Ce<this.requireFail.length;){if(!(this.requireFail[Ce].state&(Wt|Gr)))return!1;Ce++}return!0},recognize:function(Ce){var Re=G({},Ce);if(!fe(this.options.enable,[this,Re])){this.reset(),this.state=Wt;return}this.state&(fr|Me|Wt)&&(this.state=Gr),this.state=this.process(Re),this.state&(Lr|fi|Vr|Me)&&this.tryEmit(Re)},process:function(Ce){},getTouchAction:function(){},reset:function(){}};function Ui(Ce){return Ce&Me?"cancel":Ce&Vr?"end":Ce&fi?"move":Ce&Lr?"start":""}function la(Ce){return Ce==hr?"down":Ce==Mn?"up":Ce==Er?"left":Ce==Ar?"right":""}function ti(Ce,Re){var $e=Re.manager;return $e?$e.get(Ce):Ce}function Un(){Kr.apply(this,arguments)}j(Un,Kr,{defaults:{pointers:1},attrTest:function(Ce){var Re=this.options.pointers;return Re===0||Ce.pointers.length===Re},process:function(Ce){var Re=this.state,$e=Ce.eventType,At=Re&(Lr|fi),Ht=this.attrTest(Ce);return At&&($e&lr||!Ht)?Re|Me:At||Ht?$e&Lt?Re|Vr:Re&Lr?Re|fi:Lr:Wt}});function Ie(){Un.apply(this,arguments),this.pX=null,this.pY=null}j(Ie,Un,{defaults:{event:"pan",threshold:10,pointers:1,direction:Sr},getTouchAction:function(){var Ce=this.options.direction,Re=[];return Ce&pr&&Re.push(Fr),Ce&rn&&Re.push(zt),Re},directionTest:function(Ce){var Re=this.options,$e=!0,At=Ce.distance,Ht=Ce.direction,gr=Ce.deltaX,wr=Ce.deltaY;return Ht&Re.direction||(Re.direction&pr?(Ht=gr===0?tn:gr<0?Er:Ar,$e=gr!=this.pX,At=Math.abs(Ce.deltaX)):(Ht=wr===0?tn:wr<0?Mn:hr,$e=wr!=this.pY,At=Math.abs(Ce.deltaY))),Ce.direction=Ht,$e&&At>Re.threshold&&Ht&Re.direction},attrTest:function(Ce){return Un.prototype.attrTest.call(this,Ce)&&(this.state&Lr||!(this.state&Lr)&&this.directionTest(Ce))},emit:function(Ce){this.pX=Ce.deltaX,this.pY=Ce.deltaY;var Re=la(Ce.direction);Re&&(Ce.additionalEvent=this.options.event+Re),this._super.emit.call(this,Ce)}});function ko(){Un.apply(this,arguments)}j(ko,Un,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[St]},attrTest:function(Ce){return this._super.attrTest.call(this,Ce)&&(Math.abs(Ce.scale-1)>this.options.threshold||this.state&Lr)},emit:function(Ce){if(Ce.scale!==1){var Re=Ce.scale<1?"in":"out";Ce.additionalEvent=this.options.event+Re}this._super.emit.call(this,Ce)}});function zn(){Kr.apply(this,arguments),this._timer=null,this._input=null}j(zn,Kr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ut]},process:function(Ce){var Re=this.options,$e=Ce.pointers.length===Re.pointers,At=Ce.distance<Re.threshold,Ht=Ce.deltaTime>Re.time;if(this._input=Ce,!At||!$e||Ce.eventType&(Lt|lr)&&!Ht)this.reset();else if(Ce.eventType&Xt)this.reset(),this._timer=T(function(){this.state=fr,this.tryEmit()},Re.time,this);else if(Ce.eventType&Lt)return fr;return Wt},reset:function(){clearTimeout(this._timer)},emit:function(Ce){this.state===fr&&(Ce&&Ce.eventType&Lt?this.manager.emit(this.options.event+"up",Ce):(this._input.timeStamp=b(),this.manager.emit(this.options.event,this._input)))}});function No(){Un.apply(this,arguments)}j(No,Un,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[St]},attrTest:function(Ce){return this._super.attrTest.call(this,Ce)&&(Math.abs(Ce.rotation)>this.options.threshold||this.state&Lr)}});function Si(){Un.apply(this,arguments)}j(Si,Un,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:pr|rn,pointers:1},getTouchAction:function(){return Ie.prototype.getTouchAction.call(this)},attrTest:function(Ce){var Re=this.options.direction,$e;return Re&(pr|rn)?$e=Ce.overallVelocity:Re&pr?$e=Ce.overallVelocityX:Re&rn&&($e=Ce.overallVelocityY),this._super.attrTest.call(this,Ce)&&Re&Ce.offsetDirection&&Ce.distance>this.options.threshold&&Ce.maxPointers==this.options.pointers&&_($e)>this.options.velocity&&Ce.eventType&Lt},emit:function(Ce){var Re=la(Ce.offsetDirection);Re&&this.manager.emit(this.options.event+Re,Ce),this.manager.emit(this.options.event,Ce)}});function ri(){Kr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}j(ri,Kr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ot]},process:function(Ce){var Re=this.options,$e=Ce.pointers.length===Re.pointers,At=Ce.distance<Re.threshold,Ht=Ce.deltaTime<Re.time;if(this.reset(),Ce.eventType&Xt&&this.count===0)return this.failTimeout();if(At&&Ht&&$e){if(Ce.eventType!=Lt)return this.failTimeout();var gr=this.pTime?Ce.timeStamp-this.pTime<Re.interval:!0,wr=!this.pCenter||Pe(this.pCenter,Ce.center)<Re.posThreshold;this.pTime=Ce.timeStamp,this.pCenter=Ce.center,!wr||!gr?this.count=1:this.count+=1,this._input=Ce;var ni=this.count%Re.taps;if(ni===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=fr,this.tryEmit()},Re.interval,this),Lr):fr}return Wt},failTimeout:function(){return this._timer=T(function(){this.state=Wt},this.options.interval,this),Wt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==fr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function xi(Ce,Re){return Re=Re||{},Re.recognizers=Z(Re.recognizers,xi.defaults.preset),new zi(Ce,Re)}xi.VERSION="2.0.7",xi.defaults={domEvents:!1,touchAction:Ft,enable:!0,inputTarget:null,inputClass:null,preset:[[No,{enable:!1}],[ko,{enable:!1},["rotate"]],[Si,{direction:pr}],[Ie,{direction:pr},["swipe"]],[ri],[ri,{event:"doubletap",taps:2},["tap"]],[zn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Bn=1,us=2;function zi(Ce,Re){this.options=G({},xi.defaults,Re||{}),this.options.inputTarget=this.options.inputTarget||Ce,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ce,this.input=Xn(this),this.touchAction=new Xr(this,this.options.touchAction),Ps(this,!0),D(this.options.recognizers,function($e){var At=this.add(new $e[0]($e[1]));$e[2]&&At.recognizeWith($e[2]),$e[3]&&At.requireFailure($e[3])},this)}zi.prototype={set:function(Ce){return G(this.options,Ce),Ce.touchAction&&this.touchAction.update(),Ce.inputTarget&&(this.input.destroy(),this.input.target=Ce.inputTarget,this.input.init()),this},stop:function(Ce){this.session.stopped=Ce?us:Bn},recognize:function(Ce){var Re=this.session;if(!Re.stopped){this.touchAction.preventDefaults(Ce);var $e,At=this.recognizers,Ht=Re.curRecognizer;(!Ht||Ht&&Ht.state&fr)&&(Ht=Re.curRecognizer=null);for(var gr=0;gr<At.length;)$e=At[gr],Re.stopped!==us&&(!Ht||$e==Ht||$e.canRecognizeWith(Ht))?$e.recognize(Ce):$e.reset(),!Ht&&$e.state&(Lr|fi|Vr)&&(Ht=Re.curRecognizer=$e),gr++}},get:function(Ce){if(Ce instanceof Kr)return Ce;for(var Re=this.recognizers,$e=0;$e<Re.length;$e++)if(Re[$e].options.event==Ce)return Re[$e];return null},add:function(Ce){if(S(Ce,"add",this))return this;var Re=this.get(Ce.options.event);return Re&&this.remove(Re),this.recognizers.push(Ce),Ce.manager=this,this.touchAction.update(),Ce},remove:function(Ce){if(S(Ce,"remove",this))return this;if(Ce=this.get(Ce),Ce){var Re=this.recognizers,$e=pe(Re,Ce);$e!==-1&&(Re.splice($e,1),this.touchAction.update())}return this},on:function(Ce,Re){if(Ce!==i&&Re!==i){var $e=this.handlers;return D(_e(Ce),function(At){$e[At]=$e[At]||[],$e[At].push(Re)}),this}},off:function(Ce,Re){if(Ce!==i){var $e=this.handlers;return D(_e(Ce),function(At){Re?$e[At]&&$e[At].splice(pe($e[At],Re),1):delete $e[At]}),this}},emit:function(Ce,Re){this.options.domEvents&&wn(Ce,Re);var $e=this.handlers[Ce]&&this.handlers[Ce].slice();if(!(!$e||!$e.length)){Re.type=Ce,Re.preventDefault=function(){Re.srcEvent.preventDefault()};for(var At=0;At<$e.length;)$e[At](Re),At++}},destroy:function(){this.element&&Ps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ps(Ce,Re){var $e=Ce.element;if($e.style){var At;D(Ce.options.cssProps,function(Ht,gr){At=ye($e.style,gr),Re?(Ce.oldCssProps[At]=$e.style[At],$e.style[At]=Ht):$e.style[At]=Ce.oldCssProps[At]||""}),Re||(Ce.oldCssProps={})}}function wn(Ce,Re){var $e=t.createEvent("Event");$e.initEvent(Ce,!0,!0),$e.gesture=Re,Re.target.dispatchEvent($e)}G(xi,{INPUT_START:Xt,INPUT_MOVE:$t,INPUT_END:Lt,INPUT_CANCEL:lr,STATE_POSSIBLE:Gr,STATE_BEGAN:Lr,STATE_CHANGED:fi,STATE_ENDED:Vr,STATE_RECOGNIZED:fr,STATE_CANCELLED:Me,STATE_FAILED:Wt,DIRECTION_NONE:tn,DIRECTION_LEFT:Er,DIRECTION_RIGHT:Ar,DIRECTION_UP:Mn,DIRECTION_DOWN:hr,DIRECTION_HORIZONTAL:pr,DIRECTION_VERTICAL:rn,DIRECTION_ALL:Sr,Manager:zi,Input:un,TouchAction:Xr,TouchInput:Ae,MouseInput:Nt,PointerEventInput:Te,TouchMouseInput:p,SingleTouchInput:ie,Recognizer:Kr,AttrRecognizer:Un,Tap:ri,Pan:Ie,Swipe:Si,Pinch:ko,Rotate:No,Press:zn,on:ae,off:Be,each:D,merge:z,extend:W,assign:G,inherit:j,bindFn:K,prefixed:ye});var cl=typeof e<"u"?e:typeof self<"u"?self:{};cl.Hammer=xi,r.exports?r.exports=xi:e[n]=xi})(window,document,"Hammer")}(bb)),bb.exports}var Eg=aee();const cee=sh(Eg),$c=p5({__proto__:null,default:cee},[Eg]),$4=1,W4=2,ox=4,lee={mousedown:$4,mousemove:W4,mouseup:ox};function uee(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return!0;return!1}function fee(r){const e=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(uee(i,o=>o.pointerId===n.pointerId)||i.push(n)),e.call(this,n)}}function hee(r){r.prototype.handler=function(t){let n=lee[t.type];n&$4&&t.button>=0&&(this.pressed=!0),n&W4&&t.buttons===0&&(n=ox),this.pressed&&(n&ox&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}fee(Eg.PointerEventInput);hee(Eg.MouseInput);const dee=Eg.Manager;class yy{constructor(e,t,n){this.element=e,this.callback=t,this.options={enable:!0,...n}}}const Aee=$c?[[$c.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[$c.Rotate,{enable:!1}],[$c.Pinch,{enable:!1}],[$c.Swipe,{enable:!1}],[$c.Pan,{threshold:0,enable:!1}],[$c.Press,{enable:!1}],[$c.Tap,{event:"doubletap",taps:2,enable:!1}],[$c.Tap,{event:"anytap",enable:!1}],[$c.Tap,{enable:!1}]]:null,l3={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},pee={doubletap:["tap"]},gee={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Gw={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},mee={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},u3={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},_ee=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",qd=typeof window<"u"?window:global;let ax=!1;try{const r={get passive(){return ax=!0,!0}};qd.addEventListener("test",null,r),qd.removeEventListener("test",null)}catch{ax=!1}const yee=_ee.indexOf("firefox")!==-1,{WHEEL_EVENTS:vee}=Gw,f3="wheel",h3=4.000244140625,bee=40,xee=.25;class wee extends yy{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;qd.WheelEvent&&(yee&&i.deltaMode===qd.WheelEvent.DOM_DELTA_PIXEL&&(o/=qd.devicePixelRatio),i.deltaMode===qd.WheelEvent.DOM_DELTA_LINE&&(o*=bee)),o!==0&&o%h3===0&&(o=Math.floor(o/h3)),i.shiftKey&&o&&(o=o*xee),this.callback({type:f3,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(vee),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,ax?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===f3&&(this.options.enable=t)}}const{MOUSE_EVENTS:Cee}=Gw,d3="pointermove",A3="pointerover",p3="pointerout",g3="pointerenter",m3="pointerleave";class Eee extends yy{constructor(e,t,n){super(e,t,n),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(Cee),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===d3&&(this.enableMoveEvent=t),e===A3&&(this.enableOverEvent=t),e===p3&&(this.enableOutEvent=t),e===g3&&(this.enableEnterEvent=t),e===m3&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(A3,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(p3,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(g3,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(m3,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(d3,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:Tee}=Gw,_3="keydown",y3="keyup";class Bee extends yy{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:_3,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:y3,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Tee),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===_3&&(this.enableDownEvent=t),e===y3&&(this.enableUpEvent=t)}}const v3="contextmenu";class See extends yy{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:v3,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===v3&&(this.options.enable=t)}}const b3=1,cx=2,x3=4,Iee={pointerdown:b3,pointermove:cx,pointerup:x3,mousedown:b3,mousemove:cx,mouseup:x3},Mee=0,Pee=1,Ree=2,Fee=1,Oee=2,Dee=4;function Lee(r){const e=Iee[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,o=!1,s=!1;return e===cx?(i=!!(t&Fee),o=!!(t&Dee),s=!!(t&Oee)):(i=n===Mee,o=n===Pee,s=n===Ree),{leftButton:i,middleButton:o,rightButton:s}}function kee(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/o};return{center:t,offsetCenter:s}}const xb={srcElement:"root",priority:0};class Nee{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const n=this._normalizeEvent(t);let i=t.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,o=!1){const{handlers:s,handlersByElement:c}=this;let f=xb;typeof n=="string"||n&&n.addEventListener?f={...xb,srcElement:n}:n&&(f={...xb,...n});let _=c.get(f.srcElement);_||(_=[],c.set(f.srcElement,_));const b={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};i&&(b.once=!0),o&&(b.passive=!0),s.push(b),this._active=this._active||!b.passive;let T=_.length-1;for(;T>=0&&!(_[T].priority>=b.priority);)T--;_.splice(T+1,0,b)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===e&&s.handler===t){n.splice(o,1);const c=i.get(s.srcElement);c.splice(c.indexOf(s),1),c.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,i=!0},c=[];for(let f=0;f<n.length;f++){const{type:_,handler:b,once:T}=n[f];if(b({...e,type:_,stopPropagation:o,stopImmediatePropagation:s}),T&&c.push(n[f]),i)break}for(let f=0;f<c.length;f++){const{type:_,handler:b}=c[f];this.remove(_,b)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...Lee(e),...kee(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const Uee={events:null,recognizers:null,recognizerOptions:{},Manager:dee,touchAction:"none",tabIndex:0};class zee{constructor(e=null,t){this._onBasicInput=i=>{const{srcEvent:o}=i,s=gee[o.type];s&&this.manager.emit(s,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...Uee,...t},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,n=t.Manager;this.manager=new n(e,{touchAction:t.touchAction,recognizers:t.recognizers||Aee}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(l3).forEach(i=>{const o=this.manager.get(i);o&&l3[i].forEach(s=>{o.recognizeWith(s)})});for(const i in t.recognizerOptions){const o=this.manager.get(i);if(o){const s=t.recognizerOptions[i];delete s.enable,o.set(s)}}this.wheelInput=new wee(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Eee(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Bee(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new See(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const o=pee[e];o&&!this.options.recognizers&&o.forEach(s=>{const c=n.get(s);t?(c.requireFailure(e),i.dropRequireFailure(s)):c.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,n,i,o){if(typeof e!="string"){n=t;for(const b in e)this._addEventHandler(b,e[b],n,i,o);return}const{manager:s,events:c}=this,f=u3[e]||e;let _=c.get(f);_||(_=new Nee(this),c.set(f,_),_.recognizerName=mee[f]||f,s&&s.on(f,_.handleEvent)),_.add(e,t,n,i,o),_.isEmpty()||this._toggleRecognizer(_.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const s in e)this._removeEventHandler(s,e[s]);return}const{events:n}=this,i=u3[e]||e,o=n.get(i);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:s}=o;let c=!1;for(const f of n.values())if(f.recognizerName===s&&!f.isEmpty()){c=!0;break}c||this._toggleRecognizer(s,!1)}}}function w3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function bo(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?w3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):w3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Rf={transitionDuration:0},Fl={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new Jp,transitionInterruption:Kp.BREAK},H0=300,j0=function(e){return 1-(1-e)*(1-e)},md={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},J4=function(){function r(){var e=this;Ku(this,r),yr(this,"events",[]),yr(this,"scrollZoom",!0),yr(this,"dragPan",!0),yr(this,"dragRotate",!0),yr(this,"doubleClickZoom",!0),yr(this,"touchZoom",!0),yr(this,"touchRotate",!1),yr(this,"keyboard",!0),yr(this,"_interactionState",{isDragging:!1}),yr(this,"_events",{}),yr(this,"_setInteractionState",function(t){Object.assign(e._interactionState,t),e.onStateChange&&e.onStateChange(e._interactionState)}),yr(this,"_onTransition",function(t,n){e.onViewportChange(t,e._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new zw({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return Xu(r,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var n=this._eventStartBlocked;switch(t.type){case"panstart":return n?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return n?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return n?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var n=t.offsetCenter,i=n.x,o=n.y;return[i,o]}},{key:"isFunctionKeyPressed",value:function(t){var n=t.srcEvent;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"blockEvents",value:function(t){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},t);this._eventStartBlocked=i}},{key:"updateViewport",value:function(t,n,i){var o=this.mapState instanceof lA?this.mapState.getViewportProps():this.mapState,s=bo(bo({},t.getViewportProps()),n),c=Object.keys(s).some(function(f){return o[f]!==s[f]});this._state=t.getState(),this._setInteractionState(i),c&&this.onViewportChange(s,this._interactionState,o)}},{key:"getMapState",value:function(t){return new lA(bo(bo(bo({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var n=t.onViewportChange,i=t.onStateChange,o=t.eventManager,s=o===void 0?this.eventManager:o,c=t.isInteractive,f=c===void 0?!0:c,_=t.scrollZoom,b=_===void 0?this.scrollZoom:_,T=t.dragPan,S=T===void 0?this.dragPan:T,D=t.dragRotate,N=D===void 0?this.dragRotate:D,G=t.doubleClickZoom,W=G===void 0?this.doubleClickZoom:G,z=t.touchZoom,j=z===void 0?this.touchZoom:z,K=t.touchRotate,fe=K===void 0?this.touchRotate:K,Z=t.keyboard,ae=Z===void 0?this.keyboard:Z;this.onViewportChange=n,this.onStateChange=i;var Be=this.mapStateProps||{},Le=Be.height!==t.height||Be.width!==t.width;this.mapStateProps=t,Le&&(this.mapState=Be,this.updateViewport(new lA(t))),this._transitionManager.processViewportChange(t),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(md.WHEEL,f&&!!b),this.toggleEvents(md.PAN,f&&!!(S||N)),this.toggleEvents(md.PINCH,f&&!!(j||fe)),this.toggleEvents(md.TRIPLE_PAN,f&&!!fe),this.toggleEvents(md.DOUBLE_TAP,f&&!!W),this.toggleEvents(md.KEYBOARD,f&&!!ae),this.scrollZoom=b,this.dragPan=S,this.dragRotate=N,this.doubleClickZoom=W,this.touchZoom=j,this.touchRotate=fe,this.keyboard=ae}},{key:"toggleEvents",value:function(t,n){var i=this;this.eventManager&&t.forEach(function(o){i._events[o]!==n&&(i._events[o]=n,n?i.eventManager.on(o,i.handleEvent):i.eventManager.off(o,i.handleEvent))})}},{key:"_onPanStart",value:function(t){var n=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var i=this._panRotate?this.mapState.rotateStart({pos:n}):this.mapState.panStart({pos:n});return this.updateViewport(i,Rf,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var n=this.getCenter(t),i=this.mapState.pan({pos:n});return this.updateViewport(i,Rf,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var n=this.dragPan.inertia,i=n===void 0?H0:n;if(i&&t.velocity){var o=this.getCenter(t),s=[o[0]+t.velocityX*i/2,o[1]+t.velocityY*i/2],c=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(c,bo(bo({},Fl),{},{transitionDuration:i,transitionEasing:j0}),{isDragging:!1,isPanning:!0}),!0}}var f=this.mapState.panEnd();return this.updateViewport(f,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var n=this.getCenter(t),i=this.mapState.rotate({pos:n});return this.updateViewport(i,Rf,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var n=this.dragRotate.inertia,i=n===void 0?H0:n;if(i&&t.velocity){var o=this.getCenter(t),s=[o[0]+t.velocityX*i/2,o[1]+t.velocityY*i/2],c=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(c,bo(bo({},Fl),{},{transitionDuration:i,transitionEasing:j0}),{isDragging:!1,isRotating:!0}),!0}}var f=this.mapState.panEnd();return this.updateViewport(f,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var n=this.scrollZoom,i=n.speed,o=i===void 0?.01:i,s=n.smooth,c=s===void 0?!1:s;t.preventDefault();var f=this.getCenter(t),_=t.delta,b=2/(1+Math.exp(-Math.abs(_*o)));_<0&&b!==0&&(b=1/b);var T=this.mapState.zoom({pos:f,scale:b});return T.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(T,bo(bo({},Fl),{},{transitionInterpolator:new Jp({around:f}),transitionDuration:c?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var n=this.getCenter(t),i=this.mapState.zoomStart({pos:n}).rotateStart({pos:n});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(i,Rf,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var n=this.mapState;if(this.touchZoom){var i=t.scale,o=this.getCenter(t);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){var s=t.rotation;n=n.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(n,Rf,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var n=this.touchZoom.inertia,i=n===void 0?H0:n,o=this._lastPinchEvent;if(i&&o&&t.scale!==o.scale){var s=this.getCenter(t),c=this.mapState.rotateEnd(),f=Math.log2(t.scale),_=(f-Math.log2(o.scale))/(t.deltaTime-o.deltaTime),b=Math.pow(2,f+_*i/2);return c=c.zoom({pos:s,scale:b}).zoomEnd(),this.updateViewport(c,bo(bo({},Fl),{},{transitionInterpolator:new Jp({around:s}),transitionDuration:i,transitionEasing:j0}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(i),!0}}var T=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(T,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var n=this.getCenter(t),i=this.mapState.rotateStart({pos:n});return this.updateViewport(i,Rf,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var n=this.getCenter(t);n[0]-=t.deltaX;var i=this.mapState.rotate({pos:n});return this.updateViewport(i,Rf,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var n=this.touchRotate.inertia,i=n===void 0?H0:n;if(i&&t.velocityY){var o=this.getCenter(t),s=[o[0],o[1]+=t.velocityY*i/2],c=this.mapState.rotate({pos:s});return this.updateViewport(c,bo(bo({},Fl),{},{transitionDuration:i,transitionEasing:j0}),{isDragging:!1,isRotating:!0}),this.blockEvents(i),!1}}var f=this.mapState.rotateEnd();return this.updateViewport(f,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var n=this.getCenter(t),i=this.isFunctionKeyPressed(t),o=this.mapState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,Object.assign({},Fl,{transitionInterpolator:new Jp({around:n})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(t),i=this.keyboard,o=i.zoomSpeed,s=o===void 0?2:o,c=i.moveSpeed,f=c===void 0?100:c,_=i.rotateSpeedX,b=_===void 0?15:_,T=i.rotateSpeedY,S=T===void 0?10:T,D=this.mapStateProps,N;switch(t.srcEvent.keyCode){case 189:n?N=this.getMapState({zoom:D.zoom-Math.log2(s)-1}):N=this.getMapState({zoom:D.zoom-Math.log2(s)});break;case 187:n?N=this.getMapState({zoom:D.zoom+Math.log2(s)+1}):N=this.getMapState({zoom:D.zoom+Math.log2(s)});break;case 37:n?N=this.getMapState({bearing:D.bearing-b}):N=this.mapState.pan({pos:[f,0],startPos:[0,0]});break;case 39:n?N=this.getMapState({bearing:D.bearing+b}):N=this.mapState.pan({pos:[-f,0],startPos:[0,0]});break;case 38:n?N=this.getMapState({pitch:D.pitch+S}):N=this.mapState.pan({pos:[0,f],startPos:[0,0]});break;case 40:n?N=this.getMapState({pitch:D.pitch-S}):N=this.mapState.pan({pos:[0,-f],startPos:[0,0]});break;default:return!1}return this.updateViewport(N,Fl)}}]),r}();function C3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Pl(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?C3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):C3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Gee=Object.assign({},$l.propTypes,{maxZoom:dt.number,minZoom:dt.number,maxPitch:dt.number,minPitch:dt.number,onViewStateChange:dt.func,onViewportChange:dt.func,onInteractionStateChange:dt.func,transitionDuration:dt.oneOfType([dt.number,dt.string]),transitionInterpolator:dt.object,transitionInterruption:dt.number,transitionEasing:dt.func,onTransitionStart:dt.func,onTransitionInterrupt:dt.func,onTransitionEnd:dt.func,scrollZoom:dt.oneOfType([dt.bool,dt.object]),dragPan:dt.oneOfType([dt.bool,dt.object]),dragRotate:dt.oneOfType([dt.bool,dt.object]),doubleClickZoom:dt.bool,touchZoom:dt.oneOfType([dt.bool,dt.object]),touchRotate:dt.oneOfType([dt.bool,dt.object]),keyboard:dt.oneOfType([dt.bool,dt.object]),onHover:dt.func,onClick:dt.func,onDblClick:dt.func,onContextMenu:dt.func,onMouseDown:dt.func,onMouseMove:dt.func,onMouseUp:dt.func,onTouchStart:dt.func,onTouchMove:dt.func,onTouchEnd:dt.func,onMouseEnter:dt.func,onMouseLeave:dt.func,onMouseOut:dt.func,onWheel:dt.func,touchAction:dt.string,eventRecognizerOptions:dt.object,clickRadius:dt.number,interactiveLayerIds:dt.array,getCursor:dt.func,controller:dt.instanceOf(J4)}),Vee=function(e){var t=e.isDragging,n=e.isHovering;return t?"grabbing":n?"pointer":"grab"},Hee=Object.assign({},$l.defaultProps,Vf,zw.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:Vee});function Vw(r){if(r.lngLat||!r.offsetCenter)return r;var e=r.offsetCenter,t=e.x,n=e.y;if(!Number.isFinite(t)||!Number.isFinite(n))return r;var i=[t,n];return r.point=i,r.lngLat=this.viewport.unproject(i),r}function X4(r){var e=this.map;if(!e||!r)return null;var t={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(t.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(n?[[r[0]-n,r[1]+n],[r[0]+n,r[1]-n]]:r,t)}catch{return null}}function kl(r,e){var t=this.props[r];t&&t(Vw.call(this,e))}function jee(r){kl.call(this,r.pointerType==="touch"?"onTouchStart":"onMouseDown",r)}function $ee(r){kl.call(this,r.pointerType==="touch"?"onTouchEnd":"onMouseUp",r)}function Wee(r){if(kl.call(this,r.pointerType==="touch"?"onTouchMove":"onMouseMove",r),!this.state.isDragging){var e=this.props,t=e.onHover,n=e.interactiveLayerIds,i;r=Vw.call(this,r),(n||t)&&(i=X4.call(this,r.point));var o=!!(n&&i&&i.length>0),s=o&&!this.state.isHovering,c=!o&&this.state.isHovering;(t||s)&&(r.features=i,t&&t(r)),s&&kl.call(this,"onMouseEnter",r),c&&kl.call(this,"onMouseLeave",r),(s||c)&&this.setState({isHovering:o})}}function E3(r){var e=this.props,t=e.onClick,n=e.onNativeClick,i=e.onDblClick,o=e.doubleClickZoom,s=[],c=i||o;switch(r.type){case"anyclick":s.push(n),c||s.push(t);break;case"click":c&&s.push(t);break}s=s.filter(Boolean),s.length&&(r=Vw.call(this,r),r.features=X4.call(this,r.point),s.forEach(function(f){return f(r)}))}function Jee(r){return{getMap:r.current&&r.current.getMap,queryRenderedFeatures:r.current&&r.current.queryRenderedFeatures}}var Hw=Bt.forwardRef(function(r,e){var t=Bt.useContext(fh),n=Bt.useMemo(function(){return r.controller||new J4},[]),i=Bt.useMemo(function(){return new zee(null,{touchAction:r.touchAction,recognizerOptions:r.eventRecognizerOptions})},[]),o=Bt.useRef(null),s=Bt.useRef(null),c=Bt.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),f=c.current;f.props=r,f.map=s.current&&s.current.getMap(),f.setState=function(ae){f.state=Pl(Pl({},f.state),ae),o.current.style.cursor=r.getCursor(f.state)};var _=!0,b,T,S=function(Be,Le,de){if(_){b=[Be,Le,de];return}var _e=f.props,pe=_e.onViewStateChange,J=_e.onViewportChange;pe&&pe({viewState:Be,interactionState:Le,oldViewState:de}),J&&J(Be,Le,de)};Bt.useImperativeHandle(e,function(){return Jee(s)},[]);var D=Bt.useMemo(function(){return Pl(Pl({},t),{},{eventManager:i,container:t.container||o.current})},[t,o.current]);D.onViewportChange=S,D.viewport=t.viewport||H4(f),f.viewport=D.viewport;var N=function(Be){var Le=Be.isDragging,de=Le===void 0?!1:Le;if(de!==f.state.isDragging&&f.setState({isDragging:de}),_){T=Be;return}var _e=f.props.onInteractionStateChange;_e&&_e(Be)},G=function(){f.width&&f.height&&n.setOptions(Pl(Pl(Pl({},f.props),f.props.viewState),{},{isInteractive:!!(f.props.onViewStateChange||f.props.onViewportChange),onViewportChange:S,onStateChange:N,eventManager:i,width:f.width,height:f.height}))},W=function(Be){var Le=Be.width,de=Be.height;f.width=Le,f.height=de,G(),f.props.onResize({width:Le,height:de})};Bt.useEffect(function(){return i.setElement(o.current),i.on({pointerdown:jee.bind(f),pointermove:Wee.bind(f),pointerup:$ee.bind(f),pointerleave:kl.bind(f,"onMouseOut"),click:E3.bind(f),anyclick:E3.bind(f),dblclick:kl.bind(f,"onDblClick"),wheel:kl.bind(f,"onWheel"),contextmenu:kl.bind(f,"onContextMenu")}),function(){i.destroy()}},[]),ix(function(){b&&S.apply(void 0,o5(b)),T&&N(T)}),G();var z=r.width,j=r.height,K=r.style,fe=r.getCursor,Z=Bt.useMemo(function(){return Pl(Pl({position:"relative"},K),{},{width:z,height:j,cursor:fe(f.state)})},[K,z,j,fe,f.state]);return(!b||!f._child)&&(f._child=Bt.createElement(Uw,{value:D},Bt.createElement("div",{key:"event-canvas",ref:o,style:Z},Bt.createElement($l,HO({},r,{width:"100%",height:"100%",style:null,onResize:W,ref:s}))))),_=!1,f._child});Hw.supported=$l.supported;Hw.propTypes=Gee;Hw.defaultProps=Hee;dt.string.isRequired;var Xee=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];dt.oneOf(Xee).isRequired;var Yu={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},_c={captureScroll:dt.bool,captureDrag:dt.bool,captureClick:dt.bool,captureDoubleClick:dt.bool,capturePointerMove:dt.bool};function Kee(r){var e=r.containerRef.current,t=r.context.eventManager;if(!(!e||!t)){var n={wheel:function(o){var s=r.props;s.captureScroll&&o.stopPropagation(),s.onScroll&&s.onScroll(o,r)},panstart:function(o){var s=r.props;s.captureDrag&&o.stopPropagation(),s.onDragStart&&s.onDragStart(o,r)},anyclick:function(o){var s=r.props;s.captureClick&&o.stopPropagation(),s.onNativeClick&&s.onNativeClick(o,r)},click:function(o){var s=r.props;s.captureClick&&o.stopPropagation(),s.onClick&&s.onClick(o,r)},dblclick:function(o){var s=r.props;s.captureDoubleClick&&o.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(o,r)},pointermove:function(o){var s=r.props;s.capturePointerMove&&o.stopPropagation(),s.onPointerMove&&s.onPointerMove(o,r)}};return t.watch(n,e),function(){t.off(n)}}}function qu(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Bt.useContext(fh),t=Bt.useRef(null),n=Bt.useRef({props:r,state:{},context:e,containerRef:t}),i=n.current;return i.props=r,i.context=e,Bt.useEffect(function(){return Kee(i)},[e.eventManager]),i}function Yee(r){var e=qee();return function(){var n=AA(r),i;if(e){var o=AA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return tw(this,i)}}function qee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Zee(r){var e=r.instance,t=qu(r),n=t.context,i=t.containerRef;return e._context=n,e._containerRef=i,e._render()}var K4=function(r){ew(t,r);var e=Yee(t);function t(){var n;Ku(this,t);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=e.call.apply(e,[this].concat(o)),yr(Su(n),"_context",{}),yr(Su(n),"_containerRef",Bt.createRef()),yr(Su(n),"_onScroll",function(c){}),yr(Su(n),"_onDragStart",function(c){}),yr(Su(n),"_onDblClick",function(c){}),yr(Su(n),"_onClick",function(c){}),yr(Su(n),"_onPointerMove",function(c){}),n}return Xu(t,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Bt.createElement(Zee,HO({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),t}(Bt.PureComponent);yr(K4,"propTypes",_c);yr(K4,"defaultProps",Yu);function T3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function B3(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?T3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):T3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Qee=Object.assign({},_c,{draggable:dt.bool,onDrag:dt.func,onDragEnd:dt.func,onDragStart:dt.func,offsetLeft:dt.number,offsetTop:dt.number}),ete=Object.assign({},Yu,{draggable:!1,offsetLeft:0,offsetTop:0});function Y4(r){var e=r.offsetCenter,t=e.x,n=e.y;return[t,n]}function tte(r,e){var t=r.center,n=t.x,i=t.y;if(e){var o=e.getBoundingClientRect();return[o.left-n,o.top-i]}return null}function jw(r,e,t,n){var i=r[0]+e[0]-t.offsetLeft,o=r[1]+e[1]-t.offsetTop;return n.viewport.unproject([i,o])}function rte(r,e){var t=e.props,n=e.callbacks,i=e.state,o=e.context,s=e.containerRef,c=t.draggable;if(c){r.stopPropagation();var f=Y4(r),_=tte(r,s.current);if(i.setDragPos(f),i.setDragOffset(_),n.onDragStart&&_){var b=Object.assign({},r);b.lngLat=jw(f,_,t,o),n.onDragStart(b)}}}function nte(r,e){var t=e.props,n=e.callbacks,i=e.state,o=e.context;r.stopPropagation();var s=Y4(r);i.setDragPos(s);var c=i.dragOffset;if(n.onDrag&&c){var f=Object.assign({},r);f.lngLat=jw(s,c,t,o),n.onDrag(f)}}function ite(r,e){var t=e.props,n=e.callbacks,i=e.state,o=e.context;r.stopPropagation();var s=i.dragPos,c=i.dragOffset;if(i.setDragPos(null),i.setDragOffset(null),n.onDragEnd&&s&&c){var f=Object.assign({},r);f.lngLat=jw(s,c,t,o),n.onDragEnd(f)}}function ste(r,e){var t=e.state;r.stopPropagation(),t.setDragPos(null),t.setDragOffset(null)}function ote(r){var e=r.context.eventManager;if(!(!e||!r.state.dragPos)){var t={panmove:function(i){return nte(i,r)},panend:function(i){return ite(i,r)},pancancel:function(i){return ste(i,r)}};return e.watch(t),function(){e.off(t)}}}function ate(r){var e=Bt.useState(null),t=ls(e,2),n=t[0],i=t[1],o=Bt.useState(null),s=ls(o,2),c=s[0],f=s[1],_=qu(B3(B3({},r),{},{onDragStart:rte}));return _.callbacks=r,_.state.dragPos=n,_.state.setDragPos=i,_.state.dragOffset=c,_.state.setDragOffset=f,Bt.useEffect(function(){return ote(_)},[_.context.eventManager,!!n]),_}var S3=typeof window<"u"&&window.devicePixelRatio||1,fg=function(e){return Math.round(e*S3)/S3},I3=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return t;var i=n==="x"?e.offsetWidth:e.offsetHeight;return fg(t/100*i)/i*100};function M3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function cte(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?M3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):M3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var lte=Object.assign({},Qee,{className:dt.string,longitude:dt.number.isRequired,latitude:dt.number.isRequired,style:dt.object}),ute=Object.assign({},ete,{className:""});function fte(r){var e=r.props,t=r.state,n=r.context,i=e.longitude,o=e.latitude,s=e.offsetLeft,c=e.offsetTop,f=t.dragPos,_=t.dragOffset;if(f&&_)return[f[0]+_[0],f[1]+_[1]];var b=n.viewport.project([i,o]),T=ls(b,2),S=T[0],D=T[1];return S+=s,D+=c,[S,D]}function $w(r){var e=ate(r),t=e.state,n=e.containerRef,i=r.children,o=r.className,s=r.draggable,c=r.style,f=t.dragPos,_=fte(e),b=ls(_,2),T=b[0],S=b[1],D="translate(".concat(fg(T),"px, ").concat(fg(S),"px)"),N=s?f?"grabbing":"grab":"auto",G=Bt.useMemo(function(){var z=cte({position:"absolute",left:0,top:0,transform:D,cursor:N},c);return Bt.createElement("div",{className:"mapboxgl-marker ".concat(o),ref:e.containerRef,style:z},i)},[i,o]),W=n.current;return W&&(W.style.transform=D,W.style.cursor=N),G}$w.defaultProps=ute;$w.propTypes=lte;Bt.memo($w);var hg={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},hte=Object.keys(hg);function dte(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=r.selfWidth,s=r.selfHeight,c=r.anchor,f=r.padding,_=f===void 0?0:f,b=hg[c],T=b.x,S=b.y,D=t-S*s,N=D+s,G=Math.max(0,_-D)+Math.max(0,N-i+_);if(G>0){var W=S,z=G;for(S=0;S<=1;S+=.5)D=t-S*s,N=D+s,G=Math.max(0,_-D)+Math.max(0,N-i+_),G<z&&(z=G,W=S);S=W}var j=.5;S===.5&&(T=Math.floor(T),j=1);var K=e-T*o,fe=K+o,Z=Math.max(0,_-K)+Math.max(0,fe-n+_);if(Z>0){var ae=T,Be=Z;for(T=0;T<=1;T+=j)K=e-T*o,fe=K+o,Z=Math.max(0,_-K)+Math.max(0,fe-n+_),Z<Be&&(Be=Z,ae=T);T=ae}return hte.find(function(Le){var de=hg[Le];return de.x===T&&de.y===S})||c}var Ate=Object.assign({},_c,{className:dt.string,longitude:dt.number.isRequired,latitude:dt.number.isRequired,altitude:dt.number,offsetLeft:dt.number,offsetTop:dt.number,tipSize:dt.number,closeButton:dt.bool,closeOnClick:dt.bool,anchor:dt.oneOf(Object.keys(hg)),dynamicPosition:dt.bool,sortByDepth:dt.bool,onClose:dt.func}),pte=Object.assign({},Yu,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function gte(r,e,t,n){var i=ls(n,2),o=i[0],s=i[1],c=r.anchor,f=r.dynamicPosition,_=r.tipSize;return t&&f?dte({x:o,y:s,anchor:c,padding:_,width:e.width,height:e.height,selfWidth:t.clientWidth,selfHeight:t.clientHeight}):c}function mte(r,e,t,n,i){var o=ls(n,3),s=o[0],c=o[1],f=o[2],_=r.offsetLeft,b=r.offsetTop,T=r.sortByDepth,S=hg[i],D=s+_,N=c+b,G=I3(t,-S.x*100),W=I3(t,-S.y*100,"y"),z={position:"absolute",transform:`
      translate(`.concat(G,"%, ").concat(W,`%)
      translate(`).concat(fg(D),"px, ").concat(fg(N),`px)
    `),display:void 0,zIndex:void 0};return T&&(f>1||f<-1||s<0||s>e.width||c<0||c>e.height?z.display="none":z.zIndex=Math.floor((1-f)/2*1e5)),z}function Ww(r){var e=Bt.useRef(null),t=qu(r),n=t.context,i=t.containerRef,o=Bt.useState(!1),s=ls(o,2),c=s[1];Bt.useEffect(function(){c(!0)},[e.current]),Bt.useEffect(function(){if(n.eventManager&&r.closeOnClick){var fe=function(){return t.props.onClose()};return n.eventManager.on("anyclick",fe),function(){n.eventManager.off("anyclick",fe)}}},[n.eventManager,r.closeOnClick]);var f=n.viewport,_=r.className,b=r.longitude,T=r.latitude,S=r.altitude,D=r.tipSize,N=r.closeButton,G=r.children,W=f.project([b,T,S]),z=gte(r,f,e.current,W),j=mte(r,f,i.current,W,z),K=Bt.useCallback(function(fe){t.props.onClose();var Z=t.context.eventManager;Z&&Z.once("click",function(ae){return ae.stopPropagation()},fe.target)},[]);return Bt.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(z," ").concat(_),style:j,ref:i},Bt.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:D}}),Bt.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},N&&Bt.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:K},"×"),G))}Ww.propTypes=Ate;Ww.defaultProps=pte;Bt.memo(Ww);function P3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function _te(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?P3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):P3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var yte=Object.assign({},_c,{toggleLabel:dt.string,className:dt.string,style:dt.object,compact:dt.bool,customAttribution:dt.oneOfType([dt.string,dt.arrayOf(dt.string)])}),vte=Object.assign({},Yu,{className:"",toggleLabel:"Toggle Attribution"});function bte(r,e,t,n){var i=new rl.AttributionControl(r);return i._map=e,i._container=t,i._innerContainer=n,i._updateAttributions(),i._updateEditLink(),e.on("styledata",i._updateData),e.on("sourcedata",i._updateData),i}function xte(r){r._map.off("styledata",r._updateData),r._map.off("sourcedata",r._updateData)}function Jw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useRef(null),o=Bt.useState(!1),s=ls(o,2),c=s[0],f=s[1];Bt.useEffect(function(){var S;return t.map&&(S=bte({customAttribution:r.customAttribution},t.map,n.current,i.current)),function(){return S&&xte(S)}},[t.map]);var _=r.compact===void 0?t.viewport.width<=640:r.compact;Bt.useEffect(function(){!_&&c&&f(!1)},[_]);var b=Bt.useCallback(function(){return f(function(S){return!S})},[]),T=Bt.useMemo(function(){return _te({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:T,className:r.className},Bt.createElement("div",{ref:n,"aria-pressed":c,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(_?"mapboxgl-compact":""," ").concat(c?"mapboxgl-compact-show":"")},Bt.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:r.toggleLabel,onClick:b}),Bt.createElement("div",{ref:i,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}Jw.propTypes=yte;Jw.defaultProps=vte;Bt.memo(Jw);function R3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function wte(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?R3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):R3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Cte=Object.assign({},_c,{className:dt.string,style:dt.object,container:dt.object,label:dt.string}),Ete=Object.assign({},Yu,{className:"",container:null,label:"Toggle fullscreen"});function Xw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useState(!1),o=ls(i,2),s=o[0],c=o[1],f=Bt.useState(!1),_=ls(f,2),b=_[0],T=_[1],S=Bt.useState(null),D=ls(S,2),N=D[0],G=D[1];Bt.useEffect(function(){var Z=new rl.FullscreenControl;G(Z),T(Z._checkFullscreenSupport());var ae=function(){var Le=!Z._fullscreen;Z._fullscreen=Le,c(Le)};return Ol.addEventListener(Z._fullscreenchange,ae),function(){Ol.removeEventListener(Z._fullscreenchange,ae)}},[]);var W=function(){N&&(N._container=r.container||t.container,N._onClickFullscreen())},z=Bt.useMemo(function(){return wte({position:"absolute"},r.style)},[r.style]);if(!b)return null;var j=r.className,K=r.label,fe=s?"shrink":"fullscreen";return Bt.createElement("div",{style:z,className:j},Bt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Bt.createElement("button",{key:fe,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(fe),type:"button",title:K,onClick:W},Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Xw.propTypes=Cte;Xw.defaultProps=Ete;Bt.memo(Xw);var _d;function Tte(){return _d!==void 0?Promise.resolve(_d):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(r){return _d=r.state!=="denied",_d}):(_d=!!window.navigator.geolocation,Promise.resolve(_d))}function F3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Bte(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?F3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):F3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var O3=function(){},Ste=Object.assign({},_c,{className:dt.string,style:dt.object,label:dt.string,disabledLabel:dt.string,auto:dt.bool,positionOptions:dt.object,fitBoundsOptions:dt.object,trackUserLocation:dt.bool,showUserLocation:dt.bool,showAccuracyCircle:dt.bool,showUserHeading:dt.bool,onViewStateChange:dt.func,onViewportChange:dt.func,onGeolocate:dt.func}),Ite=Object.assign({},Yu,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function Mte(r){var e=new rl.LngLat(r.coords.longitude,r.coords.latitude),t=r.coords.accuracy,n=e.toBounds(t);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function Pte(r,e,t){var n=new rl.GeolocateControl(e);n._container=Ol.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=r.map,n._geolocateButton=t;var i=r.eventManager;return n.options.trackUserLocation&&i&&i.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",t.classList.add("mapboxgl-ctrl-geolocate-background"),t.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",e.onGeolocate),n}function Rte(r,e){var t=e.context,n=e.props,i=Mte(r),o=t.viewport.fitBounds(i,n.fitBoundsOptions),s=o.longitude,c=o.latitude,f=o.zoom,_=Object.assign({},t.viewport,{longitude:s,latitude:c,zoom:f}),b=new lA(_),T=Object.assign({},b.getViewportProps(),Fl),S=n.onViewportChange||t.onViewportChange||O3,D=n.onViewStateChange||t.onViewStateChange||O3;D({viewState:T}),S(T)}function Kw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useRef(null),o=Bt.useState(null),s=ls(o,2),c=s[0],f=s[1],_=Bt.useState(!1),b=ls(_,2),T=b[0],S=b[1];Bt.useEffect(function(){var K;return t.map&&Tte().then(function(fe){S(fe),i.current&&(K=Pte(t,r,i.current),K._updateCamera=function(Z){return Rte(Z,e)},f(K))}),function(){K&&K._clearWatch()}},[t.map]);var D=Bt.useCallback(function(){c&&(c.options=e.props,c.trigger())},[c]);Bt.useEffect(function(){r.auto&&D()},[c,r.auto]),Bt.useEffect(function(){c&&c._onZoom()},[t.viewport.zoom]);var N=r.className,G=r.label,W=r.disabledLabel,z=r.trackUserLocation,j=Bt.useMemo(function(){return Bte({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:j,className:N},Bt.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Bt.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:i,disabled:!T,"aria-pressed":!z,type:"button",title:T?G:W,"aria-label":T?G:W,onClick:D},Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Kw.propTypes=Ste;Kw.defaultProps=Ite;Bt.memo(Kw);function Fte(r,e){for(var t=(r||"").split(".").map(Number),n=e.split(".").map(Number),i=0;i<3;i++){var o=t[i]||0,s=n[i]||0;if(o<s)return-1;if(o>s)return 1}return 0}function D3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Ote(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?D3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):D3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var L3=function(){},Dte=Object.assign({},_c,{className:dt.string,style:dt.object,onViewStateChange:dt.func,onViewportChange:dt.func,showCompass:dt.bool,showZoom:dt.bool,zoomInLabel:dt.string,zoomOutLabel:dt.string,compassLabel:dt.string}),Lte=Object.assign({},Yu,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),kte=1,lx=2;function Nte(r){return Fte(r,"1.6.0")>=0?lx:kte}function wb(r,e,t){var n=r.viewport,i=new lA(Object.assign({},n,t)),o=Object.assign({},i.getViewportProps(),Fl),s=e.onViewportChange||r.onViewportChange||L3,c=e.onViewStateChange||r.onViewStateChange||L3;c({viewState:o}),s(o)}function Cb(r,e,t,n){return Bt.createElement("button",{key:r,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(r),type:"button",title:e,onClick:t},n||Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function Ute(r){var e=Bt.useMemo(function(){return r.map?Nte(r.map.version):lx},[r.map]),t=r.viewport.bearing,n={transform:"rotate(".concat(-t,"deg)")};return e===lx?Bt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Bt.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function Yw(r){var e=qu(r),t=e.context,n=e.containerRef,i=function(){wb(t,r,{zoom:t.viewport.zoom+1})},o=function(){wb(t,r,{zoom:t.viewport.zoom-1})},s=function(){wb(t,r,{bearing:0,pitch:0})},c=r.className,f=r.showCompass,_=r.showZoom,b=r.zoomInLabel,T=r.zoomOutLabel,S=r.compassLabel,D=Bt.useMemo(function(){return Ote({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:D,className:c},Bt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},_&&Cb("zoom-in",b,i),_&&Cb("zoom-out",T,o),f&&Cb("compass",S,s,Ute(t))))}Yw.propTypes=Dte;Yw.defaultProps=Lte;const zte=Bt.memo(Yw);function k3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Gte(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?k3(Object(t),!0).forEach(function(n){yr(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):k3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Vte=Object.assign({},_c,{className:dt.string,style:dt.object,maxWidth:dt.number,unit:dt.oneOf(["imperial","metric","nautical"])}),Hte=Object.assign({},Yu,{className:"",maxWidth:100,unit:"metric"});function qw(r){var e=qu(r),t=e.context,n=e.containerRef,i=Bt.useState(null),o=ls(i,2),s=o[0],c=o[1];Bt.useEffect(function(){if(t.map){var _=new rl.ScaleControl;_._map=t.map,_._container=n.current,c(_)}},[t.map]),s&&(s.options=r,s._onMove&&s._onMove());var f=Bt.useMemo(function(){return Gte({position:"absolute"},r.style)},[r.style]);return Bt.createElement("div",{style:f,className:r.className},Bt.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}qw.propTypes=Vte;qw.defaultProps=Hte;Bt.memo(qw);Object.assign({},_c,{redraw:dt.func.isRequired});Object.assign({},_c,{redraw:dt.func.isRequired,style:dt.object});Object.assign({},_c,{redraw:dt.func.isRequired,style:dt.object});rl&&rl.setRTLTextPlugin;const N3=100;class jte{constructor(e,t){V(this,"schema");V(this,"options");V(this,"shape");V(this,"length",0);V(this,"rows",null);V(this,"cursor",0);V(this,"_headers",[]);if(this.options=t,this.schema=e,!Array.isArray(e)){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,t){Number.isFinite(t)&&(this.cursor=t),this.shape="array-row-table",this.rows=this.rows||new Array(N3),this.rows[this.length]=e,this.length++}addObjectRow(e,t){Number.isFinite(t)&&(this.cursor=t),this.shape="object-row-table",this.rows=this.rows||new Array(N3),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function q4(r,e){if(!r)throw new Error("null row");const t={};if(e)for(let n=0;n<e.length;n++)t[e[n]]=r[n];else for(let n=0;n<r.length;n++){const i=`column-${n}`;t[i]=r[n]}return t}function Z4(r,e){if(!r)throw new Error("null row");if(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=r[e[n]];return t}return Object.values(r)}function $te(r){const e=[];for(let t=0;t<r.length;t++){const n=`column-${t}`;e.push(n)}return e}function Wte(r){return Object.keys(r)}const U3=100;class Jte{constructor(e,t){V(this,"schema");V(this,"options");V(this,"length",0);V(this,"objectRows",null);V(this,"arrayRows",null);V(this,"cursor",0);V(this,"_headers",null);if(this.options=t,this.schema=e,e){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,t){switch(Number.isFinite(t)&&(this.cursor=t),this._headers||(this._headers=$te(e)),this.options.shape){case"object-row-table":const n=q4(e,this._headers);this.addObjectRow(n,t);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(U3),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,t){switch(Number.isFinite(t)&&(this.cursor=t),this._headers||(this._headers=Wte(e)),this.options.shape){case"array-row-table":const n=Z4(e,this._headers);this.addArrayRow(n,t);break;case"object-row-table":this.objectRows=this.objectRows||new Array(U3),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const Xte=100;class Kte{constructor(e,t){V(this,"schema");V(this,"length",0);V(this,"allocated",0);V(this,"columns",{});this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let t=0;for(const n in this.columns)this.columns[n][this.length]=e[t++];this.length++}addObjectRow(e){this._reallocateColumns();for(const t in e)this.columns[t][this.length]=e[t];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const n in this.schema){const i=this.schema[n];e[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:Xte,this.columns={};for(const e in this.schema){const t=this.schema[e],n=t.type||Float32Array,i=this.columns[t.index];if(i&&ArrayBuffer.isView(i)){const o=new n(this.allocated);o.set(i),this.columns[t.index]=o}else i?(i.length=this.allocated,this.columns[t.index]=i):this.columns[t.index]=new n(this.allocated)}}}_pruneColumns(){for(const[e,t]of Object.entries(this.columns))this.columns[e]=t.slice(0,this.length)}}const Yte={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},qte="TableBatchBuilder",ig=class ig{constructor(e,t){V(this,"schema");V(this,"options");V(this,"aggregator",null);V(this,"batchCount",0);V(this,"bytesUsed",0);V(this,"isChunkComplete",!1);V(this,"lastBatchEmittedMs",Date.now());V(this,"totalLength",0);V(this,"totalBytes",0);V(this,"rowBytes",0);this.schema=e,this.options={...Yte,...t}}limitReached(){var e,t;return!!((e=this.options)!=null&&e.limit&&this.totalLength>=this.options.limit||(t=this.options)!=null&&t._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const t=this.aggregator.getBatch();return t.count=this.batchCount,t.bytesUsed=this.bytesUsed,Object.assign(t,e),this.batchCount++,this.aggregator=null,t}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return Jte;case"columnar-table":return Kte;case"arrow-table":if(!ig.ArrowBatch)throw new Error(qte);return ig.ArrowBatch;default:return jte}}};V(ig,"ArrowBatch");let ux=ig;class z3 extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class Zte{constructor(){V(this,"_values");V(this,"_settlers");V(this,"_closed");this._values=new z3,this._settlers=new z3,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const t=this._settlers.dequeue();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,t)=>{this._settlers.enqueue({resolve:e,reject:t})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const G3="\uFEFF";function Qte(r,e={},t=tre){e=e||{};var n=e.dynamicTyping||!1;uc(n)&&(e.dynamicTypingFunction=n,n={}),e.dynamicTyping=n,e.transform=uc(e.transform)?e.transform:!1;var i=new t(e);return i.stream(r)}function ere(r,e){var t=!1,n=!0,i=",",o=`\r
`,s='"',c=s+s,f=!1,_=null;T();var b=new RegExp(dg(s),"g");if(typeof r=="string"&&(r=JSON.parse(r)),Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return S(null,r,f);if(typeof r[0]=="object")return S(_||Object.keys(r[0]),r,f)}else if(typeof r=="object")return typeof r.data=="string"&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:Object.keys(r.data[0])),!Array.isArray(r.data[0])&&typeof r.data[0]!="object"&&(r.data=[r.data])),S(r.fields||[],r.data||[],f);throw new Error("Unable to serialize unrecognized input");function T(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!Sa.BAD_DELIMITERS.filter(function(G){return e.delimiter.indexOf(G)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(t=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(f=e.skipEmptyLines),typeof e.newline=="string"&&(o=e.newline),typeof e.quoteChar=="string"&&(s=e.quoteChar),typeof e.header=="boolean"&&(n=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");_=e.columns}e.escapeChar!==void 0&&(c=e.escapeChar+s)}}function S(G,W,z){var j="";typeof G=="string"&&(G=JSON.parse(G)),typeof W=="string"&&(W=JSON.parse(W));var K=Array.isArray(G)&&G.length>0,fe=!Array.isArray(W[0]);if(K&&n){for(var Z=0;Z<G.length;Z++)Z>0&&(j+=i),j+=D(G[Z],Z);W.length>0&&(j+=o)}for(var ae=0;ae<W.length;ae++){var Be=K?G.length:W[ae].length,Le=!1,de=K?Object.keys(W[ae]).length===0:W[ae].length===0;if(z&&!K&&(Le=z==="greedy"?W[ae].join("").trim()==="":W[ae].length===1&&W[ae][0].length===0),z==="greedy"&&K){for(var _e=[],pe=0;pe<Be;pe++){var J=fe?G[pe]:pe;_e.push(W[ae][J])}Le=_e.join("").trim()===""}if(!Le){for(var ne=0;ne<Be;ne++){ne>0&&!de&&(j+=i);var ye=K&&fe?G[ne]:ne;j+=D(W[ae][ye],ne)}ae<W.length-1&&(!z||Be>0&&!de)&&(j+=o)}}return j}function D(G,W){if(typeof G>"u"||G===null)return"";if(G.constructor===Date)return JSON.stringify(G).slice(1,25);G=G.toString().replace(b,c);var z=typeof t=="boolean"&&t||Array.isArray(t)&&t[W]||N(G,Sa.BAD_DELIMITERS)||G.indexOf(i)>-1||G.charAt(0)===" "||G.charAt(G.length-1)===" ";return z?s+G+s:G}function N(G,W){for(var z=0;z<W.length;z++)if(G.indexOf(W[z])>-1)return!0;return!1}}let Q4=class{constructor(e){V(this,"_handle");V(this,"_config");V(this,"_finished",!1);V(this,"_completed",!1);V(this,"_input",null);V(this,"_baseIndex",0);V(this,"_partialLine","");V(this,"_rowCount",0);V(this,"_start",0);V(this,"isFirstChunk",!0);V(this,"_completeResults",{data:[],errors:[],meta:{}});var t={...e};t.chunkSize=parseInt(t.chunkSize),!e.step&&!e.chunk&&(t.chunkSize=null),this._handle=new eL(t),this._handle.streamer=this,this._config=t}parseChunk(e,t){if(this.isFirstChunk&&uc(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(e);n!==void 0&&(e=n)}this.isFirstChunk=!1;var i=this._partialLine+e;this._partialLine="";var o=this._handle.parse(i,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var s=o.meta.cursor;this._finished||(this._partialLine=i.substring(s-this._baseIndex),this._baseIndex=s),o&&o.data&&(this._rowCount+=o.data.length);var c=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(uc(this._config.chunk)&&!t){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!this._completed&&c&&uc(this._config.complete)&&(!o||!o.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),o}}_sendError(e){uc(this._config.error)&&this._config.error(e)}};class tre extends Q4{constructor(t={}){super(t);V(this,"remaining")}stream(t){return this.remaining=t,this._nextChunk()}_nextChunk(){if(!this._finished){var t=this._config.chunkSize,n=t?this.remaining.substr(0,t):this.remaining;return this.remaining=t?this.remaining.substr(t):"",this._finished=!this.remaining,this.parseChunk(n)}}}const rre=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,nre=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class eL{constructor(e){V(this,"_config");V(this,"_stepCounter",0);V(this,"_rowCounter",0);V(this,"_input");V(this,"_parser");V(this,"_paused",!1);V(this,"_aborted",!1);V(this,"_delimiterError",!1);V(this,"_fields",[]);V(this,"_results",{data:[],errors:[],meta:{}});if(uc(e.step)){var t=e.step;e.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,e.preview&&this._stepCounter>e.preview?this._parser.abort():t(this._results,this)}}}this._config=e}parse(e,t,n){var i=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=ire(e,i)),this._delimiterError=!1,this._config.delimiter)uc(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(e),this._results.meta.delimiter=this._config.delimiter);else{var o=this.guessDelimiter(e,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);o.successful?this._config.delimiter=o.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=Sa.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var s=tL(this._config);return this._config.preview&&this._config.header&&s.preview++,this._input=e,this._parser=new fx(s),this._results=this._parser.parse(this._input,t,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,uc(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(e){return this._config.skipEmptyLines==="greedy"?e.join("").trim()==="":e.length===1&&e[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Sa.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var e=0;e<this._results.data.length;e++)this.testEmptyLine(this._results.data[e])&&this._results.data.splice(e--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const e=n=>{uc(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var t=0;this.needsHeaderRow()&&t<this._results.data.length;t++)this._results.data[t].forEach(e);this._results.data.splice(0,1)}else this._results.data.forEach(e)}shouldApplyDynamicTyping(e){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[e]===void 0&&(this._config.dynamicTyping[e]=this._config.dynamicTypingFunction(e)),(this._config.dynamicTyping[e]||this._config.dynamicTyping)===!0}parseDynamic(e,t){return this.shouldApplyDynamicTyping(e)?t==="true"||t==="TRUE"?!0:t==="false"||t==="FALSE"?!1:rre.test(t)?parseFloat(t):nre.test(t)?new Date(t):t===""?null:t:t}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var e=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),e=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=e,this._results}processRow(e,t){var n=this._config.header?{}:[],i;for(i=0;i<e.length;i++){var o=i,s=e[i];this._config.header&&(o=i>=this._fields.length?"__parsed_extra":this._fields[i]),this._config.transform&&(s=this._config.transform(s,o)),s=this.parseDynamic(o,s),o==="__parsed_extra"?(n[o]=n[o]||[],n[o].push(s)):n[o]=s}return this._config.header&&(i>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+t):i<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+t)),n}guessDelimiter(e,t,n,i,o){var s,c,f;o=o||[",","	","|",";",Sa.RECORD_SEP,Sa.UNIT_SEP];for(var _=0;_<o.length;_++){var b=o[_],T=0,S=0,D=0;f=void 0;for(var N=new fx({comments:i,delimiter:b,newline:t,preview:10}).parse(e),G=0;G<N.data.length;G++){if(n&&this.testEmptyLine(N.data[G])){D++;continue}var W=N.data[G].length;if(S+=W,typeof f>"u"){f=0;continue}else W>1&&(T+=Math.abs(W-f),f=W)}N.data.length>0&&(S/=N.data.length-D),(typeof c>"u"||T>c)&&S>1.99&&(c=T,s=b)}return this._config.delimiter=s,{successful:!!s,bestDelimiter:s}}addError(e,t,n,i){this._results.errors.push({type:e,code:t,message:n,row:i})}}function ire(r,e){r=r.substr(0,1024*1024);var t=new RegExp(dg(e)+"([^]*?)"+dg(e),"gm");r=r.replace(t,"");var n=r.split("\r"),i=r.split(`
`),o=i.length>1&&i[0].length<n[0].length;if(n.length===1||o)return`
`;for(var s=0,c=0;c<n.length;c++)n[c][0]===`
`&&s++;return s>=n.length/2?`\r
`:"\r"}function dg(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function fx(r){r=r||{};var e=r.delimiter,t=r.newline,n=r.comments,i=r.step,o=r.preview,s=r.fastMode,c;r.quoteChar===void 0?c='"':c=r.quoteChar;var f=c;if(r.escapeChar!==void 0&&(f=r.escapeChar),(typeof e!="string"||Sa.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||Sa.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),t!==`
`&&t!=="\r"&&t!==`\r
`&&(t=`
`);var _=0,b=!1;this.parse=function(T,S,D){if(typeof T!="string")throw new Error("Input must be a string");var N=T.length,G=e.length,W=t.length,z=n.length,j=uc(i);_=0;var K=[],fe=[],Z=[],ae=0;if(!T)return tt();if(s||s!==!1&&T.indexOf(c)===-1){for(var Be=T.split(t),Le=0;Le<Be.length;Le++){const mt=Be[Le];if(_+=mt.length,Le!==Be.length-1)_+=t.length;else if(D)return tt();if(!(n&&mt.substr(0,z)===n)){if(j){if(K=[],Ne(mt.split(e)),lt(),b)return tt()}else Ne(mt.split(e));if(o&&Le>=o)return K=K.slice(0,o),tt(!0)}}return tt()}for(var de=T.indexOf(e,_),_e=T.indexOf(t,_),pe=new RegExp(dg(f)+dg(c),"g"),J;;){if(T[_]===c){for(J=_,_++;;){if(J=T.indexOf(c,J+1),J===-1)return D||fe.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:_}),Qe();if(J===N-1){var ne=T.substring(_,J).replace(pe,c);return Qe(ne)}if(c===f&&T[J+1]===f){J++;continue}if(!(c!==f&&J!==0&&T[J-1]===f)){var ye=_e===-1?de:Math.min(de,_e),Ye=Ge(ye);if(T[J+1+Ye]===e){if(Z.push(T.substring(_,J).replace(pe,c)),_=J+1+Ye+G,de=T.indexOf(e,_),_e=T.indexOf(t,_),j&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);break}var we=Ge(_e);if(T.substr(J+1+we,W)===t){if(Z.push(T.substring(_,J).replace(pe,c)),rt(J+1+we+W),de=T.indexOf(e,_),j&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);break}fe.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:_}),J++}}if(j&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);continue}if(n&&Z.length===0&&T.substr(_,z)===n){if(_e===-1)return tt();_=_e+W,_e=T.indexOf(t,_),de=T.indexOf(e,_);continue}if(de!==-1&&(de<_e||_e===-1)){Z.push(T.substring(_,de)),_=de+G,de=T.indexOf(e,_);continue}if(_e!==-1){if(Z.push(T.substring(_,_e)),rt(_e+W),j&&(lt(),b))return tt();if(o&&K.length>=o)return tt(!0);continue}break}return Qe();function Ne(mt){K.push(mt),ae=_}function Ge(mt){var Tt=0;if(mt!==-1){var nt=T.substring(J+1,mt);nt&&nt.trim()===""&&(Tt=nt.length)}return Tt}function Qe(mt){return D||(typeof mt>"u"&&(mt=T.substr(_)),Z.push(mt),_=N,Ne(Z),j&&lt()),tt()}function rt(mt){_=mt,Ne(Z),Z=[],_e=T.indexOf(t,_)}function tt(mt,Tt){var nt=Tt||!1;return{data:nt?K[0]:K,errors:fe,meta:{delimiter:e,linebreak:t,aborted:b,truncated:!!mt,cursor:ae+(S||0)}}}function lt(){i(tt(void 0,!0)),K=[],fe=[]}},this.abort=function(){b=!0},this.getCharIndex=function(){return _}}function tL(r){if(typeof r!="object"||r===null)return r;var e=Array.isArray(r)?[]:{};for(var t in r)e[t]=tL(r[t]);return e}function uc(r){return typeof r=="function"}const Sa={parse:Qte,unparse:ere,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:G3,BAD_DELIMITERS:["\r",`
`,'"',G3],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:fx,ParserHandle:eL,ChunkStreamer:Q4},{ChunkStreamer:sre}=Sa;class ore extends sre{constructor(t={}){super(t);V(this,"textDecoder",new TextDecoder(this._config.encoding))}async stream(t){this._input=t;try{for await(const n of t)this.parseChunk(this.getStringChunk(n));this._finished=!0,this.parseChunk("")}catch(n){this._sendError(n)}}_nextChunk(){}getStringChunk(t){return typeof t=="string"?t:this.textDecoder.decode(t,{stream:!0})}}const are="4.3.2",Zw="object-row-table",Qw={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:are,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(r,e)=>V3(new TextDecoder().decode(r),e),parseText:(r,e)=>V3(r,e),parseInBatches:cre,options:{csv:{shape:Zw,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function V3(r,e){const t={...Qw.options.csv,...e==null?void 0:e.csv},n=lre(r),o=t.header==="auto"?rL(n):!!t.header,s={...t,header:o,download:!1,transformHeader:o?nL():void 0,error:T=>{throw new Error(T)}},c=Sa.parse(r,s),f=c.data,_=c.meta.fields||iL(t.columnPrefix,n.length),b=t.shape||Zw;switch(b){case"object-row-table":return{shape:"object-row-table",data:f.map(T=>Array.isArray(T)?q4(T,_):T)};case"array-row-table":return{shape:"array-row-table",data:f.map(T=>Array.isArray(T)?T:Z4(T,_))};default:throw new Error(b)}}function cre(r,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const t={...Qw.options.csv,...e==null?void 0:e.csv},n=new Zte;let i=!0,o=null,s=null,c=null;const f={...t,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(_){let b=_.data;if(t.skipEmptyLines&&b.flat().join("").trim()==="")return;const T=_.meta.cursor;if(i&&!o&&(t.header==="auto"?rL(b):!!t.header)){o=b.map(nL());return}i&&(i=!1,o||(o=iL(t.columnPrefix,b.length)),c=ure(b,o)),t.optimizeMemoryUsage&&(b=JSON.parse(JSON.stringify(b)));const S=t.shape||Zw;s=s||new ux(c,{shape:S,...e});try{s.addRow(b);const D=s&&s.getFullBatch({bytesUsed:T});D&&n.enqueue(D)}catch(D){n.enqueue(D)}},complete(_){try{const b=_.meta.cursor,T=s&&s.getFinalBatch({bytesUsed:b});T&&n.enqueue(T)}catch(b){n.enqueue(b)}n.close()}};return Sa.parse(r,f,ore),n}function rL(r){return r&&r.every(e=>typeof e=="string")}function lre(r){return Sa.parse(r,{dynamicTyping:!0,preview:1}).data[0]}function nL(){const r=new Set;return e=>{let t=e,n=1;for(;r.has(t);)t=`${e}.${n}`,n++;return r.add(t),t}}function iL(r,e=0){const t=[];for(let n=0;n<e;n++)t.push(`${r}${n+1}`);return t}function ure(r,e){const t=e?{}:[];for(let n=0;n<r.length;n++){const i=e&&e[n]||n;switch(typeof r[n]){case"number":case"boolean":t[i]={name:String(i),index:n,type:Float32Array};break;case"string":default:t[i]={name:String(i),index:n,type:Array}}}return t}const fre="4.3.2";async function sL(r,e,t,n){return n._parse(r,e,t,n)}function eh(r,e){if(!r)throw new Error("loader assertion failed.")}const oL=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),H3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);H3&&parseFloat(H3[1]);const $0=globalThis,yd=globalThis.process||{};function hre(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function eC(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||hre()}const aL="4.0.7";function dre(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class Are{constructor(e,t,n="sessionStorage"){this.storage=dre(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function pre(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function gre(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var y_;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(y_||(y_={}));const mre=10;function j3(r){return typeof r!="string"?r:(r=r.toUpperCase(),y_[r]||y_.WHITE)}function _re(r,e,t){return!eC&&typeof r=="string"&&(e&&(r=`\x1B[${j3(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${j3(t)+mre}m${r}\x1B[49m`)),r}function yre(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(c=>o===c)||(i[o]=s.bind(r)))}}function tC(r,e){if(!r)throw new Error("Assertion failed")}function vd(){var e,t,n;let r;if(eC()&&$0.performance)r=(t=(e=$0==null?void 0:$0.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in yd){const i=(n=yd==null?void 0:yd.hrtime)==null?void 0:n.call(yd);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const bd={debug:eC()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},vre={enabled:!0,level:0};function xd(){}const $3={},W3={once:!0};class vy{constructor({id:e}={id:""}){this.VERSION=aL,this._startTs=vd(),this._deltaTs=vd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Are(`__probe-${this.id}__`,vre),this.timeStamp(`${this.id} started`),yre(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((vd()-this._startTs).toPrecision(10))}getDelta(){return Number((vd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,bd.warn,arguments,W3)}error(e){return this._getLogFunction(0,e,bd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,bd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,bd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,bd.debug||bd.info,arguments,W3)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||xd,n&&[n],{tag:xre(t)}):xd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||xd)}group(e,t,n={collapsed:!1}){const i=J3({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||xd)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=cL(e)}_getLogFunction(e,t,n,i,o){if(this._shouldLog(e)){o=J3({logLevel:e,message:t,args:i,opts:o}),n=n||o.method,tC(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=vd();const s=o.tag||o.message;if(o.once&&s)if(!$3[s])$3[s]=vd();else return xd;return t=bre(this.id,o.message,o),n.bind(console,t,...o.args)}return xd}}vy.VERSION=aL;function cL(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return tC(Number.isFinite(e)&&e>=0),e}function J3(r){const{logLevel:e,message:t}=r;r.logLevel=cL(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return tC(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function bre(r,e,t){if(typeof e=="string"){const n=t.time?gre(pre(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=_re(e,t.color,t.background)}return e}function xre(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}globalThis.probe={};const lL=new vy({id:"@probe.gl/log"});function wre(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function Cre(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}function Ere(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Tre=Ere();function Bre(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const Tg=typeof process!="object"||String(process)!=="[object process]"||process.browser,rC=typeof importScripts=="function",X3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);X3&&parseFloat(X3[1]);const Eb={};async function Yf(r,e=null,t={},n=null){return e&&(r=Sre(r,e,t,n)),Eb[r]=Eb[r]||Ire(r),await Eb[r]}function Sre(r,e,t={},n=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:Tg?t.CDN?(Bre(t.CDN.startsWith("http")),`${t.CDN}/${e}@${Tre}/dist/libs/${n}`):rC?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function Ire(r){if(r.endsWith("wasm"))return await Pre(r);if(!Tg)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(rC)return importScripts(r);const e=await Rre(r);return Mre(e,r)}function Mre(r,e){if(!Tg){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(rC)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function Pre(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Tg||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function Rre(r){const{readFileAsText:e}=globalThis.loaders||{};return Tg||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function Fre(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?K3(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?K3(r,0,e):""}function K3(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function Ore(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${Fre(r)}"`)}}function uL(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function Bg(r,e){return eh(r>=0),eh(e>0),r+(e-1)&-4}function Dre(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,o=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,o)}return e.set(n,t),t+Bg(n.byteLength,4)}function Y3(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class q3{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Y3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Y3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class fL{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof q3?i=e:i=new q3(t,n),this.stats[t]=i),i}}var GO;const Lre=(GO=globalThis.loaders)==null?void 0:GO.parseImageNode,hx=typeof Image<"u",dx=typeof ImageBitmap<"u",kre=!!Lre,Ax=oL?!0:kre;function Nre(r){switch(r){case"auto":return dx||hx||Ax;case"imagebitmap":return dx;case"image":return hx;case"data":return Ax;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function Ure(){if(dx)return"imagebitmap";if(hx)return"image";if(Ax)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function zre(r){const e=Gre(r);if(!e)throw new Error("Not an image");return e}function hL(r){switch(zre(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function Gre(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const Vre=/^data:image\/svg\+xml/,Hre=/\.svg((\?|#).*)?$/;function nC(r){return r&&(Vre.test(r)||Hre.test(r))}function jre(r,e){if(nC(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return dL(r,e)}function dL(r,e){if(nC(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function AL(r,e,t){const n=jre(r,t),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await $re(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function $re(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const Wre={};let Z3=!0;async function Jre(r,e,t){let n;nC(t)?n=await AL(r,e,t):n=dL(r,t);const i=e&&e.imagebitmap;return await Xre(n,i)}async function Xre(r,e=null){if((Kre(e)||!Z3)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),Z3=!1}return await createImageBitmap(r)}function Kre(r){for(const e in r||Wre)return!1;return!0}function Yre(r){return!ene(r,"ftyp",4)||(r[8]&96)===0?null:qre(r)}function qre(r){switch(Zre(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Zre(r,e,t){return String.fromCharCode(...r.slice(e,t))}function Qre(r){return[...r].map(e=>e.charCodeAt(0))}function ene(r,e,t=0){const n=Qre(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Kc=!1,Yp=!0;function iC(r){const e=Sg(r);return rne(e)||sne(e)||nne(e)||ine(e)||tne(e)}function tne(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=Yre(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function rne(r){const e=Sg(r);return e.byteLength>=24&&e.getUint32(0,Kc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Kc),height:e.getUint32(20,Kc)}:null}function nne(r){const e=Sg(r);return e.byteLength>=10&&e.getUint32(0,Kc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Yp),height:e.getUint16(8,Yp)}:null}function ine(r){const e=Sg(r);return e.byteLength>=14&&e.getUint16(0,Kc)===16973&&e.getUint32(2,Yp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Yp),height:e.getUint32(22,Yp)}:null}function sne(r){const e=Sg(r);if(!(e.byteLength>=3&&e.getUint16(0,Kc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=one();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,Kc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Kc),width:e.getUint16(o+7,Kc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,Kc)}return null}function one(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Sg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function ane(r,e){var i;const{mimeType:t}=iC(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return eh(n),await n(r,t)}async function cne(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},s=lne(i);let c;switch(s){case"imagebitmap":c=await Jre(r,e,o);break;case"image":c=await AL(r,e,o);break;case"data":c=await ane(r);break;default:eh(!1)}return i==="data"&&(c=hL(c)),c}function lne(r){switch(r){case"auto":case"data":return Ure();default:return Nre(r),r}}const une=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],fne=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],hne={image:{type:"auto",decode:!0}},dne={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:fre,mimeTypes:fne,extensions:une,parse:cne,tests:[r=>!!iC(new DataView(r))],options:hne},Tb={};function Ane(r){if(Tb[r]===void 0){const e=oL?gne(r):pne(r);Tb[r]=e}return Tb[r]}function pne(r){var i,o;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((o=globalThis.loaders)==null?void 0:o.parseImageNode)&&t.includes(r)}function gne(r){switch(r){case"image/avif":case"image/webp":return mne(r);default:return!0}}function mne(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}function Ia(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const pL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gL={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Q3=["SCALAR","VEC2","VEC3","VEC4"],_ne=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],yne=new Map(_ne),vne={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bne={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},xne={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function mL(r){return Q3[r-1]||Q3[0]}function by(r){const e=yne.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function _L(r,e){const t=xne[r.componentType],n=vne[r.type],i=bne[r.componentType],o=r.count*n,s=r.count*n*i;Ia(s>=0&&s<=e.byteLength);const c=gL[r.componentType],f=pL[r.type];return{ArrayType:t,length:o,byteLength:s,componentByteSize:c,numberOfComponentsInElement:f}}function wne(r,e,t){const n=r.bufferViews[t];Ia(n);const i=n.buffer,o=e[i];Ia(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function Cne(r,e,t){var G,W;const n=typeof t=="number"?(G=r.accessors)==null?void 0:G[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(W=r.bufferViews)==null?void 0:W[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],c=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:f,length:_,componentByteSize:b,numberOfComponentsInElement:T}=_L(n,i),S=b*T,D=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new f(o,c,_);const N=new f(_);for(let z=0;z<n.count;z++){const j=new f(o,c+z*D,T);N.set(j,z*T)}return N}function Ene(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let Ms=class{constructor(e){V(this,"gltf");V(this,"sourceBuffers");V(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||Ene(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Ia(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return Cne(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(i,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return Ia(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Ia(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(n){const f=this._addIndices(n);c.primitives[0].indices=f}return Number.isFinite(i)&&(c.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=iC(e),i=t||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;Ia(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Bg(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:mL(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:by(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const c of this.sourceBuffers||[])i=Dre(c,n,i);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[o]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const o of i)n.min.push(o),n.max.push(o);for(let o=t;o<e.length;o+=t)for(let s=0;s<t;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}};function eM(r){return(r%1+1)%1}const yL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Tne={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},vL={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function sC(r,e){return vL[e]*yL[r]}function xy(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),o=wy(i,"SCALAR",t,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function wy(r,e,t,n=1){const i=yL[e],o=Tne[t],s=vL[t],c=n*i,f=c*s;let _=r.buffer,b=r.byteOffset;return b%s!==0&&(_=new Uint8Array(_).slice(b,b+f).buffer,b=0),new o(_,b,c)}function oC(r,e,t){var _,b,T,S,D;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],o=r.getTypedArrayForAccessor(i),s=r.gltf.json,c=e.index,f=(b=(_=s.textures)==null?void 0:_[c])==null?void 0:b.source;if(typeof f<"u"){const N=(S=(T=s.images)==null?void 0:T[f])==null?void 0:S.mimeType,G=(D=r.gltf.images)==null?void 0:D[f];if(G&&typeof G.width<"u"){const W=[];for(let z=0;z<o.length;z+=2){const j=Bne(G,N,o,z,e.channels);W.push(j)}return W}}return[]}function bL(r,e,t,n,i){if(!(t!=null&&t.length))return;const o=[];for(const b of t){let T=n.findIndex(S=>S===b);T===-1&&(T=n.push(b)-1),o.push(T)}const s=new Uint32Array(o),c=r.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,f=r.addBufferView(s,c,0),_=r.addAccessor(f,{size:1,componentType:by(s),count:s.length});i.attributes[e]=_}function Bne(r,e,t,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=t[n],c=t[n+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const _=Sne(s,c,r,f);let b=0;for(const T of i){const S=typeof T=="number"?Object.values(o)[T]:o[T],D=_+S.offset,N=hL(r);if(N.data.length<=D)throw new Error(`${N.data.length} <= ${D}`);const G=N.data[D];b|=G<<S.shift}return b}function Sne(r,e,t,n=1){const i=t.width,o=eM(r)*(i-1),s=Math.round(o),c=t.height,f=eM(e)*(c-1),_=Math.round(f),b=t.components?t.components:n;return(_*i+s)*b}function xL(r,e,t,n,i){const o=[];for(let s=0;s<e;s++){const c=t[s],f=t[s+1]-t[s];if(f+c>n)break;const _=c/i,b=f/i;o.push(r.slice(_,_+b))}return o}function wL(r,e,t){const n=[];for(let i=0;i<e;i++){const o=i*t;n.push(r.slice(o,o+t))}return n}function CL(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let c=0;c<r;c++){const f=n[c+1]-n[c];if(f+s<=e.length){const _=e.subarray(s,f+s),b=o.decode(_);i.push(b),s+=f}}return i}return[]}const uA="EXT_mesh_features",Ine=uA;async function Mne(r,e){const t=new Ms(r);Rne(t,e)}function Pne(r,e){const t=new Ms(r);return One(t),t.createBinaryChunk(),t.gltf}function Rne(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)Fne(r,i,e)}function Fne(r,e,t){var o,s,c;if(!((o=t==null?void 0:t.gltf)!=null&&o.loadBuffers))return;const n=(s=e.extensions)==null?void 0:s[uA],i=n==null?void 0:n.featureIds;if(i)for(const f of i){let _;if(typeof f.attribute<"u"){const b=`_FEATURE_ID_${f.attribute}`,T=e.attributes[b];_=r.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&((c=t==null?void 0:t.gltf)!=null&&c.loadImages)?_=oC(r,f.texture,e):_=[];f.data=_}}function One(r,e){const t=r.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)Lne(r,i)}function Dne(r,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[uA];i||(i={featureIds:[]},e.extensions[uA]=i);const{featureIds:o}=i,s={featureCount:t.length,propertyTable:n,data:t};o.push(s),r.addObjectExtension(e,uA,i)}function Lne(r,e){var i;const t=(i=e.extensions)==null?void 0:i[uA];if(!t)return;const n=t.featureIds;n.forEach((o,s)=>{if(o.data){const{accessorKey:c,index:f}=kne(e.attributes),_=new Uint32Array(o.data);n[s]={featureCount:_.length,propertyTable:o.propertyTable,attribute:f},r.gltf.buffers.push({arrayBuffer:_.buffer,byteOffset:_.byteOffset,byteLength:_.byteLength});const b=r.addBufferView(_),T=r.addAccessor(b,{size:1,componentType:by(_),count:_.length});e.attributes[c]=T}})}function kne(r){const e="_FEATURE_ID_",t=Object.keys(r).filter(o=>o.indexOf(e)===0);let n=-1;for(const o of t){const s=Number(o.substring(e.length));s>n&&(n=s)}return n++,{accessorKey:`${e}${n}`,index:n}}const Nne=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Dne,decode:Mne,encode:Pne,name:Ine},Symbol.toStringTag,{value:"Module"})),CA="EXT_structural_metadata",Une=CA;async function zne(r,e){const t=new Ms(r);Vne(t,e)}function Gne(r,e){const t=new Ms(r);return iie(t),t.createBinaryChunk(),t.gltf}function Vne(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(CA);t&&((i=e.gltf)!=null&&i.loadImages&&Hne(r,t),jne(r,t))}function Hne(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)Wne(r,t,o,e)}function jne(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=$ne(i,o);s&&Xne(r,t,s)}}function $ne(r,e){for(const t of r)if(t.class===e)return t;return null}function Wne(r,e,t,n){var s;if(!e)return;const i=(s=t.extensions)==null?void 0:s[CA],o=i==null?void 0:i.propertyTextures;if(o)for(const c of o){const f=e[c];Jne(r,f,t,n)}}function Jne(r,e,t,n){var o;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const c=`${i}_${s}`,f=(o=e.properties)==null?void 0:o[s];if(!f)continue;f.data||(f.data=[]);const _=f.data,b=oC(r,f,t);b!==null&&(bL(r,c,b,_,t),f.data=_,n.dataAttributeNames.push(c))}}function Xne(r,e,t){var o,s;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],_=(s=t.properties)==null?void 0:s[c];if(_){const b=Kne(r,e,f,i,_);_.data=b}}}function Kne(r,e,t,n,i){let o=[];const s=i.values,c=r.getTypedArrayForBufferView(s),f=Yne(r,t,i,n),_=qne(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=Zne(t,n,c,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=CL(n,c,f,_);break}case"ENUM":{o=Qne(e,t,n,c,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function Yne(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?xy(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function qne(r,e,t){return typeof e.stringOffsets<"u"?xy(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function Zne(r,e,t,n){const i=r.array,o=r.count,s=sC(r.type,r.componentType),c=t.byteLength/s;let f;return r.componentType?f=wy(t,r.type,r.componentType,c):f=t,i?n?xL(f,e,n,t.length,s):o?wL(f,e,o):[]:f}function Qne(r,e,t,n,i){var T;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(T=r.enums)==null?void 0:T[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=s.valueType||"UINT16",f=sC(e.type,c),_=n.byteLength/f;let b=wy(n,e.type,c,_);if(b||(b=n),e.array){if(i)return eie({valuesData:b,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:f,enumEntry:s});const S=e.count;return S?tie(b,t,S,s):[]}return aC(b,0,t,s)}function eie(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=r,c=[];for(let f=0;f<t;f++){const _=n[f],b=n[f+1]-n[f];if(b+_>i)break;const T=_/o,S=b/o,D=aC(e,T,S,s);c.push(D)}return c}function tie(r,e,t,n){const i=[];for(let o=0;o<e;o++){const s=t*o,c=aC(r,s,t,n);i.push(c)}return i}function aC(r,e,t,n){const i=[];for(let o=0;o<t;o++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const s=r[e+o],c=rie(n,s);c?i.push(c.name):i.push("")}return i}function rie(r,e){for(const t of r.values)if(t.value===e)return t;return null}const nie="schemaClassId";function iie(r,e){var n,i;const t=r.getExtension(CA);if(t&&t.propertyTables)for(const o of t.propertyTables){const s=o.class,c=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[s];o.properties&&c&&sie(o,c,r)}}function sie(r,e,t){for(const n in r.properties){const i=r.properties[n].data;if(i){const o=e.properties[n];if(o){const s=lie(i,o,t);r.properties[n]=s}}}}function oie(r,e,t=nie){let n=r.getExtension(CA);n||(n=r.addExtension(CA)),n.schema=aie(e,t,n.schema);const i=cie(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function aie(r,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const o of r){const s={type:o.elementType,componentType:o.componentType};i.properties[o.name]=s}return n.classes={},n.classes[e]=i,n}function cie(r,e,t){var s;const n={class:e,count:0};let i=0;const o=(s=t.classes)==null?void 0:s[e];for(const c of r){if(i===0&&(i=c.values.length),i!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");(o==null?void 0:o.properties[c.name])&&(n.properties||(n.properties={}),n.properties[c.name]={values:0,data:c.values})}return n.count=i,n}function lie(r,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:o}=hie(r);n.stringOffsets=Bb(o,t),n.values=Bb(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=fie(r,e.componentType);n.values=Bb(i,t)}return n}const uie={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function fie(r,e){const t=[];for(const i of r)t.push(Number(i));const n=uie[e];if(!n)throw new Error("Illegal component type");return new n(t)}function hie(r){const e=new TextEncoder,t=[];let n=0;for(const f of r){const _=e.encode(f);n+=_.length,t.push(_)}const i=new Uint8Array(n),o=[];let s=0;for(const f of t)i.set(f,s),o.push(s),s+=f.length;o.push(s);const c=new Uint32Array(o);return{stringData:i,stringOffsets:c}}function Bb(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}const die=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:oie,decode:zne,encode:Gne,name:Une},Symbol.toStringTag,{value:"Module"})),EL="EXT_feature_metadata",Aie=EL;async function pie(r,e){const t=new Ms(r);gie(t,e)}function gie(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(EL);t&&((i=e.gltf)!=null&&i.loadImages&&mie(r,t),_ie(r,t))}function mie(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],c=vie(i,o);c&&xie(r,c,s)}}function _ie(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=yie(i,o);s&&bie(r,t,s)}}function yie(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function vie(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function bie(r,e,t){var o,s;if(!t.class)return;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],_=(s=t.properties)==null?void 0:s[c];if(_){const b=wie(r,e,f,i,_);_.data=b}}}function xie(r,e,t){var i;const n=e.class;for(const o in t.properties){const s=(i=e==null?void 0:e.properties)==null?void 0:i[o];if(s){const c=Sie(r,s,n);s.data=c}}}function wie(r,e,t,n,i){let o=[];const s=i.bufferView,c=r.getTypedArrayForBufferView(s),f=Cie(r,t,i,n),_=Eie(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?o=CL(n,c,f,_):Tie(t)&&(o=Bie(t,n,c,f)),o}function Cie(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?xy(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Eie(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?xy(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Tie(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function Bie(r,e,t,n){const i=r.type==="ARRAY",o=r.componentCount,s="SCALAR",c=r.componentType||r.type,f=sC(s,c),_=t.byteLength/f,b=wy(t,s,c,_);return i?n?xL(b,e,n,t.length,f):o?wL(b,e,o):[]:b}function Sie(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)Iie(r,t,e,i,s);return i}function Iie(r,e,t,n,i){const o={channels:t.channels,...t.texture},s=oC(r,o,i);s&&bL(r,e,s,n,i)}const Mie=Object.freeze(Object.defineProperty({__proto__:null,decode:pie,name:Aie},Symbol.toStringTag,{value:"Module"})),Pie="4.3.2",Rie="4.3.2",v_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let tM;async function rM(r){wre(r.modules);const e=Cre("basis");return e||(tM||(tM=Fie(r)),await tM)}async function Fie(r){let e=null,t=null;return[e,t]=await Promise.all([await Yf(v_.TRANSCODER,"textures",r),await Yf(v_.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await Oie(e,t)}function Oie(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let Sb;async function nM(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(Sb=Sb||Die(r),await Sb)}async function Die(r){let e=null,t=null;return[e,t]=await Promise.all([await Yf(v_.ENCODER,"textures",r),await Yf(v_.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await Lie(e,t)}function Lie(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:c,BasisEncoder:f}=i;c(),n({BasisFile:o,KTX2File:s,BasisEncoder:f})})})}const wd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},kie=["","WEBKIT_","MOZ_"],iM={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let W0=null;function Nie(r){if(!W0){r=r||Uie()||void 0,W0=new Set;for(const e of kie)for(const t in iM)if(r&&r.getExtension(`${e}${t}`)){const n=iM[t];W0.add(n)}}return W0}function Uie(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const ea=[171,75,84,88,32,50,48,187,13,10,26,10];function zie(r){const e=new Uint8Array(r);return!(e.byteLength<ea.length||e[0]!==ea[0]||e[1]!==ea[1]||e[2]!==ea[2]||e[3]!==ea[3]||e[4]!==ea[4]||e[5]!==ea[5]||e[6]!==ea[6]||e[7]!==ea[7]||e[8]!==ea[8]||e[9]!==ea[9]||e[10]!==ea[10]||e[11]!==ea[11])}const Gie={etc1:{basisFormat:0,compressed:!0,format:wd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:wd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:wd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:wd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:wd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:wd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Vie(r,e){if(e.basis.containerFormat==="auto"){if(zie(r)){const n=await nM(e);return sM(n.KTX2File,r,e)}const{BasisFile:t}=await rM(e);return Ib(t,r,e)}switch(e.basis.module){case"encoder":const t=await nM(e);switch(e.basis.containerFormat){case"ktx2":return sM(t.KTX2File,r,e);case"basis":default:return Ib(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await rM(e);return Ib(n,r,e)}}function Ib(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const c=n.getNumLevels(s),f=[];for(let _=0;_<c;_++)f.push(Hie(n,s,_,t));o.push(f)}return o}finally{n.close(),n.delete()}}function Hie(r,e,t,n){const i=r.getImageWidth(e,t),o=r.getImageHeight(e,t),s=r.getHasAlpha(),{compressed:c,format:f,basisFormat:_}=TL(n,s),b=r.getImageTranscodedSizeInBytes(e,t,_),T=new Uint8Array(b);if(!r.transcodeImage(T,e,t,_,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:T,compressed:c,format:f,hasAlpha:s}}function sM(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++)o.push(jie(n,s,t));return[o]}finally{n.close(),n.delete()}}function jie(r,e,t){const{alphaFlag:n,height:i,width:o}=r.getImageLevelInfo(e,0,0),{compressed:s,format:c,basisFormat:f}=TL(t,n),_=r.getImageTranscodedSizeInBytes(e,0,0,f),b=new Uint8Array(_);if(!r.transcodeImage(b,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:b,compressed:s,levelSize:_,hasAlpha:n,format:c}}function TL(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=BL()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),Gie[t]}function BL(){const r=Nie();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const $ie={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Rie,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Wie={...$ie,parse:Vie},EA=!0,oM=1735152710,cC=12,b_=8,Jie=1313821514,Xie=5130562,Kie=0,Yie=0,qie=1;function Zie(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function Qie(r,e=0,t={}){const n=new DataView(r),{magic:i=oM}=t,o=n.getUint32(e,!1);return o===i||o===oM}function ese(r,e,t=0,n={}){const i=new DataView(e),o=Zie(i,t+0),s=i.getUint32(t+4,EA),c=i.getUint32(t+8,EA);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),t+=cC,r.version){case 1:return tse(r,i,t);case 2:return rse(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function tse(r,e,t){eh(r.header.byteLength>cC+b_);const n=e.getUint32(t+0,EA),i=e.getUint32(t+4,EA);return t+=b_,eh(i===Kie),px(r,e,t,n),t+=n,t+=gx(r,e,t,r.header.byteLength),t}function rse(r,e,t,n){return eh(r.header.byteLength>cC+b_),nse(r,e,t,n),t+r.header.byteLength}function nse(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,EA),o=e.getUint32(t+4,EA);switch(t+=b_,o){case Jie:px(r,e,t,i);break;case Xie:gx(r,e,t,i);break;case Yie:n.strict||px(r,e,t,i);break;case qie:n.strict||gx(r,e,t,i);break}t+=Bg(i,4)}return t}function px(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),s=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(s),Bg(n,4)}function gx(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Bg(n,4)}function SL(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const ise="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",sse="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",ose=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),ase=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),cse={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},lse={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function use(r,e,t,n,i,o="NONE"){const s=await fse();Ase(s,s.exports[lse[i]],r,e,t,n,s.exports[cse[o||"NONE"]])}let Mb;async function fse(){return Mb||(Mb=hse()),Mb}async function hse(){let r=ise;WebAssembly.validate(ose)&&(r=sse,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(dse(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function dse(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?ase[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function Ase(r,e,t,n,i,o,s){const c=r.exports.sbrk,f=n+3&-4,_=c(f*i),b=c(o.length),T=new Uint8Array(r.exports.memory.buffer);T.set(o,b);const S=e(_,n,i,b,o.length);if(S===0&&s&&s(_,f,i),t.set(T.subarray(_,_+n*i)),c(_-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const x_="EXT_meshopt_compression",pse=x_;async function gse(r,e){var i,o;const t=new Ms(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=[];for(const s of r.json.bufferViews||[])n.push(mse(t,s));await Promise.all(n),t.removeExtension(x_)}async function mse(r,e){const t=r.getObjectExtension(e,x_);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:c,filter:f="NONE",buffer:_}=t,b=r.gltf.buffers[_],T=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await use(S,s,o,T,c,f),r.removeObjectExtension(e,x_)}}const _se=Object.freeze(Object.defineProperty({__proto__:null,decode:gse,name:pse},Symbol.toStringTag,{value:"Module"})),Gd="EXT_texture_webp",yse=Gd;function vse(r,e){const t=new Ms(r);if(!Ane("image/webp")){if(t.getRequiredExtensions().includes(Gd))throw new Error(`gltf: Required extension ${Gd} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Gd);o&&(i.source=o.source),t.removeObjectExtension(i,Gd)}t.removeExtension(Gd)}const bse=Object.freeze(Object.defineProperty({__proto__:null,name:yse,preprocess:vse},Symbol.toStringTag,{value:"Module"})),Rm="KHR_texture_basisu",xse=Rm;function wse(r,e){const t=new Ms(r),{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Rm);o&&(i.source=o.source,t.removeObjectExtension(i,Rm))}t.removeExtension(Rm)}const Cse=Object.freeze(Object.defineProperty({__proto__:null,name:xse,preprocess:wse},Symbol.toStringTag,{value:"Module"})),Ese="4.3.2",Tse={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Ese,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Bse(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Sse(r){let e=1/0,t=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const c=r.POSITION?r.POSITION.value:[],f=c&&c.length;for(let _=0;_<f;_+=3){const b=c[_],T=c[_+1],S=c[_+2];e=b<e?b:e,t=T<t?T:t,n=S<n?S:n,i=b>i?b:i,o=T>o?T:o,s=S>s?S:s}return[[e,t,n],[i,o,s]]}function Ise(r,e,t){const n=Bse(e.value),i=t||Mse(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function Mse(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}function Pse(r,e,t){const n=IL(e.metadata),i=[],o=Rse(e.attributes);for(const s in r){const c=r[s],f=aM(s,c,o[s]);i.push(f)}if(t){const s=aM("indices",t);i.push(s)}return{fields:i,metadata:n}}function Rse(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function aM(r,e,t){const n=t?IL(t.metadata):void 0;return Ise(r,e,n)}function IL(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const cM={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Fse={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Ose=4;let Dse=class{constructor(e){V(this,"draco");V(this,"decoder");V(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const S=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(S)}const c=this._getDracoLoaderData(o,i,t),f=this._getMeshData(o,c,t),_=Sse(f.attributes),b=Pse(f.attributes,c,f.indices);return{loader:"draco",loaderData:c,header:{vertexCount:o.num_points(),boundingBox:_},...f,schema:b}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const c=this._getQuantizationTransform(o,t);c&&(n[o.unique_id()].quantization_transform=c);const f=this._getOctahedronTransform(o,t);f&&(n[o.unique_id()].octahedron_transform=f)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const c=this._getAttributeValues(t,o);if(c){const{value:f,size:_}=c;i[s]={value:f,size:_,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*Ose,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,n).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),Nse(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=Fse[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,s=e.num_points()*i,c=s*n.BYTES_PER_ELEMENT,f=Lse(this.draco,n);let _;const b=this.draco._malloc(c);try{const T=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,f,c,b),_=new n(this.draco.HEAPF32.buffer,b,s).slice()}finally{this.draco._free(b)}return{value:_,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[s,c]of Object.entries(t.extraAttributes||{}))if(c===n)return s;const i=e.attribute_type;for(const s in cM)if(this.draco[s]===i)return cM[s];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=kse(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(c=>s.min_value(c))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}};function Lse(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function kse(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function Nse(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const Use="1.5.6",zse="1.4.1",Pb=`https://www.gstatic.com/draco/versioned/decoders/${Use}`,Fo={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Rb={[Fo.DECODER]:`${Pb}/${Fo.DECODER}`,[Fo.DECODER_WASM]:`${Pb}/${Fo.DECODER_WASM}`,[Fo.FALLBACK_DECODER]:`${Pb}/${Fo.FALLBACK_DECODER}`,[Fo.ENCODER]:`https://raw.githubusercontent.com/google/draco/${zse}/javascript/${Fo.ENCODER}`};let Fb;async function Gse(r){const e=r.modules||{};return e.draco3d?Fb||(Fb=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):Fb||(Fb=Vse(r)),await Fb}async function Vse(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await Yf(Rb[Fo.FALLBACK_DECODER],"draco",r,Fo.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await Yf(Rb[Fo.DECODER],"draco",r,Fo.DECODER),await Yf(Rb[Fo.DECODER_WASM],"draco",r,Fo.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Hse(e,t)}function Hse(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const jse={...Tse,parse:$se};async function $se(r,e){const{draco:t}=await Gse(e),n=new Dse(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}function Wse(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=ML(n);e[t]=i}}return e}function ML(r){const{buffer:e,size:t,count:n}=Jse(r);return{value:e,size:t,byteOffset:0,count:n,type:mL(t),componentType:by(e)}}function Jse(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=Xse(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function Xse(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Hu="KHR_draco_mesh_compression",Kse=Hu;function Yse(r,e,t){const n=new Ms(r);for(const i of PL(n))n.getObjectExtension(i,Hu)}async function qse(r,e,t){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const n=new Ms(r),i=[];for(const s of PL(n))n.getObjectExtension(s,Hu)&&i.push(Qse(n,s,e,t));await Promise.all(i),n.removeExtension(Hu)}function Zse(r,e={}){const t=new Ms(r);for(const n of t.json.meshes||[])eoe(n),t.addRequiredExtension(Hu)}async function Qse(r,e,t,n){const i=r.getObjectExtension(e,Hu);if(!i)return;const o=r.getTypedArrayForBufferView(i.bufferView),s=uL(o.buffer,o.byteOffset),c={...t};delete c["3d-tiles"];const f=await sL(s,jse,c,n),_=Wse(f.attributes);for(const[b,T]of Object.entries(_))if(b in e.attributes){const S=e.attributes[b],D=r.getAccessor(S);D!=null&&D.min&&(D!=null&&D.max)&&(T.min=D.min,T.max=D.max)}e.attributes=_,f.indices&&(e.indices=ML(f.indices)),r.removeObjectExtension(e,Hu),toe(e)}function eoe(r,e,t=4,n,i){var b;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:r}),s=(b=i==null?void 0:i.parseSync)==null?void 0:b.call(i,{attributes:r}),c=n._addFauxAttributes(s.attributes),f=n.addBufferView(o);return{primitives:[{attributes:c,mode:t,extensions:{[Hu]:{bufferView:f,attributes:c}}}]}}function toe(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*PL(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const roe=Object.freeze(Object.defineProperty({__proto__:null,decode:qse,encode:Zse,name:Kse,preprocess:Yse},Symbol.toStringTag,{value:"Module"})),Cy="KHR_texture_transform",noe=Cy,J0=new ft,ioe=new ci,soe=new ci;async function ooe(r,e){var o;if(!new Ms(r).hasExtension(Cy)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)aoe(s,r)}function aoe(r,e){var o,s,c,f;const t=(o=e.json.materials)==null?void 0:o[r],n=[(s=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(c=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:c.metallicRoughnessTexture],i=[];for(const _ of n)_&&((f=_==null?void 0:_.extensions)!=null&&f[Cy])&&coe(e,r,_,i)}function coe(r,e,t,n){const i=loe(t,n);if(!i)return;const o=r.json.meshes||[];for(const s of o)for(const c of s.primitives){const f=c.material;Number.isFinite(f)&&e===f&&uoe(r,c,i)}}function loe(r,e){var s;const t=(s=r.extensions)==null?void 0:s[Cy],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([c,f])=>c===n&&f===i)!==-1)){const c=doe(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:c}}return null}function uoe(r,e,t){var c,f;const{originalTexCoord:n,texCoord:i,matrix:o}=t,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const _=(c=r.json.accessors)==null?void 0:c[s];if(_&&_.bufferView){const b=(f=r.json.bufferViews)==null?void 0:f[_.bufferView];if(b){const{arrayBuffer:T,byteOffset:S}=r.buffers[b.buffer],D=(S||0)+(_.byteOffset||0)+(b.byteOffset||0),{ArrayType:N,length:G}=_L(_,b),W=gL[_.componentType],z=pL[_.type],j=b.byteStride||W*z,K=new Float32Array(G);for(let fe=0;fe<_.count;fe++){const Z=new N(T,D+fe*j,2);J0.set(Z[0],Z[1],1),J0.transformByMatrix3(o),K.set([J0[0],J0[1]],fe*z)}n===i?foe(_,b,r.buffers,K):hoe(i,_,e,r,K)}}}}function foe(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function hoe(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=s.length-1)}function doe(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new ci().set(1,0,0,0,1,0,e[0],e[1],1),o=ioe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),s=soe.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const Aoe=Object.freeze(Object.defineProperty({__proto__:null,decode:ooe,name:noe},Symbol.toStringTag,{value:"Module"})),Hf="KHR_lights_punctual",poe=Hf;async function goe(r){const e=new Ms(r),{json:t}=e,n=e.getExtension(Hf);n&&(e.json.lights=n.lights,e.removeExtension(Hf));for(const i of t.nodes||[]){const o=e.getObjectExtension(i,Hf);o&&(i.light=o.light),e.removeObjectExtension(i,Hf)}}async function moe(r){const e=new Ms(r),{json:t}=e;if(t.lights){const n=e.addExtension(Hf);Ia(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Hf,n)}delete e.json.lights}}const _oe=Object.freeze(Object.defineProperty({__proto__:null,decode:goe,encode:moe,name:poe},Symbol.toStringTag,{value:"Module"})),Ag="KHR_materials_unlit",yoe=Ag;async function voe(r){const e=new Ms(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,Ag);e.removeExtension(Ag)}function boe(r){const e=new Ms(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,Ag,{}),e.addExtension(Ag))}const xoe=Object.freeze(Object.defineProperty({__proto__:null,decode:voe,encode:boe,name:yoe},Symbol.toStringTag,{value:"Module"})),Dp="KHR_techniques_webgl",woe=Dp;async function Coe(r){const e=new Ms(r),{json:t}=e,n=e.getExtension(Dp);if(n){const i=Toe(n,e);for(const o of t.materials||[]){const s=e.getObjectExtension(o,Dp);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Boe(o.technique,e)),e.removeObjectExtension(o,Dp)}e.removeExtension(Dp)}}async function Eoe(r,e){}function Toe(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=t[s.program]}),i}function Boe(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const Soe=Object.freeze(Object.defineProperty({__proto__:null,decode:Coe,encode:Eoe,name:woe},Symbol.toStringTag,{value:"Module"})),RL=[die,Nne,_se,bse,Cse,roe,_oe,xoe,Soe,Aoe,Mie];function Ioe(r,e={},t){var i;const n=RL.filter(o=>FL(o.name,e));for(const o of n)(i=o.preprocess)==null||i.call(o,r,e,t)}async function Moe(r,e={},t){var i;const n=RL.filter(o=>FL(o.name,e));for(const o of n)await((i=o.decode)==null?void 0:i.call(o,r,e,t))}function FL(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const Ob="KHR_binary_glTF";function Poe(r){const e=new Ms(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,Ob);i&&Object.assign(n,i),e.removeObjectExtension(n,Ob)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(Ob)}const lM={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Roe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let Foe=class{constructor(){V(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});V(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Poe(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in lM)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in lM)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:o}=t;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,t){const n=Roe[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=o.values)==null?void 0:t.tex)||((n=o.values)==null?void 0:n.texture2d_0)||((i=o.values)==null?void 0:i.diffuseTex),c=e.textures.findIndex(f=>f.id===s);c!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:c})}}};function Ooe(r,e={}){return new Foe().normalize(r,e)}async function Doe(r,e,t=0,n,i){var o,s,c;return Loe(r,e,t,n),Ooe(r,{normalize:(o=n==null?void 0:n.gltf)==null?void 0:o.normalize}),Ioe(r,n,i),(s=n==null?void 0:n.gltf)!=null&&s.loadBuffers&&r.json.buffers&&await koe(r,n,i),(c=n==null?void 0:n.gltf)!=null&&c.loadImages&&await Noe(r,n,i),await Moe(r,n,i),r}function Loe(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!Qie(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=Ore(e);else if(e instanceof ArrayBuffer){const s={};t=ese(s,e,t,n.glb),Ia(s.type==="glTF",`Invalid GLB magic string ${s.type}`),r._glb=s,r.json=s.json}else Ia(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:s}=r._glb;r.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function koe(r,e,t){var i,o;const n=r.json.buffers||[];for(let s=0;s<n.length;++s){const c=n[s];if(c.uri){const{fetch:f}=t;Ia(f);const _=SL(c.uri,e),b=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,_)),T=await((o=b==null?void 0:b.arrayBuffer)==null?void 0:o.call(b));r.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete c.uri}else r.buffers[s]===null&&(r.buffers[s]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function Noe(r,e,t){const n=Uoe(r),i=r.json.images||[],o=[];for(const s of n)o.push(zoe(r,i[s],s,e,t));return await Promise.all(o)}function Uoe(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function zoe(r,e,t,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=SL(e.uri,n),{fetch:f}=i;o=await(await f(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const c=wne(r.json,r.buffers,e.bufferView);o=uL(c.buffer,c.byteOffset,c.byteLength)}Ia(o,"glTF image has no data");let s=await sL(o,[dne,Wie],{...n,mimeType:e.mimeType,basis:n.basis||{format:BL()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),r.images=r.images||[],r.images[t]=s}const mx={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Pie,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Goe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Goe(r,e={},t){e={...mx.options,...e},e.gltf={...mx.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Doe({},r,n,e,t)}function uM(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const OL=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),fM=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);fM&&parseFloat(fM[1]);const Db="4.3.2",Voe=Db[0]>="0"&&Db[0]<="9"?`v${Db}`:"";function Hoe(){const r=new vy({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=Voe,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const joe=Hoe();function $oe(r,e){return DL(r||{},e)}function DL(r,e,t=0){if(t>3)return e;const n={...r};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=DL(n[i]||{},e[i],t+1):n[i]=e[i];return n}const Woe="latest";function Joe(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Xoe=Joe();function ju(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const qf=typeof process!="object"||String(process)!=="[object process]"||process.browser,Koe=typeof window<"u"&&typeof window.orientation<"u",hM=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);hM&&parseFloat(hM[1]);class Yoe{constructor(e,t){V(this,"name");V(this,"workerThread");V(this,"isRunning",!0);V(this,"result");V(this,"_resolve",()=>{});V(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ju(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ju(this.isRunning),this.isRunning=!1,this._reject(e)}}class Lb{terminate(){}}const kb=new Map;function qoe(r){ju(r.source&&!r.url||!r.source&&r.url);let e=kb.get(r.source||r.url);return e||(r.url&&(e=Zoe(r.url),kb.set(r.url,e)),r.source&&(e=LL(r.source),kb.set(r.source,e))),ju(e),e}function Zoe(r){if(!r.startsWith("http"))return r;const e=Qoe(r);return LL(e)}function LL(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function Qoe(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function kL(r,e=!0,t){const n=t||new Set;if(r){if(dM(r))n.add(r);else if(dM(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)kL(r[i],e,n)}}return t===void 0?Array.from(n):[]}function dM(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const Nb=()=>{};class _x{constructor(e){V(this,"name");V(this,"source");V(this,"url");V(this,"terminated",!1);V(this,"worker");V(this,"onMessage");V(this,"onError");V(this,"_loadableURL","");const{name:t,source:n,url:i}=e;ju(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Nb,this.onError=o=>console.log(o),this.worker=qf?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&qf||typeof Lb<"u"&&!qf}destroy(){this.onMessage=Nb,this.onError=Nb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||kL(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=qoe({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Lb(n,{eval:!1})}else if(this.source)e=new Lb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class eae{constructor(e){V(this,"name","unnamed");V(this,"source");V(this,"url");V(this,"maxConcurrency",1);V(this,"maxMobileConcurrency",1);V(this,"onDebug",()=>{});V(this,"reuseWorkers",!0);V(this,"props",{});V(this,"jobQueue",[]);V(this,"idleQueue",[]);V(this,"count",0);V(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return _x.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new Yoe(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!qf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new _x({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Koe?this.maxMobileConcurrency:this.maxConcurrency}}const tae={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ru=class Ru{constructor(e){V(this,"props");V(this,"workerPools",new Map);this.props={...tae},this.setProps(e),this.workerPools=new Map}static isSupported(){return _x.isSupported()}static getWorkerFarm(e={}){return Ru._workerFarm=Ru._workerFarm||new Ru({}),Ru._workerFarm.setProps(e),Ru._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let o=this.workerPools.get(t);return o||(o=new eae({name:t,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};V(Ru,"_workerFarm");let w_=Ru;function rae(r,e={}){const t=e[r.id]||{},n=qf?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(qf?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let o=r.version;o==="latest"&&(o=Woe);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${s}/dist/${n}`}return ju(i),i}function nae(r,e=Xoe){ju(r,"no worker provided");const t=r.version;return!(!e||!t)}function iae(r,e){return!w_.isSupported()||!qf&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function sae(r,e,t,n,i){const o=r.id,s=rae(r,t),f=w_.getWorkerFarm(t).getWorkerPool({name:o,url:s});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const _=await f.startJob("process-on-worker",oae.bind(null,i));return _.postMessage("process",{input:e,options:t,context:n}),await(await _.result).result}async function oae(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const c=await r(o,s);e.postMessage("done",{id:i,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:i,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function aae(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function cae(...r){return lae(r)}function lae(r){const e=r.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function uae(r){const e=[];for await(const t of r)e.push(t);return cae(...e)}let fae="";const AM={};function hae(r){for(const e in AM)if(r.startsWith(e)){const t=AM[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${fae}${r}`),r}function dae(r){return r&&typeof r=="object"&&r.isBuffer}function NL(r){if(dae(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function UL(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function Aae(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const pae=r=>typeof r=="boolean",qp=r=>typeof r=="function",Ig=r=>r!==null&&typeof r=="object",pM=r=>Ig(r)&&r.constructor==={}.constructor,gae=r=>!!r&&typeof r[Symbol.iterator]=="function",mae=r=>r&&typeof r[Symbol.asyncIterator]=="function",hh=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,dh=r=>typeof Blob<"u"&&r instanceof Blob,_ae=r=>r&&typeof r=="object"&&r.isBuffer,yae=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Ig(r)&&qp(r.tee)&&qp(r.cancel)&&qp(r.getReader),vae=r=>Ig(r)&&qp(r.read)&&qp(r.pipe)&&pae(r.readable),zL=r=>yae(r)||vae(r);class bae extends Error{constructor(t,n){super(t);V(this,"reason");V(this,"url");V(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const xae=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,wae=/^([-\w.]+\/[-\w.+]+)/;function gM(r,e){return r.toLowerCase()===e.toLowerCase()}function Cae(r){const e=wae.exec(r);return e?e[1]:r}function mM(r){const e=xae.exec(r);return e?e[1]:""}const VL=/\?.*/;function Eae(r){const e=r.match(VL);return e&&e[0]}function lC(r){return r.replace(VL,"")}function Tae(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function Ey(r){return hh(r)?r.url:dh(r)?r.name||"":typeof r=="string"?r:""}function uC(r){if(hh(r)){const e=r,t=e.headers.get("content-type")||"",n=lC(e.url);return Cae(t)||mM(n)}return dh(r)?r.type||"":typeof r=="string"?mM(r):""}function Bae(r){return hh(r)?r.headers["content-length"]||-1:dh(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function HL(r){if(hh(r))return r;const e={},t=Bae(r);t>=0&&(e["content-length"]=String(t));const n=Ey(r),i=uC(r);i&&(e["content-type"]=i);const o=await Mae(r);o&&(e["x-first-bytes"]=o),typeof r=="string"&&(r=new TextEncoder().encode(r));const s=new Response(r,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function Sae(r){if(!r.ok)throw await Iae(r)}async function Iae(r){const e=Tae(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=!r.bodyUsed&&(i!=null&&i.includes("application/json"))?await r.json():await r.text()}catch{}return new bae(t,n)}async function Mae(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=o=>{var s;return n((s=o==null?void 0:o.target)==null?void 0:s.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${Pae(t)}`}return null}function Pae(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function Rae(r){return!Fae(r)&&!Oae(r)}function Fae(r){return r.startsWith("http:")||r.startsWith("https:")}function Oae(r){return r.startsWith("data:")}async function _M(r,e){var t,n;if(typeof r=="string"){const i=hae(r);return Rae(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await HL(r)}const yM=new vy({id:"loaders.gl"});class Dae{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Lae{constructor(){V(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const jL={fetch:null,mimeType:void 0,nothrow:!1,log:new Lae,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:OL,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kae={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function $L(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function WL(){const r=$L();return r.globalOptions=r.globalOptions||{...jL},r.globalOptions}function Nae(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],Uae(r,t),Gae(e,r,n)}function Uae(r,e){vM(r,null,jL,kae,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};vM(n,t.id,i,o,e)}}function vM(r,e,t,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const c in r){const f=!e&&Ig(r[c]),_=c==="baseUri"&&!e,b=c==="workerUrl"&&e;if(!(c in t)&&!_&&!b){if(c in n)yM.warn(`${o} loader option '${s}${c}' no longer supported, use '${n[c]}'`)();else if(!f){const T=zae(c,i);yM.warn(`${o} loader option '${s}${c}' not recognized. ${T}`)()}}}}function zae(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(r===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(t.startsWith(s)||s.startsWith(t))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function Gae(r,e,t){const i={...r.options||{}};return Vae(i,t),i.log===null&&(i.log=new Dae),bM(i,WL()),bM(i,e),i}function bM(r,e){for(const t in e)if(t in e){const n=e[t];pM(n)&&pM(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function Vae(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function fC(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function hC(r){uM(r,"null loader"),uM(fC(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const JL=()=>{const r=$L();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function Mg(r){const e=JL();r=Array.isArray(r)?r:[r];for(const t of r){const n=hC(t);e.find(i=>n===i)||e.unshift(n)}}function Hae(){return JL()}const jae=/\.([^.]+)$/;async function $ae(r,e=[],t,n){if(!XL(r))return null;let i=xM(r,e,{...t,nothrow:!0},n);if(i)return i;if(dh(r)&&(r=await r.slice(0,10).arrayBuffer(),i=xM(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(KL(r));return i}function xM(r,e=[],t,n){if(!XL(r))return null;if(e&&!Array.isArray(e))return hC(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...Hae()),Jae(i);const o=Wae(r,i,t,n);if(!o&&!(t!=null&&t.nothrow))throw new Error(KL(r));return o}function Wae(r,e,t,n){const i=Ey(r),o=uC(r),s=lC(i)||(n==null?void 0:n.url);let c=null,f="";return t!=null&&t.mimeType&&(c=Ub(e,t==null?void 0:t.mimeType),f=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),c=c||Xae(e,s),f=f||(c?`matched url ${s}`:""),c=c||Ub(e,o),f=f||(c?`matched MIME type ${o}`:""),c=c||Yae(e,r),f=f||(c?`matched initial data ${YL(r)}`:""),t!=null&&t.fallbackMimeType&&(c=c||Ub(e,t==null?void 0:t.fallbackMimeType),f=f||(c?`matched fallback MIME type ${o}`:"")),f&&joe.log(1,`selectLoader selected ${c==null?void 0:c.name}: ${f}.`),c}function XL(r){return!(r instanceof Response&&r.status===204)}function KL(r){const e=Ey(r),t=uC(r);let n="No valid loader found (";n+=e?`${UL(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?YL(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function Jae(r){for(const e of r)hC(e)}function Xae(r,e){const t=e&&jae.exec(e),n=t&&t[1];return n?Kae(r,n):null}function Kae(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function Ub(r,e){var t;for(const n of r)if((t=n.mimeTypes)!=null&&t.some(i=>gM(e,i))||gM(e,`application/x.${n.id}`))return n;return null}function Yae(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(qae(e,t))return t}else if(ArrayBuffer.isView(e)){if(wM(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&wM(e,0,t))return t;return null}function qae(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function wM(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>Zae(r,e,t,i))}function Zae(r,e,t,n){if(n instanceof ArrayBuffer)return aae(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=yx(r,e,n.length);return n===i;default:return!1}}function YL(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?yx(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?yx(r,0,e):""}function yx(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const Qae=256*1024;function*ece(r,e){const t=(e==null?void 0:e.chunkSize)||Qae;let n=0;const i=new TextEncoder;for(;n<r.length;){const o=Math.min(r.length-n,t),s=r.slice(n,n+o);n+=o,yield i.encode(s)}}const tce=256*1024;function*rce(r,e={}){const{chunkSize:t=tce}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),o=new ArrayBuffer(i),s=new Uint8Array(r,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const nce=1024*1024;async function*ice(r,e){const t=(e==null?void 0:e.chunkSize)||nce;let n=0;for(;n<r.size;){const i=n+t,o=await r.slice(n,i).arrayBuffer();n=i,yield o}}function CM(r,e){return OL?sce(r,e):oce(r)}async function*sce(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:o,value:s}=await i;if(o)return;yield NL(s)}}catch{t.releaseLock()}}async function*oce(r,e){for await(const t of r)yield NL(t)}function ace(r,e){if(typeof r=="string")return ece(r,e);if(r instanceof ArrayBuffer)return rce(r,e);if(dh(r))return ice(r,e);if(zL(r))return CM(r,e);if(hh(r))return CM(r.body,e);throw new Error("makeIterator")}const qL="Cannot convert supplied data type";function cce(r,e,t){if(e.text&&typeof r=="string")return r;if(_ae(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(qL)}async function lce(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return cce(r,e);if(dh(r)&&(r=await HL(r)),hh(r)){const i=r;return await Sae(i),e.binary?await i.arrayBuffer():await i.text()}if(zL(r)&&(r=ace(r,t)),gae(r)||mae(r))return uae(r);throw new Error(qL)}function ZL(r,e){const t=WL(),n=r||t;return typeof n.fetch=="function"?n.fetch:Ig(n.fetch)?i=>_M(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:_M}function uce(r,e,t){if(t)return t;const n={fetch:ZL(e,r),...r};if(n.url){const i=lC(n.url);n.baseUrl=i,n.queryString=Eae(n.url),n.filename=UL(i),n.baseUrl=Aae(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function fce(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function C_(r,e,t,n){e&&!Array.isArray(e)&&!fC(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=Ey(r),s=fce(e,n),c=await $ae(r,s,t);return c?(t=Nae(t,c,s,i),n=uce({url:i,_parse:C_,loaders:s},t,n||null),await hce(c,r,t,n)):null}async function hce(r,e,t,n){if(nae(r),t=$oe(r.options,t),hh(e)){const o=e,{ok:s,redirected:c,status:f,statusText:_,type:b,url:T}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:c,status:f,statusText:_,type:b,url:T}}e=await lce(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(iae(r,t))return await sae(r,e,t,n,C_);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw ju(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function OA(r,e,t,n){let i,o;!Array.isArray(e)&&!fC(e)?(i=[],o=e):(i=e,o=t);const s=ZL(o);let c=r;return typeof r=="string"&&(c=await s(r)),dh(r)&&(c=await s(r)),Array.isArray(i)?await C_(c,i,o):await C_(c,i,o)}const dce=({error:r,deltaType:e})=>r instanceof pce?Ss(Nv,{name:"No Mapbox token provided",message:Jc(hB,{children:[Jc("p",{children:["To use ",Jc(kv,{children:["st.",e]})," or"," ",Ss(kv,{children:"st.map"})," you need to set up a Mapbox access token."]}),Jc("p",{children:["To get a token, create an account at"," ",Ss("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),Jc("p",{children:["Once you have a token, just set it using the Streamlit config option ",Ss(kv,{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),Jc("p",{children:["See"," ",Ss("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):r instanceof QL?Ss(Nv,{name:"Error fetching Streamlit Mapbox token",message:Jc(hB,{children:[Ss("p",{children:"This app requires an internet connection."}),Ss("p",{children:"Please check your connection and try again."}),Jc("p",{children:["If you think this is a bug, please file bug report"," ",Ss("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):Ss(Nv,{name:"Error fetching Streamlit Mapbox token",message:r.message}),Ace=Bt.memo(dce);class pce extends Error{}class QL extends Error{}const EM="https://data.streamlit.io/tokens.json",TM="mapbox",gce=r=>e=>{const n=class n extends Bt.PureComponent{constructor(o){super(o),this.initMapboxToken=async()=>{try{const s=await A5.get(EM),{[TM]:c}=s.data;if(!c)throw new Error(`Missing token ${TM}`);this.setState({mapboxToken:c,isFetching:!1})}catch(s){const c=QU(s);throw this.setState({mapboxTokenError:c,isFetching:!1}),new QL(`${c.message} (${EM})`)}},this.render=()=>{const{mapboxToken:s,mapboxTokenError:c,isFetching:f}=this.state;return c?Ss(Ace,{error:c,deltaType:r}):f?Ss(e5,{element:dB.create({style:dB.SkeletonStyle.ELEMENT})}):Ss(e,{...this.props,mapboxToken:s})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const o=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;o?this.setState({mapboxToken:o,isFetching:!1}):this.initMapboxToken()}};n.displayName=`withMapboxToken(${e.displayName||e.name})`,n.contextType=t5;let t=n;return r5(t,e)},BM=jO("div",{target:"ei0oomx0"})(({height:r})=>({position:"relative",height:r,width:"100%"})),mce=jO("div",{target:"ei0oomx1"})(({theme:r})=>({position:"absolute",right:"2.625rem",top:r.spacing.md,zIndex:r.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:r.colors.bgColor},"button:not(:disabled)":{background:r.colors.bgColor,width:r.iconSizes.twoXL,height:r.iconSizes.twoXL,"& + button":{borderTopColor:r.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:r.iconSizes.twoXL,"&:hover":{backgroundColor:r.colors.darkenedBgMix25}},"& span":{filter:$O(r)?"":"invert(100%)"}}})),_ce=({container:r,element:e,heightFallback:t="auto",isFullScreen:n,shouldUseContainerWidth:i,widthFallback:o="auto"})=>{const s=Bt.useMemo(()=>i||n?"100%":e.width||r.width||o,[r.width,e.width,n,i,o]),c=Bt.useMemo(()=>n&&r.height?r.height:e.height||r.height||t,[n,e.height,r.height,t]);return{width:s,height:c}},SM=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,yce={name:"arc",vs:SM,fs:SM,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},vce=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bce=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,E_=[0,0,0,255],xce={getSourcePosition:{type:"accessor",value:r=>r.sourcePosition},getTargetPosition:{type:"accessor",value:r=>r.targetPosition},getSourceColor:{type:"accessor",value:E_},getTargetColor:{type:"accessor",value:E_},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Pg extends _s{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:vce,fs:bce,modules:[Is,ca,yce]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:E_},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:E_},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,wrapLongitude:c,numSegments:f}=this.props,_={numSegments:f,widthUnits:xo[t],widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,useShortestPath:c},b=this.state.model;b.shaderInputs.setProps({arc:_}),b.setVertexCount(f*2),b.draw(this.context.renderPass)}_getModel(){return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}Pg.layerName="ArcLayer";Pg.defaultProps=xce;const wce=new Uint32Array([0,2,1,0,3,2]),Cce=new Float32Array([0,1,0,0,1,0,1,1]);function Ece(r,e){if(!e)return Tce(r);const t=Math.max(Math.abs(r[0][0]-r[3][0]),Math.abs(r[1][0]-r[2][0])),n=Math.max(Math.abs(r[1][1]-r[0][1]),Math.abs(r[2][1]-r[3][1])),i=Math.ceil(t/e)+1,o=Math.ceil(n/e)+1,s=(i-1)*(o-1)*6,c=new Uint32Array(s),f=new Float32Array(i*o*2),_=new Float64Array(i*o*3);let b=0,T=0;for(let S=0;S<i;S++){const D=S/(i-1);for(let N=0;N<o;N++){const G=N/(o-1),W=Bce(r,D,G);_[b*3+0]=W[0],_[b*3+1]=W[1],_[b*3+2]=W[2]||0,f[b*2+0]=D,f[b*2+1]=1-G,S>0&&N>0&&(c[T++]=b-o,c[T++]=b-o-1,c[T++]=b-1,c[T++]=b-o,c[T++]=b-1,c[T++]=b),b++}}return{vertexCount:s,positions:_,indices:c,texCoords:f}}function Tce(r){const e=new Float64Array(12);for(let t=0;t<r.length;t++)e[t*3+0]=r[t][0],e[t*3+1]=r[t][1],e[t*3+2]=r[t][2]||0;return{vertexCount:6,positions:e,indices:wce,texCoords:Cce}}function Bce(r,e,t){return dc(dc(r[0],r[1],t),dc(r[3],r[2],t),e)}const IM=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,Sce={name:"bitmap",vs:IM,fs:IM,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},Ice=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,Mce=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Pce=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${Mce}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Rce={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Jr.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class Ty extends _s{getShaders(){return super.getShaders({vs:Ice,fs:Pce,modules:[Is,ca,Sce]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){var o;const i=this.getAttributeManager();if(n.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){const s=this.state.mesh,c=this._createMesh();this.state.model.setVertexCount(c.vertexCount);for(const f in c)s&&s[f]!==c[f]&&i.invalidate(f);this.setState({mesh:c,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,n=e.info;if(!n.color||!t)return n.bitmap=null,n;const{width:i,height:o}=t;n.index=0;const s=Fce(n.color);return n.bitmap={size:{width:i,height:o},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*o)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return MM(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Ece(t,this.context.viewport.resolution)}_getModel(){return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:n,coordinateConversion:i,bounds:o,disablePicking:s}=this.state,{image:c,desaturate:f,transparentColor:_,tintColor:b}=this.props;if(!(t.picking.isActive&&s)&&c&&n){const T={bitmapTexture:c,bounds:o,coordinateConversion:i,desaturate:f,tintColor:b.slice(0,3).map(S=>S/255),transparentColor:_.map(S=>S/255)};n.shaderInputs.setProps({bitmap:T}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=Jr;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:o}=this.props;if(!MM(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const s=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&s===t)return{coordinateConversion:-1,bounds:o};if(i===t&&s===e){const c=Gl([o[0],o[1]]),f=Gl([o[2],o[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],f[0],f[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}Ty.layerName="BitmapLayer";Ty.defaultProps=Rce;function Fce(r){const[e,t,n]=r,i=(n&240)/256,o=(n&15)/16;return[(e+o)/256,(t+i)/256]}function MM(r){return Number.isFinite(r[0])}const PM=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,Oce={name:"icon",vs:PM,fs:PM,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},Dce=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Lce=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,kce=1024,Nce=4,RM=()=>{},FM={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Uce={x:0,y:0,width:0,height:0};function zce(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function Gce(r,e,t,n){const i=Math.min(t/e.width,n/e.height),o=Math.floor(e.width*i),s=Math.floor(e.height*i);return i===1?{image:e,width:o,height:s}:(r.canvas.height=s,r.canvas.width=o,r.clearRect(0,0,o,s),r.drawImage(e,0,0,e.width,e.height,0,0,o,s),{image:r.canvas,width:o,height:s})}function pg(r){return r&&(r.id||r.url)}function Vce(r,e,t,n){const{width:i,height:o,device:s}=r,c=s.createTexture({format:"rgba8unorm",width:e,height:t,sampler:n,mipmaps:!0}),f=s.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:r,destinationTexture:c,width:i,height:o}),f.finish(),r.destroy(),c}function OM(r,e,t){for(let n=0;n<e.length;n++){const{icon:i,xOffset:o}=e[n],s=pg(i);r[s]={...i,x:o,y:t}}}function Hce({icons:r,buffer:e,mapping:t={},xOffset:n=0,yOffset:i=0,rowHeight:o=0,canvasWidth:s}){let c=[];for(let f=0;f<r.length;f++){const _=r[f],b=pg(_);if(!t[b]){const{height:T,width:S}=_;n+S+e>s&&(OM(t,c,i),n=0,i=o+i+e,o=0,c=[]),c.push({icon:_,xOffset:n}),n=n+S+e,o=Math.max(o,T)}}return c.length>0&&OM(t,c,i),{mapping:t,rowHeight:o,xOffset:n,yOffset:i,canvasWidth:s,canvasHeight:zce(o+i+e)}}function jce(r,e,t){if(!r||!e)return null;t=t||{};const n={},{iterable:i,objectInfo:o}=sl(r);for(const s of i){o.index++;const c=e(s,o),f=pg(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!n[f]&&(!t[f]||c.url!==t[f].url)&&(n[f]={...c,source:s,sourceIndex:o.index})}return n}class $ce{constructor(e,{onUpdate:t=RM,onError:n=RM}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Nce,this._canvasWidth=kce,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?pg(e):e;return this._mapping[t]||Uce}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:o}){var s;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),n&&((s=this._texture)==null||s.delete(),this._texture=null,this._externalTexture=n),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(jce(e,t,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:o,yOffset:s,rowHeight:c,canvasHeight:f}=Hce({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=i,this._xOffset=o,this._yOffset=s,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||FM,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Vce(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||FM)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,OA(n.url,this._loadOptions).then(i=>{var N;const o=pg(n),s=this._mapping[o],{x:c,y:f,width:_,height:b}=s,{image:T,width:S,height:D}=Gce(t,i,_,b);(N=this._texture)==null||N.copyExternalImage({image:T,x:c+(_-S)/2,y:f+(b-D)/2,width:S,height:D}),s.width=S,s.height=D,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const ek=[0,0,0,255],Wce={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:r=>r.position},getIcon:{type:"accessor",value:r=>r.icon},getColor:{type:"accessor",value:ek},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class DA extends _s{getShaders(){return super.getShaders({vs:Dce,fs:Lce,modules:[Is,ca,Oce]})}initializeState(){this.state={iconManager:new $ce(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:ek},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var D;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:c,data:f,getIcon:_,textureParameters:b}=t,{iconManager:T}=this.state;if(typeof s=="string")return;const S=s||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:t.loadOptions,autoPacking:!S,iconAtlas:s,iconMapping:S?c:null,textureParameters:b}),S?n.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&T.packIcons(f,_),i.extensionsChanged&&((D=this.state.model)==null||D.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:o,billboard:s,alphaCutoff:c}=this.props,{iconManager:f}=this.state,_=f.getTexture();if(_){const b=this.state.model,T={iconsTexture:_,iconsTextureDim:[_.width,_.height],sizeUnits:xo[o],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:s,alphaCutoff:c};b.shaderInputs.setProps({icon:T}),b.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const t=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;t?t(e):$r.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:o=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[t,n,i,o]}}DA.defaultProps=Wce;DA.layerName="IconLayer";const Jce=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,DM=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Xce={name:"line",source:Jce,vs:DM,fs:DM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Kce=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90°: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Yce=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,qce=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Zce=[0,0,0,255],Qce={getSourcePosition:{type:"accessor",value:r=>r.sourcePosition},getTargetPosition:{type:"accessor",value:r=>r.targetPosition},getColor:{type:"accessor",value:Zce},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class By extends _s{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Yce,fs:qce,source:Kce,modules:[Is,ca,Xce]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,c=this.state.model,f={widthUnits:xo[t],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0};c.shaderInputs.setProps({line:f}),c.draw(this.context.renderPass),s&&(c.shaderInputs.setProps({line:{...f,useShortestPath:-1}}),c.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}By.layerName="LineLayer";By.defaultProps=Qce;const LM=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,ele={name:"pointCloud",vs:LM,fs:LM,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},tle=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rle=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,tk=[0,0,0,255],rk=[0,0,1],nle={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:rk},getColor:{type:"accessor",value:tk},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function ile(r){const{header:e,attributes:t}=r;if(!(!e||!t)&&(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:n,value:i}=t.COLOR_0;t.instanceColors={size:n,type:"unorm8",value:i}}}class Rg extends _s{getShaders(){return super.getShaders({vs:tle,fs:rle,modules:[Is,cy,ca,ele]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:rk},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:tk}})}updateState(e){var i;const{changeFlags:t,props:n}=e;super.updateState(e),t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&ile(n.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:n}=this.props,i=this.state.model,o={sizeUnits:xo[n],radiusPixels:t};i.shaderInputs.setProps({pointCloud:o}),i.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}Rg.layerName="PointCloudLayer";Rg.defaultProps=nle;const kM=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,sle={name:"scatterplot",vs:kM,fs:kM,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},ole=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,ale=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cle=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,NM=[0,0,0,255],lle={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:r=>r.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:NM},getLineColor:{type:"accessor",value:NM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Fg extends _s{getShaders(){return super.getShaders({vs:ole,fs:ale,source:cle,modules:[Is,ca,sle]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:c,billboard:f,antialiasing:_,lineWidthUnits:b,lineWidthScale:T,lineWidthMinPixels:S,lineWidthMaxPixels:D}=this.props,N={stroked:s,filled:c,billboard:f,antialiasing:_,radiusUnits:xo[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:xo[b],lineWidthScale:T,lineWidthMinPixels:S,lineWidthMaxPixels:D},G=this.state.model;G.shaderInputs.setProps({scatterplot:N}),G.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Fg.defaultProps=lle;Fg.layerName="ScatterplotLayer";const dC={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function AC(r,e,t={}){return ule(r,t)!==e?(hle(r,t),!0):!1}function ule(r,e={}){return Math.sign(fle(r,e))}const UM={x:0,y:1,z:2};function fle(r,e={}){const{start:t=0,end:n=r.length,plane:i="xy"}=e,o=e.size||2;let s=0;const c=UM[i[0]],f=UM[i[1]];for(let _=t,b=n-o;_<n;_+=o)s+=(r[_+c]-r[b+c])*(r[_+f]+r[b+f]),b=_;return s/2}function hle(r,e){const{start:t=0,end:n=r.length,size:i=2}=e,o=(n-t)/i,s=Math.floor(o/2);for(let c=0;c<s;++c){const f=t+c*i,_=t+(o-1-c)*i;for(let b=0;b<i;++b){const T=r[f+b];r[f+b]=r[_+b],r[_+b]=T}}}function fc(r,e){const t=e.length,n=r.length;if(n>0){let i=!0;for(let o=0;o<t;o++)if(r[n-t+o]!==e[o]){i=!1;break}if(i)return!1}for(let i=0;i<t;i++)r[n+i]=e[i];return!0}function vx(r,e){const t=e.length;for(let n=0;n<t;n++)r[n]=e[n]}function gg(r,e,t,n,i=[]){const o=n+e*t;for(let s=0;s<t;s++)i[s]=r[o+s];return i}function bx(r,e,t,n,i=[]){let o,s;if(t&8)o=(n[3]-r[1])/(e[1]-r[1]),s=3;else if(t&4)o=(n[1]-r[1])/(e[1]-r[1]),s=1;else if(t&2)o=(n[2]-r[0])/(e[0]-r[0]),s=2;else if(t&1)o=(n[0]-r[0])/(e[0]-r[0]),s=0;else return null;for(let c=0;c<r.length;c++)i[c]=(s&1)===c?n[s]:o*(e[c]-r[c])+r[c];return i}function Fm(r,e){let t=0;return r[0]<e[0]?t|=1:r[0]>e[2]&&(t|=2),r[1]<e[1]?t|=4:r[1]>e[3]&&(t|=8),t}function nk(r,e){const{size:t=2,broken:n=!1,gridResolution:i=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:c=r.length}=e||{},f=(c-s)/t;let _=[];const b=[_],T=gg(r,0,t,s);let S,D;const N=sk(T,i,o,[]),G=[];fc(_,T);for(let W=1;W<f;W++){for(S=gg(r,W,t,s,S),D=Fm(S,N);D;){bx(T,S,D,N,G);const z=Fm(G,N);z&&(bx(T,G,z,N,G),D=z),fc(_,G),vx(T,G),Ale(N,i,D),n&&_.length>t&&(_=[],b.push(_),fc(_,T)),D=Fm(S,N)}fc(_,S),vx(T,S)}return n?b:b[0]}const zM=0,dle=1;function ik(r,e=null,t){if(!r.length)return[];const{size:n=2,gridResolution:i=10,gridOffset:o=[0,0],edgeTypes:s=!1}=t||{},c=[],f=[{pos:r,types:s?new Array(r.length/n).fill(dle):null,holes:e||[]}],_=[[],[]];let b=[];for(;f.length;){const{pos:T,types:S,holes:D}=f.shift();ple(T,n,D[0]||T.length,_),b=sk(_[0],i,o,b);const N=Fm(_[1],b);if(N){let G=GM(T,S,n,0,D[0]||T.length,b,N);const W={pos:G[0].pos,types:G[0].types,holes:[]},z={pos:G[1].pos,types:G[1].types,holes:[]};f.push(W,z);for(let j=0;j<D.length;j++)G=GM(T,S,n,D[j],D[j+1]||T.length,b,N),G[0]&&(W.holes.push(W.pos.length),W.pos=X0(W.pos,G[0].pos),s&&(W.types=X0(W.types,G[0].types))),G[1]&&(z.holes.push(z.pos.length),z.pos=X0(z.pos,G[1].pos),s&&(z.types=X0(z.types,G[1].types)))}else{const G={positions:T};s&&(G.edgeTypes=S),D.length&&(G.holeIndices=D),c.push(G)}}return c}function GM(r,e,t,n,i,o,s){const c=(i-n)/t,f=[],_=[],b=[],T=[],S=[];let D,N,G;const W=gg(r,c-1,t,n);let z=Math.sign(s&8?W[1]-o[3]:W[0]-o[2]),j=e&&e[c-1],K=0,fe=0;for(let Z=0;Z<c;Z++)D=gg(r,Z,t,n,D),N=Math.sign(s&8?D[1]-o[3]:D[0]-o[2]),G=e&&e[n/t+Z],N&&z&&z!==N&&(bx(W,D,s,o,S),fc(f,S)&&b.push(j),fc(_,S)&&T.push(j)),N<=0?(fc(f,D)&&b.push(G),K-=N):b.length&&(b[b.length-1]=zM),N>=0?(fc(_,D)&&T.push(G),fe+=N):T.length&&(T[T.length-1]=zM),vx(W,D),z=N,j=G;return[K?{pos:f,types:e&&b}:null,fe?{pos:_,types:e&&T}:null]}function sk(r,e,t,n){const i=Math.floor((r[0]-t[0])/e)*e+t[0],o=Math.floor((r[1]-t[1])/e)*e+t[1];return n[0]=i,n[1]=o,n[2]=i+e,n[3]=o+e,n}function Ale(r,e,t){t&8?(r[1]+=e,r[3]+=e):t&4?(r[1]-=e,r[3]-=e):t&2?(r[0]+=e,r[2]+=e):t&1&&(r[0]-=e,r[2]-=e)}function ple(r,e,t,n){let i=1/0,o=-1/0,s=1/0,c=-1/0;for(let f=0;f<t;f+=e){const _=r[f],b=r[f+1];i=_<i?_:i,o=_>o?_:o,s=b<s?b:s,c=b>c?b:c}return n[0][0]=i,n[0][1]=s,n[1][0]=o,n[1][1]=c,n}function X0(r,e){for(let t=0;t<e.length;t++)r.push(e[t]);return r}const gle=85.051129;function mle(r,e){const{size:t=2,startIndex:n=0,endIndex:i=r.length,normalize:o=!0}=e||{},s=r.slice(n,i);ok(s,t,0,i-n);const c=nk(s,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const f of c)ak(f,t);return c}function _le(r,e=null,t){const{size:n=2,normalize:i=!0,edgeTypes:o=!1}=t||{};e=e||[];const s=[],c=[];let f=0,_=0;for(let T=0;T<=e.length;T++){const S=e[T]||r.length,D=_,N=yle(r,n,f,S);for(let G=N;G<S;G++)s[_++]=r[G];for(let G=f;G<N;G++)s[_++]=r[G];ok(s,n,D,_),vle(s,n,D,_,t==null?void 0:t.maxLatitude),f=S,c[T]=_}c.pop();const b=ik(s,c,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(i)for(const T of b)ak(T.positions,n);return b}function yle(r,e,t,n){let i=-1,o=-1;for(let s=t+1;s<n;s+=e){const c=Math.abs(r[s]);c>i&&(i=c,o=s-1)}return o}function vle(r,e,t,n,i=gle){const o=r[t],s=r[n-e];if(Math.abs(o-s)>180){const c=gg(r,0,e,t);c[0]+=Math.round((s-o)/360)*360,fc(r,c),c[1]=Math.sign(c[1])*i,fc(r,c),c[0]=o,fc(r,c)}}function ok(r,e,t,n){let i=r[0],o;for(let s=t;s<n;s+=e){o=r[s];const c=o-i;(c>180||c<-180)&&(o-=Math.round(c/360)*360),r[s]=i=o}}function ak(r,e){let t;const n=r.length/e;for(let o=0;o<n&&(t=r[o*e],(t+180)%360===0);o++);const i=-Math.round(t/360)*360;if(i!==0)for(let o=0;o<n;o++)r[o*e]+=i}class ble extends $s{constructor(e){const{indices:t,attributes:n}=xle(e);super({...e,indices:t,attributes:n})}}function xle(r){const{radius:e,height:t=1,nradial:n=10}=r;let{vertices:i}=r;i&&($r.assert(i.length>=n),i=i.flatMap(D=>[D[0],D[1]]),AC(i,dC.COUNTER_CLOCKWISE));const o=t>0,s=n+1,c=o?s*3+1:n,f=Math.PI*2/n,_=new Uint16Array(o?n*3*2:0),b=new Float32Array(c*3),T=new Float32Array(c*3);let S=0;if(o){for(let D=0;D<s;D++){const N=D*f,G=D%n,W=Math.sin(N),z=Math.cos(N);for(let j=0;j<2;j++)b[S+0]=i?i[G*2]:z*e,b[S+1]=i?i[G*2+1]:W*e,b[S+2]=(1/2-j)*t,T[S+0]=i?i[G*2]:z,T[S+1]=i?i[G*2+1]:W,S+=3}b[S+0]=b[S-3],b[S+1]=b[S-2],b[S+2]=b[S-1],S+=3}for(let D=o?0:1;D<s;D++){const N=Math.floor(D/2)*Math.sign(.5-D%2),G=N*f,W=(N+n)%n,z=Math.sin(G),j=Math.cos(G);b[S+0]=i?i[W*2]:j*e,b[S+1]=i?i[W*2+1]:z*e,b[S+2]=t/2,T[S+2]=1,S+=3}if(o){let D=0;for(let N=0;N<n;N++)_[D++]=N*2+0,_[D++]=N*2+2,_[D++]=N*2+0,_[D++]=N*2+1,_[D++]=N*2+1,_[D++]=N*2+3}return{indices:_,attributes:{POSITION:{size:3,value:b},NORMAL:{size:3,value:T}}}}const VM=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,wle={name:"column",vs:VM,fs:VM,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},Cle=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ele=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,T_=[0,0,0,255],Tle={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:r=>r.position},getFillColor:{type:"accessor",value:T_},getLineColor:{type:"accessor",value:T_},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ol extends _s{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:Cle,fs:Ele,defines:e,modules:[Is,t?Ew:cy,ca,wle]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:T_},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:T_},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var c;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,o=i.extensionsChanged||t.flatShading!==n.flatShading;o&&((c=this.state.models)==null||c.forEach(f=>f.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||t.diskResolution!==n.diskResolution||t.vertices!==n.vertices||(t.extruded||t.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(t)}getGeometry(e,t,n){const i=new ble({radius:1,height:n?2:0,vertices:t,nradial:e});let o=0;if(t)for(let s=0;s<e;s++){const c=t[s],f=Math.sqrt(c[0]*c[0]+c[1]*c[1]);o+=f/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),i}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),n=new Bi(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),i=new Bi(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:e,vertices:t,extruded:n,stroked:i}){const o=this.getGeometry(e,t,n||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,c=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),c.setGeometry(o),c.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:c,extruded:f,filled:_,stroked:b,wireframe:T,offset:S,coverage:D,radius:N,angle:G}=this.props,W=this.state.fillModel,z=this.state.wireframeModel,{fillVertexCount:j,edgeDistance:K}=this.state,fe={radius:N,angle:G/180*Math.PI,offset:S,extruded:f,stroked:b,coverage:D,elevationScale:c,edgeDistance:K,radiusUnits:xo[s],widthUnits:xo[t],widthScale:n,widthMinPixels:i,widthMaxPixels:o};f&&T&&(z.shaderInputs.setProps({column:{...fe,isStroke:!0}}),z.draw(this.context.renderPass)),_&&(W.setVertexCount(j),W.shaderInputs.setProps({column:{...fe,isStroke:!1}}),W.draw(this.context.renderPass)),!f&&b&&(W.setVertexCount(j*2/3),W.shaderInputs.setProps({column:{...fe,isStroke:!0}}),W.draw(this.context.renderPass))}}ol.layerName="ColumnLayer";ol.defaultProps=Tle;const Ble={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let pC=class extends ol{_updateGeometry(){const e=new H6;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:t,extruded:n,offset:i,coverage:o,cellSize:s,angle:c,radiusUnits:f}=this.props,_=this.state.fillModel,b={radius:s/2,radiusUnits:xo[f],angle:c,offset:i,extruded:n,stroked:!1,coverage:o,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};_.shaderInputs.setProps({column:b}),_.draw(this.context.renderPass)}};pC.layerName="GridCellLayer";pC.defaultProps=Ble;function Sle(r,e,t,n){let i;if(Array.isArray(r[0])){const o=r.length*e;i=new Array(o);for(let s=0;s<r.length;s++)for(let c=0;c<e;c++)i[s*e+c]=r[s][c]||0}else i=r;return t?nk(i,{size:e,gridResolution:t}):n?mle(i,{size:e}):i}const Ile=1,Mle=2,zb=4;class Ple extends C4{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Sle(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(HM(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&HM(e))for(const n of e){const i=this.getGeometrySize(n);t.geometrySize=i,this.updateGeometryAttributes(n,t),t.vertexStart+=i}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:s}=t;n.fill(0,o,o+s),i?(n[o]=zb,n[o+s-2]=zb):(n[o]+=Ile,n[o+s-2]+=Mle),n[o+s-1]=zb}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:o}=t,s=new Array(3);for(let c=i,f=0;f<o;c++,f++)this.getPointOnPath(e,f,s),n[c*3]=s[0],n[c*3+1]=s[1],n[c*3+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const o=t*i;return n[0]=e[o],n[1]=e[o+1],n[2]=i===3&&e[o+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(t===2||e[2]===e[n+2])}}function HM(r){return Array.isArray(r[0])}const jM=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,Rle={name:"path",vs:jM,fs:jM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Fle=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ole=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ck=[0,0,0,255],Dle={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:r=>r.path},getColor:{type:"accessor",value:ck},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Gb={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r};class Zu extends _s{getShaders(){return super.getShaders({vs:Fle,fs:Ole,modules:[Is,ca,Rle]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Gb,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Gb,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Gb,defaultValue:ck},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:i,target:o})=>this.encodePickingColor(n&&n.__source?n.__source.index:i,o)}}),this.setState({pathTesselator:new Ple({fp64:this.use64bitPositions()})})}updateState(e){var s;super.updateState(e);const{props:t,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:c}=this.state,f=t.data.attributes||{};c.updateGeometry({data:t.data,geometryBuffer:f.getPath,buffers:f,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(o=>o.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:o,widthUnits:s,widthScale:c,widthMinPixels:f,widthMaxPixels:_}=this.props,b=this.state.model,T={jointType:Number(t),capType:Number(n),billboard:i,widthUnits:xo[s],widthScale:c,miterLimit:o,widthMinPixels:f,widthMaxPixels:_};b.shaderInputs.setProps({path:T}),b.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Zu.defaultProps=Dle;Zu.layerName="PathLayer";var K0={exports:{}},$M;function Lle(){if($M)return K0.exports;$M=1,K0.exports=r,K0.exports.default=r;function r(we,Ne,Ge){Ge=Ge||2;var Qe=Ne&&Ne.length,rt=Qe?Ne[0]*Ge:we.length,tt=e(we,0,rt,Ge,!0),lt=[];if(!tt||tt.next===tt.prev)return lt;var mt,Tt,nt,cr,Xt,$t,Lt;if(Qe&&(tt=f(we,Ne,tt,Ge)),we.length>80*Ge){mt=nt=we[0],Tt=cr=we[1];for(var lr=Ge;lr<rt;lr+=Ge)Xt=we[lr],$t=we[lr+1],Xt<mt&&(mt=Xt),$t<Tt&&(Tt=$t),Xt>nt&&(nt=Xt),$t>cr&&(cr=$t);Lt=Math.max(nt-mt,cr-Tt),Lt=Lt!==0?32767/Lt:0}return n(tt,lt,Ge,mt,Tt,Lt,0),lt}function e(we,Ne,Ge,Qe,rt){var tt,lt;if(rt===Ye(we,Ne,Ge,Qe)>0)for(tt=Ne;tt<Ge;tt+=Qe)lt=J(tt,we[tt],we[tt+1],lt);else for(tt=Ge-Qe;tt>=Ne;tt-=Qe)lt=J(tt,we[tt],we[tt+1],lt);return lt&&fe(lt,lt.next)&&(ne(lt),lt=lt.next),lt}function t(we,Ne){if(!we)return we;Ne||(Ne=we);var Ge=we,Qe;do if(Qe=!1,!Ge.steiner&&(fe(Ge,Ge.next)||K(Ge.prev,Ge,Ge.next)===0)){if(ne(Ge),Ge=Ne=Ge.prev,Ge===Ge.next)break;Qe=!0}else Ge=Ge.next;while(Qe||Ge!==Ne);return Ne}function n(we,Ne,Ge,Qe,rt,tt,lt){if(we){!lt&&tt&&D(we,Qe,rt,tt);for(var mt=we,Tt,nt;we.prev!==we.next;){if(Tt=we.prev,nt=we.next,tt?o(we,Qe,rt,tt):i(we)){Ne.push(Tt.i/Ge|0),Ne.push(we.i/Ge|0),Ne.push(nt.i/Ge|0),ne(we),we=nt.next,mt=nt.next;continue}if(we=nt,we===mt){lt?lt===1?(we=s(t(we),Ne,Ge),n(we,Ne,Ge,Qe,rt,tt,2)):lt===2&&c(we,Ne,Ge,Qe,rt,tt):n(t(we),Ne,Ge,Qe,rt,tt,1);break}}}}function i(we){var Ne=we.prev,Ge=we,Qe=we.next;if(K(Ne,Ge,Qe)>=0)return!1;for(var rt=Ne.x,tt=Ge.x,lt=Qe.x,mt=Ne.y,Tt=Ge.y,nt=Qe.y,cr=rt<tt?rt<lt?rt:lt:tt<lt?tt:lt,Xt=mt<Tt?mt<nt?mt:nt:Tt<nt?Tt:nt,$t=rt>tt?rt>lt?rt:lt:tt>lt?tt:lt,Lt=mt>Tt?mt>nt?mt:nt:Tt>nt?Tt:nt,lr=Qe.next;lr!==Ne;){if(lr.x>=cr&&lr.x<=$t&&lr.y>=Xt&&lr.y<=Lt&&z(rt,mt,tt,Tt,lt,nt,lr.x,lr.y)&&K(lr.prev,lr,lr.next)>=0)return!1;lr=lr.next}return!0}function o(we,Ne,Ge,Qe){var rt=we.prev,tt=we,lt=we.next;if(K(rt,tt,lt)>=0)return!1;for(var mt=rt.x,Tt=tt.x,nt=lt.x,cr=rt.y,Xt=tt.y,$t=lt.y,Lt=mt<Tt?mt<nt?mt:nt:Tt<nt?Tt:nt,lr=cr<Xt?cr<$t?cr:$t:Xt<$t?Xt:$t,tn=mt>Tt?mt>nt?mt:nt:Tt>nt?Tt:nt,Er=cr>Xt?cr>$t?cr:$t:Xt>$t?Xt:$t,Ar=G(Lt,lr,Ne,Ge,Qe),Mn=G(tn,Er,Ne,Ge,Qe),hr=we.prevZ,pr=we.nextZ;hr&&hr.z>=Ar&&pr&&pr.z<=Mn;){if(hr.x>=Lt&&hr.x<=tn&&hr.y>=lr&&hr.y<=Er&&hr!==rt&&hr!==lt&&z(mt,cr,Tt,Xt,nt,$t,hr.x,hr.y)&&K(hr.prev,hr,hr.next)>=0||(hr=hr.prevZ,pr.x>=Lt&&pr.x<=tn&&pr.y>=lr&&pr.y<=Er&&pr!==rt&&pr!==lt&&z(mt,cr,Tt,Xt,nt,$t,pr.x,pr.y)&&K(pr.prev,pr,pr.next)>=0))return!1;pr=pr.nextZ}for(;hr&&hr.z>=Ar;){if(hr.x>=Lt&&hr.x<=tn&&hr.y>=lr&&hr.y<=Er&&hr!==rt&&hr!==lt&&z(mt,cr,Tt,Xt,nt,$t,hr.x,hr.y)&&K(hr.prev,hr,hr.next)>=0)return!1;hr=hr.prevZ}for(;pr&&pr.z<=Mn;){if(pr.x>=Lt&&pr.x<=tn&&pr.y>=lr&&pr.y<=Er&&pr!==rt&&pr!==lt&&z(mt,cr,Tt,Xt,nt,$t,pr.x,pr.y)&&K(pr.prev,pr,pr.next)>=0)return!1;pr=pr.nextZ}return!0}function s(we,Ne,Ge){var Qe=we;do{var rt=Qe.prev,tt=Qe.next.next;!fe(rt,tt)&&Z(rt,Qe,Qe.next,tt)&&de(rt,tt)&&de(tt,rt)&&(Ne.push(rt.i/Ge|0),Ne.push(Qe.i/Ge|0),Ne.push(tt.i/Ge|0),ne(Qe),ne(Qe.next),Qe=we=tt),Qe=Qe.next}while(Qe!==we);return t(Qe)}function c(we,Ne,Ge,Qe,rt,tt){var lt=we;do{for(var mt=lt.next.next;mt!==lt.prev;){if(lt.i!==mt.i&&j(lt,mt)){var Tt=pe(lt,mt);lt=t(lt,lt.next),Tt=t(Tt,Tt.next),n(lt,Ne,Ge,Qe,rt,tt,0),n(Tt,Ne,Ge,Qe,rt,tt,0);return}mt=mt.next}lt=lt.next}while(lt!==we)}function f(we,Ne,Ge,Qe){var rt=[],tt,lt,mt,Tt,nt;for(tt=0,lt=Ne.length;tt<lt;tt++)mt=Ne[tt]*Qe,Tt=tt<lt-1?Ne[tt+1]*Qe:we.length,nt=e(we,mt,Tt,Qe,!1),nt===nt.next&&(nt.steiner=!0),rt.push(W(nt));for(rt.sort(_),tt=0;tt<rt.length;tt++)Ge=b(rt[tt],Ge);return Ge}function _(we,Ne){return we.x-Ne.x}function b(we,Ne){var Ge=T(we,Ne);if(!Ge)return Ne;var Qe=pe(Ge,we);return t(Qe,Qe.next),t(Ge,Ge.next)}function T(we,Ne){var Ge=Ne,Qe=we.x,rt=we.y,tt=-1/0,lt;do{if(rt<=Ge.y&&rt>=Ge.next.y&&Ge.next.y!==Ge.y){var mt=Ge.x+(rt-Ge.y)*(Ge.next.x-Ge.x)/(Ge.next.y-Ge.y);if(mt<=Qe&&mt>tt&&(tt=mt,lt=Ge.x<Ge.next.x?Ge:Ge.next,mt===Qe))return lt}Ge=Ge.next}while(Ge!==Ne);if(!lt)return null;var Tt=lt,nt=lt.x,cr=lt.y,Xt=1/0,$t;Ge=lt;do Qe>=Ge.x&&Ge.x>=nt&&Qe!==Ge.x&&z(rt<cr?Qe:tt,rt,nt,cr,rt<cr?tt:Qe,rt,Ge.x,Ge.y)&&($t=Math.abs(rt-Ge.y)/(Qe-Ge.x),de(Ge,we)&&($t<Xt||$t===Xt&&(Ge.x>lt.x||Ge.x===lt.x&&S(lt,Ge)))&&(lt=Ge,Xt=$t)),Ge=Ge.next;while(Ge!==Tt);return lt}function S(we,Ne){return K(we.prev,we,Ne.prev)<0&&K(Ne.next,we,we.next)<0}function D(we,Ne,Ge,Qe){var rt=we;do rt.z===0&&(rt.z=G(rt.x,rt.y,Ne,Ge,Qe)),rt.prevZ=rt.prev,rt.nextZ=rt.next,rt=rt.next;while(rt!==we);rt.prevZ.nextZ=null,rt.prevZ=null,N(rt)}function N(we){var Ne,Ge,Qe,rt,tt,lt,mt,Tt,nt=1;do{for(Ge=we,we=null,tt=null,lt=0;Ge;){for(lt++,Qe=Ge,mt=0,Ne=0;Ne<nt&&(mt++,Qe=Qe.nextZ,!!Qe);Ne++);for(Tt=nt;mt>0||Tt>0&&Qe;)mt!==0&&(Tt===0||!Qe||Ge.z<=Qe.z)?(rt=Ge,Ge=Ge.nextZ,mt--):(rt=Qe,Qe=Qe.nextZ,Tt--),tt?tt.nextZ=rt:we=rt,rt.prevZ=tt,tt=rt;Ge=Qe}tt.nextZ=null,nt*=2}while(lt>1);return we}function G(we,Ne,Ge,Qe,rt){return we=(we-Ge)*rt|0,Ne=(Ne-Qe)*rt|0,we=(we|we<<8)&16711935,we=(we|we<<4)&252645135,we=(we|we<<2)&858993459,we=(we|we<<1)&1431655765,Ne=(Ne|Ne<<8)&16711935,Ne=(Ne|Ne<<4)&252645135,Ne=(Ne|Ne<<2)&858993459,Ne=(Ne|Ne<<1)&1431655765,we|Ne<<1}function W(we){var Ne=we,Ge=we;do(Ne.x<Ge.x||Ne.x===Ge.x&&Ne.y<Ge.y)&&(Ge=Ne),Ne=Ne.next;while(Ne!==we);return Ge}function z(we,Ne,Ge,Qe,rt,tt,lt,mt){return(rt-lt)*(Ne-mt)>=(we-lt)*(tt-mt)&&(we-lt)*(Qe-mt)>=(Ge-lt)*(Ne-mt)&&(Ge-lt)*(tt-mt)>=(rt-lt)*(Qe-mt)}function j(we,Ne){return we.next.i!==Ne.i&&we.prev.i!==Ne.i&&!Le(we,Ne)&&(de(we,Ne)&&de(Ne,we)&&_e(we,Ne)&&(K(we.prev,we,Ne.prev)||K(we,Ne.prev,Ne))||fe(we,Ne)&&K(we.prev,we,we.next)>0&&K(Ne.prev,Ne,Ne.next)>0)}function K(we,Ne,Ge){return(Ne.y-we.y)*(Ge.x-Ne.x)-(Ne.x-we.x)*(Ge.y-Ne.y)}function fe(we,Ne){return we.x===Ne.x&&we.y===Ne.y}function Z(we,Ne,Ge,Qe){var rt=Be(K(we,Ne,Ge)),tt=Be(K(we,Ne,Qe)),lt=Be(K(Ge,Qe,we)),mt=Be(K(Ge,Qe,Ne));return!!(rt!==tt&&lt!==mt||rt===0&&ae(we,Ge,Ne)||tt===0&&ae(we,Qe,Ne)||lt===0&&ae(Ge,we,Qe)||mt===0&&ae(Ge,Ne,Qe))}function ae(we,Ne,Ge){return Ne.x<=Math.max(we.x,Ge.x)&&Ne.x>=Math.min(we.x,Ge.x)&&Ne.y<=Math.max(we.y,Ge.y)&&Ne.y>=Math.min(we.y,Ge.y)}function Be(we){return we>0?1:we<0?-1:0}function Le(we,Ne){var Ge=we;do{if(Ge.i!==we.i&&Ge.next.i!==we.i&&Ge.i!==Ne.i&&Ge.next.i!==Ne.i&&Z(Ge,Ge.next,we,Ne))return!0;Ge=Ge.next}while(Ge!==we);return!1}function de(we,Ne){return K(we.prev,we,we.next)<0?K(we,Ne,we.next)>=0&&K(we,we.prev,Ne)>=0:K(we,Ne,we.prev)<0||K(we,we.next,Ne)<0}function _e(we,Ne){var Ge=we,Qe=!1,rt=(we.x+Ne.x)/2,tt=(we.y+Ne.y)/2;do Ge.y>tt!=Ge.next.y>tt&&Ge.next.y!==Ge.y&&rt<(Ge.next.x-Ge.x)*(tt-Ge.y)/(Ge.next.y-Ge.y)+Ge.x&&(Qe=!Qe),Ge=Ge.next;while(Ge!==we);return Qe}function pe(we,Ne){var Ge=new ye(we.i,we.x,we.y),Qe=new ye(Ne.i,Ne.x,Ne.y),rt=we.next,tt=Ne.prev;return we.next=Ne,Ne.prev=we,Ge.next=rt,rt.prev=Ge,Qe.next=Ge,Ge.prev=Qe,tt.next=Qe,Qe.prev=tt,Qe}function J(we,Ne,Ge,Qe){var rt=new ye(we,Ne,Ge);return Qe?(rt.next=Qe.next,rt.prev=Qe,Qe.next.prev=rt,Qe.next=rt):(rt.prev=rt,rt.next=rt),rt}function ne(we){we.next.prev=we.prev,we.prev.next=we.next,we.prevZ&&(we.prevZ.nextZ=we.nextZ),we.nextZ&&(we.nextZ.prevZ=we.prevZ)}function ye(we,Ne,Ge){this.i=we,this.x=Ne,this.y=Ge,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}r.deviation=function(we,Ne,Ge,Qe){var rt=Ne&&Ne.length,tt=rt?Ne[0]*Ge:we.length,lt=Math.abs(Ye(we,0,tt,Ge));if(rt)for(var mt=0,Tt=Ne.length;mt<Tt;mt++){var nt=Ne[mt]*Ge,cr=mt<Tt-1?Ne[mt+1]*Ge:we.length;lt-=Math.abs(Ye(we,nt,cr,Ge))}var Xt=0;for(mt=0;mt<Qe.length;mt+=3){var $t=Qe[mt]*Ge,Lt=Qe[mt+1]*Ge,lr=Qe[mt+2]*Ge;Xt+=Math.abs((we[$t]-we[lr])*(we[Lt+1]-we[$t+1])-(we[$t]-we[Lt])*(we[lr+1]-we[$t+1]))}return lt===0&&Xt===0?0:Math.abs((Xt-lt)/lt)};function Ye(we,Ne,Ge,Qe){for(var rt=0,tt=Ne,lt=Ge-Qe;tt<Ge;tt+=Qe)rt+=(we[lt]-we[tt])*(we[tt+1]+we[lt+1]),lt=tt;return rt}return r.flatten=function(we){for(var Ne=we[0][0].length,Ge={vertices:[],holes:[],dimensions:Ne},Qe=0,rt=0;rt<we.length;rt++){for(var tt=0;tt<we[rt].length;tt++)for(var lt=0;lt<Ne;lt++)Ge.vertices.push(we[rt][tt][lt]);rt>0&&(Qe+=we[rt-1].length,Ge.holes.push(Qe))}return Ge},K0.exports}var kle=Lle();const lk=sh(kle),Y0=dC.CLOCKWISE,WM=dC.COUNTER_CLOCKWISE,Lu={};function Nle(r){if(r=r&&r.positions||r,!Array.isArray(r)&&!ArrayBuffer.isView(r))throw new Error("invalid polygon")}function Lp(r){return"positions"in r?r.positions:r}function Om(r){return"holeIndices"in r?r.holeIndices:null}function Ule(r){return Array.isArray(r[0])}function zle(r){return r.length>=1&&r[0].length>=2&&Number.isFinite(r[0][0])}function Gle(r){const e=r[0],t=r[r.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Vle(r,e,t,n){for(let i=0;i<e;i++)if(r[t+i]!==r[n-e+i])return!1;return!0}function JM(r,e,t,n,i){let o=e;const s=t.length;for(let c=0;c<s;c++)for(let f=0;f<n;f++)r[o++]=t[c][f]||0;if(!Gle(t))for(let c=0;c<n;c++)r[o++]=t[0][c]||0;return Lu.start=e,Lu.end=o,Lu.size=n,AC(r,i,Lu),o}function XM(r,e,t,n,i=0,o,s){o=o||t.length;const c=o-i;if(c<=0)return e;let f=e;for(let _=0;_<c;_++)r[f++]=t[i+_];if(!Vle(t,n,i,o))for(let _=0;_<n;_++)r[f++]=t[i+_];return Lu.start=e,Lu.end=f,Lu.size=n,AC(r,s,Lu),f}function uk(r,e){Nle(r);const t=[],n=[];if("positions"in r){const{positions:i,holeIndices:o}=r;if(o){let s=0;for(let c=0;c<=o.length;c++)s=XM(t,s,i,e,o[c-1],o[c],c===0?Y0:WM),n.push(s);return n.pop(),{positions:t,holeIndices:n}}r=i}if(!Ule(r))return XM(t,0,r,e,0,t.length,Y0),t;if(!zle(r)){let i=0;for(const[o,s]of r.entries())i=JM(t,i,s,e,o===0?Y0:WM),n.push(i);return n.pop(),{positions:t,holeIndices:n}}return JM(t,0,r,e,Y0),t}function Vb(r,e,t){const n=r.length/3;let i=0;for(let o=0;o<n;o++){const s=(o+1)%n;i+=r[o*3+e]*r[s*3+t],i-=r[s*3+e]*r[o*3+t]}return Math.abs(i/2)}function KM(r,e,t,n){const i=r.length/3;for(let o=0;o<i;o++){const s=o*3,c=r[s+0],f=r[s+1],_=r[s+2];r[s+e]=c,r[s+t]=f,r[s+n]=_}}function Hle(r,e,t,n){let i=Om(r);i&&(i=i.map(c=>c/e));let o=Lp(r);const s=n&&e===3;if(t){const c=o.length;o=o.slice();const f=[];for(let _=0;_<c;_+=e){f[0]=o[_],f[1]=o[_+1],s&&(f[2]=o[_+2]);const b=t(f);o[_]=b[0],o[_+1]=b[1],s&&(o[_+2]=b[2])}}if(s){const c=Vb(o,0,1),f=Vb(o,0,2),_=Vb(o,1,2);if(!c&&!f&&!_)return[];c>f&&c>_||(f>_?(t||(o=o.slice()),KM(o,0,2,1)):(t||(o=o.slice()),KM(o,2,0,1)))}return lk(o,i,e)}class jle extends C4{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=uk(e,this.positionSize);return this.opts.resolution?ik(Lp(t),Om(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?_le(Lp(t),Om(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(YM(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return Lp(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&YM(e))for(const n of e){const i=this.getGeometrySize(n);t.geometrySize=i,this.updateGeometryAttributes(n,t),t.vertexStart+=i,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:o,indexStarts:s,typedArrayManager:c}=this;let f=o.indices;if(!f||!e)return;let _=i;const b=Hle(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=c.allocate(f,i+b.length,{copy:!0});for(let T=0;T<b.length;T++)f[_++]=b[T]+n;s[t+1]=i+b.length,o.indices=f}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:o}=this;if(!i||!e)return;const s=Lp(e);for(let c=t,f=0;f<n;c++,f++){const _=s[f*o],b=s[f*o+1],T=o>2?s[f*o+2]:0;i[c*3]=_,i[c*3+1]=b,i[c*3+2]=T}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:i}=this,o=this.attributes.vertexValid,s=e&&Om(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,t):o.fill(1,t,t+n),s)for(let c=0;c<s.length;c++)o[t+s[c]/i-1]=0;o[t+n-1]=0}}function YM(r){return Array.isArray(r)&&r.length>0&&!Number.isFinite(r[0])}const qM=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,$le={name:"solidPolygon",vs:qM,fs:qM,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},fk=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Wle=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${fk}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Jle=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${fk}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Xle=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,B_=[0,0,0,255],Kle={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:r=>r.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:B_},getLineColor:{type:"accessor",value:B_},material:!0},q0={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r};class Qu extends _s{getShaders(e){return super.getShaders({vs:e==="top"?Wle:Jle,fs:Xle,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Is,cy,ca,$le]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&t===Jr.DEFAULT&&(t=Jr.LNGLAT);let i;t===Jr.LNGLAT&&(n?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new jle({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:q0,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:q0,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:q0,accessor:"getFillColor",defaultValue:B_},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:q0,accessor:"getLineColor",defaultValue:B_},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:f,target:_})=>this.encodePickingColor(c&&c.__source?c.__source.index:f,_)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(o=>o.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:o}=this.props,{topModel:s,sideModel:c,wireframeModel:f,polygonTesselator:_}=this.state,b={extruded:!!t,elevationScale:o,isWireframe:!1};f&&i&&(f.setInstanceCount(_.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...b,isWireframe:!0}}),f.draw(this.context.renderPass)),c&&n&&(c.setInstanceCount(_.instanceCount-1),c.shaderInputs.setProps({solidPolygon:b}),c.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(_.vertexCount),s.shaderInputs.setProps({solidPolygon:b}),s.draw(this.context.renderPass))}updateState(e){var c;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager();(i.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&((c=this.state.models)==null||c.forEach(f=>f.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,s=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let i,o,s;if(t){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Bi(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new Bi(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new $s({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new Bi(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new $s({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,i].filter(Boolean),topModel:i,sideModel:o,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Qu.defaultProps=Kle;Qu.layerName="SolidPolygonLayer";function hk({data:r,getIndex:e,dataRange:t,replace:n}){const{startRow:i=0,endRow:o=1/0}=t,s=r.length;let c=s,f=s;for(let S=0;S<s;S++){const D=e(r[S]);if(c>S&&D>=i&&(c=S),D>=o){f=S;break}}let _=c;const T=f-c!==n.length?r.slice(f):void 0;for(let S=0;S<n.length;S++)r[_++]=n[S];if(T){for(let S=0;S<T.length;S++)r[_++]=T[S];r.length=_}return{startRow:c,endRow:c+n.length}}const dk=[0,0,0,255],Yle=[0,0,0,255],qle={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:r=>r.polygon},getFillColor:{type:"accessor",value:Yle},getLineColor:{type:"accessor",value:dk},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class ef extends ys{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&$r.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const n=this.state.paths.slice(),i=e.dataChanged.map(o=>hk({data:n,getIndex:s=>s.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:n,pathsDiff:i})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:o}=this.props,s=[],c=i==="XY"?2:3,{startRow:f,endRow:_}=e,{iterable:b,objectInfo:T}=sl(t,f,_);for(const S of b){T.index++;let D=n(S,T);o&&(D=uk(D,c));const{holeIndices:N}=D,G=D.positions||D;if(N)for(let W=0;W<=N.length;W++){const z=G.slice(N[W-1]||0,N[W]||G.length);s.push(this.getSubLayerRow({path:z},S,T.index))}else s.push(this.getSubLayerRow({path:G},S,T.index))}return s}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:o,wireframe:s,_normalize:c,_windingOrder:f,elevationScale:_,transitions:b,positionFormat:T}=this.props,{lineWidthUnits:S,lineWidthScale:D,lineWidthMinPixels:N,lineWidthMaxPixels:G,lineJointRounded:W,lineMiterLimit:z,lineDashJustified:j}=this.props,{getFillColor:K,getLineColor:fe,getLineWidth:Z,getLineDashArray:ae,getElevation:Be,getPolygon:Le,updateTriggers:de,material:_e}=this.props,{paths:pe,pathsDiff:J}=this.state,ne=this.getSubLayerClass("fill",Qu),ye=this.getSubLayerClass("stroke",Zu),Ye=this.shouldRenderSubLayer("fill",pe)&&new ne({_dataDiff:t,extruded:o,elevationScale:_,filled:i,wireframe:s,_normalize:c,_windingOrder:f,getElevation:Be,getFillColor:K,getLineColor:o&&s?fe:dk,material:_e,transitions:b},this.getSubLayerProps({id:"fill",updateTriggers:de&&{getPolygon:de.getPolygon,getElevation:de.getElevation,getFillColor:de.getFillColor,lineColors:o&&s,getLineColor:de.getLineColor}}),{data:e,positionFormat:T,getPolygon:Le}),we=!o&&n&&this.shouldRenderSubLayer("stroke",pe)&&new ye({_dataDiff:J&&(()=>J),widthUnits:S,widthScale:D,widthMinPixels:N,widthMaxPixels:G,jointRounded:W,miterLimit:z,dashJustified:j,_pathType:"loop",transitions:b&&{getWidth:b.getLineWidth,getColor:b.getLineColor,getPath:b.getPolygon},getColor:this.getSubLayerAccessor(fe),getWidth:this.getSubLayerAccessor(Z),getDashArray:this.getSubLayerAccessor(ae)},this.getSubLayerProps({id:"stroke",updateTriggers:de&&{getWidth:de.getLineWidth,getColor:de.getLineColor,getDashArray:de.getLineDashArray}}),{data:pe,positionFormat:T,getPath:Ne=>Ne.path});return[!o&&Ye,we,o&&Ye]}}ef.layerName="PolygonLayer";ef.defaultProps=qle;function Zle(r,e){if(!r)return null;const t="startIndices"in r?r.startIndices[e]:e,n=r.featureIds.value[t];return t!==-1?Qle(r,n,t):null}function Qle(r,e,t){const n={properties:{...r.properties[e]}};for(const i in r.numericProps)n.properties[i]=r.numericProps[i].value[t];return n}function eue(r,e){const t={points:null,lines:null,polygons:null};for(const n in t){const i=r[n].globalFeatureIds.value;t[n]=new Uint8ClampedArray(i.length*4);const o=[];for(let s=0;s<i.length;s++)e(i[s],o),t[n][s*4+0]=o[0],t[n][s*4+1]=o[1],t[n][s*4+2]=o[2],t[n][s*4+3]=255}return t}const ZM=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,tue={name:"sdf",vs:ZM,fs:ZM,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},rue=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Hb=192/256,QM=[],nue={getIconOffsets:{type:"accessor",value:r=>r.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Sy extends DA{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,tue],fs:rue}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:n,target:i})=>this.encodePickingColor(n,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&$r.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:o}=this.state,s=i?Math.max(n,Hb*(1-i)):-1,c=this.state.model,f={buffer:Hb,outlineBuffer:s,gamma:n,enabled:!!t,outlineColor:o};if(c.shaderInputs.setProps({sdf:f}),super.draw(e),t&&i){const{iconManager:_}=this.state;_.getTexture()&&(c.shaderInputs.setProps({sdf:{...f,outlineBuffer:Hb}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):QM}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):QM}}Sy.defaultProps=nue;Sy.layerName="MultiIconLayer";const S_=1e20;class iue{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:s="normal",fontStyle:c="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;const f=this.size=e+t*4,_=this._createCanvas(f),b=this.ctx=_.getContext("2d",{willReadFrequently:!0});b.font=`${c} ${s} ${e}px ${o}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:s}=this.ctx.measureText(e),c=Math.ceil(n),f=0,_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-o))),b=Math.min(this.size-this.buffer,c+Math.ceil(i)),T=_+2*this.buffer,S=b+2*this.buffer,D=Math.max(T*S,0),N=new Uint8ClampedArray(D),G={data:N,width:T,height:S,glyphWidth:_,glyphHeight:b,glyphTop:c,glyphLeft:f,glyphAdvance:t};if(_===0||b===0)return G;const{ctx:W,buffer:z,gridInner:j,gridOuter:K}=this;W.clearRect(z,z,_,b),W.fillText(e,z,z+c);const fe=W.getImageData(z,z,_,b);K.fill(S_,0,D),j.fill(0,0,D);for(let Z=0;Z<b;Z++)for(let ae=0;ae<_;ae++){const Be=fe.data[4*(Z*_+ae)+3]/255;if(Be===0)continue;const Le=(Z+z)*T+ae+z;if(Be===1)K[Le]=0,j[Le]=S_;else{const de=.5-Be;K[Le]=de>0?de*de:0,j[Le]=de<0?de*de:0}}eP(K,0,0,T,S,T,this.f,this.v,this.z),eP(j,z,z,_,b,T,this.f,this.v,this.z);for(let Z=0;Z<D;Z++){const ae=Math.sqrt(K[Z])-Math.sqrt(j[Z]);N[Z]=Math.round(255-255*(ae/this.radius+this.cutoff))}return G}}function eP(r,e,t,n,i,o,s,c,f){for(let _=e;_<e+n;_++)tP(r,t*o+_,o,i,s,c,f);for(let _=t;_<t+i;_++)tP(r,_*o+e,1,n,s,c,f)}function tP(r,e,t,n,i,o,s){o[0]=0,s[0]=-1e20,s[1]=S_,i[0]=r[e];for(let c=1,f=0,_=0;c<n;c++){i[c]=r[e+c*t];const b=c*c;do{const T=o[f];_=(i[c]-i[T]+b-T*T)/(c-T)/2}while(_<=s[f]&&--f>-1);f++,o[f]=c,s[f]=_,s[f+1]=S_}for(let c=0,f=0;c<n;c++){for(;s[f+1]<c;)f++;const _=o[f],b=c-_;r[e+c*t]=i[_]+b*b}}const sue=32,oue=[];function aue(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function cue({characterSet:r,getFontWidth:e,fontHeight:t,buffer:n,maxCanvasWidth:i,mapping:o={},xOffset:s=0,yOffset:c=0}){let f=0,_=s;const b=t+n*2;for(const T of r)if(!o[T]){const S=e(T);_+S+n*2>i&&(_=0,f++),o[T]={x:_+n,y:c+f*b+n,width:S,height:b,layoutWidth:S,layoutHeight:t},_+=S+n*2}return{mapping:o,xOffset:_,yOffset:c+f*b,canvasHeight:aue(c+(f+1)*b)}}function Ak(r,e,t,n){var o;let i=0;for(let s=e;s<t;s++){const c=r[s];i+=((o=n[c])==null?void 0:o.layoutWidth)||0}return i}function pk(r,e,t,n,i,o){let s=e,c=0;for(let f=e;f<t;f++){const _=Ak(r,f,f+1,i);c+_>n&&(s<f&&o.push(f),s=f,c=0),c+=_}return c}function lue(r,e,t,n,i,o){let s=e,c=e,f=e,_=0;for(let b=e;b<t;b++)if((r[b]===" "||r[b+1]===" "||b+1===t)&&(f=b+1),f>c){let T=Ak(r,c,f,i);_+T>n&&(s<c&&(o.push(c),s=c,_=0),T>n&&(T=pk(r,c,f,n,i,o),s=o[o.length-1])),c=f,_+=T}return _}function uue(r,e,t,n,i=0,o){o===void 0&&(o=r.length);const s=[];return e==="break-all"?pk(r,i,o,t,n,s):lue(r,i,o,t,n,s),s}function fue(r,e,t,n,i,o){let s=0,c=0;for(let f=e;f<t;f++){const _=r[f],b=n[_];b?(c||(c=b.layoutHeight),i[f]=s+b.layoutWidth/2,s+=b.layoutWidth):($r.warn(`Missing character: ${_} (${_.codePointAt(0)})`)(),i[f]=s,s+=sue)}o[0]=s,o[1]=c}function hue(r,e,t,n,i){var W;const o=Array.from(r),s=o.length,c=new Array(s),f=new Array(s),_=new Array(s),b=(t==="break-word"||t==="break-all")&&isFinite(n)&&n>0,T=[0,0],S=[0,0];let D=0,N=0,G=0;for(let z=0;z<=s;z++){const j=o[z];if((j===`
`||z===s)&&(G=z),G>N){const K=b?uue(o,t,n,i,N,G):oue;for(let fe=0;fe<=K.length;fe++){const Z=fe===0?N:K[fe-1],ae=fe<K.length?K[fe]:G;fue(o,Z,ae,i,c,S);for(let Be=Z;Be<ae;Be++){c[Be]-S[0]/2;const Le=o[Be],de=((W=i[Le])==null?void 0:W.layoutOffsetY)||0;f[Be]=D+S[1]/2+de,_[Be]=S[0]}D=D+S[1]*e,T[0]=Math.max(T[0],S[0])}N=G}j===`
`&&(c[N]=0,f[N]=0,_[N]=0,N++)}return T[1]=D,{x:c,y:f,rowWidth:_,size:T}}function due({value:r,length:e,stride:t,offset:n,startIndices:i,characterSet:o}){const s=r.BYTES_PER_ELEMENT,c=t?t/s:1,f=n?n/s:0,_=i[e]||Math.ceil((r.length-f)/c),b=o&&new Set,T=new Array(e);let S=r;if(c>1||f>0){const D=r.constructor;S=new D(_);for(let N=0;N<_;N++)S[N]=r[N*c+f]}for(let D=0;D<e;D++){const N=i[D],G=i[D+1]||_,W=S.subarray(N,G);T[D]=String.fromCodePoint.apply(null,W),b&&W.forEach(b.add,b)}if(b)for(const D of b)o.add(String.fromCodePoint(D));return{texts:T,characterCount:_}}class gk{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function Aue(){const r=[];for(let e=32;e<128;e++)r.push(String.fromCharCode(e));return r}const fA={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Aue(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},rP=1024,nP=.9,iP=1.2,mk=3;let I_=new gk(mk);function pue(r,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const n=I_.get(r);if(!n)return t;for(const i in n.mapping)t.has(i)&&t.delete(i);return t}function gue(r,e){for(let t=0;t<r.length;t++)e.data[4*t+3]=r[t]}function sP(r,e,t,n){r.font=`${n} ${t}px ${e}`,r.fillStyle="#000",r.textBaseline="alphabetic",r.textAlign="left"}function mue(r){$r.assert(Number.isFinite(r)&&r>=mk,"Invalid cache limit"),I_=new gk(r)}class _ue{constructor(){this.props={...fA}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*iP+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=pue(this._key,this.props.characterSet),n=I_.get(this._key);if(n&&t.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(t,n);this._atlas=i,I_.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:i,fontSize:o,buffer:s,sdf:c,radius:f,cutoff:_}=this.props;let b=t&&t.data;b||(b=document.createElement("canvas"),b.width=rP);const T=b.getContext("2d",{willReadFrequently:!0});sP(T,n,o,i);const{mapping:S,canvasHeight:D,xOffset:N,yOffset:G}=cue({getFontWidth:W=>T.measureText(W).width,fontHeight:o*iP,buffer:s,characterSet:e,maxCanvasWidth:rP,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(b.height!==D){const W=T.getImageData(0,0,b.width,b.height);b.height=D,T.putImageData(W,0,0)}if(sP(T,n,o,i),c){const W=new iue({fontSize:o,buffer:s,radius:f,cutoff:_,fontFamily:n,fontWeight:`${i}`});for(const z of e){const{data:j,width:K,height:fe,glyphTop:Z}=W.draw(z);S[z].width=K,S[z].layoutOffsetY=o*nP-Z;const ae=T.createImageData(K,fe);gue(j,ae),T.putImageData(ae,S[z].x,S[z].y)}}else for(const W of e)T.fillText(W,S[W].x,S[W].y+s+o*nP);return{xOffset:N,yOffset:G,mapping:S,data:b,width:b.width,height:b.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:o,radius:s,cutoff:c}=this.props;return o?`${e} ${t} ${n} ${i} ${s} ${c}`:`${e} ${t} ${n} ${i}`}}const oP=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,yue={name:"textBackground",vs:oP,fs:oP,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},vue=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,bue=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,xue={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:r=>r.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Og extends _s{getShaders(){return super.getShaders({vs:vue,fs:bue,modules:[Is,ca,yue]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:c}=this.props;let{padding:f,borderRadius:_}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]),Array.isArray(_)||(_=[_,_,_,_]);const b=this.state.model,T={billboard:t,stroked:!!c,borderRadius:_,padding:f,sizeUnits:xo[i],sizeScale:n,sizeMinPixels:o,sizeMaxPixels:s};b.shaderInputs.setProps({textBackground:T}),b.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Og.defaultProps=xue;Og.layerName="TextBackgroundLayer";const aP={start:1,middle:0,end:-1},cP={top:1,center:0,bottom:-1},jb=[0,0,0,255],wue=1,Cue={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:jb},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:fA.characterSet},fontFamily:fA.fontFamily,fontWeight:fA.fontWeight,lineHeight:wue,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:jb},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:r=>r.text},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:jb},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Ah extends ys{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,i]}=this.transformParagraph(e,t);const{fontSize:o}=this.state.fontAtlasManager.props;n/=o,i/=o;const{getTextAnchor:s,getAlignmentBaseline:c}=this.props,f=aP[typeof s=="function"?s(e,t):s],_=cP[typeof c=="function"?c(e,t):c];return[(f-1)*n/2,(_-1)*i/2,n,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:o,y:s,rowWidth:c,size:[f,_]}=this.transformParagraph(e,t),b=aP[typeof n=="function"?n(e,t):n],T=cP[typeof i=="function"?i(e,t):i],S=o.length,D=new Array(S*2);let N=0;for(let G=0;G<S;G++){const W=(1-b)*(f-c[G])/2;D[N++]=(b-1)*f/2+W+o[G],D[N++]=(T-1)*_/2+s[G]}return D}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new _ue},this.props.maxWidth>0&&$r.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,s={...e,characterSet:o,fontFamily:t,fontWeight:n};if(!i.mapping)return i.setProps(s),!0;for(const c in s)if(s[c]!==i.props[c])return i.setProps(s),!0;return!1}_updateText(){var f;const{data:e,characterSet:t}=this.props,n=(f=e.attributes)==null?void 0:f.getText;let{getText:i}=this.props,o=e.startIndices,s;const c=t==="auto"&&new Set;if(n&&o){const{texts:_,characterCount:b}=due({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:c});s=b,i=(T,{index:S})=>_[S]}else{const{iterable:_,objectInfo:b}=sl(e);o=[0],s=0;for(const T of _){b.index++;const S=Array.from(i(T,b)||"");c&&S.forEach(c.add,c),s+=S.length,o.push(s)}}this.setState({getText:i,startIndices:o,numInstances:s,characterSet:c||t})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,i=n.mapping,o=this.state.getText,{wordBreak:s,lineHeight:c,maxWidth:f}=this.props,_=o(e,t)||"";return hue(_,c,s,f*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,atlas:o,mapping:s},styleVersion:c}=this.state,{data:f,_dataDiff:_,getPosition:b,getColor:T,getSize:S,getAngle:D,getPixelOffset:N,getBackgroundColor:G,getBorderColor:W,getBorderWidth:z,backgroundBorderRadius:j,backgroundPadding:K,background:fe,billboard:Z,fontSettings:ae,outlineWidth:Be,outlineColor:Le,sizeScale:de,sizeUnits:_e,sizeMinPixels:pe,sizeMaxPixels:J,transitions:ne,updateTriggers:ye}=this.props,Ye=this.getSubLayerClass("characters",Sy),we=this.getSubLayerClass("background",Og);return[fe&&new we({getFillColor:G,getLineColor:W,getLineWidth:z,borderRadius:j,padding:K,getPosition:b,getSize:S,getAngle:D,getPixelOffset:N,billboard:Z,sizeScale:de,sizeUnits:_e,sizeMinPixels:pe,sizeMaxPixels:J,transitions:ne&&{getPosition:ne.getPosition,getAngle:ne.getAngle,getSize:ne.getSize,getFillColor:ne.getBackgroundColor,getLineColor:ne.getBorderColor,getLineWidth:ne.getBorderWidth,getPixelOffset:ne.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ye.getPosition,getAngle:ye.getAngle,getSize:ye.getSize,getFillColor:ye.getBackgroundColor,getLineColor:ye.getBorderColor,getLineWidth:ye.getBorderWidth,getPixelOffset:ye.getPixelOffset,getBoundingRect:{getText:ye.getText,getTextAnchor:ye.getTextAnchor,getAlignmentBaseline:ye.getAlignmentBaseline,styleVersion:c}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:_,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Ye({sdf:ae.sdf,smoothing:Number.isFinite(ae.smoothing)?ae.smoothing:fA.smoothing,outlineWidth:Be/(ae.radius||fA.radius),outlineColor:Le,iconAtlas:o,iconMapping:s,getPosition:b,getColor:T,getSize:S,getAngle:D,getPixelOffset:N,billboard:Z,sizeScale:de*i,sizeUnits:_e,sizeMinPixels:pe*i,sizeMaxPixels:J*i,transitions:ne&&{getPosition:ne.getPosition,getAngle:ne.getAngle,getColor:ne.getColor,getSize:ne.getSize,getPixelOffset:ne.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ye.getText,getPosition:ye.getPosition,getAngle:ye.getAngle,getColor:ye.getColor,getSize:ye.getSize,getPixelOffset:ye.getPixelOffset,getIconOffsets:{getTextAnchor:ye.getTextAnchor,getAlignmentBaseline:ye.getAlignmentBaseline,styleVersion:c}}}),{data:f,_dataDiff:_,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){mue(e)}}Ah.defaultProps=Cue;Ah.layerName="TextLayer";const Dm={circle:{type:Fg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:DA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Ah,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Lm={type:Zu,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},xx={type:Qu,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function wp({type:r,props:e}){const t={};for(const n in e)t[n]=r.defaultProps[e[n]];return t}function $b(r,e){const{transitions:t,updateTriggers:n}=r.props,i={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const o in e){const s=e[o];let c=r.props[o];o.startsWith("get")&&(c=r.getSubLayerAccessor(c),i.updateTriggers[s]=n[o],t&&(i.transitions[s]=t[o])),i[s]=c}return i}function Eue(r){if(Array.isArray(r))return r;switch($r.assert(r.type,"GeoJSON does not have type"),r.type){case"Feature":return[r];case"FeatureCollection":return $r.assert(Array.isArray(r.features),"GeoJSON does not have features array"),r.features;default:return[{geometry:r}]}}function lP(r,e,t={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:o=r.length}=t;for(let s=i;s<o;s++){const c=r[s],{geometry:f}=c;if(f)if(f.type==="GeometryCollection"){$r.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:_}=f;for(let b=0;b<_.length;b++){const T=_[b];uP(T,n,e,c,s)}}else uP(f,n,e,c,s)}return n}function uP(r,e,t,n,i){const{type:o,coordinates:s}=r,{pointFeatures:c,lineFeatures:f,polygonFeatures:_,polygonOutlineFeatures:b}=e;if(!Bue(o,s)){$r.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":c.push(t({geometry:r},n,i));break;case"MultiPoint":s.forEach(T=>{c.push(t({geometry:{type:"Point",coordinates:T}},n,i))});break;case"LineString":f.push(t({geometry:r},n,i));break;case"MultiLineString":s.forEach(T=>{f.push(t({geometry:{type:"LineString",coordinates:T}},n,i))});break;case"Polygon":_.push(t({geometry:r},n,i)),s.forEach(T=>{b.push(t({geometry:{type:"LineString",coordinates:T}},n,i))});break;case"MultiPolygon":s.forEach(T=>{_.push(t({geometry:{type:"Polygon",coordinates:T}},n,i)),T.forEach(S=>{b.push(t({geometry:{type:"LineString",coordinates:S}},n,i))})});break}}const Tue={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Bue(r,e){let t=Tue[r];for($r.assert(t,`Unknown GeoJSON type ${r}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function _k(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Z0(r){return r.geometry.coordinates}function Sue(r,e){const t=_k(),{pointFeatures:n,lineFeatures:i,polygonFeatures:o,polygonOutlineFeatures:s}=r;return t.points.data=n,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=Z0,t.lines.data=i,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=Z0,t.polygons.data=o,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=Z0,t.polygonsOutline.data=s,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=Z0,t}function Iue(r,e){const t=_k(),{points:n,lines:i,polygons:o}=r,s=eue(r,e);return t.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:s.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:s.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}const Mue=["points","linestrings","polygons"],Pue={...wp(Dm.circle),...wp(Dm.icon),...wp(Dm.text),...wp(Lm),...wp(xx),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:r=>r.properties.icon},getText:{type:"accessor",value:r=>r.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Wl extends ys{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=Iue(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=Eue(e.data),i=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(t.dataChanged)){const f=this.state.features;for(const _ in f)o[_]=f[_].slice(),s[_]=[];for(const _ of t.dataChanged){const b=lP(n,i,_);for(const T in f)s[T].push(hk({data:o[T],getIndex:S=>S.__source.index,dataRange:_,replace:b[T]}))}}else o=lP(n,i);const c=Sue(o,s);this.setState({features:o,featuresDiff:s,layerProps:c})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=Mue.find(o=>i.id.startsWith(`${this.id}-${o}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var s;const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",o=this.shouldRenderSubLayer(i,(s=n.polygons)==null?void 0:s.data)&&this.getSubLayerClass(i,xx.type);if(o){const c=$b(this,xx.props),f=e&&t;return f||delete c.getLineColor,c.updateTriggers.lineColors=f,new o(c,this.getSubLayerProps({id:i,updateTriggers:c.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var f,_;const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",o="linestrings",s=!e&&t&&this.shouldRenderSubLayer(i,(f=n.polygonsOutline)==null?void 0:f.data)&&this.getSubLayerClass(i,Lm.type),c=this.shouldRenderSubLayer(o,(_=n.lines)==null?void 0:_.data)&&this.getSubLayerClass(o,Lm.type);if(s||c){const b=$b(this,Lm.props);return[s&&new s(b,this.getSubLayerProps({id:i,updateTriggers:b.updateTriggers}),n.polygonsOutline),c&&new c(b,this.getSubLayerProps({id:o,updateTriggers:b.updateTriggers}),n.lines)]}return null}_renderPointLayers(){var c;const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex(f=>f.__source.index===i));const o=new Set(e.split("+")),s=[];for(const f of o){const _=`points-${f}`,b=Dm[f],T=b&&this.shouldRenderSubLayer(_,(c=t.points)==null?void 0:c.data)&&this.getSubLayerClass(_,b.type);if(T){const S=$b(this,b.props);let D=t.points;if(f==="text"&&n){const{instancePickingColors:N,...G}=D.data.attributes;D={...D,data:{...D.data,attributes:G}}}s.push(new T(S,this.getSubLayerProps({id:_,updateTriggers:S.updateTriggers,highlightedObjectIndex:i}),D))}}return s}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&t,n,i,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:o,index:s}=i,c=Zle(o,s);return e(c,i)}}}Wl.layerName="GeoJsonLayer";Wl.defaultProps=Pue;const Rue=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:Pg,BitmapLayer:Ty,ColumnLayer:ol,GeoJsonLayer:Wl,GridCellLayer:pC,IconLayer:DA,LineLayer:By,PathLayer:Zu,PointCloudLayer:Rg,PolygonLayer:ef,ScatterplotLayer:Fg,SolidPolygonLayer:Qu,TextLayer:Ah,_MultiIconLayer:Sy,_TextBackgroundLayer:Og},Symbol.toStringTag,{value:"Module"}));function Fue(r){return typeof r=="string"?r.charAt(0).toLowerCase()+r.slice(1):r}function wx(r){if(Array.isArray(r))return r.map(e=>wx(e));if(r&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[Fue(t)]=wx(n);return e}return r}var Wb={},Jb={},fP;function gC(){return fP||(fP=1,function(r){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+e+"]["+t+"]*",i=new RegExp("^"+n+"$"),o=function(c,f){const _=[];let b=f.exec(c);for(;b;){const T=[];T.startIndex=f.lastIndex-b[0].length;const S=b.length;for(let D=0;D<S;D++)T.push(b[D]);_.push(T),b=f.exec(c)}return _},s=function(c){const f=i.exec(c);return!(f===null||typeof f>"u")};r.isExist=function(c){return typeof c<"u"},r.isEmptyObject=function(c){return Object.keys(c).length===0},r.merge=function(c,f,_){if(f){const b=Object.keys(f),T=b.length;for(let S=0;S<T;S++)_==="strict"?c[b[S]]=[f[b[S]]]:c[b[S]]=f[b[S]]}},r.getValue=function(c){return r.isExist(c)?c:""},r.isName=s,r.getAllMatches=o,r.nameRegexp=n}(Jb)),Jb}var hP;function yk(){if(hP)return Wb;hP=1;const r=gC(),e={allowBooleanAttributes:!1,unpairedTags:[]};Wb.validate=function(z,j){j=Object.assign({},e,j);const K=[];let fe=!1,Z=!1;z[0]==="\uFEFF"&&(z=z.substr(1));for(let ae=0;ae<z.length;ae++)if(z[ae]==="<"&&z[ae+1]==="?"){if(ae+=2,ae=n(z,ae),ae.err)return ae}else if(z[ae]==="<"){let Be=ae;if(ae++,z[ae]==="!"){ae=i(z,ae);continue}else{let Le=!1;z[ae]==="/"&&(Le=!0,ae++);let de="";for(;ae<z.length&&z[ae]!==">"&&z[ae]!==" "&&z[ae]!=="	"&&z[ae]!==`
`&&z[ae]!=="\r";ae++)de+=z[ae];if(de=de.trim(),de[de.length-1]==="/"&&(de=de.substring(0,de.length-1),ae--),!N(de)){let J;return de.trim().length===0?J="Invalid space after '<'.":J="Tag '"+de+"' is an invalid name.",S("InvalidTag",J,G(z,ae))}const _e=c(z,ae);if(_e===!1)return S("InvalidAttr","Attributes for '"+de+"' have open quote.",G(z,ae));let pe=_e.value;if(ae=_e.index,pe[pe.length-1]==="/"){const J=ae-pe.length;pe=pe.substring(0,pe.length-1);const ne=_(pe,j);if(ne===!0)fe=!0;else return S(ne.err.code,ne.err.msg,G(z,J+ne.err.line))}else if(Le)if(_e.tagClosed){if(pe.trim().length>0)return S("InvalidTag","Closing tag '"+de+"' can't have attributes or invalid starting.",G(z,Be));if(K.length===0)return S("InvalidTag","Closing tag '"+de+"' has not been opened.",G(z,Be));{const J=K.pop();if(de!==J.tagName){let ne=G(z,J.tagStartPos);return S("InvalidTag","Expected closing tag '"+J.tagName+"' (opened in line "+ne.line+", col "+ne.col+") instead of closing tag '"+de+"'.",G(z,Be))}K.length==0&&(Z=!0)}}else return S("InvalidTag","Closing tag '"+de+"' doesn't have proper closing.",G(z,ae));else{const J=_(pe,j);if(J!==!0)return S(J.err.code,J.err.msg,G(z,ae-pe.length+J.err.line));if(Z===!0)return S("InvalidXml","Multiple possible root nodes found.",G(z,ae));j.unpairedTags.indexOf(de)!==-1||K.push({tagName:de,tagStartPos:Be}),fe=!0}for(ae++;ae<z.length;ae++)if(z[ae]==="<")if(z[ae+1]==="!"){ae++,ae=i(z,ae);continue}else if(z[ae+1]==="?"){if(ae=n(z,++ae),ae.err)return ae}else break;else if(z[ae]==="&"){const J=T(z,ae);if(J==-1)return S("InvalidChar","char '&' is not expected.",G(z,ae));ae=J}else if(Z===!0&&!t(z[ae]))return S("InvalidXml","Extra text at the end",G(z,ae));z[ae]==="<"&&ae--}}else{if(t(z[ae]))continue;return S("InvalidChar","char '"+z[ae]+"' is not expected.",G(z,ae))}if(fe){if(K.length==1)return S("InvalidTag","Unclosed tag '"+K[0].tagName+"'.",G(z,K[0].tagStartPos));if(K.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(K.map(ae=>ae.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function t(z){return z===" "||z==="	"||z===`
`||z==="\r"}function n(z,j){const K=j;for(;j<z.length;j++)if(z[j]=="?"||z[j]==" "){const fe=z.substr(K,j-K);if(j>5&&fe==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",G(z,j));if(z[j]=="?"&&z[j+1]==">"){j++;break}else continue}return j}function i(z,j){if(z.length>j+5&&z[j+1]==="-"&&z[j+2]==="-"){for(j+=3;j<z.length;j++)if(z[j]==="-"&&z[j+1]==="-"&&z[j+2]===">"){j+=2;break}}else if(z.length>j+8&&z[j+1]==="D"&&z[j+2]==="O"&&z[j+3]==="C"&&z[j+4]==="T"&&z[j+5]==="Y"&&z[j+6]==="P"&&z[j+7]==="E"){let K=1;for(j+=8;j<z.length;j++)if(z[j]==="<")K++;else if(z[j]===">"&&(K--,K===0))break}else if(z.length>j+9&&z[j+1]==="["&&z[j+2]==="C"&&z[j+3]==="D"&&z[j+4]==="A"&&z[j+5]==="T"&&z[j+6]==="A"&&z[j+7]==="["){for(j+=8;j<z.length;j++)if(z[j]==="]"&&z[j+1]==="]"&&z[j+2]===">"){j+=2;break}}return j}const o='"',s="'";function c(z,j){let K="",fe="",Z=!1;for(;j<z.length;j++){if(z[j]===o||z[j]===s)fe===""?fe=z[j]:fe!==z[j]||(fe="");else if(z[j]===">"&&fe===""){Z=!0;break}K+=z[j]}return fe!==""?!1:{value:K,index:j,tagClosed:Z}}const f=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function _(z,j){const K=r.getAllMatches(z,f),fe={};for(let Z=0;Z<K.length;Z++){if(K[Z][1].length===0)return S("InvalidAttr","Attribute '"+K[Z][2]+"' has no space in starting.",W(K[Z]));if(K[Z][3]!==void 0&&K[Z][4]===void 0)return S("InvalidAttr","Attribute '"+K[Z][2]+"' is without value.",W(K[Z]));if(K[Z][3]===void 0&&!j.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+K[Z][2]+"' is not allowed.",W(K[Z]));const ae=K[Z][2];if(!D(ae))return S("InvalidAttr","Attribute '"+ae+"' is an invalid name.",W(K[Z]));if(!fe.hasOwnProperty(ae))fe[ae]=1;else return S("InvalidAttr","Attribute '"+ae+"' is repeated.",W(K[Z]))}return!0}function b(z,j){let K=/\d/;for(z[j]==="x"&&(j++,K=/[\da-fA-F]/);j<z.length;j++){if(z[j]===";")return j;if(!z[j].match(K))break}return-1}function T(z,j){if(j++,z[j]===";")return-1;if(z[j]==="#")return j++,b(z,j);let K=0;for(;j<z.length;j++,K++)if(!(z[j].match(/\w/)&&K<20)){if(z[j]===";")break;return-1}return j}function S(z,j,K){return{err:{code:z,msg:j,line:K.line||K,col:K.col}}}function D(z){return r.isName(z)}function N(z){return r.isName(z)}function G(z,j){const K=z.substring(0,j).split(/\r?\n/);return{line:K.length,col:K[K.length-1].length+1}}function W(z){return z.startIndex+z[1].length}return Wb}var Q0={},dP;function Oue(){if(dP)return Q0;dP=1;const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,n){return n},attributeValueProcessor:function(t,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,n,i){return t}},e=function(t){return Object.assign({},r,t)};return Q0.buildOptions=e,Q0.defaultOptions=r,Q0}var Xb,AP;function Due(){if(AP)return Xb;AP=1;class r{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,n){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:n})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}return Xb=r,Xb}var Kb,pP;function Lue(){if(pP)return Kb;pP=1;const r=gC();function e(_,b){const T={};if(_[b+3]==="O"&&_[b+4]==="C"&&_[b+5]==="T"&&_[b+6]==="Y"&&_[b+7]==="P"&&_[b+8]==="E"){b=b+9;let S=1,D=!1,N=!1,G="";for(;b<_.length;b++)if(_[b]==="<"&&!N){if(D&&i(_,b))b+=7,[entityName,val,b]=t(_,b+1),val.indexOf("&")===-1&&(T[f(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(D&&o(_,b))b+=8;else if(D&&s(_,b))b+=8;else if(D&&c(_,b))b+=9;else if(n)N=!0;else throw new Error("Invalid DOCTYPE");S++,G=""}else if(_[b]===">"){if(N?_[b-1]==="-"&&_[b-2]==="-"&&(N=!1,S--):S--,S===0)break}else _[b]==="["?D=!0:G+=_[b];if(S!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:T,i:b}}function t(_,b){let T="";for(;b<_.length&&_[b]!=="'"&&_[b]!=='"';b++)T+=_[b];if(T=T.trim(),T.indexOf(" ")!==-1)throw new Error("External entites are not supported");const S=_[b++];let D="";for(;b<_.length&&_[b]!==S;b++)D+=_[b];return[T,D,b]}function n(_,b){return _[b+1]==="!"&&_[b+2]==="-"&&_[b+3]==="-"}function i(_,b){return _[b+1]==="!"&&_[b+2]==="E"&&_[b+3]==="N"&&_[b+4]==="T"&&_[b+5]==="I"&&_[b+6]==="T"&&_[b+7]==="Y"}function o(_,b){return _[b+1]==="!"&&_[b+2]==="E"&&_[b+3]==="L"&&_[b+4]==="E"&&_[b+5]==="M"&&_[b+6]==="E"&&_[b+7]==="N"&&_[b+8]==="T"}function s(_,b){return _[b+1]==="!"&&_[b+2]==="A"&&_[b+3]==="T"&&_[b+4]==="T"&&_[b+5]==="L"&&_[b+6]==="I"&&_[b+7]==="S"&&_[b+8]==="T"}function c(_,b){return _[b+1]==="!"&&_[b+2]==="N"&&_[b+3]==="O"&&_[b+4]==="T"&&_[b+5]==="A"&&_[b+6]==="T"&&_[b+7]==="I"&&_[b+8]==="O"&&_[b+9]==="N"}function f(_){if(r.isName(_))return _;throw new Error(`Invalid entity name ${_}`)}return Kb=e,Kb}var Yb,gP;function kue(){if(gP)return Yb;gP=1;const r=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const t={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(o,s={}){if(s=Object.assign({},t,s),!o||typeof o!="string")return o;let c=o.trim();if(s.skipLike!==void 0&&s.skipLike.test(c))return o;if(s.hex&&r.test(c))return Number.parseInt(c,16);{const f=e.exec(c);if(f){const _=f[1],b=f[2];let T=i(f[3]);const S=f[4]||f[6];if(!s.leadingZeros&&b.length>0&&_&&c[2]!==".")return o;if(!s.leadingZeros&&b.length>0&&!_&&c[1]!==".")return o;{const D=Number(c),N=""+D;return N.search(/[eE]/)!==-1||S?s.eNotation?D:o:c.indexOf(".")!==-1?N==="0"&&T===""||N===T||_&&N==="-"+T?D:o:b?T===N||_+T===N?D:o:c===N||c===_+N?D:o}}else return o}}function i(o){return o&&o.indexOf(".")!==-1&&(o=o.replace(/0+$/,""),o==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o}return Yb=n,Yb}var qb,mP;function vk(){if(mP)return qb;mP=1;function r(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const n of e)if(typeof n=="string"&&t===n||n instanceof RegExp&&n.test(t))return!0}:()=>!1}return qb=r,qb}var Zb,_P;function Nue(){if(_P)return Zb;_P=1;const r=gC(),e=Due(),t=Lue(),n=kue(),i=vk();class o{constructor(ae){this.options=ae,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(Be,Le)=>String.fromCharCode(Number.parseInt(Le,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(Be,Le)=>String.fromCharCode(Number.parseInt(Le,16))}},this.addExternalEntities=s,this.parseXml=T,this.parseTextData=c,this.resolveNameSpace=f,this.buildAttributesMap=b,this.isItStopNode=G,this.replaceEntitiesValue=D,this.readStopNodeData=K,this.saveTextToParentTag=N,this.addChild=S,this.ignoreAttributesFn=i(this.options.ignoreAttributes)}}function s(Z){const ae=Object.keys(Z);for(let Be=0;Be<ae.length;Be++){const Le=ae[Be];this.lastEntities[Le]={regex:new RegExp("&"+Le+";","g"),val:Z[Le]}}}function c(Z,ae,Be,Le,de,_e,pe){if(Z!==void 0&&(this.options.trimValues&&!Le&&(Z=Z.trim()),Z.length>0)){pe||(Z=this.replaceEntitiesValue(Z));const J=this.options.tagValueProcessor(ae,Z,Be,de,_e);return J==null?Z:typeof J!=typeof Z||J!==Z?J:this.options.trimValues?fe(Z,this.options.parseTagValue,this.options.numberParseOptions):Z.trim()===Z?fe(Z,this.options.parseTagValue,this.options.numberParseOptions):Z}}function f(Z){if(this.options.removeNSPrefix){const ae=Z.split(":"),Be=Z.charAt(0)==="/"?"/":"";if(ae[0]==="xmlns")return"";ae.length===2&&(Z=Be+ae[1])}return Z}const _=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function b(Z,ae,Be){if(this.options.ignoreAttributes!==!0&&typeof Z=="string"){const Le=r.getAllMatches(Z,_),de=Le.length,_e={};for(let pe=0;pe<de;pe++){const J=this.resolveNameSpace(Le[pe][1]);if(this.ignoreAttributesFn(J,ae))continue;let ne=Le[pe][4],ye=this.options.attributeNamePrefix+J;if(J.length)if(this.options.transformAttributeName&&(ye=this.options.transformAttributeName(ye)),ye==="__proto__"&&(ye="#__proto__"),ne!==void 0){this.options.trimValues&&(ne=ne.trim()),ne=this.replaceEntitiesValue(ne);const Ye=this.options.attributeValueProcessor(J,ne,ae);Ye==null?_e[ye]=ne:typeof Ye!=typeof ne||Ye!==ne?_e[ye]=Ye:_e[ye]=fe(ne,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(_e[ye]=!0)}if(!Object.keys(_e).length)return;if(this.options.attributesGroupName){const pe={};return pe[this.options.attributesGroupName]=_e,pe}return _e}}const T=function(Z){Z=Z.replace(/\r\n?/g,`
`);const ae=new e("!xml");let Be=ae,Le="",de="";for(let _e=0;_e<Z.length;_e++)if(Z[_e]==="<")if(Z[_e+1]==="/"){const J=z(Z,">",_e,"Closing Tag is not closed.");let ne=Z.substring(_e+2,J).trim();if(this.options.removeNSPrefix){const we=ne.indexOf(":");we!==-1&&(ne=ne.substr(we+1))}this.options.transformTagName&&(ne=this.options.transformTagName(ne)),Be&&(Le=this.saveTextToParentTag(Le,Be,de));const ye=de.substring(de.lastIndexOf(".")+1);if(ne&&this.options.unpairedTags.indexOf(ne)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${ne}>`);let Ye=0;ye&&this.options.unpairedTags.indexOf(ye)!==-1?(Ye=de.lastIndexOf(".",de.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Ye=de.lastIndexOf("."),de=de.substring(0,Ye),Be=this.tagsNodeStack.pop(),Le="",_e=J}else if(Z[_e+1]==="?"){let J=j(Z,_e,!1,"?>");if(!J)throw new Error("Pi Tag is not closed.");if(Le=this.saveTextToParentTag(Le,Be,de),!(this.options.ignoreDeclaration&&J.tagName==="?xml"||this.options.ignorePiTags)){const ne=new e(J.tagName);ne.add(this.options.textNodeName,""),J.tagName!==J.tagExp&&J.attrExpPresent&&(ne[":@"]=this.buildAttributesMap(J.tagExp,de,J.tagName)),this.addChild(Be,ne,de)}_e=J.closeIndex+1}else if(Z.substr(_e+1,3)==="!--"){const J=z(Z,"-->",_e+4,"Comment is not closed.");if(this.options.commentPropName){const ne=Z.substring(_e+4,J-2);Le=this.saveTextToParentTag(Le,Be,de),Be.add(this.options.commentPropName,[{[this.options.textNodeName]:ne}])}_e=J}else if(Z.substr(_e+1,2)==="!D"){const J=t(Z,_e);this.docTypeEntities=J.entities,_e=J.i}else if(Z.substr(_e+1,2)==="!["){const J=z(Z,"]]>",_e,"CDATA is not closed.")-2,ne=Z.substring(_e+9,J);Le=this.saveTextToParentTag(Le,Be,de);let ye=this.parseTextData(ne,Be.tagname,de,!0,!1,!0,!0);ye==null&&(ye=""),this.options.cdataPropName?Be.add(this.options.cdataPropName,[{[this.options.textNodeName]:ne}]):Be.add(this.options.textNodeName,ye),_e=J+2}else{let J=j(Z,_e,this.options.removeNSPrefix),ne=J.tagName;const ye=J.rawTagName;let Ye=J.tagExp,we=J.attrExpPresent,Ne=J.closeIndex;this.options.transformTagName&&(ne=this.options.transformTagName(ne)),Be&&Le&&Be.tagname!=="!xml"&&(Le=this.saveTextToParentTag(Le,Be,de,!1));const Ge=Be;if(Ge&&this.options.unpairedTags.indexOf(Ge.tagname)!==-1&&(Be=this.tagsNodeStack.pop(),de=de.substring(0,de.lastIndexOf("."))),ne!==ae.tagname&&(de+=de?"."+ne:ne),this.isItStopNode(this.options.stopNodes,de,ne)){let Qe="";if(Ye.length>0&&Ye.lastIndexOf("/")===Ye.length-1)ne[ne.length-1]==="/"?(ne=ne.substr(0,ne.length-1),de=de.substr(0,de.length-1),Ye=ne):Ye=Ye.substr(0,Ye.length-1),_e=J.closeIndex;else if(this.options.unpairedTags.indexOf(ne)!==-1)_e=J.closeIndex;else{const tt=this.readStopNodeData(Z,ye,Ne+1);if(!tt)throw new Error(`Unexpected end of ${ye}`);_e=tt.i,Qe=tt.tagContent}const rt=new e(ne);ne!==Ye&&we&&(rt[":@"]=this.buildAttributesMap(Ye,de,ne)),Qe&&(Qe=this.parseTextData(Qe,ne,de,!0,we,!0,!0)),de=de.substr(0,de.lastIndexOf(".")),rt.add(this.options.textNodeName,Qe),this.addChild(Be,rt,de)}else{if(Ye.length>0&&Ye.lastIndexOf("/")===Ye.length-1){ne[ne.length-1]==="/"?(ne=ne.substr(0,ne.length-1),de=de.substr(0,de.length-1),Ye=ne):Ye=Ye.substr(0,Ye.length-1),this.options.transformTagName&&(ne=this.options.transformTagName(ne));const Qe=new e(ne);ne!==Ye&&we&&(Qe[":@"]=this.buildAttributesMap(Ye,de,ne)),this.addChild(Be,Qe,de),de=de.substr(0,de.lastIndexOf("."))}else{const Qe=new e(ne);this.tagsNodeStack.push(Be),ne!==Ye&&we&&(Qe[":@"]=this.buildAttributesMap(Ye,de,ne)),this.addChild(Be,Qe,de),Be=Qe}Le="",_e=Ne}}else Le+=Z[_e];return ae.child};function S(Z,ae,Be){const Le=this.options.updateTag(ae.tagname,Be,ae[":@"]);Le===!1||(typeof Le=="string"&&(ae.tagname=Le),Z.addChild(ae))}const D=function(Z){if(this.options.processEntities){for(let ae in this.docTypeEntities){const Be=this.docTypeEntities[ae];Z=Z.replace(Be.regx,Be.val)}for(let ae in this.lastEntities){const Be=this.lastEntities[ae];Z=Z.replace(Be.regex,Be.val)}if(this.options.htmlEntities)for(let ae in this.htmlEntities){const Be=this.htmlEntities[ae];Z=Z.replace(Be.regex,Be.val)}Z=Z.replace(this.ampEntity.regex,this.ampEntity.val)}return Z};function N(Z,ae,Be,Le){return Z&&(Le===void 0&&(Le=Object.keys(ae.child).length===0),Z=this.parseTextData(Z,ae.tagname,Be,!1,ae[":@"]?Object.keys(ae[":@"]).length!==0:!1,Le),Z!==void 0&&Z!==""&&ae.add(this.options.textNodeName,Z),Z=""),Z}function G(Z,ae,Be){const Le="*."+Be;for(const de in Z){const _e=Z[de];if(Le===_e||ae===_e)return!0}return!1}function W(Z,ae,Be=">"){let Le,de="";for(let _e=ae;_e<Z.length;_e++){let pe=Z[_e];if(Le)pe===Le&&(Le="");else if(pe==='"'||pe==="'")Le=pe;else if(pe===Be[0])if(Be[1]){if(Z[_e+1]===Be[1])return{data:de,index:_e}}else return{data:de,index:_e};else pe==="	"&&(pe=" ");de+=pe}}function z(Z,ae,Be,Le){const de=Z.indexOf(ae,Be);if(de===-1)throw new Error(Le);return de+ae.length-1}function j(Z,ae,Be,Le=">"){const de=W(Z,ae+1,Le);if(!de)return;let _e=de.data;const pe=de.index,J=_e.search(/\s/);let ne=_e,ye=!0;J!==-1&&(ne=_e.substring(0,J),_e=_e.substring(J+1).trimStart());const Ye=ne;if(Be){const we=ne.indexOf(":");we!==-1&&(ne=ne.substr(we+1),ye=ne!==de.data.substr(we+1))}return{tagName:ne,tagExp:_e,closeIndex:pe,attrExpPresent:ye,rawTagName:Ye}}function K(Z,ae,Be){const Le=Be;let de=1;for(;Be<Z.length;Be++)if(Z[Be]==="<")if(Z[Be+1]==="/"){const _e=z(Z,">",Be,`${ae} is not closed`);if(Z.substring(Be+2,_e).trim()===ae&&(de--,de===0))return{tagContent:Z.substring(Le,Be),i:_e};Be=_e}else if(Z[Be+1]==="?")Be=z(Z,"?>",Be+1,"StopNode is not closed.");else if(Z.substr(Be+1,3)==="!--")Be=z(Z,"-->",Be+3,"StopNode is not closed.");else if(Z.substr(Be+1,2)==="![")Be=z(Z,"]]>",Be,"StopNode is not closed.")-2;else{const _e=j(Z,Be,">");_e&&((_e&&_e.tagName)===ae&&_e.tagExp[_e.tagExp.length-1]!=="/"&&de++,Be=_e.closeIndex)}}function fe(Z,ae,Be){if(ae&&typeof Z=="string"){const Le=Z.trim();return Le==="true"?!0:Le==="false"?!1:n(Z,Be)}else return r.isExist(Z)?Z:""}return Zb=o,Zb}var Qb={},yP;function Uue(){if(yP)return Qb;yP=1;function r(o,s){return e(o,s)}function e(o,s,c){let f;const _={};for(let b=0;b<o.length;b++){const T=o[b],S=t(T);let D="";if(c===void 0?D=S:D=c+"."+S,S===s.textNodeName)f===void 0?f=T[S]:f+=""+T[S];else{if(S===void 0)continue;if(T[S]){let N=e(T[S],s,D);const G=i(N,s);T[":@"]?n(N,T[":@"],D,s):Object.keys(N).length===1&&N[s.textNodeName]!==void 0&&!s.alwaysCreateTextNode?N=N[s.textNodeName]:Object.keys(N).length===0&&(s.alwaysCreateTextNode?N[s.textNodeName]="":N=""),_[S]!==void 0&&_.hasOwnProperty(S)?(Array.isArray(_[S])||(_[S]=[_[S]]),_[S].push(N)):s.isArray(S,D,G)?_[S]=[N]:_[S]=N}}}return typeof f=="string"?f.length>0&&(_[s.textNodeName]=f):f!==void 0&&(_[s.textNodeName]=f),_}function t(o){const s=Object.keys(o);for(let c=0;c<s.length;c++){const f=s[c];if(f!==":@")return f}}function n(o,s,c,f){if(s){const _=Object.keys(s),b=_.length;for(let T=0;T<b;T++){const S=_[T];f.isArray(S,c+"."+S,!0,!0)?o[S]=[s[S]]:o[S]=s[S]}}}function i(o,s){const{textNodeName:c}=s,f=Object.keys(o).length;return!!(f===0||f===1&&(o[c]||typeof o[c]=="boolean"||o[c]===0))}return Qb.prettify=r,Qb}var e1,vP;function zue(){if(vP)return e1;vP=1;const{buildOptions:r}=Oue(),e=Nue(),{prettify:t}=Uue(),n=yk();class i{constructor(s){this.externalEntities={},this.options=r(s)}parse(s,c){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(c){c===!0&&(c={});const b=n.validate(s,c);if(b!==!0)throw Error(`${b.err.msg}:${b.err.line}:${b.err.col}`)}const f=new e(this.options);f.addExternalEntities(this.externalEntities);const _=f.parseXml(s);return this.options.preserveOrder||_===void 0?_:t(_,this.options)}addEntity(s,c){if(c.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(c==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=c}}return e1=i,e1}var t1,bP;function Gue(){if(bP)return t1;bP=1;const r=`
`;function e(c,f){let _="";return f.format&&f.indentBy.length>0&&(_=r),t(c,f,"",_)}function t(c,f,_,b){let T="",S=!1;for(let D=0;D<c.length;D++){const N=c[D],G=n(N);if(G===void 0)continue;let W="";if(_.length===0?W=G:W=`${_}.${G}`,G===f.textNodeName){let Z=N[G];o(W,f)||(Z=f.tagValueProcessor(G,Z),Z=s(Z,f)),S&&(T+=b),T+=Z,S=!1;continue}else if(G===f.cdataPropName){S&&(T+=b),T+=`<![CDATA[${N[G][0][f.textNodeName]}]]>`,S=!1;continue}else if(G===f.commentPropName){T+=b+`<!--${N[G][0][f.textNodeName]}-->`,S=!0;continue}else if(G[0]==="?"){const Z=i(N[":@"],f),ae=G==="?xml"?"":b;let Be=N[G][0][f.textNodeName];Be=Be.length!==0?" "+Be:"",T+=ae+`<${G}${Be}${Z}?>`,S=!0;continue}let z=b;z!==""&&(z+=f.indentBy);const j=i(N[":@"],f),K=b+`<${G}${j}`,fe=t(N[G],f,W,z);f.unpairedTags.indexOf(G)!==-1?f.suppressUnpairedNode?T+=K+">":T+=K+"/>":(!fe||fe.length===0)&&f.suppressEmptyNode?T+=K+"/>":fe&&fe.endsWith(">")?T+=K+`>${fe}${b}</${G}>`:(T+=K+">",fe&&b!==""&&(fe.includes("/>")||fe.includes("</"))?T+=b+f.indentBy+fe+b:T+=fe,T+=`</${G}>`),S=!0}return T}function n(c){const f=Object.keys(c);for(let _=0;_<f.length;_++){const b=f[_];if(c.hasOwnProperty(b)&&b!==":@")return b}}function i(c,f){let _="";if(c&&!f.ignoreAttributes)for(let b in c){if(!c.hasOwnProperty(b))continue;let T=f.attributeValueProcessor(b,c[b]);T=s(T,f),T===!0&&f.suppressBooleanAttributes?_+=` ${b.substr(f.attributeNamePrefix.length)}`:_+=` ${b.substr(f.attributeNamePrefix.length)}="${T}"`}return _}function o(c,f){c=c.substr(0,c.length-f.textNodeName.length-1);let _=c.substr(c.lastIndexOf(".")+1);for(let b in f.stopNodes)if(f.stopNodes[b]===c||f.stopNodes[b]==="*."+_)return!0;return!1}function s(c,f){if(c&&c.length>0&&f.processEntities)for(let _=0;_<f.entities.length;_++){const b=f.entities[_];c=c.replace(b.regex,b.val)}return c}return t1=e,t1}var r1,xP;function Vue(){if(xP)return r1;xP=1;const r=Gue(),e=vk(),t={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(c,f){return f},attributeValueProcessor:function(c,f){return f},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function n(c){this.options=Object.assign({},t,c),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=e(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=i,this.options.format?(this.indentate=o,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}n.prototype.build=function(c){return this.options.preserveOrder?r(c,this.options):(Array.isArray(c)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(c={[this.options.arrayNodeName]:c}),this.j2x(c,0,[]).val)},n.prototype.j2x=function(c,f,_){let b="",T="";const S=_.join(".");for(let D in c)if(Object.prototype.hasOwnProperty.call(c,D))if(typeof c[D]>"u")this.isAttribute(D)&&(T+="");else if(c[D]===null)this.isAttribute(D)?T+="":D[0]==="?"?T+=this.indentate(f)+"<"+D+"?"+this.tagEndChar:T+=this.indentate(f)+"<"+D+"/"+this.tagEndChar;else if(c[D]instanceof Date)T+=this.buildTextValNode(c[D],D,"",f);else if(typeof c[D]!="object"){const N=this.isAttribute(D);if(N&&!this.ignoreAttributesFn(N,S))b+=this.buildAttrPairStr(N,""+c[D]);else if(!N)if(D===this.options.textNodeName){let G=this.options.tagValueProcessor(D,""+c[D]);T+=this.replaceEntitiesValue(G)}else T+=this.buildTextValNode(c[D],D,"",f)}else if(Array.isArray(c[D])){const N=c[D].length;let G="",W="";for(let z=0;z<N;z++){const j=c[D][z];if(!(typeof j>"u"))if(j===null)D[0]==="?"?T+=this.indentate(f)+"<"+D+"?"+this.tagEndChar:T+=this.indentate(f)+"<"+D+"/"+this.tagEndChar;else if(typeof j=="object")if(this.options.oneListGroup){const K=this.j2x(j,f+1,_.concat(D));G+=K.val,this.options.attributesGroupName&&j.hasOwnProperty(this.options.attributesGroupName)&&(W+=K.attrStr)}else G+=this.processTextOrObjNode(j,D,f,_);else if(this.options.oneListGroup){let K=this.options.tagValueProcessor(D,j);K=this.replaceEntitiesValue(K),G+=K}else G+=this.buildTextValNode(j,D,"",f)}this.options.oneListGroup&&(G=this.buildObjectNode(G,D,W,f)),T+=G}else if(this.options.attributesGroupName&&D===this.options.attributesGroupName){const N=Object.keys(c[D]),G=N.length;for(let W=0;W<G;W++)b+=this.buildAttrPairStr(N[W],""+c[D][N[W]])}else T+=this.processTextOrObjNode(c[D],D,f,_);return{attrStr:b,val:T}},n.prototype.buildAttrPairStr=function(c,f){return f=this.options.attributeValueProcessor(c,""+f),f=this.replaceEntitiesValue(f),this.options.suppressBooleanAttributes&&f==="true"?" "+c:" "+c+'="'+f+'"'};function i(c,f,_,b){const T=this.j2x(c,_+1,b.concat(f));return c[this.options.textNodeName]!==void 0&&Object.keys(c).length===1?this.buildTextValNode(c[this.options.textNodeName],f,T.attrStr,_):this.buildObjectNode(T.val,f,T.attrStr,_)}n.prototype.buildObjectNode=function(c,f,_,b){if(c==="")return f[0]==="?"?this.indentate(b)+"<"+f+_+"?"+this.tagEndChar:this.indentate(b)+"<"+f+_+this.closeTag(f)+this.tagEndChar;{let T="</"+f+this.tagEndChar,S="";return f[0]==="?"&&(S="?",T=""),(_||_==="")&&c.indexOf("<")===-1?this.indentate(b)+"<"+f+_+S+">"+c+T:this.options.commentPropName!==!1&&f===this.options.commentPropName&&S.length===0?this.indentate(b)+`<!--${c}-->`+this.newLine:this.indentate(b)+"<"+f+_+S+this.tagEndChar+c+this.indentate(b)+T}},n.prototype.closeTag=function(c){let f="";return this.options.unpairedTags.indexOf(c)!==-1?this.options.suppressUnpairedNode||(f="/"):this.options.suppressEmptyNode?f="/":f=`></${c}`,f},n.prototype.buildTextValNode=function(c,f,_,b){if(this.options.cdataPropName!==!1&&f===this.options.cdataPropName)return this.indentate(b)+`<![CDATA[${c}]]>`+this.newLine;if(this.options.commentPropName!==!1&&f===this.options.commentPropName)return this.indentate(b)+`<!--${c}-->`+this.newLine;if(f[0]==="?")return this.indentate(b)+"<"+f+_+"?"+this.tagEndChar;{let T=this.options.tagValueProcessor(f,c);return T=this.replaceEntitiesValue(T),T===""?this.indentate(b)+"<"+f+_+this.closeTag(f)+this.tagEndChar:this.indentate(b)+"<"+f+_+">"+T+"</"+f+this.tagEndChar}},n.prototype.replaceEntitiesValue=function(c){if(c&&c.length>0&&this.options.processEntities)for(let f=0;f<this.options.entities.length;f++){const _=this.options.entities[f];c=c.replace(_.regex,_.val)}return c};function o(c){return this.options.indentBy.repeat(c)}function s(c){return c.startsWith(this.options.attributeNamePrefix)&&c!==this.options.textNodeName?c.substr(this.attrPrefixLen):!1}return r1=n,r1}var n1,wP;function Hue(){if(wP)return n1;wP=1;const r=yk(),e=zue(),t=Vue();return n1={XMLParser:e,XMLValidator:r,XMLBuilder:t},n1}var jue=Hue();function CP(r,e){if(e!=null&&e._parser&&e._parser!=="fast-xml-parser")throw new Error(e==null?void 0:e._parser);const t={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e==null?void 0:e.removeNSPrefix,textNodeName:e==null?void 0:e.textNodeName,isArray:(i,o,s,c)=>{var _;return!!((_=e==null?void 0:e.arrayPaths)!=null&&_.some(b=>o===b))},...e==null?void 0:e._fastXML},n=$ue(r,t);return e!=null&&e.uncapitalizeKeys?wx(n):n}function $ue(r,e){return new jue.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(r)}const Wue="4.2.4",Lo={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Wue,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Jue,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(r,e)=>CP(new TextDecoder().decode(r),{...Lo.options.xml,...e==null?void 0:e.xml}),parseTextSync:(r,e)=>CP(r,{...Lo.options.xml,...e==null?void 0:e.xml})};function Jue(r){return r.startsWith("<?xml")}async function ph(r,e,t,n){return n._parse(r,e,t,n)}function ai(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const bk=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),EP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);EP&&parseFloat(EP[1]);function Xue(r,e){return xk(r||{},e)}function xk(r,e,t=0){if(t>3)return e;const n={...r};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=xk(n[i]||{},e[i],t+1):n[i]=e[i];return n}function Kue(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function Yue(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}function que(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const Zue=que();function Que(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const Dg=typeof process!="object"||String(process)!=="[object process]"||process.browser,mC=typeof importScripts=="function",TP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);TP&&parseFloat(TP[1]);const i1={};async function Zf(r,e=null,t={},n=null){return e&&(r=efe(r,e,t,n)),i1[r]=i1[r]||tfe(r),await i1[r]}function efe(r,e,t={},n=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:Dg?t.CDN?(Que(t.CDN.startsWith("http")),`${t.CDN}/${e}@${Zue}/dist/libs/${n}`):mC?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function tfe(r){if(r.endsWith("wasm"))return await nfe(r);if(!Dg)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(mC)return importScripts(r);const e=await ife(r);return rfe(e,r)}function rfe(r,e){if(!Dg){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(mC)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function nfe(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Dg||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function ife(r){const{readFileAsText:e}=globalThis.loaders||{};return Dg||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function sfe(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?BP(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?BP(r,0,e):""}function BP(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function wk(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${sfe(r)}"`)}}function Lg(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function Jl(r,e){return ai(r>=0),ai(e>0),r+(e-1)&-4}function Ck(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,o=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,o)}return e.set(n,t),t+Jl(n.byteLength,4)}const ofe="Queued Requests",afe="Active Requests",cfe="Cancelled Requests",lfe="Queued Requests Ever",ufe="Active Requests Ever",ffe={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Ek{constructor(e={}){V(this,"props");V(this,"stats");V(this,"activeRequestCount",0);V(this,"requestQueue",[]);V(this,"requestMap",new Map);V(this,"updateTimer",null);this.props={...ffe,...e},this.stats=new fL({id:this.props.id}),this.stats.get(ofe),this.stats.get(afe),this.stats.get(cfe),this.stats.get(lfe),this.stats.get(ufe)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(o=>(n.resolve=o,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const o=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((t,n)=>t.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}function hfe(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const r=(e=window.location)==null?void 0:e.pathname;return(r==null?void 0:r.slice(0,r.lastIndexOf("/")+1))||""}function Tk(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}function dfe(...r){const e=[];for(let o=0;o<r.length;o++)e[o]=r[o];let t="",n=!1,i;for(let o=e.length-1;o>=-1&&!n;o--){let s;o>=0?s=e[o]:(i===void 0&&(i=hfe()),s=i),s.length!==0&&(t=`${s}/${t}`,n=s.charCodeAt(0)===kp)}return t=Afe(t,!n),n?`/${t}`:t.length>0?t:"."}const kp=47,s1=46;function Afe(r,e){let t="",n=-1,i=0,o,s=!1;for(let c=0;c<=r.length;++c){if(c<r.length)o=r.charCodeAt(c);else{if(o===kp)break;o=kp}if(o===kp){if(!(n===c-1||i===1))if(n!==c-1&&i===2){if(t.length<2||!s||t.charCodeAt(t.length-1)!==s1||t.charCodeAt(t.length-2)!==s1){if(t.length>2){const f=t.length-1;let _=f;for(;_>=0&&t.charCodeAt(_)!==kp;--_);if(_!==f){t=_===-1?"":t.slice(0,_),n=c,i=0,s=!1;continue}}else if(t.length===2||t.length===1){t="",n=c,i=0,s=!1;continue}}e&&(t.length>0?t+="/..":t="..",s=!0)}else{const f=r.slice(n+1,c);t.length>0?t+=`/${f}`:t=f,s=!1}n=c,i=0}else o===s1&&i!==-1?++i:i=-1}return t}class pfe{constructor(e){V(this,"fetch");V(this,"loadOptions");V(this,"_needsRefresh",!0);V(this,"props");this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=gfe(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){const t=this._needsRefresh;return e&&(this._needsRefresh=!1),t}}function gfe(r){const e=r==null?void 0:r.fetch;if(e&&typeof e=="function")return(n,i)=>e(n,i);const t=r==null?void 0:r.fetch;return t&&typeof t!="function"?n=>fetch(n,t):n=>fetch(n)}class mg extends pfe{}V(mg,"type","template"),V(mg,"testURL",e=>!1);function mfe(r,e){var o,s,c;const t=(o=Lo.parseTextSync)==null?void 0:o.call(Lo,r,e),n=((s=t==null?void 0:t.ServiceExceptionReport)==null?void 0:s.ServiceException)||((c=t==null?void 0:t["ogc:ServiceExceptionReport"])==null?void 0:c["ogc:ServiceException"]);return typeof n=="string"?n:n.value||n.code||"Unknown error"}const _fe="4.2.4",Iu={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:_fe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:yfe,options:{wms:{throwOnError:!1}},parse:async(r,e)=>o1(new TextDecoder().decode(r),e),parseSync:(r,e)=>o1(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>o1(r,e)};function yfe(r){return r.startsWith("<?xml")}function o1(r,e){const t={...Iu.options.wms,...e==null?void 0:e.wms},n=mfe(r,t),i=t.minimalErrors?n:`WMS Service error: ${n}`;if(t.throwOnError)throw new Error(i);return i}function TA(r){return Array.isArray(r)?r:r?[r]:[]}function Iy(r){const e=TA(r);return e.length>0&&e.every(t=>typeof t=="string")?e:[]}function em(r,e=void 0){switch(typeof r){case"number":return r;case"string":return parseFloat(r);default:return}}function a1(r,e=void 0){switch(typeof r){case"number":return r;case"string":return parseInt(r,10);default:return}}function hA(r){switch(r){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function SP(r,e){var o;const t=(o=Lo.parseTextSync)==null?void 0:o.call(Lo,r,e),n=t.WMT_MS_Capabilities||t.WMS_Capabilities||t,i=vfe(n);if(e!=null&&e.inheritedLayerProps)for(const s of i.layers)Sk(s,null);return e!=null&&e.includeRawJSON&&(i.json=n),e!=null&&e.includeXMLText&&(i.xml=r),i}function vfe(r){var n,i,o,s,c,f,_,b,T,S,D,N,G,W,z,j;const e={version:String(r.version||""),name:String(((n=r.Service)==null?void 0:n.Name)||"unnamed"),title:(i=r.Service)!=null&&i.Title?String((o=r.Service)==null?void 0:o.Title):void 0,abstract:(s=r.Service)!=null&&s.Abstract?String((c=r.Service)==null?void 0:c.Abstract):void 0,keywords:Iy((_=(f=r.Service)==null?void 0:f.KeywordList)==null?void 0:_.Keyword),fees:(b=r.Service)!=null&&b.Fees?JSON.stringify((T=r.Service)==null?void 0:T.Fees):void 0,accessConstraints:(S=r.Service)!=null&&S.AccessConstraints?JSON.stringify((D=r.Service)==null?void 0:D.AccessConstraints):void 0,layerLimit:a1((N=r.Service)==null?void 0:N.LayerLimit),maxWidth:a1((G=r.Service)==null?void 0:G.maxWidth),maxHeight:a1((W=r.Service)==null?void 0:W.maxHeight),layers:[],requests:bfe((z=r.Capability)==null?void 0:z.Request),exceptions:xfe(r.Exception)},t=TA((j=r.Capability)==null?void 0:j.Layer);for(const K of t)e.layers.push(Bk(K));for(const[K,fe]of Object.entries(e))fe===void 0&&delete e[K];return e}function bfe(r){const e={};for(const[t,n]of Object.entries(r||{})){const i=Iy(n==null?void 0:n.Format);e[t]={mimeTypes:i}}return e}function xfe(r){if(TA(r==null?void 0:r.Format).length>0)return{mimeTypes:Iy(r)}}function Bk(r){var _;const e={title:String((r==null?void 0:r.Title)||""),name:(r==null?void 0:r.Name)&&String(r==null?void 0:r.Name),abstract:(r==null?void 0:r.Name)&&String(r==null?void 0:r.Abstract),keywords:Iy((_=r.KeywordList)==null?void 0:_.Keyword)},t=(r==null?void 0:r.CRS)||(r==null?void 0:r.SRS);t&&Array.isArray(t)&&t.every(b=>typeof b=="string")&&(e.crs=t);let n=(r==null?void 0:r.EX_GeographicBoundingBox)&&wfe(r==null?void 0:r.EX_GeographicBoundingBox);n&&(e.geographicBoundingBox=n),n=(r==null?void 0:r.LatLonBoundingBox)&&Cfe(r==null?void 0:r.LatLonBoundingBox),n&&(e.geographicBoundingBox=n);const i=(r==null?void 0:r.BoundingBox)&&Efe(r==null?void 0:r.BoundingBox);i&&i.length>0&&(e.boundingBoxes=i);const s=TA(r==null?void 0:r.Dimension).map(b=>Bfe(b));s.length&&(e.dimensions=s),r!=null&&r.opaque&&(e.opaque=hA(r==null?void 0:r.opaque)),r!=null&&r.cascaded&&(e.cascaded=hA(r==null?void 0:r.cascaded)),r!=null&&r.queryable&&(e.queryable=hA(r==null?void 0:r.queryable));const c=TA(r==null?void 0:r.Layer),f=[];for(const b of c)f.push(Bk(b));f.length>0&&(e.layers=f);for(const[b,T]of Object.entries(e))T===void 0&&delete e[b];return e}function wfe(r){const{westBoundLongitude:e,northBoundLatitude:t,eastBoundLongitude:n,southBoundLatitude:i}=r;return[[e,i],[n,t]]}function Cfe(r){const{minx:e,miny:t,maxx:n,maxy:i}=r;return[[e,t],[n,i]]}function Efe(r){return TA(r).map(t=>Tfe(t))}function Tfe(r){const{CRS:e,SRS:t,minx:n,miny:i,maxx:o,maxy:s,resx:c,resy:f}=r,_={crs:e||t,boundingBox:[[em(n),em(i)],[em(o),em(s)]]};return c&&(_.xResolution=c),f&&(_.yResolution=f),_}function Bfe(r){const{name:e,units:t,value:n}=r,i={name:e,units:t,extent:n};return r.unitSymbol&&(i.unitSymbol=r.unitSymbol),r.default&&(i.defaultValue=r.default),r.multipleValues&&(i.multipleValues=hA(r.multipleValues)),r.nearestValue&&(i.nearestValue=hA(r.nearestValue)),r.current&&(i.current=hA(r.current)),i}function Sk(r,e){e!=null&&e.geographicBoundingBox&&!r.geographicBoundingBox&&(r.geographicBoundingBox=[...e.geographicBoundingBox]),e!=null&&e.crs&&!r.crs&&(r.crs=[...e.crs]),e!=null&&e.boundingBoxes&&!r.boundingBoxes&&(r.boundingBoxes=[...e.boundingBoxes]),e!=null&&e.dimensions&&!r.dimensions&&(r.dimensions=[...e.dimensions]);for(const t of r.layers||[])Sk(t,r)}const Sfe="4.2.4",_C={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:Sfe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:Ife,options:{wms:{}},parse:async(r,e)=>SP(new TextDecoder().decode(r),e==null?void 0:e.wms),parseTextSync:(r,e)=>SP(r,e==null?void 0:e.wms)};function Ife(r){return r.startsWith("<?xml")}function IP(r,e){var o,s;const n=((s=((o=Lo.parseTextSync)==null?void 0:o.call(Lo,r,e)).FeatureInfoResponse)==null?void 0:s.FIELDS)||[];return{features:(Array.isArray(n)?n:[n]).map(c=>Mfe(c))}}function Mfe(r){return{attributes:r||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const Pfe={..._C,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(r,e)=>IP(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>IP(r,e)};function MP(r,e){var n;return(n=Lo.parseTextSync)==null?void 0:n.call(Lo,r,e)}const Rfe={..._C,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(r,e)=>MP(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>MP(r,e)};function Ffe(r,e){const{type:t="auto"}=r,n=t==="auto"?Dfe(r.url,e):Ofe(t,e);if(!n)throw new Error("Not a valid image source type");return n.create(r)}function Ofe(r,e){for(const t of e)if(t.type===r)return t;return null}function Dfe(r,e){for(const t of e)if(t.testURL&&t.testURL(r))return t;return null}const Lfe="4.2.4";var VO;const kfe=(VO=globalThis.loaders)==null?void 0:VO.parseImageNode,Cx=typeof Image<"u",Ex=typeof ImageBitmap<"u",Nfe=!!kfe,Tx=bk?!0:Nfe;function Ufe(r){switch(r){case"auto":return Ex||Cx||Tx;case"imagebitmap":return Ex;case"image":return Cx;case"data":return Tx;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function zfe(){if(Ex)return"imagebitmap";if(Cx)return"image";if(Tx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Gfe(r){const e=Vfe(r);if(!e)throw new Error("Not an image");return e}function yC(r){switch(Gfe(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function Vfe(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const Hfe=/^data:image\/svg\+xml/,jfe=/\.svg((\?|#).*)?$/;function vC(r){return r&&(Hfe.test(r)||jfe.test(r))}function $fe(r,e){if(vC(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return Ik(r,e)}function Ik(r,e){if(vC(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function Mk(r,e,t){const n=$fe(r,t),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await Wfe(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function Wfe(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const Jfe={};let PP=!0;async function Xfe(r,e,t){let n;vC(t)?n=await Mk(r,e,t):n=Ik(r,t);const i=e&&e.imagebitmap;return await Kfe(n,i)}async function Kfe(r,e=null){if((Yfe(e)||!PP)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),PP=!1}return await createImageBitmap(r)}function Yfe(r){for(const e in r||Jfe)return!1;return!0}function qfe(r){return!the(r,"ftyp",4)||(r[8]&96)===0?null:Zfe(r)}function Zfe(r){switch(Qfe(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Qfe(r,e,t){return String.fromCharCode(...r.slice(e,t))}function ehe(r){return[...r].map(e=>e.charCodeAt(0))}function the(r,e,t=0){const n=ehe(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Yc=!1,Zp=!0;function My(r){const e=kg(r);return nhe(e)||ohe(e)||ihe(e)||she(e)||rhe(e)}function rhe(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=qfe(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function nhe(r){const e=kg(r);return e.byteLength>=24&&e.getUint32(0,Yc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Yc),height:e.getUint32(20,Yc)}:null}function ihe(r){const e=kg(r);return e.byteLength>=10&&e.getUint32(0,Yc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Zp),height:e.getUint16(8,Zp)}:null}function she(r){const e=kg(r);return e.byteLength>=14&&e.getUint16(0,Yc)===16973&&e.getUint32(2,Zp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Zp),height:e.getUint32(22,Zp)}:null}function ohe(r){const e=kg(r);if(!(e.byteLength>=3&&e.getUint16(0,Yc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=ahe();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,Yc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Yc),width:e.getUint16(o+7,Yc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,Yc)}return null}function ahe(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function kg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function che(r,e){var i;const{mimeType:t}=My(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return ai(n),await n(r,t)}async function lhe(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=t||{},s=uhe(i);let c;switch(s){case"imagebitmap":c=await Xfe(r,e,o);break;case"image":c=await Mk(r,e,o);break;case"data":c=await che(r);break;default:ai(!1)}return i==="data"&&(c=yC(c)),c}function uhe(r){switch(r){case"auto":case"data":return zfe();default:return Ufe(r),r}}const fhe=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],hhe=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],dhe={image:{type:"auto",decode:!0}},_g={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Lfe,mimeTypes:hhe,extensions:fhe,parse:lhe,tests:[r=>!!My(new DataView(r))],options:dhe},c1={};function Pk(r){if(c1[r]===void 0){const e=bk?phe(r):Ahe(r);c1[r]=e}return c1[r]}function Ahe(r){var i,o;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((o=globalThis.loaders)==null?void 0:o.parseImageNode)&&t.includes(r)}function phe(r){switch(r){case"image/avif":case"image/webp":return ghe(r);default:return!0}}function ghe(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}const mhe={type:"wms",testURL:r=>r.toLowerCase().includes("wms"),create:r=>new _he(r)};class _he extends mg{constructor(t){super(t);V(this,"url");V(this,"data");V(this,"substituteCRS84");V(this,"flipCRS");V(this,"wmsParameters");V(this,"vendorParameters");V(this,"capabilities",null);this.url=t.url,this.data=t.url,this.substituteCRS84=t.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...t.wmsParameters},this.vendorParameters=t.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){const{boundingBox:n,bbox:i,...o}=t,s={bbox:n?[...n[0],...n[1]]:i,...o};return await this.getMap(s)}normalizeMetadata(t){return t}async getCapabilities(t,n){const i=this.getCapabilitiesURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();this._checkResponse(o,s);const c=await _C.parse(s,this.loadOptions);return this.capabilities=c,c}async getMap(t,n){const i=this.getMapURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();this._checkResponse(o,s);try{return await _g.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(t,n){const i=this.getFeatureInfoURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();return this._checkResponse(o,s),await Pfe.parse(s,this.loadOptions)}async getFeatureInfoText(t,n){const i=this.getFeatureInfoURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();return this._checkResponse(o,s),new TextDecoder().decode(s)}async describeLayer(t,n){const i=this.describeLayerURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();return this._checkResponse(o,s),await Rfe.parse(s,this.loadOptions)}async getLegendGraphic(t,n){const i=this.getLegendGraphicURL(t,n),o=await this.fetch(i),s=await o.arrayBuffer();this._checkResponse(o,s);try{return await _g.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(t,n){const i={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",i,n)}getMapURL(t,n){t=this._getWMS130Parameters(t);const i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",i,n)}getFeatureInfoURL(t,n){t=this._getWMS130Parameters(t);const{boundingBox:i,bbox:o}=t;t.bbox=i?[...i[0],...i[1]]:o;const s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",s,n)}describeLayerURL(t,n){const i={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",i,n)}getLegendGraphicURL(t,n){const i={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",i,n)}_parseWMSUrl(t){const[n,i]=t.split("?"),o=i.split("&"),s={};for(const c of o){const[f,_]=c.split("=");s[f]=_}return{url:n,parameters:s}}_getWMSUrl(t,n,i){let o=this.url,s=!0;const c={service:"WMS",version:n.version,request:t,...n,...this.vendorParameters,...i},f=["transparent","time","elevation"];for(const[_,b]of Object.entries(c))(!f.includes(_)||b)&&(o+=s?"?":"&",s=!1,o+=this._getURLParameter(_,b,n));return encodeURI(o)}_getWMS130Parameters(t){const n={...t};return n.srs&&(n.crs=n.crs||n.srs,delete n.srs),n}_getURLParameter(t,n,i){switch(t){case"crs":i.version!=="1.3.0"?t="srs":this.substituteCRS84&&n==="EPSG:4326"&&(n="CRS:84");break;case"srs":i.version==="1.3.0"&&(t="crs");break;case"bbox":const o=this._flipBoundingBox(n,i);o&&(n=o);break;case"x":i.version==="1.3.0"&&(t="i");break;case"y":i.version==="1.3.0"&&(t="j");break}return t=t.toUpperCase(),Array.isArray(n)?`${t}=${n.join(",")}`:`${t}=${n?String(n):""}`}_flipBoundingBox(t,n){if(!Array.isArray(t)||t.length!==4)return null;const i=n.version==="1.3.0"&&this.flipCRS.includes(n.crs||"")&&!(this.substituteCRS84&&n.crs==="EPSG:4326"),o=t;return i?[o[1],o[0],o[3],o[2]]:o}async _fetchArrayBuffer(t){const n=await this.fetch(t),i=await n.arrayBuffer();return this._checkResponse(n,i),i}_checkResponse(t,n){var o;const i=t.headers["content-type"];if(!t.ok||Iu.mimeTypes.includes(i)){const s=Xue(this.loadOptions,{wms:{throwOnError:!0}}),c=(o=Iu.parseSync)==null?void 0:o.call(Iu,n,s);throw new Error(c)}}_parseError(t){var i;const n=(i=Iu.parseSync)==null?void 0:i.call(Iu,t,this.loadOptions);return new Error(n)}}class Bx extends mg{constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){const t=this.getGranularParameters(e),n=this.getURLFromTemplate(t),o=await(await this.fetch(n)).arrayBuffer();return await _g.parse(o)}getGranularParameters(e){const[[t,n],[i,o]]=e.boundingBox;return{...e,east:t,north:n,south:o,west:i}}getURLFromTemplate(e){let t=this.props.url;for(const[n,i]of Object.entries(e))t=t.replace(`\${${n}}`,String(i)),t=t.replace(`{${n}}`,String(i));return t}}V(Bx,"type","template"),V(Bx,"testURL",e=>e.toLowerCase().includes("{"));class yhe extends Bx{constructor(t){super(t);V(this,"data");this.data=t.url}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.props.url}?f=pjson`}exportImageURL(t){const n=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,i=`size=${t.width},${t.height}`,o={...t,bbox:n,size:i};return delete o.width,delete o.height,this.getUrl("exportImage",o)}getUrl(t,n,i){let o=`${this.props.url}/${t}`,s=!0;for(const[c,f]of Object.entries(n))o+=s?"?":"&",s=!1,Array.isArray(f)?o+=`${c.toUpperCase()}=${f.join(",")}`:o+=`${c.toUpperCase()}=${f?String(f):""}`;return o}async checkResponse(t){if(!t.ok)throw new Error("error")}}const vhe={type:"arcgis-image-server",testURL:r=>r.toLowerCase().includes("ImageServer"),create:r=>new yhe(r)},bhe=[mhe,vhe];function xhe(r){return Ffe(r,bhe)}const RP=6378137*Math.PI;function FP(r){const e=Gl(r);return e[0]=(e[0]/256-1)*RP,e[1]=(e[1]/256-1)*RP,e}const whe={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(r,e)=>console.error(e,r)}};class bC extends ys{get isLoaded(){var e;return((e=this.state)==null?void 0:e.loadCounter)===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:t,oldProps:n}){const{viewport:i}=this.context;e.dataChanged||t.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(t),this._loadMetadata(),this.debounce(()=>this.loadImage(i,"image source changed"),0)):Ki(t.layers,n.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(i,"viewport changed")):this.debounce(()=>this.loadImage(i,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:e,image:t,lastRequestParameters:n}=this.state;return t&&new Ty({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?Jr.LNGLAT:Jr.CARTESIAN,bounds:e,image:t})}async getFeatureInfoText(e,t){var i,o;const{lastRequestParameters:n}=this.state;return n?await((o=(i=this.state.imageSource).getFeatureInfoText)==null?void 0:o.call(i,{...n,query_layers:n.layers,x:e,y:t,info_format:"application/vnd.ogc.gml"})):""}_createImageSource(e){if(e.data instanceof mg)return e.data;if(typeof e.data=="string")return xhe({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){var t,n;const{imageSource:e}=this.state;try{this.state.loadCounter++;const i=await e.getMetadata();this.state.imageSource===e&&((t=this.getCurrentLayer())==null||t.props.onMetadataLoad(i))}catch(i){(n=this.getCurrentLayer())==null||n.props.onMetadataLoadError(i)}finally{this.state.loadCounter--}}async loadImage(e,t){var T,S;const{layers:n,serviceType:i}=this.props;if(i==="wms"&&n.length===0)return;const o=e.getBounds(),{width:s,height:c}=e,f=this.getRequestId();let{srs:_}=this.props;_==="auto"&&(_=e.resolution?"EPSG:4326":"EPSG:3857");const b={width:s,height:c,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:n,crs:_};if(_==="EPSG:3857"){const D=FP([o[0],o[1]]),N=FP([o[2],o[3]]);b.boundingBox=[D,N]}try{this.state.loadCounter++,this.props.onImageLoadStart(f);const D=await this.state.imageSource.getImage(b);this.state.lastRequestId<f&&((T=this.getCurrentLayer())==null||T.props.onImageLoad(f),this.setState({image:D,bounds:o,lastRequestParameters:b,lastRequestId:f}))}catch(D){this.raiseError(D,"Load image"),(S=this.getCurrentLayer())==null||S.props.onImageLoadError(f,D)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,t=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),t)}}bC.layerName="WMSLayer";bC.defaultProps=whe;const Che={getHeight:{type:"accessor",value:0},greatCircle:!0};class xC extends Pg{}xC.layerName="GreatCircleLayer";xC.defaultProps=Che;const Ehe={...ef.defaultProps};class tf extends ys{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:t,wireframe:n,filled:i,stroked:o,lineWidthUnits:s,lineWidthScale:c,lineWidthMinPixels:f,lineWidthMaxPixels:_,lineJointRounded:b,lineMiterLimit:T,lineDashJustified:S,getElevation:D,getFillColor:N,getLineColor:G,getLineWidth:W}=this.props,{updateTriggers:z,material:j,transitions:K}=this.props,fe=this.getSubLayerClass("cell",ef),{updateTriggers:Z,...ae}=this.indexToBounds()||{};return new fe({filled:i,wireframe:n,extruded:t,elevationScale:e,stroked:o,lineWidthUnits:s,lineWidthScale:c,lineWidthMinPixels:f,lineWidthMaxPixels:_,lineJointRounded:b,lineMiterLimit:T,lineDashJustified:S,material:j,transitions:K,getElevation:D,getFillColor:N,getLineColor:G,getLineWidth:W},this.getSubLayerProps({id:"cell",updateTriggers:z&&{...Z,getElevation:z.getElevation,getFillColor:z.getFillColor,getLineColor:z.getLineColor,getLineWidth:z.getLineWidth}}),ae)}}tf.layerName="GeoCellLayer";tf.defaultProps=Ehe;function The(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var km={exports:{}},Bhe=km.exports,OP;function She(){return OP||(OP=1,function(r){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,t){typeof The=="function"&&r&&r.exports?r.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(Bhe,function(){function e(_e,pe,J){this.low=_e|0,this.high=pe|0,this.unsigned=!!J}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(_e){return(_e&&_e.__isLong__)===!0}e.isLong=t;var n={},i={};function o(_e,pe){var J,ne,ye;return pe?(_e>>>=0,(ye=0<=_e&&_e<256)&&(ne=i[_e],ne)?ne:(J=c(_e,(_e|0)<0?-1:0,!0),ye&&(i[_e]=J),J)):(_e|=0,(ye=-128<=_e&&_e<128)&&(ne=n[_e],ne)?ne:(J=c(_e,_e<0?-1:0,!1),ye&&(n[_e]=J),J))}e.fromInt=o;function s(_e,pe){if(isNaN(_e)||!isFinite(_e))return pe?j:z;if(pe){if(_e<0)return j;if(_e>=N)return Be}else{if(_e<=-9223372036854776e3)return Le;if(_e+1>=G)return ae}return _e<0?s(-_e,pe).neg():c(_e%D|0,_e/D|0,pe)}e.fromNumber=s;function c(_e,pe,J){return new e(_e,pe,J)}e.fromBits=c;var f=Math.pow;function _(_e,pe,J){if(_e.length===0)throw Error("empty string");if(_e==="NaN"||_e==="Infinity"||_e==="+Infinity"||_e==="-Infinity")return z;if(typeof pe=="number"?(J=pe,pe=!1):pe=!!pe,J=J||10,J<2||36<J)throw RangeError("radix");var ne;if((ne=_e.indexOf("-"))>0)throw Error("interior hyphen");if(ne===0)return _(_e.substring(1),pe,J).neg();for(var ye=s(f(J,8)),Ye=z,we=0;we<_e.length;we+=8){var Ne=Math.min(8,_e.length-we),Ge=parseInt(_e.substring(we,we+Ne),J);if(Ne<8){var Qe=s(f(J,Ne));Ye=Ye.mul(Qe).add(s(Ge))}else Ye=Ye.mul(ye),Ye=Ye.add(s(Ge))}return Ye.unsigned=pe,Ye}e.fromString=_;function b(_e){return _e instanceof e?_e:typeof _e=="number"?s(_e):typeof _e=="string"?_(_e):c(_e.low,_e.high,_e.unsigned)}e.fromValue=b;var T=65536,S=1<<24,D=T*T,N=D*D,G=N/2,W=o(S),z=o(0);e.ZERO=z;var j=o(0,!0);e.UZERO=j;var K=o(1);e.ONE=K;var fe=o(1,!0);e.UONE=fe;var Z=o(-1);e.NEG_ONE=Z;var ae=c(-1,2147483647,!1);e.MAX_VALUE=ae;var Be=c(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Be;var Le=c(0,-2147483648,!1);e.MIN_VALUE=Le;var de=e.prototype;return de.toInt=function(){return this.unsigned?this.low>>>0:this.low},de.toNumber=function(){return this.unsigned?(this.high>>>0)*D+(this.low>>>0):this.high*D+(this.low>>>0)},de.toString=function(pe){if(pe=pe||10,pe<2||36<pe)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Le)){var J=s(pe),ne=this.div(J),ye=ne.mul(J).sub(this);return ne.toString(pe)+ye.toInt().toString(pe)}else return"-"+this.neg().toString(pe);for(var Ye=s(f(pe,6),this.unsigned),we=this,Ne="";;){var Ge=we.div(Ye),Qe=we.sub(Ge.mul(Ye)).toInt()>>>0,rt=Qe.toString(pe);if(we=Ge,we.isZero())return rt+Ne;for(;rt.length<6;)rt="0"+rt;Ne=""+rt+Ne}},de.getHighBits=function(){return this.high},de.getHighBitsUnsigned=function(){return this.high>>>0},de.getLowBits=function(){return this.low},de.getLowBitsUnsigned=function(){return this.low>>>0},de.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Le)?64:this.neg().getNumBitsAbs();for(var pe=this.high!=0?this.high:this.low,J=31;J>0&&(pe&1<<J)==0;J--);return this.high!=0?J+33:J+1},de.isZero=function(){return this.high===0&&this.low===0},de.isNegative=function(){return!this.unsigned&&this.high<0},de.isPositive=function(){return this.unsigned||this.high>=0},de.isOdd=function(){return(this.low&1)===1},de.isEven=function(){return(this.low&1)===0},de.equals=function(pe){return t(pe)||(pe=b(pe)),this.unsigned!==pe.unsigned&&this.high>>>31===1&&pe.high>>>31===1?!1:this.high===pe.high&&this.low===pe.low},de.eq=de.equals,de.notEquals=function(pe){return!this.eq(pe)},de.neq=de.notEquals,de.lessThan=function(pe){return this.comp(pe)<0},de.lt=de.lessThan,de.lessThanOrEqual=function(pe){return this.comp(pe)<=0},de.lte=de.lessThanOrEqual,de.greaterThan=function(pe){return this.comp(pe)>0},de.gt=de.greaterThan,de.greaterThanOrEqual=function(pe){return this.comp(pe)>=0},de.gte=de.greaterThanOrEqual,de.compare=function(pe){if(t(pe)||(pe=b(pe)),this.eq(pe))return 0;var J=this.isNegative(),ne=pe.isNegative();return J&&!ne?-1:!J&&ne?1:this.unsigned?pe.high>>>0>this.high>>>0||pe.high===this.high&&pe.low>>>0>this.low>>>0?-1:1:this.sub(pe).isNegative()?-1:1},de.comp=de.compare,de.negate=function(){return!this.unsigned&&this.eq(Le)?Le:this.not().add(K)},de.neg=de.negate,de.add=function(pe){t(pe)||(pe=b(pe));var J=this.high>>>16,ne=this.high&65535,ye=this.low>>>16,Ye=this.low&65535,we=pe.high>>>16,Ne=pe.high&65535,Ge=pe.low>>>16,Qe=pe.low&65535,rt=0,tt=0,lt=0,mt=0;return mt+=Ye+Qe,lt+=mt>>>16,mt&=65535,lt+=ye+Ge,tt+=lt>>>16,lt&=65535,tt+=ne+Ne,rt+=tt>>>16,tt&=65535,rt+=J+we,rt&=65535,c(lt<<16|mt,rt<<16|tt,this.unsigned)},de.subtract=function(pe){return t(pe)||(pe=b(pe)),this.add(pe.neg())},de.sub=de.subtract,de.multiply=function(pe){if(this.isZero()||(t(pe)||(pe=b(pe)),pe.isZero()))return z;if(this.eq(Le))return pe.isOdd()?Le:z;if(pe.eq(Le))return this.isOdd()?Le:z;if(this.isNegative())return pe.isNegative()?this.neg().mul(pe.neg()):this.neg().mul(pe).neg();if(pe.isNegative())return this.mul(pe.neg()).neg();if(this.lt(W)&&pe.lt(W))return s(this.toNumber()*pe.toNumber(),this.unsigned);var J=this.high>>>16,ne=this.high&65535,ye=this.low>>>16,Ye=this.low&65535,we=pe.high>>>16,Ne=pe.high&65535,Ge=pe.low>>>16,Qe=pe.low&65535,rt=0,tt=0,lt=0,mt=0;return mt+=Ye*Qe,lt+=mt>>>16,mt&=65535,lt+=ye*Qe,tt+=lt>>>16,lt&=65535,lt+=Ye*Ge,tt+=lt>>>16,lt&=65535,tt+=ne*Qe,rt+=tt>>>16,tt&=65535,tt+=ye*Ge,rt+=tt>>>16,tt&=65535,tt+=Ye*Ne,rt+=tt>>>16,tt&=65535,rt+=J*Qe+ne*Ge+ye*Ne+Ye*we,rt&=65535,c(lt<<16|mt,rt<<16|tt,this.unsigned)},de.mul=de.multiply,de.divide=function(pe){if(t(pe)||(pe=b(pe)),pe.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?j:z;var J,ne,ye;if(this.unsigned){if(pe.unsigned||(pe=pe.toUnsigned()),pe.gt(this))return j;if(pe.gt(this.shru(1)))return fe;ye=j}else{if(this.eq(Le)){if(pe.eq(K)||pe.eq(Z))return Le;if(pe.eq(Le))return K;var Ye=this.shr(1);return J=Ye.div(pe).shl(1),J.eq(z)?pe.isNegative()?K:Z:(ne=this.sub(pe.mul(J)),ye=J.add(ne.div(pe)),ye)}else if(pe.eq(Le))return this.unsigned?j:z;if(this.isNegative())return pe.isNegative()?this.neg().div(pe.neg()):this.neg().div(pe).neg();if(pe.isNegative())return this.div(pe.neg()).neg();ye=z}for(ne=this;ne.gte(pe);){J=Math.max(1,Math.floor(ne.toNumber()/pe.toNumber()));for(var we=Math.ceil(Math.log(J)/Math.LN2),Ne=we<=48?1:f(2,we-48),Ge=s(J),Qe=Ge.mul(pe);Qe.isNegative()||Qe.gt(ne);)J-=Ne,Ge=s(J,this.unsigned),Qe=Ge.mul(pe);Ge.isZero()&&(Ge=K),ye=ye.add(Ge),ne=ne.sub(Qe)}return ye},de.div=de.divide,de.modulo=function(pe){return t(pe)||(pe=b(pe)),this.sub(this.div(pe).mul(pe))},de.mod=de.modulo,de.not=function(){return c(~this.low,~this.high,this.unsigned)},de.and=function(pe){return t(pe)||(pe=b(pe)),c(this.low&pe.low,this.high&pe.high,this.unsigned)},de.or=function(pe){return t(pe)||(pe=b(pe)),c(this.low|pe.low,this.high|pe.high,this.unsigned)},de.xor=function(pe){return t(pe)||(pe=b(pe)),c(this.low^pe.low,this.high^pe.high,this.unsigned)},de.shiftLeft=function(pe){return t(pe)&&(pe=pe.toInt()),(pe&=63)===0?this:pe<32?c(this.low<<pe,this.high<<pe|this.low>>>32-pe,this.unsigned):c(0,this.low<<pe-32,this.unsigned)},de.shl=de.shiftLeft,de.shiftRight=function(pe){return t(pe)&&(pe=pe.toInt()),(pe&=63)===0?this:pe<32?c(this.low>>>pe|this.high<<32-pe,this.high>>pe,this.unsigned):c(this.high>>pe-32,this.high>=0?0:-1,this.unsigned)},de.shr=de.shiftRight,de.shiftRightUnsigned=function(pe){if(t(pe)&&(pe=pe.toInt()),pe&=63,pe===0)return this;var J=this.high;if(pe<32){var ne=this.low;return c(ne>>>pe|J<<32-pe,J>>>pe,this.unsigned)}else return pe===32?c(J,0,this.unsigned):c(J>>>pe-32,0,this.unsigned)},de.shru=de.shiftRightUnsigned,de.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},de.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},de.toBytes=function(_e){return _e?this.toBytesLE():this.toBytesBE()},de.toBytesLE=function(){var _e=this.high,pe=this.low;return[pe&255,pe>>>8&255,pe>>>16&255,pe>>>24&255,_e&255,_e>>>8&255,_e>>>16&255,_e>>>24&255]},de.toBytesBE=function(){var _e=this.high,pe=this.low;return[_e>>>24&255,_e>>>16&255,_e>>>8&255,_e&255,pe>>>24&255,pe>>>16&255,pe>>>8&255,pe&255]},e})}(km)),km.exports}var Ihe=She();const Nm=sh(Ihe),Mhe=3,Phe=30,Rhe=2*Phe+1,DP=180/Math.PI;function Fhe(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function LP(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function Ohe(r){return[LP(r[0]),LP(r[1])]}function Dhe(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function Lhe([r,e,t]){const n=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*DP,n*DP]}function khe(r){let e=Nm.fromString(r,!0,10).toString(2);for(;e.length<Mhe+Rhe;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),o=i.length/2,s=Nm.fromString(n,!0,2).toString(10);let c=Nm.fromString(i,!0,2).toString(4);for(;c.length<o;)c="0"+c;return`${s}/${c}`}function Nhe(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Uhe(r){const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length,o=[0,0];let s;for(let c=i-1;c>=0;c--){s=i-c;const f=n[c];let _=0,b=0;f==="1"?b=1:f==="2"?(_=1,b=1):f==="3"&&(_=1);const T=Math.pow(2,s-1);Nhe(T,o,_,b),o[0]+=T*_,o[1]+=T*b}if(t%2===1){const c=o[0];o[0]=o[1],o[1]=c}return{face:t,ij:o,level:s}}function zhe(r){const e=r.padEnd(16,"0");return Nm.fromString(e,16)}const Ghe=100;function Vhe({face:r,ij:e,level:t}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(Ghe*Math.pow(2,-t))),o=new Float64Array(4*i*2+2);let s=0,c=0;for(let f=0;f<4;f++){const _=n[f].slice(0),b=n[f+1],T=(b[0]-_[0])/i,S=(b[1]-_[1])/i;for(let D=0;D<i;D++){_[0]+=T,_[1]+=S;const N=Fhe(e,t,_),G=Ohe(N),W=Dhe(r,G),z=Lhe(W);Math.abs(z[1])>89.999&&(z[0]=c);const j=z[0]-c;z[0]+=j>180?-360:j<-180?360:0,o[s++]=z[0],o[s++]=z[1],c=z[0]}}return o[s++]=o[0],o[s++]=o[1],o}function Hhe(r){if(typeof r=="string"){if(r.indexOf("/")>0)return r;r=zhe(r)}return khe(r.toString())}function jhe(r){const e=Hhe(r),t=Uhe(e);return Vhe(t)}const $he={getS2Token:{type:"accessor",value:r=>r.token}};class Py extends tf{indexToBounds(){const{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>jhe(t(n,i))}}}Py.layerName="S2Layer";Py.defaultProps=$he;const l1=512;function Whe(r,e){let t=0,n=0,i=1<<r.length;const o=i/l1;for(let s=0;s<r.length;s++){i>>=1;const c=parseInt(r[s]);c%2&&(t|=i),c>1&&(n|=i)}return[[t/o,l1-n/o],[(t+e)/o,l1-(n+e)/o]]}function Jhe(r,e=1){const[t,n]=Whe(r,e),[i,o]=tl(t),[s,c]=tl(n);return[s,o,s,c,i,c,i,o,s,o]}const Xhe={getQuadkey:{type:"accessor",value:r=>r.quadkey}};class Ry extends tf{indexToBounds(){const{data:e,extruded:t,getQuadkey:n}=this.props,i=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>Jhe(n(o,s),i),updateTriggers:{getPolygon:i}}}}Ry.layerName="QuadkeyLayer";Ry.defaultProps=Xhe;class Rk{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:n,onError:i}){const{index:o,id:s,bbox:c,userData:f,zoom:_}=this,b=this._loaderId;this._abortController=new AbortController;const{signal:T}=this._abortController,S=await t.scheduleRequest(this,G=>G.isSelected?1:-1);if(!S){this._isCancelled=!0;return}if(this._isCancelled){S.done();return}let D=null,N;try{D=await e({index:o,id:s,bbox:c,userData:f,zoom:_,signal:T})}catch(G){N=G||!0}finally{S.done()}if(b===this._loaderId){if(this._loader=void 0,this.content=D,this._isCancelled&&!D){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,N?i(N,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const ao={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},kP=new ft,Khe=new ft;class wC{constructor(e=[0,0,0],t=[0,0,0],n){n=n||kP.copy(e).add(t).scale(.5),this.center=new ft(n),this.halfDiagonal=new ft(t).subtract(this.center),this.minimum=new ft(e),this.maximum=new ft(t)}clone(){return new wC(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=Khe.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),o=this.center.dot(n)+e.distance;return o-i>0?ao.INSIDE:o+i<0?ao.OUTSIDE:ao.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=kP.from(e).subtract(this.center),{halfDiagonal:n}=this;let i=0,o;return o=Math.abs(t.x)-n.x,o>0&&(i+=o*o),o=Math.abs(t.y)-n.y,o>0&&(i+=o*o),o=Math.abs(t.z)-n.z,o>0&&(i+=o*o),i}}const Cp=new ft,NP=new ft;class Ng{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new ft,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Cp.from(t),this.center=new ft().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ng(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,o=e.radius,s=Cp.copy(i).subtract(t),c=s.magnitude();if(n>=c+o)return this.clone();if(o>=c+n)return e.clone();const f=(n+c+o)*.5;return NP.copy(s).scale((-n+f)/c).add(t),this.center.copy(NP),this.radius=f,this}expand(e){const n=Cp.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=QH(Cp,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=Cp.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,o=e.normal.dot(t)+e.distance;return o<-n?ao.OUTSIDE:o<n?ao.INTERSECTING:ao.INSIDE}}const Yhe=new ft,qhe=new ft,tm=new ft,rm=new ft,nm=new ft,Zhe=new ft,Qhe=new ft,Rl={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ug{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new ft().from(e),this.halfAxes=new ci(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ft(e).len(),new ft(t).len(),new ft(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new ft(e).normalize(),o=new ft(t).normalize(),s=new ft(n).normalize();return new og().fromMatrix3(new ci([...i,...o,...s]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new og(n),o=new ci().fromQuaternion(i);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new ft().from(e),this.halfAxes=o,this}clone(){return new Ug(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ng){const t=this.halfAxes,n=t.getColumn(0,tm),i=t.getColumn(1,rm),o=t.getColumn(2,nm),s=Yhe.copy(n).add(i).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,o=n.x,s=n.y,c=n.z,f=Math.abs(o*i[Rl.COLUMN0ROW0]+s*i[Rl.COLUMN0ROW1]+c*i[Rl.COLUMN0ROW2])+Math.abs(o*i[Rl.COLUMN1ROW0]+s*i[Rl.COLUMN1ROW1]+c*i[Rl.COLUMN1ROW2])+Math.abs(o*i[Rl.COLUMN2ROW0]+s*i[Rl.COLUMN2ROW1]+c*i[Rl.COLUMN2ROW2]),_=n.dot(t)+e.distance;return _<=-f?ao.OUTSIDE:_>=f?ao.INSIDE:ao.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=qhe.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,tm),o=n.getColumn(1,rm),s=n.getColumn(2,nm),c=i.magnitude(),f=o.magnitude(),_=s.magnitude();i.normalize(),o.normalize(),s.normalize();let b=0,T;return T=Math.abs(t.dot(i))-c,T>0&&(b+=T*T),T=Math.abs(t.dot(o))-f,T>0&&(b+=T*T),T=Math.abs(t.dot(s))-_,T>0&&(b+=T*T),b}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=this.center,c=this.halfAxes,f=c.getColumn(0,tm),_=c.getColumn(1,rm),b=c.getColumn(2,nm),T=Zhe.copy(f).add(_).add(b).add(s),S=Qhe.copy(T).subtract(e);let D=t.dot(S);return i=Math.min(D,i),o=Math.max(D,o),T.copy(s).add(f).add(_).subtract(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),T.copy(s).add(f).subtract(_).add(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),T.copy(s).add(f).subtract(_).subtract(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(T).subtract(f).add(_).add(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(T).subtract(f).add(_).subtract(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(T).subtract(f).subtract(_).add(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(T).subtract(f).subtract(_).subtract(b),S.copy(T).subtract(e),D=t.dot(S),i=Math.min(D,i),o=Math.max(D,o),n[0]=i,n[1]=o,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,tm);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,rm);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,nm);return i.transformAsPoint(e),this.halfAxes=new ci([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const UP=new ft,zP=new ft;class ic{constructor(e=[0,0,1],t=0){this.normal=new ft,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return sc(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=UP.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),sc(aa(this.normal.len(),1)),this.distance=i,this}clone(){return new ic(this.normal,this.distance)}equals(e){return aa(this.distance,e.distance)&&aa(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=zP.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){const n=UP.from(e),i=this.getPointDistance(n),o=zP.copy(this.normal).scale(i);return n.subtract(o).to(t)}}const GP=[new ft([1,0,0]),new ft([0,1,0]),new ft([0,0,1])],VP=new ft,ede=new ft;class ia{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*GP.length;const t=e.center,n=e.radius;let i=0;for(const o of GP){let s=this.planes[i],c=this.planes[i+1];s||(s=this.planes[i]=new ic),c||(c=this.planes[i+1]=new ic);const f=VP.copy(o).scale(-n).add(t);s.fromPointNormal(f,o);const _=VP.copy(o).scale(n).add(t),b=ede.copy(o).negate();c.fromPointNormal(_,b),i+=2}return this}computeVisibility(e){let t=ao.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case ao.OUTSIDE:return ao.OUTSIDE;case ao.INTERSECTING:t=ao.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(sc(Number.isFinite(t),"parentPlaneMask is required."),t===ia.MASK_OUTSIDE||t===ia.MASK_INSIDE)return t;let n=ia.MASK_INSIDE;const i=this.planes;for(let o=0;o<this.planes.length;++o){const s=o<31?1<<o:0;if(o<31&&(t&s)===0)continue;const c=i[o],f=e.intersectPlane(c);if(f===ao.OUTSIDE)return ia.MASK_OUTSIDE;f===ao.INTERSECTING&&(n|=s)}return n}}ia.MASK_OUTSIDE=4294967295;ia.MASK_INSIDE=0;ia.MASK_INDETERMINATE=2147483647;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;new ft;const Wc=new ci,tde=new ci,rde=new ci,im=new ci,HP=new ci;function nde(r,e={}){const t=Nj,n=10;let i=0,o=0;const s=tde,c=rde;s.identity(),c.copy(r);const f=t*ide(c);for(;o<n&&sde(c)>f;)ode(c,im),HP.copy(im).transpose(),c.multiplyRight(im),c.multiplyLeft(HP),s.multiplyRight(im),++i>2&&(++o,i=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function ide(r){let e=0;for(let t=0;t<9;++t){const n=r[t];e+=n*n}return Math.sqrt(e)}const Sx=[1,0,0],Ix=[2,2,1];function sde(r){let e=0;for(let t=0;t<3;++t){const n=r[Wc.getElementIndex(Ix[t],Sx[t])];e+=2*n*n}return Math.sqrt(e)}function ode(r,e){const t=p6;let n=0,i=1;for(let _=0;_<3;++_){const b=Math.abs(r[Wc.getElementIndex(Ix[_],Sx[_])]);b>n&&(i=_,n=b)}const o=Sx[i],s=Ix[i];let c=1,f=0;if(Math.abs(r[Wc.getElementIndex(s,o)])>t){const _=r[Wc.getElementIndex(s,s)],b=r[Wc.getElementIndex(o,o)],T=r[Wc.getElementIndex(s,o)],S=(_-b)/2/T;let D;S<0?D=-1/(-S+Math.sqrt(1+S*S)):D=1/(S+Math.sqrt(1+S*S)),c=1/Math.sqrt(1+D*D),f=D*c}return ci.IDENTITY.to(e),e[Wc.getElementIndex(o,o)]=e[Wc.getElementIndex(s,s)]=c,e[Wc.getElementIndex(s,o)]=f,e[Wc.getElementIndex(o,s)]=-f,e}const Tu=new ft,ade=new ft,cde=new ft,lde=new ft,ude=new ft,fde=new ci,hde={diagonal:new ci,unitary:new ci};function Fk(r,e=new Ug){if(!r||r.length===0)return e.halfAxes=new ci([0,0,0,0,0,0,0,0,0]),e.center=new ft,e;const t=r.length,n=new ft(0,0,0);for(const de of r)n.add(de);const i=1/t;n.multiplyByScalar(i);let o=0,s=0,c=0,f=0,_=0,b=0;for(const de of r){const _e=Tu.copy(de).subtract(n);o+=_e.x*_e.x,s+=_e.x*_e.y,c+=_e.x*_e.z,f+=_e.y*_e.y,_+=_e.y*_e.z,b+=_e.z*_e.z}o*=i,s*=i,c*=i,f*=i,_*=i,b*=i;const T=fde;T[0]=o,T[1]=s,T[2]=c,T[3]=s,T[4]=f,T[5]=_,T[6]=c,T[7]=_,T[8]=b;const{unitary:S}=nde(T,hde),D=e.halfAxes.copy(S);let N=D.getColumn(0,cde),G=D.getColumn(1,lde),W=D.getColumn(2,ude),z=-Number.MAX_VALUE,j=-Number.MAX_VALUE,K=-Number.MAX_VALUE,fe=Number.MAX_VALUE,Z=Number.MAX_VALUE,ae=Number.MAX_VALUE;for(const de of r)Tu.copy(de),z=Math.max(Tu.dot(N),z),j=Math.max(Tu.dot(G),j),K=Math.max(Tu.dot(W),K),fe=Math.min(Tu.dot(N),fe),Z=Math.min(Tu.dot(G),Z),ae=Math.min(Tu.dot(W),ae);N=N.multiplyByScalar(.5*(fe+z)),G=G.multiplyByScalar(.5*(Z+j)),W=W.multiplyByScalar(.5*(ae+K)),e.center.copy(N).add(G).add(W);const Be=ade.set(z-fe,j-Z,K-ae).multiplyByScalar(.5),Le=new ci([Be[0],0,0,0,Be[1],0,0,0,Be[2]]);return e.halfAxes.multiplyRight(Le),e}const Zd=512,dde=3,Ok=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Dk=Ok.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Ade=Dk.concat([[.25,.5],[.75,.5]]);class Qd{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=this.x*2,t=this.y*2,n=this.z+1;this._children=[new Qd(e,t,n),new Qd(e,t+1,n),new Qd(e+1,t,n),new Qd(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:i,minZ:o,maxZ:s,bounds:c,offset:f,project:_}=e,b=this.getBoundingVolume(i,f,_);if(c&&!this.insideBounds(c)||n.computeVisibility(b)<0)return!1;if(!this.childVisible){let{z:S}=this;if(S<s&&S>=o){const D=b.distanceTo(t.cameraPosition)*t.scale/t.height;S+=Math.floor(Math.log2(D))}if(S>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const S of this.children)S.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,n,i]){const o=Math.pow(2,this.z),s=Zd/o;return this.x*s<n&&this.y*s<i&&(this.x+1)*s>e&&(this.y+1)*s>t}getBoundingVolume(e,t,n){if(n){const f=this.z<1?Ade:this.z<2?Dk:Ok,_=[];for(const b of f){const T=Px(this.x+b[0],this.y+b[1],this.z);T[2]=e[0],_.push(n(T)),e[0]!==e[1]&&(T[2]=e[1],_.push(n(T)))}return Fk(_)}const i=Math.pow(2,this.z),o=Zd/i,s=this.x*o+t*Zd,c=Zd-(this.y+1)*o;return new wC([s,c,e[0]],[s+o,c+o,e[1]])}}function pde(r,e,t,n){const i=r instanceof hZ&&r.resolution?r.projectPosition:null,o=Object.values(r.getFrustumPlanes()).map(({normal:D,distance:N})=>new ic(D.clone().negate(),N)),s=new ia(o),c=r.distanceScales.unitsPerMeter[2],f=t&&t[0]*c||0,_=t&&t[1]*c||0,b=r instanceof lg&&r.pitch<=60?e:0;if(n){const[D,N,G,W]=n,z=Gl([D,W]),j=Gl([G,N]);n=[z[0],Zd-z[1],j[0],Zd-j[1]]}const T=new Qd(0,0,0),S={viewport:r,project:i,cullingVolume:s,elevationBounds:[f,_],minZ:b,maxZ:e,bounds:n,offset:0};if(T.update(S),r instanceof lg&&r.subViewports&&r.subViewports.length>1){for(S.offset=-1;T.update(S)&&!(--S.offset<-3););for(S.offset=1;T.update(S)&&!(++S.offset>dde););}return T.getSelected()}const Vl=512,gde=[-1/0,-1/0,1/0,1/0],M_={type:"object",value:null,validate:(r,e)=>e.optional&&r===null||typeof r=="string"||Array.isArray(r)&&r.every(t=>typeof t=="string"),equal:(r,e)=>{if(r===e)return!0;if(!Array.isArray(r)||!Array.isArray(e))return!1;const t=r.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}};function Lk(r,e){const t=[e.transformAsPoint([r[0],r[1]]),e.transformAsPoint([r[2],r[1]]),e.transformAsPoint([r[0],r[3]]),e.transformAsPoint([r[2],r[3]])];return[Math.min(...t.map(i=>i[0])),Math.min(...t.map(i=>i[1])),Math.max(...t.map(i=>i[0])),Math.max(...t.map(i=>i[1]))]}function mde(r){return Math.abs(r.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function th(r,e){if(!r||!r.length)return null;const{index:t,id:n}=e;if(Array.isArray(r)){const o=mde(n)%r.length;r=r[o]}let i=r;for(const o of Object.keys(t)){const s=new RegExp(`{${o}}`,"g");i=i.replace(s,String(t[o]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),i}function _de(r,e,t){let n;return n=r.getBounds(),r.isGeospatial?[Math.max(n[0],t[0]),Math.max(n[1],t[1]),Math.min(n[2],t[2]),Math.min(n[3],t[3])]:[Math.max(Math.min(n[0],t[2]),t[0]),Math.max(Math.min(n[1],t[3]),t[1]),Math.min(Math.max(n[2],t[0]),t[2]),Math.min(Math.max(n[3],t[1]),t[3])]}function yde({viewport:r,z:e,cullRect:t}){return(r.subViewports||[r]).map(i=>Mx(i,e||0,t))}function Mx(r,e,t){if(!Array.isArray(e)){const o=t.x-r.x,s=t.y-r.y,{width:c,height:f}=t,_={targetZ:e},b=r.unproject([o,s],_),T=r.unproject([o+c,s],_),S=r.unproject([o,s+f],_),D=r.unproject([o+c,s+f],_);return[Math.min(b[0],T[0],S[0],D[0]),Math.min(b[1],T[1],S[1],D[1]),Math.max(b[0],T[0],S[0],D[0]),Math.max(b[1],T[1],S[1],D[1])]}const n=Mx(r,e[0],t),i=Mx(r,e[1],t);return[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[2],i[2]),Math.max(n[3],i[3])]}function vde(r,e,t){return t?Lk(r,t).map(i=>i*e/Vl):r.map(n=>n*e/Vl)}function CC(r,e){return Math.pow(2,r)*Vl/e}function Px(r,e,t){const n=CC(t,Vl),i=r/n*360-180,o=Math.PI-2*Math.PI*e/n,s=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[i,s]}function jP(r,e,t,n){const i=CC(t,n);return[r/i*Vl,e/i*Vl]}function bde(r,e,t,n,i=Vl){if(r.isGeospatial){const[_,b]=Px(e,t,n),[T,S]=Px(e+1,t+1,n);return{west:_,north:b,east:T,south:S}}const[o,s]=jP(e,t,n,i),[c,f]=jP(e+1,t+1,n,i);return{left:o,top:s,right:c,bottom:f}}function xde(r,e,t,n,i){const o=_de(r,null,n),s=CC(e,t),[c,f,_,b]=vde(o,s,i),T=[];for(let S=Math.floor(c);S<_;S++)for(let D=Math.floor(f);D<b;D++)T.push({x:S,y:D,z:e});return T}function wde({viewport:r,maxZoom:e,minZoom:t,zRange:n,extent:i,tileSize:o=Vl,modelMatrix:s,modelMatrixInverse:c,zoomOffset:f=0}){let _=r.isGeospatial?Math.round(r.zoom+Math.log2(Vl/o))+f:Math.ceil(r.zoom)+f;if(typeof t=="number"&&Number.isFinite(t)&&_<t){if(!i)return[];_=t}typeof e=="number"&&Number.isFinite(e)&&_>e&&(_=e);let b=i;return s&&c&&i&&!r.isGeospatial&&(b=Lk(i,s)),r.isGeospatial?pde(r,_,n,i):xde(r,_,o,b||gde,c)}function Cde(r){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(r)}function Ede(r){return Number.isFinite(r.west)&&Number.isFinite(r.north)&&Number.isFinite(r.east)&&Number.isFinite(r.south)}function Tde(r){let e={},t;return n=>{for(const i in n)if(!Bde(n[i],e[i])){t=r(n),e=n;break}return t}}function Bde(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}const $P=1,Fy=2,Sde="never",Ide="no-overlap",EC="best-available",Mde=5,Pde={[EC]:Fde,[Ide]:Ode,[Sde]:()=>{}},Rde={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Oy{constructor(e){this._getCullBounds=Tde(yde),this.opts={...Rde,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var n,i;(i=(n=this.opts).onTileLoad)==null||i.call(n,t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Ek({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new dn,this._modelMatrixInverse=new dn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:n}={zRange:null,modelMatrix:null}){const i=n?new dn(n):new dn,o=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!aa(this._zRange,t)||o){o&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(f=>this._getTile(f,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:i}=e;for(const[o,s,c,f]of n){let _;if("west"in i)_=i.west<c&&i.east>o&&i.south<f&&i.north>s;else{const b=Math.min(i.top,i.bottom),T=Math.max(i.top,i.bottom);_=i.left<c&&i.right>o&&b<f&&T>s}if(_)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:n,zRange:i,modelMatrix:o,modelMatrixInverse:s}){const{tileSize:c,extent:f,zoomOffset:_}=this.opts;return wde({viewport:e,maxZoom:t,minZoom:n,zRange:i,tileSize:c,extent:f,modelMatrix:o,modelMatrixInverse:s,zoomOffset:_})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:bde(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),n=Math.floor(e.y/2),i=e.z-1;return{x:t,y:n,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||EC,t=new Array(this._cache.size);let n=0;for(const i of this._cache.values())t[n++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:Pde[e])(Array.from(this._cache.values())),n=0;for(const i of this._cache.values())if(t[n++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let n=0;for(const i of this._cache.values())i.isLoading&&(n++,!i.isSelected&&!i.isVisible&&t.push(i));for(;e>0&&n>e&&t.length>0;)t.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const n=this._getNearestAncestor(t);t.parent=n,n!=null&&n.children&&n.children.push(t)}}_resizeCache(){var s,c;const{_cache:e,opts:t}=this,n=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:Mde*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>n||this._cacheByteSize>i){for(const[f,_]of e)if(!_.isVisible&&!_.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?_.byteLength:0,e.delete(f),(c=(s=this.opts).onTileUnload)==null||c.call(s,_)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((f,_)=>f.zoom-_.zoom),this._dirty=!1)}_getTile(e,t){const n=this.getTileId(e);let i=this._cache.get(n),o=!1;return!i&&t?(i=new Rk(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:n,zoom:this.getTileZoom(i.index)}),o=!0,this._cache.set(n,i),this._dirty=!0):i&&i.needsReload&&(o=!0),i&&o&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let n=e.index;for(;this.getTileZoom(n)>t;){n=this.getParentIndex(n);const i=this._getTile(n);if(i)return i}return null}}function Fde(r){for(const e of r)e.state=0;for(const e of r)e.isSelected&&!kk(e)&&TC(e);for(const e of r)e.isVisible=!!(e.state&Fy)}function Ode(r){for(const t of r)t.state=0;for(const t of r)t.isSelected&&kk(t);const e=Array.from(r).sort((t,n)=>t.zoom-n.zoom);for(const t of e)if(t.isVisible=!!(t.state&Fy),t.children&&(t.isVisible||t.state&$P))for(const n of t.children)n.state=$P;else t.isSelected&&TC(t)}function kk(r){let e=r;for(;e;){if(e.isLoaded||e.content)return e.state|=Fy,!0;e=e.parent}return!1}function TC(r){for(const e of r.children)e.isLoaded||e.content?e.state|=Fy:TC(e)}const Dde={TilesetClass:Oy,data:{type:"data",value:[]},dataComparator:M_.equal,renderSubLayers:{type:"function",value:r=>new Wl(r)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:r=>console.error(r)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:EC,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Xl extends ys{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,n;return!!((n=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&n.every(i=>i.isLoaded&&i.layers&&i.layers.every(o=>o.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?n&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(o=>{o.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:n,refinementStrategy:i,extent:o,maxZoom:s,minZoom:c,maxRequests:f,debounceTime:_,zoomOffset:b}=this.props;return{maxCacheSize:t,maxCacheByteSize:n,maxZoom:s,minZoom:c,tileSize:e,refinementStrategy:i,extent:o,maxRequests:f,debounceTime:_,zoomOffset:b,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:o}=e,s=this.state.isLoaded!==o,c=this.state.frameNumber!==i;o&&(s||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:i}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:n,fetch:i}=this.props,{signal:o}=e;return e.url=typeof t=="string"||Array.isArray(t)?th(t,e):null,n?n(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,n=t.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(n=>e.layers[0].props[n]!==t[n])&&(e.layers=e.layers.map(n=>n.clone(t)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=hy(n,Boolean).map(i=>i.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,t)}}Xl.defaultProps=Dde;Xl.layerName="TileLayer";const WP=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,Lde={name:"trips",vs:WP,fs:WP,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},kde={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:r=>r.timestamps}};class Dy extends Zu{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,Lde],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:n,currentTime:i}=this.props,o={fadeTrail:t,trailLength:n,currentTime:i};this.state.model.shaderInputs.setProps({trips:o}),super.draw(e)}}Dy.layerName="TripsLayer";Dy.defaultProps=kde;var Rr=function(r){r=r||{};var e=typeof r<"u"?r:{},t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);var i="";function o(Ae){return e.locateFile?e.locateFile(Ae,i):i+Ae}var s;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",s=function(xe,ce,Se){var p=new XMLHttpRequest;p.open("GET",xe,!0),p.responseType="arraybuffer",p.onload=function(){if(p.status==200||p.status==0&&p.response){ce(p.response);return}var vt=Mt(xe);if(vt){ce(vt.buffer);return}Se()},p.onerror=Se,p.send(null)};var c=e.print||console.log.bind(console),f=e.printErr||console.warn.bind(console);for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);t=null,e.arguments&&e.arguments;var _=0,b=function(Ae){_=Ae},T=function(){return _},S=8;function D(Ae,xe,ce,Se){switch(ce=ce||"i8",ce.charAt(ce.length-1)==="*"&&(ce="i32"),ce){case"i1":J[Ae>>0]=xe;break;case"i8":J[Ae>>0]=xe;break;case"i16":ye[Ae>>1]=xe;break;case"i32":Ye[Ae>>2]=xe;break;case"i64":Wn=[xe>>>0,(bn=xe,+Ar(bn)>=1?bn>0?(pr(+hr(bn/4294967296),4294967295)|0)>>>0:~~+Mn((bn-+(~~bn>>>0))/4294967296)>>>0:0)],Ye[Ae>>2]=Wn[0],Ye[Ae+4>>2]=Wn[1];break;case"float":we[Ae>>2]=xe;break;case"double":Ne[Ae>>3]=xe;break;default:De("invalid type for setValue: "+ce)}}function N(Ae,xe,ce){switch(xe=xe||"i8",xe.charAt(xe.length-1)==="*"&&(xe="i32"),xe){case"i1":return J[Ae>>0];case"i8":return J[Ae>>0];case"i16":return ye[Ae>>1];case"i32":return Ye[Ae>>2];case"i64":return Ye[Ae>>2];case"float":return we[Ae>>2];case"double":return Ne[Ae>>3];default:De("invalid type for getValue: "+xe)}return null}var G=!1;function W(Ae,xe){Ae||De("Assertion failed: "+xe)}function z(Ae){var xe=e["_"+Ae];return W(xe,"Cannot call unknown function "+Ae+", make sure it is exported"),xe}function j(Ae,xe,ce,Se,p){var le={string:function(St){var zt=0;if(St!=null&&St!==0){var Fr=(St.length<<2)+1;zt=yt(Fr),Le(St,zt,Fr)}return zt},array:function(St){var zt=yt(St.length);return de(St,zt),zt}};function vt(St){return xe==="string"?ae(St):xe==="boolean"?!!St:St}var Ke=z(Ae),Ct=[],It=0;if(Se)for(var Ft=0;Ft<Se.length;Ft++){var ut=le[ce[Ft]];ut?(It===0&&(It=Te()),Ct[Ft]=ut(Se[Ft])):Ct[Ft]=Se[Ft]}var Ot=Ke.apply(null,Ct);return Ot=vt(Ot),It!==0&&Et(It),Ot}function K(Ae,xe,ce,Se){ce=ce||[];var p=ce.every(function(vt){return vt==="number"}),le=xe!=="string";return le&&p&&!Se?z(Ae):function(){return j(Ae,xe,ce,arguments)}}var fe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Z(Ae,xe,ce){for(var Se=xe+ce,p=xe;Ae[p]&&!(p>=Se);)++p;if(p-xe>16&&Ae.subarray&&fe)return fe.decode(Ae.subarray(xe,p));for(var le="";xe<p;){var vt=Ae[xe++];if(!(vt&128)){le+=String.fromCharCode(vt);continue}var Ke=Ae[xe++]&63;if((vt&224)==192){le+=String.fromCharCode((vt&31)<<6|Ke);continue}var Ct=Ae[xe++]&63;if((vt&240)==224?vt=(vt&15)<<12|Ke<<6|Ct:vt=(vt&7)<<18|Ke<<12|Ct<<6|Ae[xe++]&63,vt<65536)le+=String.fromCharCode(vt);else{var It=vt-65536;le+=String.fromCharCode(55296|It>>10,56320|It&1023)}}return le}function ae(Ae,xe){return Ae?Z(ne,Ae,xe):""}function Be(Ae,xe,ce,Se){if(!(Se>0))return 0;for(var p=ce,le=ce+Se-1,vt=0;vt<Ae.length;++vt){var Ke=Ae.charCodeAt(vt);if(Ke>=55296&&Ke<=57343){var Ct=Ae.charCodeAt(++vt);Ke=65536+((Ke&1023)<<10)|Ct&1023}if(Ke<=127){if(ce>=le)break;xe[ce++]=Ke}else if(Ke<=2047){if(ce+1>=le)break;xe[ce++]=192|Ke>>6,xe[ce++]=128|Ke&63}else if(Ke<=65535){if(ce+2>=le)break;xe[ce++]=224|Ke>>12,xe[ce++]=128|Ke>>6&63,xe[ce++]=128|Ke&63}else{if(ce+3>=le)break;xe[ce++]=240|Ke>>18,xe[ce++]=128|Ke>>12&63,xe[ce++]=128|Ke>>6&63,xe[ce++]=128|Ke&63}}return xe[ce]=0,ce-p}function Le(Ae,xe,ce){return Be(Ae,ne,xe,ce)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function de(Ae,xe){J.set(Ae,xe)}function _e(Ae,xe){return Ae%xe>0&&(Ae+=xe-Ae%xe),Ae}var pe,J,ne,ye,Ye,we,Ne;function Ge(Ae){pe=Ae,e.HEAP8=J=new Int8Array(Ae),e.HEAP16=ye=new Int16Array(Ae),e.HEAP32=Ye=new Int32Array(Ae),e.HEAPU8=ne=new Uint8Array(Ae),e.HEAPU16=new Uint16Array(Ae),e.HEAPU32=new Uint32Array(Ae),e.HEAPF32=we=new Float32Array(Ae),e.HEAPF64=Ne=new Float64Array(Ae)}var Qe=5267040,rt=24128,tt=e.TOTAL_MEMORY||33554432;e.buffer?pe=e.buffer:pe=new ArrayBuffer(tt),tt=pe.byteLength,Ge(pe),Ye[rt>>2]=Qe;function lt(Ae){for(;Ae.length>0;){var xe=Ae.shift();if(typeof xe=="function"){xe();continue}var ce=xe.func;typeof ce=="number"?xe.arg===void 0?e.dynCall_v(ce):e.dynCall_vi(ce,xe.arg):ce(xe.arg===void 0?null:xe.arg)}}var mt=[],Tt=[],nt=[],cr=[];function Xt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)tn(e.preRun.shift());lt(mt)}function $t(){lt(Tt)}function Lt(){lt(nt)}function lr(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Er(e.postRun.shift());lt(cr)}function tn(Ae){mt.unshift(Ae)}function Er(Ae){cr.unshift(Ae)}var Ar=Math.abs,Mn=Math.ceil,hr=Math.floor,pr=Math.min,rn=0,Sr=null;function ei(Ae){rn++,e.monitorRunDependencies&&e.monitorRunDependencies(rn)}function $n(Ae){if(rn--,e.monitorRunDependencies&&e.monitorRunDependencies(rn),rn==0&&Sr){var xe=Sr;Sr=null,xe()}}e.preloadedImages={},e.preloadedAudios={};var un=null,Xn="data:application/octet-stream;base64,";function Nn(Ae){return String.prototype.startsWith?Ae.startsWith(Xn):Ae.indexOf(Xn)===0}var bn,Wn;un="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Ut=24144;function dr(Ae,xe,ce,Se){De("Assertion failed: "+ae(Ae)+", at: "+[xe?ae(xe):"unknown filename",ce,Se?ae(Se):"unknown function"])}function Tr(){return J.length}function qr(Ae,xe,ce){ne.set(ne.subarray(xe,xe+ce),Ae)}function ui(Ae){return e.___errno_location&&(Ye[e.___errno_location()>>2]=Ae),Ae}function Pe(Ae){De("OOM")}function Dt(Ae){try{var xe=new ArrayBuffer(Ae);return xe.byteLength!=Ae?void 0:(new Int8Array(xe).set(J),$(xe),Ge(xe),1)}catch{}}function Vt(Ae){var xe=Tr(),ce=16777216,Se=2147483648-ce;if(Ae>Se)return!1;for(var p=16777216,le=Math.max(xe,p);le<Ae;)le<=536870912?le=_e(2*le,ce):le=Math.min(_e((3*le+2147483648)/4,ce),Se);var vt=Dt(le);return!!vt}var sr=typeof atob=="function"?atob:function(Ae){var xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ce="",Se,p,le,vt,Ke,Ct,It,Ft=0;Ae=Ae.replace(/[^A-Za-z0-9\+\/\=]/g,"");do vt=xe.indexOf(Ae.charAt(Ft++)),Ke=xe.indexOf(Ae.charAt(Ft++)),Ct=xe.indexOf(Ae.charAt(Ft++)),It=xe.indexOf(Ae.charAt(Ft++)),Se=vt<<2|Ke>>4,p=(Ke&15)<<4|Ct>>2,le=(Ct&3)<<6|It,ce=ce+String.fromCharCode(Se),Ct!==64&&(ce=ce+String.fromCharCode(p)),It!==64&&(ce=ce+String.fromCharCode(le));while(Ft<Ae.length);return ce};function Ze(Ae){try{for(var xe=sr(Ae),ce=new Uint8Array(xe.length),Se=0;Se<xe.length;++Se)ce[Se]=xe.charCodeAt(Se);return ce}catch{throw new Error("Converting base64 string to bytes failed.")}}function Mt(Ae){if(Nn(Ae))return Ze(Ae.slice(Xn.length))}var ge={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Nt={b,c:T,d:dr,e:ui,f:Tr,g:qr,h:Vt,i:Pe,o:Ut,p:rt},wt=function(Ae,xe,ce){"almost asm";var Se=new Ae.Int8Array(ce),p=new Ae.Int32Array(ce);new Ae.Uint8Array(ce),new Ae.Float32Array(ce);var le=new Ae.Float64Array(ce),vt=xe.o|0,Ke=xe.p|0,Ct=Ae.Math.floor,It=Ae.Math.abs,Ft=Ae.Math.sqrt,ut=Ae.Math.pow,Ot=Ae.Math.cos,St=Ae.Math.sin,zt=Ae.Math.tan,Fr=Ae.Math.acos,qt=Ae.Math.asin,Xr=Ae.Math.atan,en=Ae.Math.atan2,zr=Ae.Math.ceil,Gr=Ae.Math.imul,Lr=Ae.Math.min,fi=Ae.Math.max,Vr=Ae.Math.clz32,fr=xe.b,Me=xe.c,Wt=xe.d,Kr=xe.e,Ui=xe.f,la=xe.g,ti=xe.h,Un=xe.i,Ie=24160;function ko(y){return Se=new Int8Array(y),p=new Int32Array(y),le=new Float64Array(y),ce=y,!0}function zn(y){y=y|0;var m=0;return m=Ie,Ie=Ie+y|0,Ie=Ie+15&-16,m|0}function No(){return Ie|0}function Si(y){y=y|0,Ie=y}function ri(y,m){y=y|0,Ie=y}function xi(y,m){y=y|0,m=m|0;var v=0,w=0,B=0;return(y|0)<0?(m=2,m|0):(y|0)>13780509?(m=$o(15,m)|0,m|0):(v=((y|0)<0)<<31>>31,B=si(y|0,v|0,3,0)|0,w=Me()|0,v=cn(y|0,v|0,1,0)|0,v=si(B|0,w|0,v|0,Me()|0)|0,v=cn(v|0,Me()|0,1,0)|0,y=Me()|0,p[m>>2]=v,p[m+4>>2]=y,m=0,m|0)}function Bn(y,m,v,w){return y=y|0,m=m|0,v=v|0,w=w|0,us(y,m,v,w,0)|0}function us(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0;if(d=Ie,Ie=Ie+16|0,O=d,!(zi(y,m,v,w,B)|0))return w=0,Ie=d,w|0;do if((v|0)>=0){if((v|0)>13780509){if(M=$o(15,O)|0,M|0)break;l=O,O=p[l>>2]|0,l=p[l+4>>2]|0}else M=((v|0)<0)<<31>>31,h=si(v|0,M|0,3,0)|0,l=Me()|0,M=cn(v|0,M|0,1,0)|0,M=si(h|0,l|0,M|0,Me()|0)|0,M=cn(M|0,Me()|0,1,0)|0,l=Me()|0,p[O>>2]=M,p[O+4>>2]=l,O=M;if(Yo(w|0,0,O<<3|0)|0,B|0){Yo(B|0,0,O<<2|0)|0,M=Ps(y,m,v,w,B,O,l,0)|0;break}M=eo(O,4)|0,M?(h=Ps(y,m,v,w,M,O,l,0)|0,Or(M),M=h):M=13}else M=2;while(!1);return h=M,Ie=d,h|0}function zi(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0;if(U=Ie,Ie=Ie+16|0,R=U,L=U+8|0,P=R,p[P>>2]=y,p[P+4>>2]=m,(v|0)<0)return L=2,Ie=U,L|0;if(M=w,p[M>>2]=y,p[M+4>>2]=m,M=(B|0)!=0,M&&(p[B>>2]=0),Sn(y,m)|0)return L=9,Ie=U,L|0;p[L>>2]=0;e:do if((v|0)>=1)if(M)for(g=1,h=0,C=0,P=1,M=y;;){if(!(h|C)){if(M=wn(M,m,4,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,Sn(M,m)|0){M=9;break e}}if(M=wn(M,m,p[22384+(C<<2)>>2]|0,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,y=w+(g<<3)|0,p[y>>2]=M,p[y+4>>2]=m,p[B+(g<<2)>>2]=P,y=h+1|0,O=(y|0)==(P|0),l=C+1|0,d=(l|0)==6,Sn(M,m)|0){M=9;break e}if(P=P+(d&O&1)|0,(P|0)>(v|0)){M=0;break}else g=g+1|0,h=O?0:y,C=O?d?0:l:C}else for(g=1,h=0,C=0,P=1,M=y;;){if(!(h|C)){if(M=wn(M,m,4,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,Sn(M,m)|0){M=9;break e}}if(M=wn(M,m,p[22384+(C<<2)>>2]|0,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,y=w+(g<<3)|0,p[y>>2]=M,p[y+4>>2]=m,y=h+1|0,O=(y|0)==(P|0),l=C+1|0,d=(l|0)==6,Sn(M,m)|0){M=9;break e}if(P=P+(d&O&1)|0,(P|0)>(v|0)){M=0;break}else g=g+1|0,h=O?0:y,C=O?d?0:l:C}else M=0;while(!1);return L=M,Ie=U,L|0}function Ps(y,m,v,w,B,M,O,l){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0,O=O|0,l=l|0;var d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0;if(U=Ie,Ie=Ie+16|0,R=U+8|0,L=U,d=mo(y|0,m|0,M|0,O|0)|0,g=Me()|0,C=w+(d<<3)|0,X=C,te=p[X>>2]|0,X=p[X+4>>2]|0,h=(te|0)==(y|0)&(X|0)==(m|0),!((te|0)==0&(X|0)==0|h))do d=cn(d|0,g|0,1,0)|0,d=Qi(d|0,Me()|0,M|0,O|0)|0,g=Me()|0,C=w+(d<<3)|0,te=C,X=p[te>>2]|0,te=p[te+4>>2]|0,h=(X|0)==(y|0)&(te|0)==(m|0);while(!((X|0)==0&(te|0)==0|h));if(d=B+(d<<2)|0,h&&(p[d>>2]|0)<=(l|0)||(te=C,p[te>>2]=y,p[te+4>>2]=m,p[d>>2]=l,(l|0)>=(v|0)))return te=0,Ie=U,te|0;switch(h=l+1|0,p[R>>2]=0,d=wn(y,m,2,R,L)|0,d|0){case 9:{P=9;break}case 0:{d=L,d=Ps(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d||(P=9);break}}e:do if((P|0)==9){switch(p[R>>2]=0,d=wn(y,m,3,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ps(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=wn(y,m,1,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ps(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=wn(y,m,5,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ps(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=wn(y,m,4,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ps(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}switch(p[R>>2]=0,d=wn(y,m,6,R,L)|0,d|0){case 9:break;case 0:{if(d=L,d=Ps(p[d>>2]|0,p[d+4>>2]|0,v,w,B,M,O,h)|0,d|0)break e;break}default:break e}return te=0,Ie=U,te|0}while(!1);return te=d,Ie=U,te|0}function wn(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0;if(v>>>0>6)return B=1,B|0;if(C=(p[w>>2]|0)%6|0,p[w>>2]=C,(C|0)>0){M=0;do v=Ao(v)|0,M=M+1|0;while((M|0)<(p[w>>2]|0))}if(C=jt(y|0,m|0,45)|0,Me()|0,g=C&127,g>>>0>121)return B=5,B|0;d=Yi(y,m)|0,M=jt(y|0,m|0,52)|0,Me()|0,M=M&15;e:do if(!M)h=8;else{for(;;){if(O=(15-M|0)*3|0,l=jt(y|0,m|0,O|0)|0,Me()|0,l=l&7,(l|0)==7){m=5;break}if(L=(Fs(M)|0)==0,M=M+-1|0,P=Zt(7,0,O|0)|0,m=m&~(Me()|0),R=Zt(p[(L?432:16)+(l*28|0)+(v<<2)>>2]|0,0,O|0)|0,O=Me()|0,v=p[(L?640:224)+(l*28|0)+(v<<2)>>2]|0,y=R|y&~P,m=O|m,!v){v=0;break e}if(!M){h=8;break e}}return m|0}while(!1);(h|0)==8&&(L=p[848+(g*28|0)+(v<<2)>>2]|0,R=Zt(L|0,0,45)|0,y=R|y,m=Me()|0|m&-1040385,v=p[4272+(g*28|0)+(v<<2)>>2]|0,(L&127|0)==127&&(L=Zt(p[848+(g*28|0)+20>>2]|0,0,45)|0,m=Me()|0|m&-1040385,v=p[4272+(g*28|0)+20>>2]|0,y=po(L|y,m)|0,m=Me()|0,p[w>>2]=(p[w>>2]|0)+1)),l=jt(y|0,m|0,45)|0,Me()|0,l=l&127;e:do if(wr(l)|0){t:do if((Yi(y,m)|0)==1){if((g|0)!=(l|0))if(nf(l,p[7696+(g*28|0)>>2]|0)|0){y=za(y,m)|0,O=1,m=Me()|0;break}else Wt(23313,22416,436,22424);switch(d|0){case 3:{y=po(y,m)|0,m=Me()|0,p[w>>2]=(p[w>>2]|0)+1,O=0;break t}case 5:{y=za(y,m)|0,m=Me()|0,p[w>>2]=(p[w>>2]|0)+5,O=0;break t}case 0:return L=9,L|0;default:return L=1,L|0}}else O=0;while(!1);if((v|0)>0){M=0;do y=_a(y,m)|0,m=Me()|0,M=M+1|0;while((M|0)!=(v|0))}if((g|0)!=(l|0)){if(!(ni(l)|0)){if((O|0)!=0|(Yi(y,m)|0)!=5)break;p[w>>2]=(p[w>>2]|0)+1;break}switch(C&127){case 8:case 118:break e}(Yi(y,m)|0)!=3&&(p[w>>2]=(p[w>>2]|0)+1)}}else if((v|0)>0){M=0;do y=po(y,m)|0,m=Me()|0,M=M+1|0;while((M|0)!=(v|0))}while(!1);return p[w>>2]=((p[w>>2]|0)+v|0)%6|0,L=B,p[L>>2]=y,p[L+4>>2]=m,L=0,L|0}function cl(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;for(l=Ie,Ie=Ie+16|0,M=l,O=l+8|0,B=(Sn(y,m)|0)==0,B=B?1:2;;){if(p[O>>2]=0,h=(wn(y,m,B,O,M)|0)==0,d=M,h&((p[d>>2]|0)==(v|0)?(p[d+4>>2]|0)==(w|0):0)){y=4;break}if(B=B+1|0,B>>>0>=7){B=7,y=4;break}}return(y|0)==4?(Ie=l,B|0):0}function Ce(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0;if(L=Ie,Ie=Ie+16|0,P=L,R=L+8|0,C=P,p[C>>2]=y,p[C+4>>2]=m,!v)return R=w,p[R>>2]=y,p[R+4>>2]=m,R=0,Ie=L,R|0;p[R>>2]=0;e:do if(Sn(y,m)|0)y=9;else{if(M=(v|0)>0,M){B=0,C=y;do{if(y=wn(C,m,4,R,P)|0,y|0)break e;if(m=P,C=p[m>>2]|0,m=p[m+4>>2]|0,B=B+1|0,Sn(C,m)|0){y=9;break e}}while((B|0)<(v|0));if(g=w,p[g>>2]=C,p[g+4>>2]=m,g=v+-1|0,M){h=0,y=1;do{if(B=22384+(h<<2)|0,(h|0)==5)for(O=p[B>>2]|0,M=0,B=y;;){if(y=P,y=wn(p[y>>2]|0,p[y+4>>2]|0,O,R,P)|0,y|0)break e;if((M|0)!=(g|0))if(d=P,l=p[d>>2]|0,d=p[d+4>>2]|0,y=w+(B<<3)|0,p[y>>2]=l,p[y+4>>2]=d,!(Sn(l,d)|0))y=B+1|0;else{y=9;break e}else y=B;if(M=M+1|0,(M|0)>=(v|0))break;B=y}else for(O=P,d=p[B>>2]|0,l=0,B=y,M=p[O>>2]|0,O=p[O+4>>2]|0;;){if(y=wn(M,O,d,R,P)|0,y|0)break e;if(O=P,M=p[O>>2]|0,O=p[O+4>>2]|0,y=w+(B<<3)|0,p[y>>2]=M,p[y+4>>2]=O,y=B+1|0,Sn(M,O)|0){y=9;break e}if(l=l+1|0,(l|0)>=(v|0))break;B=y}h=h+1|0}while(h>>>0<6);y=P,O=C,B=p[y>>2]|0,M=m,y=p[y+4>>2]|0}else O=C,B=C,M=m,y=m}else O=w,p[O>>2]=y,p[O+4>>2]=m,O=y,B=y,M=m,y=m;y=(O|0)==(B|0)&(M|0)==(y|0)?0:9}while(!1);return R=y,Ie=L,R|0}function Re(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;if(l=Ie,Ie=Ie+48|0,B=l+16|0,M=l+8|0,O=l,v|0)return O=15,Ie=l,O|0;if(h=y,d=p[h+4>>2]|0,v=M,p[v>>2]=p[h>>2],p[v+4>>2]=d,fs(M,B),m=Uo(B,m,O)|0,!m){if(v=p[M>>2]|0,M=p[y+8>>2]|0,(M|0)>0){B=p[y+12>>2]|0,m=0;do v=(p[B+(m<<3)>>2]|0)+v|0,m=m+1|0;while((m|0)<(M|0))}m=O,B=p[m>>2]|0,m=p[m+4>>2]|0,M=((v|0)<0)<<31>>31,(m|0)<(M|0)|(m|0)==(M|0)&B>>>0<v>>>0?(m=O,p[m>>2]=v,p[m+4>>2]=M,m=M):v=B,d=cn(v|0,m|0,12,0)|0,h=Me()|0,m=O,p[m>>2]=d,p[m+4>>2]=h,m=w,p[m>>2]=d,p[m+4>>2]=h,m=0}return h=m,Ie=l,h|0}function $e(y,m,v,w,B,M,O){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0,O=O|0;var l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0,He=0,We=0,it=0,Xe=0,et=0,ht=0,Rt=0,xt=0,kt=0,rr=0,vr=0;if(Rt=Ie,Ie=Ie+64|0,it=Rt+48|0,Xe=Rt+32|0,et=Rt+24|0,Ee=Rt+8|0,Oe=Rt,d=p[y>>2]|0,(d|0)<=0)return ht=0,Ie=Rt,ht|0;for(me=y+4|0,Fe=it+8|0,He=Xe+8|0,We=Ee+8|0,l=0,re=0;;){h=p[me>>2]|0,Q=h+(re<<4)|0,p[it>>2]=p[Q>>2],p[it+4>>2]=p[Q+4>>2],p[it+8>>2]=p[Q+8>>2],p[it+12>>2]=p[Q+12>>2],(re|0)==(d+-1|0)?(p[Xe>>2]=p[h>>2],p[Xe+4>>2]=p[h+4>>2],p[Xe+8>>2]=p[h+8>>2],p[Xe+12>>2]=p[h+12>>2]):(Q=h+(re+1<<4)|0,p[Xe>>2]=p[Q>>2],p[Xe+4>>2]=p[Q+4>>2],p[Xe+8>>2]=p[Q+8>>2],p[Xe+12>>2]=p[Q+12>>2]),d=fa(it,Xe,w,et)|0;e:do if(d)h=0,l=d;else if(h=et,d=p[h>>2]|0,h=p[h+4>>2]|0,(h|0)>0|(h|0)==0&d>>>0>0){te=0,Q=0;t:for(;;){if(vr=+le[it>>3],X=Hr(d|0,h|0,te|0,Q|0)|0,rr=+(X>>>0)+4294967296*+(Me()|0),xt=+(d>>>0)+4294967296*+(h|0),kt=+(te>>>0)+4294967296*+(Q|0),le[Ee>>3]=vr*rr/xt+ +le[Xe>>3]*kt/xt,le[We>>3]=+le[Fe>>3]*rr/xt+ +le[He>>3]*kt/xt,d=Ga(Ee,w,Oe)|0,d|0){l=d;break}X=Oe,U=p[X>>2]|0,X=p[X+4>>2]|0,P=mo(U|0,X|0,m|0,v|0)|0,g=Me()|0,d=O+(P<<3)|0,C=d,h=p[C>>2]|0,C=p[C+4>>2]|0;r:do if((h|0)==0&(C|0)==0)oe=d,ht=16;else for(R=0,L=0;;){if((R|0)>(v|0)|(R|0)==(v|0)&L>>>0>m>>>0){l=1;break t}if((h|0)==(U|0)&(C|0)==(X|0))break r;if(d=cn(P|0,g|0,1,0)|0,P=Qi(d|0,Me()|0,m|0,v|0)|0,g=Me()|0,L=cn(L|0,R|0,1,0)|0,R=Me()|0,d=O+(P<<3)|0,C=d,h=p[C>>2]|0,C=p[C+4>>2]|0,(h|0)==0&(C|0)==0){oe=d,ht=16;break}}while(!1);if((ht|0)==16&&(ht=0,!((U|0)==0&(X|0)==0))&&(L=oe,p[L>>2]=U,p[L+4>>2]=X,L=M+(p[B>>2]<<3)|0,p[L>>2]=U,p[L+4>>2]=X,L=B,L=cn(p[L>>2]|0,p[L+4>>2]|0,1,0)|0,U=Me()|0,X=B,p[X>>2]=L,p[X+4>>2]=U),te=cn(te|0,Q|0,1,0)|0,Q=Me()|0,h=et,d=p[h>>2]|0,h=p[h+4>>2]|0,!((h|0)>(Q|0)|(h|0)==(Q|0)&d>>>0>te>>>0)){h=1;break e}}h=0}else h=1;while(!1);if(re=re+1|0,!h){ht=21;break}if(d=p[y>>2]|0,(re|0)>=(d|0)){l=0,ht=21;break}}return(ht|0)==21?(Ie=Rt,l|0):0}function At(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0,He=0,We=0,it=0,Xe=0,et=0,ht=0,Rt=0,xt=0,kt=0,rr=0;if(rr=Ie,Ie=Ie+112|0,ht=rr+80|0,d=rr+72|0,Rt=rr,xt=rr+56|0,v|0)return kt=15,Ie=rr,kt|0;if(h=y+8|0,kt=Vn((p[h>>2]<<5)+32|0)|0,!kt)return kt=13,Ie=rr,kt|0;if(hf(y,kt),Xe=y,et=p[Xe+4>>2]|0,v=d,p[v>>2]=p[Xe>>2],p[v+4>>2]=et,fs(d,ht),v=Uo(ht,m,Rt)|0,v)Xe=0,et=0;else{if(v=p[d>>2]|0,M=p[h>>2]|0,(M|0)>0){O=p[y+12>>2]|0,B=0;do v=(p[O+(B<<3)>>2]|0)+v|0,B=B+1|0;while((B|0)!=(M|0));B=v}else B=v;v=Rt,M=p[v>>2]|0,v=p[v+4>>2]|0,O=((B|0)<0)<<31>>31,(v|0)<(O|0)|(v|0)==(O|0)&M>>>0<B>>>0?(v=Rt,p[v>>2]=B,p[v+4>>2]=O,v=O):B=M,Xe=cn(B|0,v|0,12,0)|0,et=Me()|0,v=Rt,p[v>>2]=Xe,p[v+4>>2]=et,v=0}if(v|0)return Or(kt),kt=v,Ie=rr,kt|0;if(B=eo(Xe,8)|0,!B)return Or(kt),kt=13,Ie=rr,kt|0;if(l=eo(Xe,8)|0,!l)return Or(kt),Or(B),kt=13,Ie=rr,kt|0;We=ht,p[We>>2]=0,p[We+4>>2]=0,We=y,it=p[We+4>>2]|0,v=d,p[v>>2]=p[We>>2],p[v+4>>2]=it,v=$e(d,Xe,et,m,ht,B,l)|0;e:do if(v)Or(B),Or(l),Or(kt);else{t:do if((p[h>>2]|0)>0){for(O=y+12|0,M=0;v=$e((p[O>>2]|0)+(M<<3)|0,Xe,et,m,ht,B,l)|0,M=M+1|0,!(v|0);)if((M|0)>=(p[h>>2]|0))break t;Or(B),Or(l),Or(kt);break e}while(!1);(et|0)>0|(et|0)==0&Xe>>>0>0&&Yo(l|0,0,Xe<<3|0)|0,it=ht,We=p[it+4>>2]|0;t:do if((We|0)>0|(We|0)==0&(p[it>>2]|0)>>>0>0){me=B,Fe=l,He=B,We=l,it=B,v=B,oe=B,Ee=l,Oe=l,B=l;r:for(;;){for(X=0,te=0,Q=0,re=0,M=0,O=0;;){l=Rt,d=l+56|0;do p[l>>2]=0,l=l+4|0;while((l|0)<(d|0));if(m=me+(X<<3)|0,h=p[m>>2]|0,m=p[m+4>>2]|0,zi(h,m,1,Rt,0)|0){l=Rt,d=l+56|0;do p[l>>2]=0,l=l+4|0;while((l|0)<(d|0));l=eo(7,4)|0,l|0&&(Ps(h,m,1,Rt,l,7,0,0)|0,Or(l))}for(U=0;;){L=Rt+(U<<3)|0,R=p[L>>2]|0,L=p[L+4>>2]|0;n:do if((R|0)==0&(L|0)==0)l=M,d=O;else{if(g=mo(R|0,L|0,Xe|0,et|0)|0,h=Me()|0,l=w+(g<<3)|0,m=l,d=p[m>>2]|0,m=p[m+4>>2]|0,!((d|0)==0&(m|0)==0)){C=0,P=0;do{if((C|0)>(et|0)|(C|0)==(et|0)&P>>>0>Xe>>>0)break r;if((d|0)==(R|0)&(m|0)==(L|0)){l=M,d=O;break n}l=cn(g|0,h|0,1,0)|0,g=Qi(l|0,Me()|0,Xe|0,et|0)|0,h=Me()|0,P=cn(P|0,C|0,1,0)|0,C=Me()|0,l=w+(g<<3)|0,m=l,d=p[m>>2]|0,m=p[m+4>>2]|0}while(!((d|0)==0&(m|0)==0))}(R|0)==0&(L|0)==0?(l=M,d=O):(Cc(R,L,xt)|0,Kt(y,kt,xt)|0&&(P=cn(M|0,O|0,1,0)|0,O=Me()|0,C=l,p[C>>2]=R,p[C+4>>2]=L,M=Fe+(M<<3)|0,p[M>>2]=R,p[M+4>>2]=L,M=P),l=M,d=O)}while(!1);if(U=U+1|0,U>>>0>=7)break;M=l,O=d}if(X=cn(X|0,te|0,1,0)|0,te=Me()|0,Q=cn(Q|0,re|0,1,0)|0,re=Me()|0,O=ht,M=p[O>>2]|0,O=p[O+4>>2]|0,(re|0)<(O|0)|(re|0)==(O|0)&Q>>>0<M>>>0)M=l,O=d;else break}if((O|0)>0|(O|0)==0&M>>>0>0){M=0,O=0;do re=me+(M<<3)|0,p[re>>2]=0,p[re+4>>2]=0,M=cn(M|0,O|0,1,0)|0,O=Me()|0,re=ht,Q=p[re+4>>2]|0;while((O|0)<(Q|0)|((O|0)==(Q|0)?M>>>0<(p[re>>2]|0)>>>0:0))}if(re=ht,p[re>>2]=l,p[re+4>>2]=d,(d|0)>0|(d|0)==0&l>>>0>0)U=B,X=Oe,te=it,Q=Ee,re=Fe,B=oe,Oe=v,Ee=He,oe=U,v=X,it=We,We=te,He=Q,Fe=me,me=re;else break t}Or(He),Or(We),Or(kt),v=1;break e}else v=l;while(!1);Or(kt),Or(B),Or(v),v=0}while(!1);return kt=v,Ie=rr,kt|0}function Ht(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(g=Ie,Ie=Ie+176|0,d=g,(m|0)<1)return ya(v,0,0),h=0,Ie=g,h|0;for(l=y,l=jt(p[l>>2]|0,p[l+4>>2]|0,52)|0,Me()|0,ya(v,(m|0)>6?m:6,l&15),l=0;w=y+(l<<3)|0,w=Ec(p[w>>2]|0,p[w+4>>2]|0,d)|0,!(w|0);){if(w=p[d>>2]|0,(w|0)>0){O=0;do M=d+8+(O<<4)|0,O=O+1|0,w=d+8+(((O|0)%(w|0)|0)<<4)|0,B=_r(v,w,M)|0,B?Zi(v,B)|0:bl(v,M,w)|0,w=p[d>>2]|0;while((O|0)<(w|0))}if(l=l+1|0,(l|0)>=(m|0)){w=0,h=13;break}}return(h|0)==13?(Ie=g,w|0):(Xo(v),h=w,Ie=g,h|0)}function gr(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0;if(M=Ie,Ie=Ie+32|0,w=M,B=M+16|0,y=Ht(y,m,B)|0,y|0)return v=y,Ie=M,v|0;if(p[v>>2]=0,p[v+4>>2]=0,p[v+8>>2]=0,y=Qs(B)|0,y|0)do{m=WA(v)|0;do JA(m,y)|0,O=y+16|0,p[w>>2]=p[O>>2],p[w+4>>2]=p[O+4>>2],p[w+8>>2]=p[O+8>>2],p[w+12>>2]=p[O+12>>2],Zi(B,y)|0,y=or(B,w)|0;while((y|0)!=0);y=Qs(B)|0}while((y|0)!=0);return Xo(B),y=vl(v)|0,y?(Ic(v),O=y,Ie=M,O|0):(O=0,Ie=M,O|0)}function wr(y){return y=y|0,y>>>0>121?(y=0,y|0):(y=p[7696+(y*28|0)+16>>2]|0,y|0)}function ni(y){return y=y|0,(y|0)==4|(y|0)==117|0}function Ii(y){return y=y|0,p[11120+((p[y>>2]|0)*216|0)+((p[y+4>>2]|0)*72|0)+((p[y+8>>2]|0)*24|0)+(p[y+12>>2]<<3)>>2]|0}function Gi(y){return y=y|0,p[11120+((p[y>>2]|0)*216|0)+((p[y+4>>2]|0)*72|0)+((p[y+8>>2]|0)*24|0)+(p[y+12>>2]<<3)+4>>2]|0}function Js(y,m){y=y|0,m=m|0,y=7696+(y*28|0)|0,p[m>>2]=p[y>>2],p[m+4>>2]=p[y+4>>2],p[m+8>>2]=p[y+8>>2],p[m+12>>2]=p[y+12>>2]}function yh(y,m){y=y|0,m=m|0;var v=0,w=0;if(m>>>0>20)return m=-1,m|0;do if((p[11120+(m*216|0)>>2]|0)!=(y|0))if((p[11120+(m*216|0)+8>>2]|0)!=(y|0))if((p[11120+(m*216|0)+16>>2]|0)!=(y|0))if((p[11120+(m*216|0)+24>>2]|0)!=(y|0))if((p[11120+(m*216|0)+32>>2]|0)!=(y|0))if((p[11120+(m*216|0)+40>>2]|0)!=(y|0))if((p[11120+(m*216|0)+48>>2]|0)!=(y|0))if((p[11120+(m*216|0)+56>>2]|0)!=(y|0))if((p[11120+(m*216|0)+64>>2]|0)!=(y|0))if((p[11120+(m*216|0)+72>>2]|0)!=(y|0))if((p[11120+(m*216|0)+80>>2]|0)!=(y|0))if((p[11120+(m*216|0)+88>>2]|0)!=(y|0))if((p[11120+(m*216|0)+96>>2]|0)!=(y|0))if((p[11120+(m*216|0)+104>>2]|0)!=(y|0))if((p[11120+(m*216|0)+112>>2]|0)!=(y|0))if((p[11120+(m*216|0)+120>>2]|0)!=(y|0))if((p[11120+(m*216|0)+128>>2]|0)!=(y|0))if((p[11120+(m*216|0)+136>>2]|0)==(y|0))y=2,v=1,w=2;else{if((p[11120+(m*216|0)+144>>2]|0)==(y|0)){y=0,v=2,w=0;break}if((p[11120+(m*216|0)+152>>2]|0)==(y|0)){y=0,v=2,w=1;break}if((p[11120+(m*216|0)+160>>2]|0)==(y|0)){y=0,v=2,w=2;break}if((p[11120+(m*216|0)+168>>2]|0)==(y|0)){y=1,v=2,w=0;break}if((p[11120+(m*216|0)+176>>2]|0)==(y|0)){y=1,v=2,w=1;break}if((p[11120+(m*216|0)+184>>2]|0)==(y|0)){y=1,v=2,w=2;break}if((p[11120+(m*216|0)+192>>2]|0)==(y|0)){y=2,v=2,w=0;break}if((p[11120+(m*216|0)+200>>2]|0)==(y|0)){y=2,v=2,w=1;break}if((p[11120+(m*216|0)+208>>2]|0)==(y|0)){y=2,v=2,w=2;break}else y=-1;return y|0}else y=2,v=1,w=1;else y=2,v=1,w=0;else y=1,v=1,w=2;else y=1,v=1,w=1;else y=1,v=1,w=0;else y=0,v=1,w=2;else y=0,v=1,w=1;else y=0,v=1,w=0;else y=2,v=0,w=2;else y=2,v=0,w=1;else y=2,v=0,w=0;else y=1,v=0,w=2;else y=1,v=0,w=1;else y=1,v=0,w=0;else y=0,v=0,w=2;else y=0,v=0,w=1;else y=0,v=0,w=0;while(!1);return m=p[11120+(m*216|0)+(v*72|0)+(y*24|0)+(w<<3)+4>>2]|0,m|0}function nf(y,m){return y=y|0,m=m|0,(p[7696+(y*28|0)+20>>2]|0)==(m|0)?(m=1,m|0):(m=(p[7696+(y*28|0)+24>>2]|0)==(m|0),m|0)}function ua(y,m){return y=y|0,m=m|0,p[848+(y*28|0)+(m<<2)>>2]|0}function ll(y,m){return y=y|0,m=m|0,(p[848+(y*28|0)>>2]|0)==(m|0)?(m=0,m|0):(p[848+(y*28|0)+4>>2]|0)==(m|0)?(m=1,m|0):(p[848+(y*28|0)+8>>2]|0)==(m|0)?(m=2,m|0):(p[848+(y*28|0)+12>>2]|0)==(m|0)?(m=3,m|0):(p[848+(y*28|0)+16>>2]|0)==(m|0)?(m=4,m|0):(p[848+(y*28|0)+20>>2]|0)==(m|0)?(m=5,m|0):((p[848+(y*28|0)+24>>2]|0)==(m|0)?6:7)|0}function ul(){return 122}function vh(y){y=y|0;var m=0,v=0,w=0;m=0;do Zt(m|0,0,45)|0,w=Me()|0|134225919,v=y+(m<<3)|0,p[v>>2]=-1,p[v+4>>2]=w,m=m+1|0;while((m|0)!=122);return 0}function fl(y){return y=y|0,+le[y+16>>3]<+le[y+24>>3]|0}function Rs(y,m){y=y|0,m=m|0;var v=0,w=0,B=0;return v=+le[m>>3],!(v>=+le[y+8>>3])||!(v<=+le[y>>3])?(m=0,m|0):(w=+le[y+16>>3],v=+le[y+24>>3],B=+le[m+8>>3],m=B>=v,y=B<=w&1,w<v?m&&(y=1):m||(y=0),m=(y|0)!=0,m|0)}function Uo(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0;L=Ie,Ie=Ie+288|0,g=L+264|0,C=L+96|0,h=L,l=h,d=l+96|0;do p[l>>2]=0,l=l+4|0;while((l|0)<(d|0));return m=pl(m,h)|0,m|0?(R=m,Ie=L,R|0):(d=h,h=p[d>>2]|0,d=p[d+4>>2]|0,Cc(h,d,g)|0,Ec(h,d,C)|0,O=+$a(g,C+8|0),le[g>>3]=+le[y>>3],d=g+8|0,le[d>>3]=+le[y+16>>3],le[C>>3]=+le[y+8>>3],h=C+8|0,le[h>>3]=+le[y+24>>3],B=+$a(g,C),X=+le[d>>3]-+le[h>>3],M=+It(+X),U=+le[g>>3]-+le[C>>3],w=+It(+U),!(X==0|U==0)&&(X=+Rc(+M,+w),X=+zr(+(B*B/+xl(+(X/+xl(+M,+w)),3)/(O*(O*2.59807621135)*.8))),le[vt>>3]=X,P=~~X>>>0,R=+It(X)>=1?X>0?~~+Lr(+Ct(X/4294967296),4294967295)>>>0:~~+zr((X-+(~~X>>>0))/4294967296)>>>0:0,(p[vt+4>>2]&2146435072|0)!=2146435072)?(C=(P|0)==0&(R|0)==0,m=v,p[m>>2]=C?1:P,p[m+4>>2]=C?0:R,m=0):m=1,R=m,Ie=L,R|0)}function fa(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0;h=Ie,Ie=Ie+288|0,O=h+264|0,l=h+96|0,d=h,B=d,M=B+96|0;do p[B>>2]=0,B=B+4|0;while((B|0)<(M|0));return v=pl(v,d)|0,v|0?(w=v,Ie=h,w|0):(v=d,B=p[v>>2]|0,v=p[v+4>>2]|0,Cc(B,v,O)|0,Ec(B,v,l)|0,g=+$a(O,l+8|0),g=+zr(+(+$a(y,m)/(g*2))),le[vt>>3]=g,v=~~g>>>0,B=+It(g)>=1?g>0?~~+Lr(+Ct(g/4294967296),4294967295)>>>0:~~+zr((g-+(~~g>>>0))/4294967296)>>>0:0,(p[vt+4>>2]&2146435072|0)==2146435072?(w=1,Ie=h,w|0):(d=(v|0)==0&(B|0)==0,p[w>>2]=d?1:v,p[w+4>>2]=d?0:B,w=0,Ie=h,w|0))}function Oa(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0,p[y>>2]=m,p[y+4>>2]=v,p[y+8>>2]=w}function ha(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0;C=m+8|0,p[C>>2]=0,d=+le[y>>3],O=+It(+d),h=+le[y+8>>3],l=+It(+h)/.8660254037844386,O=O+l*.5,v=~~O,y=~~l,O=O-+(v|0),l=l-+(y|0);do if(O<.5)if(O<.3333333333333333)if(p[m>>2]=v,l<(O+1)*.5){p[m+4>>2]=y;break}else{y=y+1|0,p[m+4>>2]=y;break}else if(P=1-O,y=(!(l<P)&1)+y|0,p[m+4>>2]=y,P<=l&l<O*2){v=v+1|0,p[m>>2]=v;break}else{p[m>>2]=v;break}else{if(!(O<.6666666666666666))if(v=v+1|0,p[m>>2]=v,l<O*.5){p[m+4>>2]=y;break}else{y=y+1|0,p[m+4>>2]=y;break}if(l<1-O){if(p[m+4>>2]=y,O*2+-1<l){p[m>>2]=v;break}}else y=y+1|0,p[m+4>>2]=y;v=v+1|0,p[m>>2]=v}while(!1);do if(d<0)if(y&1){g=(y+1|0)/2|0,g=Hr(v|0,((v|0)<0)<<31>>31|0,g|0,((g|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-((+(g>>>0)+4294967296*+(Me()|0))*2+1)),p[m>>2]=v;break}else{g=(y|0)/2|0,g=Hr(v|0,((v|0)<0)<<31>>31|0,g|0,((g|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-(+(g>>>0)+4294967296*+(Me()|0))*2),p[m>>2]=v;break}while(!1);g=m+4|0,h<0&&(v=v-((y<<1|1|0)/2|0)|0,p[m>>2]=v,y=0-y|0,p[g>>2]=y),w=y-v|0,(v|0)<0?(B=0-v|0,p[g>>2]=w,p[C>>2]=B,p[m>>2]=0,y=w,v=0):B=0,(y|0)<0&&(v=v-y|0,p[m>>2]=v,B=B-y|0,p[C>>2]=B,p[g>>2]=0,y=0),M=v-B|0,w=y-B|0,(B|0)<0&&(p[m>>2]=M,p[g>>2]=w,p[C>>2]=0,y=w,v=M,B=0),w=(y|0)<(v|0)?y:v,w=(B|0)<(w|0)?B:w,!((w|0)<=0)&&(p[m>>2]=v-w,p[g>>2]=y-w,p[C>>2]=B-w)}function hi(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0;m=p[y>>2]|0,O=y+4|0,v=p[O>>2]|0,(m|0)<0&&(v=v-m|0,p[O>>2]=v,M=y+8|0,p[M>>2]=(p[M>>2]|0)-m,p[y>>2]=0,m=0),(v|0)<0?(m=m-v|0,p[y>>2]=m,M=y+8|0,B=(p[M>>2]|0)-v|0,p[M>>2]=B,p[O>>2]=0,v=0):(B=y+8|0,M=B,B=p[B>>2]|0),(B|0)<0&&(m=m-B|0,p[y>>2]=m,v=v-B|0,p[O>>2]=v,p[M>>2]=0,B=0),w=(v|0)<(m|0)?v:m,w=(B|0)<(w|0)?B:w,!((w|0)<=0)&&(p[y>>2]=m-w,p[O>>2]=v-w,p[M>>2]=B-w)}function wo(y,m){y=y|0,m=m|0;var v=0,w=0;w=p[y+8>>2]|0,v=+((p[y+4>>2]|0)-w|0),le[m>>3]=+((p[y>>2]|0)-w|0)-v*.5,le[m+8>>3]=v*.8660254037844386}function Ln(y,m,v){y=y|0,m=m|0,v=v|0,p[v>>2]=(p[m>>2]|0)+(p[y>>2]|0),p[v+4>>2]=(p[m+4>>2]|0)+(p[y+4>>2]|0),p[v+8>>2]=(p[m+8>>2]|0)+(p[y+8>>2]|0)}function ii(y,m,v){y=y|0,m=m|0,v=v|0,p[v>>2]=(p[y>>2]|0)-(p[m>>2]|0),p[v+4>>2]=(p[y+4>>2]|0)-(p[m+4>>2]|0),p[v+8>>2]=(p[y+8>>2]|0)-(p[m+8>>2]|0)}function Da(y,m){y=y|0,m=m|0;var v=0,w=0;v=Gr(p[y>>2]|0,m)|0,p[y>>2]=v,v=y+4|0,w=Gr(p[v>>2]|0,m)|0,p[v>>2]=w,y=y+8|0,m=Gr(p[y>>2]|0,m)|0,p[y>>2]=m}function hl(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;O=p[y>>2]|0,l=(O|0)<0,w=(p[y+4>>2]|0)-(l?O:0)|0,M=(w|0)<0,B=(M?0-w|0:0)+((p[y+8>>2]|0)-(l?O:0))|0,v=(B|0)<0,y=v?0:B,m=(M?0:w)-(v?B:0)|0,B=(l?0:O)-(M?w:0)-(v?B:0)|0,v=(m|0)<(B|0)?m:B,v=(y|0)<(v|0)?y:v,w=(v|0)>0,y=y-(w?v:0)|0,m=m-(w?v:0)|0;e:do switch(B-(w?v:0)|0){case 0:switch(m|0){case 0:return l=(y|0)==0?0:(y|0)==1?1:7,l|0;case 1:return l=(y|0)==0?2:(y|0)==1?3:7,l|0;default:break e}case 1:switch(m|0){case 0:return l=(y|0)==0?4:(y|0)==1?5:7,l|0;case 1:{if(!y)y=6;else break e;return y|0}default:break e}}while(!1);return l=7,l|0}function GA(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,B=p[O>>2]|0,M=(p[y>>2]|0)-B|0,l=y+4|0,B=(p[l>>2]|0)-B|0;do if(M>>>0>715827881|B>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return l=1,l|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return l=1,l|0;if(m=M*3|0,(B|0)>0){if((2147483647-B|0)<(B|0))return l=1,l|0}else if((-2147483648-B|0)>(B|0))return l=1,l|0;if(w=B<<1,(M|0)>-1){if((m|-2147483648|0)>=(B|0))return l=1,l|0}else if((m^-2147483648|0)<(B|0))return l=1,l|0;if(v){if((2147483647-M|0)<(w|0))m=1;else{v=w;break}return m|0}else{if((-2147483648-M|0)>(w|0))m=1;else{v=w;break}return m|0}}else v=B<<1,m=M*3|0;while(!1);w=Hi(+(m-B|0)/7)|0,p[y>>2]=w,B=Hi(+(v+M|0)/7)|0,p[l>>2]=B,p[O>>2]=0,v=(B|0)<(w|0),m=v?w:B,v=v?B:w;do if((v|0)<0){if((m|0)>0){if((m|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-m|0)>=(v|0)))break;Wt(23313,22444,355,22455)}if((v|0)==-2147483648|(-2147483648-m|0)>(v|0)&&Wt(23313,22444,355,22455),(m|0)>-1){if((m|-2147483648|0)<(v|0))break;Wt(23313,22444,355,22455)}else{if((m^-2147483648|0)>=(v|0))break;Wt(23313,22444,355,22455)}}while(!1);return m=B-w|0,(w|0)<0?(v=0-w|0,p[l>>2]=m,p[O>>2]=v,p[y>>2]=0,w=0):(m=B,v=0),(m|0)<0&&(w=w-m|0,p[y>>2]=w,v=v-m|0,p[O>>2]=v,p[l>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(l=0,l|0):(p[y>>2]=B-w,p[l>>2]=m-w,p[O>>2]=v-w,l=0,l|0)}function VA(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,B=p[O>>2]|0,M=(p[y>>2]|0)-B|0,l=y+4|0,B=(p[l>>2]|0)-B|0;do if(M>>>0>715827881|B>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0))return l=1,l|0}else if((-2147483648-M|0)>(M|0))return l=1,l|0;if(m=M<<1,(B|0)>0){if((2147483647-B|0)<(B|0)||(2147483647-(B<<1)|0)<(B|0))return l=1,l|0}else if((-2147483648-B|0)>(B|0)||(-2147483648-(B<<1)|0)>(B|0))return l=1,l|0;if(w=B*3|0,v){if((2147483647-m|0)<(B|0))return l=1,l|0}else if((-2147483648-m|0)>(B|0))return l=1,l|0;if((B|0)>-1){if((w|-2147483648|0)<(M|0)){v=w;break}else m=1;return m|0}else{if((w^-2147483648|0)<(M|0))m=1;else{v=w;break}return m|0}}else v=B*3|0,m=M<<1;while(!1);w=Hi(+(m+B|0)/7)|0,p[y>>2]=w,B=Hi(+(v-M|0)/7)|0,p[l>>2]=B,p[O>>2]=0,v=(B|0)<(w|0),m=v?w:B,v=v?B:w;do if((v|0)<0){if((m|0)>0){if((m|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-m|0)>=(v|0)))break;Wt(23313,22444,404,22469)}if((v|0)==-2147483648|(-2147483648-m|0)>(v|0)&&Wt(23313,22444,404,22469),(m|0)>-1){if((m|-2147483648|0)<(v|0))break;Wt(23313,22444,404,22469)}else{if((m^-2147483648|0)>=(v|0))break;Wt(23313,22444,404,22469)}}while(!1);return m=B-w|0,(w|0)<0?(v=0-w|0,p[l>>2]=m,p[O>>2]=v,p[y>>2]=0,w=0):(m=B,v=0),(m|0)<0&&(w=w-m|0,p[y>>2]=w,v=v-m|0,p[O>>2]=v,p[l>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(l=0,l|0):(p[y>>2]=B-w,p[l>>2]=m-w,p[O>>2]=v-w,l=0,l|0)}function sf(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,v=p[O>>2]|0,m=(p[y>>2]|0)-v|0,l=y+4|0,v=(p[l>>2]|0)-v|0,w=Hi(+((m*3|0)-v|0)/7)|0,p[y>>2]=w,m=Hi(+((v<<1)+m|0)/7)|0,p[l>>2]=m,p[O>>2]=0,v=m-w|0,(w|0)<0?(M=0-w|0,p[l>>2]=v,p[O>>2]=M,p[y>>2]=0,m=v,w=0,v=M):v=0,(m|0)<0&&(w=w-m|0,p[y>>2]=w,v=v-m|0,p[O>>2]=v,p[l>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(p[y>>2]=B-w,p[l>>2]=m-w,p[O>>2]=v-w)}function Kl(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;O=y+8|0,v=p[O>>2]|0,m=(p[y>>2]|0)-v|0,l=y+4|0,v=(p[l>>2]|0)-v|0,w=Hi(+((m<<1)+v|0)/7)|0,p[y>>2]=w,m=Hi(+((v*3|0)-m|0)/7)|0,p[l>>2]=m,p[O>>2]=0,v=m-w|0,(w|0)<0?(M=0-w|0,p[l>>2]=v,p[O>>2]=M,p[y>>2]=0,m=v,w=0,v=M):v=0,(m|0)<0&&(w=w-m|0,p[y>>2]=w,v=v-m|0,p[O>>2]=v,p[l>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(p[y>>2]=B-w,p[l>>2]=m-w,p[O>>2]=v-w)}function vc(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;m=p[y>>2]|0,O=y+4|0,v=p[O>>2]|0,l=y+8|0,w=p[l>>2]|0,B=v+(m*3|0)|0,p[y>>2]=B,v=w+(v*3|0)|0,p[O>>2]=v,m=(w*3|0)+m|0,p[l>>2]=m,w=v-B|0,(B|0)<0?(m=m-B|0,p[O>>2]=w,p[l>>2]=m,p[y>>2]=0,v=w,w=0):w=B,(v|0)<0&&(w=w-v|0,p[y>>2]=w,m=m-v|0,p[l>>2]=m,p[O>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=m-v)}function zo(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;B=p[y>>2]|0,O=y+4|0,m=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,w=(m*3|0)+B|0,B=v+(B*3|0)|0,p[y>>2]=B,p[O>>2]=w,m=(v*3|0)+m|0,p[l>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[O>>2]=v,p[l>>2]=m,p[y>>2]=0,B=0):v=w,(v|0)<0&&(B=B-v|0,p[y>>2]=B,m=m-v|0,p[l>>2]=m,p[O>>2]=0,v=0),M=B-m|0,w=v-m|0,(m|0)<0?(p[y>>2]=M,p[O>>2]=w,p[l>>2]=0,B=M,m=0):w=v,v=(w|0)<(B|0)?w:B,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=B-v,p[O>>2]=w-v,p[l>>2]=m-v)}function of(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0;(m+-1|0)>>>0>=6||(B=(p[15440+(m*12|0)>>2]|0)+(p[y>>2]|0)|0,p[y>>2]=B,l=y+4|0,w=(p[15440+(m*12|0)+4>>2]|0)+(p[l>>2]|0)|0,p[l>>2]=w,O=y+8|0,m=(p[15440+(m*12|0)+8>>2]|0)+(p[O>>2]|0)|0,p[O>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[l>>2]=v,p[O>>2]=m,p[y>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[y>>2]=w,m=m-v|0,p[O>>2]=m,p[l>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[y>>2]=M,p[l>>2]=B,p[O>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[l>>2]=B-v,p[O>>2]=m-v))}function af(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;B=p[y>>2]|0,O=y+4|0,m=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,w=m+B|0,B=v+B|0,p[y>>2]=B,p[O>>2]=w,m=v+m|0,p[l>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[O>>2]=v,p[l>>2]=m,p[y>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[y>>2]=w,m=m-v|0,p[l>>2]=m,p[O>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=m-v)}function Yl(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;m=p[y>>2]|0,O=y+4|0,w=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,B=w+m|0,p[y>>2]=B,w=v+w|0,p[O>>2]=w,m=v+m|0,p[l>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[O>>2]=v,p[l>>2]=m,p[y>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[y>>2]=w,m=m-v|0,p[l>>2]=m,p[O>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=m-v)}function Ao(y){switch(y=y|0,y|0){case 1:{y=5;break}case 5:{y=4;break}case 4:{y=6;break}case 6:{y=2;break}case 2:{y=3;break}case 3:{y=1;break}}return y|0}function Xs(y){switch(y=y|0,y|0){case 1:{y=3;break}case 3:{y=2;break}case 2:{y=6;break}case 6:{y=4;break}case 4:{y=5;break}case 5:{y=1;break}}return y|0}function cf(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;m=p[y>>2]|0,O=y+4|0,v=p[O>>2]|0,l=y+8|0,w=p[l>>2]|0,B=v+(m<<1)|0,p[y>>2]=B,v=w+(v<<1)|0,p[O>>2]=v,m=(w<<1)+m|0,p[l>>2]=m,w=v-B|0,(B|0)<0?(m=m-B|0,p[O>>2]=w,p[l>>2]=m,p[y>>2]=0,v=w,w=0):w=B,(v|0)<0&&(w=w-v|0,p[y>>2]=w,m=m-v|0,p[l>>2]=m,p[O>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[y>>2]=M,p[O>>2]=B,p[l>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=w-v,p[O>>2]=B-v,p[l>>2]=m-v)}function Fi(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;B=p[y>>2]|0,O=y+4|0,m=p[O>>2]|0,l=y+8|0,v=p[l>>2]|0,w=(m<<1)+B|0,B=v+(B<<1)|0,p[y>>2]=B,p[O>>2]=w,m=(v<<1)+m|0,p[l>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[O>>2]=v,p[l>>2]=m,p[y>>2]=0,B=0):v=w,(v|0)<0&&(B=B-v|0,p[y>>2]=B,m=m-v|0,p[l>>2]=m,p[O>>2]=0,v=0),M=B-m|0,w=v-m|0,(m|0)<0?(p[y>>2]=M,p[O>>2]=w,p[l>>2]=0,B=M,m=0):w=v,v=(w|0)<(B|0)?w:B,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[y>>2]=B-v,p[O>>2]=w-v,p[l>>2]=m-v)}function dl(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0;return O=(p[y>>2]|0)-(p[m>>2]|0)|0,l=(O|0)<0,w=(p[y+4>>2]|0)-(p[m+4>>2]|0)-(l?O:0)|0,M=(w|0)<0,B=(l?0-O|0:0)+(p[y+8>>2]|0)-(p[m+8>>2]|0)+(M?0-w|0:0)|0,y=(B|0)<0,m=y?0:B,v=(M?0:w)-(y?B:0)|0,B=(l?0:O)-(M?w:0)-(y?B:0)|0,y=(v|0)<(B|0)?v:B,y=(m|0)<(y|0)?m:y,w=(y|0)>0,m=m-(w?y:0)|0,v=v-(w?y:0)|0,y=B-(w?y:0)|0,y=(y|0)>-1?y:0-y|0,v=(v|0)>-1?v:0-v|0,m=(m|0)>-1?m:0-m|0,m=(v|0)>(m|0)?v:m,((y|0)>(m|0)?y:m)|0}function da(y,m){y=y|0,m=m|0;var v=0;v=p[y+8>>2]|0,p[m>>2]=(p[y>>2]|0)-v,p[m+4>>2]=(p[y+4>>2]|0)-v}function Aa(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0;w=p[y>>2]|0,p[m>>2]=w,B=p[y+4>>2]|0,O=m+4|0,p[O>>2]=B,l=m+8|0,p[l>>2]=0,v=(B|0)<(w|0),y=v?w:B,v=v?B:w;do if((v|0)<0){if((y|0)>0){if((y|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-y|0)>=(v|0)))break;return y=1,y|0}if((v|0)==-2147483648|(-2147483648-y|0)>(v|0))return m=1,m|0;if((y|0)>-1){if((y|-2147483648|0)<(v|0))break;return y=1,y|0}else{if((y^-2147483648|0)<(v|0))y=1;else break;return y|0}}while(!1);return y=B-w|0,(w|0)<0?(v=0-w|0,p[O>>2]=y,p[l>>2]=v,p[m>>2]=0,w=0):(y=B,v=0),(y|0)<0&&(w=w-y|0,p[m>>2]=w,v=v-y|0,p[l>>2]=v,p[O>>2]=0,y=0),M=w-v|0,B=y-v|0,(v|0)<0?(p[m>>2]=M,p[O>>2]=B,p[l>>2]=0,y=B,B=M,v=0):B=w,w=(y|0)<(B|0)?y:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(m=0,m|0):(p[m>>2]=B-w,p[O>>2]=y-w,p[l>>2]=v-w,m=0,m|0)}function pa(y){y=y|0;var m=0,v=0,w=0,B=0;m=y+8|0,B=p[m>>2]|0,v=B-(p[y>>2]|0)|0,p[y>>2]=v,w=y+4|0,y=(p[w>>2]|0)-B|0,p[w>>2]=y,p[m>>2]=0-(y+v)}function La(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;v=p[y>>2]|0,m=0-v|0,p[y>>2]=m,O=y+8|0,p[O>>2]=0,l=y+4|0,w=p[l>>2]|0,B=w+v|0,(v|0)>0?(p[l>>2]=B,p[O>>2]=v,p[y>>2]=0,m=0,w=B):v=0,(w|0)<0?(M=m-w|0,p[y>>2]=M,v=v-w|0,p[O>>2]=v,p[l>>2]=0,B=M-v|0,m=0-v|0,(v|0)<0?(p[y>>2]=B,p[l>>2]=m,p[O>>2]=0,w=m,v=0):(w=0,B=M)):B=m,m=(w|0)<(B|0)?w:B,m=(v|0)<(m|0)?v:m,!((m|0)<=0)&&(p[y>>2]=B-m,p[l>>2]=w-m,p[O>>2]=v-m)}function ga(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0;if(C=Ie,Ie=Ie+64|0,g=C,l=C+56|0,!(!0&(m&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return B=5,Ie=C,B|0;if((y|0)==(v|0)&(m|0)==(w|0))return p[B>>2]=0,B=0,Ie=C,B|0;if(O=jt(y|0,m|0,52)|0,Me()|0,O=O&15,h=jt(v|0,w|0,52)|0,Me()|0,(O|0)!=(h&15|0))return B=12,Ie=C,B|0;if(M=O+-1|0,O>>>0>1){jo(y,m,M,g)|0,jo(v,w,M,l)|0,h=g,d=p[h>>2]|0,h=p[h+4>>2]|0;e:do if((d|0)==(p[l>>2]|0)&&(h|0)==(p[l+4>>2]|0)){O=(O^15)*3|0,M=jt(y|0,m|0,O|0)|0,Me()|0,M=M&7,O=jt(v|0,w|0,O|0)|0,Me()|0,O=O&7;do if((M|0)==0|(O|0)==0)p[B>>2]=1,M=0;else if((M|0)==7)M=5;else{if((M|0)==1|(O|0)==1&&Sn(d,h)|0){M=5;break}if((p[15536+(M<<2)>>2]|0)!=(O|0)&&(p[15568+(M<<2)>>2]|0)!=(O|0))break e;p[B>>2]=1,M=0}while(!1);return B=M,Ie=C,B|0}while(!1)}M=g,O=M+56|0;do p[M>>2]=0,M=M+4|0;while((M|0)<(O|0));return Bn(y,m,1,g)|0,m=g,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0))&&(m=g+8|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+16|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+24|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+32|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+40|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))?(M=g+48|0,M=((p[M>>2]|0)==(v|0)?(p[M+4>>2]|0)==(w|0):0)&1):M=1,p[B>>2]=M,B=0,Ie=C,B|0}function ka(y,m,v,w,B){return y=y|0,m=m|0,v=v|0,w=w|0,B=B|0,v=cl(y,m,v,w)|0,(v|0)==7?(B=11,B|0):(w=Zt(v|0,0,56)|0,m=m&-2130706433|(Me()|0)|268435456,p[B>>2]=y|w,p[B+4>>2]=m,B=0,B|0)}function Na(y,m,v){return y=y|0,m=m|0,v=v|0,!0&(m&2013265920|0)==268435456?(p[v>>2]=y,p[v+4>>2]=m&-2130706433|134217728,v=0,v|0):(v=6,v|0)}function ma(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;return B=Ie,Ie=Ie+16|0,w=B,p[w>>2]=0,!0&(m&2013265920|0)==268435456?(M=jt(y|0,m|0,56)|0,Me()|0,w=wn(y,m&-2130706433|134217728,M&7,w,v)|0,Ie=B,w|0):(w=6,Ie=B,w|0)}function bh(y,m){y=y|0,m=m|0;var v=0;switch(v=jt(y|0,m|0,56)|0,Me()|0,v&7){case 0:case 7:return v=0,v|0}return v=m&-2130706433|134217728,!(!0&(m&2013265920|0)==268435456)||!0&(m&117440512|0)==16777216&(Sn(y,v)|0)!=0?(v=0,v|0):(v=Ho(y,v)|0,v|0)}function xh(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0;return B=Ie,Ie=Ie+16|0,w=B,!0&(m&2013265920|0)==268435456?(M=m&-2130706433|134217728,O=v,p[O>>2]=y,p[O+4>>2]=M,p[w>>2]=0,m=jt(y|0,m|0,56)|0,Me()|0,w=wn(y,M,m&7,w,v+8|0)|0,Ie=B,w|0):(w=6,Ie=B,w|0)}function Cn(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0;return B=(Sn(y,m)|0)==0,m=m&-2130706433,w=v,p[w>>2]=B?y:0,p[w+4>>2]=B?m|285212672:0,w=v+8|0,p[w>>2]=y,p[w+4>>2]=m|301989888,w=v+16|0,p[w>>2]=y,p[w+4>>2]=m|318767104,w=v+24|0,p[w>>2]=y,p[w+4>>2]=m|335544320,w=v+32|0,p[w>>2]=y,p[w+4>>2]=m|352321536,v=v+40|0,p[v>>2]=y,p[v+4>>2]=m|369098752,0}function ql(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0;return O=Ie,Ie=Ie+16|0,B=O,M=m&-2130706433|134217728,!0&(m&2013265920|0)==268435456?(w=jt(y|0,m|0,56)|0,Me()|0,w=go(y,M,w&7)|0,(w|0)==-1?(p[v>>2]=0,M=6,Ie=O,M|0):(Va(y,M,B)|0&&Wt(23313,22484,282,22499),m=jt(y|0,m|0,52)|0,Me()|0,m=m&15,Sn(y,M)|0?Go(B,m,w,2,v):Ql(B,m,w,2,v),M=0,Ie=O,M|0)):(M=6,Ie=O,M|0)}function Zl(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0;w=Ie,Ie=Ie+16|0,B=w,wh(y,m,v,B),ha(B,v+4|0),Ie=w}function wh(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0;if(l=Ie,Ie=Ie+16|0,d=l,Ch(y,v,d),M=+Fr(+(1-+le[d>>3]*.5)),M<1e-16){p[w>>2]=0,p[w+4>>2]=0,p[w+8>>2]=0,p[w+12>>2]=0,Ie=l;return}if(d=p[v>>2]|0,B=+le[15920+(d*24|0)>>3],B=+Bc(B-+Bc(+ff(15600+(d<<4)|0,y))),Fs(m)|0?O=+Bc(B+-.3334731722518321):O=B,B=+zt(+M)/.381966011250105,(m|0)>0){y=0;do B=B*2.6457513110645907,y=y+1|0;while((y|0)!=(m|0))}M=+Ot(+O)*B,le[w>>3]=M,O=+St(+O)*B,le[w+8>>3]=O,Ie=l}function Ch(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(M=Ie,Ie=Ie+32|0,B=M,gf(y,B),p[m>>2]=0,le[v>>3]=5,w=+_i(16400,B),w<+le[v>>3]&&(p[m>>2]=0,le[v>>3]=w),w=+_i(16424,B),w<+le[v>>3]&&(p[m>>2]=1,le[v>>3]=w),w=+_i(16448,B),w<+le[v>>3]&&(p[m>>2]=2,le[v>>3]=w),w=+_i(16472,B),w<+le[v>>3]&&(p[m>>2]=3,le[v>>3]=w),w=+_i(16496,B),w<+le[v>>3]&&(p[m>>2]=4,le[v>>3]=w),w=+_i(16520,B),w<+le[v>>3]&&(p[m>>2]=5,le[v>>3]=w),w=+_i(16544,B),w<+le[v>>3]&&(p[m>>2]=6,le[v>>3]=w),w=+_i(16568,B),w<+le[v>>3]&&(p[m>>2]=7,le[v>>3]=w),w=+_i(16592,B),w<+le[v>>3]&&(p[m>>2]=8,le[v>>3]=w),w=+_i(16616,B),w<+le[v>>3]&&(p[m>>2]=9,le[v>>3]=w),w=+_i(16640,B),w<+le[v>>3]&&(p[m>>2]=10,le[v>>3]=w),w=+_i(16664,B),w<+le[v>>3]&&(p[m>>2]=11,le[v>>3]=w),w=+_i(16688,B),w<+le[v>>3]&&(p[m>>2]=12,le[v>>3]=w),w=+_i(16712,B),w<+le[v>>3]&&(p[m>>2]=13,le[v>>3]=w),w=+_i(16736,B),w<+le[v>>3]&&(p[m>>2]=14,le[v>>3]=w),w=+_i(16760,B),w<+le[v>>3]&&(p[m>>2]=15,le[v>>3]=w),w=+_i(16784,B),w<+le[v>>3]&&(p[m>>2]=16,le[v>>3]=w),w=+_i(16808,B),w<+le[v>>3]&&(p[m>>2]=17,le[v>>3]=w),w=+_i(16832,B),w<+le[v>>3]&&(p[m>>2]=18,le[v>>3]=w),w=+_i(16856,B),!(w<+le[v>>3])){Ie=M;return}p[m>>2]=19,le[v>>3]=w,Ie=M}function bc(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0;if(M=+Jo(y),M<1e-16){m=15600+(m<<4)|0,p[B>>2]=p[m>>2],p[B+4>>2]=p[m+4>>2],p[B+8>>2]=p[m+8>>2],p[B+12>>2]=p[m+12>>2];return}if(O=+en(+ +le[y+8>>3],+ +le[y>>3]),(v|0)>0){y=0;do M=M/2.6457513110645907,y=y+1|0;while((y|0)!=(v|0))}w?(M=M/3,v=(Fs(v)|0)==0,M=+Xr(+((v?M:M/2.6457513110645907)*.381966011250105))):(M=+Xr(+(M*.381966011250105)),Fs(v)|0&&(O=+Bc(O+.3334731722518321))),ml(15600+(m<<4)|0,+Bc(+le[15920+(m*24|0)>>3]-O),M,B)}function Eh(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0;w=Ie,Ie=Ie+16|0,B=w,wo(y+4|0,B),bc(B,p[y>>2]|0,m,0,v),Ie=w}function Go(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0,He=0,We=0,it=0,Xe=0,et=0,ht=0,Rt=0,xt=0;if(ht=Ie,Ie=Ie+272|0,M=ht+256|0,Q=ht+240|0,it=ht,Xe=ht+224|0,et=ht+208|0,re=ht+176|0,oe=ht+160|0,Ee=ht+192|0,Oe=ht+144|0,me=ht+128|0,Fe=ht+112|0,He=ht+96|0,We=ht+80|0,p[M>>2]=m,p[Q>>2]=p[y>>2],p[Q+4>>2]=p[y+4>>2],p[Q+8>>2]=p[y+8>>2],p[Q+12>>2]=p[y+12>>2],Vo(Q,M,it),p[B>>2]=0,Q=w+v+((w|0)==5&1)|0,(Q|0)<=(v|0)){Ie=ht;return}d=p[M>>2]|0,h=Xe+4|0,g=re+4|0,C=v+5|0,P=16880+(d<<2)|0,R=16960+(d<<2)|0,L=me+8|0,U=Fe+8|0,X=He+8|0,te=et+4|0,l=v;e:for(;;){O=it+(((l|0)%5|0)<<4)|0,p[et>>2]=p[O>>2],p[et+4>>2]=p[O+4>>2],p[et+8>>2]=p[O+8>>2],p[et+12>>2]=p[O+12>>2];do;while((Ks(et,d,0,1)|0)==2);if((l|0)>(v|0)&(Fs(m)|0)!=0){if(p[re>>2]=p[et>>2],p[re+4>>2]=p[et+4>>2],p[re+8>>2]=p[et+8>>2],p[re+12>>2]=p[et+12>>2],wo(h,oe),w=p[re>>2]|0,M=p[17040+(w*80|0)+(p[Xe>>2]<<2)>>2]|0,p[re>>2]=p[18640+(w*80|0)+(M*20|0)>>2],O=p[18640+(w*80|0)+(M*20|0)+16>>2]|0,(O|0)>0){y=0;do af(g),y=y+1|0;while((y|0)<(O|0))}switch(O=18640+(w*80|0)+(M*20|0)+4|0,p[Ee>>2]=p[O>>2],p[Ee+4>>2]=p[O+4>>2],p[Ee+8>>2]=p[O+8>>2],Da(Ee,(p[P>>2]|0)*3|0),Ln(g,Ee,g),hi(g),wo(g,Oe),Rt=+(p[R>>2]|0),le[me>>3]=Rt*3,le[L>>3]=0,xt=Rt*-1.5,le[Fe>>3]=xt,le[U>>3]=Rt*2.598076211353316,le[He>>3]=xt,le[X>>3]=Rt*-2.598076211353316,p[17040+((p[re>>2]|0)*80|0)+(p[et>>2]<<2)>>2]|0){case 1:{y=Fe,w=me;break}case 3:{y=He,w=Fe;break}case 2:{y=me,w=He;break}default:{y=12;break e}}pf(oe,Oe,w,y,We),bc(We,p[re>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1}if((l|0)<(C|0)&&(wo(te,re),bc(re,p[et>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1),p[Xe>>2]=p[et>>2],p[Xe+4>>2]=p[et+4>>2],p[Xe+8>>2]=p[et+8>>2],p[Xe+12>>2]=p[et+12>>2],l=l+1|0,(l|0)>=(Q|0)){y=3;break}}if((y|0)==3){Ie=ht;return}else(y|0)==12&&Wt(22522,22569,571,22579)}function Vo(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0;d=Ie,Ie=Ie+128|0,w=d+64|0,B=d,M=w,O=20240,l=M+60|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));M=B,O=20304,l=M+60|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));l=(Fs(p[m>>2]|0)|0)==0,w=l?w:B,B=y+4|0,cf(B),Fi(B),Fs(p[m>>2]|0)|0&&(zo(B),p[m>>2]=(p[m>>2]|0)+1),p[v>>2]=p[y>>2],m=v+4|0,Ln(B,w,m),hi(m),p[v+16>>2]=p[y>>2],m=v+20|0,Ln(B,w+12|0,m),hi(m),p[v+32>>2]=p[y>>2],m=v+36|0,Ln(B,w+24|0,m),hi(m),p[v+48>>2]=p[y>>2],m=v+52|0,Ln(B,w+36|0,m),hi(m),p[v+64>>2]=p[y>>2],v=v+68|0,Ln(B,w+48|0,v),hi(v),Ie=d}function Ks(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0;if(L=Ie,Ie=Ie+32|0,P=L+12|0,l=L,R=y+4|0,C=p[16960+(m<<2)>>2]|0,g=(w|0)!=0,C=g?C*3|0:C,B=p[R>>2]|0,h=y+8|0,O=p[h>>2]|0,g){if(M=y+12|0,w=p[M>>2]|0,B=O+B+w|0,(B|0)==(C|0))return R=1,Ie=L,R|0;d=M}else d=y+12|0,w=p[d>>2]|0,B=O+B+w|0;if((B|0)<=(C|0))return R=0,Ie=L,R|0;do if((w|0)>0){if(w=p[y>>2]|0,(O|0)>0){M=18640+(w*80|0)+60|0,w=y;break}w=18640+(w*80|0)+40|0,v?(Oa(P,C,0,0),ii(R,P,l),Yl(l),Ln(l,P,R),M=w,w=y):(M=w,w=y)}else M=18640+((p[y>>2]|0)*80|0)+20|0,w=y;while(!1);if(p[w>>2]=p[M>>2],B=M+16|0,(p[B>>2]|0)>0){w=0;do af(R),w=w+1|0;while((w|0)<(p[B>>2]|0))}return y=M+4|0,p[P>>2]=p[y>>2],p[P+4>>2]=p[y+4>>2],p[P+8>>2]=p[y+8>>2],m=p[16880+(m<<2)>>2]|0,Da(P,g?m*3|0:m),Ln(R,P,R),hi(R),g?w=((p[h>>2]|0)+(p[R>>2]|0)+(p[d>>2]|0)|0)==(C|0)?1:2:w=2,R=w,Ie=L,R|0}function Th(y,m){y=y|0,m=m|0;var v=0;do v=Ks(y,m,0,1)|0;while((v|0)==2);return v|0}function Ql(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0,He=0,We=0,it=0;if(He=Ie,Ie=Ie+240|0,M=He+224|0,Ee=He+208|0,Oe=He,me=He+192|0,Fe=He+176|0,X=He+160|0,te=He+144|0,Q=He+128|0,re=He+112|0,oe=He+96|0,p[M>>2]=m,p[Ee>>2]=p[y>>2],p[Ee+4>>2]=p[y+4>>2],p[Ee+8>>2]=p[y+8>>2],p[Ee+12>>2]=p[y+12>>2],eu(Ee,M,Oe),p[B>>2]=0,U=w+v+((w|0)==6&1)|0,(U|0)<=(v|0)){Ie=He;return}d=p[M>>2]|0,h=v+6|0,g=16960+(d<<2)|0,C=te+8|0,P=Q+8|0,R=re+8|0,L=me+4|0,O=0,l=v,w=-1;e:for(;;){if(M=(l|0)%6|0,y=Oe+(M<<4)|0,p[me>>2]=p[y>>2],p[me+4>>2]=p[y+4>>2],p[me+8>>2]=p[y+8>>2],p[me+12>>2]=p[y+12>>2],y=O,O=Ks(me,d,0,1)|0,(l|0)>(v|0)&(Fs(m)|0)!=0&&(y|0)!=1&&(p[me>>2]|0)!=(w|0)){switch(wo(Oe+(((M+5|0)%6|0)<<4)+4|0,Fe),wo(Oe+(M<<4)+4|0,X),We=+(p[g>>2]|0),le[te>>3]=We*3,le[C>>3]=0,it=We*-1.5,le[Q>>3]=it,le[P>>3]=We*2.598076211353316,le[re>>3]=it,le[R>>3]=We*-2.598076211353316,M=p[Ee>>2]|0,p[17040+(M*80|0)+(((w|0)==(M|0)?p[me>>2]|0:w)<<2)>>2]|0){case 1:{y=Q,w=te;break}case 3:{y=re,w=Q;break}case 2:{y=te,w=re;break}default:{y=8;break e}}pf(Fe,X,w,y,oe),!(Pc(Fe,oe)|0)&&!(Pc(X,oe)|0)&&(bc(oe,p[Ee>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1)}if((l|0)<(h|0)&&(wo(L,Fe),bc(Fe,p[me>>2]|0,d,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1),l=l+1|0,(l|0)>=(U|0)){y=3;break}else w=p[me>>2]|0}if((y|0)==3){Ie=He;return}else(y|0)==8&&Wt(22606,22569,736,22651)}function eu(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0;d=Ie,Ie=Ie+160|0,w=d+80|0,B=d,M=w,O=20368,l=M+72|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));M=B,O=20448,l=M+72|0;do p[M>>2]=p[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));l=(Fs(p[m>>2]|0)|0)==0,w=l?w:B,B=y+4|0,cf(B),Fi(B),Fs(p[m>>2]|0)|0&&(zo(B),p[m>>2]=(p[m>>2]|0)+1),p[v>>2]=p[y>>2],m=v+4|0,Ln(B,w,m),hi(m),p[v+16>>2]=p[y>>2],m=v+20|0,Ln(B,w+12|0,m),hi(m),p[v+32>>2]=p[y>>2],m=v+36|0,Ln(B,w+24|0,m),hi(m),p[v+48>>2]=p[y>>2],m=v+52|0,Ln(B,w+36|0,m),hi(m),p[v+64>>2]=p[y>>2],m=v+68|0,Ln(B,w+48|0,m),hi(m),p[v+80>>2]=p[y>>2],v=v+84|0,Ln(B,w+60|0,v),hi(v),Ie=d}function Ua(y,m){return y=y|0,m=m|0,m=jt(y|0,m|0,52)|0,Me()|0,m&15|0}function lf(y,m){return y=y|0,m=m|0,m=jt(y|0,m|0,45)|0,Me()|0,m&127|0}function Ho(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0;if(!(!0&(m&-16777216|0)==134217728)||(O=jt(y|0,m|0,45)|0,Me()|0,O=O&127,O>>>0>121))return m=0,m|0;v=jt(y|0,m|0,52)|0,Me()|0,v=v&15;do if(v|0){for(B=1,w=0;;){if(M=jt(y|0,m|0,(15-B|0)*3|0)|0,Me()|0,M=M&7,(M|0)!=0&(w^1))if((M|0)==1&(wr(O)|0)!=0){l=0,w=13;break}else w=1;if((M|0)==7){l=0,w=13;break}if(B>>>0<v>>>0)B=B+1|0;else{w=9;break}}if((w|0)==9){if((v|0)==15)l=1;else break;return l|0}else if((w|0)==13)return l|0}while(!1);for(;;){if(l=jt(y|0,m|0,(14-v|0)*3|0)|0,Me()|0,!((l&7|0)==7&!0)){l=0,w=13;break}if(v>>>0<14)v=v+1|0;else{l=1,w=13;break}}return(w|0)==13?l|0:0}function jo(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;if(M=jt(y|0,m|0,52)|0,Me()|0,M=M&15,v>>>0>15)return w=4,w|0;if((M|0)<(v|0))return w=12,w|0;if((M|0)==(v|0))return p[w>>2]=y,p[w+4>>2]=m,w=0,w|0;if(B=Zt(v|0,0,52)|0,B=B|y,y=Me()|0|m&-15728641,(M|0)>(v|0))do m=Zt(7,0,(14-v|0)*3|0)|0,v=v+1|0,B=m|B,y=Me()|0|y;while((v|0)<(M|0));return p[w>>2]=B,p[w+4>>2]=y,w=0,w|0}function Al(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0;if(M=jt(y|0,m|0,52)|0,Me()|0,M=M&15,!((v|0)<16&(M|0)<=(v|0)))return w=4,w|0;B=v-M|0,v=jt(y|0,m|0,45)|0,Me()|0;e:do if(!(wr(v&127)|0))v=Ls(7,0,B,((B|0)<0)<<31>>31)|0,B=Me()|0;else{t:do if(M|0){for(v=1;O=Zt(7,0,(15-v|0)*3|0)|0,!!((O&y|0)==0&((Me()|0)&m|0)==0);)if(v>>>0<M>>>0)v=v+1|0;else break t;v=Ls(7,0,B,((B|0)<0)<<31>>31)|0,B=Me()|0;break e}while(!1);v=Ls(7,0,B,((B|0)<0)<<31>>31)|0,v=si(v|0,Me()|0,5,0)|0,v=cn(v|0,Me()|0,-5,-1)|0,v=ks(v|0,Me()|0,6,0)|0,v=cn(v|0,Me()|0,1,0)|0,B=Me()|0}while(!1);return O=w,p[O>>2]=v,p[O+4>>2]=B,O=0,O|0}function Sn(y,m){y=y|0,m=m|0;var v=0,w=0,B=0;if(B=jt(y|0,m|0,45)|0,Me()|0,!(wr(B&127)|0))return B=0,B|0;B=jt(y|0,m|0,52)|0,Me()|0,B=B&15;e:do if(!B)v=0;else for(w=1;;){if(v=jt(y|0,m|0,(15-w|0)*3|0)|0,Me()|0,v=v&7,v|0)break e;if(w>>>0<B>>>0)w=w+1|0;else{v=0;break}}while(!1);return B=(v|0)==0&1,B|0}function Pn(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0;if(O=Ie,Ie=Ie+16|0,M=O,gl(M,y,m,v),m=M,y=p[m>>2]|0,m=p[m+4>>2]|0,(y|0)==0&(m|0)==0)return Ie=O,0;B=0,v=0;do l=w+(B<<3)|0,p[l>>2]=y,p[l+4>>2]=m,B=cn(B|0,v|0,1,0)|0,v=Me()|0,su(M),l=M,y=p[l>>2]|0,m=p[l+4>>2]|0;while(!((y|0)==0&(m|0)==0));return Ie=O,0}function tu(y,m,v,w){return y=y|0,m=m|0,v=v|0,w=w|0,(w|0)<(v|0)?(v=m,w=y,fr(v|0),w|0):(v=Zt(-1,-1,((w-v|0)*3|0)+3|0)|0,w=Zt(~v|0,~(Me()|0)|0,(15-w|0)*3|0)|0,v=~(Me()|0)&m,w=~w&y,fr(v|0),w|0)}function HA(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0;return B=jt(y|0,m|0,52)|0,Me()|0,B=B&15,(v|0)<16&(B|0)<=(v|0)?((B|0)<(v|0)&&(B=Zt(-1,-1,((v+-1-B|0)*3|0)+3|0)|0,B=Zt(~B|0,~(Me()|0)|0,(15-v|0)*3|0)|0,m=~(Me()|0)&m,y=~B&y),B=Zt(v|0,0,52)|0,v=m&-15728641|(Me()|0),p[w>>2]=y|B,p[w+4>>2]=v,w=0,w|0):(w=4,w|0)}function xc(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0;if((v|0)==0&(w|0)==0)return me=0,me|0;if(B=y,M=p[B>>2]|0,B=p[B+4>>2]|0,!0&(B&15728640|0)==0){if(!((w|0)>0|(w|0)==0&v>>>0>0)||(me=m,p[me>>2]=M,p[me+4>>2]=B,(v|0)==1&(w|0)==0))return me=0,me|0;B=1;do Ee=y+(B<<3)|0,Oe=p[Ee+4>>2]|0,me=m+(B<<3)|0,p[me>>2]=p[Ee>>2],p[me+4>>2]=Oe,B=B+1|0;while(0<(w|0)|(w|0)==0&B>>>0<v>>>0);return B=0,B|0}if(oe=v<<3,Oe=Vn(oe)|0,!Oe)return me=13,me|0;if(To(Oe|0,y|0,oe|0)|0,Ee=eo(v,8)|0,!Ee)return Or(Oe),me=13,me|0;e:do if(v|0){t:for(;;){B=Oe,te=p[B>>2]|0,B=p[B+4>>2]|0,Q=jt(te|0,B|0,52)|0,Me()|0,Q=Q&15,re=Q+-1|0,X=(v|0)>0;r:do if((Q|0)!=0&X){if(R=((v|0)<0)<<31>>31,L=Zt(re|0,0,52)|0,U=Me()|0,re>>>0>15){if(!((te|0)==0&(B|0)==0)){me=17;break t}for(M=0;;){if(M=M+1|0,(M|0)>=(v|0))break r;if(w=Oe+(M<<3)|0,U=p[w>>2]|0,w=p[w+4>>2]|0,!((U|0)==0&(w|0)==0)){B=w,me=17;break t}}}for(M=0,y=te,w=B;;){if(!((y|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){me=22;break t}if(l=jt(y|0,w|0,52)|0,Me()|0,l=l&15,(l|0)<(re|0)){B=12,me=28;break t}if((l|0)!=(re|0)&&(y=y|L,w=w&-15728641|U,l>>>0>=Q>>>0)){O=re;do P=Zt(7,0,(14-O|0)*3|0)|0,O=O+1|0,y=P|y,w=Me()|0|w;while(O>>>0<l>>>0)}if(O=mo(y|0,w|0,v|0,R|0)|0,Me()|0,h=Ee+(O<<3)|0,l=h,d=p[l>>2]|0,l=p[l+4>>2]|0,(d|0)==0&(l|0)==0)O=h;else for(P=0;;){if((P|0)>(v|0)){me=32;break t}if((d|0)==(y|0)&(l&-117440513|0)==(w|0)){g=jt(d|0,l|0,56)|0,Me()|0,g=g&7,C=g+1|0,Fe=jt(d|0,l|0,45)|0,Me()|0;n:do if(!(wr(Fe&127)|0))l=7;else{if(d=jt(d|0,l|0,52)|0,Me()|0,d=d&15,!d){l=6;break}for(l=1;;){if(Fe=Zt(7,0,(15-l|0)*3|0)|0,!((Fe&y|0)==0&((Me()|0)&w|0)==0)){l=7;break n}if(l>>>0<d>>>0)l=l+1|0;else{l=6;break}}}while(!1);if((g+2|0)>>>0>l>>>0){me=42;break t}Fe=Zt(C|0,0,56)|0,w=Me()|0|w&-117440513,C=h,p[C>>2]=0,p[C+4>>2]=0,y=Fe|y}else O=(O+1|0)%(v|0)|0;if(h=Ee+(O<<3)|0,l=h,d=p[l>>2]|0,l=p[l+4>>2]|0,(d|0)==0&(l|0)==0){O=h;break}else P=P+1|0}Fe=O,p[Fe>>2]=y,p[Fe+4>>2]=w}if(M=M+1|0,(M|0)>=(v|0))break r;w=Oe+(M<<3)|0,y=p[w>>2]|0,w=p[w+4>>2]|0}}while(!1);if((v+5|0)>>>0<11){me=85;break}if(U=eo((v|0)/6|0,8)|0,!U){me=49;break}r:do if(X){P=0,C=0;do{if(l=Ee+(P<<3)|0,w=l,M=p[w>>2]|0,w=p[w+4>>2]|0,!((M|0)==0&(w|0)==0)){d=jt(M|0,w|0,56)|0,Me()|0,d=d&7,y=d+1|0,h=w&-117440513,Fe=jt(M|0,w|0,45)|0,Me()|0;n:do if(wr(Fe&127)|0){if(g=jt(M|0,w|0,52)|0,Me()|0,g=g&15,g|0)for(O=1;;){if(Fe=Zt(7,0,(15-O|0)*3|0)|0,!((M&Fe|0)==0&(h&(Me()|0)|0)==0))break n;if(O>>>0<g>>>0)O=O+1|0;else break}w=Zt(y|0,0,56)|0,M=w|M,w=Me()|0|h,y=l,p[y>>2]=M,p[y+4>>2]=w,y=d+2|0}while(!1);(y|0)==7&&(Fe=U+(C<<3)|0,p[Fe>>2]=M,p[Fe+4>>2]=w&-117440513,C=C+1|0)}P=P+1|0}while((P|0)!=(v|0));if(X){if(P=((v|0)<0)<<31>>31,R=Zt(re|0,0,52)|0,L=Me()|0,re>>>0>15){if(!((te|0)==0&(B|0)==0)){B=4,me=84;break t}for(B=0;;){if(B=B+1|0,(B|0)>=(v|0)){M=0,B=C;break r}if(Fe=Oe+(B<<3)|0,!((p[Fe>>2]|0)==0&(p[Fe+4>>2]|0)==0)){B=4,me=84;break t}}}for(g=0,M=0,h=te;;){do if(!((h|0)==0&(B|0)==0)){if(l=jt(h|0,B|0,52)|0,Me()|0,l=l&15,(l|0)<(re|0)){B=12,me=84;break t}do if((l|0)==(re|0))w=h,l=B;else{if(w=h|R,y=B&-15728641|L,l>>>0<Q>>>0){l=y;break}O=re;do Fe=Zt(7,0,(14-O|0)*3|0)|0,O=O+1|0,w=Fe|w,y=Me()|0|y;while(O>>>0<l>>>0);l=y}while(!1);for(O=mo(w|0,l|0,v|0,P|0)|0,Me()|0,y=0;;){if((y|0)>(v|0)){me=77;break t}if(Fe=Ee+(O<<3)|0,d=p[Fe+4>>2]|0,(d&-117440513|0)==(l|0)&&(p[Fe>>2]|0)==(w|0)){me=79;break}if(O=(O+1|0)%(v|0)|0,Fe=Ee+(O<<3)|0,(p[Fe>>2]|0)==(w|0)&&(p[Fe+4>>2]|0)==(l|0))break;y=y+1|0}if((me|0)==79&&(me=0,!0&(d&117440512|0)==100663296))break;Fe=m+(M<<3)|0,p[Fe>>2]=h,p[Fe+4>>2]=B,M=M+1|0}while(!1);if(B=g+1|0,(B|0)>=(v|0)){B=C;break r}Fe=Oe+(B<<3)|0,g=B,h=p[Fe>>2]|0,B=p[Fe+4>>2]|0}}else M=0,B=C}else M=0,B=0;while(!1);if(Yo(Ee|0,0,oe|0)|0,To(Oe|0,U|0,B<<3|0)|0,Or(U),B)m=m+(M<<3)|0,v=B;else break e}if((me|0)==17)!0&(B&117440512|0)==0?(B=4,me=28):me=22;else if((me|0)==32)Wt(23313,22674,362,22684);else{if((me|0)==42)return Or(Oe),Or(Ee),Fe=10,Fe|0;if((me|0)==49)return Or(Oe),Or(Ee),Fe=13,Fe|0;if((me|0)==77)Wt(23313,22674,462,22684);else{if((me|0)==84)return Or(U),Or(Oe),Or(Ee),Fe=B,Fe|0;if((me|0)==85){To(m|0,Oe|0,v<<3|0)|0;break}}}if((me|0)==22)return Or(Oe),Or(Ee),Fe=5,Fe|0;if((me|0)==28)return Or(Oe),Or(Ee),Fe=B,Fe|0}while(!1);return Or(Oe),Or(Ee),Fe=0,Fe|0}function Bh(y,m,v,w,B,M,O){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0,O=O|0;var l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0;if(U=Ie,Ie=Ie+16|0,L=U,!((v|0)>0|(v|0)==0&m>>>0>0))return L=0,Ie=U,L|0;if((O|0)>=16)return L=12,Ie=U,L|0;P=0,R=0,C=0,l=0;e:for(;;){if(h=y+(P<<3)|0,d=p[h>>2]|0,h=p[h+4>>2]|0,g=jt(d|0,h|0,52)|0,Me()|0,(g&15|0)>(O|0)){l=12,d=11;break}if(gl(L,d,h,O),g=L,h=p[g>>2]|0,g=p[g+4>>2]|0,(h|0)==0&(g|0)==0)d=C;else{d=C;do{if(!((l|0)<(M|0)|(l|0)==(M|0)&d>>>0<B>>>0)){d=10;break e}C=w+(d<<3)|0,p[C>>2]=h,p[C+4>>2]=g,d=cn(d|0,l|0,1,0)|0,l=Me()|0,su(L),C=L,h=p[C>>2]|0,g=p[C+4>>2]|0}while(!((h|0)==0&(g|0)==0))}if(P=cn(P|0,R|0,1,0)|0,R=Me()|0,(R|0)<(v|0)|(R|0)==(v|0)&P>>>0<m>>>0)C=d;else{l=0,d=11;break}}return(d|0)==10?(L=14,Ie=U,L|0):(d|0)==11?(Ie=U,l|0):0}function jA(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0;P=Ie,Ie=Ie+16|0,C=P;e:do if((v|0)>0|(v|0)==0&m>>>0>0){for(h=0,O=0,M=0,g=0;;){if(d=y+(h<<3)|0,l=p[d>>2]|0,d=p[d+4>>2]|0,!((l|0)==0&(d|0)==0)&&(d=(Al(l,d,w,C)|0)==0,l=C,O=cn(p[l>>2]|0,p[l+4>>2]|0,O|0,M|0)|0,M=Me()|0,!d)){M=12;break}if(h=cn(h|0,g|0,1,0)|0,g=Me()|0,!((g|0)<(v|0)|(g|0)==(v|0)&h>>>0<m>>>0))break e}return Ie=P,M|0}else O=0,M=0;while(!1);return p[B>>2]=O,p[B+4>>2]=M,B=0,Ie=P,B|0}function Sh(y,m){return y=y|0,m=m|0,m=jt(y|0,m|0,52)|0,Me()|0,m&1|0}function Yi(y,m){y=y|0,m=m|0;var v=0,w=0,B=0;if(B=jt(y|0,m|0,52)|0,Me()|0,B=B&15,!B)return B=0,B|0;for(w=1;;){if(v=jt(y|0,m|0,(15-w|0)*3|0)|0,Me()|0,v=v&7,v|0){w=5;break}if(w>>>0<B>>>0)w=w+1|0;else{v=0,w=5;break}}return(w|0)==5?v|0:0}function _a(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(d=jt(y|0,m|0,52)|0,Me()|0,d=d&15,!d)return l=m,d=y,fr(l|0),d|0;for(l=1,v=0;;){M=(15-l|0)*3|0,w=Zt(7,0,M|0)|0,B=Me()|0,O=jt(y|0,m|0,M|0)|0,Me()|0,M=Zt(Ao(O&7)|0,0,M|0)|0,O=Me()|0,y=M|y&~w,m=O|m&~B;e:do if(!v)if((M&w|0)==0&(O&B|0)==0)v=0;else if(w=jt(y|0,m|0,52)|0,Me()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(O=jt(y|0,m|0,(15-v|0)*3|0)|0,Me()|0,O&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(O=(15-v|0)*3|0,B=jt(y|0,m|0,O|0)|0,Me()|0,M=Zt(7,0,O|0)|0,m=m&~(Me()|0),O=Zt(Ao(B&7)|0,0,O|0)|0,y=y&~M|O,m=m|(Me()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(l>>>0<d>>>0)l=l+1|0;else break}return fr(m|0),y|0}function po(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0;if(w=jt(y|0,m|0,52)|0,Me()|0,w=w&15,!w)return v=m,w=y,fr(v|0),w|0;for(v=1;M=(15-v|0)*3|0,O=jt(y|0,m|0,M|0)|0,Me()|0,B=Zt(7,0,M|0)|0,m=m&~(Me()|0),M=Zt(Ao(O&7)|0,0,M|0)|0,y=M|y&~B,m=Me()|0|m,v>>>0<w>>>0;)v=v+1|0;return fr(m|0),y|0}function ru(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(d=jt(y|0,m|0,52)|0,Me()|0,d=d&15,!d)return l=m,d=y,fr(l|0),d|0;for(l=1,v=0;;){M=(15-l|0)*3|0,w=Zt(7,0,M|0)|0,B=Me()|0,O=jt(y|0,m|0,M|0)|0,Me()|0,M=Zt(Xs(O&7)|0,0,M|0)|0,O=Me()|0,y=M|y&~w,m=O|m&~B;e:do if(!v)if((M&w|0)==0&(O&B|0)==0)v=0;else if(w=jt(y|0,m|0,52)|0,Me()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(O=jt(y|0,m|0,(15-v|0)*3|0)|0,Me()|0,O&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(B=(15-v|0)*3|0,M=Zt(7,0,B|0)|0,O=m&~(Me()|0),m=jt(y|0,m|0,B|0)|0,Me()|0,m=Zt(Xs(m&7)|0,0,B|0)|0,y=y&~M|m,m=O|(Me()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(l>>>0<d>>>0)l=l+1|0;else break}return fr(m|0),y|0}function za(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0;if(w=jt(y|0,m|0,52)|0,Me()|0,w=w&15,!w)return v=m,w=y,fr(v|0),w|0;for(v=1;O=(15-v|0)*3|0,M=Zt(7,0,O|0)|0,B=m&~(Me()|0),m=jt(y|0,m|0,O|0)|0,Me()|0,m=Zt(Xs(m&7)|0,0,O|0)|0,y=m|y&~M,m=Me()|0|B,v>>>0<w>>>0;)v=v+1|0;return fr(m|0),y|0}function wc(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(d=Ie,Ie=Ie+64|0,l=d+40|0,w=d+24|0,B=d+12|0,M=d,Zt(m|0,0,52)|0,v=Me()|0|134225919,!m)return(p[y+4>>2]|0)>2||(p[y+8>>2]|0)>2||(p[y+12>>2]|0)>2?(O=0,l=0,fr(O|0),Ie=d,l|0):(Zt(Ii(y)|0,0,45)|0,O=Me()|0|v,l=-1,fr(O|0),Ie=d,l|0);if(p[l>>2]=p[y>>2],p[l+4>>2]=p[y+4>>2],p[l+8>>2]=p[y+8>>2],p[l+12>>2]=p[y+12>>2],O=l+4|0,(m|0)>0)for(y=-1;p[w>>2]=p[O>>2],p[w+4>>2]=p[O+4>>2],p[w+8>>2]=p[O+8>>2],m&1?(sf(O),p[B>>2]=p[O>>2],p[B+4>>2]=p[O+4>>2],p[B+8>>2]=p[O+8>>2],vc(B)):(Kl(O),p[B>>2]=p[O>>2],p[B+4>>2]=p[O+4>>2],p[B+8>>2]=p[O+8>>2],zo(B)),ii(w,B,M),hi(M),g=(15-m|0)*3|0,h=Zt(7,0,g|0)|0,v=v&~(Me()|0),g=Zt(hl(M)|0,0,g|0)|0,y=g|y&~h,v=Me()|0|v,(m|0)>1;)m=m+-1|0;else y=-1;e:do if((p[O>>2]|0)<=2&&(p[l+8>>2]|0)<=2&&(p[l+12>>2]|0)<=2){if(w=Ii(l)|0,m=Zt(w|0,0,45)|0,m=m|y,y=Me()|0|v&-1040385,M=Gi(l)|0,!(wr(w)|0)){if((M|0)<=0)break;for(B=0;;){if(w=jt(m|0,y|0,52)|0,Me()|0,w=w&15,w)for(v=1;g=(15-v|0)*3|0,l=jt(m|0,y|0,g|0)|0,Me()|0,h=Zt(7,0,g|0)|0,y=y&~(Me()|0),g=Zt(Ao(l&7)|0,0,g|0)|0,m=m&~h|g,y=y|(Me()|0),v>>>0<w>>>0;)v=v+1|0;if(B=B+1|0,(B|0)==(M|0))break e}}B=jt(m|0,y|0,52)|0,Me()|0,B=B&15;t:do if(B){v=1;r:for(;;){switch(g=jt(m|0,y|0,(15-v|0)*3|0)|0,Me()|0,g&7){case 1:break r;case 0:break;default:break t}if(v>>>0<B>>>0)v=v+1|0;else break t}if(nf(w,p[l>>2]|0)|0)for(v=1;l=(15-v|0)*3|0,h=Zt(7,0,l|0)|0,g=y&~(Me()|0),y=jt(m|0,y|0,l|0)|0,Me()|0,y=Zt(Xs(y&7)|0,0,l|0)|0,m=m&~h|y,y=g|(Me()|0),v>>>0<B>>>0;)v=v+1|0;else for(v=1;g=(15-v|0)*3|0,l=jt(m|0,y|0,g|0)|0,Me()|0,h=Zt(7,0,g|0)|0,y=y&~(Me()|0),g=Zt(Ao(l&7)|0,0,g|0)|0,m=m&~h|g,y=y|(Me()|0),v>>>0<B>>>0;)v=v+1|0}while(!1);if((M|0)>0){v=0;do m=_a(m,y)|0,y=Me()|0,v=v+1|0;while((v|0)!=(M|0))}}else m=0,y=0;while(!1);return h=y,g=m,fr(h|0),Ie=d,g|0}function Fs(y){return y=y|0,(y|0)%2|0|0}function Ga(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0;return B=Ie,Ie=Ie+16|0,w=B,m>>>0>15?(w=4,Ie=B,w|0):(p[y+4>>2]&2146435072|0)==2146435072||(p[y+8+4>>2]&2146435072|0)==2146435072?(w=3,Ie=B,w|0):(Zl(y,m,w),m=wc(w,m)|0,w=Me()|0,p[v>>2]=m,p[v+4>>2]=w,(m|0)==0&(w|0)==0&&Wt(23313,22674,786,22697),w=0,Ie=B,w|0)}function Os(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0;if(B=v+4|0,M=jt(y|0,m|0,52)|0,Me()|0,M=M&15,O=jt(y|0,m|0,45)|0,Me()|0,w=(M|0)==0,wr(O&127)|0){if(w)return O=1,O|0;w=1}else{if(w)return O=0,O|0;(p[B>>2]|0)==0&&(p[v+8>>2]|0)==0?w=(p[v+12>>2]|0)!=0&1:w=1}for(v=1;v&1?vc(B):zo(B),O=jt(y|0,m|0,(15-v|0)*3|0)|0,Me()|0,of(B,O&7),v>>>0<M>>>0;)v=v+1|0;return w|0}function Va(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(g=Ie,Ie=Ie+16|0,d=g,h=jt(y|0,m|0,45)|0,Me()|0,h=h&127,h>>>0>121)return p[v>>2]=0,p[v+4>>2]=0,p[v+8>>2]=0,p[v+12>>2]=0,h=5,Ie=g,h|0;e:do if((wr(h)|0)!=0&&(M=jt(y|0,m|0,52)|0,Me()|0,M=M&15,(M|0)!=0)){w=1;t:for(;;){switch(l=jt(y|0,m|0,(15-w|0)*3|0)|0,Me()|0,l&7){case 5:break t;case 0:break;default:{w=m;break e}}if(w>>>0<M>>>0)w=w+1|0;else{w=m;break e}}for(B=1,w=m;m=(15-B|0)*3|0,O=Zt(7,0,m|0)|0,l=w&~(Me()|0),w=jt(y|0,w|0,m|0)|0,Me()|0,w=Zt(Xs(w&7)|0,0,m|0)|0,y=y&~O|w,w=l|(Me()|0),B>>>0<M>>>0;)B=B+1|0}else w=m;while(!1);if(l=7696+(h*28|0)|0,p[v>>2]=p[l>>2],p[v+4>>2]=p[l+4>>2],p[v+8>>2]=p[l+8>>2],p[v+12>>2]=p[l+12>>2],!(Os(y,w,v)|0))return h=0,Ie=g,h|0;if(O=v+4|0,p[d>>2]=p[O>>2],p[d+4>>2]=p[O+4>>2],p[d+8>>2]=p[O+8>>2],M=jt(y|0,w|0,52)|0,Me()|0,l=M&15,M&1?(zo(O),M=l+1|0):M=l,!(wr(h)|0))w=0;else{e:do if(!l)w=0;else for(m=1;;){if(B=jt(y|0,w|0,(15-m|0)*3|0)|0,Me()|0,B=B&7,B|0){w=B;break e}if(m>>>0<l>>>0)m=m+1|0;else{w=0;break}}while(!1);w=(w|0)==4&1}if(!(Ks(v,M,w,0)|0))(M|0)!=(l|0)&&(p[O>>2]=p[d>>2],p[O+4>>2]=p[d+4>>2],p[O+8>>2]=p[d+8>>2]);else{if(wr(h)|0)do;while((Ks(v,M,0,0)|0)!=0);(M|0)!=(l|0)&&Kl(O)}return h=0,Ie=g,h|0}function Cc(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;return M=Ie,Ie=Ie+16|0,w=M,B=Va(y,m,w)|0,B|0?(Ie=M,B|0):(B=jt(y|0,m|0,52)|0,Me()|0,Eh(w,B&15,v),B=0,Ie=M,B|0)}function Ec(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0;if(O=Ie,Ie=Ie+16|0,M=O,w=Va(y,m,M)|0,w|0)return M=w,Ie=O,M|0;w=jt(y|0,m|0,45)|0,Me()|0,w=(wr(w&127)|0)==0,B=jt(y|0,m|0,52)|0,Me()|0,B=B&15;e:do if(!w){if(B|0)for(w=1;;){if(l=Zt(7,0,(15-w|0)*3|0)|0,!((l&y|0)==0&((Me()|0)&m|0)==0))break e;if(w>>>0<B>>>0)w=w+1|0;else break}return Go(M,B,0,5,v),l=0,Ie=O,l|0}while(!1);return Ql(M,B,0,6,v),l=0,Ie=O,l|0}function Ha(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(B=jt(y|0,m|0,45)|0,Me()|0,!(wr(B&127)|0))return B=2,p[v>>2]=B,0;if(B=jt(y|0,m|0,52)|0,Me()|0,B=B&15,!B)return B=5,p[v>>2]=B,0;for(w=1;;){if(M=Zt(7,0,(15-w|0)*3|0)|0,!((M&y|0)==0&((Me()|0)&m|0)==0)){w=2,y=6;break}if(w>>>0<B>>>0)w=w+1|0;else{w=5,y=6;break}}return(y|0)==6&&(p[v>>2]=w),0}function Tc(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0;C=Ie,Ie=Ie+128|0,h=C+112|0,M=C+96|0,g=C,B=jt(y|0,m|0,52)|0,Me()|0,l=B&15,p[h>>2]=l,O=jt(y|0,m|0,45)|0,Me()|0,O=O&127;e:do if(wr(O)|0){if(l|0)for(w=1;;){if(d=Zt(7,0,(15-w|0)*3|0)|0,!((d&y|0)==0&((Me()|0)&m|0)==0)){B=0;break e}if(w>>>0<l>>>0)w=w+1|0;else break}if(B&1)B=1;else return d=Zt(l+1|0,0,52)|0,g=Me()|0|m&-15728641,h=Zt(7,0,(14-l|0)*3|0)|0,g=Tc((d|y)&~h,g&~(Me()|0),v)|0,Ie=C,g|0}else B=0;while(!1);if(w=Va(y,m,M)|0,!w){B?(Vo(M,h,g),d=5):(eu(M,h,g),d=6);e:do if(wr(O)|0)if(!l)y=5;else for(w=1;;){if(O=Zt(7,0,(15-w|0)*3|0)|0,!((O&y|0)==0&((Me()|0)&m|0)==0)){y=2;break e}if(w>>>0<l>>>0)w=w+1|0;else{y=5;break}}else y=2;while(!1);Yo(v|0,-1,y<<2|0)|0;e:do if(B)for(M=0;;){if(O=g+(M<<4)|0,Th(O,p[h>>2]|0)|0,O=p[O>>2]|0,l=p[v>>2]|0,(l|0)==-1|(l|0)==(O|0))w=v;else{B=0;do{if(B=B+1|0,B>>>0>=y>>>0){w=1;break e}w=v+(B<<2)|0,l=p[w>>2]|0}while(!((l|0)==-1|(l|0)==(O|0)))}if(p[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}else for(M=0;;){if(O=g+(M<<4)|0,Ks(O,p[h>>2]|0,0,1)|0,O=p[O>>2]|0,l=p[v>>2]|0,(l|0)==-1|(l|0)==(O|0))w=v;else{B=0;do{if(B=B+1|0,B>>>0>=y>>>0){w=1;break e}w=v+(B<<2)|0,l=p[w>>2]|0}while(!((l|0)==-1|(l|0)==(O|0)))}if(p[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}while(!1)}return g=w,Ie=C,g|0}function nu(){return 12}function pl(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(y>>>0>15)return l=4,l|0;if(Zt(y|0,0,52)|0,l=Me()|0|134225919,!y){v=0,w=0;do wr(w)|0&&(Zt(w|0,0,45)|0,O=l|(Me()|0),y=m+(v<<3)|0,p[y>>2]=-1,p[y+4>>2]=O,v=v+1|0),w=w+1|0;while((w|0)!=122);return v=0,v|0}v=0,O=0;do{if(wr(O)|0){for(Zt(O|0,0,45)|0,w=1,B=-1,M=l|(Me()|0);d=Zt(7,0,(15-w|0)*3|0)|0,B=B&~d,M=M&~(Me()|0),(w|0)!=(y|0);)w=w+1|0;d=m+(v<<3)|0,p[d>>2]=B,p[d+4>>2]=M,v=v+1|0}O=O+1|0}while((O|0)!=122);return v=0,v|0}function iu(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0;if(Q=Ie,Ie=Ie+16|0,X=Q,te=jt(y|0,m|0,52)|0,Me()|0,te=te&15,v>>>0>15)return te=4,Ie=Q,te|0;if((te|0)<(v|0))return te=12,Ie=Q,te|0;if((te|0)!=(v|0))if(M=Zt(v|0,0,52)|0,M=M|y,l=Me()|0|m&-15728641,(te|0)>(v|0)){d=v;do U=Zt(7,0,(14-d|0)*3|0)|0,d=d+1|0,M=U|M,l=Me()|0|l;while((d|0)<(te|0));U=M}else U=M;else U=y,l=m;L=jt(U|0,l|0,45)|0,Me()|0;e:do if(wr(L&127)|0){if(d=jt(U|0,l|0,52)|0,Me()|0,d=d&15,d|0)for(M=1;;){if(L=Zt(7,0,(15-M|0)*3|0)|0,!((L&U|0)==0&((Me()|0)&l|0)==0)){h=33;break e}if(M>>>0<d>>>0)M=M+1|0;else break}if(L=w,p[L>>2]=0,p[L+4>>2]=0,(te|0)>(v|0)){for(L=m&-15728641,R=te;;){if(P=R,R=R+-1|0,R>>>0>15|(te|0)<(R|0)){h=19;break}if((te|0)!=(R|0))if(M=Zt(R|0,0,52)|0,M=M|y,d=Me()|0|L,(te|0)<(P|0))C=M;else{h=R;do C=Zt(7,0,(14-h|0)*3|0)|0,h=h+1|0,M=C|M,d=Me()|0|d;while((h|0)<(te|0));C=M}else C=y,d=m;if(g=jt(C|0,d|0,45)|0,Me()|0,!(wr(g&127)|0))M=0;else{g=jt(C|0,d|0,52)|0,Me()|0,g=g&15;t:do if(!g)M=0;else for(h=1;;){if(M=jt(C|0,d|0,(15-h|0)*3|0)|0,Me()|0,M=M&7,M|0)break t;if(h>>>0<g>>>0)h=h+1|0;else{M=0;break}}while(!1);M=(M|0)==0&1}if(d=jt(y|0,m|0,(15-P|0)*3|0)|0,Me()|0,d=d&7,(d|0)==7){B=5,h=42;break}if(M=(M|0)!=0,(d|0)==1&M){B=5,h=42;break}if(C=d+(((d|0)!=0&M)<<31>>31)|0,C|0&&(h=te-P|0,h=Ls(7,0,h,((h|0)<0)<<31>>31)|0,g=Me()|0,M?(M=si(h|0,g|0,5,0)|0,M=cn(M|0,Me()|0,-5,-1)|0,M=ks(M|0,Me()|0,6,0)|0,M=cn(M|0,Me()|0,1,0)|0,d=Me()|0):(M=h,d=g),P=C+-1|0,P=si(h|0,g|0,P|0,((P|0)<0)<<31>>31|0)|0,P=cn(M|0,d|0,P|0,Me()|0)|0,C=Me()|0,g=w,g=cn(P|0,C|0,p[g>>2]|0,p[g+4>>2]|0)|0,C=Me()|0,P=w,p[P>>2]=g,p[P+4>>2]=C),(R|0)<=(v|0)){h=37;break}}if((h|0)==19)Wt(23313,22674,1099,22710);else if((h|0)==37){O=w,B=p[O+4>>2]|0,O=p[O>>2]|0;break}else if((h|0)==42)return Ie=Q,B|0}else B=0,O=0}else h=33;while(!1);e:do if((h|0)==33)if(L=w,p[L>>2]=0,p[L+4>>2]=0,(te|0)>(v|0)){for(M=te;;){if(B=jt(y|0,m|0,(15-M|0)*3|0)|0,Me()|0,B=B&7,(B|0)==7){B=5;break}if(O=te-M|0,O=Ls(7,0,O,((O|0)<0)<<31>>31)|0,B=si(O|0,Me()|0,B|0,0)|0,O=Me()|0,L=w,O=cn(p[L>>2]|0,p[L+4>>2]|0,B|0,O|0)|0,B=Me()|0,L=w,p[L>>2]=O,p[L+4>>2]=B,M=M+-1|0,(M|0)<=(v|0))break e}return Ie=Q,B|0}else B=0,O=0;while(!1);return Al(U,l,te,X)|0&&Wt(23313,22674,1063,22725),te=X,X=p[te+4>>2]|0,((B|0)>-1|(B|0)==-1&O>>>0>4294967295)&((X|0)>(B|0)|((X|0)==(B|0)?(p[te>>2]|0)>>>0>O>>>0:0))?(te=0,Ie=Q,te|0):(Wt(23313,22674,1139,22710),0)}function $A(y,m,v,w,B,M){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0;var O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0;if(C=Ie,Ie=Ie+16|0,O=C,B>>>0>15)return M=4,Ie=C,M|0;if(l=jt(v|0,w|0,52)|0,Me()|0,l=l&15,(l|0)>(B|0))return M=12,Ie=C,M|0;if(Al(v,w,B,O)|0&&Wt(23313,22674,1063,22725),g=O,h=p[g+4>>2]|0,!(((m|0)>-1|(m|0)==-1&y>>>0>4294967295)&((h|0)>(m|0)|((h|0)==(m|0)?(p[g>>2]|0)>>>0>y>>>0:0))))return M=2,Ie=C,M|0;g=B-l|0,B=Zt(B|0,0,52)|0,d=Me()|0|w&-15728641,h=M,p[h>>2]=B|v,p[h+4>>2]=d,h=jt(v|0,w|0,45)|0,Me()|0;e:do if(wr(h&127)|0){if(l|0)for(O=1;;){if(h=Zt(7,0,(15-O|0)*3|0)|0,!((h&v|0)==0&((Me()|0)&w|0)==0))break e;if(O>>>0<l>>>0)O=O+1|0;else break}if((g|0)<1)return M=0,Ie=C,M|0;for(h=l^15,w=-1,d=1,O=1;;){l=g-d|0,l=Ls(7,0,l,((l|0)<0)<<31>>31)|0,v=Me()|0;do if(O)if(O=si(l|0,v|0,5,0)|0,O=cn(O|0,Me()|0,-5,-1)|0,O=ks(O|0,Me()|0,6,0)|0,B=Me()|0,(m|0)>(B|0)|(m|0)==(B|0)&y>>>0>O>>>0){m=cn(y|0,m|0,-1,-1)|0,m=Hr(m|0,Me()|0,O|0,B|0)|0,O=Me()|0,P=M,L=p[P>>2]|0,P=p[P+4>>2]|0,U=(h+w|0)*3|0,R=Zt(7,0,U|0)|0,P=P&~(Me()|0),w=ks(m|0,O|0,l|0,v|0)|0,y=Me()|0,B=cn(w|0,y|0,2,0)|0,U=Zt(B|0,Me()|0,U|0)|0,P=Me()|0|P,B=M,p[B>>2]=U|L&~R,p[B+4>>2]=P,y=si(w|0,y|0,l|0,v|0)|0,y=Hr(m|0,O|0,y|0,Me()|0)|0,O=0,m=Me()|0;break}else{U=M,R=p[U>>2]|0,U=p[U+4>>2]|0,L=Zt(7,0,(h+w|0)*3|0)|0,U=U&~(Me()|0),O=M,p[O>>2]=R&~L,p[O+4>>2]=U,O=1;break}else R=M,B=p[R>>2]|0,R=p[R+4>>2]|0,w=(h+w|0)*3|0,P=Zt(7,0,w|0)|0,R=R&~(Me()|0),U=ks(y|0,m|0,l|0,v|0)|0,O=Me()|0,w=Zt(U|0,O|0,w|0)|0,R=Me()|0|R,L=M,p[L>>2]=w|B&~P,p[L+4>>2]=R,O=si(U|0,O|0,l|0,v|0)|0,y=Hr(y|0,m|0,O|0,Me()|0)|0,O=0,m=Me()|0;while(!1);if((g|0)>(d|0))w=~d,d=d+1|0;else{m=0;break}}return Ie=C,m|0}while(!1);if((g|0)<1)return U=0,Ie=C,U|0;for(B=l^15,O=1;;)if(L=g-O|0,L=Ls(7,0,L,((L|0)<0)<<31>>31)|0,U=Me()|0,d=M,v=p[d>>2]|0,d=p[d+4>>2]|0,l=(B-O|0)*3|0,w=Zt(7,0,l|0)|0,d=d&~(Me()|0),P=ks(y|0,m|0,L|0,U|0)|0,R=Me()|0,l=Zt(P|0,R|0,l|0)|0,d=Me()|0|d,h=M,p[h>>2]=l|v&~w,p[h+4>>2]=d,U=si(P|0,R|0,L|0,U|0)|0,y=Hr(y|0,m|0,U|0,Me()|0)|0,m=Me()|0,(g|0)<=(O|0)){m=0;break}else O=O+1|0;return Ie=C,m|0}function gl(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;B=jt(m|0,v|0,52)|0,Me()|0,B=B&15,(m|0)==0&(v|0)==0|((w|0)>15|(B|0)>(w|0))?(w=-1,B=-1,m=0,v=0):(M=tu(m,v,B+1|0,w)|0,v=(Me()|0)&-15728641,m=Zt(w|0,0,52)|0,m=M|m,v=v|(Me()|0),M=(Sn(m,v)|0)==0,w=M?-1:w),M=y,p[M>>2]=m,p[M+4>>2]=v,p[y+8>>2]=B,p[y+12>>2]=w}function su(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0;if(v=y,m=p[v>>2]|0,v=p[v+4>>2]|0,!((m|0)==0&(v|0)==0)&&(w=jt(m|0,v|0,52)|0,Me()|0,w=w&15,l=Zt(1,0,(w^15)*3|0)|0,m=cn(l|0,Me()|0,m|0,v|0)|0,v=Me()|0,l=y,p[l>>2]=m,p[l+4>>2]=v,l=y+8|0,O=p[l>>2]|0,!((w|0)<(O|0)))){for(d=y+12|0,M=w;;){if((M|0)==(O|0)){w=5;break}if(h=(M|0)==(p[d>>2]|0),B=(15-M|0)*3|0,w=jt(m|0,v|0,B|0)|0,Me()|0,w=w&7,h&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(h=Zt(1,0,B|0)|0,m=cn(m|0,v|0,h|0,Me()|0)|0,v=Me()|0,h=y,p[h>>2]=m,p[h+4>>2]=v,(M|0)>(O|0))M=M+-1|0;else{w=10;break}}if((w|0)==5){h=y,p[h>>2]=0,p[h+4>>2]=0,p[l>>2]=-1,p[d>>2]=-1;return}else if((w|0)==7){O=Zt(1,0,B|0)|0,O=cn(m|0,v|0,O|0,Me()|0)|0,l=Me()|0,h=y,p[h>>2]=O,p[h+4>>2]=l,p[d>>2]=M+-1;return}else if((w|0)==10)return}}function Bc(y){y=+y;var m=0;return m=y<0?y+6.283185307179586:y,+(y>=6.283185307179586?m+-6.283185307179586:m)}function ja(y,m){return y=y|0,m=m|0,+It(+(+le[y>>3]-+le[m>>3]))<17453292519943298e-27?(m=+It(+(+le[y+8>>3]-+le[m+8>>3]))<17453292519943298e-27,m|0):(m=0,m|0)}function ou(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0;return B=+le[m>>3],w=+le[y>>3],M=+St(+((B-w)*.5)),v=+St(+((+le[m+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Ot(+B)*+Ot(+w)*v),+(+en(+ +Ft(+v),+ +Ft(+(1-v)))*2)}function $a(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0;return B=+le[m>>3],w=+le[y>>3],M=+St(+((B-w)*.5)),v=+St(+((+le[m+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Ot(+B)*+Ot(+w)*v),+(+en(+ +Ft(+v),+ +Ft(+(1-v)))*2*6371.007180918475)}function uf(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0;return B=+le[m>>3],w=+le[y>>3],M=+St(+((B-w)*.5)),v=+St(+((+le[m+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Ot(+B)*+Ot(+w)*v),+(+en(+ +Ft(+v),+ +Ft(+(1-v)))*2*6371.007180918475*1e3)}function ff(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0;return M=+le[m>>3],w=+Ot(+M),B=+le[m+8>>3]-+le[y+8>>3],O=w*+St(+B),v=+le[y>>3],+ +en(+O,+(+St(+M)*+Ot(+v)-+Ot(+B)*(w*+St(+v))))}function ml(y,m,v,w){y=y|0,m=+m,v=+v,w=w|0;var B=0,M=0,O=0,l=0;if(v<1e-16){p[w>>2]=p[y>>2],p[w+4>>2]=p[y+4>>2],p[w+8>>2]=p[y+8>>2],p[w+12>>2]=p[y+12>>2];return}M=m<0?m+6.283185307179586:m,M=m>=6.283185307179586?M+-6.283185307179586:M;do if(M<1e-16)m=+le[y>>3]+v,le[w>>3]=m,B=w;else{if(B=+It(+(M+-3.141592653589793))<1e-16,m=+le[y>>3],B){m=m-v,le[w>>3]=m,B=w;break}if(O=+Ot(+v),v=+St(+v),m=O*+St(+m)+ +Ot(+M)*(v*+Ot(+m)),m=m>1?1:m,m=+qt(+(m<-1?-1:m)),le[w>>3]=m,+It(+(m+-1.5707963267948966))<1e-16){le[w>>3]=1.5707963267948966,le[w+8>>3]=0;return}if(+It(+(m+1.5707963267948966))<1e-16){le[w>>3]=-1.5707963267948966,le[w+8>>3]=0;return}if(l=+Ot(+m),M=v*+St(+M)/l,v=+le[y>>3],m=(O-+St(+m)*+St(+v))/+Ot(+v)/l,O=M>1?1:M,m=m>1?1:m,m=+le[y+8>>3]+ +en(+(O<-1?-1:O),+(m<-1?-1:m)),m>3.141592653589793)do m=m+-6.283185307179586;while(m>3.141592653589793);if(m<-3.141592653589793)do m=m+6.283185307179586;while(m<-3.141592653589793);le[w+8>>3]=m;return}while(!1);if(+It(+(m+-1.5707963267948966))<1e-16){le[B>>3]=1.5707963267948966,le[w+8>>3]=0;return}if(+It(+(m+1.5707963267948966))<1e-16){le[B>>3]=-1.5707963267948966,le[w+8>>3]=0;return}if(m=+le[y+8>>3],m>3.141592653589793)do m=m+-6.283185307179586;while(m>3.141592653589793);if(m<-3.141592653589793)do m=m+6.283185307179586;while(m<-3.141592653589793);le[w+8>>3]=m}function Ih(y,m){return y=y|0,m=m|0,y>>>0>15?(m=4,m|0):(le[m>>3]=+le[20528+(y<<3)>>3],m=0,m|0)}function Wa(y,m){return y=y|0,m=m|0,y>>>0>15?(m=4,m|0):(le[m>>3]=+le[20656+(y<<3)>>3],m=0,m|0)}function Gn(y,m){return y=y|0,m=m|0,y>>>0>15?(m=4,m|0):(le[m>>3]=+le[20784+(y<<3)>>3],m=0,m|0)}function au(y,m){return y=y|0,m=m|0,y>>>0>15?(m=4,m|0):(le[m>>3]=+le[20912+(y<<3)>>3],m=0,m|0)}function $o(y,m){y=y|0,m=m|0;var v=0;return y>>>0>15?(m=4,m|0):(v=Ls(7,0,y,((y|0)<0)<<31>>31)|0,v=si(v|0,Me()|0,120,0)|0,y=Me()|0,p[m>>2]=v|2,p[m+4>>2]=y,m=0,m|0)}function Wo(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0;return P=+le[m>>3],g=+le[y>>3],d=+St(+((P-g)*.5)),M=+le[m+8>>3],h=+le[y+8>>3],O=+St(+((M-h)*.5)),l=+Ot(+g),C=+Ot(+P),O=d*d+O*(C*l*O),O=+en(+ +Ft(+O),+ +Ft(+(1-O)))*2,d=+le[v>>3],P=+St(+((d-P)*.5)),w=+le[v+8>>3],M=+St(+((w-M)*.5)),B=+Ot(+d),M=P*P+M*(C*B*M),M=+en(+ +Ft(+M),+ +Ft(+(1-M)))*2,d=+St(+((g-d)*.5)),w=+St(+((h-w)*.5)),w=d*d+w*(l*B*w),w=+en(+ +Ft(+w),+ +Ft(+(1-w)))*2,B=(O+M+w)*.5,+(+Xr(+ +Ft(+(+zt(+(B*.5))*+zt(+((B-O)*.5))*+zt(+((B-M)*.5))*+zt(+((B-w)*.5)))))*4)}function nn(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0;if(l=Ie,Ie=Ie+192|0,M=l+168|0,O=l,B=Cc(y,m,M)|0,B|0)return v=B,Ie=l,v|0;if(Ec(y,m,O)|0&&Wt(23313,22742,386,22751),m=p[O>>2]|0,(m|0)>0){if(w=+Wo(O+8|0,O+8+(((m|0)!=1&1)<<4)|0,M)+0,(m|0)!=1){y=1;do B=y,y=y+1|0,w=w+ +Wo(O+8+(B<<4)|0,O+8+(((y|0)%(m|0)|0)<<4)|0,M);while((y|0)<(m|0))}}else w=0;return le[v>>3]=w,v=0,Ie=l,v|0}function Rn(y,m,v){return y=y|0,m=m|0,v=v|0,y=nn(y,m,v)|0,y|0||(le[v>>3]=+le[v>>3]*6371.007180918475*6371.007180918475),y|0}function Ds(y,m,v){return y=y|0,m=m|0,v=v|0,y=nn(y,m,v)|0,y|0||(le[v>>3]=+le[v>>3]*6371.007180918475*6371.007180918475*1e3*1e3),y|0}function _l(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(l=Ie,Ie=Ie+176|0,O=l,y=ql(y,m,O)|0,y|0)return O=y,Ie=l,O|0;if(le[v>>3]=0,y=p[O>>2]|0,(y|0)<=1)return O=0,Ie=l,O|0;m=y+-1|0,y=0,w=+le[O+8>>3],B=+le[O+16>>3],M=0;do y=y+1|0,h=w,w=+le[O+8+(y<<4)>>3],g=+St(+((w-h)*.5)),d=B,B=+le[O+8+(y<<4)+8>>3],d=+St(+((B-d)*.5)),d=g*g+d*(+Ot(+w)*+Ot(+h)*d),M=M+ +en(+ +Ft(+d),+ +Ft(+(1-d)))*2;while((y|0)<(m|0));return le[v>>3]=M,O=0,Ie=l,O|0}function Sc(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(l=Ie,Ie=Ie+176|0,O=l,y=ql(y,m,O)|0,y|0)return O=y,M=+le[v>>3],M=M*6371.007180918475,le[v>>3]=M,Ie=l,O|0;if(le[v>>3]=0,y=p[O>>2]|0,(y|0)<=1)return O=0,M=0,M=M*6371.007180918475,le[v>>3]=M,Ie=l,O|0;m=y+-1|0,y=0,w=+le[O+8>>3],B=+le[O+16>>3],M=0;do y=y+1|0,h=w,w=+le[O+8+(y<<4)>>3],g=+St(+((w-h)*.5)),d=B,B=+le[O+8+(y<<4)+8>>3],d=+St(+((B-d)*.5)),d=g*g+d*(+Ot(+h)*+Ot(+w)*d),M=M+ +en(+ +Ft(+d),+ +Ft(+(1-d)))*2;while((y|0)!=(m|0));return le[v>>3]=M,O=0,g=M,g=g*6371.007180918475,le[v>>3]=g,Ie=l,O|0}function yl(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(l=Ie,Ie=Ie+176|0,O=l,y=ql(y,m,O)|0,y|0)return O=y,M=+le[v>>3],M=M*6371.007180918475,M=M*1e3,le[v>>3]=M,Ie=l,O|0;if(le[v>>3]=0,y=p[O>>2]|0,(y|0)<=1)return O=0,M=0,M=M*6371.007180918475,M=M*1e3,le[v>>3]=M,Ie=l,O|0;m=y+-1|0,y=0,w=+le[O+8>>3],B=+le[O+16>>3],M=0;do y=y+1|0,h=w,w=+le[O+8+(y<<4)>>3],g=+St(+((w-h)*.5)),d=B,B=+le[O+8+(y<<4)+8>>3],d=+St(+((B-d)*.5)),d=g*g+d*(+Ot(+h)*+Ot(+w)*d),M=M+ +en(+ +Ft(+d),+ +Ft(+(1-d)))*2;while((y|0)!=(m|0));return le[v>>3]=M,O=0,g=M,g=g*6371.007180918475,g=g*1e3,le[v>>3]=g,Ie=l,O|0}function WA(y){y=y|0;var m=0,v=0,w=0;return m=eo(1,12)|0,m||Wt(22832,22787,49,22845),v=y+4|0,w=p[v>>2]|0,w|0?(w=w+8|0,p[w>>2]=m,p[v>>2]=m,m|0):(p[y>>2]|0&&Wt(22862,22787,61,22885),w=y,p[w>>2]=m,p[v>>2]=m,m|0)}function JA(y,m){y=y|0,m=m|0;var v=0,w=0;return w=Vn(24)|0,w||Wt(22899,22787,78,22913),p[w>>2]=p[m>>2],p[w+4>>2]=p[m+4>>2],p[w+8>>2]=p[m+8>>2],p[w+12>>2]=p[m+12>>2],p[w+16>>2]=0,m=y+4|0,v=p[m>>2]|0,v|0?(p[v+16>>2]=w,p[m>>2]=w,w|0):(p[y>>2]|0&&Wt(22928,22787,82,22913),p[y>>2]=w,p[m>>2]=w,w|0)}function Ic(y){y=y|0;var m=0,v=0,w=0,B=0;if(y)for(w=1;;){if(m=p[y>>2]|0,m|0)do{if(v=p[m>>2]|0,v|0)do B=v,v=p[v+16>>2]|0,Or(B);while((v|0)!=0);B=m,m=p[m+8>>2]|0,Or(B)}while((m|0)!=0);if(m=y,y=p[y+8>>2]|0,w||Or(m),y)w=0;else break}}function vl(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0,He=0,We=0,it=0,Xe=0,et=0,ht=0,Rt=0,xt=0;if(B=y+8|0,p[B>>2]|0)return xt=1,xt|0;if(w=p[y>>2]|0,!w)return xt=0,xt|0;m=w,v=0;do v=v+1|0,m=p[m+8>>2]|0;while((m|0)!=0);if(v>>>0<2)return xt=0,xt|0;ht=Vn(v<<2)|0,ht||Wt(22948,22787,317,22967),et=Vn(v<<5)|0,et||Wt(22989,22787,321,22967),p[y>>2]=0,Oe=y+4|0,p[Oe>>2]=0,p[B>>2]=0,v=0,Xe=0,Ee=0,C=0;e:for(;;){if(g=p[w>>2]|0,g){M=0,O=g;do{if(d=+le[O+8>>3],m=O,O=p[O+16>>2]|0,h=(O|0)==0,B=h?g:O,l=+le[B+8>>3],+It(+(d-l))>3.141592653589793){xt=14;break}M=M+(l-d)*(+le[m>>3]+ +le[B>>3])}while(!h);if((xt|0)==14){xt=0,M=0,m=g;do oe=+le[m+8>>3],it=m+16|0,We=p[it>>2]|0,We=(We|0)==0?g:We,re=+le[We+8>>3],M=M+(+le[m>>3]+ +le[We>>3])*((re<0?re+6.283185307179586:re)-(oe<0?oe+6.283185307179586:oe)),m=p[((m|0)==0?w:it)>>2]|0;while((m|0)!=0)}M>0?(p[ht+(Xe<<2)>>2]=w,Xe=Xe+1|0,B=Ee,m=C):xt=19}else xt=19;if((xt|0)==19){xt=0;do if(v){if(m=v+8|0,p[m>>2]|0){xt=21;break e}if(v=eo(1,12)|0,!v){xt=23;break e}p[m>>2]=v,B=v+4|0,O=v,m=C}else if(C){B=Oe,O=C+8|0,m=w,v=y;break}else if(p[y>>2]|0){xt=27;break e}else{B=Oe,O=y,m=w,v=y;break}while(!1);if(p[O>>2]=w,p[B>>2]=w,O=et+(Ee<<5)|0,h=p[w>>2]|0,h){for(g=et+(Ee<<5)+8|0,le[g>>3]=17976931348623157e292,C=et+(Ee<<5)+24|0,le[C>>3]=17976931348623157e292,le[O>>3]=-17976931348623157e292,P=et+(Ee<<5)+16|0,le[P>>3]=-17976931348623157e292,te=17976931348623157e292,Q=-17976931348623157e292,B=0,R=h,d=17976931348623157e292,U=17976931348623157e292,X=-17976931348623157e292,l=-17976931348623157e292;M=+le[R>>3],oe=+le[R+8>>3],R=p[R+16>>2]|0,L=(R|0)==0,re=+le[(L?h:R)+8>>3],M<d&&(le[g>>3]=M,d=M),oe<U&&(le[C>>3]=oe,U=oe),M>X?le[O>>3]=M:M=X,oe>l&&(le[P>>3]=oe,l=oe),te=oe>0&oe<te?oe:te,Q=oe<0&oe>Q?oe:Q,B=B|+It(+(oe-re))>3.141592653589793,!L;)X=M;B&&(le[P>>3]=Q,le[C>>3]=te)}else p[O>>2]=0,p[O+4>>2]=0,p[O+8>>2]=0,p[O+12>>2]=0,p[O+16>>2]=0,p[O+20>>2]=0,p[O+24>>2]=0,p[O+28>>2]=0;B=Ee+1|0}if(it=w+8|0,w=p[it>>2]|0,p[it>>2]=0,w)Ee=B,C=m;else{xt=45;break}}if((xt|0)==21)Wt(22765,22787,35,22799);else if((xt|0)==23)Wt(22819,22787,37,22799);else if((xt|0)==27)Wt(22862,22787,61,22885);else if((xt|0)==45){e:do if((Xe|0)>0){for(it=(B|0)==0,He=B<<2,We=(y|0)==0,Fe=0,m=0;;){if(me=p[ht+(Fe<<2)>>2]|0,it)xt=73;else{if(Ee=Vn(He)|0,!Ee){xt=50;break}if(Oe=Vn(He)|0,!Oe){xt=52;break}t:do if(We)v=0;else{for(B=0,v=0,O=y;w=et+(B<<5)|0,Co(p[O>>2]|0,w,p[me>>2]|0)|0?(p[Ee+(v<<2)>>2]=O,p[Oe+(v<<2)>>2]=w,L=v+1|0):L=v,O=p[O+8>>2]|0,O;)B=B+1|0,v=L;if((L|0)>0)if(w=p[Ee>>2]|0,(L|0)==1)v=w;else for(P=0,R=-1,v=w,C=w;;){for(h=p[C>>2]|0,w=0,O=0;B=p[p[Ee+(O<<2)>>2]>>2]|0,(B|0)==(h|0)?g=w:g=w+((Co(B,p[Oe+(O<<2)>>2]|0,p[h>>2]|0)|0)&1)|0,O=O+1|0,(O|0)!=(L|0);)w=g;if(B=(g|0)>(R|0),v=B?C:v,w=P+1|0,(w|0)==(L|0))break t;P=w,R=B?g:R,C=p[Ee+(w<<2)>>2]|0}else v=0}while(!1);if(Or(Ee),Or(Oe),v){if(B=v+4|0,w=p[B>>2]|0,w)v=w+8|0;else if(p[v>>2]|0){xt=70;break}p[v>>2]=me,p[B>>2]=me}else xt=73}if((xt|0)==73){if(xt=0,m=p[me>>2]|0,m|0)do Oe=m,m=p[m+16>>2]|0,Or(Oe);while((m|0)!=0);Or(me),m=1}if(Fe=Fe+1|0,(Fe|0)>=(Xe|0)){Rt=m;break e}}(xt|0)==50?Wt(23004,22787,249,23023):(xt|0)==52?Wt(23042,22787,252,23023):(xt|0)==70&&Wt(22862,22787,61,22885)}else Rt=0;while(!1);return Or(ht),Or(et),xt=Rt,xt|0}return 0}function Co(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0;if(!(Rs(m,v)|0)||(m=fl(m)|0,w=+le[v>>3],B=+le[v+8>>3],B=m&B<0?B+6.283185307179586:B,y=p[y>>2]|0,!y))return y=0,y|0;if(m){m=0,h=B,v=y;e:for(;;){for(;O=+le[v>>3],B=+le[v+8>>3],v=v+16|0,g=p[v>>2]|0,g=(g|0)==0?y:g,M=+le[g>>3],l=+le[g+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=p[v>>2]|0,!v){v=22;break e}if(l=O<0?O+6.283185307179586:O,O=B<0?B+6.283185307179586:B,h=l==h|O==h?h+-2220446049250313e-31:h,d=l+(O-l)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>h&&(m=m^1),v=p[v>>2]|0,!v){v=22;break}}if((v|0)==22)return m|0}else{m=0,h=B,v=y;e:for(;;){for(;O=+le[v>>3],B=+le[v+8>>3],v=v+16|0,g=p[v>>2]|0,g=(g|0)==0?y:g,M=+le[g>>3],l=+le[g+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=p[v>>2]|0,!v){v=22;break e}if(h=O==h|B==h?h+-2220446049250313e-31:h,O+(B-O)*((w-M)/(d-M))>h&&(m=m^1),v=p[v>>2]|0,!v){v=22;break}}if((v|0)==22)return m|0}return 0}function Fn(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0;if(Q=Ie,Ie=Ie+32|0,te=Q+16|0,X=Q,M=jt(y|0,m|0,52)|0,Me()|0,M=M&15,R=jt(v|0,w|0,52)|0,Me()|0,(M|0)!=(R&15|0))return te=12,Ie=Q,te|0;if(h=jt(y|0,m|0,45)|0,Me()|0,h=h&127,g=jt(v|0,w|0,45)|0,Me()|0,g=g&127,h>>>0>121|g>>>0>121)return te=5,Ie=Q,te|0;if(R=(h|0)!=(g|0),R){if(l=ll(h,g)|0,(l|0)==7)return te=1,Ie=Q,te|0;d=ll(g,h)|0,(d|0)==7?Wt(23066,23090,161,23100):(L=l,O=d)}else L=0,O=0;C=wr(h)|0,P=wr(g)|0,p[te>>2]=0,p[te+4>>2]=0,p[te+8>>2]=0,p[te+12>>2]=0;do if(L){if(g=p[4272+(h*28|0)+(L<<2)>>2]|0,l=(g|0)>0,P)if(l){h=0,d=v,l=w;do d=ru(d,l)|0,l=Me()|0,O=Xs(O)|0,(O|0)==1&&(O=Xs(1)|0),h=h+1|0;while((h|0)!=(g|0));g=O,h=d,d=l}else g=O,h=v,d=w;else if(l){h=0,d=v,l=w;do d=za(d,l)|0,l=Me()|0,O=Xs(O)|0,h=h+1|0;while((h|0)!=(g|0));g=O,h=d,d=l}else g=O,h=v,d=w;if(Os(h,d,te)|0,R||Wt(23115,23090,191,23100),l=(C|0)!=0,O=(P|0)!=0,l&O&&Wt(23142,23090,192,23100),l){if(O=Yi(y,m)|0,(O|0)==7){M=5;break}if(Se[21872+(O*7|0)+L>>0]|0){M=1;break}d=p[21040+(O*28|0)+(L<<2)>>2]|0,h=d}else if(O){if(O=Yi(h,d)|0,(O|0)==7){M=5;break}if(Se[21872+(O*7|0)+g>>0]|0){M=1;break}h=0,d=p[21040+(g*28|0)+(O<<2)>>2]|0}else h=0,d=0;if((h|d|0)<0)M=5;else{if((d|0)>0){l=te+4|0,O=0;do Yl(l),O=O+1|0;while((O|0)!=(d|0))}if(p[X>>2]=0,p[X+4>>2]=0,p[X+8>>2]=0,of(X,L),M|0)for(;Fs(M)|0?vc(X):zo(X),(M|0)>1;)M=M+-1|0;if((h|0)>0){M=0;do Yl(X),M=M+1|0;while((M|0)!=(h|0))}U=te+4|0,Ln(U,X,U),hi(U),U=51}}else if(Os(v,w,te)|0,(C|0)!=0&(P|0)!=0)if((g|0)!=(h|0)&&Wt(23173,23090,261,23100),O=Yi(y,m)|0,M=Yi(v,w)|0,(O|0)==7|(M|0)==7)M=5;else if(Se[21872+(O*7|0)+M>>0]|0)M=1;else if(O=p[21040+(O*28|0)+(M<<2)>>2]|0,(O|0)>0){l=te+4|0,M=0;do Yl(l),M=M+1|0;while((M|0)!=(O|0));U=51}else U=51;else U=51;while(!1);return(U|0)==51&&(M=te+4|0,p[B>>2]=p[M>>2],p[B+4>>2]=p[M+4>>2],p[B+8>>2]=p[M+8>>2],M=0),te=M,Ie=Q,te|0}function Mc(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0;if(U=Ie,Ie=Ie+48|0,h=U+36|0,O=U+24|0,l=U+12|0,d=U,B=jt(y|0,m|0,52)|0,Me()|0,B=B&15,P=jt(y|0,m|0,45)|0,Me()|0,P=P&127,P>>>0>121)return w=5,Ie=U,w|0;if(g=wr(P)|0,Zt(B|0,0,52)|0,X=Me()|0|134225919,M=w,p[M>>2]=-1,p[M+4>>2]=X,!B)return B=hl(v)|0,(B|0)==7||(B=ua(P,B)|0,(B|0)==127)?(X=1,Ie=U,X|0):(R=Zt(B|0,0,45)|0,L=Me()|0,P=w,L=p[P+4>>2]&-1040385|L,X=w,p[X>>2]=p[P>>2]|R,p[X+4>>2]=L,X=0,Ie=U,X|0);for(p[h>>2]=p[v>>2],p[h+4>>2]=p[v+4>>2],p[h+8>>2]=p[v+8>>2],v=B;;){if(M=v,v=v+-1|0,p[O>>2]=p[h>>2],p[O+4>>2]=p[h+4>>2],p[O+8>>2]=p[h+8>>2],Fs(M)|0){if(B=GA(h)|0,B|0){v=13;break}p[l>>2]=p[h>>2],p[l+4>>2]=p[h+4>>2],p[l+8>>2]=p[h+8>>2],vc(l)}else{if(B=VA(h)|0,B|0){v=13;break}p[l>>2]=p[h>>2],p[l+4>>2]=p[h+4>>2],p[l+8>>2]=p[h+8>>2],zo(l)}if(ii(O,l,d),hi(d),B=w,Q=p[B>>2]|0,B=p[B+4>>2]|0,re=(15-M|0)*3|0,te=Zt(7,0,re|0)|0,B=B&~(Me()|0),re=Zt(hl(d)|0,0,re|0)|0,B=Me()|0|B,X=w,p[X>>2]=re|Q&~te,p[X+4>>2]=B,(M|0)<=1){v=14;break}}e:do if((v|0)!=13&&(v|0)==14)if((p[h>>2]|0)<=1&&(p[h+4>>2]|0)<=1&&(p[h+8>>2]|0)<=1){v=hl(h)|0,B=ua(P,v)|0,(B|0)==127?d=0:d=wr(B)|0;t:do if(v){if(g){if(B=Yi(y,m)|0,(B|0)==7){B=5;break e}if(M=p[21248+(B*28|0)+(v<<2)>>2]|0,(M|0)>0){B=v,v=0;do B=Ao(B)|0,v=v+1|0;while((v|0)!=(M|0))}else B=v;if((B|0)==1){B=9;break e}v=ua(P,B)|0,(v|0)==127&&Wt(23200,23090,411,23230),wr(v)|0?Wt(23245,23090,412,23230):(L=v,R=M,C=B)}else L=B,R=0,C=v;if(l=p[4272+(P*28|0)+(C<<2)>>2]|0,(l|0)<=-1&&Wt(23276,23090,419,23230),!d){if((R|0)<0){B=5;break e}if(R|0){M=w,B=0,v=p[M>>2]|0,M=p[M+4>>2]|0;do v=po(v,M)|0,M=Me()|0,re=w,p[re>>2]=v,p[re+4>>2]=M,B=B+1|0;while((B|0)<(R|0))}if((l|0)<=0){B=L,v=58;break}for(M=w,B=0,v=p[M>>2]|0,M=p[M+4>>2]|0;;)if(v=po(v,M)|0,M=Me()|0,re=w,p[re>>2]=v,p[re+4>>2]=M,B=B+1|0,(B|0)==(l|0)){B=L,v=58;break t}}if(O=ll(L,P)|0,(O|0)==7&&Wt(23066,23090,428,23230),B=w,v=p[B>>2]|0,B=p[B+4>>2]|0,(l|0)>0){M=0;do v=po(v,B)|0,B=Me()|0,re=w,p[re>>2]=v,p[re+4>>2]=B,M=M+1|0;while((M|0)!=(l|0))}if(B=Yi(v,B)|0,(B|0)==7&&Wt(23313,23090,440,23230),v=ni(L)|0,v=p[(v?21664:21456)+(O*28|0)+(B<<2)>>2]|0,(v|0)<0&&Wt(23313,23090,454,23230),!v)B=L,v=58;else{O=w,B=0,M=p[O>>2]|0,O=p[O+4>>2]|0;do M=_a(M,O)|0,O=Me()|0,re=w,p[re>>2]=M,p[re+4>>2]=O,B=B+1|0;while((B|0)<(v|0));B=L,v=58}}else if((g|0)!=0&(d|0)!=0){if(v=Yi(y,m)|0,M=w,M=Yi(p[M>>2]|0,p[M+4>>2]|0)|0,(v|0)==7|(M|0)==7){B=5;break e}if(M=p[21248+(v*28|0)+(M<<2)>>2]|0,(M|0)<0){B=5;break e}if(!M)v=59;else{l=w,v=0,O=p[l>>2]|0,l=p[l+4>>2]|0;do O=po(O,l)|0,l=Me()|0,re=w,p[re>>2]=O,p[re+4>>2]=l,v=v+1|0;while((v|0)<(M|0));v=58}}else v=58;while(!1);if((v|0)==58&&d&&(v=59),(v|0)==59&&(re=w,(Yi(p[re>>2]|0,p[re+4>>2]|0)|0)==1)){B=9;break}re=w,te=p[re>>2]|0,re=p[re+4>>2]&-1040385,Q=Zt(B|0,0,45)|0,re=re|(Me()|0),B=w,p[B>>2]=te|Q,p[B+4>>2]=re,B=0}else B=1;while(!1);return re=B,Ie=U,re|0}function Mh(y,m,v,w,B,M){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0;var O=0,l=0;return l=Ie,Ie=Ie+16|0,O=l,B?y=15:(y=Fn(y,m,v,w,O)|0,y||(da(O,M),y=0)),Ie=l,y|0}function mi(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0;return O=Ie,Ie=Ie+16|0,M=O,w?v=15:(v=Aa(v,M)|0,v||(v=Mc(y,m,M,B)|0)),Ie=O,v|0}function nr(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0;return d=Ie,Ie=Ie+32|0,O=d+12|0,l=d,M=Fn(y,m,y,m,O)|0,M|0?(l=M,Ie=d,l|0):(y=Fn(y,m,v,w,l)|0,y|0?(l=y,Ie=d,l|0):(O=dl(O,l)|0,l=B,p[l>>2]=O,p[l+4>>2]=((O|0)<0)<<31>>31,l=0,Ie=d,l|0))}function vs(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0;return d=Ie,Ie=Ie+32|0,O=d+12|0,l=d,M=Fn(y,m,y,m,O)|0,!M&&(M=Fn(y,m,v,w,l)|0,!M)?(w=dl(O,l)|0,w=cn(w|0,((w|0)<0)<<31>>31|0,1,0)|0,O=Me()|0,l=B,p[l>>2]=w,p[l+4>>2]=O,l=0,Ie=d,l|0):(l=M,Ie=d,l|0)}function cu(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0,Fe=0;if(me=Ie,Ie=Ie+48|0,O=me+24|0,l=me+12|0,Oe=me,M=Fn(y,m,y,m,O)|0,!M&&(M=Fn(y,m,v,w,l)|0,!M)){oe=dl(O,l)|0,Ee=((oe|0)<0)<<31>>31,p[O>>2]=0,p[O+4>>2]=0,p[O+8>>2]=0,p[l>>2]=0,p[l+4>>2]=0,p[l+8>>2]=0,Fn(y,m,y,m,O)|0&&Wt(23313,23090,691,23299),Fn(y,m,v,w,l)|0&&Wt(23313,23090,696,23299),pa(O),pa(l),oe?(C=p[O>>2]|0,L=+(oe|0),te=O+4|0,P=p[te>>2]|0,Q=O+8|0,R=p[Q>>2]|0,re=O,w=C,M=P,v=R,U=+((p[l>>2]|0)-C|0)/L,X=+((p[l+4>>2]|0)-P|0)/L,L=+((p[l+8>>2]|0)-R|0)/L):(M=O+4|0,v=O+8|0,te=M,Q=v,re=O,w=p[O>>2]|0,M=p[M>>2]|0,v=p[v>>2]|0,U=0,X=0,L=0),p[Oe>>2]=w,R=Oe+4|0,p[R>>2]=M,P=Oe+8|0,p[P>>2]=v;e:do if((oe|0)<0)M=0;else for(g=0,C=0,M=w;;){h=+(C>>>0)+4294967296*+(g|0),Fe=U*h+ +(M|0),d=X*h+ +(p[te>>2]|0),h=L*h+ +(p[Q>>2]|0),v=~~+Ko(+Fe),O=~~+Ko(+d),M=~~+Ko(+h),Fe=+It(+(+(v|0)-Fe)),d=+It(+(+(O|0)-d)),h=+It(+(+(M|0)-h));do if(Fe>d&Fe>h)v=0-(O+M)|0,w=O;else if(l=0-v|0,d>h){w=l-M|0;break}else{w=O,M=l-O|0;break}while(!1);if(p[Oe>>2]=v,p[R>>2]=w,p[P>>2]=M,La(Oe),M=Mc(y,m,Oe,B+(C<<3)|0)|0,M|0)break e;if(!((g|0)<(Ee|0)|(g|0)==(Ee|0)&C>>>0<oe>>>0)){M=0;break e}M=cn(C|0,g|0,1,0)|0,l=Me()|0,g=l,C=M,M=p[re>>2]|0}while(!1);return Oe=M,Ie=me,Oe|0}return Oe=M,Ie=me,Oe|0}function Ls(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0;if((v|0)==0&(w|0)==0)return B=0,M=1,fr(B|0),M|0;M=y,B=m,y=1,m=0;do O=(v&1|0)==0&!0,y=si((O?1:M)|0,(O?0:B)|0,y|0,m|0)|0,m=Me()|0,v=_o(v|0,w|0,1)|0,w=Me()|0,M=si(M|0,B|0,M|0,B|0)|0,B=Me()|0;while(!((v|0)==0&(w|0)==0));return fr(m|0),y|0}function Ys(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0;if(!(Rs(m,v)|0)||(m=fl(m)|0,w=+le[v>>3],B=+le[v+8>>3],B=m&B<0?B+6.283185307179586:B,P=p[y>>2]|0,(P|0)<=0))return P=0,P|0;if(C=p[y+4>>2]|0,m){m=0,g=B,v=-1,y=0;e:for(;;){for(h=y;O=+le[C+(h<<4)>>3],B=+le[C+(h<<4)+8>>3],y=(v+2|0)%(P|0)|0,M=+le[C+(y<<4)>>3],l=+le[C+(y<<4)+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=h+1|0,(v|0)>=(P|0)){v=22;break e}else y=h,h=v,v=y;if(l=O<0?O+6.283185307179586:O,O=B<0?B+6.283185307179586:B,g=l==g|O==g?g+-2220446049250313e-31:g,d=l+(O-l)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>g&&(m=m^1),y=h+1|0,(y|0)>=(P|0)){v=22;break}else v=h}if((v|0)==22)return m|0}else{m=0,g=B,v=-1,y=0;e:for(;;){for(h=y;O=+le[C+(h<<4)>>3],B=+le[C+(h<<4)+8>>3],y=(v+2|0)%(P|0)|0,M=+le[C+(y<<4)>>3],l=+le[C+(y<<4)+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=B,B=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=h+1|0,(v|0)>=(P|0)){v=22;break e}else y=h,h=v,v=y;if(g=O==g|B==g?g+-2220446049250313e-31:g,O+(B-O)*((w-M)/(d-M))>g&&(m=m^1),y=h+1|0,(y|0)>=(P|0)){v=22;break}else v=h}if((v|0)==22)return m|0}return 0}function fs(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0;if(L=p[y>>2]|0,!L){p[m>>2]=0,p[m+4>>2]=0,p[m+8>>2]=0,p[m+12>>2]=0,p[m+16>>2]=0,p[m+20>>2]=0,p[m+24>>2]=0,p[m+28>>2]=0;return}if(U=m+8|0,le[U>>3]=17976931348623157e292,X=m+24|0,le[X>>3]=17976931348623157e292,le[m>>3]=-17976931348623157e292,te=m+16|0,le[te>>3]=-17976931348623157e292,!((L|0)<=0)){for(P=p[y+4>>2]|0,h=17976931348623157e292,g=-17976931348623157e292,C=0,y=-1,M=17976931348623157e292,O=17976931348623157e292,d=-17976931348623157e292,w=-17976931348623157e292,R=0;v=+le[P+(R<<4)>>3],l=+le[P+(R<<4)+8>>3],y=y+2|0,B=+le[P+(((y|0)==(L|0)?0:y)<<4)+8>>3],v<M&&(le[U>>3]=v,M=v),l<O&&(le[X>>3]=l,O=l),v>d?le[m>>3]=v:v=d,l>w&&(le[te>>3]=l,w=l),h=l>0&l<h?l:h,g=l<0&l>g?l:g,C=C|+It(+(l-B))>3.141592653589793,y=R+1|0,(y|0)!=(L|0);)Q=R,d=v,R=y,y=Q;C&&(le[te>>3]=g,le[X>>3]=h)}}function hf(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0,Oe=0,me=0;if(L=p[y>>2]|0,L){if(U=m+8|0,le[U>>3]=17976931348623157e292,X=m+24|0,le[X>>3]=17976931348623157e292,le[m>>3]=-17976931348623157e292,te=m+16|0,le[te>>3]=-17976931348623157e292,(L|0)>0){for(B=p[y+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,w=0,v=-1,d=17976931348623157e292,h=17976931348623157e292,C=-17976931348623157e292,O=-17976931348623157e292,Q=0;M=+le[B+(Q<<4)>>3],g=+le[B+(Q<<4)+8>>3],Oe=v+2|0,l=+le[B+(((Oe|0)==(L|0)?0:Oe)<<4)+8>>3],M<d&&(le[U>>3]=M,d=M),g<h&&(le[X>>3]=g,h=g),M>C?le[m>>3]=M:M=C,g>O&&(le[te>>3]=g,O=g),P=g>0&g<P?g:P,R=g<0&g>R?g:R,w=w|+It(+(g-l))>3.141592653589793,v=Q+1|0,(v|0)!=(L|0);)Oe=Q,C=M,Q=v,v=Oe;w&&(le[te>>3]=R,le[X>>3]=P)}}else p[m>>2]=0,p[m+4>>2]=0,p[m+8>>2]=0,p[m+12>>2]=0,p[m+16>>2]=0,p[m+20>>2]=0,p[m+24>>2]=0,p[m+28>>2]=0;if(Oe=y+8|0,v=p[Oe>>2]|0,!((v|0)<=0)){Ee=y+12|0,oe=0;do if(B=p[Ee>>2]|0,w=oe,oe=oe+1|0,X=m+(oe<<5)|0,te=p[B+(w<<3)>>2]|0,te){if(Q=m+(oe<<5)+8|0,le[Q>>3]=17976931348623157e292,y=m+(oe<<5)+24|0,le[y>>3]=17976931348623157e292,le[X>>3]=-17976931348623157e292,re=m+(oe<<5)+16|0,le[re>>3]=-17976931348623157e292,(te|0)>0){for(L=p[B+(w<<3)+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,B=0,w=-1,U=0,d=17976931348623157e292,h=17976931348623157e292,g=-17976931348623157e292,O=-17976931348623157e292;M=+le[L+(U<<4)>>3],C=+le[L+(U<<4)+8>>3],w=w+2|0,l=+le[L+(((w|0)==(te|0)?0:w)<<4)+8>>3],M<d&&(le[Q>>3]=M,d=M),C<h&&(le[y>>3]=C,h=C),M>g?le[X>>3]=M:M=g,C>O&&(le[re>>3]=C,O=C),P=C>0&C<P?C:P,R=C<0&C>R?C:R,B=B|+It(+(C-l))>3.141592653589793,w=U+1|0,(w|0)!=(te|0);)me=U,U=w,g=M,w=me;B&&(le[re>>3]=R,le[y>>3]=P)}}else p[X>>2]=0,p[X+4>>2]=0,p[X+8>>2]=0,p[X+12>>2]=0,p[X+16>>2]=0,p[X+20>>2]=0,p[X+24>>2]=0,p[X+28>>2]=0,v=p[Oe>>2]|0;while((oe|0)<(v|0))}}function Kt(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(!(Ys(y,m,v)|0))return B=0,B|0;if(B=y+8|0,(p[B>>2]|0)<=0)return B=1,B|0;for(w=y+12|0,y=0;;){if(M=y,y=y+1|0,Ys((p[w>>2]|0)+(M<<3)|0,m+(y<<5)|0,v)|0){y=0,w=6;break}if((y|0)>=(p[B>>2]|0)){y=1,w=6;break}}return(w|0)==6?y|0:0}function df(){return 8}function lu(){return 16}function Af(){return 168}function qs(){return 8}function bs(){return 16}function uu(){return 12}function fu(){return 8}function xs(y){return y=y|0,+(+((p[y>>2]|0)>>>0)+4294967296*+(p[y+4>>2]|0))}function Jo(y){y=y|0;var m=0,v=0;return v=+le[y>>3],m=+le[y+8>>3],+ +Ft(+(v*v+m*m))}function pf(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0;h=+le[y>>3],d=+le[m>>3]-h,l=+le[y+8>>3],O=+le[m+8>>3]-l,C=+le[v>>3],M=+le[w>>3]-C,P=+le[v+8>>3],g=+le[w+8>>3]-P,M=(M*(l-P)-(h-C)*g)/(d*g-O*M),le[B>>3]=h+d*M,le[B+8>>3]=l+O*M}function Pc(y,m){return y=y|0,m=m|0,+It(+(+le[y>>3]-+le[m>>3]))<11920928955078125e-23?(m=+It(+(+le[y+8>>3]-+le[m+8>>3]))<11920928955078125e-23,m|0):(m=0,m|0)}function _i(y,m){y=y|0,m=m|0;var v=0,w=0,B=0;return B=+le[y>>3]-+le[m>>3],w=+le[y+8>>3]-+le[m+8>>3],v=+le[y+16>>3]-+le[m+16>>3],+(B*B+w*w+v*v)}function gf(y,m){y=y|0,m=m|0;var v=0,w=0,B=0;v=+le[y>>3],w=+Ot(+v),v=+St(+v),le[m+16>>3]=v,v=+le[y+8>>3],B=w*+Ot(+v),le[m>>3]=B,v=w*+St(+v),le[m+8>>3]=v}function go(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(M=Ie,Ie=Ie+16|0,B=M,w=Sn(y,m)|0,(v+-1|0)>>>0>5||(w=(w|0)!=0,(v|0)==1&w))return B=-1,Ie=M,B|0;do if(qi(y,m,B)|0)w=-1;else if(w){w=((p[21936+(v<<2)>>2]|0)+5-(p[B>>2]|0)|0)%5|0;break}else{w=((p[21968+(v<<2)>>2]|0)+6-(p[B>>2]|0)|0)%6|0;break}while(!1);return B=w,Ie=M,B|0}function qi(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0,h=0;if(h=Ie,Ie=Ie+32|0,O=h+16|0,l=h,w=Va(y,m,O)|0,w|0)return v=w,Ie=h,v|0;M=lf(y,m)|0,d=Yi(y,m)|0,Js(M,l),w=yh(M,p[O>>2]|0)|0;e:do if(wr(M)|0){do switch(M|0){case 4:{y=0;break}case 14:{y=1;break}case 24:{y=2;break}case 38:{y=3;break}case 49:{y=4;break}case 58:{y=5;break}case 63:{y=6;break}case 72:{y=7;break}case 83:{y=8;break}case 97:{y=9;break}case 107:{y=10;break}case 117:{y=11;break}default:{w=1;break e}}while(!1);if(B=p[22e3+(y*24|0)+8>>2]|0,m=p[22e3+(y*24|0)+16>>2]|0,y=p[O>>2]|0,(y|0)!=(p[l>>2]|0)&&(l=ni(M)|0,y=p[O>>2]|0,l|(y|0)==(m|0)&&(w=(w+1|0)%6|0)),(d|0)==3&(y|0)==(m|0)){w=(w+5|0)%6|0,B=22;break}(d|0)==5&(y|0)==(B|0)&&(w=(w+1|0)%6|0),B=22}else B=22;while(!1);return(B|0)==22&&(p[v>>2]=w,w=0),v=w,Ie=h,v|0}function kr(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0;if(re=Ie,Ie=Ie+32|0,Q=re+24|0,X=re+20|0,L=re+8|0,R=re+16|0,P=re,d=(Sn(y,m)|0)==0,d=d?6:5,g=jt(y|0,m|0,52)|0,Me()|0,g=g&15,d>>>0<=v>>>0)return w=2,Ie=re,w|0;C=(g|0)==0,!C&&(U=Zt(7,0,(g^15)*3|0)|0,(U&y|0)==0&((Me()|0)&m|0)==0)?B=v:M=4;e:do if((M|0)==4){if(B=(Sn(y,m)|0)!=0,((B?4:5)|0)<(v|0)||qi(y,m,Q)|0||(M=(p[Q>>2]|0)+v|0,B?B=22288+(((M|0)%5|0)<<2)|0:B=22320+(((M|0)%6|0)<<2)|0,U=p[B>>2]|0,(U|0)==7))return w=1,Ie=re,w|0;p[X>>2]=0,B=wn(y,m,U,X,L)|0;do if(!B){if(l=L,h=p[l>>2]|0,l=p[l+4>>2]|0,O=l>>>0<m>>>0|(l|0)==(m|0)&h>>>0<y>>>0,M=O?h:y,O=O?l:m,!C&&(C=Zt(7,0,(g^15)*3|0)|0,(h&C|0)==0&(l&(Me()|0)|0)==0))B=v;else{if(l=(v+-1+d|0)%(d|0)|0,B=Sn(y,m)|0,(l|0)<0&&Wt(23313,23315,245,23324),d=(B|0)!=0,((d?4:5)|0)<(l|0)&&Wt(23313,23315,245,23324),qi(y,m,Q)|0&&Wt(23313,23315,245,23324),B=(p[Q>>2]|0)+l|0,d?B=22288+(((B|0)%5|0)<<2)|0:B=22320+(((B|0)%6|0)<<2)|0,l=p[B>>2]|0,(l|0)==7&&Wt(23313,23315,245,23324),p[R>>2]=0,B=wn(y,m,l,R,P)|0,B|0)break;h=P,d=p[h>>2]|0,h=p[h+4>>2]|0;do if(h>>>0<O>>>0|(h|0)==(O|0)&d>>>0<M>>>0){if(Sn(d,h)|0?M=cl(d,h,y,m)|0:M=p[22384+((((p[R>>2]|0)+(p[22352+(l<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,B=Sn(d,h)|0,(M+-1|0)>>>0>5){B=-1,M=d,O=h;break}if(B=(B|0)!=0,(M|0)==1&B){B=-1,M=d,O=h;break}do if(qi(d,h,Q)|0)B=-1;else if(B){B=((p[21936+(M<<2)>>2]|0)+5-(p[Q>>2]|0)|0)%5|0;break}else{B=((p[21968+(M<<2)>>2]|0)+6-(p[Q>>2]|0)|0)%6|0;break}while(!1);M=d,O=h}else B=v;while(!1);l=L,h=p[l>>2]|0,l=p[l+4>>2]|0}if((M|0)==(h|0)&(O|0)==(l|0)){if(d=(Sn(h,l)|0)!=0,d?y=cl(h,l,y,m)|0:y=p[22384+((((p[X>>2]|0)+(p[22352+(U<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,B=Sn(h,l)|0,(y+-1|0)>>>0<=5&&(te=(B|0)!=0,!((y|0)==1&te)))do if(qi(h,l,Q)|0)B=-1;else if(te){B=((p[21936+(y<<2)>>2]|0)+5-(p[Q>>2]|0)|0)%5|0;break}else{B=((p[21968+(y<<2)>>2]|0)+6-(p[Q>>2]|0)|0)%6|0;break}while(!1);else B=-1;B=B+1|0,B=(B|0)==6|d&(B|0)==5?0:B}m=O,y=M;break e}while(!1);return w=B,Ie=re,w|0}while(!1);return te=Zt(B|0,0,56)|0,Q=Me()|0|m&-2130706433|536870912,p[w>>2]=te|y,p[w+4>>2]=Q,w=0,Ie=re,w|0}function Eo(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;return M=(Sn(y,m)|0)==0,w=kr(y,m,0,v)|0,B=(w|0)==0,M?!B||(w=kr(y,m,1,v+8|0)|0,w|0)||(w=kr(y,m,2,v+16|0)|0,w|0)||(w=kr(y,m,3,v+24|0)|0,w|0)||(w=kr(y,m,4,v+32|0)|0,w)?(M=w,M|0):kr(y,m,5,v+40|0)|0:!B||(w=kr(y,m,1,v+8|0)|0,w|0)||(w=kr(y,m,2,v+16|0)|0,w|0)||(w=kr(y,m,3,v+24|0)|0,w|0)||(w=kr(y,m,4,v+32|0)|0,w|0)?(M=w,M|0):(M=v+40|0,p[M>>2]=0,p[M+4>>2]=0,M=0,M|0)}function Zs(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0,l=0,d=0;return d=Ie,Ie=Ie+192|0,B=d,M=d+168|0,O=jt(y|0,m|0,56)|0,Me()|0,O=O&7,l=m&-2130706433|134217728,w=Va(y,l,M)|0,w|0?(l=w,Ie=d,l|0):(m=jt(y|0,m|0,52)|0,Me()|0,m=m&15,Sn(y,l)|0?Go(M,m,O,1,B):Ql(M,m,O,1,B),l=B+8|0,p[v>>2]=p[l>>2],p[v+4>>2]=p[l+4>>2],p[v+8>>2]=p[l+8>>2],p[v+12>>2]=p[l+12>>2],l=0,Ie=d,l|0)}function Vi(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0;return B=Ie,Ie=Ie+16|0,v=B,!(!0&(m&2013265920|0)==536870912)||(w=m&-2130706433|134217728,!(Ho(y,w)|0))?(w=0,Ie=B,w|0):(M=jt(y|0,m|0,56)|0,Me()|0,M=(kr(y,w,M&7,v)|0)==0,w=v,w=M&((p[w>>2]|0)==(y|0)?(p[w+4>>2]|0)==(m|0):0)&1,Ie=B,w|0)}function ya(y,m,v){y=y|0,m=m|0,v=v|0;var w=0;(m|0)>0?(w=eo(m,4)|0,p[y>>2]=w,w||Wt(23337,23360,40,23374)):p[y>>2]=0,p[y+4>>2]=m,p[y+8>>2]=0,p[y+12>>2]=v}function Xo(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0;B=y+4|0,M=y+12|0,O=y+8|0;e:for(;;){for(v=p[B>>2]|0,m=0;;){if((m|0)>=(v|0))break e;if(w=p[y>>2]|0,l=p[w+(m<<2)>>2]|0,!l)m=m+1|0;else break}m=w+(~~(+It(+(+ut(10,+ +(15-(p[M>>2]|0)|0))*(+le[l>>3]+ +le[l+8>>3])))%+(v|0))>>>0<<2)|0,v=p[m>>2]|0;t:do if(v|0){if(w=l+32|0,(v|0)==(l|0))p[m>>2]=p[w>>2];else{if(v=v+32|0,m=p[v>>2]|0,!m)break;for(;(m|0)!=(l|0);)if(v=m+32|0,m=p[v>>2]|0,!m)break t;p[v>>2]=p[w>>2]}Or(l),p[O>>2]=(p[O>>2]|0)+-1}while(!1)}Or(p[y>>2]|0)}function Qs(y){y=y|0;var m=0,v=0,w=0;for(w=p[y+4>>2]|0,v=0;;){if((v|0)>=(w|0)){m=0,v=4;break}if(m=p[(p[y>>2]|0)+(v<<2)>>2]|0,!m)v=v+1|0;else{v=4;break}}return(v|0)==4?m|0:0}function Zi(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0;if(v=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[m>>3]+ +le[m+8>>3])))%+(p[y+4>>2]|0))>>>0,v=(p[y>>2]|0)+(v<<2)|0,w=p[v>>2]|0,!w)return M=1,M|0;M=m+32|0;do if((w|0)!=(m|0)){if(v=p[w+32>>2]|0,!v)return M=1,M|0;for(B=v;;){if((B|0)==(m|0)){B=8;break}if(v=p[B+32>>2]|0,v)w=B,B=v;else{v=1,B=10;break}}if((B|0)==8){p[w+32>>2]=p[M>>2];break}else if((B|0)==10)return v|0}else p[v>>2]=p[M>>2];while(!1);return Or(m),M=y+8|0,p[M>>2]=(p[M>>2]|0)+-1,M=0,M|0}function bl(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0;M=Vn(40)|0,M||Wt(23390,23360,98,23403),p[M>>2]=p[m>>2],p[M+4>>2]=p[m+4>>2],p[M+8>>2]=p[m+8>>2],p[M+12>>2]=p[m+12>>2],B=M+16|0,p[B>>2]=p[v>>2],p[B+4>>2]=p[v+4>>2],p[B+8>>2]=p[v+8>>2],p[B+12>>2]=p[v+12>>2],p[M+32>>2]=0,B=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[m>>3]+ +le[m+8>>3])))%+(p[y+4>>2]|0))>>>0,B=(p[y>>2]|0)+(B<<2)|0,w=p[B>>2]|0;do if(!w)p[B>>2]=M;else{for(;!(ja(w,m)|0&&ja(w+16|0,v)|0);)if(B=p[w+32>>2]|0,w=(B|0)==0?w:B,!(p[w+32>>2]|0)){O=10;break}if((O|0)==10){p[w+32>>2]=M;break}return Or(M),O=w,O|0}while(!1);return O=y+8|0,p[O>>2]=(p[O>>2]|0)+1,O=M,O|0}function _r(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0;if(B=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[m>>3]+ +le[m+8>>3])))%+(p[y+4>>2]|0))>>>0,B=p[(p[y>>2]|0)+(B<<2)>>2]|0,!B)return v=0,v|0;if(!v){for(y=B;;){if(ja(y,m)|0){w=10;break}if(y=p[y+32>>2]|0,!y){y=0,w=10;break}}if((w|0)==10)return y|0}for(y=B;;){if(ja(y,m)|0&&ja(y+16|0,v)|0){w=10;break}if(y=p[y+32>>2]|0,!y){y=0,w=10;break}}return(w|0)==10?y|0:0}function or(y,m){y=y|0,m=m|0;var v=0;if(v=~~(+It(+(+ut(10,+ +(15-(p[y+12>>2]|0)|0))*(+le[m>>3]+ +le[m+8>>3])))%+(p[y+4>>2]|0))>>>0,y=p[(p[y>>2]|0)+(v<<2)>>2]|0,!y)return v=0,v|0;for(;;){if(ja(y,m)|0){m=5;break}if(y=p[y+32>>2]|0,!y){y=0,m=5;break}}return(m|0)==5?y|0:0}function hu(){return 23424}function is(y){return y=+y,+ +qo(+y)}function Hi(y){return y=+y,~~+is(y)|0}function Vn(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0,U=0,X=0,te=0,Q=0,re=0,oe=0,Ee=0;Ee=Ie,Ie=Ie+16|0,P=Ee;do if(y>>>0<245){if(h=y>>>0<11?16:y+11&-8,y=h>>>3,C=p[5857]|0,v=C>>>y,v&3|0)return m=(v&1^1)+y|0,y=23468+(m<<1<<2)|0,v=y+8|0,w=p[v>>2]|0,B=w+8|0,M=p[B>>2]|0,(M|0)==(y|0)?p[5857]=C&~(1<<m):(p[M+12>>2]=y,p[v>>2]=M),oe=m<<3,p[w+4>>2]=oe|3,oe=w+oe+4|0,p[oe>>2]=p[oe>>2]|1,oe=B,Ie=Ee,oe|0;if(g=p[5859]|0,h>>>0>g>>>0){if(v|0)return m=2<<y,m=v<<y&(m|0-m),m=(m&0-m)+-1|0,l=m>>>12&16,m=m>>>l,v=m>>>5&8,m=m>>>v,M=m>>>2&4,m=m>>>M,y=m>>>1&2,m=m>>>y,w=m>>>1&1,w=(v|l|M|y|w)+(m>>>w)|0,m=23468+(w<<1<<2)|0,y=m+8|0,M=p[y>>2]|0,l=M+8|0,v=p[l>>2]|0,(v|0)==(m|0)?(y=C&~(1<<w),p[5857]=y):(p[v+12>>2]=m,p[y>>2]=v,y=C),oe=w<<3,O=oe-h|0,p[M+4>>2]=h|3,B=M+h|0,p[B+4>>2]=O|1,p[M+oe>>2]=O,g|0&&(w=p[5862]|0,m=g>>>3,v=23468+(m<<1<<2)|0,m=1<<m,y&m?(y=v+8|0,m=p[y>>2]|0):(p[5857]=y|m,m=v,y=v+8|0),p[y>>2]=w,p[m+12>>2]=w,p[w+8>>2]=m,p[w+12>>2]=v),p[5859]=O,p[5862]=B,oe=l,Ie=Ee,oe|0;if(M=p[5858]|0,M){for(v=(M&0-M)+-1|0,B=v>>>12&16,v=v>>>B,w=v>>>5&8,v=v>>>w,O=v>>>2&4,v=v>>>O,l=v>>>1&2,v=v>>>l,d=v>>>1&1,d=p[23732+((w|B|O|l|d)+(v>>>d)<<2)>>2]|0,v=d,l=d,d=(p[d+4>>2]&-8)-h|0;y=p[v+16>>2]|0,!(!y&&(y=p[v+20>>2]|0,!y));)O=(p[y+4>>2]&-8)-h|0,B=O>>>0<d>>>0,v=y,l=B?y:l,d=B?O:d;if(O=l+h|0,O>>>0>l>>>0){B=p[l+24>>2]|0,m=p[l+12>>2]|0;do if((m|0)==(l|0)){if(y=l+20|0,m=p[y>>2]|0,!m&&(y=l+16|0,m=p[y>>2]|0,!m)){v=0;break}for(;;)if(w=m+20|0,v=p[w>>2]|0,v)m=v,y=w;else if(w=m+16|0,v=p[w>>2]|0,v)m=v,y=w;else break;p[y>>2]=0,v=m}else v=p[l+8>>2]|0,p[v+12>>2]=m,p[m+8>>2]=v,v=m;while(!1);do if(B|0){if(m=p[l+28>>2]|0,y=23732+(m<<2)|0,(l|0)==(p[y>>2]|0)){if(p[y>>2]=v,!v){p[5858]=M&~(1<<m);break}}else if(oe=B+16|0,p[((p[oe>>2]|0)==(l|0)?oe:B+20|0)>>2]=v,!v)break;p[v+24>>2]=B,m=p[l+16>>2]|0,m|0&&(p[v+16>>2]=m,p[m+24>>2]=v),m=p[l+20>>2]|0,m|0&&(p[v+20>>2]=m,p[m+24>>2]=v)}while(!1);return d>>>0<16?(oe=d+h|0,p[l+4>>2]=oe|3,oe=l+oe+4|0,p[oe>>2]=p[oe>>2]|1):(p[l+4>>2]=h|3,p[O+4>>2]=d|1,p[O+d>>2]=d,g|0&&(w=p[5862]|0,m=g>>>3,v=23468+(m<<1<<2)|0,m=1<<m,m&C?(y=v+8|0,m=p[y>>2]|0):(p[5857]=m|C,m=v,y=v+8|0),p[y>>2]=w,p[m+12>>2]=w,p[w+8>>2]=m,p[w+12>>2]=v),p[5859]=d,p[5862]=O),oe=l+8|0,Ie=Ee,oe|0}else C=h}else C=h}else C=h}else if(y>>>0<=4294967231)if(y=y+11|0,h=y&-8,w=p[5858]|0,w){B=0-h|0,y=y>>>8,y?h>>>0>16777215?d=31:(C=(y+1048320|0)>>>16&8,U=y<<C,l=(U+520192|0)>>>16&4,U=U<<l,d=(U+245760|0)>>>16&2,d=14-(l|C|d)+(U<<d>>>15)|0,d=h>>>(d+7|0)&1|d<<1):d=0,v=p[23732+(d<<2)>>2]|0;e:do if(!v)v=0,y=0,U=61;else for(y=0,l=h<<((d|0)==31?0:25-(d>>>1)|0),M=0;;){if(O=(p[v+4>>2]&-8)-h|0,O>>>0<B>>>0)if(O)y=v,B=O;else{y=v,B=0,U=65;break e}if(U=p[v+20>>2]|0,v=p[v+16+(l>>>31<<2)>>2]|0,M=(U|0)==0|(U|0)==(v|0)?M:U,v)l=l<<1;else{v=M,U=61;break}}while(!1);if((U|0)==61){if((v|0)==0&(y|0)==0){if(y=2<<d,y=(y|0-y)&w,!y){C=h;break}C=(y&0-y)+-1|0,O=C>>>12&16,C=C>>>O,M=C>>>5&8,C=C>>>M,l=C>>>2&4,C=C>>>l,d=C>>>1&2,C=C>>>d,v=C>>>1&1,y=0,v=p[23732+((M|O|l|d|v)+(C>>>v)<<2)>>2]|0}v?U=65:(l=y,O=B)}if((U|0)==65)for(M=v;;)if(C=(p[M+4>>2]&-8)-h|0,v=C>>>0<B>>>0,B=v?C:B,y=v?M:y,v=p[M+16>>2]|0,v||(v=p[M+20>>2]|0),v)M=v;else{l=y,O=B;break}if((l|0)!=0&&O>>>0<((p[5859]|0)-h|0)>>>0&&(g=l+h|0,g>>>0>l>>>0)){M=p[l+24>>2]|0,m=p[l+12>>2]|0;do if((m|0)==(l|0)){if(y=l+20|0,m=p[y>>2]|0,!m&&(y=l+16|0,m=p[y>>2]|0,!m)){m=0;break}for(;;)if(B=m+20|0,v=p[B>>2]|0,v)m=v,y=B;else if(B=m+16|0,v=p[B>>2]|0,v)m=v,y=B;else break;p[y>>2]=0}else oe=p[l+8>>2]|0,p[oe+12>>2]=m,p[m+8>>2]=oe;while(!1);do if(M){if(y=p[l+28>>2]|0,v=23732+(y<<2)|0,(l|0)==(p[v>>2]|0)){if(p[v>>2]=m,!m){w=w&~(1<<y),p[5858]=w;break}}else if(oe=M+16|0,p[((p[oe>>2]|0)==(l|0)?oe:M+20|0)>>2]=m,!m)break;p[m+24>>2]=M,y=p[l+16>>2]|0,y|0&&(p[m+16>>2]=y,p[y+24>>2]=m),y=p[l+20>>2]|0,y&&(p[m+20>>2]=y,p[y+24>>2]=m)}while(!1);e:do if(O>>>0<16)oe=O+h|0,p[l+4>>2]=oe|3,oe=l+oe+4|0,p[oe>>2]=p[oe>>2]|1;else{if(p[l+4>>2]=h|3,p[g+4>>2]=O|1,p[g+O>>2]=O,m=O>>>3,O>>>0<256){v=23468+(m<<1<<2)|0,y=p[5857]|0,m=1<<m,y&m?(y=v+8|0,m=p[y>>2]|0):(p[5857]=y|m,m=v,y=v+8|0),p[y>>2]=g,p[m+12>>2]=g,p[g+8>>2]=m,p[g+12>>2]=v;break}if(m=O>>>8,m?O>>>0>16777215?v=31:(re=(m+1048320|0)>>>16&8,oe=m<<re,Q=(oe+520192|0)>>>16&4,oe=oe<<Q,v=(oe+245760|0)>>>16&2,v=14-(Q|re|v)+(oe<<v>>>15)|0,v=O>>>(v+7|0)&1|v<<1):v=0,m=23732+(v<<2)|0,p[g+28>>2]=v,y=g+16|0,p[y+4>>2]=0,p[y>>2]=0,y=1<<v,!(w&y)){p[5858]=w|y,p[m>>2]=g,p[g+24>>2]=m,p[g+12>>2]=g,p[g+8>>2]=g;break}m=p[m>>2]|0;t:do if((p[m+4>>2]&-8|0)!=(O|0)){for(w=O<<((v|0)==31?0:25-(v>>>1)|0);v=m+16+(w>>>31<<2)|0,y=p[v>>2]|0,!!y;)if((p[y+4>>2]&-8|0)==(O|0)){m=y;break t}else w=w<<1,m=y;p[v>>2]=g,p[g+24>>2]=m,p[g+12>>2]=g,p[g+8>>2]=g;break e}while(!1);re=m+8|0,oe=p[re>>2]|0,p[oe+12>>2]=g,p[re>>2]=g,p[g+8>>2]=oe,p[g+12>>2]=m,p[g+24>>2]=0}while(!1);return oe=l+8|0,Ie=Ee,oe|0}else C=h}else C=h;else C=-1;while(!1);if(v=p[5859]|0,v>>>0>=C>>>0)return m=v-C|0,y=p[5862]|0,m>>>0>15?(oe=y+C|0,p[5862]=oe,p[5859]=m,p[oe+4>>2]=m|1,p[y+v>>2]=m,p[y+4>>2]=C|3):(p[5859]=0,p[5862]=0,p[y+4>>2]=v|3,oe=y+v+4|0,p[oe>>2]=p[oe>>2]|1),oe=y+8|0,Ie=Ee,oe|0;if(O=p[5860]|0,O>>>0>C>>>0)return Q=O-C|0,p[5860]=Q,oe=p[5863]|0,re=oe+C|0,p[5863]=re,p[re+4>>2]=Q|1,p[oe+4>>2]=C|3,oe=oe+8|0,Ie=Ee,oe|0;if(p[5975]|0?y=p[5977]|0:(p[5977]=4096,p[5976]=4096,p[5978]=-1,p[5979]=-1,p[5980]=0,p[5968]=0,p[5975]=P&-16^1431655768,y=4096),l=C+48|0,d=C+47|0,M=y+d|0,B=0-y|0,h=M&B,h>>>0<=C>>>0||(y=p[5967]|0,y|0&&(g=p[5965]|0,P=g+h|0,P>>>0<=g>>>0|P>>>0>y>>>0)))return oe=0,Ie=Ee,oe|0;e:do if(p[5968]&4)m=0,U=143;else{v=p[5863]|0;t:do if(v){for(w=23876;P=p[w>>2]|0,!(P>>>0<=v>>>0&&(P+(p[w+4>>2]|0)|0)>>>0>v>>>0);)if(y=p[w+8>>2]|0,y)w=y;else{U=128;break t}if(m=M-O&B,m>>>0<2147483647)if(y=hs(m|0)|0,(y|0)==((p[w>>2]|0)+(p[w+4>>2]|0)|0)){if((y|0)!=-1){O=m,M=y,U=145;break e}}else w=y,U=136;else m=0}else U=128;while(!1);do if((U|0)==128)if(v=hs(0)|0,(v|0)!=-1&&(m=v,R=p[5976]|0,L=R+-1|0,m=((L&m|0)==0?0:(L+m&0-R)-m|0)+h|0,R=p[5965]|0,L=m+R|0,m>>>0>C>>>0&m>>>0<2147483647)){if(P=p[5967]|0,P|0&&L>>>0<=R>>>0|L>>>0>P>>>0){m=0;break}if(y=hs(m|0)|0,(y|0)==(v|0)){O=m,M=v,U=145;break e}else w=y,U=136}else m=0;while(!1);do if((U|0)==136){if(v=0-m|0,!(l>>>0>m>>>0&(m>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){m=0;break}else{O=m,M=w,U=145;break e}if(y=p[5977]|0,y=d-m+y&0-y,y>>>0>=2147483647){O=m,M=w,U=145;break e}if((hs(y|0)|0)==-1){hs(v|0)|0,m=0;break}else{O=y+m|0,M=w,U=145;break e}}while(!1);p[5968]=p[5968]|4,U=143}while(!1);if((U|0)==143&&h>>>0<2147483647&&(Q=hs(h|0)|0,L=hs(0)|0,X=L-Q|0,te=X>>>0>(C+40|0)>>>0,!((Q|0)==-1|te^1|Q>>>0<L>>>0&((Q|0)!=-1&(L|0)!=-1)^1))&&(O=te?X:m,M=Q,U=145),(U|0)==145){m=(p[5965]|0)+O|0,p[5965]=m,m>>>0>(p[5966]|0)>>>0&&(p[5966]=m),d=p[5863]|0;e:do if(d){for(m=23876;;){if(y=p[m>>2]|0,v=p[m+4>>2]|0,(M|0)==(y+v|0)){U=154;break}if(w=p[m+8>>2]|0,w)m=w;else break}if((U|0)==154&&(re=m+4|0,(p[m+12>>2]&8|0)==0)&&M>>>0>d>>>0&y>>>0<=d>>>0){p[re>>2]=v+O,oe=(p[5860]|0)+O|0,Q=d+8|0,Q=(Q&7|0)==0?0:0-Q&7,re=d+Q|0,Q=oe-Q|0,p[5863]=re,p[5860]=Q,p[re+4>>2]=Q|1,p[d+oe+4>>2]=40,p[5864]=p[5979];break}for(M>>>0<(p[5861]|0)>>>0&&(p[5861]=M),v=M+O|0,m=23876;;){if((p[m>>2]|0)==(v|0)){U=162;break}if(y=p[m+8>>2]|0,y)m=y;else break}if((U|0)==162&&(p[m+12>>2]&8|0)==0){p[m>>2]=M,g=m+4|0,p[g>>2]=(p[g>>2]|0)+O,g=M+8|0,g=M+((g&7|0)==0?0:0-g&7)|0,m=v+8|0,m=v+((m&7|0)==0?0:0-m&7)|0,h=g+C|0,l=m-g-C|0,p[g+4>>2]=C|3;t:do if((d|0)==(m|0))oe=(p[5860]|0)+l|0,p[5860]=oe,p[5863]=h,p[h+4>>2]=oe|1;else{if((p[5862]|0)==(m|0)){oe=(p[5859]|0)+l|0,p[5859]=oe,p[5862]=h,p[h+4>>2]=oe|1,p[h+oe>>2]=oe;break}if(y=p[m+4>>2]|0,(y&3|0)==1){O=y&-8,w=y>>>3;r:do if(y>>>0<256)if(y=p[m+8>>2]|0,v=p[m+12>>2]|0,(v|0)==(y|0)){p[5857]=p[5857]&~(1<<w);break}else{p[y+12>>2]=v,p[v+8>>2]=y;break}else{M=p[m+24>>2]|0,y=p[m+12>>2]|0;do if((y|0)==(m|0)){if(v=m+16|0,w=v+4|0,y=p[w>>2]|0,y)v=w;else if(y=p[v>>2]|0,!y){y=0;break}for(;;)if(B=y+20|0,w=p[B>>2]|0,w)y=w,v=B;else if(B=y+16|0,w=p[B>>2]|0,w)y=w,v=B;else break;p[v>>2]=0}else oe=p[m+8>>2]|0,p[oe+12>>2]=y,p[y+8>>2]=oe;while(!1);if(!M)break;v=p[m+28>>2]|0,w=23732+(v<<2)|0;do if((p[w>>2]|0)!=(m|0)){if(oe=M+16|0,p[((p[oe>>2]|0)==(m|0)?oe:M+20|0)>>2]=y,!y)break r}else{if(p[w>>2]=y,y|0)break;p[5858]=p[5858]&~(1<<v);break r}while(!1);if(p[y+24>>2]=M,v=m+16|0,w=p[v>>2]|0,w|0&&(p[y+16>>2]=w,p[w+24>>2]=y),v=p[v+4>>2]|0,!v)break;p[y+20>>2]=v,p[v+24>>2]=y}while(!1);m=m+O|0,B=O+l|0}else B=l;if(m=m+4|0,p[m>>2]=p[m>>2]&-2,p[h+4>>2]=B|1,p[h+B>>2]=B,m=B>>>3,B>>>0<256){v=23468+(m<<1<<2)|0,y=p[5857]|0,m=1<<m,y&m?(y=v+8|0,m=p[y>>2]|0):(p[5857]=y|m,m=v,y=v+8|0),p[y>>2]=h,p[m+12>>2]=h,p[h+8>>2]=m,p[h+12>>2]=v;break}m=B>>>8;do if(!m)w=0;else{if(B>>>0>16777215){w=31;break}re=(m+1048320|0)>>>16&8,oe=m<<re,Q=(oe+520192|0)>>>16&4,oe=oe<<Q,w=(oe+245760|0)>>>16&2,w=14-(Q|re|w)+(oe<<w>>>15)|0,w=B>>>(w+7|0)&1|w<<1}while(!1);if(m=23732+(w<<2)|0,p[h+28>>2]=w,y=h+16|0,p[y+4>>2]=0,p[y>>2]=0,y=p[5858]|0,v=1<<w,!(y&v)){p[5858]=y|v,p[m>>2]=h,p[h+24>>2]=m,p[h+12>>2]=h,p[h+8>>2]=h;break}m=p[m>>2]|0;r:do if((p[m+4>>2]&-8|0)!=(B|0)){for(w=B<<((w|0)==31?0:25-(w>>>1)|0);v=m+16+(w>>>31<<2)|0,y=p[v>>2]|0,!!y;)if((p[y+4>>2]&-8|0)==(B|0)){m=y;break r}else w=w<<1,m=y;p[v>>2]=h,p[h+24>>2]=m,p[h+12>>2]=h,p[h+8>>2]=h;break t}while(!1);re=m+8|0,oe=p[re>>2]|0,p[oe+12>>2]=h,p[re>>2]=h,p[h+8>>2]=oe,p[h+12>>2]=m,p[h+24>>2]=0}while(!1);return oe=g+8|0,Ie=Ee,oe|0}for(m=23876;y=p[m>>2]|0,!(y>>>0<=d>>>0&&(oe=y+(p[m+4>>2]|0)|0,oe>>>0>d>>>0));)m=p[m+8>>2]|0;B=oe+-47|0,y=B+8|0,y=B+((y&7|0)==0?0:0-y&7)|0,B=d+16|0,y=y>>>0<B>>>0?d:y,m=y+8|0,v=O+-40|0,Q=M+8|0,Q=(Q&7|0)==0?0:0-Q&7,re=M+Q|0,Q=v-Q|0,p[5863]=re,p[5860]=Q,p[re+4>>2]=Q|1,p[M+v+4>>2]=40,p[5864]=p[5979],v=y+4|0,p[v>>2]=27,p[m>>2]=p[5969],p[m+4>>2]=p[5970],p[m+8>>2]=p[5971],p[m+12>>2]=p[5972],p[5969]=M,p[5970]=O,p[5972]=0,p[5971]=m,m=y+24|0;do re=m,m=m+4|0,p[m>>2]=7;while((re+8|0)>>>0<oe>>>0);if((y|0)!=(d|0)){if(M=y-d|0,p[v>>2]=p[v>>2]&-2,p[d+4>>2]=M|1,p[y>>2]=M,m=M>>>3,M>>>0<256){v=23468+(m<<1<<2)|0,y=p[5857]|0,m=1<<m,y&m?(y=v+8|0,m=p[y>>2]|0):(p[5857]=y|m,m=v,y=v+8|0),p[y>>2]=d,p[m+12>>2]=d,p[d+8>>2]=m,p[d+12>>2]=v;break}if(m=M>>>8,m?M>>>0>16777215?w=31:(re=(m+1048320|0)>>>16&8,oe=m<<re,Q=(oe+520192|0)>>>16&4,oe=oe<<Q,w=(oe+245760|0)>>>16&2,w=14-(Q|re|w)+(oe<<w>>>15)|0,w=M>>>(w+7|0)&1|w<<1):w=0,v=23732+(w<<2)|0,p[d+28>>2]=w,p[d+20>>2]=0,p[B>>2]=0,m=p[5858]|0,y=1<<w,!(m&y)){p[5858]=m|y,p[v>>2]=d,p[d+24>>2]=v,p[d+12>>2]=d,p[d+8>>2]=d;break}m=p[v>>2]|0;t:do if((p[m+4>>2]&-8|0)!=(M|0)){for(w=M<<((w|0)==31?0:25-(w>>>1)|0);v=m+16+(w>>>31<<2)|0,y=p[v>>2]|0,!!y;)if((p[y+4>>2]&-8|0)==(M|0)){m=y;break t}else w=w<<1,m=y;p[v>>2]=d,p[d+24>>2]=m,p[d+12>>2]=d,p[d+8>>2]=d;break e}while(!1);re=m+8|0,oe=p[re>>2]|0,p[oe+12>>2]=d,p[re>>2]=d,p[d+8>>2]=oe,p[d+12>>2]=m,p[d+24>>2]=0}}else oe=p[5861]|0,(oe|0)==0|M>>>0<oe>>>0&&(p[5861]=M),p[5969]=M,p[5970]=O,p[5972]=0,p[5866]=p[5975],p[5865]=-1,p[5870]=23468,p[5869]=23468,p[5872]=23476,p[5871]=23476,p[5874]=23484,p[5873]=23484,p[5876]=23492,p[5875]=23492,p[5878]=23500,p[5877]=23500,p[5880]=23508,p[5879]=23508,p[5882]=23516,p[5881]=23516,p[5884]=23524,p[5883]=23524,p[5886]=23532,p[5885]=23532,p[5888]=23540,p[5887]=23540,p[5890]=23548,p[5889]=23548,p[5892]=23556,p[5891]=23556,p[5894]=23564,p[5893]=23564,p[5896]=23572,p[5895]=23572,p[5898]=23580,p[5897]=23580,p[5900]=23588,p[5899]=23588,p[5902]=23596,p[5901]=23596,p[5904]=23604,p[5903]=23604,p[5906]=23612,p[5905]=23612,p[5908]=23620,p[5907]=23620,p[5910]=23628,p[5909]=23628,p[5912]=23636,p[5911]=23636,p[5914]=23644,p[5913]=23644,p[5916]=23652,p[5915]=23652,p[5918]=23660,p[5917]=23660,p[5920]=23668,p[5919]=23668,p[5922]=23676,p[5921]=23676,p[5924]=23684,p[5923]=23684,p[5926]=23692,p[5925]=23692,p[5928]=23700,p[5927]=23700,p[5930]=23708,p[5929]=23708,p[5932]=23716,p[5931]=23716,oe=O+-40|0,Q=M+8|0,Q=(Q&7|0)==0?0:0-Q&7,re=M+Q|0,Q=oe-Q|0,p[5863]=re,p[5860]=Q,p[re+4>>2]=Q|1,p[M+oe+4>>2]=40,p[5864]=p[5979];while(!1);if(m=p[5860]|0,m>>>0>C>>>0)return Q=m-C|0,p[5860]=Q,oe=p[5863]|0,re=oe+C|0,p[5863]=re,p[re+4>>2]=Q|1,p[oe+4>>2]=C|3,oe=oe+8|0,Ie=Ee,oe|0}return oe=hu()|0,p[oe>>2]=12,oe=0,Ie=Ee,oe|0}function Or(y){y=y|0;var m=0,v=0,w=0,B=0,M=0,O=0,l=0,d=0;if(y){v=y+-8|0,B=p[5861]|0,y=p[y+-4>>2]|0,m=y&-8,d=v+m|0;do if(y&1)l=v,O=v;else{if(w=p[v>>2]|0,!(y&3)||(O=v+(0-w)|0,M=w+m|0,O>>>0<B>>>0))return;if((p[5862]|0)==(O|0)){if(y=d+4|0,m=p[y>>2]|0,(m&3|0)!=3){l=O,m=M;break}p[5859]=M,p[y>>2]=m&-2,p[O+4>>2]=M|1,p[O+M>>2]=M;return}if(v=w>>>3,w>>>0<256)if(y=p[O+8>>2]|0,m=p[O+12>>2]|0,(m|0)==(y|0)){p[5857]=p[5857]&~(1<<v),l=O,m=M;break}else{p[y+12>>2]=m,p[m+8>>2]=y,l=O,m=M;break}B=p[O+24>>2]|0,y=p[O+12>>2]|0;do if((y|0)==(O|0)){if(m=O+16|0,v=m+4|0,y=p[v>>2]|0,y)m=v;else if(y=p[m>>2]|0,!y){y=0;break}for(;;)if(w=y+20|0,v=p[w>>2]|0,v)y=v,m=w;else if(w=y+16|0,v=p[w>>2]|0,v)y=v,m=w;else break;p[m>>2]=0}else l=p[O+8>>2]|0,p[l+12>>2]=y,p[y+8>>2]=l;while(!1);if(B){if(m=p[O+28>>2]|0,v=23732+(m<<2)|0,(p[v>>2]|0)==(O|0)){if(p[v>>2]=y,!y){p[5858]=p[5858]&~(1<<m),l=O,m=M;break}}else if(l=B+16|0,p[((p[l>>2]|0)==(O|0)?l:B+20|0)>>2]=y,!y){l=O,m=M;break}p[y+24>>2]=B,m=O+16|0,v=p[m>>2]|0,v|0&&(p[y+16>>2]=v,p[v+24>>2]=y),m=p[m+4>>2]|0,m?(p[y+20>>2]=m,p[m+24>>2]=y,l=O,m=M):(l=O,m=M)}else l=O,m=M}while(!1);if(!(O>>>0>=d>>>0)&&(y=d+4|0,w=p[y>>2]|0,!!(w&1))){if(w&2)p[y>>2]=w&-2,p[l+4>>2]=m|1,p[O+m>>2]=m,B=m;else{if((p[5863]|0)==(d|0)){if(d=(p[5860]|0)+m|0,p[5860]=d,p[5863]=l,p[l+4>>2]=d|1,(l|0)!=(p[5862]|0))return;p[5862]=0,p[5859]=0;return}if((p[5862]|0)==(d|0)){d=(p[5859]|0)+m|0,p[5859]=d,p[5862]=O,p[l+4>>2]=d|1,p[O+d>>2]=d;return}B=(w&-8)+m|0,v=w>>>3;do if(w>>>0<256)if(m=p[d+8>>2]|0,y=p[d+12>>2]|0,(y|0)==(m|0)){p[5857]=p[5857]&~(1<<v);break}else{p[m+12>>2]=y,p[y+8>>2]=m;break}else{M=p[d+24>>2]|0,y=p[d+12>>2]|0;do if((y|0)==(d|0)){if(m=d+16|0,v=m+4|0,y=p[v>>2]|0,y)m=v;else if(y=p[m>>2]|0,!y){v=0;break}for(;;)if(w=y+20|0,v=p[w>>2]|0,v)y=v,m=w;else if(w=y+16|0,v=p[w>>2]|0,v)y=v,m=w;else break;p[m>>2]=0,v=y}else v=p[d+8>>2]|0,p[v+12>>2]=y,p[y+8>>2]=v,v=y;while(!1);if(M|0){if(y=p[d+28>>2]|0,m=23732+(y<<2)|0,(p[m>>2]|0)==(d|0)){if(p[m>>2]=v,!v){p[5858]=p[5858]&~(1<<y);break}}else if(w=M+16|0,p[((p[w>>2]|0)==(d|0)?w:M+20|0)>>2]=v,!v)break;p[v+24>>2]=M,y=d+16|0,m=p[y>>2]|0,m|0&&(p[v+16>>2]=m,p[m+24>>2]=v),y=p[y+4>>2]|0,y|0&&(p[v+20>>2]=y,p[y+24>>2]=v)}}while(!1);if(p[l+4>>2]=B|1,p[O+B>>2]=B,(l|0)==(p[5862]|0)){p[5859]=B;return}}if(y=B>>>3,B>>>0<256){v=23468+(y<<1<<2)|0,m=p[5857]|0,y=1<<y,m&y?(m=v+8|0,y=p[m>>2]|0):(p[5857]=m|y,y=v,m=v+8|0),p[m>>2]=l,p[y+12>>2]=l,p[l+8>>2]=y,p[l+12>>2]=v;return}y=B>>>8,y?B>>>0>16777215?w=31:(O=(y+1048320|0)>>>16&8,d=y<<O,M=(d+520192|0)>>>16&4,d=d<<M,w=(d+245760|0)>>>16&2,w=14-(M|O|w)+(d<<w>>>15)|0,w=B>>>(w+7|0)&1|w<<1):w=0,y=23732+(w<<2)|0,p[l+28>>2]=w,p[l+20>>2]=0,p[l+16>>2]=0,m=p[5858]|0,v=1<<w;e:do if(!(m&v))p[5858]=m|v,p[y>>2]=l,p[l+24>>2]=y,p[l+12>>2]=l,p[l+8>>2]=l;else{y=p[y>>2]|0;t:do if((p[y+4>>2]&-8|0)!=(B|0)){for(w=B<<((w|0)==31?0:25-(w>>>1)|0);v=y+16+(w>>>31<<2)|0,m=p[v>>2]|0,!!m;)if((p[m+4>>2]&-8|0)==(B|0)){y=m;break t}else w=w<<1,y=m;p[v>>2]=l,p[l+24>>2]=y,p[l+12>>2]=l,p[l+8>>2]=l;break e}while(!1);O=y+8|0,d=p[O>>2]|0,p[d+12>>2]=l,p[O>>2]=l,p[l+8>>2]=d,p[l+12>>2]=y,p[l+24>>2]=0}while(!1);if(d=(p[5865]|0)+-1|0,p[5865]=d,!(d|0)){for(y=23884;y=p[y>>2]|0,y;)y=y+8|0;p[5865]=-1}}}}function eo(y,m){y=y|0,m=m|0;var v=0;return y?(v=Gr(m,y)|0,(m|y)>>>0>65535&&(v=((v>>>0)/(y>>>0)|0|0)==(m|0)?v:-1)):v=0,y=Vn(v)|0,!y||!(p[y+-4>>2]&3)||Yo(y|0,0,v|0)|0,y|0}function cn(y,m,v,w){return y=y|0,m=m|0,v=v|0,w=w|0,v=y+v>>>0,fr(m+w+(v>>>0<y>>>0|0)>>>0|0),v|0|0}function Hr(y,m,v,w){return y=y|0,m=m|0,v=v|0,w=w|0,w=m-w-(v>>>0>y>>>0|0)>>>0,fr(w|0),y-v>>>0|0|0}function Mi(y){return y=y|0,(y?31-(Vr(y^y-1)|0)|0:32)|0}function du(y,m,v,w,B){y=y|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,O=0,l=0,d=0,h=0,g=0,C=0,P=0,R=0,L=0;if(g=y,d=m,h=d,O=v,P=w,l=P,!h)return M=(B|0)!=0,l?M?(p[B>>2]=y|0,p[B+4>>2]=m&0,P=0,B=0,fr(P|0),B|0):(P=0,B=0,fr(P|0),B|0):(M&&(p[B>>2]=(g>>>0)%(O>>>0),p[B+4>>2]=0),P=0,B=(g>>>0)/(O>>>0)>>>0,fr(P|0),B|0);M=(l|0)==0;do if(O){if(!M){if(M=(Vr(l|0)|0)-(Vr(h|0)|0)|0,M>>>0<=31){C=M+1|0,l=31-M|0,m=M-31>>31,O=C,y=g>>>(C>>>0)&m|h<<l,m=h>>>(C>>>0)&m,M=0,l=g<<l;break}return B?(p[B>>2]=y|0,p[B+4>>2]=d|m&0,P=0,B=0,fr(P|0),B|0):(P=0,B=0,fr(P|0),B|0)}if(M=O-1|0,M&O|0){l=(Vr(O|0)|0)+33-(Vr(h|0)|0)|0,L=64-l|0,C=32-l|0,d=C>>31,R=l-32|0,m=R>>31,O=l,y=C-1>>31&h>>>(R>>>0)|(h<<C|g>>>(l>>>0))&m,m=m&h>>>(l>>>0),M=g<<L&d,l=(h<<L|g>>>(R>>>0))&d|g<<C&l-33>>31;break}return B|0&&(p[B>>2]=M&g,p[B+4>>2]=0),(O|0)==1?(R=d|m&0,L=y|0|0,fr(R|0),L|0):(L=Mi(O|0)|0,R=h>>>(L>>>0)|0,L=h<<32-L|g>>>(L>>>0)|0,fr(R|0),L|0)}else{if(M)return B|0&&(p[B>>2]=(h>>>0)%(O>>>0),p[B+4>>2]=0),R=0,L=(h>>>0)/(O>>>0)>>>0,fr(R|0),L|0;if(!g)return B|0&&(p[B>>2]=0,p[B+4>>2]=(h>>>0)%(l>>>0)),R=0,L=(h>>>0)/(l>>>0)>>>0,fr(R|0),L|0;if(M=l-1|0,!(M&l))return B|0&&(p[B>>2]=y|0,p[B+4>>2]=M&h|m&0),R=0,L=h>>>((Mi(l|0)|0)>>>0),fr(R|0),L|0;if(M=(Vr(l|0)|0)-(Vr(h|0)|0)|0,M>>>0<=30){m=M+1|0,l=31-M|0,O=m,y=h<<l|g>>>(m>>>0),m=h>>>(m>>>0),M=0,l=g<<l;break}return B?(p[B>>2]=y|0,p[B+4>>2]=d|m&0,R=0,L=0,fr(R|0),L|0):(R=0,L=0,fr(R|0),L|0)}while(!1);if(!O)h=l,d=0,l=0;else{C=v|0|0,g=P|w&0,h=cn(C|0,g|0,-1,-1)|0,v=Me()|0,d=l,l=0;do w=d,d=M>>>31|d<<1,M=l|M<<1,w=y<<1|w>>>31|0,P=y>>>31|m<<1|0,Hr(h|0,v|0,w|0,P|0)|0,L=Me()|0,R=L>>31|((L|0)<0?-1:0)<<1,l=R&1,y=Hr(w|0,P|0,R&C|0,(((L|0)<0?-1:0)>>31|((L|0)<0?-1:0)<<1)&g|0)|0,m=Me()|0,O=O-1|0;while((O|0)!=0);h=d,d=0}return O=0,B|0&&(p[B>>2]=y,p[B+4>>2]=m),R=(M|0)>>>31|(h|O)<<1|(O<<1|M>>>31)&0|d,L=(M<<1|0)&-2|l,fr(R|0),L|0}function ks(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;return h=m>>31|((m|0)<0?-1:0)<<1,d=((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1,M=w>>31|((w|0)<0?-1:0)<<1,B=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,l=Hr(h^y|0,d^m|0,h|0,d|0)|0,O=Me()|0,y=M^h,m=B^d,Hr((du(l,O,Hr(M^v|0,B^w|0,M|0,B|0)|0,Me()|0,0)|0)^y|0,(Me()|0)^m|0,y|0,m|0)|0}function mf(y,m){y=y|0,m=m|0;var v=0,w=0,B=0,M=0;return M=y&65535,B=m&65535,v=Gr(B,M)|0,w=y>>>16,y=(v>>>16)+(Gr(B,w)|0)|0,B=m>>>16,m=Gr(B,M)|0,fr((y>>>16)+(Gr(B,w)|0)+(((y&65535)+m|0)>>>16)|0),y+m<<16|v&65535|0|0}function si(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;return B=y,M=v,v=mf(B,M)|0,y=Me()|0,fr((Gr(m,M)|0)+(Gr(w,B)|0)+y|y&0|0),v|0|0|0}function Qi(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,O=0,l=0,d=0,h=0;return B=Ie,Ie=Ie+16|0,l=B|0,O=m>>31|((m|0)<0?-1:0)<<1,M=((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1,h=w>>31|((w|0)<0?-1:0)<<1,d=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,y=Hr(O^y|0,M^m|0,O|0,M|0)|0,m=Me()|0,du(y,m,Hr(h^v|0,d^w|0,h|0,d|0)|0,Me()|0,l)|0,w=Hr(p[l>>2]^O|0,p[l+4>>2]^M|0,O|0,M|0)|0,v=Me()|0,Ie=B,fr(v|0),w|0}function mo(y,m,v,w){y=y|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;return M=Ie,Ie=Ie+16|0,B=M|0,du(y,m,v,w,B)|0,Ie=M,fr(p[B+4>>2]|0),p[B>>2]|0|0}function _o(y,m,v){return y=y|0,m=m|0,v=v|0,(v|0)<32?(fr(m>>v|0),y>>>v|(m&(1<<v)-1)<<32-v):(fr(((m|0)<0?-1:0)|0),m>>v-32|0)}function jt(y,m,v){return y=y|0,m=m|0,v=v|0,(v|0)<32?(fr(m>>>v|0),y>>>v|(m&(1<<v)-1)<<32-v):(fr(0),m>>>v-32|0)}function Zt(y,m,v){return y=y|0,m=m|0,v=v|0,(v|0)<32?(fr(m<<v|(y&(1<<v)-1<<32-v)>>>32-v|0),y<<v):(fr(y<<v-32|0),0)}function Rc(y,m){return y=+y,m=+m,y!=y?+m:m!=m?+y:+fi(+y,+m)}function xl(y,m){return y=+y,m=+m,y!=y?+m:m!=m?+y:+Lr(+y,+m)}function Ko(y){return y=+y,y>=0?+Ct(y+.5):+zr(y-.5)}function To(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0;if((v|0)>=8192)return la(y|0,m|0,v|0)|0,y|0;if(M=y|0,B=y+v|0,(y&3)==(m&3)){for(;y&3;){if(!v)return M|0;Se[y>>0]=Se[m>>0]|0,y=y+1|0,m=m+1|0,v=v-1|0}for(v=B&-4|0,w=v-64|0;(y|0)<=(w|0);)p[y>>2]=p[m>>2],p[y+4>>2]=p[m+4>>2],p[y+8>>2]=p[m+8>>2],p[y+12>>2]=p[m+12>>2],p[y+16>>2]=p[m+16>>2],p[y+20>>2]=p[m+20>>2],p[y+24>>2]=p[m+24>>2],p[y+28>>2]=p[m+28>>2],p[y+32>>2]=p[m+32>>2],p[y+36>>2]=p[m+36>>2],p[y+40>>2]=p[m+40>>2],p[y+44>>2]=p[m+44>>2],p[y+48>>2]=p[m+48>>2],p[y+52>>2]=p[m+52>>2],p[y+56>>2]=p[m+56>>2],p[y+60>>2]=p[m+60>>2],y=y+64|0,m=m+64|0;for(;(y|0)<(v|0);)p[y>>2]=p[m>>2],y=y+4|0,m=m+4|0}else for(v=B-4|0;(y|0)<(v|0);)Se[y>>0]=Se[m>>0]|0,Se[y+1>>0]=Se[m+1>>0]|0,Se[y+2>>0]=Se[m+2>>0]|0,Se[y+3>>0]=Se[m+3>>0]|0,y=y+4|0,m=m+4|0;for(;(y|0)<(B|0);)Se[y>>0]=Se[m>>0]|0,y=y+1|0,m=m+1|0;return M|0}function Yo(y,m,v){y=y|0,m=m|0,v=v|0;var w=0,B=0,M=0,O=0;if(M=y+v|0,m=m&255,(v|0)>=67){for(;y&3;)Se[y>>0]=m,y=y+1|0;for(w=M&-4|0,O=m|m<<8|m<<16|m<<24,B=w-64|0;(y|0)<=(B|0);)p[y>>2]=O,p[y+4>>2]=O,p[y+8>>2]=O,p[y+12>>2]=O,p[y+16>>2]=O,p[y+20>>2]=O,p[y+24>>2]=O,p[y+28>>2]=O,p[y+32>>2]=O,p[y+36>>2]=O,p[y+40>>2]=O,p[y+44>>2]=O,p[y+48>>2]=O,p[y+52>>2]=O,p[y+56>>2]=O,p[y+60>>2]=O,y=y+64|0;for(;(y|0)<(w|0);)p[y>>2]=O,y=y+4|0}for(;(y|0)<(M|0);)Se[y>>0]=m,y=y+1|0;return M-v|0}function qo(y){return y=+y,y>=0?+Ct(y+.5):+zr(y-.5)}function hs(y){y=y|0;var m=0,v=0,w=0;return w=Ui()|0,v=p[Ke>>2]|0,m=v+y|0,(y|0)>0&(m|0)<(v|0)|(m|0)<0?(Un(m|0)|0,Kr(12),-1):(m|0)>(w|0)&&!(ti(m|0)|0)?(Kr(12),-1):(p[Ke>>2]=m,v|0)}return{___divdi3:ks,___muldi3:si,___remdi3:Qi,___uremdi3:mo,_areNeighborCells:ga,_bitshift64Ashr:_o,_bitshift64Lshr:jt,_bitshift64Shl:Zt,_calloc:eo,_cellAreaKm2:Rn,_cellAreaM2:Ds,_cellAreaRads2:nn,_cellToBoundary:Ec,_cellToCenterChild:HA,_cellToChildPos:iu,_cellToChildren:Pn,_cellToChildrenSize:Al,_cellToLatLng:Cc,_cellToLocalIj:Mh,_cellToParent:jo,_cellToVertex:kr,_cellToVertexes:Eo,_cellsToDirectedEdge:ka,_cellsToLinkedMultiPolygon:gr,_childPosToCell:$A,_compactCells:xc,_destroyLinkedMultiPolygon:Ic,_directedEdgeToBoundary:ql,_directedEdgeToCells:xh,_edgeLengthKm:Sc,_edgeLengthM:yl,_edgeLengthRads:_l,_emscripten_replace_memory:ko,_free:Or,_getBaseCellNumber:lf,_getDirectedEdgeDestination:ma,_getDirectedEdgeOrigin:Na,_getHexagonAreaAvgKm2:Ih,_getHexagonAreaAvgM2:Wa,_getHexagonEdgeLengthAvgKm:Gn,_getHexagonEdgeLengthAvgM:au,_getIcosahedronFaces:Tc,_getNumCells:$o,_getPentagons:pl,_getRes0Cells:vh,_getResolution:Ua,_greatCircleDistanceKm:$a,_greatCircleDistanceM:uf,_greatCircleDistanceRads:ou,_gridDisk:Bn,_gridDiskDistances:us,_gridDistance:nr,_gridPathCells:cu,_gridPathCellsSize:vs,_gridRingUnsafe:Ce,_i64Add:cn,_i64Subtract:Hr,_isPentagon:Sn,_isResClassIII:Sh,_isValidCell:Ho,_isValidDirectedEdge:bh,_isValidVertex:Vi,_latLngToCell:Ga,_llvm_maxnum_f64:Rc,_llvm_minnum_f64:xl,_llvm_round_f64:Ko,_localIjToCell:mi,_malloc:Vn,_maxFaceCount:Ha,_maxGridDiskSize:xi,_maxPolygonToCellsSize:Re,_memcpy:To,_memset:Yo,_originToDirectedEdges:Cn,_pentagonCount:nu,_polygonToCells:At,_readInt64AsDoubleFromPointer:xs,_res0CellCount:ul,_round:qo,_sbrk:hs,_sizeOfCellBoundary:Af,_sizeOfCoordIJ:fu,_sizeOfGeoLoop:qs,_sizeOfGeoPolygon:bs,_sizeOfH3Index:df,_sizeOfLatLng:lu,_sizeOfLinkedGeoPolygon:uu,_uncompactCells:Bh,_uncompactCellsSize:jA,_vertexToLatLng:Zs,establishStackSpace:ri,stackAlloc:zn,stackRestore:Si,stackSave:No}}(ge,Nt,pe);e.___divdi3=wt.___divdi3,e.___muldi3=wt.___muldi3,e.___remdi3=wt.___remdi3,e.___uremdi3=wt.___uremdi3,e._areNeighborCells=wt._areNeighborCells,e._bitshift64Ashr=wt._bitshift64Ashr,e._bitshift64Lshr=wt._bitshift64Lshr,e._bitshift64Shl=wt._bitshift64Shl,e._calloc=wt._calloc,e._cellAreaKm2=wt._cellAreaKm2,e._cellAreaM2=wt._cellAreaM2,e._cellAreaRads2=wt._cellAreaRads2,e._cellToBoundary=wt._cellToBoundary,e._cellToCenterChild=wt._cellToCenterChild,e._cellToChildPos=wt._cellToChildPos,e._cellToChildren=wt._cellToChildren,e._cellToChildrenSize=wt._cellToChildrenSize,e._cellToLatLng=wt._cellToLatLng,e._cellToLocalIj=wt._cellToLocalIj,e._cellToParent=wt._cellToParent,e._cellToVertex=wt._cellToVertex,e._cellToVertexes=wt._cellToVertexes,e._cellsToDirectedEdge=wt._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=wt._cellsToLinkedMultiPolygon,e._childPosToCell=wt._childPosToCell,e._compactCells=wt._compactCells,e._destroyLinkedMultiPolygon=wt._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=wt._directedEdgeToBoundary,e._directedEdgeToCells=wt._directedEdgeToCells,e._edgeLengthKm=wt._edgeLengthKm,e._edgeLengthM=wt._edgeLengthM,e._edgeLengthRads=wt._edgeLengthRads;var $=e._emscripten_replace_memory=wt._emscripten_replace_memory;e._free=wt._free,e._getBaseCellNumber=wt._getBaseCellNumber,e._getDirectedEdgeDestination=wt._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=wt._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=wt._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=wt._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=wt._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=wt._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=wt._getIcosahedronFaces,e._getNumCells=wt._getNumCells,e._getPentagons=wt._getPentagons,e._getRes0Cells=wt._getRes0Cells,e._getResolution=wt._getResolution,e._greatCircleDistanceKm=wt._greatCircleDistanceKm,e._greatCircleDistanceM=wt._greatCircleDistanceM,e._greatCircleDistanceRads=wt._greatCircleDistanceRads,e._gridDisk=wt._gridDisk,e._gridDiskDistances=wt._gridDiskDistances,e._gridDistance=wt._gridDistance,e._gridPathCells=wt._gridPathCells,e._gridPathCellsSize=wt._gridPathCellsSize,e._gridRingUnsafe=wt._gridRingUnsafe,e._i64Add=wt._i64Add,e._i64Subtract=wt._i64Subtract,e._isPentagon=wt._isPentagon,e._isResClassIII=wt._isResClassIII,e._isValidCell=wt._isValidCell,e._isValidDirectedEdge=wt._isValidDirectedEdge,e._isValidVertex=wt._isValidVertex,e._latLngToCell=wt._latLngToCell,e._llvm_maxnum_f64=wt._llvm_maxnum_f64,e._llvm_minnum_f64=wt._llvm_minnum_f64,e._llvm_round_f64=wt._llvm_round_f64,e._localIjToCell=wt._localIjToCell,e._malloc=wt._malloc,e._maxFaceCount=wt._maxFaceCount,e._maxGridDiskSize=wt._maxGridDiskSize,e._maxPolygonToCellsSize=wt._maxPolygonToCellsSize,e._memcpy=wt._memcpy,e._memset=wt._memset,e._originToDirectedEdges=wt._originToDirectedEdges,e._pentagonCount=wt._pentagonCount,e._polygonToCells=wt._polygonToCells,e._readInt64AsDoubleFromPointer=wt._readInt64AsDoubleFromPointer,e._res0CellCount=wt._res0CellCount,e._round=wt._round,e._sbrk=wt._sbrk,e._sizeOfCellBoundary=wt._sizeOfCellBoundary,e._sizeOfCoordIJ=wt._sizeOfCoordIJ,e._sizeOfGeoLoop=wt._sizeOfGeoLoop,e._sizeOfGeoPolygon=wt._sizeOfGeoPolygon,e._sizeOfH3Index=wt._sizeOfH3Index,e._sizeOfLatLng=wt._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=wt._sizeOfLinkedGeoPolygon,e._uncompactCells=wt._uncompactCells,e._uncompactCellsSize=wt._uncompactCellsSize,e._vertexToLatLng=wt._vertexToLatLng,e.establishStackSpace=wt.establishStackSpace;var yt=e.stackAlloc=wt.stackAlloc,Et=e.stackRestore=wt.stackRestore,Te=e.stackSave=wt.stackSave;if(e.asm=wt,e.cwrap=K,e.setValue=D,e.getValue=N,un){Nn(un)||(un=o(un));{ei();var Je=function(Ae){Ae.byteLength&&(Ae=new Uint8Array(Ae)),ne.set(Ae,S),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,$n()},ct=function(){s(un,Je,function(){throw"could not load memory initializer "+un})},q=Mt(un);if(q)Je(q.buffer);else if(e.memoryInitializerRequest){var ie=function(){var Ae=e.memoryInitializerRequest,xe=Ae.response;if(Ae.status!==200&&Ae.status!==0){var ce=Mt(e.memoryInitializerRequestURL);if(ce)xe=ce.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Ae.status+", retrying "+un),ct();return}}Je(xe)};e.memoryInitializerRequest.response?setTimeout(ie,0):e.memoryInitializerRequest.addEventListener("load",ie)}else ct()}}var ue;Sr=function Ae(){ue||be(),ue||(Sr=Ae)};function be(Ae){if(rn>0||(Xt(),rn>0))return;function xe(){ue||(ue=!0,!G&&($t(),Lt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),lr()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),xe()},1)):xe()}e.run=be;function De(Ae){throw e.onAbort&&e.onAbort(Ae),Ae+="",c(Ae),f(Ae),G=!0,"abort("+Ae+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=De,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return be(),r}(typeof Rr=="object"?Rr:{}),fn="number",Qr=fn,Ep=fn,on=fn,an=fn,so=fn,Br=fn,Nde=[["sizeOfH3Index",fn],["sizeOfLatLng",fn],["sizeOfCellBoundary",fn],["sizeOfGeoLoop",fn],["sizeOfGeoPolygon",fn],["sizeOfLinkedGeoPolygon",fn],["sizeOfCoordIJ",fn],["readInt64AsDoubleFromPointer",fn],["isValidCell",Ep,[on,an]],["latLngToCell",Qr,[fn,fn,so,Br]],["cellToLatLng",Qr,[on,an,Br]],["cellToBoundary",Qr,[on,an,Br]],["maxGridDiskSize",Qr,[fn,Br]],["gridDisk",Qr,[on,an,fn,Br]],["gridDiskDistances",Qr,[on,an,fn,Br,Br]],["gridRingUnsafe",Qr,[on,an,fn,Br]],["maxPolygonToCellsSize",Qr,[Br,so,fn,Br]],["polygonToCells",Qr,[Br,so,fn,Br]],["cellsToLinkedMultiPolygon",Qr,[Br,fn,Br]],["destroyLinkedMultiPolygon",null,[Br]],["compactCells",Qr,[Br,Br,fn,fn]],["uncompactCells",Qr,[Br,fn,fn,Br,fn,so]],["uncompactCellsSize",Qr,[Br,fn,fn,so,Br]],["isPentagon",Ep,[on,an]],["isResClassIII",Ep,[on,an]],["getBaseCellNumber",fn,[on,an]],["getResolution",fn,[on,an]],["maxFaceCount",Qr,[on,an,Br]],["getIcosahedronFaces",Qr,[on,an,Br]],["cellToParent",Qr,[on,an,so,Br]],["cellToChildren",Qr,[on,an,so,Br]],["cellToCenterChild",Qr,[on,an,so,Br]],["cellToChildrenSize",Qr,[on,an,so,Br]],["cellToChildPos",Qr,[on,an,so,Br]],["childPosToCell",Qr,[fn,fn,on,an,so,Br]],["areNeighborCells",Qr,[on,an,on,an,Br]],["cellsToDirectedEdge",Qr,[on,an,on,an,Br]],["getDirectedEdgeOrigin",Qr,[on,an,Br]],["getDirectedEdgeDestination",Qr,[on,an,Br]],["isValidDirectedEdge",Ep,[on,an]],["directedEdgeToCells",Qr,[on,an,Br]],["originToDirectedEdges",Qr,[on,an,Br]],["directedEdgeToBoundary",Qr,[on,an,Br]],["gridDistance",Qr,[on,an,on,an,Br]],["gridPathCells",Qr,[on,an,on,an,Br]],["gridPathCellsSize",Qr,[on,an,on,an,Br]],["cellToLocalIj",Qr,[on,an,on,an,fn,Br]],["localIjToCell",Qr,[on,an,Br,fn,Br]],["getHexagonAreaAvgM2",Qr,[so,Br]],["getHexagonAreaAvgKm2",Qr,[so,Br]],["getHexagonEdgeLengthAvgM",Qr,[so,Br]],["getHexagonEdgeLengthAvgKm",Qr,[so,Br]],["greatCircleDistanceM",fn,[Br,Br]],["greatCircleDistanceKm",fn,[Br,Br]],["greatCircleDistanceRads",fn,[Br,Br]],["cellAreaM2",Qr,[on,an,Br]],["cellAreaKm2",Qr,[on,an,Br]],["cellAreaRads2",Qr,[on,an,Br]],["edgeLengthM",Qr,[on,an,Br]],["edgeLengthKm",Qr,[on,an,Br]],["edgeLengthRads",Qr,[on,an,Br]],["getNumCells",Qr,[so,Br]],["getRes0Cells",Qr,[Br]],["res0CellCount",fn],["getPentagons",Qr,[fn,Br]],["pentagonCount",fn],["cellToVertex",Qr,[on,an,fn,Br]],["cellToVertexes",Qr,[on,an,Br]],["vertexToLatLng",Qr,[on,an,Br]],["isValidVertex",Ep,[on,an]]],Ude=0,zde=1,Gde=2,Vde=3,Nk=4,Hde=5,jde=6,$de=7,Wde=8,Jde=9,Xde=10,Kde=11,Yde=12,qde=13,Zde=14,Qde=15,Ws={};Ws[Ude]="Success";Ws[zde]="The operation failed but a more specific error is not available";Ws[Gde]="Argument was outside of acceptable range";Ws[Vde]="Latitude or longitude arguments were outside of acceptable range";Ws[Nk]="Resolution argument was outside of acceptable range";Ws[Hde]="Cell argument was not valid";Ws[jde]="Directed edge argument was not valid";Ws[$de]="Undirected edge argument was not valid";Ws[Wde]="Vertex argument was not valid";Ws[Jde]="Pentagon distortion was encountered";Ws[Xde]="Duplicate input";Ws[Kde]="Cell arguments were not neighbors";Ws[Yde]="Cell arguments had incompatible resolutions";Ws[qde]="Memory allocation failed";Ws[Zde]="Bounds of provided memory were insufficient";Ws[Qde]="Mode or flags argument was not valid";var BC=1e3,Uk=1001,zk=1002,Ly={};Ly[BC]="Unknown unit";Ly[Uk]="Array length out of bounds";Ly[zk]="Got unexpected null value for H3 index";var eAe="Unknown error";function Gk(r,e,t){var n=t&&"value"in t,i=new Error((r[e]||eAe)+" (code: "+e+(n?", value: "+t.value:"")+")");return i.code=e,i}function Vk(r,e){var t=arguments.length===2?{value:e}:{};return Gk(Ws,r,t)}function ky(r,e){var t=arguments.length===2?{value:e}:{};return Gk(Ly,r,t)}function lo(r){if(r!==0)throw Vk(r)}var Zn={};Nde.forEach(function(e){Zn[e[0]]=Rr.cwrap.apply(Rr,e)});var eA=16,BA=4,JP=4,nl=8,SC=8,$u=Zn.sizeOfH3Index(),IC=Zn.sizeOfLatLng(),tAe=Zn.sizeOfCellBoundary(),rAe=Zn.sizeOfGeoPolygon(),Qp=Zn.sizeOfGeoLoop(),nAe=Zn.sizeOfLinkedGeoPolygon();Zn.sizeOfCoordIJ();var dA={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function Hk(r){if(typeof r!="number"||r<0||r>15||Math.floor(r)!==r)throw Vk(Nk,r);return r}function jk(r){if(!r)throw ky(zk);return r}var iAe=Math.pow(2,32)-1;function $k(r){if(r>iAe)throw ky(Uk,r);return r}var sAe=/[^0-9a-fA-F]/;function gc(r){if(Array.isArray(r)&&r.length===2&&Number.isInteger(r[0])&&Number.isInteger(r[1]))return r;if(typeof r!="string"||sAe.test(r))return[0,0];var e=parseInt(r.substring(0,r.length-8),eA),t=parseInt(r.substring(r.length-8),eA);return[t,e]}function XP(r){if(r>=0)return r.toString(eA);r=r&2147483647;var e=Wk(8,r.toString(eA)),t=(parseInt(e[0],eA)+8).toString(eA);return e=t+e.substring(1),e}function oAe(r,e){return XP(e)+Wk(8,XP(r))}function Wk(r,e){for(var t=r-e.length,n="",i=0;i<t;i++)n+="0";return n=n+e,n}function KP(r,e,t){for(var n=r.length,i=Rr._calloc(n,IC),o=t?1:0,s=t?0:1,c=0;c<n*2;c+=2)Rr.HEAPF64.set([r[c/2][o],r[c/2][s]].map(qk),i/nl+c);return Rr.HEAPU32.set([n,i],e/BA),e}function aAe(r,e){var t=r.length-1,n=Rr._calloc(rAe),i=0,o=i+Qp,s=o+BA;KP(r[0],n+i,e);var c;if(t>0){c=Rr._calloc(t,Qp);for(var f=0;f<t;f++)KP(r[f+1],c+Qp*f,e)}return Rr.setValue(n+o,t,"i32"),Rr.setValue(n+s,c,"i32"),n}function cAe(r){var e=0,t=e+Qp,n=t+BA,i=BA;Rr._free(Rr.getValue(r+e+i,"i8*"));var o=Rr.getValue(r+t,"i32");if(o>0){for(var s=Rr.getValue(r+n,"i32"),c=0;c<o;c++)Rr._free(Rr.getValue(s+Qp*c+i,"i8*"));Rr._free(s)}Rr._free(r)}function MC(r,e){e===void 0&&(e=0);var t=Rr.getValue(r+$u*e,"i32"),n=Rr.getValue(r+$u*e+BA,"i32");return n?oAe(t,n):null}function Jk(r,e){return e===void 0&&(e=0),Rr.getValue(r+nl*e,"double")}function PC(r){return Zn.readInt64AsDoubleFromPointer(r)}function lAe(r,e,t){Rr.HEAPU32.set(gc(r),e/BA+2*t)}function RC(r,e){for(var t=[],n=0;n<e;n++){var i=MC(r,n);i!==null&&t.push(i)}return t}function uAe(r,e){for(var t=e.length,n=0;n<t;n++)lAe(e[n],r,n)}function P_(r){return xAe(Rr.getValue(r,"double"))}function Xk(r){return[P_(r),P_(r+nl)]}function Kk(r){return[P_(r+nl),P_(r)]}function fAe(r,e,t){for(var n=Rr.getValue(r,"i32"),i=r+nl,o=[],s=e?Kk:Xk,c=0;c<n*2;c+=2)o.push(s(i+nl*c));return t&&o.push(o[0]),o}function hAe(r,e){for(var t=[],n=Kk,i,o,s,c;r;){for(t.push(i=[]),o=Rr.getValue(r,"i8*");o;){for(i.push(s=[]),c=Rr.getValue(o,"i8*");c;)s.push(n(c)),c=Rr.getValue(c+nl*2,"i8*");s.push(s[0]),o=Rr.getValue(o+JP*2,"i8*")}r=Rr.getValue(r+JP*2,"i8*")}return t}function dAe(r){var e=gc(r),t=e[0],n=e[1];return!!Zn.isPentagon(t,n)}function Rx(r){var e=gc(r),t=e[0],n=e[1];return Zn.isValidCell(t,n)?Zn.getResolution(t,n):-1}function FC(r,e,t){var n=Rr._malloc(IC);Rr.HEAPF64.set([r,e].map(qk),n/nl);var i=Rr._malloc($u);try{return lo(Zn.latLngToCell(n,t,i)),jk(MC(i))}finally{Rr._free(i),Rr._free(n)}}function OC(r){var e=Rr._malloc(IC),t=gc(r),n=t[0],i=t[1];try{return lo(Zn.cellToLatLng(n,i,e)),Xk(e)}finally{Rr._free(e)}}function Yk(r,e){var t=Rr._malloc(tAe),n=gc(r),i=n[0],o=n[1];try{return lo(Zn.cellToBoundary(i,o,t)),fAe(t,e,e)}finally{Rr._free(t)}}function AAe(r,e){var t=gc(r),n=t[0],i=t[1],o=Rr._malloc($u);try{return lo(Zn.cellToParent(n,i,e,o)),jk(MC(o))}finally{Rr._free(o)}}function pAe(r,e){var t=gc(r),n=t[0],i=t[1],o=Rr._malloc(SC);try{lo(Zn.maxGridDiskSize(e,o));var s=$k(PC(o)),c=Rr._calloc(s,$u);try{return lo(Zn.gridDisk(n,i,e,c)),RC(c,s)}finally{Rr._free(c)}}finally{Rr._free(o)}}function gAe(r,e,t){if(Hk(e),t=!!t,r.length===0||r[0].length===0)return[];var n=typeof r[0][0]=="number"?[r]:r,i=aAe(n,t),o=Rr._malloc(SC);try{lo(Zn.maxPolygonToCellsSize(i,e,0,o));var s=$k(PC(o)),c=Rr._calloc(s,$u);try{return lo(Zn.polygonToCells(i,e,0,c)),RC(c,s)}finally{Rr._free(c)}}finally{Rr._free(o),cAe(i)}}function mAe(r,e){if(!r||!r.length)return[];var t=r.length,n=Rr._calloc(t,$u);uAe(n,r);var i=Rr._calloc(nAe);try{return lo(Zn.cellsToLinkedMultiPolygon(n,t,i)),hAe(i,e)}finally{Zn.destroyLinkedMultiPolygon(i),Rr._free(i),Rr._free(n)}}function _Ae(r){var e=gc(r),t=e[0],n=e[1],i=6,o=Rr._calloc(i,$u);try{return lo(Zn.originToDirectedEdges(t,n,o)),RC(o,i)}finally{Rr._free(o)}}function yAe(r,e){var t=gc(r),n=t[0],i=t[1],o=gc(e),s=o[0],c=o[1],f=Rr._malloc(SC);try{return lo(Zn.gridDistance(n,i,s,c,f)),PC(f)}finally{Rr._free(f)}}function vAe(r,e){var t=gc(r),n=t[0],i=t[1],o=Rr._malloc(nl);try{switch(e){case dA.m:lo(Zn.edgeLengthM(n,i,o));break;case dA.km:lo(Zn.edgeLengthKm(n,i,o));break;case dA.rads:lo(Zn.edgeLengthRads(n,i,o));break;default:throw ky(BC,e)}return Jk(o)}finally{Rr._free(o)}}function bAe(r,e){Hk(r);var t=Rr._malloc(nl);try{switch(e){case dA.m:lo(Zn.getHexagonEdgeLengthAvgM(r,t));break;case dA.km:lo(Zn.getHexagonEdgeLengthAvgKm(r,t));break;default:throw ky(BC,e)}return Jk(t)}finally{Rr._free(t)}}function qk(r){return r*Math.PI/180}function xAe(r){return r*180/Math.PI}function DC(r,e){e=e===void 0?r[0][0]:e;for(const t of r){const n=t[0]-e;n>180?t[0]-=360:n<-180&&(t[0]+=360)}}function wAe(r,e,t){const[n,i]=OC(r),o=e.length;DC(e,i);const s=e[0]===e[o-1]?o-1:o;for(let c=0;c<s;c++)e[c][0]=dc(i,e[c][0],t),e[c][1]=dc(n,e[c][1],t)}function CAe(r,e,t){const n=r(e,t),[i,o]=OC(n);return[o,i]}function YP(r,e=1){const t=Yk(r,!0);return e!==1?wAe(r,t,e):DC(t),t}function EAe(r){const e=new Float64Array(r.length*2);let t=0;for(const n of r)e[t++]=n[0],e[t++]=n[1];return e}const TAe=10;function BAe(r,e){let t;return r==null?t=e:typeof r=="object"?t={...r,coverage:e}:t={getHexagon:r,coverage:e},t}const SAe={...ef.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:r=>r.hexagon},extruded:!0};class al extends ys{initializeState(){al._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(e.highPrecision!==!0&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,n=!1;const{iterable:i,objectInfo:o}=sl(this.props.data);for(const s of i){o.index++;const c=this.props.getHexagon(s,o),f=Rx(c);if(e<0){if(e=f,!this.props.highPrecision)break}else if(e!==f){n=!0;break}if(dAe(c)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?bAe(e,"km"):0,hasMultipleRes:n,hasPentagon:t}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:t,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return!!(i!=null&&i.resolution)||n||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:n,centerHex:i}=this.state;if(t<0)return;const o=this.props.centerHexagon||FC(e.latitude,e.longitude,t);if(i===o)return;if(i)try{if(yAe(i,o)*n<TAe)return}catch{}const{unitsPerMeter:s}=e.distanceScales;let c=YP(o);const[f,_]=OC(o),[b,T]=e.projectFlat([_,f]);c=c.map(S=>{const D=e.projectFlat(S);return[(D[0]-b)/s[0],(D[1]-T)/s[1]]}),this.setState({centerHex:o,vertices:c})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:n,extruded:i,wireframe:o,stroked:s,filled:c,lineWidthUnits:f,lineWidthScale:_,lineWidthMinPixels:b,lineWidthMaxPixels:T,getFillColor:S,getElevation:D,getLineColor:N,getLineWidth:G,transitions:W,updateTriggers:z}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:o,stroked:s,filled:c,lineWidthUnits:f,lineWidthScale:_,lineWidthMinPixels:b,lineWidthMaxPixels:T,material:t,getElevation:D,getFillColor:S,getLineColor:N,getLineWidth:G,transitions:W,updateTriggers:{getFillColor:z.getFillColor,getElevation:z.getElevation,getLineColor:z.getLineColor,getLineWidth:z.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:n,coverage:i}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",ef),s=this._getForwardProps();return s.updateTriggers.getPolygon=BAe(n.getHexagon,i),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(c,f)=>{const _=t(c,f);return EAe(YP(_,i))}})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",ol),o=this._getForwardProps();return o.updateTriggers.getPosition=n.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:CAe.bind(null,t)})}}al.defaultProps=SAe;al.layerName="H3HexagonLayer";al._checkH3Lib=()=>{};const IAe={getHexagons:{type:"accessor",value:r=>r.hexagons}};class Ny extends tf{initializeState(){al._checkH3Lib()}updateState({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagons){const{data:n,getHexagons:i}=e,o=[],{iterable:s,objectInfo:c}=sl(n);for(const f of s){c.index++;const _=i(f,c),b=mAe(_,!0);for(const T of b){for(const S of T)DC(S);o.push(this.getSubLayerRow({polygon:T},f,c.index))}}this.setState({polygons:o})}}indexToBounds(){const{getElevation:e,getFillColor:t,getLineColor:n,getLineWidth:i}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(i)}}}Ny.layerName="H3ClusterLayer";Ny.defaultProps=IAe;const u1=Math.PI/180,sm=new Float32Array(16),qP=new Float32Array(12);function ZP(r,e,t){const n=e[0]*u1,i=e[1]*u1,o=e[2]*u1,s=Math.sin(o),c=Math.sin(n),f=Math.sin(i),_=Math.cos(o),b=Math.cos(n),T=Math.cos(i),S=t[0],D=t[1],N=t[2];r[0]=S*T*b,r[1]=S*f*b,r[2]=S*-c,r[3]=D*(-f*_+T*c*s),r[4]=D*(T*_+f*c*s),r[5]=D*b*s,r[6]=N*(f*s+T*c*_),r[7]=N*(-T*s+f*c*_),r[8]=N*b*_}function QP(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const Zk={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,{startRow:e,endRow:t}){const{data:n,getOrientation:i,getScale:o,getTranslation:s,getTransformMatrix:c}=this.props,f=Array.isArray(c),_=f&&c.length===16,b=Array.isArray(o),T=Array.isArray(i),S=Array.isArray(s),D=_||!f&&!!c(n[0]);D?r.constant=_:r.constant=T&&b&&S;const N=r.value;if(r.constant){let G;D?(sm.set(c),G=QP(sm)):(G=qP,ZP(G,i,o),G.set(s,9)),r.value=new Float32Array(G)}else{let G=e*r.size;const{iterable:W,objectInfo:z}=sl(n,e,t);for(const j of W){z.index++;let K;if(D)sm.set(_?c:c(j,z)),K=QP(sm);else{K=qP;const fe=T?i:i(j,z),Z=b?o:o(j,z);ZP(K,fe,Z),K.set(S?s:s(j,z),9)}N[G++]=K[0],N[G++]=K[1],N[G++]=K[2],N[G++]=K[3],N[G++]=K[4],N[G++]=K[5],N[G++]=K[6],N[G++]=K[7],N[G++]=K[8],N[G++]=K[9],N[G++]=K[10],N[G++]=K[11]}}}};function Qk(r,e){return e===Jr.CARTESIAN||e===Jr.METER_OFFSETS||e===Jr.DEFAULT&&!r.isGeospatial}const eR=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,MAe={name:"simpleMesh",vs:eR,fs:eR,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},PAe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,RAe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function FAe(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function e8(r){let e=1/0,t=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const c=r.POSITION?r.POSITION.value:[],f=c&&c.length;for(let _=0;_<f;_+=3){const b=c[_],T=c[_+1],S=c[_+2];e=b<e?b:e,t=T<t?T:t,n=S<n?S:n,i=b>i?b:i,o=T>o?T:o,s=S>s?S:s}return[[e,t,n],[i,o,s]]}function OAe(r,e,t){const n=FAe(e.value),i=t||DAe(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function DAe(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}function f1(r){const e=r.positions||r.POSITION;$r.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let n=r.COLOR_0||r.colors;n||(n={size:3,value:new Float32Array(t*3).fill(1)});let i=r.NORMAL||r.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let o=r.TEXCOORD_0||r.texCoords;return o||(o={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:o}}function tR(r){return r instanceof $s?(r.attributes=f1(r.attributes),r):r.attributes?new $s({...r,topology:"triangle-list",attributes:f1(r.attributes)}):new $s({topology:"triangle-list",attributes:f1(r)})}const LAe=[0,0,0,255],kAe={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:LAe},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class rh extends _s{getShaders(){return super.getShaders({vs:PAe,fs:RAe,modules:[Is,Ew,ca,MAe]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(n=t.header)==null?void 0:n.boundingBox,!e){const{attributes:i}=tR(t);i.POSITION=i.POSITION||i.positions,e=e8(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Zk}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var o;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;if(t.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,(o=this.state.model)==null||o.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const s=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==n.texture&&t.texture instanceof ki&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:o,coordinateSystem:s,_instanced:c}=this.props,f={sizeScale:o,composeModelMatrix:!c||Qk(n,s),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:f}),t.draw(i)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:tR(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,o={sampler:n||i,hasTexture:!!n};return t.shaderInputs.setProps({simpleMesh:o}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;if(n){const i={sampler:e||t,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}rh.defaultProps=kAe;rh.layerName="SimpleMeshLayer";var oc;(function(r){r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.ONE=1]="ONE",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.LINEAR=9729]="LINEAR",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(oc||(oc={}));function t8(r,e,t,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:o}=n;return o&&(i.bindings.pbr_diffuseEnvSampler=o.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=o.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=o.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(i.defines.HAS_NORMALS=1),t.TANGENT&&(n!=null&&n.useTangents)&&(i.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(i.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n!=null&&n.lights&&(i.defines.USE_LIGHTS=1),e&&NAe(r,e,i),i}function NAe(r,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&UAe(r,e.pbrMetallicRoughness,t),e.normalTexture){eg(r,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.normalScale=n}if(e.occlusionTexture){eg(r,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(eg(r,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=n;break;case"BLEND":Yt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=oc.FUNC_ADD,t.glParameters.blendFunc=[oc.SRC_ALPHA,oc.ONE_MINUS_SRC_ALPHA,oc.ONE,oc.ONE_MINUS_SRC_ALPHA];break}}function UAe(r,e,t){e.baseColorTexture&&eg(r,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&eg(r,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:i=1}=e;t.uniforms.metallicRoughnessValues=[n,i]}function eg(r,e,t,n=null,i){var b,T;const o=((T=(b=e==null?void 0:e.texture)==null?void 0:b.sampler)==null?void 0:T.parameters)||{},s=e.texture.source.image;let c,f={};s.compressed?(c=s,f={[oc.TEXTURE_MIN_FILTER]:s.data.length>1?oc.LINEAR_MIPMAP_NEAREST:oc.LINEAR}):c={data:s};const _=r.createTexture({id:e.uniformName||e.id,parameters:{...o,...f},pixelStore:{[oc.UNPACK_FLIP_Y_WEBGL]:!1},...c});i.bindings[t]=_,n&&(i.defines[n]=1),i.generatedTextures.push(_)}var rR,nR,iR,sR,oR,aR,cR,lR;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(rR||(rR={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(nR||(nR={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(iR||(iR={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(sR||(sR={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(oR||(oR={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(aR||(aR={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(cR||(cR={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(lR||(lR={}));const zAe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},GAe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class VAe{constructor(e){V(this,"name");V(this,"startTime",0);V(this,"playing",!0);V(this,"speed",1);V(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:i,target:o,path:s})=>{KAe(n,i,o,s),$Ae(o,o._node)})}}class HAe{constructor(e){V(this,"animations");this.animations=e.animations.map((t,n)=>{const i=t.name||`Animation-${n}`,o=t.samplers.map(({input:c,interpolation:f="LINEAR",output:_})=>({input:uR(e.accessors[c]),interpolation:f,output:uR(e.accessors[_])})),s=t.channels.map(({sampler:c,target:f})=>({sampler:o[c],target:e.nodes[f.node],path:f.path}));return new VAe({name:i,channels:s})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function uR(r){if(!r._animation){const e=GAe[r.componentType],t=zAe[r.type],n=t*r.count,{buffer:i,byteOffset:o}=r.bufferView.data,s=new e(i,o+(r.byteOffset||0),n);if(t===1)r._animation=Array.from(s);else{const c=[];for(let f=0;f<s.length;f+=t)c.push(Array.from(s.slice(f,f+t)));r._animation=c}}return r._animation}const jAe=new dn;function $Ae(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){const t=jAe.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}const h1=new og;function WAe(r,e,t,n,i){if(e==="rotation"){h1.slerp({start:t,target:n,ratio:i});for(let o=0;o<h1.length;o++)r[e][o]=h1[o]}else for(let o=0;o<t.length;o++)r[e][o]=i*n[o]+(1-i)*t[o]}function JAe(r,e,{p0:t,outTangent0:n,inTangent1:i,p1:o,tDiff:s,ratio:c}){for(let f=0;f<r[e].length;f++){const _=n[f]*s,b=i[f]*s;r[e][f]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*t[f]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*_+(-2*Math.pow(c,3)+3*Math.pow(c,2))*o[f]+(Math.pow(c,3)-Math.pow(c,2))*b}}function XAe(r,e,t){for(let n=0;n<t.length;n++)r[e][n]=t[n]}function KAe(r,{input:e,interpolation:t,output:n},i,o){const s=e[e.length-1],c=r%s,f=e.findIndex(S=>S>=c),_=Math.max(0,f-1);if(!Array.isArray(i[o]))switch(o){case"translation":i[o]=[0,0,0];break;case"rotation":i[o]=[0,0,0,1];break;case"scale":i[o]=[1,1,1];break;default:Yt.warn(`Bad animation path ${o}`)()}const b=e[_],T=e[f];switch(t){case"STEP":XAe(i,o,n[_]);break;case"LINEAR":if(T>b){const S=(c-b)/(T-b);WAe(i,o,n[_],n[f],S)}break;case"CUBICSPLINE":if(T>b){const S=(c-b)/(T-b),D=T-b,N=n[3*_+1],G=n[3*_+2],W=n[3*f+0],z=n[3*f+1];JAe(i,o,{p0:N,outTangent0:G,inTangent1:W,p1:z,tDiff:D,ratio:S})}break;default:Yt.warn(`Interpolation ${t} not supported`)();break}}const YAe=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,qAe=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,ZAe=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function QAe(r,e){const{id:t,geometry:n,material:i,vertexCount:o,materialOptions:s,modelOptions:c}=e,f=t8(r,i,n.attributes,s);Yt.info(4,"createGLTFModel defines: ",f.defines)();const _=[],b={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:t,source:YAe,vs:qAe,fs:ZAe,geometry:n,topology:n.topology,vertexCount:o,modules:[Tw],...c,defines:{...f.defines,...c.defines},parameters:{...b,...f.parameters,...c.parameters}},S=new Bi(r,T),{camera:D,...N}={...f.uniforms,...c.uniforms,...f.bindings,...c.bindings};return S.shaderInputs.setProps({pbrMaterial:N,pbrProjection:{camera:D}}),new z2({managedResources:_,model:S})}var Uf;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Uf||(Uf={}));function epe(r){switch(r){case Uf.POINTS:return"point-list";case Uf.LINES:return"line-list";case Uf.LINE_STRIP:return"line-strip";case Uf.TRIANGLES:return"triangle-list";case Uf.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(r))}}const tpe={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class rpe{constructor(e,t={}){V(this,"device");V(this,"options");V(this,"gltf");this.device=e,this.options={...tpe,...t}}instantiate(e){return this.gltf=Fx(e),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new HAe(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(o=>this.createNode(o));return new oA({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const i=(e.children||[]).map(s=>this.createNode(s));e.mesh&&i.push(this.createMesh(e.mesh));const o=new oA({id:e.name||e.id,children:i});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){const s=new dn().fromQuaternion(e.rotation);o.matrix.multiplyRight(s)}e.scale&&o.matrix.scale(e.scale)}e._node=o}const t=this.gltf.nodes.find(n=>n.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((o,s)=>this.createPrimitive(o,s,e)),i=new oA({id:e.name||e.id,children:n});e._mesh=i}return e._mesh}createPrimitive(e,t,n){const i=e.name||`${n.name||n.id}-primitive-${t}`,o=epe(e.mode||4),s=e.indices?e.indices.count:this.getVertexCount(e.attributes),c=QAe(this.device,{id:i,geometry:this.createGeometry(i,e,o),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:s});return c.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],c}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,n){const i={};for(const[o,s]of Object.entries(t.attributes)){const{components:c,size:f,value:_}=s;i[o]={size:f??c,value:_}}return new $s({id:e,topology:n,indices:t.indices.value,attributes:i})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[t]||(n.lumaBuffers[t]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function Fx(r){if(ArrayBuffer.isView(r)||r instanceof ArrayBuffer||r instanceof ImageBitmap)return r;if(Array.isArray(r))return r.map(Fx);if(r&&typeof r=="object"){const e={};for(const t in r)e[t]=Fx(r[t]);return e}return r}function npe(r,e,t){const n=new rpe(r,t),i=n.instantiate(e),o=n.createAnimator();return{scenes:i,animator:o}}function sa(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const r8={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},n8={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fR=["SCALAR","VEC2","VEC3","VEC4"],ipe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],spe=new Map(ipe),ope={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ape={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},cpe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function i8(r){return fR[r-1]||fR[0]}function LC(r){const e=spe.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function kC(r,e){const t=cpe[r.componentType],n=ope[r.type],i=ape[r.componentType],o=r.count*n,s=r.count*n*i;sa(s>=0&&s<=e.byteLength);const c=n8[r.componentType],f=r8[r.type];return{ArrayType:t,length:o,byteLength:s,componentByteSize:c,numberOfComponentsInElement:f}}function lpe(r,e,t){const n=r.bufferViews[t];sa(n);const i=n.buffer,o=e[i];sa(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function upe(r,e,t){var G,W;const n=typeof t=="number"?(G=r.accessors)==null?void 0:G[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(W=r.bufferViews)==null?void 0:W[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],c=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:f,length:_,componentByteSize:b,numberOfComponentsInElement:T}=kC(n,i),S=b*T,D=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new f(o,c,_);const N=new f(_);for(let z=0;z<n.count;z++){const j=new f(o,c+z*D,T);N.set(j,z*T)}return N}function fpe(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let uo=class{constructor(e){V(this,"gltf");V(this,"sourceBuffers");V(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||fpe(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];sa(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return upe(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(i,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return sa(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return sa(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(n){const f=this._addIndices(n);c.primitives[0].indices=f}return Number.isFinite(i)&&(c.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=My(e),i=t||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;sa(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Jl(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:i8(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:LC(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const c of this.sourceBuffers||[])i=Ck(c,n,i);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[o]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const o of i)n.min.push(o),n.max.push(o);for(let o=t;o<e.length;o+=t)for(let s=0;s<t;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}};function hR(r){return(r%1+1)%1}const s8={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},hpe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},o8={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function NC(r,e){return o8[e]*s8[r]}function Uy(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),o=zy(i,"SCALAR",t,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function zy(r,e,t,n=1){const i=s8[e],o=hpe[t],s=o8[t],c=n*i,f=c*s;let _=r.buffer,b=r.byteOffset;return b%s!==0&&(_=new Uint8Array(_).slice(b,b+f).buffer,b=0),new o(_,b,c)}function UC(r,e,t){var _,b,T,S,D;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],o=r.getTypedArrayForAccessor(i),s=r.gltf.json,c=e.index,f=(b=(_=s.textures)==null?void 0:_[c])==null?void 0:b.source;if(typeof f<"u"){const N=(S=(T=s.images)==null?void 0:T[f])==null?void 0:S.mimeType,G=(D=r.gltf.images)==null?void 0:D[f];if(G&&typeof G.width<"u"){const W=[];for(let z=0;z<o.length;z+=2){const j=dpe(G,N,o,z,e.channels);W.push(j)}return W}}return[]}function a8(r,e,t,n,i){if(!(t!=null&&t.length))return;const o=[];for(const b of t){let T=n.findIndex(S=>S===b);T===-1&&(T=n.push(b)-1),o.push(T)}const s=new Uint32Array(o),c=r.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,f=r.addBufferView(s,c,0),_=r.addAccessor(f,{size:1,componentType:LC(s),count:s.length});i.attributes[e]=_}function dpe(r,e,t,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=t[n],c=t[n+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const _=Ape(s,c,r,f);let b=0;for(const T of i){const S=typeof T=="number"?Object.values(o)[T]:o[T],D=_+S.offset,N=yC(r);if(N.data.length<=D)throw new Error(`${N.data.length} <= ${D}`);const G=N.data[D];b|=G<<S.shift}return b}function Ape(r,e,t,n=1){const i=t.width,o=hR(r)*(i-1),s=Math.round(o),c=t.height,f=hR(e)*(c-1),_=Math.round(f),b=t.components?t.components:n;return(_*i+s)*b}function c8(r,e,t,n,i){const o=[];for(let s=0;s<e;s++){const c=t[s],f=t[s+1]-t[s];if(f+c>n)break;const _=c/i,b=f/i;o.push(r.slice(_,_+b))}return o}function l8(r,e,t){const n=[];for(let i=0;i<e;i++){const o=i*t;n.push(r.slice(o,o+t))}return n}function u8(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let c=0;c<r;c++){const f=n[c+1]-n[c];if(f+s<=e.length){const _=e.subarray(s,f+s),b=o.decode(_);i.push(b),s+=f}}return i}return[]}const f8="EXT_mesh_features",ppe=f8;async function gpe(r,e){const t=new uo(r);mpe(t,e)}function mpe(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)_pe(r,i,e)}function _pe(r,e,t){var o,s,c;if(!((o=t==null?void 0:t.gltf)!=null&&o.loadBuffers))return;const n=(s=e.extensions)==null?void 0:s[f8],i=n==null?void 0:n.featureIds;if(i)for(const f of i){let _;if(typeof f.attribute<"u"){const b=`_FEATURE_ID_${f.attribute}`,T=e.attributes[b];_=r.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&((c=t==null?void 0:t.gltf)!=null&&c.loadImages)?_=UC(r,f.texture,e):_=[];f.data=_}}const ype=Object.freeze(Object.defineProperty({__proto__:null,decode:gpe,name:ppe},Symbol.toStringTag,{value:"Module"})),zC="EXT_structural_metadata",vpe=zC;async function bpe(r,e){const t=new uo(r);xpe(t,e)}function xpe(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(zC);t&&((i=e.gltf)!=null&&i.loadImages&&wpe(r,t),Cpe(r,t))}function wpe(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)Tpe(r,t,o,e)}function Cpe(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=Epe(i,o);s&&Spe(r,t,s)}}function Epe(r,e){for(const t of r)if(t.class===e)return t;return null}function Tpe(r,e,t,n){var s;if(!e)return;const i=(s=t.extensions)==null?void 0:s[zC],o=i==null?void 0:i.propertyTextures;if(o)for(const c of o){const f=e[c];Bpe(r,f,t,n)}}function Bpe(r,e,t,n){var o;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const c=`${i}_${s}`,f=(o=e.properties)==null?void 0:o[s];if(!f)continue;f.data||(f.data=[]);const _=f.data,b=UC(r,f,t);b!==null&&(a8(r,c,b,_,t),f.data=_,n.dataAttributeNames.push(c))}}function Spe(r,e,t){var o,s;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],_=(s=t.properties)==null?void 0:s[c];if(_){const b=Ipe(r,e,f,i,_);_.data=b}}}function Ipe(r,e,t,n,i){let o=[];const s=i.values,c=r.getTypedArrayForBufferView(s),f=Mpe(r,t,i,n),_=Ppe(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=Rpe(t,n,c,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=u8(n,c,f,_);break}case"ENUM":{o=Fpe(e,t,n,c,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function Mpe(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?Uy(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Ppe(r,e,t){return typeof e.stringOffsets<"u"?Uy(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function Rpe(r,e,t,n){const i=r.array,o=r.count,s=NC(r.type,r.componentType),c=t.byteLength/s;let f;return r.componentType?f=zy(t,r.type,r.componentType,c):f=t,i?n?c8(f,e,n,t.length,s):o?l8(f,e,o):[]:f}function Fpe(r,e,t,n,i){var T;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(T=r.enums)==null?void 0:T[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=s.valueType||"UINT16",f=NC(e.type,c),_=n.byteLength/f;let b=zy(n,e.type,c,_);if(b||(b=n),e.array){if(i)return Ope({valuesData:b,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:f,enumEntry:s});const S=e.count;return S?Dpe(b,t,S,s):[]}return GC(b,0,t,s)}function Ope(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=r,c=[];for(let f=0;f<t;f++){const _=n[f],b=n[f+1]-n[f];if(b+_>i)break;const T=_/o,S=b/o,D=GC(e,T,S,s);c.push(D)}return c}function Dpe(r,e,t,n){const i=[];for(let o=0;o<e;o++){const s=t*o,c=GC(r,s,t,n);i.push(c)}return i}function GC(r,e,t,n){const i=[];for(let o=0;o<t;o++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const s=r[e+o],c=Lpe(n,s);c?i.push(c.name):i.push("")}return i}function Lpe(r,e){for(const t of r.values)if(t.value===e)return t;return null}const kpe=Object.freeze(Object.defineProperty({__proto__:null,decode:bpe,name:vpe},Symbol.toStringTag,{value:"Module"})),h8="EXT_feature_metadata",Npe=h8;async function Upe(r,e){const t=new uo(r);zpe(t,e)}function zpe(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(h8);t&&((i=e.gltf)!=null&&i.loadImages&&Gpe(r,t),Vpe(r,t))}function Gpe(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],c=jpe(i,o);c&&Wpe(r,c,s)}}function Vpe(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=Hpe(i,o);s&&$pe(r,t,s)}}function Hpe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function jpe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function $pe(r,e,t){var o,s;if(!t.class)return;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],_=(s=t.properties)==null?void 0:s[c];if(_){const b=Jpe(r,e,f,i,_);_.data=b}}}function Wpe(r,e,t){var i;const n=e.class;for(const o in t.properties){const s=(i=e==null?void 0:e.properties)==null?void 0:i[o];if(s){const c=Zpe(r,s,n);s.data=c}}}function Jpe(r,e,t,n,i){let o=[];const s=i.bufferView,c=r.getTypedArrayForBufferView(s),f=Xpe(r,t,i,n),_=Kpe(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?o=u8(n,c,f,_):Ype(t)&&(o=qpe(t,n,c,f)),o}function Xpe(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?Uy(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Kpe(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?Uy(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Ype(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function qpe(r,e,t,n){const i=r.type==="ARRAY",o=r.componentCount,s="SCALAR",c=r.componentType||r.type,f=NC(s,c),_=t.byteLength/f,b=zy(t,s,c,_);return i?n?c8(b,e,n,t.length,f):o?l8(b,e,o):[]:b}function Zpe(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)Qpe(r,t,e,i,s);return i}function Qpe(r,e,t,n,i){const o={channels:t.channels,...t.texture},s=UC(r,o,i);s&&a8(r,e,s,n,i)}const ege=Object.freeze(Object.defineProperty({__proto__:null,decode:Upe,name:Npe},Symbol.toStringTag,{value:"Module"})),tge="4.2.4",rge="4.2.4",R_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let dR;async function AR(r){Kue(r.modules);const e=Yue("basis");return e||(dR||(dR=nge(r)),await dR)}async function nge(r){let e=null,t=null;return[e,t]=await Promise.all([await Zf(R_.TRANSCODER,"textures",r),await Zf(R_.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await ige(e,t)}function ige(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let d1;async function pR(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(d1=d1||sge(r),await d1)}async function sge(r){let e=null,t=null;return[e,t]=await Promise.all([await Zf(R_.ENCODER,"textures",r),await Zf(R_.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await oge(e,t)}function oge(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:c,BasisEncoder:f}=i;c(),n({BasisFile:o,KTX2File:s,BasisEncoder:f})})})}const Cd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},age=["","WEBKIT_","MOZ_"],gR={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let om=null;function cge(r){if(!om){r=r||lge()||void 0,om=new Set;for(const e of age)for(const t in gR)if(r&&r.getExtension(`${e}${t}`)){const n=gR[t];om.add(n)}}return om}function lge(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const ta=[171,75,84,88,32,50,48,187,13,10,26,10];function uge(r){const e=new Uint8Array(r);return!(e.byteLength<ta.length||e[0]!==ta[0]||e[1]!==ta[1]||e[2]!==ta[2]||e[3]!==ta[3]||e[4]!==ta[4]||e[5]!==ta[5]||e[6]!==ta[6]||e[7]!==ta[7]||e[8]!==ta[8]||e[9]!==ta[9]||e[10]!==ta[10]||e[11]!==ta[11])}const fge={etc1:{basisFormat:0,compressed:!0,format:Cd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Cd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Cd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Cd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Cd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Cd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function hge(r,e){if(e.basis.containerFormat==="auto"){if(uge(r)){const n=await pR(e);return mR(n.KTX2File,r,e)}const{BasisFile:t}=await AR(e);return A1(t,r,e)}switch(e.basis.module){case"encoder":const t=await pR(e);switch(e.basis.containerFormat){case"ktx2":return mR(t.KTX2File,r,e);case"basis":default:return A1(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await AR(e);return A1(n,r,e)}}function A1(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const c=n.getNumLevels(s),f=[];for(let _=0;_<c;_++)f.push(dge(n,s,_,t));o.push(f)}return o}finally{n.close(),n.delete()}}function dge(r,e,t,n){const i=r.getImageWidth(e,t),o=r.getImageHeight(e,t),s=r.getHasAlpha(),{compressed:c,format:f,basisFormat:_}=d8(n,s),b=r.getImageTranscodedSizeInBytes(e,t,_),T=new Uint8Array(b);if(!r.transcodeImage(T,e,t,_,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:T,compressed:c,format:f,hasAlpha:s}}function mR(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++){o.push(Age(n,s,t));break}return[o]}finally{n.close(),n.delete()}}function Age(r,e,t){const{alphaFlag:n,height:i,width:o}=r.getImageLevelInfo(e,0,0),{compressed:s,format:c,basisFormat:f}=d8(t,n),_=r.getImageTranscodedSizeInBytes(e,0,0,f),b=new Uint8Array(_);if(!r.transcodeImage(b,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:b,compressed:s,levelSize:_,hasAlpha:n,format:c}}function d8(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=VC()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),fge[t]}function VC(){const r=cge();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const pge={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:rge,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},A8={...pge,parse:hge},SA=!0,_R=1735152710,HC=12,F_=8,gge=1313821514,mge=5130562,_ge=0,yge=0,vge=1;function bge(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function xge(r,e=0,t={}){const n=new DataView(r),{magic:i=_R}=t,o=n.getUint32(e,!1);return o===i||o===_R}function wge(r,e,t=0,n={}){const i=new DataView(e),o=bge(i,t+0),s=i.getUint32(t+4,SA),c=i.getUint32(t+8,SA);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),t+=HC,r.version){case 1:return Cge(r,i,t);case 2:return Ege(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function Cge(r,e,t){ai(r.header.byteLength>HC+F_);const n=e.getUint32(t+0,SA),i=e.getUint32(t+4,SA);return t+=F_,ai(i===_ge),Ox(r,e,t,n),t+=n,t+=Dx(r,e,t,r.header.byteLength),t}function Ege(r,e,t,n){return ai(r.header.byteLength>HC+F_),Tge(r,e,t,n),t+r.header.byteLength}function Tge(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,SA),o=e.getUint32(t+4,SA);switch(t+=F_,o){case gge:Ox(r,e,t,i);break;case mge:Dx(r,e,t,i);break;case yge:n.strict||Ox(r,e,t,i);break;case vge:n.strict||Dx(r,e,t,i);break}t+=Jl(i,4)}return t}function Ox(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),s=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(s),Jl(n,4)}function Dx(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Jl(n,4)}function p8(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const Bge="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Sge="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Ige=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Mge=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Pge={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Rge={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Fge(r,e,t,n,i,o="NONE"){const s=await Oge();kge(s,s.exports[Rge[i]],r,e,t,n,s.exports[Pge[o||"NONE"]])}let p1;async function Oge(){return p1||(p1=Dge()),p1}async function Dge(){let r=Bge;WebAssembly.validate(Ige)&&(r=Sge,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Lge(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Lge(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?Mge[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function kge(r,e,t,n,i,o,s){const c=r.exports.sbrk,f=n+3&-4,_=c(f*i),b=c(o.length),T=new Uint8Array(r.exports.memory.buffer);T.set(o,b);const S=e(_,n,i,b,o.length);if(S===0&&s&&s(_,f,i),t.set(T.subarray(_,_+n*i)),c(_-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const O_="EXT_meshopt_compression",Nge=O_;async function Uge(r,e){var i,o;const t=new uo(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=[];for(const s of r.json.bufferViews||[])n.push(zge(t,s));await Promise.all(n),t.removeExtension(O_)}async function zge(r,e){const t=r.getObjectExtension(e,O_);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:c,filter:f="NONE",buffer:_}=t,b=r.gltf.buffers[_],T=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Fge(S,s,o,T,c,f),r.removeObjectExtension(e,O_)}}const Gge=Object.freeze(Object.defineProperty({__proto__:null,decode:Uge,name:Nge},Symbol.toStringTag,{value:"Module"})),Vd="EXT_texture_webp",Vge=Vd;function Hge(r,e){const t=new uo(r);if(!Pk("image/webp")){if(t.getRequiredExtensions().includes(Vd))throw new Error(`gltf: Required extension ${Vd} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Vd);o&&(i.source=o.source),t.removeObjectExtension(i,Vd)}t.removeExtension(Vd)}const jge=Object.freeze(Object.defineProperty({__proto__:null,name:Vge,preprocess:Hge},Symbol.toStringTag,{value:"Module"})),Um="KHR_texture_basisu",$ge=Um;function Wge(r,e){const t=new uo(r),{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Um);o&&(i.source=o.source,t.removeObjectExtension(i,Um))}t.removeExtension(Um)}const Jge=Object.freeze(Object.defineProperty({__proto__:null,name:$ge,preprocess:Wge},Symbol.toStringTag,{value:"Module"})),Xge="4.2.4",Kge={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Xge,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Yge(r,e,t){const n=g8(e.metadata),i=[],o=qge(e.attributes);for(const s in r){const c=r[s],f=yR(s,c,o[s]);i.push(f)}if(t){const s=yR("indices",t);i.push(s)}return{fields:i,metadata:n}}function qge(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function yR(r,e,t){const n=t?g8(t.metadata):void 0;return OAe(r,e,n)}function g8(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const vR={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Zge={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Qge=4;class e0e{constructor(e){V(this,"draco");V(this,"decoder");V(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const S=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(S)}const c=this._getDracoLoaderData(o,i,t),f=this._getMeshData(o,c,t),_=e8(f.attributes),b=Yge(f.attributes,c,f.indices);return{loader:"draco",loaderData:c,header:{vertexCount:o.num_points(),boundingBox:_},...f,schema:b}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const c=this._getQuantizationTransform(o,t);c&&(n[o.unique_id()].quantization_transform=c);const f=this._getOctahedronTransform(o,t);f&&(n[o.unique_id()].octahedron_transform=f)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const c=this._getAttributeValues(t,o);if(c){const{value:f,size:_}=c;i[s]={value:f,size:_,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*Qge,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,n).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),n0e(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=Zge[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,s=e.num_points()*i,c=s*n.BYTES_PER_ELEMENT,f=t0e(this.draco,n);let _;const b=this.draco._malloc(c);try{const T=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,f,c,b),_=new n(this.draco.HEAPF32.buffer,b,s).slice()}finally{this.draco._free(b)}return{value:_,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[s,c]of Object.entries(t.extraAttributes||{}))if(c===n)return s;const i=e.attribute_type;for(const s in vR)if(this.draco[s]===i)return vR[s];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=r0e(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(c=>s.min_value(c))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function t0e(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function r0e(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function n0e(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const i0e="1.5.6",s0e="1.4.1",g1=`https://www.gstatic.com/draco/versioned/decoders/${i0e}`,Oo={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},m1={[Oo.DECODER]:`${g1}/${Oo.DECODER}`,[Oo.DECODER_WASM]:`${g1}/${Oo.DECODER_WASM}`,[Oo.FALLBACK_DECODER]:`${g1}/${Oo.FALLBACK_DECODER}`,[Oo.ENCODER]:`https://raw.githubusercontent.com/google/draco/${s0e}/javascript/${Oo.ENCODER}`};let _1;async function o0e(r){const e=r.modules||{};return e.draco3d?_1||(_1=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):_1||(_1=a0e(r)),await _1}async function a0e(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await Zf(m1[Oo.FALLBACK_DECODER],"draco",r,Oo.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await Zf(m1[Oo.DECODER],"draco",r,Oo.DECODER),await Zf(m1[Oo.DECODER_WASM],"draco",r,Oo.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await c0e(e,t)}function c0e(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const jC={...Kge,parse:l0e};async function l0e(r,e){const{draco:t}=await o0e(e),n=new e0e(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}function u0e(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=m8(n);e[t]=i}}return e}function m8(r){const{buffer:e,size:t,count:n}=f0e(r);return{value:e,size:t,byteOffset:0,count:n,type:i8(t),componentType:LC(e)}}function f0e(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=h0e(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function h0e(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Wu="KHR_draco_mesh_compression",d0e=Wu;function A0e(r,e,t){const n=new uo(r);for(const i of _8(n))n.getObjectExtension(i,Wu)}async function p0e(r,e,t){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const n=new uo(r),i=[];for(const s of _8(n))n.getObjectExtension(s,Wu)&&i.push(m0e(n,s,e,t));await Promise.all(i),n.removeExtension(Wu)}function g0e(r,e={}){const t=new uo(r);for(const n of t.json.meshes||[])_0e(n),t.addRequiredExtension(Wu)}async function m0e(r,e,t,n){const i=r.getObjectExtension(e,Wu);if(!i)return;const o=r.getTypedArrayForBufferView(i.bufferView),s=Lg(o.buffer,o.byteOffset),c={...t};delete c["3d-tiles"];const f=await ph(s,jC,c,n),_=u0e(f.attributes);for(const[b,T]of Object.entries(_))if(b in e.attributes){const S=e.attributes[b],D=r.getAccessor(S);D!=null&&D.min&&(D!=null&&D.max)&&(T.min=D.min,T.max=D.max)}e.attributes=_,f.indices&&(e.indices=m8(f.indices)),r.removeObjectExtension(e,Wu),y0e(e)}function _0e(r,e,t=4,n,i){var b;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:r}),s=(b=i==null?void 0:i.parseSync)==null?void 0:b.call(i,{attributes:r}),c=n._addFauxAttributes(s.attributes),f=n.addBufferView(o);return{primitives:[{attributes:c,mode:t,extensions:{[Wu]:{bufferView:f,attributes:c}}}]}}function y0e(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*_8(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const v0e=Object.freeze(Object.defineProperty({__proto__:null,decode:p0e,encode:g0e,name:d0e,preprocess:A0e},Symbol.toStringTag,{value:"Module"})),Gy="KHR_texture_transform",b0e=Gy,am=new ft,x0e=new ci,w0e=new ci;async function C0e(r,e){var o;if(!new uo(r).hasExtension(Gy)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)E0e(s,r)}function E0e(r,e){var o,s,c,f;const t=(o=e.json.materials)==null?void 0:o[r],n=[(s=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(c=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:c.metallicRoughnessTexture],i=[];for(const _ of n)_&&((f=_==null?void 0:_.extensions)!=null&&f[Gy])&&T0e(e,r,_,i)}function T0e(r,e,t,n){const i=B0e(t,n);if(!i)return;const o=r.json.meshes||[];for(const s of o)for(const c of s.primitives){const f=c.material;Number.isFinite(f)&&e===f&&S0e(r,c,i)}}function B0e(r,e){var s;const t=(s=r.extensions)==null?void 0:s[Gy],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([c,f])=>c===n&&f===i)!==-1)){const c=P0e(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:c}}return null}function S0e(r,e,t){var c,f;const{originalTexCoord:n,texCoord:i,matrix:o}=t,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const _=(c=r.json.accessors)==null?void 0:c[s];if(_&&_.bufferView){const b=(f=r.json.bufferViews)==null?void 0:f[_.bufferView];if(b){const{arrayBuffer:T,byteOffset:S}=r.buffers[b.buffer],D=(S||0)+(_.byteOffset||0)+(b.byteOffset||0),{ArrayType:N,length:G}=kC(_,b),W=n8[_.componentType],z=r8[_.type],j=b.byteStride||W*z,K=new Float32Array(G);for(let fe=0;fe<_.count;fe++){const Z=new N(T,D+fe*j,2);am.set(Z[0],Z[1],1),am.transformByMatrix3(o),K.set([am[0],am[1]],fe*z)}n===i?I0e(_,b,r.buffers,K):M0e(i,_,e,r,K)}}}}function I0e(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function M0e(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=s.length-1)}function P0e(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new ci().set(1,0,0,0,1,0,e[0],e[1],1),o=x0e.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),s=w0e.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const R0e=Object.freeze(Object.defineProperty({__proto__:null,decode:C0e,name:b0e},Symbol.toStringTag,{value:"Module"})),jf="KHR_lights_punctual",F0e=jf;async function O0e(r){const e=new uo(r),{json:t}=e,n=e.getExtension(jf);n&&(e.json.lights=n.lights,e.removeExtension(jf));for(const i of t.nodes||[]){const o=e.getObjectExtension(i,jf);o&&(i.light=o.light),e.removeObjectExtension(i,jf)}}async function D0e(r){const e=new uo(r),{json:t}=e;if(t.lights){const n=e.addExtension(jf);sa(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,jf,n)}delete e.json.lights}}const L0e=Object.freeze(Object.defineProperty({__proto__:null,decode:O0e,encode:D0e,name:F0e},Symbol.toStringTag,{value:"Module"})),yg="KHR_materials_unlit",k0e=yg;async function N0e(r){const e=new uo(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,yg);e.removeExtension(yg)}function U0e(r){const e=new uo(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,yg,{}),e.addExtension(yg))}const z0e=Object.freeze(Object.defineProperty({__proto__:null,decode:N0e,encode:U0e,name:k0e},Symbol.toStringTag,{value:"Module"})),Np="KHR_techniques_webgl",G0e=Np;async function V0e(r){const e=new uo(r),{json:t}=e,n=e.getExtension(Np);if(n){const i=j0e(n,e);for(const o of t.materials||[]){const s=e.getObjectExtension(o,Np);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=$0e(o.technique,e)),e.removeObjectExtension(o,Np)}e.removeExtension(Np)}}async function H0e(r,e){}function j0e(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=t[s.program]}),i}function $0e(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const W0e=Object.freeze(Object.defineProperty({__proto__:null,decode:V0e,encode:H0e,name:G0e},Symbol.toStringTag,{value:"Module"})),y8=[kpe,ype,Gge,jge,Jge,v0e,L0e,z0e,W0e,R0e,ege];function J0e(r,e={},t){var i;const n=y8.filter(o=>v8(o.name,e));for(const o of n)(i=o.preprocess)==null||i.call(o,r,e,t)}async function X0e(r,e={},t){var i;const n=y8.filter(o=>v8(o.name,e));for(const o of n)await((i=o.decode)==null?void 0:i.call(o,r,e,t))}function v8(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const y1="KHR_binary_glTF";function K0e(r){const e=new uo(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,y1);i&&Object.assign(n,i),e.removeObjectExtension(n,y1)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(y1)}const bR={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Y0e={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let q0e=class{constructor(){V(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});V(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),K0e(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in bR)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in bR)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:o}=t;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,t){const n=Y0e[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=o.values)==null?void 0:t.tex)||((n=o.values)==null?void 0:n.texture2d_0)||((i=o.values)==null?void 0:i.diffuseTex),c=e.textures.findIndex(f=>f.id===s);c!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:c})}}};function Z0e(r,e={}){return new q0e().normalize(r,e)}async function Q0e(r,e,t=0,n,i){var o,s,c;return eme(r,e,t,n),Z0e(r,{normalize:(o=n==null?void 0:n.gltf)==null?void 0:o.normalize}),J0e(r,n,i),(s=n==null?void 0:n.gltf)!=null&&s.loadBuffers&&r.json.buffers&&await tme(r,n,i),(c=n==null?void 0:n.gltf)!=null&&c.loadImages&&await rme(r,n,i),await X0e(r,n,i),r}function eme(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!xge(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=wk(e);else if(e instanceof ArrayBuffer){const s={};t=wge(s,e,t,n.glb),sa(s.type==="glTF",`Invalid GLB magic string ${s.type}`),r._glb=s,r.json=s.json}else sa(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:s}=r._glb;r.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function tme(r,e,t){var i,o;const n=r.json.buffers||[];for(let s=0;s<n.length;++s){const c=n[s];if(c.uri){const{fetch:f}=t;sa(f);const _=p8(c.uri,e),b=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,_)),T=await((o=b==null?void 0:b.arrayBuffer)==null?void 0:o.call(b));r.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete c.uri}else r.buffers[s]===null&&(r.buffers[s]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function rme(r,e,t){const n=nme(r),i=r.json.images||[],o=[];for(const s of n)o.push(ime(r,i[s],s,e,t));return await Promise.all(o)}function nme(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function ime(r,e,t,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=p8(e.uri,n),{fetch:f}=i;o=await(await f(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const c=lpe(r.json,r.buffers,e.bufferView);o=Lg(c.buffer,c.byteOffset,c.byteLength)}sa(o,"glTF image has no data");let s=await ph(o,[_g,A8],{...n,mimeType:e.mimeType,basis:n.basis||{format:VC()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),r.images=r.images||[],r.images[t]=s}const Lx={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:tge,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:sme,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function sme(r,e={},t){e={...Lx.options,...e},e.gltf={...Lx.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Q0e({},r,n,e,t)}const ome={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ame={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ca={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},cme={magFilter:Ca.TEXTURE_MAG_FILTER,minFilter:Ca.TEXTURE_MIN_FILTER,wrapS:Ca.TEXTURE_WRAP_S,wrapT:Ca.TEXTURE_WRAP_T},lme={[Ca.TEXTURE_MAG_FILTER]:Ca.LINEAR,[Ca.TEXTURE_MIN_FILTER]:Ca.NEAREST_MIPMAP_LINEAR,[Ca.TEXTURE_WRAP_S]:Ca.REPEAT,[Ca.TEXTURE_WRAP_T]:Ca.REPEAT};function ume(){return{id:"default-sampler",parameters:lme}}function fme(r){return ame[r]}function hme(r){return ome[r]}let dme=class{constructor(){V(this,"baseUri","");V(this,"jsonUnprocessed");V(this,"json");V(this,"buffers",[]);V(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return sa(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const c in s)o.attributes[c]=this.getAccessor(s[c]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=fme(e.componentType),i=hme(e.type),o=n*i,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const c=s.bufferView.buffer,{ArrayType:f,byteLength:_}=kC(s,s.bufferView),b=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+c.byteOffset;let T=c.arrayBuffer.slice(b,b+_);s.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,b,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new f(T)}return s}_getValueFromInterleavedBuffer(e,t,n,i,o){const s=new Uint8Array(o*i);for(let c=0;c<o;c++){const f=t+c*n;s.set(new Uint8Array(e.arrayBuffer.slice(f,f+i)),c*i)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):ume(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return cme[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}};function Ame(r,e){return new dme().postProcess(r,e)}async function pme(r){const e=[];return r.scenes.forEach(t=>{t.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await gme(()=>e.some(t=>!t.loaded))}async function gme(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}const xR=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,mme={name:"scenegraph",vs:xR,fs:xR,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},_me=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yme=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,b8=[255,255,255,255],vme={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:b8},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Lx]};class zg extends _s{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=Tw,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[Is,ca,mme,t];return super.getShaders({defines:e,vs:_me,fs:yme,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:b8,transition:!0},instanceModelMatrix:Zk})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var c;const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof l_)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const f=e.scenegraph,_=f.json?Ame(f):f,b=npe(t,_,this._getModelOptions());n={gltf:_,...b},pme(b).then(()=>{this.setNeedsRedraw()}).catch(T=>{this.raiseError(T,"loading glTF")})}const i={layer:this,device:this.context.device},o=e.getScene(n,i),s=e.getAnimator(n,i);if(o instanceof oA){(c=this.state.scenegraph)==null||c.destroy(),this._applyAnimationsProp(s,e._animations);const f=[];o.traverse(_=>{_ instanceof z2&&f.push(_.model)}),this.setState({scenegraph:o,animator:s,models:f}),this.getAttributeManager().invalidateAll()}else o!==null&&$r.warn("invalid scenegraph:",o)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(i=>{const o=t[i];if(i==="*")n.forEach(s=>{Object.assign(s,o)});else if(Number.isFinite(Number(i))){const s=Number(i);s>=0&&s<n.length?Object.assign(n[s],o):$r.warn(`animation ${i} not found`)()}else{const s=n.find(({name:c})=>c===i);s?Object.assign(s,o):$r.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,coordinateSystem:c}=this.props,f=this.getNumInstances();this.state.scenegraph.traverse((_,{worldMatrix:b})=>{if(_ instanceof z2){const{model:T}=_;T.setInstanceCount(f);const S={camera:T.uniforms.cameraPosition},D={sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,composeModelMatrix:Qk(t,c),sceneModelMatrix:b};T.shaderInputs.setProps({pbrProjection:S,scenegraph:D}),T.draw(n)}})}}zg.defaultProps=vme;zg.layerName="ScenegraphLayer";const bme=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:zg,SimpleMeshLayer:rh},Symbol.toStringTag,{value:"Module"})),wR=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,xme={name:"mesh",vs:wR,fs:wR,uniformTypes:{pickFeatureIds:"f32"}},wme=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Cme=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Eme(r){const e=r.positions||r.POSITION,t=e.value.length/e.size;r.COLOR_0||r.colors||(r.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const Tme={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class $C extends rh{getShaders(){const e=super.getShaders();return e.modules.push(Tw,xme),{...e,vs:wme,fs:Cme}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!t},o={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:o,mesh:i}),super.draw(e)}getModel(e){const{id:t}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return Eme(e.attributes),new Bi(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:o}=i.bindings,{emptyTexture:s}=this.state,c={sampler:o||s,hasTexture:!!o},{camera:f,..._}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:c,pbrMaterial:_})}}parseMaterial(e,t){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return t8(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],i),n[o*3]=i[0],n[o*3+1]=i[1],n[o*3+2]=i[2];e.value=n}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}$C.layerName="MeshLayer";$C.defaultProps=Tme;const Bme=6378137,Sme=6378137,Ime=6356752314245179e-9;function Vy(r){return r}new ft;function Mme(r,e=[],t=Vy){return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Pme(r,e=[]){return Mme(r,e,ms._cartographicRadians?Vy:mH)}function Rme(r,e,t=Vy){return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Fme(r,e){return Rme(r,e,ms._cartographicRadians?Vy:_H)}const CR=1e-14,Ome=new ft,ER={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},v1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Tp={east:new ft,north:new ft,up:new ft,west:new ft,south:new ft,down:new ft},Dme=new ft,Lme=new ft,kme=new ft;function TR(r,e,t,n,i,o){const s=ER[e]&&ER[e][t];sc(s&&(!n||n===s));let c,f,_;const b=Ome.copy(i);if(aa(b.x,0,CR)&&aa(b.y,0,CR)){const S=Math.sign(b.z);c=Dme.fromArray(v1[e]),e!=="east"&&e!=="west"&&c.scale(S),f=Lme.fromArray(v1[t]),t!=="east"&&t!=="west"&&f.scale(S),_=kme.fromArray(v1[n]),n!=="east"&&n!=="west"&&_.scale(S)}else{const{up:S,east:D,north:N}=Tp;D.set(-b.y,b.x,0).normalize(),r.geodeticSurfaceNormal(b,S),N.copy(S).cross(D);const{down:G,west:W,south:z}=Tp;G.copy(S).scale(-1),W.copy(D).scale(-1),z.copy(N).scale(-1),c=Tp[e],f=Tp[t],_=Tp[n]}return o[0]=c.x,o[1]=c.y,o[2]=c.z,o[3]=0,o[4]=f.x,o[5]=f.y,o[6]=f.z,o[7]=0,o[8]=_.x,o[9]=_.y,o[10]=_.z,o[11]=0,o[12]=b.x,o[13]=b.y,o[14]=b.z,o[15]=1,o}const Ed=new ft,Nme=new ft,Ume=new ft;function zme(r,e,t=[]){const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:o}=e;Ed.from(r);const s=Ed.x,c=Ed.y,f=Ed.z,_=n.x,b=n.y,T=n.z,S=s*s*_*_,D=c*c*b*b,N=f*f*T*T,G=S+D+N,W=Math.sqrt(1/G);if(!Number.isFinite(W))return;const z=Nme;if(z.copy(r).scale(W),G<o)return z.to(t);const j=i.x,K=i.y,fe=i.z,Z=Ume;Z.set(z.x*j*2,z.y*K*2,z.z*fe*2);let ae=(1-W)*Ed.len()/(.5*Z.len()),Be=0,Le,de,_e,pe;do{ae-=Be,Le=1/(1+ae*j),de=1/(1+ae*K),_e=1/(1+ae*fe);const J=Le*Le,ne=de*de,ye=_e*_e,Ye=J*Le,we=ne*de,Ne=ye*_e;pe=S*J+D*ne+N*ye-1;const Qe=-2*(S*Ye*j+D*we*K+N*Ne*fe);Be=pe/Qe}while(Math.abs(pe)>kj);return Ed.scale([Le,de,_e]).to(t)}const cm=new ft,BR=new ft,Gme=new ft,Za=new ft,Vme=new ft,lm=new ft;class gi{constructor(e=0,t=0,n=0){this.centerToleranceSquared=Lj,sc(e>=0),sc(t>=0),sc(n>=0),this.radii=new ft(e,t,n),this.radiiSquared=new ft(e*e,t*t,n*n),this.radiiToTheFourth=new ft(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new ft(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new ft(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const n=BR,i=Gme,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(o),i.add(n),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){lm.from(e);const n=this.scaleToGeodeticSurface(lm,Za);if(!n)return;const i=this.geodeticSurfaceNormal(n,BR),o=Vme;o.copy(lm).subtract(n);const s=Math.atan2(i.y,i.x),c=Math.asin(i.z),f=Math.sign(vw(o,lm))*i6(o);return Fme([s,c,f],t)}eastNorthUpToFixedFrame(e,t=new dn){return TR(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i,o=new dn){return TR(this,e,t,n,i,o)}geocentricSurfaceNormal(e,t=[0,0,0]){return cm.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const n=Pme(e),i=n[0],o=n[1],s=Math.cos(o);return cm.set(s*Math.cos(i),s*Math.sin(i),Math.sin(o)).normalize(),cm.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return cm.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return zme(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){Za.from(e);const n=Za.x,i=Za.y,o=Za.z,s=this.oneOverRadiiSquared,c=1/Math.sqrt(n*n*s.x+i*i*s.y+o*o*s.z);return Za.multiplyScalar(c).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return Za.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return Za.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,n=[0,0,0]){sc(aa(this.radii.x,this.radii.y,p6)),sc(this.radii.z>0),Za.from(e);const i=Za.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return Za.set(0,0,i).to(n)}}gi.WGS84=new gi(Bme,Sme,Ime);class Hme{constructor(e,t,n){V(this,"item");V(this,"previous");V(this,"next");this.item=e,this.previous=t,this.next=n}}class jme{constructor(){V(this,"head",null);V(this,"tail",null);V(this,"_length",0)}get length(){return this._length}add(e){const t=new Hme(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class $me{constructor(){V(this,"_list");V(this,"_sentinel");V(this,"_trimTiles");this._list=new jme,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel;let c=i.head;for(;c!==s&&(e.gpuMemoryUsageInBytes>o||n);){const f=c.item;c=c.next,this.unloadTile(e,f,t)}}trim(){this._trimTiles=!0}}function Wme(r,e){ai(r),ai(e);const{rtcCenter:t,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:o}}=r;let s=new dn(i);switch(t&&s.translate(t),n){case"Z":break;case"Y":const T=new dn().rotateX(Math.PI/2);s=s.multiplyRight(T);break;case"X":const S=new dn().rotateY(-Math.PI/2);s=s.multiplyRight(S);break}e.isQuantized&&s.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const c=new ft(o);e.cartesianModelMatrix=s,e.cartesianOrigin=c;const f=gi.WGS84.cartesianToCartographic(c,new ft),b=gi.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=b.multiplyRight(s),e.cartographicOrigin=f,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const SR=new ft,b1=new ft,kx=new ia([new ic,new ic,new ic,new ic,new ic,new ic]);function Jme(r,e){const{cameraDirection:t,cameraUp:n,height:i}=r,{metersPerUnit:o}=r.distanceScales,s=zm(r,r.center),c=gi.WGS84.eastNorthUpToFixedFrame(s),f=r.unprojectPosition(r.cameraPosition),_=gi.WGS84.cartographicToCartesian(f,new ft),b=new ft(c.transformAsVector(new ft(t).scale(o))).normalize(),T=new ft(c.transformAsVector(new ft(n).scale(o))).normalize();Kme(r);const S=r.constructor,{longitude:D,latitude:N,width:G,bearing:W,zoom:z}=r,j=new S({longitude:D,latitude:N,height:i,width:G,bearing:W,zoom:z,pitch:0});return{camera:{position:_,direction:b,up:T},viewport:r,topDownViewport:j,height:i,cullingVolume:kx,frameNumber:e,sseDenominator:1.15}}function Xme(r,e,t){if(t===0||r.length<=t)return[r,[]];const n=[],{longitude:i,latitude:o}=e.viewport;for(const[_,b]of r.entries()){const[T,S]=b.header.mbs,D=Math.abs(i-T),N=Math.abs(o-S),G=Math.sqrt(N*N+D*D);n.push([_,G])}const s=n.sort((_,b)=>_[1]-b[1]),c=[];for(let _=0;_<t;_++)c.push(r[s[_][0]]);const f=[];for(let _=t;_<s.length;_++)f.push(r[s[_][0]]);return[c,f]}function Kme(r){const e=r.getFrustumPlanes(),t=IR(e.near,r.cameraPosition),n=zm(r,t),i=zm(r,r.cameraPosition,b1);let o=0;kx.planes[o++].fromPointNormal(n,SR.copy(n).subtract(i));for(const s in e){if(s==="near")continue;const c=e[s],f=IR(c,t,b1),_=zm(r,f,b1);kx.planes[o++].fromPointNormal(_,SR.copy(n).subtract(_))}}function IR(r,e,t=new ft){const n=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-n).add(e),t}function zm(r,e,t=new ft){const n=r.unprojectPosition(e);return gi.WGS84.cartographicToCartesian(n,t)}const Yme=6378137,qme=6378137,Nx=6356752314245179e-9,tA=new ft;function Zme(r,e){if(r instanceof Ug){const{halfAxes:t}=r,n=e_e(t);return Math.log2(Nx/(n+e[2]))}else if(r instanceof Ng){const{radius:t}=r;return Math.log2(Nx/(t+e[2]))}else if(r.width&&r.height){const{width:t,height:n}=r,i=Math.log2(Yme/t),o=Math.log2(qme/n);return(i+o)/2}return 1}function x8(r,e,t){gi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],tA);const n=Math.sqrt(Math.pow(tA[0]-t[0],2)+Math.pow(tA[1]-t[1],2)+Math.pow(tA[2]-t[2],2));return Math.log2(Nx/(n+e[2]))}function Qme(r,e,t){const[n,i,o,s]=r;return x8({xmax:o,ymax:s,zmax:0},e,t)}function e_e(r){r.getColumn(0,tA);const e=r.getColumn(1),t=r.getColumn(2);return tA.add(e).add(t).len()}const ra={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Ac;(function(r){r[r.ADD=1]="ADD",r[r.REPLACE=2]="REPLACE"})(Ac||(Ac={}));var Nl;(function(r){r.EMPTY="empty",r.SCENEGRAPH="scenegraph",r.POINTCLOUD="pointcloud",r.MESH="mesh"})(Nl||(Nl={}));var Ro;(function(r){r.I3S="I3S",r.TILES3D="TILES3D"})(Ro||(Ro={}));var IA;(function(r){r.GEOMETRIC_ERROR="geometricError",r.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(IA||(IA={}));const t_e={USE_OPTIMIZATION:1};function w8(r){return r!=null}const co=new ft,Gm=new ft,r_e=new ft,n_e=new ft,Ff=new ft,MR=new ft,PR=new ft,RR=new ft;function x1(r,e,t){if(ai(r,"3D Tile: boundingVolume must be defined"),r.box)return C8(r.box,e,t);if(r.region)return o_e(r.region);if(r.sphere)return s_e(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function i_e(r,e){if(r.box)return a_e(e);if(r.region){const[t,n,i,o,s,c]=r.region;return[[nc(t),nc(n),s],[nc(i),nc(o),c]]}if(r.sphere)return c_e(e);throw new Error("Unkown boundingVolume type")}function C8(r,e,t){const n=new ft(r[0],r[1],r[2]);e.transform(n,n);let i=[];if(r.length===10){const _=r.slice(3,6),b=new og;b.fromArray(r,6);const T=new ft([1,0,0]),S=new ft([0,1,0]),D=new ft([0,0,1]);T.transformByQuaternion(b),T.scale(_[0]),S.transformByQuaternion(b),S.scale(_[1]),D.transformByQuaternion(b),D.scale(_[2]),i=[...T.toArray(),...S.toArray(),...D.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const o=e.transformAsVector(i.slice(0,3)),s=e.transformAsVector(i.slice(3,6)),c=e.transformAsVector(i.slice(6,9)),f=new ci([o[0],o[1],o[2],s[0],s[1],s[2],c[0],c[1],c[2]]);return w8(t)?(t.center=n,t.halfAxes=f,t):new Ug(n,f)}function s_e(r,e,t){const n=new ft(r[0],r[1],r[2]);e.transform(n,n);const i=e.getScale(Gm),o=Math.max(Math.max(i[0],i[1]),i[2]),s=r[3]*o;return w8(t)?(t.center=n,t.radius=s,t):new Ng(n,s)}function o_e(r){const[e,t,n,i,o,s]=r,c=gi.WGS84.cartographicToCartesian([nc(e),nc(i),o],r_e),f=gi.WGS84.cartographicToCartesian([nc(n),nc(t),s],n_e),_=new ft().addVectors(c,f).multiplyByScalar(.5);return gi.WGS84.cartesianToCartographic(_,Ff),gi.WGS84.cartographicToCartesian([nc(n),Ff[1],Ff[2]],MR),gi.WGS84.cartographicToCartesian([Ff[0],nc(i),Ff[2]],PR),gi.WGS84.cartographicToCartesian([Ff[0],Ff[1],s],RR),C8([..._,...MR.subtract(_),...PR.subtract(_),...RR.subtract(_)],new dn)}function a_e(r){const e=E8(),{halfAxes:t}=r,n=new ft(t.getColumn(0)),i=new ft(t.getColumn(1)),o=new ft(t.getColumn(2));for(let s=0;s<2;s++){for(let c=0;c<2;c++){for(let f=0;f<2;f++)co.copy(r.center),co.add(n),co.add(i),co.add(o),T8(e,co),o.negate();i.negate()}n.negate()}return e}function c_e(r){const e=E8(),{center:t,radius:n}=r,i=gi.WGS84.scaleToGeodeticSurface(t,co);let o;i?o=gi.WGS84.geodeticSurfaceNormal(i):o=new ft(0,0,1);let s=new ft(o[2],-o[1],0);s.len()>0?s.normalize():s=new ft(0,1,0);const c=s.clone().cross(o);for(const f of[s,c,o]){Gm.copy(f).scale(n);for(let _=0;_<2;_++)co.copy(t),co.add(Gm),T8(e,co),Gm.negate()}return e}function E8(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function T8(r,e){gi.WGS84.cartesianToCartographic(e,co),r[0][0]=Math.min(r[0][0],co[0]),r[0][1]=Math.min(r[0][1],co[1]),r[0][2]=Math.min(r[0][2],co[2]),r[1][0]=Math.max(r[1][0],co[0]),r[1][1]=Math.max(r[1][1],co[1]),r[1][2]=Math.max(r[1][2],co[2])}new ft;new ft;new dn;new ft;new ft;new ft;function l_e(r,e){const t=r*e;return 1-Math.exp(-(t*t))}function u_e(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const t=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return l_e(e,t)*n}return 0}function f_e(r,e,t){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,o=t?i:r.lodMetricValue;if(o===0)return 0;const s=Math.max(r._distanceToCamera,1e-7),{height:c,sseDenominator:f}=e,{viewDistanceScale:_}=n.options;let b=o*c*(_||1)/(s*f);return b-=u_e(n,s),b}const w1=new ft,FR=new ft,Bu=new ft,OR=new ft,h_e=new ft,C1=new dn,DR=new dn;function d_e(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const t=2*B8(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function B8(r,e){const{topDownViewport:t}=e,n=r.header.mbs[1],i=r.header.mbs[0],o=r.header.mbs[2],s=r.header.mbs[3],c=[...r.boundingVolume.center],f=t.unprojectPosition(t.cameraPosition);gi.WGS84.cartographicToCartesian(f,w1),FR.copy(w1).subtract(c).normalize(),gi.WGS84.eastNorthUpToFixedFrame(c,C1),DR.copy(C1).invert(),Bu.copy(w1).transform(DR);const _=Math.sqrt(Bu[0]*Bu[0]+Bu[1]*Bu[1]),b=_*_/Bu[2];OR.copy([Bu[0],Bu[1],b]);const S=OR.transform(C1).subtract(c).normalize(),N=FR.cross(S).normalize().scale(s).add(c),G=gi.WGS84.cartesianToCartographic(N),W=t.project([i,n,o]),z=t.project(G);return h_e.copy(W).subtract(z).magnitude()}function A_e(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class LR{constructor(e=0){V(this,"_map",new Map);V(this,"_array");V(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return ai(e<this._array.length),this._array[e]}set(e,t){ai(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){ai(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){ai(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const p_e={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Hy{constructor(e){V(this,"options");V(this,"root",null);V(this,"selectedTiles",{});V(this,"requestedTiles",{});V(this,"emptyTiles",{});V(this,"lastUpdate",new Date().getTime());V(this,"updateDebounceTime",1e3);V(this,"_traversalStack",new LR);V(this,"_emptyTraversalStack",new LR);V(this,"_frameNumber",null);this.options={...p_e,...e}}traversalFinished(e){return!0}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const o=n.pop();let s=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),s=this.updateAndPushChildren(o,t,n,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const c=o.parent,f=!!(!c||c._shouldRefine),_=!s;o.hasRenderContent?o.refine===Ac.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===Ac.REPLACE&&(this.loadTile(o,t),_&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),_&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=s&&f}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:o,skipLevelOfDetail:s}=this.options,c=e.children;c.sort(this.compareDistanceToCamera.bind(this));const f=e.refine===Ac.REPLACE&&e.hasRenderContent&&!s;let _=!1,b=!0;for(const T of c)if(T._selectionDepth=i,T.isVisibleAndInRequestVolume?(n.find(T)&&n.delete(T),n.push(T),_=!0):(f||o)&&(this.loadTile(T,t),this.touchTile(T,t)),f){let S;if(T._inRequestVolume?T.hasRenderContent?S=T.contentAvailable:S=this.executeEmptyTraversal(T,t):S=!1,b=b&&S,!b)return!1}return _||(b=!1),b}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t,n=!1,i=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,n):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i);else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const o=i.pop(),s=!o.hasRenderContent&&this.canTraverse(o,t,!1,!1),c=!o.hasRenderContent&&o.children.length===0;if(!s&&!o.contentAvailable&&!c&&(n=!1),this.updateTile(o,t),o.isVisibleAndInRequestVolume||(this.loadTile(o,t),this.touchTile(o,t)),s){const f=o.children;for(const _ of f)i.push(_)}}return n}}const kR=new ft;function g_e(r){return r!=null}class Ux{constructor(e,t,n,i=""){V(this,"tileset");V(this,"header");V(this,"id");V(this,"url");V(this,"parent");V(this,"refine");V(this,"type");V(this,"contentUrl");V(this,"lodMetricType","geometricError");V(this,"lodMetricValue",0);V(this,"boundingVolume",null);V(this,"content",null);V(this,"contentState",ra.UNLOADED);V(this,"gpuMemoryUsageInBytes",0);V(this,"children",[]);V(this,"depth",0);V(this,"viewportIds",[]);V(this,"transform",new dn);V(this,"extensions",null);V(this,"implicitTiling",null);V(this,"userData",{});V(this,"computedTransform");V(this,"hasEmptyContent",!1);V(this,"hasTilesetContent",!1);V(this,"traverser",new Hy({}));V(this,"_cacheNode",null);V(this,"_frameNumber",null);V(this,"_expireDate",null);V(this,"_expiredContent",null);V(this,"_boundingBox");V(this,"_distanceToCamera",0);V(this,"_screenSpaceError",0);V(this,"_visibilityPlaneMask");V(this,"_visible");V(this,"_contentBoundingVolume");V(this,"_viewerRequestVolume");V(this,"_initialTransform",new dn);V(this,"_priority",0);V(this,"_selectedFrame",0);V(this,"_requestedFrame",0);V(this,"_selectionDepth",0);V(this,"_touchedFrame",0);V(this,"_centerZDepth",0);V(this,"_shouldRefine",!1);V(this,"_stackLength",0);V(this,"_visitedFrame",0);V(this,"_inRequestVolume",!1);V(this,"_lodJudge",null);this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ra.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ra.UNLOADED}get contentExpired(){return this.contentState===ra.EXPIRED}get contentFailed(){return this.contentState===ra.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=i_e(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Ro.I3S:return B8(this,e);case Ro.TILES3D:return f_e(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===Ac.ADD||t;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ra.UNLOADED)return-1;const i=this.parent,s=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ra.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ra.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,o={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await OA(n,i,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ra.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=ra.FAILED,n}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ra.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:ia.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==ia.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return kR.subVectors(t.center,e.position),e.direction.dot(kR)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(g_e(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ra.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new dn(e.transform):new dn;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new dn(i).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new dn;this._initialTransform=new dn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ra.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ia.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Ac.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=x1(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=x1(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=x1(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new dn){const t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return A_e(this.tileset.tileset)}}}class m_e extends Hy{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const s=e.children[0];this.updateTileVisibility(s,t),e._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===Ac.REPLACE,o=e._optimChildrenWithinParent===t_e.USE_OPTIMIZATION;if(i&&o&&n&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==Ac.ADD?!1:!this.shouldRefine(e,t,!0)}}class __e{constructor(){V(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){var i;return(((i=this.frameNumberMap.get(e))==null?void 0:i.get(t))||0)===0}}const E1={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class y_e{constructor(){V(this,"_statusMap");V(this,"pendingTilesRegister",new __e);this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:s}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:E1.REQUESTED},this.pendingTilesRegister.register(s,o),e().then(c=>{this._statusMap[t].status=E1.COMPLETED;const{frameNumber:f,viewport:{id:_}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(_,f),this._statusMap[t].callback(c,i)}).catch(c=>{this._statusMap[t].status=E1.ERROR;const{frameNumber:f,viewport:{id:_}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(_,f),n(c)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:o,viewport:{id:s}}=t;this.pendingTilesRegister.register(s,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class v_e extends Hy{constructor(t){super(t);V(this,"_tileManager");this._tileManager=new y_e}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=d_e(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const i=t.header.children||[],o=t.children,s=t.tileset;for(const c of i){const f=`${c.id}-${n.viewport.id}`,_=o&&o.find(b=>b.id===f);if(_)_&&this.updateTile(_,n);else{let b=()=>this._loadTile(c.id,s);this._tileManager.find(f)?this._tileManager.update(f,n):(s.tileset.nodePages&&(b=()=>s.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(b,f,S=>this._onTileLoad(S,t,f),n))}}return!1}async _loadTile(t,n){const{loader:i}=n,o=n.getTileUrl(`${n.url}/nodes/${t}`),s={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await OA(o,i,s)}_onTileLoad(t,n,i){const o=new Ux(n.tileset,t,n,i);n.children.push(o);const s=this._tileManager.find(o.id).frameState;this.updateTile(o,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(o,s)}}const b_e={description:"",ellipsoid:gi.WGS84,modelMatrix:new dn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},um="Tiles In Tileset(s)",T1="Tiles In Memory",NR="Tiles In View",UR="Tiles To Render",zR="Tiles Loaded",B1="Tiles Loading",GR="Tiles Unloaded",VR="Failed Tile Loads",HR="Points/Vertices",S1="Tile Memory Use",jR="Maximum Screen Space Error";class x_e{constructor(e,t){V(this,"options");V(this,"loadOptions");V(this,"type");V(this,"tileset");V(this,"loader");V(this,"url");V(this,"basePath");V(this,"modelMatrix");V(this,"ellipsoid");V(this,"lodMetricType");V(this,"lodMetricValue");V(this,"refine");V(this,"root",null);V(this,"roots",{});V(this,"asset",{});V(this,"description","");V(this,"properties");V(this,"extras",null);V(this,"attributions",{});V(this,"credits",{});V(this,"stats");V(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});V(this,"cartographicCenter",null);V(this,"cartesianCenter",null);V(this,"zoom",1);V(this,"boundingVolume",null);V(this,"dynamicScreenSpaceErrorComputedDensity",0);V(this,"maximumMemoryUsage",32);V(this,"gpuMemoryUsageInBytes",0);V(this,"memoryAdjustedScreenSpaceError",0);V(this,"_cacheBytes",0);V(this,"_cacheOverflowBytes",0);V(this,"_frameNumber",0);V(this,"_queryParams",{});V(this,"_extensionsUsed",[]);V(this,"_tiles",{});V(this,"_pendingCount",0);V(this,"selectedTiles",[]);V(this,"traverseCounter",0);V(this,"geometricError",0);V(this,"lastUpdatedVieports",null);V(this,"_requestedTiles",[]);V(this,"_emptyTiles",[]);V(this,"frameStateData",{});V(this,"_traverser");V(this,"_cache",new $me);V(this,"_requestScheduler");V(this,"updatePromise",null);V(this,"tilesetInitializationPromise");this.options={...b_e,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Tk(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Ek({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new fL({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const o=i.id;this._needTraverse(o)?n.push(o):this.traverseCounter--}for(const i of t){const o=i.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!n.includes(o))continue;const s=Jme(i,this._frameNumber);this._traverser.traverse(this.roots[o],s,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[o,s]=Xme(i,e,this.options.maximumTilesSelected);n.selectedTiles=o;for(const c of s)c.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(s=>s.id)),i=new Set(t.map(s=>s.id));let o=e.filter(s=>!i.has(s.id)).length>0;return o=o||t.filter(s=>!n.has(s.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(NR).count=this.selectedTiles.length,this.stats.get(UR).count=e,this.stats.get(HR).count=t,this.stats.get(jR).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Ro.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Ro.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Ro.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var n;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:o,ymin:s,ymax:c,zmin:f,zmax:_}=e;this.cartographicCenter=new ft(i+(o-i)/2,s+(c-s)/2,f+(_-f)/2),this.cartesianCenter=new ft,gi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=x8(e,this.cartographicCenter,this.cartesianCenter);return}const t=(n=this.tileset.store)==null?void 0:n.extent;if(t){const[i,o,s,c]=t;this.cartographicCenter=new ft(i+(s-i)/2,o+(c-o)/2,0),this.cartesianCenter=new ft,gi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Qme(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ft,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ft,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new ft,gi.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new ft(0,0,-gi.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=Zme(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(um),this.stats.get(B1),this.stats.get(T1),this.stats.get(NR),this.stats.get(UR),this.stats.get(zR),this.stats.get(GR),this.stats.get(VR),this.stats.get(HR),this.stats.get(S1,"memory"),this.stats.get(jR)}_initializeTileHeaders(e,t){var i;const n=new Ux(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===Ro.TILES3D){const o=[];for(o.push(n);o.length>0;){const s=o.pop();this.stats.get(um).incrementCount();const c=s.header.children||[];for(const f of c){const _=new Ux(this,f,s);if((i=_.contentUrl)!=null&&i.includes("?session=")){const T=new URL(_.contentUrl).searchParams.get("session");T&&(this._queryParams.session=T)}s.children.push(_),_.depth=s.depth+1,o.push(_)}}}return n}_initializeTraverser(){let e;switch(this.type){case Ro.TILES3D:e=m_e;break;case Ro.I3S:e=v_e;break;default:e=Hy}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(VR).incrementCount();const n=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,t){var n,i;if(t){if(this.type===Ro.I3S){const o=((i=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:i.nodesInNodePages)||0;this.stats.get(um).reset(),this.stats.get(um).addCount(o)}e&&e.content&&Wme(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===Ro.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ro.TILES3D){const{extensionsRemoved:n=[]}=((t=e.content)==null?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(B1).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(B1).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(zR).incrementCount(),this.stats.get(T1).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(S1).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(T1).decrementCount(),this.stats.get(GR).incrementCount(),this.stats.get(S1).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const S8="4.2.4",Bp={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function I8(r,e,t){ai(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,e,t);return n.decode(i)}function w_e(r,e=0){const t=new DataView(r);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const C_e={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},as={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Dn={...C_e,...as},I1={[as.DOUBLE]:Float64Array,[as.FLOAT]:Float32Array,[as.UNSIGNED_SHORT]:Uint16Array,[as.UNSIGNED_INT]:Uint32Array,[as.UNSIGNED_BYTE]:Uint8Array,[as.BYTE]:Int8Array,[as.SHORT]:Int16Array,[as.INT]:Int32Array},E_e={DOUBLE:as.DOUBLE,FLOAT:as.FLOAT,UNSIGNED_SHORT:as.UNSIGNED_SHORT,UNSIGNED_INT:as.UNSIGNED_INT,UNSIGNED_BYTE:as.UNSIGNED_BYTE,BYTE:as.BYTE,SHORT:as.SHORT,INT:as.INT},M1="Failed to convert GL type";class Zc{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in I1)if(I1[t]===e)return t;throw new Error(M1)}static fromName(e){const t=E_e[e];if(!t)throw new Error(M1);return t}static getArrayType(e){switch(e){case as.UNSIGNED_SHORT_5_6_5:case as.UNSIGNED_SHORT_4_4_4_4:case as.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=I1[e];if(!t)throw new Error(M1);return t}}static getByteSize(e){return Zc.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Zc.getArrayType(e)}static createTypedArray(e,t,n=0,i){i===void 0&&(i=(t.byteLength-n)/Zc.getByteSize(e));const o=Zc.getArrayType(e);return new o(t,n,i)}}function T_e(r,e){if(!r)throw new Error(`math.gl assertion failed. ${e}`)}function B_e(r,e=[0,0,0]){const t=r>>11&31,n=r>>5&63,i=r&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new yw;new ft;new yw;new yw;function $R(r,e=255){return Ll(r,0,e)/e*2-1}function WR(r){return r<0?-1:1}function S_e(r,e,t,n){if(T_e(n),r<0||r>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(n.x=$R(r,t),n.y=$R(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*WR(i),n.y=(1-Math.abs(i))*WR(n.y)}return n.normalize()}function I_e(r,e,t){return S_e(r,e,255,t)}class WC{constructor(e,t){V(this,"json");V(this,"buffer");V(this,"featuresLength",0);V(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=Dn.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=Zc.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,o){const s=this.json[e];if(!s)return s;const c=this.getPropertyArray(e,t,n);if(n===1)return c[i];for(let f=0;f<n;++f)o[f]=c[n*i+f];return o}_getTypedArrayFromBinary(e,t,n,i,o){const s=this._cachedTypedArrays;let c=s[e];return c||(c=Zc.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,i*n),s[e]=c),c}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let o=i[e];return o||(o=Zc.createTypedArray(t,n),i[e]=o),o}}const M_e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},P_e={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},R_e={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function F_e(r,e,t,n){const{componentType:i}=r;ai(r.componentType);const o=typeof i=="string"?Zc.fromName(i):i,s=M_e[r.type],c=P_e[r.type],f=R_e[r.type];return t+=r.byteOffset,{values:Zc.createTypedArray(o,e,t,s*n),type:o,size:s,unpacker:c,packer:f}}const qc=r=>r!==void 0;function O_e(r,e,t){if(!e)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?D_e(n,t):null}function D_e(r,e){let t,n,i;const o=r.instancesLength,s=r.classes;let c=r.classIds,f=r.parentCounts,_=r.parentIds,b=o;qc(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,o));let T;if(qc(f))for(qc(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,o)),T=new Uint16Array(o),b=0,t=0;t<o;++t)T[t]=b,b+=f[t];qc(_)&&qc(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,i=getBinaryAccessor(_),_=i.createArrayBufferView(e.buffer,e.byteOffset+_.byteOffset,b));const S=s.length;for(t=0;t<S;++t){const W=s[t].length,z=s[t].instances,j=getBinaryProperties(W,z,e);s[t].instances=combine(j,z)}const D=new Array(S).fill(0),N=new Uint16Array(o);for(t=0;t<o;++t)n=c[t],N[t]=D[n],++D[n];const G={classes:s,classIds:c,classIndexes:N,parentCounts:f,parentIndexes:T,parentIds:_};return N_e(G),G}function Sp(r,e,t){if(!r)return;const n=r.parentCounts;return r.parentIds?t(r,e):n>0?L_e(r,e,t):k_e(r,e,t)}function L_e(r,e,t){const n=r.classIds,i=r.parentCounts,o=r.parentIds,s=r.parentIndexes,c=n.length,f=scratchVisited;f.length=Math.max(f.length,c);const _=++marker,b=scratchStack;for(b.length=0,b.push(e);b.length>0;){if(e=b.pop(),f[e]===_)continue;f[e]=_;const T=t(r,e);if(qc(T))return T;const S=i[e],D=s[e];for(let N=0;N<S;++N){const G=o[D+N];G!==e&&b.push(G)}}return null}function k_e(r,e,t){let n=!0;for(;n;){const i=t(r,e);if(qc(i))return i;const o=r.parentIds[e];n=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function N_e(r){const t=r.classIds.length;for(let n=0;n<t;++n)M8(r,n,stack)}function M8(r,e,t){const n=r.parentCounts,i=r.parentIds,o=r.parentIndexes,c=r.classIds.length;if(!qc(i))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const f=qc(n)?n[e]:1,_=qc(n)?o[e]:e;for(let b=0;b<f;++b){const T=i[_+b];T!==e&&M8(r,T,t)}t.pop(e)}function Po(r){return r!=null}const fm=(r,e)=>r,U_e={HIERARCHY:!0,extensions:!0,extras:!0};class P8{constructor(e,t,n,i={}){V(this,"json");V(this,"binary");V(this,"featureCount");V(this,"_extensions");V(this,"_properties");V(this,"_binaryProperties");V(this,"_hierarchy");var o;ai(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=((o=this.json)==null?void 0:o.extensions)||{},this._properties={};for(const s in this.json)U_e[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=O_e(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),ai(typeof t=="string",t),this._hierarchy){const n=Sp(this._hierarchy,e,(i,o)=>{const s=i.classIds[o];return i.classes[s].name===t});return Po(n)}return!1}isExactClass(e,t){return ai(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),ai(typeof t=="string",t),Po(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Po(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),ai(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(Po(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(Po(n))return fm(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(Po(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),ai(typeof t=="string",t),this._binaryProperties){const s=this._binaryProperties[t];if(s){this._setBinaryProperty(s,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let o=this._properties[t];Po(o)||(this._properties[t]=new Array(i),o=this._properties[t]),o[e]=fm(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;ai(this.binary,`Property ${e} requires a batch table binary.`),ai(n.type,`Property ${e} requires a type.`);const i=F_e(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=Sp(this._hierarchy,e,(i,o)=>{const s=i.classIds[o],c=i.classes[s].instances;return Po(c[t])});return Po(n)}_getPropertyNamesInHierarchy(e,t){Sp(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o].instances;for(const c in s)s.hasOwnProperty(c)&&t.indexOf(c)===-1&&t.push(c)})}_getHierarchyProperty(e,t){return Sp(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o],c=n.classIndexes[i],f=s.instances[t];return Po(f)?Po(f.typedArray)?this._getBinaryProperty(f,c):fm(f[c]):null})}_setHierarchyProperty(e,t,n,i){const o=Sp(this._hierarchy,t,(s,c)=>{const f=s.classIds[c],_=s.classes[f],b=s.classIndexes[c],T=_.instances[n];return Po(T)?(ai(c===t,`Inherited property "${n}" is read-only.`),Po(T.typedArray)?this._setBinaryProperty(T,b,i):T[b]=fm(i),!0):!1});return Po(o)}}const P1=4;function jy(r,e,t=0){const n=new DataView(e);if(r.magic=n.getUint32(t,!0),t+=P1,r.version=n.getUint32(t,!0),t+=P1,r.byteLength=n.getUint32(t,!0),t+=P1,r.version!==1)throw new Error(`3D Tile Version ${r.version} not supported`);return t}const Td=4,JR="b3dm tile in legacy format.";function JC(r,e,t){const n=new DataView(e);let i;r.header=r.header||{};let o=n.getUint32(t,!0);t+=Td;let s=n.getUint32(t,!0);t+=Td;let c=n.getUint32(t,!0);t+=Td;let f=n.getUint32(t,!0);return t+=Td,c>=570425344?(t-=Td*2,i=o,c=s,f=0,o=0,s=0,console.warn(JR)):f>=570425344&&(t-=Td,i=c,c=o,f=s,o=0,s=0,console.warn(JR)),r.header.featureTableJsonByteLength=o,r.header.featureTableBinaryByteLength=s,r.header.batchTableJsonByteLength=c,r.header.batchTableBinaryByteLength=f,r.header.batchLength=i,t}function XC(r,e,t,n){return t=z_e(r,e,t),t=G_e(r,e,t),t}function z_e(r,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:o,batchLength:s}=r.header||{};if(r.featureTableJson={BATCH_LENGTH:s||0},i&&i>0){const c=I8(e,t,i);r.featureTableJson=JSON.parse(c)}return t+=i||0,r.featureTableBinary=new Uint8Array(e,t,o),t+=o||0,t}function G_e(r,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:o}=r.header||{};if(i&&i>0){const s=I8(e,t,i);r.batchTableJson=JSON.parse(s),t+=i,o&&o>0&&(r.batchTableBinary=new Uint8Array(e,t,o),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=o)}return t}function R8(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:o=0}=r;if(n&&t){const s=new Uint8ClampedArray(o*3);for(let c=0;c<o;c++){const f=n[c],b=t.getProperty(f,"dimensions").map(T=>T*255);s[c*3]=b[0],s[c*3+1]=b[1],s[c*3+2]=b[2]}return{type:Dn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(e&&i){const s=new Uint8ClampedArray(o*3);for(let c=0;c<o;c++){const f=B_e(e[c]);s[c*3]=f[0],s[c*3+1]=f[1],s[c*3+2]=f[2]}return{type:Dn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}return e&&e.length===o*3?{type:Dn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Dn.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const XR=new ft;function V_e(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array((r.pointsLength||0)*3);for(let n=0;n<(r.pointsLength||0);n++)I_e(e[n*2],e[n*2+1],XR),XR.toArray(t,n*3);return{type:Dn.FLOAT,size:2,value:t}}return{type:Dn.FLOAT,size:2,value:e}}function H_e(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,j_e(r,e)):{type:Dn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function j_e(r,e){const t=new ft,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function $_e(r,e,t,n,i){t=jy(r,e,t),t=JC(r,e,t),t=XC(r,e,t),W_e(r);const{featureTable:o,batchTable:s}=J_e(r);return await Z_e(r,o,s,n,i),X_e(r,o,n),K_e(r,o,s),Y_e(r,o),t}function W_e(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function J_e(r){const e=new WC(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",Dn.FLOAT,3);const n=q_e(r,e);return{featureTable:e,batchTable:n}}function X_e(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",Dn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Dn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Dn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Dn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=H_e(r,n,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function K_e(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Dn.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Dn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Dn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=R8(r,n,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Dn.UNSIGNED_BYTE,4))}function Y_e(r,e){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Dn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Dn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=V_e(r,t)}}function q_e(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",Dn.UNSIGNED_SHORT,1),r.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:o}=r;t=new P8(i,o,n)}return t}async function Z_e(r,e,t,n,i){let o,s,c;const f=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(c=f.properties);const _=e.getExtension("3DTILES_draco_point_compression");if(_){s=_.properties;const T=_.byteOffset,S=_.byteLength;if(!s||!Number.isFinite(T)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(r.featureTableBinary||[]).slice(T,T+S),r.hasPositions=Number.isFinite(s.POSITION),r.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),r.hasNormals=Number.isFinite(s.NORMAL),r.hasBatchIds=Number.isFinite(s.BATCH_ID),r.isTranslucent=Number.isFinite(s.RGBA)}if(!o)return!0;const b={buffer:o,properties:{...s,...c},batchTableProperties:c};return await Q_e(r,b,n,i)}async function Q_e(r,e,t,n){if(!n)return;const i={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const o=await ph(e.buffer,jC,i,n),s=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,f=o.attributes.NORMAL&&o.attributes.NORMAL.value,_=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,b=s&&o.attributes.POSITION.value.quantization,T=f&&o.attributes.NORMAL.value.quantization;if(b){const D=o.POSITION.data.quantization,N=D.range;r.quantizedVolumeScale=new ft(N,N,N),r.quantizedVolumeOffset=new ft(D.minValues),r.quantizedRange=(1<<D.quantizationBits)-1,r.isQuantizedDraco=!0}T&&(r.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const S={};if(e.batchTableProperties)for(const D of Object.keys(e.batchTableProperties))o.attributes[D]&&o.attributes[D].value&&(S[D.toLowerCase()]=o.attributes[D].value);r.attributes={positions:s,colors:R8(r,c,void 0),normals:f,batchIds:_,...S}}function oa(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const F8={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O8={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},eye=1.33,KR=["SCALAR","VEC2","VEC3","VEC4"],tye=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],rye=new Map(tye),nye={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iye={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},sye={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function D8(r){return KR[r-1]||KR[0]}function KC(r){const e=rye.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function YC(r,e){const t=sye[r.componentType],n=nye[r.type],i=iye[r.componentType],o=r.count*n,s=r.count*n*i;oa(s>=0&&s<=e.byteLength);const c=O8[r.componentType],f=F8[r.type];return{ArrayType:t,length:o,byteLength:s,componentByteSize:c,numberOfComponentsInElement:f}}function L8(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const n=e.map(s=>s.bufferView);t=t.filter(s=>!n.includes(s));const i=t.reduce((s,c)=>s+c.byteLength,0),o=e.reduce((s,c)=>{const{width:f,height:_}=c.image;return s+f*_},0);return i+Math.ceil(4*o*eye)}function oye(r,e,t){const n=r.bufferViews[t];oa(n);const i=n.buffer,o=e[i];oa(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function aye(r,e,t){var G,W;const n=typeof t=="number"?(G=r.accessors)==null?void 0:G[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(W=r.bufferViews)==null?void 0:W[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],c=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:f,length:_,componentByteSize:b,numberOfComponentsInElement:T}=YC(n,i),S=b*T,D=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new f(o,c,_);const N=new f(_);for(let z=0;z<n.count;z++){const j=new f(o,c+z*D,T);N.set(j,z*T)}return N}function cye(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class fo{constructor(e){V(this,"gltf");V(this,"sourceBuffers");V(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||cye(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];oa(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return aye(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(i,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return oa(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return oa(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(n){const f=this._addIndices(n);c.primitives[0].indices=f}return Number.isFinite(i)&&(c.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=My(e),i=t||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;oa(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Jl(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:D8(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:KC(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const c of this.sourceBuffers||[])i=Ck(c,n,i);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[o]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const o of i)n.min.push(o),n.max.push(o);for(let o=t;o<e.length;o+=t)for(let s=0;s<t;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}}function YR(r){return(r%1+1)%1}const k8={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},lye={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},N8={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function qC(r,e){return N8[e]*k8[r]}function $y(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),o=Wy(i,"SCALAR",t,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function Wy(r,e,t,n=1){const i=k8[e],o=lye[t],s=N8[t],c=n*i,f=c*s;let _=r.buffer,b=r.byteOffset;return b%s!==0&&(_=new Uint8Array(_).slice(b,b+f).buffer,b=0),new o(_,b,c)}function ZC(r,e,t){var _,b,T,S,D;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],o=r.getTypedArrayForAccessor(i),s=r.gltf.json,c=e.index,f=(b=(_=s.textures)==null?void 0:_[c])==null?void 0:b.source;if(typeof f<"u"){const N=(S=(T=s.images)==null?void 0:T[f])==null?void 0:S.mimeType,G=(D=r.gltf.images)==null?void 0:D[f];if(G&&typeof G.width<"u"){const W=[];for(let z=0;z<o.length;z+=2){const j=uye(G,N,o,z,e.channels);W.push(j)}return W}}return[]}function U8(r,e,t,n,i){if(!(t!=null&&t.length))return;const o=[];for(const b of t){let T=n.findIndex(S=>S===b);T===-1&&(T=n.push(b)-1),o.push(T)}const s=new Uint32Array(o),c=r.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,f=r.addBufferView(s,c,0),_=r.addAccessor(f,{size:1,componentType:KC(s),count:s.length});i.attributes[e]=_}function uye(r,e,t,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=t[n],c=t[n+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const _=fye(s,c,r,f);let b=0;for(const T of i){const S=typeof T=="number"?Object.values(o)[T]:o[T],D=_+S.offset,N=yC(r);if(N.data.length<=D)throw new Error(`${N.data.length} <= ${D}`);const G=N.data[D];b|=G<<S.shift}return b}function fye(r,e,t,n=1){const i=t.width,o=YR(r)*(i-1),s=Math.round(o),c=t.height,f=YR(e)*(c-1),_=Math.round(f),b=t.components?t.components:n;return(_*i+s)*b}function z8(r,e,t,n,i){const o=[];for(let s=0;s<e;s++){const c=t[s],f=t[s+1]-t[s];if(f+c>n)break;const _=c/i,b=f/i;o.push(r.slice(_,_+b))}return o}function G8(r,e,t){const n=[];for(let i=0;i<e;i++){const o=i*t;n.push(r.slice(o,o+t))}return n}function V8(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let c=0;c<r;c++){const f=n[c+1]-n[c];if(f+s<=e.length){const _=e.subarray(s,f+s),b=o.decode(_);i.push(b),s+=f}}return i}return[]}const H8="EXT_mesh_features",hye=H8;async function dye(r,e){const t=new fo(r);Aye(t,e)}function Aye(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)pye(r,i,e)}function pye(r,e,t){var o,s,c;if(!((o=t==null?void 0:t.gltf)!=null&&o.loadBuffers))return;const n=(s=e.extensions)==null?void 0:s[H8],i=n==null?void 0:n.featureIds;if(i)for(const f of i){let _;if(typeof f.attribute<"u"){const b=`_FEATURE_ID_${f.attribute}`,T=e.attributes[b];_=r.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&((c=t==null?void 0:t.gltf)!=null&&c.loadImages)?_=ZC(r,f.texture,e):_=[];f.data=_}}const gye=Object.freeze(Object.defineProperty({__proto__:null,decode:dye,name:hye},Symbol.toStringTag,{value:"Module"})),QC="EXT_structural_metadata",mye=QC;async function _ye(r,e){const t=new fo(r);yye(t,e)}function yye(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(QC);t&&((i=e.gltf)!=null&&i.loadImages&&vye(r,t),bye(r,t))}function vye(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)wye(r,t,o,e)}function bye(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=xye(i,o);s&&Eye(r,t,s)}}function xye(r,e){for(const t of r)if(t.class===e)return t;return null}function wye(r,e,t,n){var s;if(!e)return;const i=(s=t.extensions)==null?void 0:s[QC],o=i==null?void 0:i.propertyTextures;if(o)for(const c of o){const f=e[c];Cye(r,f,t,n)}}function Cye(r,e,t,n){var o;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const c=`${i}_${s}`,f=(o=e.properties)==null?void 0:o[s];if(!f)continue;f.data||(f.data=[]);const _=f.data,b=ZC(r,f,t);b!==null&&(U8(r,c,b,_,t),f.data=_,n.dataAttributeNames.push(c))}}function Eye(r,e,t){var o,s;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],_=(s=t.properties)==null?void 0:s[c];if(_){const b=Tye(r,e,f,i,_);_.data=b}}}function Tye(r,e,t,n,i){let o=[];const s=i.values,c=r.getTypedArrayForBufferView(s),f=Bye(r,t,i,n),_=Sye(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=Iye(t,n,c,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=V8(n,c,f,_);break}case"ENUM":{o=Mye(e,t,n,c,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function Bye(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?$y(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Sye(r,e,t){return typeof e.stringOffsets<"u"?$y(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function Iye(r,e,t,n){const i=r.array,o=r.count,s=qC(r.type,r.componentType),c=t.byteLength/s;let f;return r.componentType?f=Wy(t,r.type,r.componentType,c):f=t,i?n?z8(f,e,n,t.length,s):o?G8(f,e,o):[]:f}function Mye(r,e,t,n,i){var T;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(T=r.enums)==null?void 0:T[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=s.valueType||"UINT16",f=qC(e.type,c),_=n.byteLength/f;let b=Wy(n,e.type,c,_);if(b||(b=n),e.array){if(i)return Pye({valuesData:b,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:f,enumEntry:s});const S=e.count;return S?Rye(b,t,S,s):[]}return eE(b,0,t,s)}function Pye(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=r,c=[];for(let f=0;f<t;f++){const _=n[f],b=n[f+1]-n[f];if(b+_>i)break;const T=_/o,S=b/o,D=eE(e,T,S,s);c.push(D)}return c}function Rye(r,e,t,n){const i=[];for(let o=0;o<e;o++){const s=t*o,c=eE(r,s,t,n);i.push(c)}return i}function eE(r,e,t,n){const i=[];for(let o=0;o<t;o++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const s=r[e+o],c=Fye(n,s);c?i.push(c.name):i.push("")}return i}function Fye(r,e){for(const t of r.values)if(t.value===e)return t;return null}const Oye=Object.freeze(Object.defineProperty({__proto__:null,decode:_ye,name:mye},Symbol.toStringTag,{value:"Module"})),j8="EXT_feature_metadata",Dye=j8;async function Lye(r,e){const t=new fo(r);kye(t,e)}function kye(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(j8);t&&((i=e.gltf)!=null&&i.loadImages&&Nye(r,t),Uye(r,t))}function Nye(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],c=Gye(i,o);c&&Hye(r,c,s)}}function Uye(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=zye(i,o);s&&Vye(r,t,s)}}function zye(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Gye(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Vye(r,e,t){var o,s;if(!t.class)return;const n=(o=e.classes)==null?void 0:o[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const c in n.properties){const f=n.properties[c],_=(s=t.properties)==null?void 0:s[c];if(_){const b=jye(r,e,f,i,_);_.data=b}}}function Hye(r,e,t){var i;const n=e.class;for(const o in t.properties){const s=(i=e==null?void 0:e.properties)==null?void 0:i[o];if(s){const c=Kye(r,s,n);s.data=c}}}function jye(r,e,t,n,i){let o=[];const s=i.bufferView,c=r.getTypedArrayForBufferView(s),f=$ye(r,t,i,n),_=Wye(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?o=V8(n,c,f,_):Jye(t)&&(o=Xye(t,n,c,f)),o}function $ye(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?$y(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Wye(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?$y(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Jye(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function Xye(r,e,t,n){const i=r.type==="ARRAY",o=r.componentCount,s="SCALAR",c=r.componentType||r.type,f=qC(s,c),_=t.byteLength/f,b=Wy(t,s,c,_);return i?n?z8(b,e,n,t.length,f):o?G8(b,e,o):[]:b}function Kye(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)Yye(r,t,e,i,s);return i}function Yye(r,e,t,n,i){const o={channels:t.channels,...t.texture},s=ZC(r,o,i);s&&U8(r,e,s,n,i)}const qye=Object.freeze(Object.defineProperty({__proto__:null,decode:Lye,name:Dye},Symbol.toStringTag,{value:"Module"})),Zye="4.2.4",MA=!0,qR=1735152710,tE=12,D_=8,Qye=1313821514,eve=5130562,tve=0,rve=0,nve=1;function ive(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function sve(r,e=0,t={}){const n=new DataView(r),{magic:i=qR}=t,o=n.getUint32(e,!1);return o===i||o===qR}function ove(r,e,t=0,n={}){const i=new DataView(e),o=ive(i,t+0),s=i.getUint32(t+4,MA),c=i.getUint32(t+8,MA);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),t+=tE,r.version){case 1:return ave(r,i,t);case 2:return cve(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function ave(r,e,t){ai(r.header.byteLength>tE+D_);const n=e.getUint32(t+0,MA),i=e.getUint32(t+4,MA);return t+=D_,ai(i===tve),zx(r,e,t,n),t+=n,t+=Gx(r,e,t,r.header.byteLength),t}function cve(r,e,t,n){return ai(r.header.byteLength>tE+D_),lve(r,e,t,n),t+r.header.byteLength}function lve(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,MA),o=e.getUint32(t+4,MA);switch(t+=D_,o){case Qye:zx(r,e,t,i);break;case eve:Gx(r,e,t,i);break;case rve:n.strict||zx(r,e,t,i);break;case nve:n.strict||Gx(r,e,t,i);break}t+=Jl(i,4)}return t}function zx(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),s=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(s),Jl(n,4)}function Gx(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Jl(n,4)}function $8(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const uve="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",fve="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",hve=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),dve=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ave={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},pve={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function gve(r,e,t,n,i,o="NONE"){const s=await mve();vve(s,s.exports[pve[i]],r,e,t,n,s.exports[Ave[o||"NONE"]])}let R1;async function mve(){return R1||(R1=_ve()),R1}async function _ve(){let r=uve;WebAssembly.validate(hve)&&(r=fve,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(yve(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function yve(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?dve[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function vve(r,e,t,n,i,o,s){const c=r.exports.sbrk,f=n+3&-4,_=c(f*i),b=c(o.length),T=new Uint8Array(r.exports.memory.buffer);T.set(o,b);const S=e(_,n,i,b,o.length);if(S===0&&s&&s(_,f,i),t.set(T.subarray(_,_+n*i)),c(_-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const L_="EXT_meshopt_compression",bve=L_;async function xve(r,e){var i,o;const t=new fo(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=[];for(const s of r.json.bufferViews||[])n.push(wve(t,s));await Promise.all(n),t.removeExtension(L_)}async function wve(r,e){const t=r.getObjectExtension(e,L_);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:c,filter:f="NONE",buffer:_}=t,b=r.gltf.buffers[_],T=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await gve(S,s,o,T,c,f),r.removeObjectExtension(e,L_)}}const Cve=Object.freeze(Object.defineProperty({__proto__:null,decode:xve,name:bve},Symbol.toStringTag,{value:"Module"})),Hd="EXT_texture_webp",Eve=Hd;function Tve(r,e){const t=new fo(r);if(!Pk("image/webp")){if(t.getRequiredExtensions().includes(Hd))throw new Error(`gltf: Required extension ${Hd} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Hd);o&&(i.source=o.source),t.removeObjectExtension(i,Hd)}t.removeExtension(Hd)}const Bve=Object.freeze(Object.defineProperty({__proto__:null,name:Eve,preprocess:Tve},Symbol.toStringTag,{value:"Module"})),Vm="KHR_texture_basisu",Sve=Vm;function Ive(r,e){const t=new fo(r),{json:n}=t;for(const i of n.textures||[]){const o=t.getObjectExtension(i,Vm);o&&(i.source=o.source,t.removeObjectExtension(i,Vm))}t.removeExtension(Vm)}const Mve=Object.freeze(Object.defineProperty({__proto__:null,name:Sve,preprocess:Ive},Symbol.toStringTag,{value:"Module"}));function Pve(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=W8(n);e[t]=i}}return e}function W8(r){const{buffer:e,size:t,count:n}=Rve(r);return{value:e,size:t,byteOffset:0,count:n,type:D8(t),componentType:KC(e)}}function Rve(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=Fve(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function Fve(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Ju="KHR_draco_mesh_compression",Ove=Ju;function Dve(r,e,t){const n=new fo(r);for(const i of J8(n))n.getObjectExtension(i,Ju)}async function Lve(r,e,t){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const n=new fo(r),i=[];for(const s of J8(n))n.getObjectExtension(s,Ju)&&i.push(Nve(n,s,e,t));await Promise.all(i),n.removeExtension(Ju)}function kve(r,e={}){const t=new fo(r);for(const n of t.json.meshes||[])Uve(n),t.addRequiredExtension(Ju)}async function Nve(r,e,t,n){const i=r.getObjectExtension(e,Ju);if(!i)return;const o=r.getTypedArrayForBufferView(i.bufferView),s=Lg(o.buffer,o.byteOffset),c={...t};delete c["3d-tiles"];const f=await ph(s,jC,c,n),_=Pve(f.attributes);for(const[b,T]of Object.entries(_))if(b in e.attributes){const S=e.attributes[b],D=r.getAccessor(S);D!=null&&D.min&&(D!=null&&D.max)&&(T.min=D.min,T.max=D.max)}e.attributes=_,f.indices&&(e.indices=W8(f.indices)),r.removeObjectExtension(e,Ju),zve(e)}function Uve(r,e,t=4,n,i){var b;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:r}),s=(b=i==null?void 0:i.parseSync)==null?void 0:b.call(i,{attributes:r}),c=n._addFauxAttributes(s.attributes),f=n.addBufferView(o);return{primitives:[{attributes:c,mode:t,extensions:{[Ju]:{bufferView:f,attributes:c}}}]}}function zve(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*J8(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const Gve=Object.freeze(Object.defineProperty({__proto__:null,decode:Lve,encode:kve,name:Ove,preprocess:Dve},Symbol.toStringTag,{value:"Module"})),Jy="KHR_texture_transform",Vve=Jy,hm=new ft,Hve=new ci,jve=new ci;async function $ve(r,e){var o;if(!new fo(r).hasExtension(Jy)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)Wve(s,r)}function Wve(r,e){var o,s,c,f;const t=(o=e.json.materials)==null?void 0:o[r],n=[(s=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(c=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:c.metallicRoughnessTexture],i=[];for(const _ of n)_&&((f=_==null?void 0:_.extensions)!=null&&f[Jy])&&Jve(e,r,_,i)}function Jve(r,e,t,n){const i=Xve(t,n);if(!i)return;const o=r.json.meshes||[];for(const s of o)for(const c of s.primitives){const f=c.material;Number.isFinite(f)&&e===f&&Kve(r,c,i)}}function Xve(r,e){var s;const t=(s=r.extensions)==null?void 0:s[Jy],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([c,f])=>c===n&&f===i)!==-1)){const c=Zve(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:c}}return null}function Kve(r,e,t){var c,f;const{originalTexCoord:n,texCoord:i,matrix:o}=t,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const _=(c=r.json.accessors)==null?void 0:c[s];if(_&&_.bufferView){const b=(f=r.json.bufferViews)==null?void 0:f[_.bufferView];if(b){const{arrayBuffer:T,byteOffset:S}=r.buffers[b.buffer],D=(S||0)+(_.byteOffset||0)+(b.byteOffset||0),{ArrayType:N,length:G}=YC(_,b),W=O8[_.componentType],z=F8[_.type],j=b.byteStride||W*z,K=new Float32Array(G);for(let fe=0;fe<_.count;fe++){const Z=new N(T,D+fe*j,2);hm.set(Z[0],Z[1],1),hm.transformByMatrix3(o),K.set([hm[0],hm[1]],fe*z)}n===i?Yve(_,b,r.buffers,K):qve(i,_,e,r,K)}}}}function Yve(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function qve(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=s.length-1)}function Zve(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new ci().set(1,0,0,0,1,0,e[0],e[1],1),o=Hve.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),s=jve.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const Qve=Object.freeze(Object.defineProperty({__proto__:null,decode:$ve,name:Vve},Symbol.toStringTag,{value:"Module"})),$f="KHR_lights_punctual",ebe=$f;async function tbe(r){const e=new fo(r),{json:t}=e,n=e.getExtension($f);n&&(e.json.lights=n.lights,e.removeExtension($f));for(const i of t.nodes||[]){const o=e.getObjectExtension(i,$f);o&&(i.light=o.light),e.removeObjectExtension(i,$f)}}async function rbe(r){const e=new fo(r),{json:t}=e;if(t.lights){const n=e.addExtension($f);oa(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,$f,n)}delete e.json.lights}}const nbe=Object.freeze(Object.defineProperty({__proto__:null,decode:tbe,encode:rbe,name:ebe},Symbol.toStringTag,{value:"Module"})),vg="KHR_materials_unlit",ibe=vg;async function sbe(r){const e=new fo(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,vg);e.removeExtension(vg)}function obe(r){const e=new fo(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,vg,{}),e.addExtension(vg))}const abe=Object.freeze(Object.defineProperty({__proto__:null,decode:sbe,encode:obe,name:ibe},Symbol.toStringTag,{value:"Module"})),Up="KHR_techniques_webgl",cbe=Up;async function lbe(r){const e=new fo(r),{json:t}=e,n=e.getExtension(Up);if(n){const i=fbe(n,e);for(const o of t.materials||[]){const s=e.getObjectExtension(o,Up);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=hbe(o.technique,e)),e.removeObjectExtension(o,Up)}e.removeExtension(Up)}}async function ube(r,e){}function fbe(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=t[s.program]}),i}function hbe(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const dbe=Object.freeze(Object.defineProperty({__proto__:null,decode:lbe,encode:ube,name:cbe},Symbol.toStringTag,{value:"Module"})),X8=[Oye,gye,Cve,Bve,Mve,Gve,nbe,abe,dbe,Qve,qye];function Abe(r,e={},t){var i;const n=X8.filter(o=>K8(o.name,e));for(const o of n)(i=o.preprocess)==null||i.call(o,r,e,t)}async function pbe(r,e={},t){var i;const n=X8.filter(o=>K8(o.name,e));for(const o of n)await((i=o.decode)==null?void 0:i.call(o,r,e,t))}function K8(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const F1="KHR_binary_glTF";function gbe(r){const e=new fo(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,F1);i&&Object.assign(n,i),e.removeObjectExtension(n,F1)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(F1)}const ZR={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},mbe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class _be{constructor(){V(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});V(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),gbe(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in ZR)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in ZR)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:o}=t;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,t){const n=mbe[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=o.values)==null?void 0:t.tex)||((n=o.values)==null?void 0:n.texture2d_0)||((i=o.values)==null?void 0:i.diffuseTex),c=e.textures.findIndex(f=>f.id===s);c!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:c})}}}function ybe(r,e={}){return new _be().normalize(r,e)}async function vbe(r,e,t=0,n,i){var o,s,c;return bbe(r,e,t,n),ybe(r,{normalize:(o=n==null?void 0:n.gltf)==null?void 0:o.normalize}),Abe(r,n,i),(s=n==null?void 0:n.gltf)!=null&&s.loadBuffers&&r.json.buffers&&await xbe(r,n,i),(c=n==null?void 0:n.gltf)!=null&&c.loadImages&&await wbe(r,n,i),await pbe(r,n,i),r}function bbe(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!sve(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=wk(e);else if(e instanceof ArrayBuffer){const s={};t=ove(s,e,t,n.glb),oa(s.type==="glTF",`Invalid GLB magic string ${s.type}`),r._glb=s,r.json=s.json}else oa(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:s}=r._glb;r.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function xbe(r,e,t){var i,o;const n=r.json.buffers||[];for(let s=0;s<n.length;++s){const c=n[s];if(c.uri){const{fetch:f}=t;oa(f);const _=$8(c.uri,e),b=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,_)),T=await((o=b==null?void 0:b.arrayBuffer)==null?void 0:o.call(b));r.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete c.uri}else r.buffers[s]===null&&(r.buffers[s]={arrayBuffer:new ArrayBuffer(c.byteLength),byteOffset:0,byteLength:c.byteLength})}}async function wbe(r,e,t){const n=Cbe(r),i=r.json.images||[],o=[];for(const s of n)o.push(Ebe(r,i[s],s,e,t));return await Promise.all(o)}function Cbe(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function Ebe(r,e,t,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const c=$8(e.uri,n),{fetch:f}=i;o=await(await f(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const c=oye(r.json,r.buffers,e.bufferView);o=Lg(c.buffer,c.byteOffset,c.byteLength)}oa(o,"glTF image has no data");let s=await ph(o,[_g,A8],{...n,mimeType:e.mimeType,basis:n.basis||{format:VC()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),r.images=r.images||[],r.images[t]=s}const k_={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Zye,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Tbe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Tbe(r,e={},t){e={...k_.options,...e},e.gltf={...k_.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await vbe({},r,n,e,t)}const Bbe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sbe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ea={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Ibe={magFilter:Ea.TEXTURE_MAG_FILTER,minFilter:Ea.TEXTURE_MIN_FILTER,wrapS:Ea.TEXTURE_WRAP_S,wrapT:Ea.TEXTURE_WRAP_T},Mbe={[Ea.TEXTURE_MAG_FILTER]:Ea.LINEAR,[Ea.TEXTURE_MIN_FILTER]:Ea.NEAREST_MIPMAP_LINEAR,[Ea.TEXTURE_WRAP_S]:Ea.REPEAT,[Ea.TEXTURE_WRAP_T]:Ea.REPEAT};function Pbe(){return{id:"default-sampler",parameters:Mbe}}function Rbe(r){return Sbe[r]}function Fbe(r){return Bbe[r]}class Obe{constructor(){V(this,"baseUri","");V(this,"jsonUnprocessed");V(this,"json");V(this,"buffers",[]);V(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return oa(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const c in s)o.attributes[c]=this.getAccessor(s[c]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=Rbe(e.componentType),i=Fbe(e.type),o=n*i,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const c=s.bufferView.buffer,{ArrayType:f,byteLength:_}=YC(s,s.bufferView),b=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+c.byteOffset;let T=c.arrayBuffer.slice(b,b+_);s.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,b,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new f(T)}return s}_getValueFromInterleavedBuffer(e,t,n,i,o){const s=new Uint8Array(o*i);for(let c=0;c<o;c++){const f=t+c*n;s.set(new Uint8Array(e.arrayBuffer.slice(f,f+i)),c*i)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Pbe(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return Ibe[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function Y8(r,e){return new Obe().postProcess(r,e)}const Vx={URI:0,EMBEDDED:1};function q8(r,e,t,n){r.rotateYtoZ=!0;const i=(r.byteOffset||0)+(r.byteLength||0)-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=Lg(e,t,i),r.gltfByteOffset=0,r.gltfByteLength=i,t%4===0||console.warn(`${r.type}: embedded glb is not aligned to a 4-byte boundary.`),(r.byteOffset||0)+(r.byteLength||0)}async function Z8(r,e,t,n){const i=(t==null?void 0:t["3d-tiles"])||{};if(Dbe(r,e),i.loadGLTF){if(!n)return;if(r.gltfUrl){const{fetch:o}=n,s=await o(r.gltfUrl,t);r.gltfArrayBuffer=await s.arrayBuffer(),r.gltfByteOffset=0}if(r.gltfArrayBuffer){const o=await ph(r.gltfArrayBuffer,k_,t,n);r.gltf=Y8(o),r.gpuMemoryUsageInBytes=L8(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength}}}function Dbe(r,e,t){switch(e){case Vx.URI:if(r.gltfArrayBuffer){const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),o=new TextDecoder().decode(n);r.gltfUrl=o.replace(/[\s\0]+$/,"")}delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case Vx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Lbe(r,e,t,n,i){var s;t=kbe(r,e,t,n),await Z8(r,Vx.EMBEDDED,n,i);const o=(s=r==null?void 0:r.gltf)==null?void 0:s.extensions;return o&&o.CESIUM_RTC&&(r.rtcCenter=o.CESIUM_RTC.center),t}function kbe(r,e,t,n,i){t=jy(r,e,t),t=JC(r,e,t),t=XC(r,e,t),t=q8(r,e,t,n);const o=new WC(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=o.getGlobalProperty("RTC_CENTER",Dn.FLOAT,3),t}async function Nbe(r,e,t,n,i){return t=Ube(r,e,t,n),await Z8(r,r.gltfFormat||0,n,i),t}function Ube(r,e,t,n,i){var _;if(t=jy(r,e,t),r.version!==1)throw new Error(`Instanced 3D Model version ${r.version} is not supported`);t=JC(r,e,t);const o=new DataView(e);if(r.gltfFormat=o.getUint32(t,!0),t+=4,t=XC(r,e,t),t=q8(r,e,t,n),!((_=r==null?void 0:r.header)!=null&&_.featureTableJsonByteLength)||r.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new WC(r.featureTableJson,r.featureTableBinary),c=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Dn.FLOAT,3);const f=new P8(r.batchTableJson,r.batchTableBinary,c);return zbe(r,s,f,c),t}function zbe(r,e,t,n){const i=new Array(n),o=new ft;new ft,new ft,new ft;const s=new ci,c=new og,f=new ft,_={},b=new dn,T=[],S=[],D=[],N=[];for(let G=0;G<n;G++){let W;if(e.hasProperty("POSITION"))W=e.getProperty("POSITION",Dn.FLOAT,3,G,o);else if(e.hasProperty("POSITION_QUANTIZED")){W=e.getProperty("POSITION_QUANTIZED",Dn.UNSIGNED_SHORT,3,G,o);const ae=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Dn.FLOAT,3);if(!ae)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Be=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Dn.FLOAT,3);if(!Be)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Le=65535;for(let de=0;de<3;de++)W[de]=W[de]/Le*Be[de]+ae[de]}if(!W)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(W),_.translation=o,r.normalUp=e.getProperty("NORMAL_UP",Dn.FLOAT,3,G,T),r.normalRight=e.getProperty("NORMAL_RIGHT",Dn.FLOAT,3,G,S),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Dn.UNSIGNED_SHORT,2,G,T),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Dn.UNSIGNED_SHORT,2,G,S),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(gi.WGS84.eastNorthUpToFixedFrame(o,b),b.getRotationMatrix3(s)):s.identity()}c.fromMatrix3(s),_.rotation=c,f.set(1,1,1);const z=e.getProperty("SCALE",Dn.FLOAT,1,G,D);Number.isFinite(z)&&f.multiplyByScalar(z);const j=e.getProperty("SCALE_NON_UNIFORM",Dn.FLOAT,3,G,T);j&&f.scale(j),_.scale=f;let K=e.getProperty("BATCH_ID",Dn.UNSIGNED_SHORT,1,G,N);K===void 0&&(K=G);const fe=new dn().fromQuaternion(_.rotation);b.identity(),b.translate(_.translation),b.multiplyRight(fe),b.scale(_.scale);const Z=b.clone();i[G]={modelMatrix:Z,batchId:K}}r.instances=i}async function Gbe(r,e,t,n,i,o){t=jy(r,e,t);const s=new DataView(e);for(r.tilesLength=s.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&(r.byteLength||0)-t>12;){const c={shape:"tile3d"};r.tiles.push(c),t=await o(e,t,n,i,c)}return t}async function Vbe(r,e,t,n){var i,o;if(r.rotateYtoZ=!0,r.gltfUpAxis=(i=t==null?void 0:t["3d-tiles"])!=null&&i.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(o=t==null?void 0:t["3d-tiles"])!=null&&o.loadGLTF){if(!n)return e.byteLength;const s=await ph(e,k_,t,n);r.gltf=Y8(s),r.gpuMemoryUsageInBytes=L8(r.gltf)}else r.gltfArrayBuffer=e;return e.byteLength}async function Q8(r,e=0,t,n,i={shape:"tile3d"}){switch(i.byteOffset=e,i.type=w_e(r,e),i.type){case Bp.COMPOSITE:return await Gbe(i,r,e,t,n,Q8);case Bp.BATCHED_3D_MODEL:return await Lbe(i,r,e,t,n);case Bp.GLTF:return await Vbe(i,r,t,n);case Bp.INSTANCED_3D_MODEL:return await Nbe(i,r,e,t,n);case Bp.POINT_CLOUD:return await $_e(i,r,e,t,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const Hbe=1952609651,jbe=1;async function $be(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==Hbe)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==jbe)throw new Error("Wrong subtree file verson, must be 1");const o=QR(r.slice(8,16)),s=new Uint8Array(r,24,o),f=new TextDecoder("utf8").decode(s),_=JSON.parse(f),b=QR(r.slice(16,24));let T=new ArrayBuffer(0);if(b&&(T=r.slice(24+o)),await dm(_,_.tileAvailability,T,t),Array.isArray(_.contentAvailability))for(const S of _.contentAvailability)await dm(_,S,T,t);else await dm(_,_.contentAvailability,T,t);return await dm(_,_.childSubtreeAvailability,T,t),_}async function dm(r,e,t,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const o=r.bufferViews[i],s=r.buffers[o.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(s.uri){const f=`${(n==null?void 0:n.baseUrl)||""}/${s.uri}`,b=await(await n.fetch(f)).arrayBuffer();e.explicitBitstream=new Uint8Array(b,o.byteOffset,o.byteLength);return}const c=r.buffers.slice(0,o.buffer).reduce((f,_)=>f+_.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(c,c+s.byteLength),o.byteOffset,o.byteLength)}function QR(r){const e=new DataView(r),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const eN={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:S8,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:$be,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ma=null;try{Ma=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Qn(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Qn.prototype.__isLong__;Object.defineProperty(Qn.prototype,"__isLong__",{value:!0});function ho(r){return(r&&r.__isLong__)===!0}function eF(r){var e=Math.clz32(r&-r);return r?31-e:e}Qn.isLong=ho;var tF={},rF={};function gh(r,e){var t,n,i;return e?(r>>>=0,(i=0<=r&&r<256)&&(n=rF[r],n)?n:(t=kn(r,0,!0),i&&(rF[r]=t),t)):(r|=0,(i=-128<=r&&r<128)&&(n=tF[r],n)?n:(t=kn(r,r<0?-1:0,!1),i&&(tF[r]=t),t))}Qn.fromInt=gh;function Pa(r,e){if(isNaN(r))return e?Ul:hc;if(e){if(r<0)return Ul;if(r>=tN)return iN}else{if(r<=-9223372036854776e3)return Do;if(r+1>=Jbe)return nN}return r<0?Pa(-r,e).neg():kn(r%PA|0,r/PA|0,e)}Qn.fromNumber=Pa;function kn(r,e,t){return new Qn(r,e,t)}Qn.fromBits=kn;var N_=Math.pow;function rE(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?Ul:hc;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return rE(r.substring(1),e,t).neg();for(var i=Pa(N_(t,8)),o=hc,s=0;s<r.length;s+=8){var c=Math.min(8,r.length-s),f=parseInt(r.substring(s,s+c),t);if(c<8){var _=Pa(N_(t,c));o=o.mul(_).add(Pa(f))}else o=o.mul(i),o=o.add(Pa(f))}return o.unsigned=e,o}Qn.fromString=rE;function yc(r,e){return typeof r=="number"?Pa(r,e):typeof r=="string"?rE(r,e):kn(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Qn.fromValue=yc;var nF=65536,Wbe=1<<24,PA=nF*nF,tN=PA*PA,Jbe=tN/2,iF=gh(Wbe),hc=gh(0);Qn.ZERO=hc;var Ul=gh(0,!0);Qn.UZERO=Ul;var rA=gh(1);Qn.ONE=rA;var rN=gh(1,!0);Qn.UONE=rN;var Hx=gh(-1);Qn.NEG_ONE=Hx;var nN=kn(-1,2147483647,!1);Qn.MAX_VALUE=nN;var iN=kn(-1,-1,!0);Qn.MAX_UNSIGNED_VALUE=iN;var Do=kn(0,-2147483648,!1);Qn.MIN_VALUE=Do;var Qt=Qn.prototype;Qt.toInt=function(){return this.unsigned?this.low>>>0:this.low};Qt.toNumber=function(){return this.unsigned?(this.high>>>0)*PA+(this.low>>>0):this.high*PA+(this.low>>>0)};Qt.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Do)){var t=Pa(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Pa(N_(e,6),this.unsigned),s=this,c="";;){var f=s.div(o),_=s.sub(f.mul(o)).toInt()>>>0,b=_.toString(e);if(s=f,s.isZero())return b+c;for(;b.length<6;)b="0"+b;c=""+b+c}};Qt.getHighBits=function(){return this.high};Qt.getHighBitsUnsigned=function(){return this.high>>>0};Qt.getLowBits=function(){return this.low};Qt.getLowBitsUnsigned=function(){return this.low>>>0};Qt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Do)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Qt.isZero=function(){return this.high===0&&this.low===0};Qt.eqz=Qt.isZero;Qt.isNegative=function(){return!this.unsigned&&this.high<0};Qt.isPositive=function(){return this.unsigned||this.high>=0};Qt.isOdd=function(){return(this.low&1)===1};Qt.isEven=function(){return(this.low&1)===0};Qt.equals=function(e){return ho(e)||(e=yc(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Qt.eq=Qt.equals;Qt.notEquals=function(e){return!this.eq(e)};Qt.neq=Qt.notEquals;Qt.ne=Qt.notEquals;Qt.lessThan=function(e){return this.comp(e)<0};Qt.lt=Qt.lessThan;Qt.lessThanOrEqual=function(e){return this.comp(e)<=0};Qt.lte=Qt.lessThanOrEqual;Qt.le=Qt.lessThanOrEqual;Qt.greaterThan=function(e){return this.comp(e)>0};Qt.gt=Qt.greaterThan;Qt.greaterThanOrEqual=function(e){return this.comp(e)>=0};Qt.gte=Qt.greaterThanOrEqual;Qt.ge=Qt.greaterThanOrEqual;Qt.compare=function(e){if(ho(e)||(e=yc(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Qt.comp=Qt.compare;Qt.negate=function(){return!this.unsigned&&this.eq(Do)?Do:this.not().add(rA)};Qt.neg=Qt.negate;Qt.add=function(e){ho(e)||(e=yc(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,c=e.high&65535,f=e.low>>>16,_=e.low&65535,b=0,T=0,S=0,D=0;return D+=o+_,S+=D>>>16,D&=65535,S+=i+f,T+=S>>>16,S&=65535,T+=n+c,b+=T>>>16,T&=65535,b+=t+s,b&=65535,kn(S<<16|D,b<<16|T,this.unsigned)};Qt.subtract=function(e){return ho(e)||(e=yc(e)),this.add(e.neg())};Qt.sub=Qt.subtract;Qt.multiply=function(e){if(this.isZero())return this;if(ho(e)||(e=yc(e)),Ma){var t=Ma.mul(this.low,this.high,e.low,e.high);return kn(t,Ma.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ul:hc;if(this.eq(Do))return e.isOdd()?Do:hc;if(e.eq(Do))return this.isOdd()?Do:hc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(iF)&&e.lt(iF))return Pa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,o=this.low>>>16,s=this.low&65535,c=e.high>>>16,f=e.high&65535,_=e.low>>>16,b=e.low&65535,T=0,S=0,D=0,N=0;return N+=s*b,D+=N>>>16,N&=65535,D+=o*b,S+=D>>>16,D&=65535,D+=s*_,S+=D>>>16,D&=65535,S+=i*b,T+=S>>>16,S&=65535,S+=o*_,T+=S>>>16,S&=65535,S+=s*f,T+=S>>>16,S&=65535,T+=n*b+i*_+o*f+s*c,T&=65535,kn(D<<16|N,T<<16|S,this.unsigned)};Qt.mul=Qt.multiply;Qt.divide=function(e){if(ho(e)||(e=yc(e)),e.isZero())throw Error("division by zero");if(Ma){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ma.div_u:Ma.div_s)(this.low,this.high,e.low,e.high);return kn(t,Ma.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ul:hc;var n,i,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ul;if(e.gt(this.shru(1)))return rN;o=Ul}else{if(this.eq(Do)){if(e.eq(rA)||e.eq(Hx))return Do;if(e.eq(Do))return rA;var s=this.shr(1);return n=s.div(e).shl(1),n.eq(hc)?e.isNegative()?rA:Hx:(i=this.sub(e.mul(n)),o=n.add(i.div(e)),o)}else if(e.eq(Do))return this.unsigned?Ul:hc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=hc}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),f=c<=48?1:N_(2,c-48),_=Pa(n),b=_.mul(e);b.isNegative()||b.gt(i);)n-=f,_=Pa(n,this.unsigned),b=_.mul(e);_.isZero()&&(_=rA),o=o.add(_),i=i.sub(b)}return o};Qt.div=Qt.divide;Qt.modulo=function(e){if(ho(e)||(e=yc(e)),Ma){var t=(this.unsigned?Ma.rem_u:Ma.rem_s)(this.low,this.high,e.low,e.high);return kn(t,Ma.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Qt.mod=Qt.modulo;Qt.rem=Qt.modulo;Qt.not=function(){return kn(~this.low,~this.high,this.unsigned)};Qt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Qt.clz=Qt.countLeadingZeros;Qt.countTrailingZeros=function(){return this.low?eF(this.low):eF(this.high)+32};Qt.ctz=Qt.countTrailingZeros;Qt.and=function(e){return ho(e)||(e=yc(e)),kn(this.low&e.low,this.high&e.high,this.unsigned)};Qt.or=function(e){return ho(e)||(e=yc(e)),kn(this.low|e.low,this.high|e.high,this.unsigned)};Qt.xor=function(e){return ho(e)||(e=yc(e)),kn(this.low^e.low,this.high^e.high,this.unsigned)};Qt.shiftLeft=function(e){return ho(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?kn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):kn(0,this.low<<e-32,this.unsigned)};Qt.shl=Qt.shiftLeft;Qt.shiftRight=function(e){return ho(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?kn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):kn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Qt.shr=Qt.shiftRight;Qt.shiftRightUnsigned=function(e){return ho(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?kn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?kn(this.high,0,this.unsigned):kn(this.high>>>e-32,0,this.unsigned)};Qt.shru=Qt.shiftRightUnsigned;Qt.shr_u=Qt.shiftRightUnsigned;Qt.rotateLeft=function(e){var t;return ho(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?kn(this.high,this.low,this.unsigned):e<32?(t=32-e,kn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,kn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};Qt.rotl=Qt.rotateLeft;Qt.rotateRight=function(e){var t;return ho(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?kn(this.high,this.low,this.unsigned):e<32?(t=32-e,kn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,kn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};Qt.rotr=Qt.rotateRight;Qt.toSigned=function(){return this.unsigned?kn(this.low,this.high,!1):this};Qt.toUnsigned=function(){return this.unsigned?this:kn(this.low,this.high,!0)};Qt.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Qt.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Qt.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Qn.fromBytes=function(e,t,n){return n?Qn.fromBytesLE(e,t):Qn.fromBytesBE(e,t)};Qn.fromBytesLE=function(e,t){return new Qn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Qn.fromBytesBE=function(e,t){return new Qn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Xbe=16;function sN(r){r==="X"&&(r="");const e=r.padEnd(Xbe,"0");return Qn.fromString(e,!0,16)}function Kbe(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const o=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-o.length).join("0")+o}function Ybe(r,e){const t=qbe(r).shiftRightUnsigned(2);return r.add(Qn.fromNumber(2*e+1-4).multiply(t))}function qbe(r){return r.and(r.not().add(1))}const Zbe=3,Qbe=30,e1e=2*Qbe+1,sF=180/Math.PI;function t1e(r){if(r.length===0)throw new Error(`Invalid Hilbert quad key ${r}`);const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let o=0;const s=[0,0];for(let c=i-1;c>=0;c--){o=i-c;const f=n[c];let _=0,b=0;f==="1"?b=1:f==="2"?(_=1,b=1):f==="3"&&(_=1);const T=Math.pow(2,o-1);n1e(T,s,_,b),s[0]+=T*_,s[1]+=T*b}if(t%2===1){const c=s[0];s[0]=s[1],s[1]=c}return{face:t,ij:s,level:o}}function r1e(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<Zbe+e1e;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),o=i.length/2,s=Qn.fromString(n,!0,2).toString(10);let c="";if(o!==0)for(c=Qn.fromString(i,!0,2).toString(4);c.length<o;)c="0"+c;return`${s}/${c}`}function oN(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function oF(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function aN(r){return[oF(r[0]),oF(r[1])]}function cN(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function lN([r,e,t]){const n=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*sF,n*sF]}function n1e(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function i1e(r){const e=oN(r.ij,r.level,[.5,.5]),t=aN(e),n=cN(r.face,t);return lN(n)}const s1e=100;function aF(r){const{face:e,ij:t,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(s1e*Math.pow(2,-n))),s=new Float64Array(4*o*2+2);let c=0,f=0;for(let _=0;_<4;_++){const b=i[_].slice(0),T=i[_+1],S=(T[0]-b[0])/o,D=(T[1]-b[1])/o;for(let N=0;N<o;N++){b[0]+=S,b[1]+=D;const G=oN(t,n,b),W=aN(G),z=cN(e,W),j=lN(z);Math.abs(j[1])>89.999&&(j[0]=f);const K=j[0]-f;j[0]+=K>180?-360:K<-180?360:0,s[c++]=j[0],s[c++]=j[1],f=j[0]}}return s[c++]=s[0],s[c++]=s[1],s}function nE(r){const e=o1e(r);return t1e(e)}function o1e(r){if(r.indexOf("/")>0)return r;const e=sN(r);return r1e(e)}function a1e(r){const e=nE(r);return i1e(e)}function c1e(r){let e;if(r.face===2||r.face===5){let t=null,n=0;for(let i=0;i<4;i++){const o=`${r.face}/${i}`,s=nE(o),c=aF(s);(typeof t>"u"||t===null)&&(t=new Float64Array(4*c.length)),t.set(c,n),n+=c.length}e=cF(t)}else{const t=aF(r);e=cF(t)}return e}function cF(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<r.length;n+=2)e.push(r[n]),t.push(r[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function l1e(r,e){const t=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,i=nE(r),o=c1e(i),s=o.west,c=o.south,f=o.east,_=o.north,b=[];return b.push(new ft(s,_,t)),b.push(new ft(f,_,t)),b.push(new ft(f,c,t)),b.push(new ft(s,c,t)),b.push(new ft(s,_,n)),b.push(new ft(f,_,n)),b.push(new ft(f,c,n)),b.push(new ft(s,c,n)),b}function uN(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=l1e(e,t),i=a1e(e),o=i[0],s=i[1],c=gi.WGS84.cartographicToCartesian([o,s,t.maximumHeight]),f=new ft(c[0],c[1],c[2]);n.push(f);const _=Fk(n);return[..._.center,..._.halfAxes]}const u1e=4,f1e=8,h1e={QUADTREE:u1e,OCTREE:f1e};function d1e(r,e,t){if(r!=null&&r.box){const n=sN(r.s2VolumeInfo.token),i=Ybe(n,e),o=Kbe(i),s={...r.s2VolumeInfo};switch(s.token=o,t){case"OCTREE":const _=r.s2VolumeInfo,b=_.maximumHeight-_.minimumHeight,T=b/2,S=_.minimumHeight+b/2;_.minimumHeight=S-T,_.maximumHeight=S+T;break}return{box:uN(s),s2VolumeInfo:s}}}async function fN(r){const{implicitOptions:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,s2VolumeBox:i,loaderOptions:o}=r;let{subtree:s,level:c=0,globalData:f={level:0,mortonIndex:0,x:0,y:0,z:0}}=r;const{subdivisionScheme:_,subtreeLevels:b,maximumLevel:T,contentUrlTemplate:S,subtreesUriTemplate:D,basePath:N}=e,G={children:[],lodMetricValue:0,contentUrl:""};if(!T)return lL.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${S} won't be loaded...`),G;const W=c+f.level;if(W>T)return G;const z=h1e[_],j=Math.log2(z),K=n&1,fe=n>>1&1,Z=n>>2&1,ae=(z**c-1)/(z-1);let Be=Of(t.mortonIndex,n,j),Le=ae+Be,de=Of(t.x,K,1),_e=Of(t.y,fe,1),pe=Of(t.z,Z,1),J=!1;c>=b&&(J=O1(s.childSubtreeAvailability,Be));const ne=Of(f.x,de,c),ye=Of(f.y,_e,c),Ye=Of(f.z,pe,c);if(J){const rt=`${N}/${D}`,tt=jx(rt,W,ne,ye,Ye);s=await OA(tt,eN,o),f={mortonIndex:Be,x:de,y:_e,z:pe,level:c},Be=0,Le=0,de=0,_e=0,pe=0,c=0}if(!O1(s.tileAvailability,Le))return G;O1(s.contentAvailability,Le)&&(G.contentUrl=jx(S,W,ne,ye,Ye));const Ge=c+1,Qe={mortonIndex:Be,x:de,y:_e,z:pe};for(let rt=0;rt<z;rt++){const tt=d1e(i,rt,_),lt=await fN({subtree:s,implicitOptions:e,loaderOptions:o,parentData:Qe,childIndex:rt,level:Ge,globalData:{...f},s2VolumeBox:tt});if(lt.contentUrl||lt.children.length){const mt=W+1,nt=A1e(lt,mt,{childTileX:de,childTileY:_e,childTileZ:pe},e,i);G.children.push(nt)}}return G}function O1(r,e){let t;return Array.isArray(r)?(t=r[0],r.length>1&&lL.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=r,"constant"in t?!!t.constant:t.explicitBitstream?m1e(e,t.explicitBitstream):!1}function A1e(r,e,t,n,i){const{basePath:o,refine:s,getRefine:c,lodMetricType:f,getTileType:_,rootLodMetricValue:b,rootBoundingVolume:T}=n,S=r.contentUrl&&r.contentUrl.replace(`${o}/`,""),D=b/2**e,N=i!=null&&i.box?{box:i.box}:T,G=p1e(e,N,t);return{children:r.children,contentUrl:r.contentUrl,content:{uri:S},id:r.contentUrl,refine:c(s),type:_(r),lodMetricType:f,lodMetricValue:D,geometricError:D,transform:r.transform,boundingVolume:G}}function p1e(r,e,t){if(e.region){const{childTileX:n,childTileY:i,childTileZ:o}=t,[s,c,f,_,b,T]=e.region,S=2**r,D=(f-s)/S,N=(_-c)/S,G=(T-b)/S,[W,z]=[s+D*n,s+D*(n+1)],[j,K]=[c+N*i,c+N*(i+1)],[fe,Z]=[b+G*o,b+G*(o+1)];return{region:[W,j,z,K,fe,Z]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function Of(r,e,t){return(r<<t)+e}function jx(r,e,t,n,i){const o=g1e({level:e,x:t,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,s=>o[s])}function g1e(r){const e={};for(const t in r)e[`{${t}}`]=r[t];return e}function m1e(r,e){const t=Math.floor(r/8),n=r%8;return(e[t]>>n&1)===1}function iE(r,e=""){if(!e)return Nl.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return Nl.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Nl.SCENEGRAPH;default:return n||Nl.EMPTY}}function sE(r){switch(r){case"REPLACE":case"replace":return Ac.REPLACE;case"ADD":case"add":return Ac.ADD;default:return r}}function $x(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(r,`${e}/`);return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return dfe(e,r)}function lF(r,e){var i;if(!r)return null;let t;if(r.content){const o=r.content.uri||((i=r.content)==null?void 0:i.url);typeof o<"u"&&(t=$x(o,e))}return{...r,id:t,contentUrl:t,lodMetricType:IA.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:iE(r,t),refine:sE(r.refine)}}async function _1e(r,e,t){let n=null;const i=fF(r.root);i&&r.root?n=await uF(r.root,r,e,i,t):n=lF(r.root,e);const o=[];for(o.push(n);o.length>0;){const s=o.pop()||{},c=s.children||[],f=[];for(const _ of c){const b=fF(_);let T;b?T=await uF(_,r,e,b,t):T=lF(_,e),T&&(f.push(T),o.push(T))}s.children=f}return n}async function uF(r,e,t,n,i){var fe,Z,ae;const{subdivisionScheme:o,maximumLevel:s,availableLevels:c,subtreeLevels:f,subtrees:{uri:_}}=n,b=jx(_,0,0,0,0),T=$x(b,t),S=await OA(T,eN,i),D=(fe=r.content)==null?void 0:fe.uri,N=D?$x(D,t):"",G=(Z=e==null?void 0:e.root)==null?void 0:Z.refine,W=r.geometricError,z=(ae=r.boundingVolume.extensions)==null?void 0:ae["3DTILES_bounding_volume_S2"];if(z){const Le={box:uN(z),s2VolumeInfo:z};r.boundingVolume=Le}const j=r.boundingVolume,K={contentUrlTemplate:N,subtreesUriTemplate:_,subdivisionScheme:o,subtreeLevels:f,maximumLevel:Number.isFinite(c)?c-1:s,refine:G,basePath:t,lodMetricType:IA.GEOMETRIC_ERROR,rootLodMetricValue:W,rootBoundingVolume:j,getTileType:iE,getRefine:sE};return await y1e(r,t,S,K,i)}async function y1e(r,e,t,n,i){if(!r)return null;const{children:o,contentUrl:s}=await fN({subtree:t,implicitOptions:n,loaderOptions:i});let c,f=null;return s&&(c=s,f={uri:s.replace(`${e}/`,"")}),{...r,id:c,contentUrl:c,lodMetricType:IA.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:iE(r,c),refine:sE(r.refine),content:f||r.content,children:o}}function fF(r){var e;return((e=r==null?void 0:r.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const hN={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:S8,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:v1e,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function v1e(r,e={},t){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?b1e(r,e,t):x1e(r,e,t)}async function b1e(r,e,t){var f;const n=JSON.parse(new TextDecoder().decode(r)),i=(t==null?void 0:t.url)||"",o=w1e(i),s=await _1e(n,o,e||{});return{...n,shape:"tileset3d",loader:hN,url:i,queryString:(t==null?void 0:t.queryString)||"",basePath:o,root:s||n.root,type:Ro.TILES3D,lodMetricType:IA.GEOMETRIC_ERROR,lodMetricValue:((f=n.root)==null?void 0:f.geometricError)||0}}async function x1e(r,e,t){const n={content:{shape:"tile3d",featureIds:null}};return await Q8(r,0,e,t,n.content),n.content}function w1e(r){return Tk(r)}var D1={},hF;function rf(){return hF||(hF=1,function(r){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function t(o,s){return Object.prototype.hasOwnProperty.call(o,s)}r.assign=function(o){for(var s=Array.prototype.slice.call(arguments,1);s.length;){var c=s.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var f in c)t(c,f)&&(o[f]=c[f])}}return o},r.shrinkBuf=function(o,s){return o.length===s?o:o.subarray?o.subarray(0,s):(o.length=s,o)};var n={arraySet:function(o,s,c,f,_){if(s.subarray&&o.subarray){o.set(s.subarray(c,c+f),_);return}for(var b=0;b<f;b++)o[_+b]=s[c+b]},flattenChunks:function(o){var s,c,f,_,b,T;for(f=0,s=0,c=o.length;s<c;s++)f+=o[s].length;for(T=new Uint8Array(f),_=0,s=0,c=o.length;s<c;s++)b=o[s],T.set(b,_),_+=b.length;return T}},i={arraySet:function(o,s,c,f,_){for(var b=0;b<f;b++)o[_+b]=s[c+b]},flattenChunks:function(o){return[].concat.apply([],o)}};r.setTyped=function(o){o?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,i))},r.setTyped(e)}(D1)),D1}var Bd={},Qa={},Df={},dF;function C1e(){if(dF)return Df;dF=1;var r=rf(),e=4,t=0,n=1,i=2;function o(Pe){for(var Dt=Pe.length;--Dt>=0;)Pe[Dt]=0}var s=0,c=1,f=2,_=3,b=258,T=29,S=256,D=S+1+T,N=30,G=19,W=2*D+1,z=15,j=16,K=7,fe=256,Z=16,ae=17,Be=18,Le=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],de=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=512,ne=new Array((D+2)*2);o(ne);var ye=new Array(N*2);o(ye);var Ye=new Array(J);o(Ye);var we=new Array(b-_+1);o(we);var Ne=new Array(T);o(Ne);var Ge=new Array(N);o(Ge);function Qe(Pe,Dt,Vt,sr,Ze){this.static_tree=Pe,this.extra_bits=Dt,this.extra_base=Vt,this.elems=sr,this.max_length=Ze,this.has_stree=Pe&&Pe.length}var rt,tt,lt;function mt(Pe,Dt){this.dyn_tree=Pe,this.max_code=0,this.stat_desc=Dt}function Tt(Pe){return Pe<256?Ye[Pe]:Ye[256+(Pe>>>7)]}function nt(Pe,Dt){Pe.pending_buf[Pe.pending++]=Dt&255,Pe.pending_buf[Pe.pending++]=Dt>>>8&255}function cr(Pe,Dt,Vt){Pe.bi_valid>j-Vt?(Pe.bi_buf|=Dt<<Pe.bi_valid&65535,nt(Pe,Pe.bi_buf),Pe.bi_buf=Dt>>j-Pe.bi_valid,Pe.bi_valid+=Vt-j):(Pe.bi_buf|=Dt<<Pe.bi_valid&65535,Pe.bi_valid+=Vt)}function Xt(Pe,Dt,Vt){cr(Pe,Vt[Dt*2],Vt[Dt*2+1])}function $t(Pe,Dt){var Vt=0;do Vt|=Pe&1,Pe>>>=1,Vt<<=1;while(--Dt>0);return Vt>>>1}function Lt(Pe){Pe.bi_valid===16?(nt(Pe,Pe.bi_buf),Pe.bi_buf=0,Pe.bi_valid=0):Pe.bi_valid>=8&&(Pe.pending_buf[Pe.pending++]=Pe.bi_buf&255,Pe.bi_buf>>=8,Pe.bi_valid-=8)}function lr(Pe,Dt){var Vt=Dt.dyn_tree,sr=Dt.max_code,Ze=Dt.stat_desc.static_tree,Mt=Dt.stat_desc.has_stree,ge=Dt.stat_desc.extra_bits,Nt=Dt.stat_desc.extra_base,wt=Dt.stat_desc.max_length,$,yt,Et,Te,Je,ct,q=0;for(Te=0;Te<=z;Te++)Pe.bl_count[Te]=0;for(Vt[Pe.heap[Pe.heap_max]*2+1]=0,$=Pe.heap_max+1;$<W;$++)yt=Pe.heap[$],Te=Vt[Vt[yt*2+1]*2+1]+1,Te>wt&&(Te=wt,q++),Vt[yt*2+1]=Te,!(yt>sr)&&(Pe.bl_count[Te]++,Je=0,yt>=Nt&&(Je=ge[yt-Nt]),ct=Vt[yt*2],Pe.opt_len+=ct*(Te+Je),Mt&&(Pe.static_len+=ct*(Ze[yt*2+1]+Je)));if(q!==0){do{for(Te=wt-1;Pe.bl_count[Te]===0;)Te--;Pe.bl_count[Te]--,Pe.bl_count[Te+1]+=2,Pe.bl_count[wt]--,q-=2}while(q>0);for(Te=wt;Te!==0;Te--)for(yt=Pe.bl_count[Te];yt!==0;)Et=Pe.heap[--$],!(Et>sr)&&(Vt[Et*2+1]!==Te&&(Pe.opt_len+=(Te-Vt[Et*2+1])*Vt[Et*2],Vt[Et*2+1]=Te),yt--)}}function tn(Pe,Dt,Vt){var sr=new Array(z+1),Ze=0,Mt,ge;for(Mt=1;Mt<=z;Mt++)sr[Mt]=Ze=Ze+Vt[Mt-1]<<1;for(ge=0;ge<=Dt;ge++){var Nt=Pe[ge*2+1];Nt!==0&&(Pe[ge*2]=$t(sr[Nt]++,Nt))}}function Er(){var Pe,Dt,Vt,sr,Ze,Mt=new Array(z+1);for(Vt=0,sr=0;sr<T-1;sr++)for(Ne[sr]=Vt,Pe=0;Pe<1<<Le[sr];Pe++)we[Vt++]=sr;for(we[Vt-1]=sr,Ze=0,sr=0;sr<16;sr++)for(Ge[sr]=Ze,Pe=0;Pe<1<<de[sr];Pe++)Ye[Ze++]=sr;for(Ze>>=7;sr<N;sr++)for(Ge[sr]=Ze<<7,Pe=0;Pe<1<<de[sr]-7;Pe++)Ye[256+Ze++]=sr;for(Dt=0;Dt<=z;Dt++)Mt[Dt]=0;for(Pe=0;Pe<=143;)ne[Pe*2+1]=8,Pe++,Mt[8]++;for(;Pe<=255;)ne[Pe*2+1]=9,Pe++,Mt[9]++;for(;Pe<=279;)ne[Pe*2+1]=7,Pe++,Mt[7]++;for(;Pe<=287;)ne[Pe*2+1]=8,Pe++,Mt[8]++;for(tn(ne,D+1,Mt),Pe=0;Pe<N;Pe++)ye[Pe*2+1]=5,ye[Pe*2]=$t(Pe,5);rt=new Qe(ne,Le,S+1,D,z),tt=new Qe(ye,de,0,N,z),lt=new Qe(new Array(0),_e,0,G,K)}function Ar(Pe){var Dt;for(Dt=0;Dt<D;Dt++)Pe.dyn_ltree[Dt*2]=0;for(Dt=0;Dt<N;Dt++)Pe.dyn_dtree[Dt*2]=0;for(Dt=0;Dt<G;Dt++)Pe.bl_tree[Dt*2]=0;Pe.dyn_ltree[fe*2]=1,Pe.opt_len=Pe.static_len=0,Pe.last_lit=Pe.matches=0}function Mn(Pe){Pe.bi_valid>8?nt(Pe,Pe.bi_buf):Pe.bi_valid>0&&(Pe.pending_buf[Pe.pending++]=Pe.bi_buf),Pe.bi_buf=0,Pe.bi_valid=0}function hr(Pe,Dt,Vt,sr){Mn(Pe),nt(Pe,Vt),nt(Pe,~Vt),r.arraySet(Pe.pending_buf,Pe.window,Dt,Vt,Pe.pending),Pe.pending+=Vt}function pr(Pe,Dt,Vt,sr){var Ze=Dt*2,Mt=Vt*2;return Pe[Ze]<Pe[Mt]||Pe[Ze]===Pe[Mt]&&sr[Dt]<=sr[Vt]}function rn(Pe,Dt,Vt){for(var sr=Pe.heap[Vt],Ze=Vt<<1;Ze<=Pe.heap_len&&(Ze<Pe.heap_len&&pr(Dt,Pe.heap[Ze+1],Pe.heap[Ze],Pe.depth)&&Ze++,!pr(Dt,sr,Pe.heap[Ze],Pe.depth));)Pe.heap[Vt]=Pe.heap[Ze],Vt=Ze,Ze<<=1;Pe.heap[Vt]=sr}function Sr(Pe,Dt,Vt){var sr,Ze,Mt=0,ge,Nt;if(Pe.last_lit!==0)do sr=Pe.pending_buf[Pe.d_buf+Mt*2]<<8|Pe.pending_buf[Pe.d_buf+Mt*2+1],Ze=Pe.pending_buf[Pe.l_buf+Mt],Mt++,sr===0?Xt(Pe,Ze,Dt):(ge=we[Ze],Xt(Pe,ge+S+1,Dt),Nt=Le[ge],Nt!==0&&(Ze-=Ne[ge],cr(Pe,Ze,Nt)),sr--,ge=Tt(sr),Xt(Pe,ge,Vt),Nt=de[ge],Nt!==0&&(sr-=Ge[ge],cr(Pe,sr,Nt)));while(Mt<Pe.last_lit);Xt(Pe,fe,Dt)}function ei(Pe,Dt){var Vt=Dt.dyn_tree,sr=Dt.stat_desc.static_tree,Ze=Dt.stat_desc.has_stree,Mt=Dt.stat_desc.elems,ge,Nt,wt=-1,$;for(Pe.heap_len=0,Pe.heap_max=W,ge=0;ge<Mt;ge++)Vt[ge*2]!==0?(Pe.heap[++Pe.heap_len]=wt=ge,Pe.depth[ge]=0):Vt[ge*2+1]=0;for(;Pe.heap_len<2;)$=Pe.heap[++Pe.heap_len]=wt<2?++wt:0,Vt[$*2]=1,Pe.depth[$]=0,Pe.opt_len--,Ze&&(Pe.static_len-=sr[$*2+1]);for(Dt.max_code=wt,ge=Pe.heap_len>>1;ge>=1;ge--)rn(Pe,Vt,ge);$=Mt;do ge=Pe.heap[1],Pe.heap[1]=Pe.heap[Pe.heap_len--],rn(Pe,Vt,1),Nt=Pe.heap[1],Pe.heap[--Pe.heap_max]=ge,Pe.heap[--Pe.heap_max]=Nt,Vt[$*2]=Vt[ge*2]+Vt[Nt*2],Pe.depth[$]=(Pe.depth[ge]>=Pe.depth[Nt]?Pe.depth[ge]:Pe.depth[Nt])+1,Vt[ge*2+1]=Vt[Nt*2+1]=$,Pe.heap[1]=$++,rn(Pe,Vt,1);while(Pe.heap_len>=2);Pe.heap[--Pe.heap_max]=Pe.heap[1],lr(Pe,Dt),tn(Vt,wt,Pe.bl_count)}function $n(Pe,Dt,Vt){var sr,Ze=-1,Mt,ge=Dt[0*2+1],Nt=0,wt=7,$=4;for(ge===0&&(wt=138,$=3),Dt[(Vt+1)*2+1]=65535,sr=0;sr<=Vt;sr++)Mt=ge,ge=Dt[(sr+1)*2+1],!(++Nt<wt&&Mt===ge)&&(Nt<$?Pe.bl_tree[Mt*2]+=Nt:Mt!==0?(Mt!==Ze&&Pe.bl_tree[Mt*2]++,Pe.bl_tree[Z*2]++):Nt<=10?Pe.bl_tree[ae*2]++:Pe.bl_tree[Be*2]++,Nt=0,Ze=Mt,ge===0?(wt=138,$=3):Mt===ge?(wt=6,$=3):(wt=7,$=4))}function un(Pe,Dt,Vt){var sr,Ze=-1,Mt,ge=Dt[0*2+1],Nt=0,wt=7,$=4;for(ge===0&&(wt=138,$=3),sr=0;sr<=Vt;sr++)if(Mt=ge,ge=Dt[(sr+1)*2+1],!(++Nt<wt&&Mt===ge)){if(Nt<$)do Xt(Pe,Mt,Pe.bl_tree);while(--Nt!==0);else Mt!==0?(Mt!==Ze&&(Xt(Pe,Mt,Pe.bl_tree),Nt--),Xt(Pe,Z,Pe.bl_tree),cr(Pe,Nt-3,2)):Nt<=10?(Xt(Pe,ae,Pe.bl_tree),cr(Pe,Nt-3,3)):(Xt(Pe,Be,Pe.bl_tree),cr(Pe,Nt-11,7));Nt=0,Ze=Mt,ge===0?(wt=138,$=3):Mt===ge?(wt=6,$=3):(wt=7,$=4)}}function Xn(Pe){var Dt;for($n(Pe,Pe.dyn_ltree,Pe.l_desc.max_code),$n(Pe,Pe.dyn_dtree,Pe.d_desc.max_code),ei(Pe,Pe.bl_desc),Dt=G-1;Dt>=3&&Pe.bl_tree[pe[Dt]*2+1]===0;Dt--);return Pe.opt_len+=3*(Dt+1)+5+5+4,Dt}function Nn(Pe,Dt,Vt,sr){var Ze;for(cr(Pe,Dt-257,5),cr(Pe,Vt-1,5),cr(Pe,sr-4,4),Ze=0;Ze<sr;Ze++)cr(Pe,Pe.bl_tree[pe[Ze]*2+1],3);un(Pe,Pe.dyn_ltree,Dt-1),un(Pe,Pe.dyn_dtree,Vt-1)}function bn(Pe){var Dt=4093624447,Vt;for(Vt=0;Vt<=31;Vt++,Dt>>>=1)if(Dt&1&&Pe.dyn_ltree[Vt*2]!==0)return t;if(Pe.dyn_ltree[9*2]!==0||Pe.dyn_ltree[10*2]!==0||Pe.dyn_ltree[13*2]!==0)return n;for(Vt=32;Vt<S;Vt++)if(Pe.dyn_ltree[Vt*2]!==0)return n;return t}var Wn=!1;function Ut(Pe){Wn||(Er(),Wn=!0),Pe.l_desc=new mt(Pe.dyn_ltree,rt),Pe.d_desc=new mt(Pe.dyn_dtree,tt),Pe.bl_desc=new mt(Pe.bl_tree,lt),Pe.bi_buf=0,Pe.bi_valid=0,Ar(Pe)}function dr(Pe,Dt,Vt,sr){cr(Pe,(s<<1)+(sr?1:0),3),hr(Pe,Dt,Vt)}function Tr(Pe){cr(Pe,c<<1,3),Xt(Pe,fe,ne),Lt(Pe)}function qr(Pe,Dt,Vt,sr){var Ze,Mt,ge=0;Pe.level>0?(Pe.strm.data_type===i&&(Pe.strm.data_type=bn(Pe)),ei(Pe,Pe.l_desc),ei(Pe,Pe.d_desc),ge=Xn(Pe),Ze=Pe.opt_len+3+7>>>3,Mt=Pe.static_len+3+7>>>3,Mt<=Ze&&(Ze=Mt)):Ze=Mt=Vt+5,Vt+4<=Ze&&Dt!==-1?dr(Pe,Dt,Vt,sr):Pe.strategy===e||Mt===Ze?(cr(Pe,(c<<1)+(sr?1:0),3),Sr(Pe,ne,ye)):(cr(Pe,(f<<1)+(sr?1:0),3),Nn(Pe,Pe.l_desc.max_code+1,Pe.d_desc.max_code+1,ge+1),Sr(Pe,Pe.dyn_ltree,Pe.dyn_dtree)),Ar(Pe),sr&&Mn(Pe)}function ui(Pe,Dt,Vt){return Pe.pending_buf[Pe.d_buf+Pe.last_lit*2]=Dt>>>8&255,Pe.pending_buf[Pe.d_buf+Pe.last_lit*2+1]=Dt&255,Pe.pending_buf[Pe.l_buf+Pe.last_lit]=Vt&255,Pe.last_lit++,Dt===0?Pe.dyn_ltree[Vt*2]++:(Pe.matches++,Dt--,Pe.dyn_ltree[(we[Vt]+S+1)*2]++,Pe.dyn_dtree[Tt(Dt)*2]++),Pe.last_lit===Pe.lit_bufsize-1}return Df._tr_init=Ut,Df._tr_stored_block=dr,Df._tr_flush_block=qr,Df._tr_tally=ui,Df._tr_align=Tr,Df}var L1,AF;function dN(){if(AF)return L1;AF=1;function r(e,t,n,i){for(var o=e&65535|0,s=e>>>16&65535|0,c=0;n!==0;){c=n>2e3?2e3:n,n-=c;do o=o+t[i++]|0,s=s+o|0;while(--c);o%=65521,s%=65521}return o|s<<16|0}return L1=r,L1}var k1,pF;function AN(){if(pF)return k1;pF=1;function r(){for(var n,i=[],o=0;o<256;o++){n=o;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;i[o]=n}return i}var e=r();function t(n,i,o,s){var c=e,f=s+o;n^=-1;for(var _=s;_<f;_++)n=n>>>8^c[(n^i[_])&255];return n^-1}return k1=t,k1}var N1,gF;function oE(){return gF||(gF=1,N1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),N1}var mF;function E1e(){if(mF)return Qa;mF=1;var r=rf(),e=C1e(),t=dN(),n=AN(),i=oE(),o=0,s=1,c=3,f=4,_=5,b=0,T=1,S=-2,D=-3,N=-5,G=-1,W=1,z=2,j=3,K=4,fe=0,Z=2,ae=8,Be=9,Le=15,de=8,_e=29,pe=256,J=pe+1+_e,ne=30,ye=19,Ye=2*J+1,we=15,Ne=3,Ge=258,Qe=Ge+Ne+1,rt=32,tt=42,lt=69,mt=73,Tt=91,nt=103,cr=113,Xt=666,$t=1,Lt=2,lr=3,tn=4,Er=3;function Ar($,yt){return $.msg=i[yt],yt}function Mn($){return($<<1)-($>4?9:0)}function hr($){for(var yt=$.length;--yt>=0;)$[yt]=0}function pr($){var yt=$.state,Et=yt.pending;Et>$.avail_out&&(Et=$.avail_out),Et!==0&&(r.arraySet($.output,yt.pending_buf,yt.pending_out,Et,$.next_out),$.next_out+=Et,yt.pending_out+=Et,$.total_out+=Et,$.avail_out-=Et,yt.pending-=Et,yt.pending===0&&(yt.pending_out=0))}function rn($,yt){e._tr_flush_block($,$.block_start>=0?$.block_start:-1,$.strstart-$.block_start,yt),$.block_start=$.strstart,pr($.strm)}function Sr($,yt){$.pending_buf[$.pending++]=yt}function ei($,yt){$.pending_buf[$.pending++]=yt>>>8&255,$.pending_buf[$.pending++]=yt&255}function $n($,yt,Et,Te){var Je=$.avail_in;return Je>Te&&(Je=Te),Je===0?0:($.avail_in-=Je,r.arraySet(yt,$.input,$.next_in,Je,Et),$.state.wrap===1?$.adler=t($.adler,yt,Je,Et):$.state.wrap===2&&($.adler=n($.adler,yt,Je,Et)),$.next_in+=Je,$.total_in+=Je,Je)}function un($,yt){var Et=$.max_chain_length,Te=$.strstart,Je,ct,q=$.prev_length,ie=$.nice_match,ue=$.strstart>$.w_size-Qe?$.strstart-($.w_size-Qe):0,be=$.window,De=$.w_mask,Ae=$.prev,xe=$.strstart+Ge,ce=be[Te+q-1],Se=be[Te+q];$.prev_length>=$.good_match&&(Et>>=2),ie>$.lookahead&&(ie=$.lookahead);do if(Je=yt,!(be[Je+q]!==Se||be[Je+q-1]!==ce||be[Je]!==be[Te]||be[++Je]!==be[Te+1])){Te+=2,Je++;do;while(be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&be[++Te]===be[++Je]&&Te<xe);if(ct=Ge-(xe-Te),Te=xe-Ge,ct>q){if($.match_start=yt,q=ct,ct>=ie)break;ce=be[Te+q-1],Se=be[Te+q]}}while((yt=Ae[yt&De])>ue&&--Et!==0);return q<=$.lookahead?q:$.lookahead}function Xn($){var yt=$.w_size,Et,Te,Je,ct,q;do{if(ct=$.window_size-$.lookahead-$.strstart,$.strstart>=yt+(yt-Qe)){r.arraySet($.window,$.window,yt,yt,0),$.match_start-=yt,$.strstart-=yt,$.block_start-=yt,Te=$.hash_size,Et=Te;do Je=$.head[--Et],$.head[Et]=Je>=yt?Je-yt:0;while(--Te);Te=yt,Et=Te;do Je=$.prev[--Et],$.prev[Et]=Je>=yt?Je-yt:0;while(--Te);ct+=yt}if($.strm.avail_in===0)break;if(Te=$n($.strm,$.window,$.strstart+$.lookahead,ct),$.lookahead+=Te,$.lookahead+$.insert>=Ne)for(q=$.strstart-$.insert,$.ins_h=$.window[q],$.ins_h=($.ins_h<<$.hash_shift^$.window[q+1])&$.hash_mask;$.insert&&($.ins_h=($.ins_h<<$.hash_shift^$.window[q+Ne-1])&$.hash_mask,$.prev[q&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=q,q++,$.insert--,!($.lookahead+$.insert<Ne)););}while($.lookahead<Qe&&$.strm.avail_in!==0)}function Nn($,yt){var Et=65535;for(Et>$.pending_buf_size-5&&(Et=$.pending_buf_size-5);;){if($.lookahead<=1){if(Xn($),$.lookahead===0&&yt===o)return $t;if($.lookahead===0)break}$.strstart+=$.lookahead,$.lookahead=0;var Te=$.block_start+Et;if(($.strstart===0||$.strstart>=Te)&&($.lookahead=$.strstart-Te,$.strstart=Te,rn($,!1),$.strm.avail_out===0)||$.strstart-$.block_start>=$.w_size-Qe&&(rn($,!1),$.strm.avail_out===0))return $t}return $.insert=0,yt===f?(rn($,!0),$.strm.avail_out===0?lr:tn):($.strstart>$.block_start&&(rn($,!1),$.strm.avail_out===0),$t)}function bn($,yt){for(var Et,Te;;){if($.lookahead<Qe){if(Xn($),$.lookahead<Qe&&yt===o)return $t;if($.lookahead===0)break}if(Et=0,$.lookahead>=Ne&&($.ins_h=($.ins_h<<$.hash_shift^$.window[$.strstart+Ne-1])&$.hash_mask,Et=$.prev[$.strstart&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=$.strstart),Et!==0&&$.strstart-Et<=$.w_size-Qe&&($.match_length=un($,Et)),$.match_length>=Ne)if(Te=e._tr_tally($,$.strstart-$.match_start,$.match_length-Ne),$.lookahead-=$.match_length,$.match_length<=$.max_lazy_match&&$.lookahead>=Ne){$.match_length--;do $.strstart++,$.ins_h=($.ins_h<<$.hash_shift^$.window[$.strstart+Ne-1])&$.hash_mask,Et=$.prev[$.strstart&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=$.strstart;while(--$.match_length!==0);$.strstart++}else $.strstart+=$.match_length,$.match_length=0,$.ins_h=$.window[$.strstart],$.ins_h=($.ins_h<<$.hash_shift^$.window[$.strstart+1])&$.hash_mask;else Te=e._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++;if(Te&&(rn($,!1),$.strm.avail_out===0))return $t}return $.insert=$.strstart<Ne-1?$.strstart:Ne-1,yt===f?(rn($,!0),$.strm.avail_out===0?lr:tn):$.last_lit&&(rn($,!1),$.strm.avail_out===0)?$t:Lt}function Wn($,yt){for(var Et,Te,Je;;){if($.lookahead<Qe){if(Xn($),$.lookahead<Qe&&yt===o)return $t;if($.lookahead===0)break}if(Et=0,$.lookahead>=Ne&&($.ins_h=($.ins_h<<$.hash_shift^$.window[$.strstart+Ne-1])&$.hash_mask,Et=$.prev[$.strstart&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=$.strstart),$.prev_length=$.match_length,$.prev_match=$.match_start,$.match_length=Ne-1,Et!==0&&$.prev_length<$.max_lazy_match&&$.strstart-Et<=$.w_size-Qe&&($.match_length=un($,Et),$.match_length<=5&&($.strategy===W||$.match_length===Ne&&$.strstart-$.match_start>4096)&&($.match_length=Ne-1)),$.prev_length>=Ne&&$.match_length<=$.prev_length){Je=$.strstart+$.lookahead-Ne,Te=e._tr_tally($,$.strstart-1-$.prev_match,$.prev_length-Ne),$.lookahead-=$.prev_length-1,$.prev_length-=2;do++$.strstart<=Je&&($.ins_h=($.ins_h<<$.hash_shift^$.window[$.strstart+Ne-1])&$.hash_mask,Et=$.prev[$.strstart&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=$.strstart);while(--$.prev_length!==0);if($.match_available=0,$.match_length=Ne-1,$.strstart++,Te&&(rn($,!1),$.strm.avail_out===0))return $t}else if($.match_available){if(Te=e._tr_tally($,0,$.window[$.strstart-1]),Te&&rn($,!1),$.strstart++,$.lookahead--,$.strm.avail_out===0)return $t}else $.match_available=1,$.strstart++,$.lookahead--}return $.match_available&&(Te=e._tr_tally($,0,$.window[$.strstart-1]),$.match_available=0),$.insert=$.strstart<Ne-1?$.strstart:Ne-1,yt===f?(rn($,!0),$.strm.avail_out===0?lr:tn):$.last_lit&&(rn($,!1),$.strm.avail_out===0)?$t:Lt}function Ut($,yt){for(var Et,Te,Je,ct,q=$.window;;){if($.lookahead<=Ge){if(Xn($),$.lookahead<=Ge&&yt===o)return $t;if($.lookahead===0)break}if($.match_length=0,$.lookahead>=Ne&&$.strstart>0&&(Je=$.strstart-1,Te=q[Je],Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je])){ct=$.strstart+Ge;do;while(Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je]&&Te===q[++Je]&&Je<ct);$.match_length=Ge-(ct-Je),$.match_length>$.lookahead&&($.match_length=$.lookahead)}if($.match_length>=Ne?(Et=e._tr_tally($,1,$.match_length-Ne),$.lookahead-=$.match_length,$.strstart+=$.match_length,$.match_length=0):(Et=e._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++),Et&&(rn($,!1),$.strm.avail_out===0))return $t}return $.insert=0,yt===f?(rn($,!0),$.strm.avail_out===0?lr:tn):$.last_lit&&(rn($,!1),$.strm.avail_out===0)?$t:Lt}function dr($,yt){for(var Et;;){if($.lookahead===0&&(Xn($),$.lookahead===0)){if(yt===o)return $t;break}if($.match_length=0,Et=e._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++,Et&&(rn($,!1),$.strm.avail_out===0))return $t}return $.insert=0,yt===f?(rn($,!0),$.strm.avail_out===0?lr:tn):$.last_lit&&(rn($,!1),$.strm.avail_out===0)?$t:Lt}function Tr($,yt,Et,Te,Je){this.good_length=$,this.max_lazy=yt,this.nice_length=Et,this.max_chain=Te,this.func=Je}var qr;qr=[new Tr(0,0,0,0,Nn),new Tr(4,4,8,4,bn),new Tr(4,5,16,8,bn),new Tr(4,6,32,32,bn),new Tr(4,4,16,16,Wn),new Tr(8,16,32,32,Wn),new Tr(8,16,128,128,Wn),new Tr(8,32,128,256,Wn),new Tr(32,128,258,1024,Wn),new Tr(32,258,258,4096,Wn)];function ui($){$.window_size=2*$.w_size,hr($.head),$.max_lazy_match=qr[$.level].max_lazy,$.good_match=qr[$.level].good_length,$.nice_match=qr[$.level].nice_length,$.max_chain_length=qr[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=Ne-1,$.match_available=0,$.ins_h=0}function Pe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ae,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(Ye*2),this.dyn_dtree=new r.Buf16((2*ne+1)*2),this.bl_tree=new r.Buf16((2*ye+1)*2),hr(this.dyn_ltree),hr(this.dyn_dtree),hr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(we+1),this.heap=new r.Buf16(2*J+1),hr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*J+1),hr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt($){var yt;return!$||!$.state?Ar($,S):($.total_in=$.total_out=0,$.data_type=Z,yt=$.state,yt.pending=0,yt.pending_out=0,yt.wrap<0&&(yt.wrap=-yt.wrap),yt.status=yt.wrap?tt:cr,$.adler=yt.wrap===2?0:1,yt.last_flush=o,e._tr_init(yt),b)}function Vt($){var yt=Dt($);return yt===b&&ui($.state),yt}function sr($,yt){return!$||!$.state||$.state.wrap!==2?S:($.state.gzhead=yt,b)}function Ze($,yt,Et,Te,Je,ct){if(!$)return S;var q=1;if(yt===G&&(yt=6),Te<0?(q=0,Te=-Te):Te>15&&(q=2,Te-=16),Je<1||Je>Be||Et!==ae||Te<8||Te>15||yt<0||yt>9||ct<0||ct>K)return Ar($,S);Te===8&&(Te=9);var ie=new Pe;return $.state=ie,ie.strm=$,ie.wrap=q,ie.gzhead=null,ie.w_bits=Te,ie.w_size=1<<ie.w_bits,ie.w_mask=ie.w_size-1,ie.hash_bits=Je+7,ie.hash_size=1<<ie.hash_bits,ie.hash_mask=ie.hash_size-1,ie.hash_shift=~~((ie.hash_bits+Ne-1)/Ne),ie.window=new r.Buf8(ie.w_size*2),ie.head=new r.Buf16(ie.hash_size),ie.prev=new r.Buf16(ie.w_size),ie.lit_bufsize=1<<Je+6,ie.pending_buf_size=ie.lit_bufsize*4,ie.pending_buf=new r.Buf8(ie.pending_buf_size),ie.d_buf=1*ie.lit_bufsize,ie.l_buf=3*ie.lit_bufsize,ie.level=yt,ie.strategy=ct,ie.method=Et,Vt($)}function Mt($,yt){return Ze($,yt,ae,Le,de,fe)}function ge($,yt){var Et,Te,Je,ct;if(!$||!$.state||yt>_||yt<0)return $?Ar($,S):S;if(Te=$.state,!$.output||!$.input&&$.avail_in!==0||Te.status===Xt&&yt!==f)return Ar($,$.avail_out===0?N:S);if(Te.strm=$,Et=Te.last_flush,Te.last_flush=yt,Te.status===tt)if(Te.wrap===2)$.adler=0,Sr(Te,31),Sr(Te,139),Sr(Te,8),Te.gzhead?(Sr(Te,(Te.gzhead.text?1:0)+(Te.gzhead.hcrc?2:0)+(Te.gzhead.extra?4:0)+(Te.gzhead.name?8:0)+(Te.gzhead.comment?16:0)),Sr(Te,Te.gzhead.time&255),Sr(Te,Te.gzhead.time>>8&255),Sr(Te,Te.gzhead.time>>16&255),Sr(Te,Te.gzhead.time>>24&255),Sr(Te,Te.level===9?2:Te.strategy>=z||Te.level<2?4:0),Sr(Te,Te.gzhead.os&255),Te.gzhead.extra&&Te.gzhead.extra.length&&(Sr(Te,Te.gzhead.extra.length&255),Sr(Te,Te.gzhead.extra.length>>8&255)),Te.gzhead.hcrc&&($.adler=n($.adler,Te.pending_buf,Te.pending,0)),Te.gzindex=0,Te.status=lt):(Sr(Te,0),Sr(Te,0),Sr(Te,0),Sr(Te,0),Sr(Te,0),Sr(Te,Te.level===9?2:Te.strategy>=z||Te.level<2?4:0),Sr(Te,Er),Te.status=cr);else{var q=ae+(Te.w_bits-8<<4)<<8,ie=-1;Te.strategy>=z||Te.level<2?ie=0:Te.level<6?ie=1:Te.level===6?ie=2:ie=3,q|=ie<<6,Te.strstart!==0&&(q|=rt),q+=31-q%31,Te.status=cr,ei(Te,q),Te.strstart!==0&&(ei(Te,$.adler>>>16),ei(Te,$.adler&65535)),$.adler=1}if(Te.status===lt)if(Te.gzhead.extra){for(Je=Te.pending;Te.gzindex<(Te.gzhead.extra.length&65535)&&!(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>Je&&($.adler=n($.adler,Te.pending_buf,Te.pending-Je,Je)),pr($),Je=Te.pending,Te.pending===Te.pending_buf_size));)Sr(Te,Te.gzhead.extra[Te.gzindex]&255),Te.gzindex++;Te.gzhead.hcrc&&Te.pending>Je&&($.adler=n($.adler,Te.pending_buf,Te.pending-Je,Je)),Te.gzindex===Te.gzhead.extra.length&&(Te.gzindex=0,Te.status=mt)}else Te.status=mt;if(Te.status===mt)if(Te.gzhead.name){Je=Te.pending;do{if(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>Je&&($.adler=n($.adler,Te.pending_buf,Te.pending-Je,Je)),pr($),Je=Te.pending,Te.pending===Te.pending_buf_size)){ct=1;break}Te.gzindex<Te.gzhead.name.length?ct=Te.gzhead.name.charCodeAt(Te.gzindex++)&255:ct=0,Sr(Te,ct)}while(ct!==0);Te.gzhead.hcrc&&Te.pending>Je&&($.adler=n($.adler,Te.pending_buf,Te.pending-Je,Je)),ct===0&&(Te.gzindex=0,Te.status=Tt)}else Te.status=Tt;if(Te.status===Tt)if(Te.gzhead.comment){Je=Te.pending;do{if(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>Je&&($.adler=n($.adler,Te.pending_buf,Te.pending-Je,Je)),pr($),Je=Te.pending,Te.pending===Te.pending_buf_size)){ct=1;break}Te.gzindex<Te.gzhead.comment.length?ct=Te.gzhead.comment.charCodeAt(Te.gzindex++)&255:ct=0,Sr(Te,ct)}while(ct!==0);Te.gzhead.hcrc&&Te.pending>Je&&($.adler=n($.adler,Te.pending_buf,Te.pending-Je,Je)),ct===0&&(Te.status=nt)}else Te.status=nt;if(Te.status===nt&&(Te.gzhead.hcrc?(Te.pending+2>Te.pending_buf_size&&pr($),Te.pending+2<=Te.pending_buf_size&&(Sr(Te,$.adler&255),Sr(Te,$.adler>>8&255),$.adler=0,Te.status=cr)):Te.status=cr),Te.pending!==0){if(pr($),$.avail_out===0)return Te.last_flush=-1,b}else if($.avail_in===0&&Mn(yt)<=Mn(Et)&&yt!==f)return Ar($,N);if(Te.status===Xt&&$.avail_in!==0)return Ar($,N);if($.avail_in!==0||Te.lookahead!==0||yt!==o&&Te.status!==Xt){var ue=Te.strategy===z?dr(Te,yt):Te.strategy===j?Ut(Te,yt):qr[Te.level].func(Te,yt);if((ue===lr||ue===tn)&&(Te.status=Xt),ue===$t||ue===lr)return $.avail_out===0&&(Te.last_flush=-1),b;if(ue===Lt&&(yt===s?e._tr_align(Te):yt!==_&&(e._tr_stored_block(Te,0,0,!1),yt===c&&(hr(Te.head),Te.lookahead===0&&(Te.strstart=0,Te.block_start=0,Te.insert=0))),pr($),$.avail_out===0))return Te.last_flush=-1,b}return yt!==f?b:Te.wrap<=0?T:(Te.wrap===2?(Sr(Te,$.adler&255),Sr(Te,$.adler>>8&255),Sr(Te,$.adler>>16&255),Sr(Te,$.adler>>24&255),Sr(Te,$.total_in&255),Sr(Te,$.total_in>>8&255),Sr(Te,$.total_in>>16&255),Sr(Te,$.total_in>>24&255)):(ei(Te,$.adler>>>16),ei(Te,$.adler&65535)),pr($),Te.wrap>0&&(Te.wrap=-Te.wrap),Te.pending!==0?b:T)}function Nt($){var yt;return!$||!$.state?S:(yt=$.state.status,yt!==tt&&yt!==lt&&yt!==mt&&yt!==Tt&&yt!==nt&&yt!==cr&&yt!==Xt?Ar($,S):($.state=null,yt===cr?Ar($,D):b))}function wt($,yt){var Et=yt.length,Te,Je,ct,q,ie,ue,be,De;if(!$||!$.state||(Te=$.state,q=Te.wrap,q===2||q===1&&Te.status!==tt||Te.lookahead))return S;for(q===1&&($.adler=t($.adler,yt,Et,0)),Te.wrap=0,Et>=Te.w_size&&(q===0&&(hr(Te.head),Te.strstart=0,Te.block_start=0,Te.insert=0),De=new r.Buf8(Te.w_size),r.arraySet(De,yt,Et-Te.w_size,Te.w_size,0),yt=De,Et=Te.w_size),ie=$.avail_in,ue=$.next_in,be=$.input,$.avail_in=Et,$.next_in=0,$.input=yt,Xn(Te);Te.lookahead>=Ne;){Je=Te.strstart,ct=Te.lookahead-(Ne-1);do Te.ins_h=(Te.ins_h<<Te.hash_shift^Te.window[Je+Ne-1])&Te.hash_mask,Te.prev[Je&Te.w_mask]=Te.head[Te.ins_h],Te.head[Te.ins_h]=Je,Je++;while(--ct);Te.strstart=Je,Te.lookahead=Ne-1,Xn(Te)}return Te.strstart+=Te.lookahead,Te.block_start=Te.strstart,Te.insert=Te.lookahead,Te.lookahead=0,Te.match_length=Te.prev_length=Ne-1,Te.match_available=0,$.next_in=ue,$.input=be,$.avail_in=ie,Te.wrap=q,b}return Qa.deflateInit=Mt,Qa.deflateInit2=Ze,Qa.deflateReset=Vt,Qa.deflateResetKeep=Dt,Qa.deflateSetHeader=sr,Qa.deflate=ge,Qa.deflateEnd=Nt,Qa.deflateSetDictionary=wt,Qa.deflateInfo="pako deflate (from Nodeca project)",Qa}var Lf={},_F;function pN(){if(_F)return Lf;_F=1;var r=rf(),e=!0,t=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{t=!1}for(var n=new r.Buf8(256),i=0;i<256;i++)n[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;n[254]=n[254]=1,Lf.string2buf=function(s){var c,f,_,b,T,S=s.length,D=0;for(b=0;b<S;b++)f=s.charCodeAt(b),(f&64512)===55296&&b+1<S&&(_=s.charCodeAt(b+1),(_&64512)===56320&&(f=65536+(f-55296<<10)+(_-56320),b++)),D+=f<128?1:f<2048?2:f<65536?3:4;for(c=new r.Buf8(D),T=0,b=0;T<D;b++)f=s.charCodeAt(b),(f&64512)===55296&&b+1<S&&(_=s.charCodeAt(b+1),(_&64512)===56320&&(f=65536+(f-55296<<10)+(_-56320),b++)),f<128?c[T++]=f:f<2048?(c[T++]=192|f>>>6,c[T++]=128|f&63):f<65536?(c[T++]=224|f>>>12,c[T++]=128|f>>>6&63,c[T++]=128|f&63):(c[T++]=240|f>>>18,c[T++]=128|f>>>12&63,c[T++]=128|f>>>6&63,c[T++]=128|f&63);return c};function o(s,c){if(c<65534&&(s.subarray&&t||!s.subarray&&e))return String.fromCharCode.apply(null,r.shrinkBuf(s,c));for(var f="",_=0;_<c;_++)f+=String.fromCharCode(s[_]);return f}return Lf.buf2binstring=function(s){return o(s,s.length)},Lf.binstring2buf=function(s){for(var c=new r.Buf8(s.length),f=0,_=c.length;f<_;f++)c[f]=s.charCodeAt(f);return c},Lf.buf2string=function(s,c){var f,_,b,T,S=c||s.length,D=new Array(S*2);for(_=0,f=0;f<S;){if(b=s[f++],b<128){D[_++]=b;continue}if(T=n[b],T>4){D[_++]=65533,f+=T-1;continue}for(b&=T===2?31:T===3?15:7;T>1&&f<S;)b=b<<6|s[f++]&63,T--;if(T>1){D[_++]=65533;continue}b<65536?D[_++]=b:(b-=65536,D[_++]=55296|b>>10&1023,D[_++]=56320|b&1023)}return o(D,_)},Lf.utf8border=function(s,c){var f;for(c=c||s.length,c>s.length&&(c=s.length),f=c-1;f>=0&&(s[f]&192)===128;)f--;return f<0||f===0?c:f+n[s[f]]>c?f:c},Lf}var U1,yF;function gN(){if(yF)return U1;yF=1;function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return U1=r,U1}var vF;function T1e(){if(vF)return Bd;vF=1;var r=E1e(),e=rf(),t=pN(),n=oE(),i=gN(),o=Object.prototype.toString,s=0,c=4,f=0,_=1,b=2,T=-1,S=0,D=8;function N(j){if(!(this instanceof N))return new N(j);this.options=e.assign({level:T,method:D,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},j||{});var K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var fe=r.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(fe!==f)throw new Error(n[fe]);if(K.header&&r.deflateSetHeader(this.strm,K.header),K.dictionary){var Z;if(typeof K.dictionary=="string"?Z=t.string2buf(K.dictionary):o.call(K.dictionary)==="[object ArrayBuffer]"?Z=new Uint8Array(K.dictionary):Z=K.dictionary,fe=r.deflateSetDictionary(this.strm,Z),fe!==f)throw new Error(n[fe]);this._dict_set=!0}}N.prototype.push=function(j,K){var fe=this.strm,Z=this.options.chunkSize,ae,Be;if(this.ended)return!1;Be=K===~~K?K:K===!0?c:s,typeof j=="string"?fe.input=t.string2buf(j):o.call(j)==="[object ArrayBuffer]"?fe.input=new Uint8Array(j):fe.input=j,fe.next_in=0,fe.avail_in=fe.input.length;do{if(fe.avail_out===0&&(fe.output=new e.Buf8(Z),fe.next_out=0,fe.avail_out=Z),ae=r.deflate(fe,Be),ae!==_&&ae!==f)return this.onEnd(ae),this.ended=!0,!1;(fe.avail_out===0||fe.avail_in===0&&(Be===c||Be===b))&&(this.options.to==="string"?this.onData(t.buf2binstring(e.shrinkBuf(fe.output,fe.next_out))):this.onData(e.shrinkBuf(fe.output,fe.next_out)))}while((fe.avail_in>0||fe.avail_out===0)&&ae!==_);return Be===c?(ae=r.deflateEnd(this.strm),this.onEnd(ae),this.ended=!0,ae===f):(Be===b&&(this.onEnd(f),fe.avail_out=0),!0)},N.prototype.onData=function(j){this.chunks.push(j)},N.prototype.onEnd=function(j){j===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg};function G(j,K){var fe=new N(K);if(fe.push(j,!0),fe.err)throw fe.msg||n[fe.err];return fe.result}function W(j,K){return K=K||{},K.raw=!0,G(j,K)}function z(j,K){return K=K||{},K.gzip=!0,G(j,K)}return Bd.Deflate=N,Bd.deflate=G,Bd.deflateRaw=W,Bd.gzip=z,Bd}var Sd={},wa={},z1,bF;function B1e(){if(bF)return z1;bF=1;var r=30,e=12;return z1=function(n,i){var o,s,c,f,_,b,T,S,D,N,G,W,z,j,K,fe,Z,ae,Be,Le,de,_e,pe,J,ne;o=n.state,s=n.next_in,J=n.input,c=s+(n.avail_in-5),f=n.next_out,ne=n.output,_=f-(i-n.avail_out),b=f+(n.avail_out-257),T=o.dmax,S=o.wsize,D=o.whave,N=o.wnext,G=o.window,W=o.hold,z=o.bits,j=o.lencode,K=o.distcode,fe=(1<<o.lenbits)-1,Z=(1<<o.distbits)-1;e:do{z<15&&(W+=J[s++]<<z,z+=8,W+=J[s++]<<z,z+=8),ae=j[W&fe];t:for(;;){if(Be=ae>>>24,W>>>=Be,z-=Be,Be=ae>>>16&255,Be===0)ne[f++]=ae&65535;else if(Be&16){Le=ae&65535,Be&=15,Be&&(z<Be&&(W+=J[s++]<<z,z+=8),Le+=W&(1<<Be)-1,W>>>=Be,z-=Be),z<15&&(W+=J[s++]<<z,z+=8,W+=J[s++]<<z,z+=8),ae=K[W&Z];r:for(;;){if(Be=ae>>>24,W>>>=Be,z-=Be,Be=ae>>>16&255,Be&16){if(de=ae&65535,Be&=15,z<Be&&(W+=J[s++]<<z,z+=8,z<Be&&(W+=J[s++]<<z,z+=8)),de+=W&(1<<Be)-1,de>T){n.msg="invalid distance too far back",o.mode=r;break e}if(W>>>=Be,z-=Be,Be=f-_,de>Be){if(Be=de-Be,Be>D&&o.sane){n.msg="invalid distance too far back",o.mode=r;break e}if(_e=0,pe=G,N===0){if(_e+=S-Be,Be<Le){Le-=Be;do ne[f++]=G[_e++];while(--Be);_e=f-de,pe=ne}}else if(N<Be){if(_e+=S+N-Be,Be-=N,Be<Le){Le-=Be;do ne[f++]=G[_e++];while(--Be);if(_e=0,N<Le){Be=N,Le-=Be;do ne[f++]=G[_e++];while(--Be);_e=f-de,pe=ne}}}else if(_e+=N-Be,Be<Le){Le-=Be;do ne[f++]=G[_e++];while(--Be);_e=f-de,pe=ne}for(;Le>2;)ne[f++]=pe[_e++],ne[f++]=pe[_e++],ne[f++]=pe[_e++],Le-=3;Le&&(ne[f++]=pe[_e++],Le>1&&(ne[f++]=pe[_e++]))}else{_e=f-de;do ne[f++]=ne[_e++],ne[f++]=ne[_e++],ne[f++]=ne[_e++],Le-=3;while(Le>2);Le&&(ne[f++]=ne[_e++],Le>1&&(ne[f++]=ne[_e++]))}}else if((Be&64)===0){ae=K[(ae&65535)+(W&(1<<Be)-1)];continue r}else{n.msg="invalid distance code",o.mode=r;break e}break}}else if((Be&64)===0){ae=j[(ae&65535)+(W&(1<<Be)-1)];continue t}else if(Be&32){o.mode=e;break e}else{n.msg="invalid literal/length code",o.mode=r;break e}break}}while(s<c&&f<b);Le=z>>3,s-=Le,z-=Le<<3,W&=(1<<z)-1,n.next_in=s,n.next_out=f,n.avail_in=s<c?5+(c-s):5-(s-c),n.avail_out=f<b?257+(b-f):257-(f-b),o.hold=W,o.bits=z},z1}var G1,xF;function S1e(){if(xF)return G1;xF=1;var r=rf(),e=15,t=852,n=592,i=0,o=1,s=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],b=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return G1=function(S,D,N,G,W,z,j,K){var fe=K.bits,Z=0,ae=0,Be=0,Le=0,de=0,_e=0,pe=0,J=0,ne=0,ye=0,Ye,we,Ne,Ge,Qe,rt=null,tt=0,lt,mt=new r.Buf16(e+1),Tt=new r.Buf16(e+1),nt=null,cr=0,Xt,$t,Lt;for(Z=0;Z<=e;Z++)mt[Z]=0;for(ae=0;ae<G;ae++)mt[D[N+ae]]++;for(de=fe,Le=e;Le>=1&&mt[Le]===0;Le--);if(de>Le&&(de=Le),Le===0)return W[z++]=1<<24|64<<16|0,W[z++]=1<<24|64<<16|0,K.bits=1,0;for(Be=1;Be<Le&&mt[Be]===0;Be++);for(de<Be&&(de=Be),J=1,Z=1;Z<=e;Z++)if(J<<=1,J-=mt[Z],J<0)return-1;if(J>0&&(S===i||Le!==1))return-1;for(Tt[1]=0,Z=1;Z<e;Z++)Tt[Z+1]=Tt[Z]+mt[Z];for(ae=0;ae<G;ae++)D[N+ae]!==0&&(j[Tt[D[N+ae]]++]=ae);if(S===i?(rt=nt=j,lt=19):S===o?(rt=c,tt-=257,nt=f,cr-=257,lt=256):(rt=_,nt=b,lt=-1),ye=0,ae=0,Z=Be,Qe=z,_e=de,pe=0,Ne=-1,ne=1<<de,Ge=ne-1,S===o&&ne>t||S===s&&ne>n)return 1;for(;;){Xt=Z-pe,j[ae]<lt?($t=0,Lt=j[ae]):j[ae]>lt?($t=nt[cr+j[ae]],Lt=rt[tt+j[ae]]):($t=96,Lt=0),Ye=1<<Z-pe,we=1<<_e,Be=we;do we-=Ye,W[Qe+(ye>>pe)+we]=Xt<<24|$t<<16|Lt|0;while(we!==0);for(Ye=1<<Z-1;ye&Ye;)Ye>>=1;if(Ye!==0?(ye&=Ye-1,ye+=Ye):ye=0,ae++,--mt[Z]===0){if(Z===Le)break;Z=D[N+j[ae]]}if(Z>de&&(ye&Ge)!==Ne){for(pe===0&&(pe=de),Qe+=Be,_e=Z-pe,J=1<<_e;_e+pe<Le&&(J-=mt[_e+pe],!(J<=0));)_e++,J<<=1;if(ne+=1<<_e,S===o&&ne>t||S===s&&ne>n)return 1;Ne=ye&Ge,W[Ne]=de<<24|_e<<16|Qe-z|0}}return ye!==0&&(W[Qe+ye]=Z-pe<<24|64<<16|0),K.bits=de,0},G1}var wF;function I1e(){if(wF)return wa;wF=1;var r=rf(),e=dN(),t=AN(),n=B1e(),i=S1e(),o=0,s=1,c=2,f=4,_=5,b=6,T=0,S=1,D=2,N=-2,G=-3,W=-4,z=-5,j=8,K=1,fe=2,Z=3,ae=4,Be=5,Le=6,de=7,_e=8,pe=9,J=10,ne=11,ye=12,Ye=13,we=14,Ne=15,Ge=16,Qe=17,rt=18,tt=19,lt=20,mt=21,Tt=22,nt=23,cr=24,Xt=25,$t=26,Lt=27,lr=28,tn=29,Er=30,Ar=31,Mn=32,hr=852,pr=592,rn=15,Sr=rn;function ei(Ze){return(Ze>>>24&255)+(Ze>>>8&65280)+((Ze&65280)<<8)+((Ze&255)<<24)}function $n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function un(Ze){var Mt;return!Ze||!Ze.state?N:(Mt=Ze.state,Ze.total_in=Ze.total_out=Mt.total=0,Ze.msg="",Mt.wrap&&(Ze.adler=Mt.wrap&1),Mt.mode=K,Mt.last=0,Mt.havedict=0,Mt.dmax=32768,Mt.head=null,Mt.hold=0,Mt.bits=0,Mt.lencode=Mt.lendyn=new r.Buf32(hr),Mt.distcode=Mt.distdyn=new r.Buf32(pr),Mt.sane=1,Mt.back=-1,T)}function Xn(Ze){var Mt;return!Ze||!Ze.state?N:(Mt=Ze.state,Mt.wsize=0,Mt.whave=0,Mt.wnext=0,un(Ze))}function Nn(Ze,Mt){var ge,Nt;return!Ze||!Ze.state||(Nt=Ze.state,Mt<0?(ge=0,Mt=-Mt):(ge=(Mt>>4)+1,Mt<48&&(Mt&=15)),Mt&&(Mt<8||Mt>15))?N:(Nt.window!==null&&Nt.wbits!==Mt&&(Nt.window=null),Nt.wrap=ge,Nt.wbits=Mt,Xn(Ze))}function bn(Ze,Mt){var ge,Nt;return Ze?(Nt=new $n,Ze.state=Nt,Nt.window=null,ge=Nn(Ze,Mt),ge!==T&&(Ze.state=null),ge):N}function Wn(Ze){return bn(Ze,Sr)}var Ut=!0,dr,Tr;function qr(Ze){if(Ut){var Mt;for(dr=new r.Buf32(512),Tr=new r.Buf32(32),Mt=0;Mt<144;)Ze.lens[Mt++]=8;for(;Mt<256;)Ze.lens[Mt++]=9;for(;Mt<280;)Ze.lens[Mt++]=7;for(;Mt<288;)Ze.lens[Mt++]=8;for(i(s,Ze.lens,0,288,dr,0,Ze.work,{bits:9}),Mt=0;Mt<32;)Ze.lens[Mt++]=5;i(c,Ze.lens,0,32,Tr,0,Ze.work,{bits:5}),Ut=!1}Ze.lencode=dr,Ze.lenbits=9,Ze.distcode=Tr,Ze.distbits=5}function ui(Ze,Mt,ge,Nt){var wt,$=Ze.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new r.Buf8($.wsize)),Nt>=$.wsize?(r.arraySet($.window,Mt,ge-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(wt=$.wsize-$.wnext,wt>Nt&&(wt=Nt),r.arraySet($.window,Mt,ge-Nt,wt,$.wnext),Nt-=wt,Nt?(r.arraySet($.window,Mt,ge-Nt,Nt,0),$.wnext=Nt,$.whave=$.wsize):($.wnext+=wt,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=wt))),0}function Pe(Ze,Mt){var ge,Nt,wt,$,yt,Et,Te,Je,ct,q,ie,ue,be,De,Ae=0,xe,ce,Se,p,le,vt,Ke,Ct,It=new r.Buf8(4),Ft,ut,Ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Ze||!Ze.state||!Ze.output||!Ze.input&&Ze.avail_in!==0)return N;ge=Ze.state,ge.mode===ye&&(ge.mode=Ye),yt=Ze.next_out,wt=Ze.output,Te=Ze.avail_out,$=Ze.next_in,Nt=Ze.input,Et=Ze.avail_in,Je=ge.hold,ct=ge.bits,q=Et,ie=Te,Ct=T;e:for(;;)switch(ge.mode){case K:if(ge.wrap===0){ge.mode=Ye;break}for(;ct<16;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(ge.wrap&2&&Je===35615){ge.check=0,It[0]=Je&255,It[1]=Je>>>8&255,ge.check=t(ge.check,It,2,0),Je=0,ct=0,ge.mode=fe;break}if(ge.flags=0,ge.head&&(ge.head.done=!1),!(ge.wrap&1)||(((Je&255)<<8)+(Je>>8))%31){Ze.msg="incorrect header check",ge.mode=Er;break}if((Je&15)!==j){Ze.msg="unknown compression method",ge.mode=Er;break}if(Je>>>=4,ct-=4,Ke=(Je&15)+8,ge.wbits===0)ge.wbits=Ke;else if(Ke>ge.wbits){Ze.msg="invalid window size",ge.mode=Er;break}ge.dmax=1<<Ke,Ze.adler=ge.check=1,ge.mode=Je&512?J:ye,Je=0,ct=0;break;case fe:for(;ct<16;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(ge.flags=Je,(ge.flags&255)!==j){Ze.msg="unknown compression method",ge.mode=Er;break}if(ge.flags&57344){Ze.msg="unknown header flags set",ge.mode=Er;break}ge.head&&(ge.head.text=Je>>8&1),ge.flags&512&&(It[0]=Je&255,It[1]=Je>>>8&255,ge.check=t(ge.check,It,2,0)),Je=0,ct=0,ge.mode=Z;case Z:for(;ct<32;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}ge.head&&(ge.head.time=Je),ge.flags&512&&(It[0]=Je&255,It[1]=Je>>>8&255,It[2]=Je>>>16&255,It[3]=Je>>>24&255,ge.check=t(ge.check,It,4,0)),Je=0,ct=0,ge.mode=ae;case ae:for(;ct<16;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}ge.head&&(ge.head.xflags=Je&255,ge.head.os=Je>>8),ge.flags&512&&(It[0]=Je&255,It[1]=Je>>>8&255,ge.check=t(ge.check,It,2,0)),Je=0,ct=0,ge.mode=Be;case Be:if(ge.flags&1024){for(;ct<16;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}ge.length=Je,ge.head&&(ge.head.extra_len=Je),ge.flags&512&&(It[0]=Je&255,It[1]=Je>>>8&255,ge.check=t(ge.check,It,2,0)),Je=0,ct=0}else ge.head&&(ge.head.extra=null);ge.mode=Le;case Le:if(ge.flags&1024&&(ue=ge.length,ue>Et&&(ue=Et),ue&&(ge.head&&(Ke=ge.head.extra_len-ge.length,ge.head.extra||(ge.head.extra=new Array(ge.head.extra_len)),r.arraySet(ge.head.extra,Nt,$,ue,Ke)),ge.flags&512&&(ge.check=t(ge.check,Nt,ue,$)),Et-=ue,$+=ue,ge.length-=ue),ge.length))break e;ge.length=0,ge.mode=de;case de:if(ge.flags&2048){if(Et===0)break e;ue=0;do Ke=Nt[$+ue++],ge.head&&Ke&&ge.length<65536&&(ge.head.name+=String.fromCharCode(Ke));while(Ke&&ue<Et);if(ge.flags&512&&(ge.check=t(ge.check,Nt,ue,$)),Et-=ue,$+=ue,Ke)break e}else ge.head&&(ge.head.name=null);ge.length=0,ge.mode=_e;case _e:if(ge.flags&4096){if(Et===0)break e;ue=0;do Ke=Nt[$+ue++],ge.head&&Ke&&ge.length<65536&&(ge.head.comment+=String.fromCharCode(Ke));while(Ke&&ue<Et);if(ge.flags&512&&(ge.check=t(ge.check,Nt,ue,$)),Et-=ue,$+=ue,Ke)break e}else ge.head&&(ge.head.comment=null);ge.mode=pe;case pe:if(ge.flags&512){for(;ct<16;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(Je!==(ge.check&65535)){Ze.msg="header crc mismatch",ge.mode=Er;break}Je=0,ct=0}ge.head&&(ge.head.hcrc=ge.flags>>9&1,ge.head.done=!0),Ze.adler=ge.check=0,ge.mode=ye;break;case J:for(;ct<32;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}Ze.adler=ge.check=ei(Je),Je=0,ct=0,ge.mode=ne;case ne:if(ge.havedict===0)return Ze.next_out=yt,Ze.avail_out=Te,Ze.next_in=$,Ze.avail_in=Et,ge.hold=Je,ge.bits=ct,D;Ze.adler=ge.check=1,ge.mode=ye;case ye:if(Mt===_||Mt===b)break e;case Ye:if(ge.last){Je>>>=ct&7,ct-=ct&7,ge.mode=Lt;break}for(;ct<3;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}switch(ge.last=Je&1,Je>>>=1,ct-=1,Je&3){case 0:ge.mode=we;break;case 1:if(qr(ge),ge.mode=lt,Mt===b){Je>>>=2,ct-=2;break e}break;case 2:ge.mode=Qe;break;case 3:Ze.msg="invalid block type",ge.mode=Er}Je>>>=2,ct-=2;break;case we:for(Je>>>=ct&7,ct-=ct&7;ct<32;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if((Je&65535)!==(Je>>>16^65535)){Ze.msg="invalid stored block lengths",ge.mode=Er;break}if(ge.length=Je&65535,Je=0,ct=0,ge.mode=Ne,Mt===b)break e;case Ne:ge.mode=Ge;case Ge:if(ue=ge.length,ue){if(ue>Et&&(ue=Et),ue>Te&&(ue=Te),ue===0)break e;r.arraySet(wt,Nt,$,ue,yt),Et-=ue,$+=ue,Te-=ue,yt+=ue,ge.length-=ue;break}ge.mode=ye;break;case Qe:for(;ct<14;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(ge.nlen=(Je&31)+257,Je>>>=5,ct-=5,ge.ndist=(Je&31)+1,Je>>>=5,ct-=5,ge.ncode=(Je&15)+4,Je>>>=4,ct-=4,ge.nlen>286||ge.ndist>30){Ze.msg="too many length or distance symbols",ge.mode=Er;break}ge.have=0,ge.mode=rt;case rt:for(;ge.have<ge.ncode;){for(;ct<3;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}ge.lens[Ot[ge.have++]]=Je&7,Je>>>=3,ct-=3}for(;ge.have<19;)ge.lens[Ot[ge.have++]]=0;if(ge.lencode=ge.lendyn,ge.lenbits=7,Ft={bits:ge.lenbits},Ct=i(o,ge.lens,0,19,ge.lencode,0,ge.work,Ft),ge.lenbits=Ft.bits,Ct){Ze.msg="invalid code lengths set",ge.mode=Er;break}ge.have=0,ge.mode=tt;case tt:for(;ge.have<ge.nlen+ge.ndist;){for(;Ae=ge.lencode[Je&(1<<ge.lenbits)-1],xe=Ae>>>24,ce=Ae>>>16&255,Se=Ae&65535,!(xe<=ct);){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(Se<16)Je>>>=xe,ct-=xe,ge.lens[ge.have++]=Se;else{if(Se===16){for(ut=xe+2;ct<ut;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(Je>>>=xe,ct-=xe,ge.have===0){Ze.msg="invalid bit length repeat",ge.mode=Er;break}Ke=ge.lens[ge.have-1],ue=3+(Je&3),Je>>>=2,ct-=2}else if(Se===17){for(ut=xe+3;ct<ut;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}Je>>>=xe,ct-=xe,Ke=0,ue=3+(Je&7),Je>>>=3,ct-=3}else{for(ut=xe+7;ct<ut;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}Je>>>=xe,ct-=xe,Ke=0,ue=11+(Je&127),Je>>>=7,ct-=7}if(ge.have+ue>ge.nlen+ge.ndist){Ze.msg="invalid bit length repeat",ge.mode=Er;break}for(;ue--;)ge.lens[ge.have++]=Ke}}if(ge.mode===Er)break;if(ge.lens[256]===0){Ze.msg="invalid code -- missing end-of-block",ge.mode=Er;break}if(ge.lenbits=9,Ft={bits:ge.lenbits},Ct=i(s,ge.lens,0,ge.nlen,ge.lencode,0,ge.work,Ft),ge.lenbits=Ft.bits,Ct){Ze.msg="invalid literal/lengths set",ge.mode=Er;break}if(ge.distbits=6,ge.distcode=ge.distdyn,Ft={bits:ge.distbits},Ct=i(c,ge.lens,ge.nlen,ge.ndist,ge.distcode,0,ge.work,Ft),ge.distbits=Ft.bits,Ct){Ze.msg="invalid distances set",ge.mode=Er;break}if(ge.mode=lt,Mt===b)break e;case lt:ge.mode=mt;case mt:if(Et>=6&&Te>=258){Ze.next_out=yt,Ze.avail_out=Te,Ze.next_in=$,Ze.avail_in=Et,ge.hold=Je,ge.bits=ct,n(Ze,ie),yt=Ze.next_out,wt=Ze.output,Te=Ze.avail_out,$=Ze.next_in,Nt=Ze.input,Et=Ze.avail_in,Je=ge.hold,ct=ge.bits,ge.mode===ye&&(ge.back=-1);break}for(ge.back=0;Ae=ge.lencode[Je&(1<<ge.lenbits)-1],xe=Ae>>>24,ce=Ae>>>16&255,Se=Ae&65535,!(xe<=ct);){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(ce&&(ce&240)===0){for(p=xe,le=ce,vt=Se;Ae=ge.lencode[vt+((Je&(1<<p+le)-1)>>p)],xe=Ae>>>24,ce=Ae>>>16&255,Se=Ae&65535,!(p+xe<=ct);){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}Je>>>=p,ct-=p,ge.back+=p}if(Je>>>=xe,ct-=xe,ge.back+=xe,ge.length=Se,ce===0){ge.mode=$t;break}if(ce&32){ge.back=-1,ge.mode=ye;break}if(ce&64){Ze.msg="invalid literal/length code",ge.mode=Er;break}ge.extra=ce&15,ge.mode=Tt;case Tt:if(ge.extra){for(ut=ge.extra;ct<ut;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}ge.length+=Je&(1<<ge.extra)-1,Je>>>=ge.extra,ct-=ge.extra,ge.back+=ge.extra}ge.was=ge.length,ge.mode=nt;case nt:for(;Ae=ge.distcode[Je&(1<<ge.distbits)-1],xe=Ae>>>24,ce=Ae>>>16&255,Se=Ae&65535,!(xe<=ct);){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if((ce&240)===0){for(p=xe,le=ce,vt=Se;Ae=ge.distcode[vt+((Je&(1<<p+le)-1)>>p)],xe=Ae>>>24,ce=Ae>>>16&255,Se=Ae&65535,!(p+xe<=ct);){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}Je>>>=p,ct-=p,ge.back+=p}if(Je>>>=xe,ct-=xe,ge.back+=xe,ce&64){Ze.msg="invalid distance code",ge.mode=Er;break}ge.offset=Se,ge.extra=ce&15,ge.mode=cr;case cr:if(ge.extra){for(ut=ge.extra;ct<ut;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}ge.offset+=Je&(1<<ge.extra)-1,Je>>>=ge.extra,ct-=ge.extra,ge.back+=ge.extra}if(ge.offset>ge.dmax){Ze.msg="invalid distance too far back",ge.mode=Er;break}ge.mode=Xt;case Xt:if(Te===0)break e;if(ue=ie-Te,ge.offset>ue){if(ue=ge.offset-ue,ue>ge.whave&&ge.sane){Ze.msg="invalid distance too far back",ge.mode=Er;break}ue>ge.wnext?(ue-=ge.wnext,be=ge.wsize-ue):be=ge.wnext-ue,ue>ge.length&&(ue=ge.length),De=ge.window}else De=wt,be=yt-ge.offset,ue=ge.length;ue>Te&&(ue=Te),Te-=ue,ge.length-=ue;do wt[yt++]=De[be++];while(--ue);ge.length===0&&(ge.mode=mt);break;case $t:if(Te===0)break e;wt[yt++]=ge.length,Te--,ge.mode=mt;break;case Lt:if(ge.wrap){for(;ct<32;){if(Et===0)break e;Et--,Je|=Nt[$++]<<ct,ct+=8}if(ie-=Te,Ze.total_out+=ie,ge.total+=ie,ie&&(Ze.adler=ge.check=ge.flags?t(ge.check,wt,ie,yt-ie):e(ge.check,wt,ie,yt-ie)),ie=Te,(ge.flags?Je:ei(Je))!==ge.check){Ze.msg="incorrect data check",ge.mode=Er;break}Je=0,ct=0}ge.mode=lr;case lr:if(ge.wrap&&ge.flags){for(;ct<32;){if(Et===0)break e;Et--,Je+=Nt[$++]<<ct,ct+=8}if(Je!==(ge.total&4294967295)){Ze.msg="incorrect length check",ge.mode=Er;break}Je=0,ct=0}ge.mode=tn;case tn:Ct=S;break e;case Er:Ct=G;break e;case Ar:return W;case Mn:default:return N}return Ze.next_out=yt,Ze.avail_out=Te,Ze.next_in=$,Ze.avail_in=Et,ge.hold=Je,ge.bits=ct,(ge.wsize||ie!==Ze.avail_out&&ge.mode<Er&&(ge.mode<Lt||Mt!==f))&&ui(Ze,Ze.output,Ze.next_out,ie-Ze.avail_out),q-=Ze.avail_in,ie-=Ze.avail_out,Ze.total_in+=q,Ze.total_out+=ie,ge.total+=ie,ge.wrap&&ie&&(Ze.adler=ge.check=ge.flags?t(ge.check,wt,ie,Ze.next_out-ie):e(ge.check,wt,ie,Ze.next_out-ie)),Ze.data_type=ge.bits+(ge.last?64:0)+(ge.mode===ye?128:0)+(ge.mode===lt||ge.mode===Ne?256:0),(q===0&&ie===0||Mt===f)&&Ct===T&&(Ct=z),Ct}function Dt(Ze){if(!Ze||!Ze.state)return N;var Mt=Ze.state;return Mt.window&&(Mt.window=null),Ze.state=null,T}function Vt(Ze,Mt){var ge;return!Ze||!Ze.state||(ge=Ze.state,(ge.wrap&2)===0)?N:(ge.head=Mt,Mt.done=!1,T)}function sr(Ze,Mt){var ge=Mt.length,Nt,wt,$;return!Ze||!Ze.state||(Nt=Ze.state,Nt.wrap!==0&&Nt.mode!==ne)?N:Nt.mode===ne&&(wt=1,wt=e(wt,Mt,ge,0),wt!==Nt.check)?G:($=ui(Ze,Mt,ge,ge),$?(Nt.mode=Ar,W):(Nt.havedict=1,T))}return wa.inflateReset=Xn,wa.inflateReset2=Nn,wa.inflateResetKeep=un,wa.inflateInit=Wn,wa.inflateInit2=bn,wa.inflate=Pe,wa.inflateEnd=Dt,wa.inflateGetHeader=Vt,wa.inflateSetDictionary=sr,wa.inflateInfo="pako inflate (from Nodeca project)",wa}var V1,CF;function mN(){return CF||(CF=1,V1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),V1}var H1,EF;function M1e(){if(EF)return H1;EF=1;function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return H1=r,H1}var TF;function P1e(){if(TF)return Sd;TF=1;var r=I1e(),e=rf(),t=pN(),n=mN(),i=oE(),o=gN(),s=M1e(),c=Object.prototype.toString;function f(T){if(!(this instanceof f))return new f(T);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},T||{});var S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),S.windowBits>=0&&S.windowBits<16&&!(T&&T.windowBits)&&(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&(S.windowBits&15)===0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var D=r.inflateInit2(this.strm,S.windowBits);if(D!==n.Z_OK)throw new Error(i[D]);if(this.header=new s,r.inflateGetHeader(this.strm,this.header),S.dictionary&&(typeof S.dictionary=="string"?S.dictionary=t.string2buf(S.dictionary):c.call(S.dictionary)==="[object ArrayBuffer]"&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(D=r.inflateSetDictionary(this.strm,S.dictionary),D!==n.Z_OK)))throw new Error(i[D])}f.prototype.push=function(T,S){var D=this.strm,N=this.options.chunkSize,G=this.options.dictionary,W,z,j,K,fe,Z=!1;if(this.ended)return!1;z=S===~~S?S:S===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof T=="string"?D.input=t.binstring2buf(T):c.call(T)==="[object ArrayBuffer]"?D.input=new Uint8Array(T):D.input=T,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new e.Buf8(N),D.next_out=0,D.avail_out=N),W=r.inflate(D,n.Z_NO_FLUSH),W===n.Z_NEED_DICT&&G&&(W=r.inflateSetDictionary(this.strm,G)),W===n.Z_BUF_ERROR&&Z===!0&&(W=n.Z_OK,Z=!1),W!==n.Z_STREAM_END&&W!==n.Z_OK)return this.onEnd(W),this.ended=!0,!1;D.next_out&&(D.avail_out===0||W===n.Z_STREAM_END||D.avail_in===0&&(z===n.Z_FINISH||z===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(j=t.utf8border(D.output,D.next_out),K=D.next_out-j,fe=t.buf2string(D.output,j),D.next_out=K,D.avail_out=N-K,K&&e.arraySet(D.output,D.output,j,K,0),this.onData(fe)):this.onData(e.shrinkBuf(D.output,D.next_out))),D.avail_in===0&&D.avail_out===0&&(Z=!0)}while((D.avail_in>0||D.avail_out===0)&&W!==n.Z_STREAM_END);return W===n.Z_STREAM_END&&(z=n.Z_FINISH),z===n.Z_FINISH?(W=r.inflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===n.Z_OK):(z===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),D.avail_out=0),!0)},f.prototype.onData=function(T){this.chunks.push(T)},f.prototype.onEnd=function(T){T===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg};function _(T,S){var D=new f(S);if(D.push(T,!0),D.err)throw D.msg||i[D.err];return D.result}function b(T,S){return S=S||{},S.raw=!0,_(T,S)}return Sd.Inflate=f,Sd.inflate=_,Sd.inflateRaw=b,Sd.ungzip=_,Sd}var j1,BF;function R1e(){if(BF)return j1;BF=1;var r=rf().assign,e=T1e(),t=P1e(),n=mN(),i={};return r(i,e,t,n),j1=i,j1}var F1e=R1e();const Id=sh(F1e),SF=[0],O1e={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:hN,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class aE extends ys{initializeState(){"onTileLoadFail"in this.props&&$r.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:i}=this.state;for(const o in i)i[o].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=n==null?void 0:n[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const n=t&&t.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:t}){const{tile:n}=e.props,{id:i}=t;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[t==null?void 0:t.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,o={loadOptions:{...t}};let s=e;if(i.preload){const _=await i.preload(e,t);_.url&&(s=_.url),_.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:_.headers}),Object.assign(o,_)}const c=await OA(s,i,o.loadOptions),f=new x_e(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:f,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(f)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Nl.POINTCLOUD:return this._makePointCloudLayer(e,t);case Nl.SCENEGRAPH:return this._make3DModelLayer(e);case Nl.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:o,cartographicOrigin:s,modelMatrix:c}=e.content,{positions:f,normals:_,colors:b}=n;if(!f)return null;const T=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:f,NORMAL:_,COLOR_0:b}},{pointSize:S,getPointColor:D}=this.props,N=this.getSubLayerClass("pointcloud",Rg);return new N({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:T,coordinateSystem:Jr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:c,getColor:o||D,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:o}=e.content,s=this.getSubLayerClass("scenegraph",zg);return new s({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||SF,scenegraph:t,coordinateSystem:Jr.METER_OFFSETS,coordinateOrigin:i,modelMatrix:o,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:o,modelMatrix:s,cartographicOrigin:c,coordinateSystem:f=Jr.METER_OFFSETS,material:_,featureIds:b}=n,{_getMeshColor:T}=this.props,S=t&&t.props.mesh||new $s({topology:"triangle-list",attributes:D1e(i),indices:o}),D=this.getSubLayerClass("mesh",$C);return new D(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:S,data:SF,getColor:T(e),pbrMaterial:_,modelMatrix:s,coordinateOrigin:c,coordinateSystem:f,featureIds:b,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(n=>{const i=t[n.id]=t[n.id]||{tile:n};let{layer:o}=i;return n.selected&&(o?i.needsUpdate&&(o=this._getSubLayer(n,o),i.needsUpdate=!1):o=this._getSubLayer(n)),i.layer=o,o}).filter(Boolean):null}}aE.defaultProps=O1e;aE.layerName="Tile3DLayer";function D1e(r){const e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}const L1e="4.2.4",_N={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:L1e,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({..._N});const IF=[1],k1e={...Xl.defaultProps,elevationData:M_,texture:{...M_,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[_N]};function MF(r){return Array.isArray(r)?r.join(";"):r||""}class cE extends ys{updateState({props:e,oldProps:t}){const n=e.elevationData!==t.elevationData;if(n){const{elevationData:o}=e,s=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:s})}const i=n||e.meshMaxError!==t.meshMaxError||e.elevationDecoder!==t.elevationDecoder||e.bounds!==t.bounds;if(!this.state.isTiled&&i){const o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&$r.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:t,elevationDecoder:n,meshMaxError:i,signal:o}){if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?i*2:0,...s==null?void 0:s.terrain,bounds:t,meshMaxError:i,elevationDecoder:n}};const{fetch:c}=this.props;return c(e,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(e){const{elevationData:t,fetch:n,texture:i,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:c}=this.context,f=th(t,e),_=i&&th(i,e),{signal:b}=e;let T=[0,0],S=[0,0];if(c.isGeospatial){const W=e.bbox;T=c.projectFlat([W.west,W.south]),S=c.projectFlat([W.east,W.north])}else{const W=e.bbox;T=[W.left,W.bottom],S=[W.right,W.top]}const D=[T[0],T[1],S[0],S[1]],N=this.loadTerrain({elevationData:f,bounds:D,elevationDecoder:o,meshMaxError:s,signal:b}),G=_?n(_,{propName:"texture",layer:this,loaders:[],signal:b}).catch(W=>null):Promise.resolve(null);return Promise.all([N,G])}renderSubLayers(e){const t=this.getSubLayerClass("mesh",rh),{color:n,wireframe:i,material:o}=this.props,{data:s}=e;if(!s)return null;const[c,f]=s;return new t(e,{data:IF,mesh:c,texture:f,_instanced:!1,coordinateSystem:Jr.CARTESIAN,getPosition:_=>[0,0,0],getColor:n,wireframe:i,material:o})}onViewportLoad(e){if(!e)return;const{zRange:t}=this.state,n=e.map(s=>s.content).filter(Boolean).map(s=>s[0].header.boundingBox.map(f=>f[2]));if(n.length===0)return;const i=Math.min(...n.map(s=>s[0])),o=Math.max(...n.map(s=>s[1]));(!t||i<t[0]||o>t[1])&&this.setState({zRange:[i,o]})}renderLayers(){const{color:e,material:t,elevationData:n,texture:i,wireframe:o,meshMaxError:s,elevationDecoder:c,tileSize:f,maxZoom:_,minZoom:b,extent:T,maxRequests:S,onTileLoad:D,onTileUnload:N,onTileError:G,maxCacheSize:W,maxCacheByteSize:z,refinementStrategy:j}=this.props;if(this.state.isTiled)return new Xl(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:MF(n),texture:MF(i),meshMaxError:s,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:f,maxZoom:_,minZoom:b,extent:T,maxRequests:S,onTileLoad:D,onTileUnload:N,onTileError:G,maxCacheSize:W,maxCacheByteSize:z,refinementStrategy:j});if(!n)return null;const K=this.getSubLayerClass("mesh",rh);return new K(this.getSubLayerProps({id:"mesh"}),{data:IF,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:fe=>[0,0,0],getColor:e,material:t,wireframe:o})}}cE.defaultProps=k1e;cE.layerName="TerrainLayer";const N1e={clipBounds:[0,0,1,1],clipByInstance:void 0},yN=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,U1e={name:"clip",vs:yN,uniformTypes:{bounds:"vec4<f32>"}},z1e={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},G1e={name:"clip",fs:yN,uniformTypes:{bounds:"vec4<f32>"}},V1e={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class Xy extends gy{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[U1e],inject:z1e}:{modules:[G1e],inject:V1e}}draw(){const{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{const n=this.projectPosition([e[0],e[1],0]),i=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[0],i[0]),Math.max(n[1],i[1])]}this.setShaderModuleProps({clip:t})}}Xy.defaultProps=N1e;Xy.extensionName="ClipExtension";const H1e=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,j1e={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},$1e=r=>{if(!r||!("dummyCollisionMap"in r))return{};const{enabled:e,collisionFBO:t,drawToCollisionMap:n,dummyCollisionMap:i}=r;return{enabled:e&&!n,sort:!!n,collision_texture:!n&&t?t.colorAttachments[0]:i}},W1e={name:"collision",dependencies:[uy],vs:H1e,inject:j1e,getUniforms:$1e,uniformTypes:{sort:"i32",enabled:"i32"}};class J1e extends fy{renderCollisionMap(e,t){const i=[0,0,0,0],o=[1,1,e.width-2*1,e.height-2*1];this.render({...t,clearColor:i,scissorRect:o,target:e,pass:"collision"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}const $1=2;class X1e{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:t}=e;this.dummyCollisionMap=t.createTexture({width:1,height:1}),this.collisionFilterPass=new J1e(t,{id:"default-collision-filter"})}preRender({effects:e,layers:t,layerFilter:n,viewports:i,onViewportActive:o,views:s,isPicking:c,preRenderStats:f={}}){var W;const{device:_}=this.context;if(c)return;const b=t.filter(({props:{visible:z,collisionEnabled:j}})=>z&&j);if(b.length===0){this.channels={};return}const T=e==null?void 0:e.filter(z=>z.useInPicking&&f[z.id]),S=(W=f["mask-effect"])==null?void 0:W.didRender,D=this._groupByCollisionGroup(_,b),N=i[0],G=!this.lastViewport||!this.lastViewport.equals(N)||S;for(const z in D){const j=this.collisionFBOs[z],K=D[z],[fe,Z]=_.canvasContext.getPixelSize();j.resize({width:fe/$1,height:Z/$1}),this._render(K,{effects:T,layerFilter:n,onViewportActive:o,views:s,viewport:N,viewportChanged:G})}}_render(e,{effects:t,layerFilter:n,onViewportActive:i,views:o,viewport:s,viewportChanged:c}){const{collisionGroup:f}=e,_=this.channels[f];if(!_)return;const b=c||e===_||!Ki(_.layers,e.layers,1)||e.layerBounds.some((T,S)=>!aa(T,_.layerBounds[S]))||e.allLayersLoaded!==_.allLayersLoaded||e.layers.some(T=>T.props.transitions);if(this.channels[f]=e,b){this.lastViewport=s;const T=this.collisionFBOs[f];this.collisionFilterPass.renderCollisionMap(T,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:t,layerFilter:n,viewports:s?[s]:[],onViewportActive:i,views:o,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:T.device.canvasContext.getDevicePixelRatio()/$1}}})}}_groupByCollisionGroup(e,t){const n={};for(const i of t){const o=i.props.collisionGroup;let s=n[o];s||(s={collisionGroup:o,layers:[],layerBounds:[],allLayersLoaded:!0},n[o]=s),s.layers.push(i),s.layerBounds.push(i.getBounds()),i.isLoaded||(s.allLayersLoaded=!1)}for(const i of Object.keys(n))this.collisionFBOs[i]||this.createFBO(e,i),this.channels[i]||(this.channels[i]=n[i]);for(const i of Object.keys(this.collisionFBOs))n[i]||this.destroyFBO(i);return n}getShaderModuleProps(e){const{collisionGroup:t,collisionEnabled:n}=e.props,{collisionFBOs:i,dummyCollisionMap:o}=this,s=i[t];return{collision:{enabled:n&&!!s,collisionFBO:s,dummyCollisionMap:o}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,t){const{width:n,height:i}=e.gl.canvas,o=e.createTexture({format:"rgba8unorm",width:n,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:n,height:i,mipmaps:!1});this.collisionFBOs[t]=e.createFramebuffer({id:`collision-${t}`,width:n,height:i,colorAttachments:[o],depthStencilAttachment:s})}destroyFBO(e){var n,i;const t=this.collisionFBOs[e];(n=t.colorAttachments[0])==null||n.destroy(),(i=t.depthStencilAttachment)==null||i.destroy(),t.destroy(),delete this.collisionFBOs[e]}}const K1e={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class lE extends gy{getShaders(){return{modules:[W1e]}}draw({shaderModuleProps:e}){var t;(t=e.collision)!=null&&t.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,t){var i;if(this.getAttributeManager()===null)return;(i=this.context.deck)==null||i._addDefaultEffect(new X1e),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}})}getNeedsPickingBuffer(){return this.props.collisionEnabled}}lE.defaultProps=K1e;lE.extensionName="CollisionFilterExtension";function Wx(r,e){const t=e==null?void 0:e.globalFeatureId;return t!==void 0?Y1e(r,t):q1e(r,e==null?void 0:e.type)}function Y1e(r,e){const t=vN(r);for(const n of t){let i=0,o=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const c=n.featureIds.value[s];if(c!==o){if(e===n.globalFeatureIds.value[i])return U_(n,i,s);i=s,o=c}}if(e===n.globalFeatureIds.value[i])return U_(n,i,n.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function q1e(r,e){const t=vN(r);return Q1e(t)}function Z1e(r,e,t){switch(r.type){case"Point":return n2e(r,e,t);case"LineString":return r2e(r,e,t);case"Polygon":return bN(r,e,t);default:const n=r;throw new Error(`Unsupported geometry type: ${n==null?void 0:n.type}`)}}function vN(r,e){const t=[];return r.points&&(r.points.type="Point",t.push(r.points)),r.lines&&(r.lines.type="LineString",t.push(r.lines)),r.polygons&&(r.polygons.type="Polygon",t.push(r.polygons)),t}function Q1e(r){const e=[];for(const t of r){if(t.featureIds.value.length===0)continue;let n=0,i=t.featureIds.value[0];for(let o=0;o<t.featureIds.value.length;o++){const s=t.featureIds.value[o];s!==i&&(e.push(U_(t,n,o)),n=o,i=s)}e.push(U_(t,n,t.featureIds.value.length))}return e}function U_(r,e,t){const n=Z1e(r,e,t),i=t2e(r,e),o=e2e(r,e);return{type:"Feature",geometry:n,properties:i,...o}}function e2e(r,e=0,t){return r.fields&&r.fields[r.featureIds.value[e]]}function t2e(r,e=0,t){const n=Object.assign({},r.properties[r.featureIds.value[e]]);for(const i in r.numericProps)n[i]=r.numericProps[i].value[e];return n}function bN(r,e=-1/0,t=1/0){const{positions:n}=r,i=r.polygonIndices.value.filter(f=>f>=e&&f<=t),o=r.primitivePolygonIndices.value.filter(f=>f>=e&&f<=t);if(!(i.length>2)){const f=[];for(let _=0;_<o.length-1;_++){const b=o[_],T=o[_+1],S=z_(n,b,T);f.push(S)}return{type:"Polygon",coordinates:f}}const c=[];for(let f=0;f<i.length-1;f++){const _=i[f],b=i[f+1],T=bN(r,_,b).coordinates;c.push(T)}return{type:"MultiPolygon",coordinates:c}}function r2e(r,e=-1/0,t=1/0){const{positions:n}=r,i=r.pathIndices.value.filter(c=>c>=e&&c<=t);if(!(i.length>2))return{type:"LineString",coordinates:z_(n,i[0],i[1])};const s=[];for(let c=0;c<i.length-1;c++){const f=z_(n,i[c],i[c+1]);s.push(f)}return{type:"MultiLineString",coordinates:s}}function n2e(r,e,t){const{positions:n}=r,i=z_(n,e,t);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function z_(r,e,t){e=e||0,t=t||r.value.length/r.size;const n=[];for(let i=e;i<t;i++){const o=Array();for(let s=i*r.size;s<(i+1)*r.size;s++)o.push(Number(r.value[s]));n.push(o)}return n}var Am={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var PF;function i2e(){return PF||(PF=1,Am.read=function(r,e,t,n,i){var o,s,c=i*8-n-1,f=(1<<c)-1,_=f>>1,b=-7,T=t?i-1:0,S=t?-1:1,D=r[e+T];for(T+=S,o=D&(1<<-b)-1,D>>=-b,b+=c;b>0;o=o*256+r[e+T],T+=S,b-=8);for(s=o&(1<<-b)-1,o>>=-b,b+=n;b>0;s=s*256+r[e+T],T+=S,b-=8);if(o===0)o=1-_;else{if(o===f)return s?NaN:(D?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-_}return(D?-1:1)*s*Math.pow(2,o-n)},Am.write=function(r,e,t,n,i,o){var s,c,f,_=o*8-i-1,b=(1<<_)-1,T=b>>1,S=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=n?0:o-1,N=n?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,s=b):(s=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-s))<1&&(s--,f*=2),s+T>=1?e+=S/f:e+=S*Math.pow(2,1-T),e*f>=2&&(s++,f/=2),s+T>=b?(c=0,s=b):s+T>=1?(c=(e*f-1)*Math.pow(2,i),s=s+T):(c=e*Math.pow(2,T-1)*Math.pow(2,i),s=0));i>=8;r[t+D]=c&255,D+=N,c/=256,i-=8);for(s=s<<i|c,_+=i;_>0;r[t+D]=s&255,D+=N,s/=256,_-=8);r[t+D-N]|=G*128}),Am}var W1,RF;function s2e(){if(RF)return W1;RF=1,W1=e;var r=i2e();function e(J){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(J)?J:new Uint8Array(J||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var t=65536*65536,n=1/t,i=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");e.prototype={destroy:function(){this.buf=null},readFields:function(J,ne,ye){for(ye=ye||this.length;this.pos<ye;){var Ye=this.readVarint(),we=Ye>>3,Ne=this.pos;this.type=Ye&7,J(we,ne,this),this.pos===Ne&&this.skip(Ye)}return ne},readMessage:function(J,ne){return this.readFields(J,ne,this.readVarint()+this.pos)},readFixed32:function(){var J=ae(this.buf,this.pos);return this.pos+=4,J},readSFixed32:function(){var J=Le(this.buf,this.pos);return this.pos+=4,J},readFixed64:function(){var J=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*t;return this.pos+=8,J},readSFixed64:function(){var J=ae(this.buf,this.pos)+Le(this.buf,this.pos+4)*t;return this.pos+=8,J},readFloat:function(){var J=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,J},readDouble:function(){var J=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,J},readVarint:function(J){var ne=this.buf,ye,Ye;return Ye=ne[this.pos++],ye=Ye&127,Ye<128||(Ye=ne[this.pos++],ye|=(Ye&127)<<7,Ye<128)||(Ye=ne[this.pos++],ye|=(Ye&127)<<14,Ye<128)||(Ye=ne[this.pos++],ye|=(Ye&127)<<21,Ye<128)?ye:(Ye=ne[this.pos],ye|=(Ye&15)<<28,s(ye,J,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var J=this.readVarint();return J%2===1?(J+1)/-2:J/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var J=this.readVarint()+this.pos,ne=this.pos;return this.pos=J,J-ne>=i&&o?_e(this.buf,ne,J):de(this.buf,ne,J)},readBytes:function(){var J=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,J);return this.pos=J,ne},readPackedVarint:function(J,ne){if(this.type!==e.Bytes)return J.push(this.readVarint(ne));var ye=c(this);for(J=J||[];this.pos<ye;)J.push(this.readVarint(ne));return J},readPackedSVarint:function(J){if(this.type!==e.Bytes)return J.push(this.readSVarint());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readSVarint());return J},readPackedBoolean:function(J){if(this.type!==e.Bytes)return J.push(this.readBoolean());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readBoolean());return J},readPackedFloat:function(J){if(this.type!==e.Bytes)return J.push(this.readFloat());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readFloat());return J},readPackedDouble:function(J){if(this.type!==e.Bytes)return J.push(this.readDouble());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readDouble());return J},readPackedFixed32:function(J){if(this.type!==e.Bytes)return J.push(this.readFixed32());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readFixed32());return J},readPackedSFixed32:function(J){if(this.type!==e.Bytes)return J.push(this.readSFixed32());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readSFixed32());return J},readPackedFixed64:function(J){if(this.type!==e.Bytes)return J.push(this.readFixed64());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readFixed64());return J},readPackedSFixed64:function(J){if(this.type!==e.Bytes)return J.push(this.readSFixed64());var ne=c(this);for(J=J||[];this.pos<ne;)J.push(this.readSFixed64());return J},skip:function(J){var ne=J&7;if(ne===e.Varint)for(;this.buf[this.pos++]>127;);else if(ne===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===e.Fixed32)this.pos+=4;else if(ne===e.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+ne)},writeTag:function(J,ne){this.writeVarint(J<<3|ne)},realloc:function(J){for(var ne=this.length||16;ne<this.pos+J;)ne*=2;if(ne!==this.length){var ye=new Uint8Array(ne);ye.set(this.buf),this.buf=ye,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(J){this.realloc(4),Be(this.buf,J,this.pos),this.pos+=4},writeSFixed32:function(J){this.realloc(4),Be(this.buf,J,this.pos),this.pos+=4},writeFixed64:function(J){this.realloc(8),Be(this.buf,J&-1,this.pos),Be(this.buf,Math.floor(J*n),this.pos+4),this.pos+=8},writeSFixed64:function(J){this.realloc(8),Be(this.buf,J&-1,this.pos),Be(this.buf,Math.floor(J*n),this.pos+4),this.pos+=8},writeVarint:function(J){if(J=+J||0,J>268435455||J<0){_(J,this);return}this.realloc(4),this.buf[this.pos++]=J&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=J>>>7&127)))},writeSVarint:function(J){this.writeVarint(J<0?-J*2-1:J*2)},writeBoolean:function(J){this.writeVarint(!!J)},writeString:function(J){J=String(J),this.realloc(J.length*4),this.pos++;var ne=this.pos;this.pos=pe(this.buf,J,this.pos);var ye=this.pos-ne;ye>=128&&S(ne,ye,this),this.pos=ne-1,this.writeVarint(ye),this.pos+=ye},writeFloat:function(J){this.realloc(4),r.write(this.buf,J,this.pos,!0,23,4),this.pos+=4},writeDouble:function(J){this.realloc(8),r.write(this.buf,J,this.pos,!0,52,8),this.pos+=8},writeBytes:function(J){var ne=J.length;this.writeVarint(ne),this.realloc(ne);for(var ye=0;ye<ne;ye++)this.buf[this.pos++]=J[ye]},writeRawMessage:function(J,ne){this.pos++;var ye=this.pos;J(ne,this);var Ye=this.pos-ye;Ye>=128&&S(ye,Ye,this),this.pos=ye-1,this.writeVarint(Ye),this.pos+=Ye},writeMessage:function(J,ne,ye){this.writeTag(J,e.Bytes),this.writeRawMessage(ne,ye)},writePackedVarint:function(J,ne){ne.length&&this.writeMessage(J,D,ne)},writePackedSVarint:function(J,ne){ne.length&&this.writeMessage(J,N,ne)},writePackedBoolean:function(J,ne){ne.length&&this.writeMessage(J,z,ne)},writePackedFloat:function(J,ne){ne.length&&this.writeMessage(J,G,ne)},writePackedDouble:function(J,ne){ne.length&&this.writeMessage(J,W,ne)},writePackedFixed32:function(J,ne){ne.length&&this.writeMessage(J,j,ne)},writePackedSFixed32:function(J,ne){ne.length&&this.writeMessage(J,K,ne)},writePackedFixed64:function(J,ne){ne.length&&this.writeMessage(J,fe,ne)},writePackedSFixed64:function(J,ne){ne.length&&this.writeMessage(J,Z,ne)},writeBytesField:function(J,ne){this.writeTag(J,e.Bytes),this.writeBytes(ne)},writeFixed32Field:function(J,ne){this.writeTag(J,e.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(J,ne){this.writeTag(J,e.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(J,ne){this.writeTag(J,e.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(J,ne){this.writeTag(J,e.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(J,ne){this.writeTag(J,e.Varint),this.writeVarint(ne)},writeSVarintField:function(J,ne){this.writeTag(J,e.Varint),this.writeSVarint(ne)},writeStringField:function(J,ne){this.writeTag(J,e.Bytes),this.writeString(ne)},writeFloatField:function(J,ne){this.writeTag(J,e.Fixed32),this.writeFloat(ne)},writeDoubleField:function(J,ne){this.writeTag(J,e.Fixed64),this.writeDouble(ne)},writeBooleanField:function(J,ne){this.writeVarintField(J,!!ne)}};function s(J,ne,ye){var Ye=ye.buf,we,Ne;if(Ne=Ye[ye.pos++],we=(Ne&112)>>4,Ne<128||(Ne=Ye[ye.pos++],we|=(Ne&127)<<3,Ne<128)||(Ne=Ye[ye.pos++],we|=(Ne&127)<<10,Ne<128)||(Ne=Ye[ye.pos++],we|=(Ne&127)<<17,Ne<128)||(Ne=Ye[ye.pos++],we|=(Ne&127)<<24,Ne<128)||(Ne=Ye[ye.pos++],we|=(Ne&1)<<31,Ne<128))return f(J,we,ne);throw new Error("Expected varint not more than 10 bytes")}function c(J){return J.type===e.Bytes?J.readVarint()+J.pos:J.pos+1}function f(J,ne,ye){return ye?ne*4294967296+(J>>>0):(ne>>>0)*4294967296+(J>>>0)}function _(J,ne){var ye,Ye;if(J>=0?(ye=J%4294967296|0,Ye=J/4294967296|0):(ye=~(-J%4294967296),Ye=~(-J/4294967296),ye^4294967295?ye=ye+1|0:(ye=0,Ye=Ye+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ne.realloc(10),b(ye,Ye,ne),T(Ye,ne)}function b(J,ne,ye){ye.buf[ye.pos++]=J&127|128,J>>>=7,ye.buf[ye.pos++]=J&127|128,J>>>=7,ye.buf[ye.pos++]=J&127|128,J>>>=7,ye.buf[ye.pos++]=J&127|128,J>>>=7,ye.buf[ye.pos]=J&127}function T(J,ne){var ye=(J&7)<<4;ne.buf[ne.pos++]|=ye|((J>>>=3)?128:0),J&&(ne.buf[ne.pos++]=J&127|((J>>>=7)?128:0),J&&(ne.buf[ne.pos++]=J&127|((J>>>=7)?128:0),J&&(ne.buf[ne.pos++]=J&127|((J>>>=7)?128:0),J&&(ne.buf[ne.pos++]=J&127|((J>>>=7)?128:0),J&&(ne.buf[ne.pos++]=J&127)))))}function S(J,ne,ye){var Ye=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(Math.LN2*7));ye.realloc(Ye);for(var we=ye.pos-1;we>=J;we--)ye.buf[we+Ye]=ye.buf[we]}function D(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeVarint(J[ye])}function N(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeSVarint(J[ye])}function G(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeFloat(J[ye])}function W(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeDouble(J[ye])}function z(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeBoolean(J[ye])}function j(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeFixed32(J[ye])}function K(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeSFixed32(J[ye])}function fe(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeFixed64(J[ye])}function Z(J,ne){for(var ye=0;ye<J.length;ye++)ne.writeSFixed64(J[ye])}function ae(J,ne){return(J[ne]|J[ne+1]<<8|J[ne+2]<<16)+J[ne+3]*16777216}function Be(J,ne,ye){J[ye]=ne,J[ye+1]=ne>>>8,J[ye+2]=ne>>>16,J[ye+3]=ne>>>24}function Le(J,ne){return(J[ne]|J[ne+1]<<8|J[ne+2]<<16)+(J[ne+3]<<24)}function de(J,ne,ye){for(var Ye="",we=ne;we<ye;){var Ne=J[we],Ge=null,Qe=Ne>239?4:Ne>223?3:Ne>191?2:1;if(we+Qe>ye)break;var rt,tt,lt;Qe===1?Ne<128&&(Ge=Ne):Qe===2?(rt=J[we+1],(rt&192)===128&&(Ge=(Ne&31)<<6|rt&63,Ge<=127&&(Ge=null))):Qe===3?(rt=J[we+1],tt=J[we+2],(rt&192)===128&&(tt&192)===128&&(Ge=(Ne&15)<<12|(rt&63)<<6|tt&63,(Ge<=2047||Ge>=55296&&Ge<=57343)&&(Ge=null))):Qe===4&&(rt=J[we+1],tt=J[we+2],lt=J[we+3],(rt&192)===128&&(tt&192)===128&&(lt&192)===128&&(Ge=(Ne&15)<<18|(rt&63)<<12|(tt&63)<<6|lt&63,(Ge<=65535||Ge>=1114112)&&(Ge=null))),Ge===null?(Ge=65533,Qe=1):Ge>65535&&(Ge-=65536,Ye+=String.fromCharCode(Ge>>>10&1023|55296),Ge=56320|Ge&1023),Ye+=String.fromCharCode(Ge),we+=Qe}return Ye}function _e(J,ne,ye){return o.decode(J.subarray(ne,ye))}function pe(J,ne,ye){for(var Ye=0,we,Ne;Ye<ne.length;Ye++){if(we=ne.charCodeAt(Ye),we>55295&&we<57344)if(Ne)if(we<56320){J[ye++]=239,J[ye++]=191,J[ye++]=189,Ne=we;continue}else we=Ne-55296<<10|we-56320|65536,Ne=null;else{we>56319||Ye+1===ne.length?(J[ye++]=239,J[ye++]=191,J[ye++]=189):Ne=we;continue}else Ne&&(J[ye++]=239,J[ye++]=191,J[ye++]=189,Ne=null);we<128?J[ye++]=we:(we<2048?J[ye++]=we>>6|192:(we<65536?J[ye++]=we>>12|224:(J[ye++]=we>>18|240,J[ye++]=we>>12&63|128),J[ye++]=we>>6&63|128),J[ye++]=we&63|128)}return ye}return W1}var o2e=s2e();const a2e=sh(o2e),c2e="4.2.4",xN={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:c2e,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}};({...xN});const l2e={Point:wN,MultiPoint:u2e,LineString:CN,MultiLineString:f2e,Polygon:EN,MultiPolygon:h2e};function wN([r,e],[t,n],i){const o=dc(t[0],n[0],r),s=dc(t[1],n[1],e);return i.unprojectFlat([o,s])}function uE(r,e,t){return r.map(n=>wN(n,e,t))}function u2e(r,e,t){return uE(r,e,t)}function CN(r,e,t){return uE(r,e,t)}function f2e(r,e,t){return r.map(n=>CN(n,e,t))}function EN(r,e,t){return r.map(n=>uE(n,e,t))}function h2e(r,e,t){return r.map(n=>EN(n,e,t))}function d2e(r,e,t){const n=t.projectFlat([e.west,e.north]),i=t.projectFlat([e.east,e.south]),o=[n,i];return{...r,coordinates:l2e[r.type](r.coordinates,o,t)}}const A2e=["points","lines","polygons"];function p2e(r,e,t,n){for(const i of A2e){const o=r[i]&&g2e(r[i],e,t,n);if(o>=0)return o}return-1}function g2e(r,e,t,n){const i=r.featureIds.value;if(!i.length)return-1;let o=0,s=i[i.length-1]+1;if(n){const f=m2e(r,n);if(f)o=f[0],s=f[1]+1;else return-1}let c=-1;if(e in r.numericProps){const f=r.numericProps[e].value.findIndex((_,b)=>_===t&&i[b]>=o&&i[b]<s);return f>=0?r.globalFeatureIds.value[f]:-1}else e?c=FF(r.properties,f=>f[e]===t,o,s):r.fields&&(c=FF(r.fields,f=>f.id===t,o,s));return c>=0?_2e(r,c):-1}function m2e(r,e){if(!r.__layers){const t={},{properties:n}=r;for(let i=0;i<n.length;i++){const{layerName:o}=n[i];o&&(t[o]?t[o][1]=i:t[o]=[i,i])}r.__layers=t}return r.__layers[e]}function _2e(r,e){if(!r.__ids){const t=[],n=r.featureIds.value,i=r.globalFeatureIds.value;for(let o=0;o<n.length;o++)t[n[o]]=i[o];r.__ids=t}return r.__ids[e]}function FF(r,e,t,n){for(let i=t;i<n;i++)if(e(r[i],i))return i;return-1}const J1=512,y2e={...Wl.defaultProps,data:M_,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[xN],binary:!0};class LA extends Xl{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:n,changeFlags:i}){var s;i.dataChanged&&this._updateTileData(),(s=this.state)!=null&&s.data&&(super.updateState({props:e,oldProps:t,context:n,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==t.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!Cde(e)){const{onDataLoad:n,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{t=await i(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}n&&n(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:n,maxZoom:i}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>n&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(i)||t.maxzoom<i)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:t,binary:n}=this.state,{index:i,signal:o}=e,s=th(t,e);if(!s)return Promise.reject("Invalid URL");let c=this.getLoadOptions();const{fetch:f}=this.props;return c={...c,mimeType:"application/x-protobuf",mvt:{...c==null?void 0:c.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:i},gis:n?{format:"binary"}:{}},f(s,{propName:"data",layer:this,loadOptions:c,signal:o})}renderSubLayers(e){const{x:t,y:n,z:i}=e.tile.index,o=Math.pow(2,i),s=J1/o,c=-s,f=J1*t/o,_=J1*(1-n/o),b=new dn().scale([s,c,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=b,e.coordinateOrigin=[f,_,0],e.coordinateSystem=Jr.CARTESIAN,e.extensions=[...e.extensions||[],new Xy]);const T=super.renderSubLayers(e);return this.state.binary&&!(T instanceof Wl)&&$r.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),T}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:i}=this.state,o=e.object;let s=null,c=null;o&&(s=X1(o,t),c=OF(o));let{highlightColor:f}=this.props;typeof f=="function"&&(f=f(e)),(n!==s||i!==c)&&this.setState({highlightColor:f,hoveredFeatureId:s,hoveredFeatureLayerName:c})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:n}=e.sourceLayer.props;t.object=Wx(n,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=LF(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:n,binary:i}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,c=e.content,f=DF(s);if(!(DF(t)||f))return-1;const b=f?s:t;return Array.isArray(c)?c.findIndex(T=>{const S=X1(T,o)===b,D=f||OF(T)===n;return S&&D}):c&&i?p2e(c,o,b,f?"":n):-1}_pickObjects(e){const{deck:t,viewport:n}=this.context,i=n.width,o=n.height,s=n.x,c=n.y,f=[this.id];return t.pickObjects({x:s,y:c,width:i,height:o,layerIds:f,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),n=new Set,i=[];for(const o of t){const s=X1(o.object,this.props.uniqueIdProperty);s===void 0?i.push(o.object):n.has(s)||(n.add(s),i.push(o.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(n=>{n.hasOwnProperty(e)||Object.defineProperty(n,e,{get:()=>{if(!n.content)return null;if(this.state.binary&&Array.isArray(n.content)&&!n.content.length)return[];const{bbox:i}=n;if(n._contentWGS84===void 0&&Ede(i)){const o=this.state.binary?Wx(n.content):n.content;n._contentWGS84=o.map(s=>LF(s,i,this.context.viewport))}return n._contentWGS84}})})}}LA.layerName="MVTLayer";LA.defaultProps=y2e;function X1(r,e){if(r.properties&&e)return r.properties[e];if("id"in r)return r.id}function OF(r){var e;return((e=r.properties)==null?void 0:e.layerName)||null}function DF(r){return r!=null&&r!==""}function LF(r,e,t){const n={...r,geometry:{type:r.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>d2e(r.geometry,e,t).coordinates}),n}const kF="0123456789bcdefghjkmnpqrstuvwxyz",TN={};for(let r=0;r<kF.length;r++)TN[kF.charAt(r)]=r;const v2e=-90,b2e=90,x2e=-180,w2e=180;function C2e(r){let e=!0,t=b2e,n=v2e,i=w2e,o=x2e,s,c=0;for(let f=0,_=r.length;f<_;f++){const b=r[f].toLowerCase();c=TN[b];for(let T=4;T>=0;T--){const S=c>>T&1;e?(s=(i+o)/2,S===1?o=s:i=s):(s=(t+n)/2,S===1?n=s:t=s),e=!e}}return[n,o,t,i]}function E2e(r){const[e,t,n,i]=C2e(r);return[i,n,i,e,t,e,t,n,i,n]}const T2e={getGeohash:{type:"accessor",value:r=>r.geohash}};class Ky extends tf{indexToBounds(){const{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>E2e(t(n,i))}}}Ky.layerName="GeohashLayer";Ky.defaultProps=T2e;const B2e=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:Ky,GreatCircleLayer:xC,H3ClusterLayer:Ny,H3HexagonLayer:al,MVTLayer:LA,QuadkeyLayer:Ry,S2Layer:Py,TerrainLayer:cE,Tile3DLayer:aE,TileLayer:Xl,TripsLayer:Dy,_GeoCellLayer:tf,_Tile2DHeader:Rk,_Tileset2D:Oy,_WMSLayer:bC,_getURLFromTemplate:th},Symbol.toStringTag,{value:"Module"}));var Ip={},K1,NF;function S2e(){if(NF)return K1;NF=1;var r=Math.PI/180,e=180/Math.PI;function t(j){var K=i(j[0]+1,j[2]),fe=i(j[0],j[2]),Z=o(j[1]+1,j[2]),ae=o(j[1],j[2]);return[fe,Z,K,ae]}function n(j){var K=t(j),fe={type:"Polygon",coordinates:[[[K[0],K[1]],[K[0],K[3]],[K[2],K[3]],[K[2],K[1]],[K[0],K[1]]]]};return fe}function i(j,K){return j/Math.pow(2,K)*360-180}function o(j,K){var fe=Math.PI-2*Math.PI*j/Math.pow(2,K);return e*Math.atan(.5*(Math.exp(fe)-Math.exp(-fe)))}function s(j,K,fe){var Z=z(j,K,fe);return Z[0]=Math.floor(Z[0]),Z[1]=Math.floor(Z[1]),Z}function c(j){return[[j[0]*2,j[1]*2,j[2]+1],[j[0]*2+1,j[1]*2,j[2]+1],[j[0]*2+1,j[1]*2+1,j[2]+1],[j[0]*2,j[1]*2+1,j[2]+1]]}function f(j){return j[0]%2===0&&j[1]%2===0?[j[0]/2,j[1]/2,j[2]-1]:j[0]%2===0&&!j[1]%2===0?[j[0]/2,(j[1]-1)/2,j[2]-1]:!j[0]%2===0&&j[1]%2===0?[(j[0]-1)/2,j[1]/2,j[2]-1]:[(j[0]-1)/2,(j[1]-1)/2,j[2]-1]}function _(j){return c(f(j))}function b(j,K){for(var fe=_(j),Z=0;Z<fe.length;Z++)if(!T(K,fe[Z]))return!1;return!0}function T(j,K){for(var fe=0;fe<j.length;fe++)if(S(j[fe],K))return!0;return!1}function S(j,K){return j[0]===K[0]&&j[1]===K[1]&&j[2]===K[2]}function D(j){for(var K="",fe=j[2];fe>0;fe--){var Z=0,ae=1<<fe-1;(j[0]&ae)!==0&&Z++,(j[1]&ae)!==0&&(Z+=2),K+=Z.toString()}return K}function N(j){for(var K=0,fe=0,Z=j.length,ae=Z;ae>0;ae--){var Be=1<<ae-1;switch(j[Z-ae]){case"0":break;case"1":K|=Be;break;case"2":fe|=Be;break;case"3":K|=Be,fe|=Be;break}}return[K,fe,Z]}function G(j){var K=s(j[0],j[1],32),fe=s(j[2],j[3],32),Z=[K[0],K[1],fe[0],fe[1]],ae=W(Z);if(ae===0)return[0,0,0];var Be=Z[0]>>>32-ae,Le=Z[1]>>>32-ae;return[Be,Le,ae]}function W(j){for(var K=28,fe=0;fe<K;fe++){var Z=1<<32-(fe+1);if((j[0]&Z)!=(j[2]&Z)||(j[1]&Z)!=(j[3]&Z))return fe}return K}function z(j,K,fe){var Z=Math.sin(K*r),ae=Math.pow(2,fe),Be=ae*(j/360+.5),Le=ae*(.5-.25*Math.log((1+Z)/(1-Z))/Math.PI);return[Be,Le,fe]}return K1={tileToGeoJSON:n,tileToBBOX:t,getChildren:c,getParent:f,getSiblings:_,hasTile:T,hasSiblings:b,tilesEqual:S,tileToQuadkey:D,quadkeyToTile:N,pointToTile:s,bboxToTile:G,pointToTileFraction:z},K1}var UF;function I2e(){if(UF)return Ip;UF=1;var r=S2e();Ip.geojson=function(b,T){return{type:"FeatureCollection",features:t(b,T).map(e)}};function e(b){return{type:"Feature",geometry:r.tileToGeoJSON(b),properties:{}}}Ip.tiles=t,Ip.indexes=function(b,T){return t(b,T).map(r.tileToQuadkey)};function t(b,T){var S,D,N=b.coordinates,G=T.max_zoom,W={},z=[];if(b.type==="Point")return[r.pointToTile(N[0],N[1],G)];if(b.type==="MultiPoint")for(S=0;S<N.length;S++)D=r.pointToTile(N[S][0],N[S][1],G),W[f(D[0],D[1],D[2])]=!0;else if(b.type==="LineString")s(W,N,G);else if(b.type==="MultiLineString")for(S=0;S<N.length;S++)s(W,N[S],G);else if(b.type==="Polygon")i(W,z,N,G);else if(b.type==="MultiPolygon")for(S=0;S<N.length;S++)i(W,z,N[S],G);else throw new Error("Geometry type not implemented");if(T.min_zoom!==G){var j=z.length;for(c(W,z),S=0;S<j;S++){var K=z[S];W[f(K[0],K[1],K[2])]=!0}return n(W,z,T)}return c(W,z),z}function n(b,T,S){for(var D=[],N=S.max_zoom;N>S.min_zoom;N--){for(var G={},W=[],z=0;z<T.length;z++){var j=T[z];if(j[0]%2===0&&j[1]%2===0){var K=f(j[0]+1,j[1],N),fe=f(j[0],j[1]+1,N),Z=f(j[0]+1,j[1]+1,N);if(b[K]&&b[fe]&&b[Z]){b[f(j[0],j[1],j[2])]=!1,b[K]=!1,b[fe]=!1,b[Z]=!1;var ae=[j[0]/2,j[1]/2,N-1];N-1===S.min_zoom?D.push(ae):(G[f(j[0]/2,j[1]/2,N-1)]=!0,W.push(ae))}}}for(z=0;z<T.length;z++)j=T[z],b[f(j[0],j[1],j[2])]&&D.push(j);b=G,T=W}return D}function i(b,T,S,D){for(var N=[],G=0;G<S.length;G++){var W=[];s(b,S[G],D,W);for(var z=0,j=W.length,K=j-1;z<j;K=z++){var fe=(z+1)%j,Z=W[z][1];(Z>W[K][1]||Z>W[fe][1])&&(Z<W[K][1]||Z<W[fe][1])&&Z!==W[fe][1]&&N.push(W[z])}}for(N.sort(o),G=0;G<N.length;G+=2){Z=N[G][1];for(var ae=N[G][0]+1;ae<N[G+1][0];ae++){var Be=f(ae,Z,D);b[Be]||T.push([ae,Z,D])}}}function o(b,T){return b[1]-T[1]||b[0]-T[0]}function s(b,T,S,D){for(var N,G,W=0;W<T.length-1;W++){var z=r.pointToTileFraction(T[W][0],T[W][1],S),j=r.pointToTileFraction(T[W+1][0],T[W+1][1],S),K=z[0],fe=z[1],Z=j[0],ae=j[1],Be=Z-K,Le=ae-fe;if(!(Le===0&&Be===0)){var de=Be>0?1:-1,_e=Le>0?1:-1,pe=Math.floor(K),J=Math.floor(fe),ne=Be===0?1/0:Math.abs(((Be>0?1:0)+pe-K)/Be),ye=Le===0?1/0:Math.abs(((Le>0?1:0)+J-fe)/Le),Ye=Math.abs(de/Be),we=Math.abs(_e/Le);for((pe!==N||J!==G)&&(b[f(pe,J,S)]=!0,D&&J!==G&&D.push([pe,J]),N=pe,G=J);ne<1||ye<1;)ne<ye?(ne+=Ye,pe+=de):(ye+=we,J+=_e),b[f(pe,J,S)]=!0,D&&J!==G&&D.push([pe,J]),N=pe,G=J}}D&&J===D[0][1]&&D.pop()}function c(b,T){for(var S=Object.keys(b),D=0;D<S.length;D++)T.push(_(+S[D]))}function f(b,T,S){var D=2*(1<<S);return(D*T+b)*32+S}function _(b){var T=b%32,S=2*(1<<T),D=(b-T)/32,N=D%S,G=(D-N)/S%S;return[N,G,T]}return Ip}I2e();const BN=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],SN=[0n,1n,2n,4n,8n,16n];function M2e(r){return BigInt(`0x${r}`)}function Jx(r){return r.toString(16)}function P2e(r){if(r.z<0||r.z>26)throw new Error("Wrong zoom");const e=BigInt(r.z);let t=BigInt(r.x)<<32n-e,n=BigInt(r.y)<<32n-e;for(let o=0;o<5;o++){const s=SN[5-o],c=BN[4-o];t=(t|t<<s)&c,n=(n|n<<s)&c}return 0x4000000000000000n|1n<<59n|e<<52n|(t|n<<1n)>>12n|0xfffffffffffffn>>e*2n}function IN(r){const e=r>>59n&7n,t=r>>57n&3n,n=r>>52n&0x1fn,i=(r&0xfffffffffffffn)<<12n;if(e!==1n&&t!==0n)throw new Error("Wrong mode");let o=i,s=i>>1n;for(let c=0;c<6;c++){const f=SN[c],_=BN[c];o=(o|o>>f)&_,s=(s|s>>f)&_}return o=o>>32n-n,s=s>>32n-n,{z:Number(n),x:Number(o),y:Number(s)}}function fE(r){return r>>52n&0x1fn}function MN(r){const e=fE(r)-1n;return r&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>e*2n}function nh(r,e){$r.assert(r,e)}function R2e(r,e){const{properties:t,numericProps:n}=r;return new Proxy(t[e]||{},{get(i,o){return o in n?n[o].value[e]:i[o]},has(i,o){return o in n||o in i},ownKeys(i){return[...Object.keys(n),...Reflect.ownKeys(i)]},getOwnPropertyDescriptor(i,o){return{enumerable:!0,configurable:!0}}})}function Yy(r,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${r}-worker.js`}const tg=new Uint16Array,Y1={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:tg,size:1},globalFeatureIds:{value:tg,size:1}};function PN(){return{shape:"binary-feature-collection",points:{type:"Point",...Y1},lines:{type:"LineString",pathIndices:{value:tg,size:1},...Y1},polygons:{type:"Polygon",polygonIndices:{value:tg,size:1},primitivePolygonIndices:{value:tg,size:1},...Y1}}}function hE(r,e,t,n,i,o=2){return{type:"Point",positions:{value:new Float32Array(r),size:o},featureIds:{value:new Uint16Array(e),size:1},globalFeatureIds:{value:new Uint32Array(t),size:1},numericProps:n,properties:i}}function RN(r,e){const t={};return e&&Object.keys(e).forEach(n=>{t[n]={value:new Float32Array(r),size:1}}),t}function FN(r,e,t,n){Object.keys(r).forEach(i=>{e[i].value[n]=r[i].value[t]})}function F2e(r,e,t,n=[],i,o){var f;if(!r.content)return!1;r.userData||(r.userData={});const s=(f=e.get(t))==null?void 0:f[0];if(s){if(n.every(_=>_.name in s))return!1;e.clear()}const c={};for(const _ of r.content){let b=_.id;const T=typeof i=="function"?i(_,{}):i;for(let W=0;W<t-1;W++)b=MN(b);const S=Number(b);if(!(S in c)){c[S]={id:b,count:0,position:[0,0]};for(const{name:W,aggregation:z}of n)z==="any"?c[S][W]=_.properties[W]:c[S][W]=0}const D=c[S].count;c[S].count+=typeof o=="function"?o(_,{}):o;const N=c[S].count,G=N-D;c[S].position[0]=(D*c[S].position[0]+G*T[0])/N,c[S].position[1]=(D*c[S].position[1]+G*T[1])/N;for(const{name:W,aggregation:z}of n){const j=c[S][W],K=_.properties[W];z==="average"?c[S][W]=(D*j+G*K)/N:z==="count"||z==="sum"?c[S][W]=j+K:z==="max"?c[S][W]=Math.max(j,K):z==="min"&&(c[S][W]=Math.min(j,K))}}return e.set(t,Object.values(c)),!0}function O2e(r){const e=[],t=["any","average","count","min","max","sum"];for(const n of Object.keys(r.content[0].properties)){let i=n.split("_").pop().toLowerCase();t.includes(i)||($r.warn(`No valid aggregation present in ${n} property`)(),i="any"),e.push({name:n,aggregation:i})}return e}function D2e(r,e){const t={};for(const{name:n,aggregation:i}of e)if(t[n]={min:1/0,max:-1/0},i!=="any")for(const o of r)t[n].min=Math.min(t[n].min,o[n]),t[n].max=Math.max(t[n].max,o[n]);return t}function L2e(r){const e=new Float32Array(r.length*2),t=new Uint16Array(r.length);for(let n=0;n<r.length;n++)e.set(r[n].position,2*n),t[n]=n;return{...PN(),points:hE(e,t,t,{},r)}}const kA=512;class dE extends Oy{getTileIndices(e){return super.getTileIndices(e).map(P2e).map(t=>({q:t,i:Jx(t)}))}getTileId({q:e,i:t}){return t||Jx(e)}getTileMetadata({q:e}){return super.getTileMetadata(IN(e))}getTileZoom({q:e}){return Number(fE(e))}getParentIndex({q:e}){return{q:MN(e)}}}const zF=512;function ON(r){const{x:e,y:t,z:n}=IN(r),i=zF/(1<<n);return[e*i,zF-t*i,i]}function k2e(r,e){const[t,n,i]=ON(r);return[[t,n],[t+e*i,n-e*i]]}function DN(r,e=1){const[t,n]=k2e(r,e),[i,o]=tl(t),[s,c]=tl(n);return[s,o,s,c,i,c,i,o,s,o]}const pm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),GF=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);GF&&parseFloat(GF[1]);function N2e(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function U2e(...r){return z2e(r)}function z2e(r){const e=r.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function G2e(r){const e=[];for await(const t of r)e.push(t);return U2e(...e)}function V2e(r){return r&&typeof r=="object"&&r.isBuffer}function gm(r){if(V2e(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function mm(r){return e=>new Promise((t,n)=>r(e,(i,o)=>i?n(i):t(o)))}class H2e{constructor(e){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(e={}){N2e(e)}async compress(e){return await this.preload(),this.compressSync(e)}async decompress(e,t){return await this.preload(),this.decompressSync(e,t)}compressSync(e){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(e,t){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(e){const t=await this.concatenate(e);yield this.compress(t)}async*decompressBatches(e){const t=await this.concatenate(e);yield this.decompress(t)}concatenate(e){return G2e(e)}improveError(e){return e.message.includes(this.name)||(e.message=`${this.name} ${e.message}`),e}}class j2e extends H2e{constructor(t={}){super(t);V(this,"name","deflate");V(this,"extensions",[]);V(this,"contentEncodings",["deflate"]);V(this,"isSupported",!0);V(this,"options");V(this,"_chunks",[]);this.options=t}async compress(t){var n,i;if(!pm&&((n=this.options.deflate)!=null&&n.useZlib)){const o=(i=this.options.deflate)!=null&&i.gzip?await mm(bu.gzip)(t):await mm(bu.deflate)(t);return gm(o)}return this.compressSync(t)}async decompress(t){var n,i;if(!pm&&((n=this.options.deflate)!=null&&n.useZlib)){const o=(i=this.options.deflate)!=null&&i.gzip?await mm(bu.gunzip)(t):await mm(bu.inflate)(t);return gm(o)}return this.decompressSync(t)}compressSync(t){var s,c,f,_;if(!pm&&((s=this.options.deflate)!=null&&s.useZlib)){const b=(c=this.options.deflate)!=null&&c.gzip?bu.gzipSync(t):bu.deflateSync(t);return gm(b)}const n=((f=this.options)==null?void 0:f.deflate)||{},i=new Uint8Array(t);return((_=this.options)!=null&&_.raw?Id.deflateRaw:Id.deflate)(i,n).buffer}decompressSync(t){var s,c,f,_;if(!pm&&((s=this.options.deflate)!=null&&s.useZlib)){const b=(c=this.options.deflate)!=null&&c.gzip?bu.gunzipSync(t):bu.inflateSync(t);return gm(b)}const n=((f=this.options)==null?void 0:f.deflate)||{},i=new Uint8Array(t);return((_=this.options)!=null&&_.raw?Id.inflateRaw:Id.inflate)(i,n).buffer}async*compressBatches(t){var o;const n=((o=this.options)==null?void 0:o.deflate)||{},i=new Id.Deflate(n);yield*this.transformBatches(i,t)}async*decompressBatches(t){var o;const n=((o=this.options)==null?void 0:o.deflate)||{},i=new Id.Inflate(n);yield*this.transformBatches(i,t)}async*transformBatches(t,n){t.onData=this._onData.bind(this),t.onEnd=this._onEnd.bind(this);for await(const s of n){const c=new Uint8Array(s);if(!t.push(c,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const i=new Uint8Array(0);t.push(i,!0),yield*this._getChunks()}_onData(t){this._chunks.push(t)}_onEnd(t){if(t!==0)throw new Error(this._getError(t)+this._chunks.length)}_getChunks(){const t=this._chunks;return this._chunks=[],t}_getError(t=0){const n={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${n[t]}`}}class $2e extends j2e{constructor(t){super({...t,deflate:{...t==null?void 0:t.gzip,gzip:!0}});V(this,"name","gzip");V(this,"extensions",["gz","gzip"]);V(this,"contentEncodings",["gzip","x-gzip"]);V(this,"isSupported",!0)}}function qy(r,e,t,n){const i=e.type===2?e.readVarint()+e.pos:e.pos+1,o=e.buf.buffer.slice(e.pos,i);if((n==null?void 0:n.compression)==="gzip"){const c=new $2e().decompressSync(o);t.value=new r(c)}else t.value=new r(o);return e.pos=i,t.value}class AE{static read(e,t){return e.readFields(AE._readField,{key:"",value:null},t)}static _readField(e,t,n){e===1?t.key=n.readString():e===2&&(t.value=n.readString())}}class mh{static read(e,t){return e.readFields(mh._readField,{},t)}static _readField(e,t,n){if(e===1){const{key:i,value:o}=AE.read(n,n.readVarint()+n.pos);t[i]=o}}}class Gg{static read(e,t){const{value:n,size:i}=e.readFields(Gg._readField,{value:[],size:0},t);return{value:n,size:i}}static _readField(e,t,n){e===1?qy(Float64Array,n,t):e===2&&(t.size=n.readVarint(!0))}}class Ba{static read(e,t){const{value:n,size:i}=e.readFields(Ba._readField,{value:[],size:0},t);return{value:new Uint32Array(n),size:i}}static _readField(e,t,n){e===1?n.readPackedVarint(t.value):e===2&&(t.size=n.readVarint(!0))}}class Vg{static read(e,t){return e.readFields(Vg._readField,{id:0},t)}static _readField(e,t,n){e===1&&(t.id=n.readVarint())}}class pE{static read(e,t){return e.readFields(pE._readField,{value:[]},t)}static _readField(e,t,n){e===1&&qy(Float64Array,n,t)}}class _h{static read(e,t){return e.readFields(_h._readField,{key:"",value:null},t)}static _readField(e,t,n){e===1?t.key=n.readString():e===2&&(t.value=pE.read(n,n.readVarint()+n.pos))}}class gE{static read(e,t){return e.readFields(gE._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},t)}static _readField(e,t,n){if(e===1)t.positions=Gg.read(n,n.readVarint()+n.pos);else if(e===2)t.globalFeatureIds=Ba.read(n,n.readVarint()+n.pos);else if(e===3)t.featureIds=Ba.read(n,n.readVarint()+n.pos);else if(e===4)t.properties.push(mh.read(n,n.readVarint()+n.pos));else if(e===5){const i=_h.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}else e===6&&t.fields.push(Vg.read(n,n.readVarint()+n.pos))}}class mE{static read(e,t){return e.readFields(mE._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},t)}static _readField(e,t,n){if(e===1)t.positions=Gg.read(n,n.readVarint()+n.pos);else if(e===2)t.pathIndices=Ba.read(n,n.readVarint()+n.pos);else if(e===3)t.globalFeatureIds=Ba.read(n,n.readVarint()+n.pos);else if(e===4)t.featureIds=Ba.read(n,n.readVarint()+n.pos);else if(e===5)t.properties.push(mh.read(n,n.readVarint()+n.pos));else if(e===6){const i=_h.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}else e===7&&t.fields.push(Vg.read(n,n.readVarint()+n.pos))}}class _E{static read(e,t){return e.readFields(_E._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},t)}static _readField(e,t,n){if(e===1)t.positions=Gg.read(n,n.readVarint()+n.pos);else if(e===2)t.polygonIndices=Ba.read(n,n.readVarint()+n.pos);else if(e===3)t.globalFeatureIds=Ba.read(n,n.readVarint()+n.pos);else if(e===4)t.featureIds=Ba.read(n,n.readVarint()+n.pos);else if(e===5)t.primitivePolygonIndices=Ba.read(n,n.readVarint()+n.pos);else if(e===6)t.triangles=Ba.read(n,n.readVarint()+n.pos);else if(e===7)t.properties.push(mh.read(n,n.readVarint()+n.pos));else if(e===8){const i=_h.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}else e===9&&t.fields.push(Vg.read(n,n.readVarint()+n.pos))}}let W2e=class LN{static read(e,t){return e.readFields(LN._readField,{points:null,lines:null,polygons:null},t)}static _readField(e,t,n){e===1?t.points=gE.read(n,n.readVarint()+n.pos):e===2?t.lines=mE.read(n,n.readVarint()+n.pos):e===3&&(t.polygons=_E.read(n,n.readVarint()+n.pos))}};class yE{static read(e,t){return e.readFields(yE._readField,{value:[]},t)}static _readField(e,t,n){e===1&&qy(BigUint64Array,n,t)}}class vE{static read(e,t){return e.readFields(vE._readField,{indices:null,properties:[],numericProps:{}},t)}static _readField(e,t,n){if(e===1)t.indices=yE.read(n,n.readVarint()+n.pos);else if(e===2)t.properties.push(mh.read(n,n.readVarint()+n.pos));else if(e===3){const i=_h.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}}}let J2e=class kN{static read(e,t){return e.readFields(kN._readField,{scheme:0,cells:null},t)}static _readField(e,t,n){e===1?t.scheme=n.readVarint():e===2&&(t.cells=vE.read(n,n.readVarint()+n.pos))}};function Zy(r,e){const t=new a2e(r);return e.read(t)}function X2e(r){const{cells:e,scheme:t}=r,n=e.indices.value.length,i=[];for(let o=0;o<n;o++){const s=t==="h3"?Jx(e.indices.value[o]):e.indices.value[o],c={...e.properties[o]};for(const f of Object.keys(e.numericProps))c[f]=e.numericProps[f].value[o];i.push({id:s,properties:c})}return i}const NN="9.1.11",UN="cartoSpatialTile",K2e={cartoSpatialTile:{scheme:"quadbin",workerUrl:Yy(UN,NN)}},zN={name:"CARTO Spatial Tile",version:NN,id:UN,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(r,e)=>VF(r,e),parseSync:VF,worker:!0,options:K2e};function VF(r,e){var s;if(!r)return null;const t=Zy(r,J2e),{cells:n}=t,i=(s=e==null?void 0:e.cartoSpatialTile)==null?void 0:s.scheme;return X2e({cells:n,scheme:i})}function NA(r,e,t=0){if(!r)return e;if(!e)return r;if(t>10)return e;const n={...r};for(const i in e){const o=e[i];o===r||o===e||(typeof o=="object"&&o!==null?n[i]=NA(r[i],o,t+1):n[i]=o)}return n}function Y2e(r,e){const t={};for(const{geoid:n,...i}of e.properties)n in t?$r.warn("Duplicate geoid key in boundary mapping, using first occurance")():t[n]=i;for(const n of["points","lines","polygons"]){const i=r[n];if(i.positions.value.length===0)continue;i.properties=i.properties.map(({geoid:_})=>t[_]);const{positions:o,globalFeatureIds:s}=i;let c=null;n==="lines"&&(c=i.pathIndices.value),n==="polygons"&&(c=i.polygonIndices.value);const f=o.value.length/o.size;for(const _ in e.numericProps){const b=e.numericProps[_].value,T=b.constructor,S=new T(f);if(i.numericProps[_]={value:S,size:1},c)for(let D=0;D<c.length-1;D++){const N=c[D],G=c[D+1],W=s.value[N];S.fill(b[W],N,G)}else for(let D=0;D<f;D++){const N=s.value[D];S[D]=b[N]}}}return r}const ih={type:"object",value:null,validate:(r,e)=>e.optional&&r===null||typeof r=="object"&&Array.isArray(r.tiles)&&r.tiles.every(t=>typeof t=="string"),equal:(r,e)=>Ki(r,e,2),async:!0};Mg([zN]);const GN={data:ih,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:r})=>DN(r,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:kA};class bE extends Xl{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){var S;const e=(S=this.state.tileset)==null?void 0:S.tiles.filter(D=>D.isLoaded&&D.content&&this.state.tileset.isTileVisible(D));if(!(e!=null&&e.length))return null;e.sort((D,N)=>N.zoom-D.zoom);const{zoom:t}=this.context.viewport,{clusterLevel:n,getPosition:i,getWeight:o}=this.props,{aggregationCache:s}=this.state,c=O2e(e[0]),f=[];let _=!1;for(const D of e){const N=Math.round(t-D.zoom),G=Math.round(n)-N;let W=s.get(D.content);W||(W=new Map,s.set(D.content,W));const z=F2e(D,W,G,c,i,o);_||(_=z),f.push(...W.get(G))}f.sort((D,N)=>Number(N.count-D.count));const b=f==null?void 0:f.map(D=>D.id);if(_||(_=!Ki(b,this.state.clusterIds,1)),this.setState({clusterIds:b}),_){const D=D2e(f,c),N=L2e(f);N.points.attributes={stats:D},this.setState({data:N})}const T={...this.props,id:"clusters",data:this.state.data,dataComparator:(D,N)=>{var z,j,K,fe;const G=(j=(z=D==null?void 0:D.points)==null?void 0:z.properties)==null?void 0:j.map(Z=>Z.id),W=(fe=(K=N==null?void 0:N.points)==null?void 0:K.properties)==null?void 0:fe.map(Z=>Z.id);return Ki(G,W,1)}};return new Wl(this.getSubLayerProps(T))}getPickingInfo(e){const t=e.info;if(t.index!==-1){const{data:n}=e.sourceLayer.props;t.object=Wx(n,{globalFeatureId:t.index})}return t}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}filterSubLayer(){return!0}}bE.layerName="ClusterGeoJsonLayer";bE.defaultProps=GN;class xE extends ys{getLoadOptions(){const e=this.props.data;return NA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t,maxresolution:n}=e;return[new bE(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:t,TilesetClass:dE,maxZoom:n,loadOptions:this.getLoadOptions()})]}}xE.layerName="ClusterTileLayer";xE.defaultProps=GN;const q2e=85.051128;function Z2e({west:r,north:e,east:t,south:n},i){const c=[[e,t],[n,t],[n,r],[e,r]].map(b=>FC(b[0],b[1],i)).map(b=>Math.max(..._Ae(b).map(T=>vAe(T,dA.rads)))*180/Math.PI),f=Math.max(...c),_=Math.min(180,f/Math.cos((e+n)/2*Math.PI/180));return{north:Math.min(e+f,q2e),east:t+_,south:Math.max(n-f,-85.051128),west:r-_}}function VN({west:r,north:e,east:t,south:n},i){const o=Math.abs(t-r);if(o>180){const c=Math.ceil(o/180);let f=[];for(let _=0;_<c;_++){const b=r+_*180,T=Math.min(b+179.9999999,t);f=f.concat(VN({west:b,north:e,east:T,south:n},i))}return[...new Set(f)]}return gAe([[e,t],[n,t],[n,r],[e,r],[e,t]],i)}function Q2e(r){const e=Yk(r),t=e.map(f=>f[0]),n=e.map(f=>f[1]),i=Math.min(...n),o=Math.min(...t),s=Math.max(...n),c=Math.max(...t);return{west:i,south:o,east:s,north:c}}const exe=2;function Xx(r,e){const t=Math.log2(e/512),n=2/3*(r.zoom-t),i=Math.log(1/Math.cos(Math.PI*r.latitude/180));return Math.max(0,Math.floor(n+i-exe))}class txe extends Oy{getTileIndices({viewport:e,minZoom:t,maxZoom:n}){if(e.latitude===void 0)return[];const[i,o,s,c]=e.getBounds(),{tileSize:f}=this.opts;let _=Xx(e,f),b;if(typeof t=="number"&&Number.isFinite(t)&&_<t)return[];if(typeof n=="number"&&Number.isFinite(n)&&_>n){_=n;const T=FC(e.latitude,e.longitude,n);b=pAe(T,1)}else{const T=Z2e({west:i,north:c,east:s,south:o},_);b=VN(T,_)}return b.map(T=>({i:T}))}getTileId({i:e}){return e}getTileMetadata({i:e}){return{bbox:Q2e(e)}}getTileZoom({i:e}){return Rx(e)}getParentIndex(e){const t=Rx(e.i);return{i:AAe(e.i,t-1)}}}Mg([zN]);function rxe(r){return r!=null&&r!==""}const nxe={tileSize:kA};class Qy extends Xl{_updateAutoHighlight(e){const{hoveredFeatureId:t}=this.state,n=e.object;let i=null;if(n&&(i=n.id),t!==i){let{highlightColor:o}=this.props;typeof o=="function"&&(o=o(e)),this.setState({highlightColor:o,hoveredFeatureId:i})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t}=this.state,n=e.content;return!rxe(t)||!Array.isArray(n)||!this._featureInTile(e,t)?-1:n.findIndex(o=>o.id===t)}_featureInTile(e,t){const n=this.state.tileset,i=n.getTileZoom(e.index),o=e.index.q?"q":"i";let s={[o]:t},c=n.getTileZoom(s);for(;!(c<=i);)s=n.getParentIndex(s),c=n.getTileZoom(s);return s[o]===e.index[o]}}Qy.layerName="SpatialIndexTileLayer";Qy.defaultProps=nxe;const ixe=r=>{const{data:e}=r,{index:t}=r.tile;return!e||!e.length?null:new al(r,{getHexagon:n=>n.id,centerHexagon:t,highPrecision:!0})},sxe={data:ih,tileSize:kA};class wE extends ys{initializeState(){al._checkH3Lib()}getLoadOptions(){const e=this.props.data;return NA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"h3"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t}=e;let{minresolution:n,maxresolution:i}=e;this.props.minZoom&&(n=Math.max(n,Xx({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(i=Math.min(i,Xx({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const o=this.getSubLayerClass("spatial-index-tile",Qy);return new o(this.props,{id:`h3-tile-layer-${this.props.id}`,data:t,TilesetClass:txe,renderSubLayers:ixe,minZoom:n,maxZoom:i,loadOptions:this.getLoadOptions()})}}wE.layerName="H3TileLayer";wE.defaultProps=sxe;const oxe=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,axe={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:r=>{if(!r)return{};const{colorDomain:e=[0,1],colorTexture:t,delta:n=[1,0],intensity:i=1,opacity:o=1,radiusPixels:s=20}=r;return{colorDomain:e,colorTexture:t,delta:n,intensity:i,opacity:o,radiusPixels:s}},fs:oxe,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},cxe={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function Kx(r){for(;r.parent&&!r.applyPostProcess;)r=r.parent;return r}class HN extends _s{initializeState(){this.id=`draw-callback-${Kx(this).props.id}`}_drawLayer(){Kx(this).applyPostProcess()}}HN.layerName="DrawCallbackLayer";function jN(r){var e;return e=class extends r{draw(n){const{shaderModuleProps:i}=n,{picking:o}=i,s=Kx(this);o.isActive||s.enableRTT(n),super.draw(n),o.isActive||s.disableRTT()}},e.layerName=`RTT-${r.layerName}`,e}function $N(r,e){var t;return t=class extends r{initializeState(i){super.initializeState(i),this._createTextures(),this.internalState.postProcess=new nX(e,this.props),this.internalState.postProcess.setup(i)}updateState(i){super.updateState(i),this.internalState.postProcess.setProps(this.props)}renderLayers(){let i=super.renderLayers();return i?(i=Array.isArray(i)?i:[i],[...i,new HN]):null}_createTextures(){const{device:i}=this.context;this.internalState.renderBuffers=[0,1].map(o=>i.createFramebuffer({id:`layer-fbo-${o}`,colorAttachments:[i.createTexture(cxe)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(i){const{shaderModuleProps:o}=i,{viewport:s}=this.context,{devicePixelRatio:c}=o.project,f=c*s.width,_=c*s.height;this.internalState.renderBuffers.forEach(b=>b.resize({width:f,height:_}))}enableRTT(i){this._resizeBuffers(i),this.internalState.originalRenderPass=this.context.renderPass;const[o]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,o.width,o.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[i,o]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:i,swapBuffer:o,target:s}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(i=>{i.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},t.layerName=`PostProcess${r.layerName}`,t}const lxe=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,uxe={name:"copy",fs:lxe,getUniforms:()=>({}),passes:[{filter:!0}]},fxe={getQuadbin:{type:"accessor",value:r=>r.quadbin}};class CE extends tf{indexToBounds(){const{data:e,extruded:t,getQuadbin:n}=this.props,i=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>DN(n(o,s),i),updateTriggers:{getPolygon:i}}}}CE.layerName="QuadbinLayer";CE.defaultProps=fxe;const hxe=r=>{const{data:e}=r;if(!e||!e.length)return null;const t=typeof e[0].id=="bigint";return new CE(r,{getQuadbin:t?n=>n.id:n=>M2e(n.id)})},dxe={data:ih,tileSize:kA};class ev extends ys{getLoadOptions(){const e=this.props.data;return NA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t,maxresolution:n}=e,i=this.getSubLayerClass("spatial-index-tile",Qy);return new i(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:t,TilesetClass:dE,renderSubLayers:hxe,maxZoom:n,loadOptions:this.getLoadOptions()})}}ev.layerName="QuadbinTileLayer";ev.defaultProps=dxe;const Axe=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],pxe={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function WN(r){const e=Number(fE(r));return Math.pow(4,e)}function gxe(r){const e=new Uint8Array(r.length*4);let t=0;for(let n=0;n<r.length;n++){const i=r[n];e[t++]=i[0],e[t++]=i[1],e[t++]=i[2],e[t++]=Number.isFinite(i[3])?i[3]:255}return e}const mxe=`uniform densityUniforms {
  float factor;
} density;
`,_xe={name:"density",vs:mxe,uniformTypes:{factor:"f32"}};class JN extends jN(Qu){getShaders(e){const t=super.getShaders(e);return t.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},t.modules=[...t.modules,_xe],t}draw(e){const t=this.props.data[0],n=this.props.elevationScale,i={factor:WN(t.id)/n};for(const o of this.state.models)o.shaderInputs.setProps({density:i});super.draw(e)}}JN.layerName="RTTSolidPolygonLayer";const yxe=$N(ev,axe),vxe={data:ih,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:Axe,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class EE extends ys{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:e}){const{viewportChanged:t}=e;return this.setState({viewportChanged:t}),e.somethingChanged}updateState(e){const{props:t,oldProps:n}=e;super.updateState(e),t.colorRange!==n.colorRange&&this._updateColorTexture(e)}renderLayers(){var Z,ae,Be;const{data:e,getWeight:t,colorDomain:n,intensity:i,radiusPixels:o,_subLayerProps:s,updateTriggers:c,onMaxDensityChange:f,onViewportLoad:_,onTileLoad:b,onTileUnload:T,...S}=this.props,D={...s,cell:{...s==null?void 0:s.cell,_subLayerProps:{...(Z=s==null?void 0:s.cell)==null?void 0:Z._subLayerProps,fill:{...(Be=(ae=s==null?void 0:s.cell)==null?void 0:ae._subLayerProps)==null?void 0:Be.fill,type:JN}}}};let N=0,G=0;const W=[...this.state.tiles].filter(Le=>Le.content),z=W.filter(Le=>Le.isVisible),j=z.length?z:W;for(const Le of j){const de=Le.content[0],_e=WN(de.id);G=Math.max(Le.userData.maxWeight*_e,G),N=Math.max(Le.zoom,N)}const K=this.context.viewport.zoom-N;return G=G*Math.pow(2,K),typeof f=="function"&&f(G),new yxe(S,this.getSubLayerProps({id:"heatmap",data:e,getFillColor:0,getElevation:t,elevationScale:G,colorDomain:n,radiusPixels:o,intensity:i,_subLayerProps:D,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:c.getWeight},onViewportLoad:Le=>{this.setState({isLoaded:!0}),typeof _=="function"&&_(Le)},onTileLoad:Le=>{let de=-1/0;if(typeof t!="function")de=t;else if(Le.content)for(const _e of Le.content)de=Math.max(t(_e,{}),de);Le.userData={maxWeight:de},this.state.tiles.add(Le),typeof b=="function"&&b(Le)},onTileUnload:Le=>{this.state.tiles.delete(Le),typeof T=="function"&&T(Le)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const i=gxe(t);n&&(n==null?void 0:n.width)===t.length?n.setTexture2DData({data:i}):(n==null||n.destroy(),n=this.context.device.createTexture({...pxe,data:i,width:t.length,height:1})),this.setState({colorTexture:n})}}EE.layerName="HeatmapTileLayer";EE.defaultProps=vxe;const[HF,jF,$F,WF]=[0,1,2,3];class XN extends Og{getShaders(){const e=super.getShaders();let t=e.vs;return t=t.replaceAll("textBackground.padding.","_padding."),t=t.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...e,vs:t}}}XN.layerName="EnhancedTextBackgroundLayer";class KN extends Ah{filterSubLayer({layer:e,renderPass:t}){const n=e.id.includes("primary-background");return t==="collision"?n:!n}}KN.layerName="EnhancedTextLayer";const bxe={...Ah.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class tv extends ys{calculatePixelOffset(e){const{getTextAnchor:t,getAlignmentBaseline:n,getRadius:i,getSecondaryText:o,radiusScale:s,secondarySizeScale:c,sizeScale:f}=this.props,_=t==="middle"?0:t==="start"?1:-1,b=n==="center"?0:n==="bottom"?1:-1,T=f/4,S=f*(1+1/4),D=.6*(1-b)*f;let N=e?D:0;t==="middle"&&n==="top"&&o&&(N-=D,N-=c,N+=f);const G=1+1/4;return typeof i=="function"?(W,z)=>{const j=(z?i(W,z):1)*s*G;return[_*(j+T),b*(j+S)+N]}:[_*(i*s*G+T),b*(i*s*G+S)+N]}calculateBackgroundPadding(){const{getTextAnchor:e,getAlignmentBaseline:t,sizeScale:n}=this.props,i=12*n,o=3*n,s=[0,0,0,0];return t==="top"?s[jF]=o:t==="bottom"?s[WF]=o:(s[jF]=.5*o,s[WF]=.5*o),e==="start"?s[HF]=i:e==="end"?s[$F]=i:(s[HF]=.5*i,s[$F]=.5*i),s}renderTextLayer(e,{updateTriggers:t={},...n}){var j,K;const{data:i,characterSet:o,fontFamily:s,fontSettings:c,fontWeight:f,outlineColor:_,outlineWidth:b,sizeScale:T,radiusScale:S,getAlignmentBaseline:D,getColor:N,getPosition:G,getTextAnchor:W,updateTriggers:z}=this.props;if(T<2){const fe=(K=(j=this.parent)==null?void 0:j.props)!=null&&K.textSizeScale?"textSizeScale":"sizeScale";$r.warn(`${fe} has small value (${T}). Note getTextSize is not supported on PointLabelLayer`)()}return new KN(this.getSubLayerProps({id:e,data:i,characterSet:o,fontFamily:s,fontSettings:c,fontWeight:f,outlineColor:_,outlineWidth:b,sizeScale:T,getAlignmentBaseline:D,getColor:N,getPosition:G,getTextAnchor:W,updateTriggers:{...z,...t,getPixelOffset:[z.getRadius,z.getTextAnchor,z.getAlignmentBaseline,S,T]}}),{getSize:1,_subLayerProps:{background:{type:XN}}},n)}renderLayers(){const{getText:e,getSecondaryColor:t,getSecondaryText:n,secondaryOutlineColor:i,secondarySizeScale:o,updateTriggers:s}=this.props,c=this.calculatePixelOffset(!1),f=this.calculateBackgroundPadding();return[this.renderTextLayer(`${s.getText}-primary`,{backgroundPadding:f,getText:e,getPixelOffset:c,background:!0}),!!n&&this.renderTextLayer(`${s.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...t&&{getColor:t},...o&&{sizeScale:o},...i&&{outlineColor:i}})]}}tv.layerName="PointLabelLayer";tv.defaultProps=bxe;const xxe=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
geometry.position.xy += cellCenter;
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wxe={...ol.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class YN extends jN(ol){getShaders(){const e=super.getShaders(),t=this.props.data,n=t.data.blockSize??Math.sqrt(t.length);return{...e,defines:{...e.defines,BLOCK_WIDTH:n},vs:xxe}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}YN.layerName="RasterColumnLayer";function Cxe(r,e){return r.data===e.data&&r.length===e.length}class TE extends ys{renderLayers(){const{data:e,getElevation:t,getFillColor:n,getLineColor:i,getLineWidth:o,tileIndex:s,updateTriggers:c}=this.props;if(!e||!s)return null;const f=e.blockSize??0,[_,b,T]=ON(s),S=[_,b],D=T/f,N=this.getSubLayerClass("column",YN),{highlightedObjectIndex:G,highlightColor:W}=this.state;return new N(this.props,this.getSubLayerProps({id:"cell",updateTriggers:c,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(o)}),{data:{data:e,length:f*f},dataComparator:Cxe,offset:S,lineWidthScale:D,highlightedObjectIndex:G,highlightColor:W,parameters:{blendColorSrcFactor:"one",blendAlphaSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaDstFactor:"zero",blendColorOperation:"add",blendAlphaOperation:"add"}})}getSubLayerAccessor(e){return typeof e!="function"?super.getSubLayerAccessor(e):(t,n)=>{const{data:i,index:o}=n,s=i.data,c=R2e(s.cells,o);return e({properties:c},n)}}getPickingInfo(e){const t=super.getPickingInfo(e);return t.index!==-1&&(t.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:t.index})),t}_updateAutoHighlight(e){const{highlightedObjectIndex:t}=this.state;let n=-1;if(e.index!==-1&&(n=e.index),t!==n){let{highlightColor:i}=this.props;typeof i=="function"&&(i=i(e)),this.setState({highlightColor:i,highlightedObjectIndex:n})}}}TE.layerName="RasterLayer";TE.defaultProps=wxe;const Exe={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class BE{static read(e,t){return e.readFields(BE._readField,{name:"",type:"",data:null},t)}static _readField(e,t,n){if(e===1)t.name=n.readString();else if(e===2)t.type=n.readString();else if(e===3){const i=Exe[t.type];if(!i)throw Error(`Invalid data type: ${t.type}`);t.data={};const{compression:o}=Yx;qy(i,n,t.data,{compression:o})}}}let Yx=class qN{static read(e,t){return e.readFields(qN._readField,{blockSize:0,bands:[]},t)}static _readField(e,t,n){e===1?t.blockSize=n.readVarint():e===2&&t.bands.push(BE.read(n,n.readVarint()+n.pos))}};const ZN="9.1.11",QN="cartoRasterTile",Txe={cartoRasterTile:{metadata:null,workerUrl:Yy(QN,ZN)}},Bxe={name:"CARTO Raster Tile",version:ZN,id:QN,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(r,e)=>JF(r,e),parseSync:JF,worker:!0,options:Txe};function JF(r,e){var c;const t=(c=e==null?void 0:e.cartoRasterTile)==null?void 0:c.metadata;if(!r||!t)return null;Yx.compression=t.compression;const n=Zy(r,Yx),{bands:i,blockSize:o}=n,s={};for(let f=0;f<i.length;f++){const{name:_,data:b}=i[f];s[_]=b}return{blockSize:o,cells:{numericProps:s,properties:[]}}}Mg([Bxe]);const Sxe=r=>{var t,n;const e=(n=(t=r.tile)==null?void 0:t.index)==null?void 0:n.q;return e?new TE(r,{tileIndex:e}):null},Ixe={data:ih,refinementStrategy:"no-overlap",tileSize:kA};class Mxe extends $N(Xl,uxe){filterSubLayer(e){const{tile:t}=e.layer.props;return t?super.filterSubLayer(e):!0}}class SE extends ys{getLoadOptions(){const e=this.props.data;return NA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:t,minzoom:n,maxzoom:i,raster_metadata:o}=e,s=this.getSubLayerClass("tile",Mxe),c=this.getLoadOptions();return new s(this.props,{id:`raster-tile-layer-${this.props.id}`,data:t,TilesetClass:dE,renderSubLayers:Sxe,minZoom:n,maxZoom:i,loadOptions:{...c,cartoRasterTile:{...c==null?void 0:c.cartoRasterTile,metadata:o}}})}}SE.layerName="RasterTileLayer";SE.defaultProps=Ixe;class IE{static read(e,t){return e.readFields(IE._readField,{properties:[],numericProps:{}},t)}static _readField(e,t,n){if(e===1)t.properties.push(mh.read(n,n.readVarint()+n.pos));else if(e===2){const i=_h.read(n,n.readVarint()+n.pos);t.numericProps[i.key]=i.value}}}const e9="9.1.11",t9="cartoPropertiesTile",Pxe={cartoPropertiesTile:{workerUrl:Yy(t9,e9)}},Rxe={name:"CARTO Properties Tile",version:e9,id:t9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(r,e)=>XF(r),parseSync:XF,options:Pxe};function XF(r,e){return r?Zy(r,IE):null}const r9="9.1.11",n9="cartoVectorTile",Fxe={cartoVectorTile:{workerUrl:Yy(n9,r9)}},Oxe={name:"CARTO Vector Tile",version:r9,id:n9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(r,e)=>KF(r),parseSync:KF,worker:!0,options:Fxe};function Dxe(r,e,{startPosition:t,endPosition:n,indices:i}){const o=r.positions.size,s=t*o,c=n*o,f=r.positions.value.subarray(s,c),_=i.slice(1).map(T=>T-t),b=lk(f,_,o);for(let T=0,S=b.length;T<S;++T)e.push(t+b[T])}function Lxe(r){const{polygonIndices:e,primitivePolygonIndices:t}=r,n=[];let i=0;for(let o=0;o<e.value.length-1;o++){const s=e.value[o],c=e.value[o+1],f=t.value.indexOf(c),_=t.value.subarray(i,f);i=f,Dxe(r,n,{startPosition:s,endPosition:c,indices:_})}r.triangles={value:new Uint32Array(n),size:1}}function KF(r,e){if(!r)return null;const t=Zy(r,W2e);return t.polygons&&!t.polygons.triangles&&Lxe(t.polygons),t}function kxe(r,e){const t=e?e in r.numericProps:!1,n=new Map;for(let b=0;b<r.pathIndices.value.length-1;b++){const T=r.pathIndices.value[b],S=r.featureIds.value[T];let D;e===void 0?D=S:t?D=r.numericProps[e].value[T]:r.properties[S]&&e in r.properties[S]?D=r.properties[S][e]:D=void 0;const N=jxe(r,b);(!n.has(D)||N>n.get(D).length)&&n.set(D,{index:b,length:N})}const i=[],o=[],s=[],c=[],f=RN(n.size,r.numericProps);let _=0;for(const[b,{index:T}]of n){const S=$xe(r,T);i.push(...S);const D=r.pathIndices.value[T],N=r.featureIds.value[D];s.push(_),o.push(r.properties[N]),c.push(r.globalFeatureIds.value[D]),FN(r.numericProps,f,D,_),_++}return hE(i,s,c,f,o)}function Nxe(r,e,t){const{west:n,south:i,east:o,north:s}=e,f=(o-n)*(s-i)*1e-4,_=[],b=[],T=[],S=[],D=RN(r.polygonIndices.value.length-1,r.numericProps);let N=0,G=0;const{extruded:W}=t;for(let z=0;z<r.polygonIndices.value.length-1;z++){const j=r.polygonIndices.value[z],K=r.polygonIndices.value[z+1];if(Uxe(r,z)<f)continue;const fe=Vxe(r,z);let Z=-1,ae=[0,0],Be=!1;for(;G<r.triangles.value.length;){const de=r.triangles.value[G];if(de>=K)break;if(Be){G+=3;continue}const _e=r.triangles.value[G+1],pe=r.triangles.value[G+2],J=r.positions.value.subarray(de*r.positions.size,de*r.positions.size+r.positions.size),ne=r.positions.value.subarray(_e*r.positions.size,_e*r.positions.size+r.positions.size),ye=r.positions.value.subarray(pe*r.positions.size,pe*r.positions.size+r.positions.size);if(Gxe(fe,J,ne,ye))Be=!0;else{const Ye=i9(J,ne,ye);Ye>Z&&(Z=Ye,ae=[(J[0]+ne[0]+ye[0])/3,(J[1]+ne[1]+ye[1])/3])}G+=3}const Le=Be?fe:ae;if(zxe(Le,e)){_.push(...Le);const de=r.featureIds.value[j];if(W){const _e=t.getElevation(void 0,{data:r,index:de});_.push(_e*t.elevationScale)}b.push(r.properties[de]),T.push(N),S.push(r.globalFeatureIds.value[j]),FN(r.numericProps,D,j,N),N++}}return r.numericProps&&Object.keys(D).forEach(z=>{D[z].value=D[z].value.slice(0,N)}),hE(_,T,S,D,b,W?3:2)}function Uxe(r,e){const{positions:{value:t,size:n},polygonIndices:{value:i},triangles:{value:o}}=r,s=i[e],c=i[e+1];let f=0,_=0;for(;_<o.length&&!(o[_]>=s);)_+=3;for(;_<o.length;){const b=o[_];if(b>=c)break;const T=o[_+1],S=o[_+2],D=t.subarray(b*n,b*n+n),N=t.subarray(T*n,T*n+n),G=t.subarray(S*n,S*n+n);f+=i9(D,N,G),_+=3}return f}function zxe([r,e],{west:t,east:n,south:i,north:o}){return r>=t&&r<n&&e>=i&&e<o}function Gxe(r,e,t,n){const i=Math.abs((t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]))/2,o=Math.abs((e[0]-r[0])*(t[1]-r[1])-(t[0]-r[0])*(e[1]-r[1]))/2,s=Math.abs((t[0]-r[0])*(n[1]-r[1])-(n[0]-r[0])*(t[1]-r[1]))/2,c=Math.abs((n[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(n[1]-r[1]))/2;return Math.abs(i-(o+s+c))<1e-10}function i9([r,e],[t,n],[i,o]){return Math.abs((r*(n-o)+t*(o-e)+i*(e-n))/2)}function Vxe(r,e){const{positions:{value:t,size:n}}=r,i=n*r.polygonIndices.value[e],o=n*r.polygonIndices.value[e+1];let s=1/0,c=1/0,f=-1/0,_=-1/0;for(let b=i;b<o;b+=n){const[T,S]=t.subarray(b,b+2);s=Math.min(s,T),c=Math.min(c,S),f=Math.max(f,T),_=Math.max(_,S)}return[(s+f)/2,(c+_)/2]}function Hxe(r,e){const{positions:{value:t}}=r,[n,i,o,s]=t.subarray(e,e+4);return Math.sqrt(Math.pow(o-n,2)+Math.pow(s-i,2))}function jxe(r,e){const{positions:{size:t}}=r,n=t*r.pathIndices.value[e],i=t*r.pathIndices.value[e+1];let o=0;for(let s=n;s<i;s+=t)o+=Hxe(r,s);return o}function $xe(r,e){const{positions:{value:t},pathIndices:{value:n}}=r,i=n[e]*2,s=(n[e+1]*2-i)/2;if(s===2){const[f,_,b,T]=t.subarray(i,i+4);return[(f+b)/2,(_+T)/2]}const c=i+Math.floor(s/2)*2;return[t[c],t[c+1]]}Mg([Rxe,Oxe]);const Wxe={...LA.defaultProps,autoLabels:!1,data:ih,dataComparator:ih.equal,tileSize:kA};class ME extends LA{constructor(...e){super(...e)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(e){const{props:t}=e;if(t.data){super.updateState(e);const i=new URL(t.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:i})}}getLoadOptions(){const e=this.props.data;return NA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},gis:{format:"binary"}})}async getTileData(e){const t=this.props.data,{tiles:n,properties_tiles:i}=t,o=th(n,e);if(!o)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:c}=this.props,{signal:f}=e,_=c(o,{propName:"data",layer:this,loadOptions:s,signal:f});if(!i)return await _;const b=th(i,e);if(!b)return Promise.reject("Invalid properties URL");const T=c(b,{propName:"data",layer:this,loadOptions:s,signal:f}),[S,D]=await Promise.all([_,T]);return S?D?Y2e(S,D):S:null}renderSubLayers(e){var o,s,c;if(e.data===null)return null;const t=e.tile.bbox,n=[],i={"points-text":{type:tv,...(o=e==null?void 0:e._subLayerProps)==null?void 0:o["points-text"],extensions:[new lE,...e.extensions||[],...((c=(s=e==null?void 0:e._subLayerProps)==null?void 0:s["points-text"])==null?void 0:c.extensions)||[]]}};if(this.state.mvt)n.push(super.renderSubLayers(e));else{const{west:f,south:_,east:b,north:T}=t,S=[new Xy,...e.extensions||[]],D={clipBounds:[f,_,b,T]},N=W=>{var z,j,K;return{[W]:{...D,...(z=e==null?void 0:e._subLayerProps)==null?void 0:z[W],extensions:[...S,...((K=(j=e==null?void 0:e._subLayerProps)==null?void 0:j[W])==null?void 0:K.extensions)||[]]}}},G={...e,data:{...e.data,tileBbox:t},autoHighlight:!1,_subLayerProps:{...e._subLayerProps,...i,...N("polygons-fill"),...N("polygons-stroke"),...N("linestrings")}};n.push(new Wl(G))}if(n[0]&&e.autoLabels){const f=PN();e.data.lines&&e.data.lines.positions.value.length>0&&(f.points=kxe(e.data.lines,typeof e.autoLabels=="object"?e.autoLabels.uniqueIdProperty:void 0)),e.data.polygons&&e.data.polygons.positions.value.length>0&&(f.points=Nxe(e.data.polygons,t,e)),n.push(n[0].clone({id:`${e.id}-labels`,data:f,pickable:!1,autoHighlight:!1}))}return n}renderLayers(){const e=super.renderLayers();if(!this.props.autoLabels)return e;const t=e.flat().filter(Boolean);return t.sort((n,i)=>{const o=n.id.includes("labels"),s=i.id.includes("labels");return o&&!s?1:!o&&s?-1:0}),t.map(n=>n.id.includes("labels")?n.clone({highlightedObjectIndex:-1}):n)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}ME.layerName="VectorTileLayer";ME.defaultProps=Wxe;var Tn={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},Jxe={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},Xxe={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},Kxe={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},Yxe={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},qxe={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},Zxe={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Qxe={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},ewe={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},twe={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},rwe={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},nwe={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},iwe={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},swe={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},owe={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},awe={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},cwe={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},lwe={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},uwe={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},fwe={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},hwe={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},dwe={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},Awe={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},pwe={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},gwe={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},mwe={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},_we={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},ywe={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},vwe={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},bwe={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},xwe={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},wwe={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Cwe={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},Ewe={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Twe={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},Bwe={...Tn.BuGn,tags:["quantitative"]},Swe={...Tn.BuPu,tags:["quantitative"]},Iwe={...Tn.GnBu,tags:["quantitative"]},Mwe={...Tn.OrRd,tags:["quantitative"]},Pwe={...Tn.PuBu,tags:["quantitative"]},Rwe={...Tn.PuBuGn,tags:["quantitative"]},Fwe={...Tn.PuRd,tags:["quantitative"]},Owe={...Tn.RdPu,tags:["quantitative"]},Dwe={...Tn.YlGn,tags:["quantitative"]},Lwe={...Tn.YlGnBu,tags:["quantitative"]},kwe={...Tn.YlOrBr,tags:["quantitative"]},Nwe={...Tn.YlOrRd,tags:["quantitative"]},Uwe={...Tn.Accent,tags:["qualitative"]},zwe={...Tn.Dark2,tags:["qualitative"]},Gwe={...Tn.Paired,tags:["qualitative"]},Vwe={...Tn.Pastel1,tags:["qualitative"]},Hwe={...Tn.Pastel2,tags:["qualitative"]},jwe={...Tn.Set1,tags:["qualitative"]},$we={...Tn.Set2,tags:["qualitative"]},Wwe={...Tn.Set3,tags:["qualitative"]},Jwe={...Tn.Blues,tags:["quantitative"]},Xwe={...Tn.Greens,tags:["quantitative"]},Kwe={...Tn.Greys,tags:["quantitative"]},Ywe={...Tn.Oranges,tags:["quantitative"]},qwe={...Tn.Purples,tags:["quantitative"]},Zwe={...Tn.Reds,tags:["quantitative"]},Qwe={...Tn.BrBG,tags:["diverging"]},eCe={...Tn.PiYG,tags:["diverging"]},tCe={...Tn.PRGn,tags:["diverging"]},rCe={...Tn.PuOr,tags:["diverging"]},nCe={...Tn.RdBu,tags:["diverging"]},iCe={...Tn.RdGy,tags:["diverging"]},sCe={...Tn.RdYlBu,tags:["diverging"]},oCe={...Tn.RdYlGn,tags:["diverging"]},aCe={...Tn.Spectral,tags:["diverging"]};const cCe=Object.freeze(Object.defineProperty({__proto__:null,Antique:bwe,ArmyRose:Awe,BluGrn:ewe,BluYl:iwe,Bold:xwe,BrwnYl:dwe,Burg:Jxe,BurgYl:Xxe,DarkMint:twe,Earth:vwe,Emrld:rwe,Fall:pwe,Geyser:gwe,Magenta:uwe,Mint:Qxe,OrYel:Yxe,Pastel:wwe,Peach:qxe,PinkYl:Zxe,Prism:Cwe,Purp:awe,PurpOr:cwe,RedOr:Kxe,Safe:Ewe,Sunset:lwe,SunsetDark:fwe,Teal:swe,TealGrn:owe,TealRose:_we,Temps:mwe,Tropic:ywe,Vivid:Twe,ag_GrnYl:nwe,ag_Sunset:hwe,cb_Accent:Uwe,cb_Blues:Jwe,cb_BrBG:Qwe,cb_BuGn:Bwe,cb_BuPu:Swe,cb_Dark2:zwe,cb_GnBu:Iwe,cb_Greens:Xwe,cb_Greys:Kwe,cb_OrRd:Mwe,cb_Oranges:Ywe,cb_PRGn:tCe,cb_Paired:Gwe,cb_Pastel1:Vwe,cb_Pastel2:Hwe,cb_PiYG:eCe,cb_PuBu:Pwe,cb_PuBuGn:Rwe,cb_PuOr:rCe,cb_PuRd:Fwe,cb_Purples:qwe,cb_RdBu:nCe,cb_RdGy:iCe,cb_RdPu:Owe,cb_RdYlBu:sCe,cb_RdYlGn:oCe,cb_Reds:Zwe,cb_Set1:jwe,cb_Set2:$we,cb_Set3:Wwe,cb_Spectral:aCe,cb_YlGn:Dwe,cb_YlGnBu:Lwe,cb_YlOrBr:kwe,cb_YlOrRd:Nwe},Symbol.toStringTag,{value:"Module"})),PE="PurpOr",RE=[204,204,204],lCe=[119,119,119];function FE(r,e){const t=cCe[r];let n=e;nh(t,`Palette "${r}" not found. Expected a CARTOColors string`);const i=Object.keys(t).filter(f=>f!=="tags").map(Number),o=Math.max(...i),s=Math.min(...i);!Number.isInteger(e)||e>o?n=o:e<s&&(n=s);let c=t[n];return t.tags&&t.tags.includes("qualitative")&&(c=c.slice(0,-1)),c.map(f=>uCe(f))}function uCe(r){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(r);return e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(r),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),nh(e,`Hexadecimal color "${r}" was not parsed correctly`),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)])))}const fCe=Object.freeze(["function","string"]);function OE(r,e,t){var n;return nh(typeof e=="object",'Expected "data" to be an object'),nh(fCe.includes(typeof r),'Expected "attr" to be a function or string'),typeof r=="function"?r(e,t):(n=e==null?void 0:e.properties)==null?void 0:n[r]}function hCe({attr:r,domain:e,colors:t=PE,nullColor:n=RE}){nh(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof t=="string"?FE(t,e.length+1):t,o=h5().domain(e).range(i);return(s,c)=>{const f=OE(r,s,c);return typeof f=="number"&&Number.isFinite(f)?o(f):n}}function dCe({attr:r,domain:e,colors:t=PE,nullColor:n=RE,othersColor:i=lCe}){nh(Array.isArray(e),'Expected "domain" to be an array of numbers or strings');const o={},s=typeof t=="string"?FE(t,e.length):t;for(const[c,f]of e.entries())o[f]=s[c];return(c,f)=>{const _=OE(r,c,f);return typeof _=="number"&&Number.isFinite(_)||typeof _=="string"?o[_]||i:n}}function ACe({attr:r,domain:e,colors:t=PE,nullColor:n=RE}){nh(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof t=="string"?FE(t,e.length):t,o=d5().domain(e).range(i);return(s,c)=>{const f=OE(r,s,c);return typeof f=="number"&&Number.isFinite(f)?o(f):n}}function pCe({pointCount:r,getBinId:e}){const t=new Map;for(let n=0;n<r;n++){const i=e(n);if(i===null)continue;let o=t.get(String(i));o?o.points.push(n):(o={id:i,index:t.size,points:[n]},t.set(String(i),o))}return Array.from(t.values())}function gCe({bins:r,dimensions:e,target:t}){const n=r.length*e;(!t||t.length<n)&&(t=new Float32Array(n));for(let i=0;i<r.length;i++){const{id:o}=r[i];Array.isArray(o)?t.set(o,i*e):t[i]=o}return t}const mCe=r=>r.length,s9=(r,e)=>{let t=0;for(const n of r)t+=e(n);return t},_Ce=(r,e)=>r.length===0?NaN:s9(r,e)/r.length,yCe=(r,e)=>{let t=1/0;for(const n of r){const i=e(n);i<t&&(t=i)}return t},vCe=(r,e)=>{let t=-1/0;for(const n of r){const i=e(n);i>t&&(t=i)}return t},bCe={COUNT:mCe,SUM:s9,MEAN:_Ce,MIN:yCe,MAX:vCe};function xCe({bins:r,getValue:e,operation:t,target:n}){(!n||n.length<r.length)&&(n=new Float32Array(r.length));let i=1/0,o=-1/0;for(let s=0;s<r.length;s++){const{points:c}=r[s];n[s]=t(c,e),n[s]<i&&(i=n[s]),n[s]>o&&(o=n[s])}return{value:n,domain:[i,o]}}function YF(r,e,t){const n={};for(const o of r.sources||[]){const s=e[o];if(s)n[o]=wCe(s);else throw new Error(`Cannot find attribute ${o}`)}const i={};return o=>{for(const s in n)i[s]=n[s](o);return r.getValue(i,o,t)}}function wCe(r){const e=r.value,{offset:t=0,stride:n,size:i}=r.getAccessor(),o=e.BYTES_PER_ELEMENT,s=t/o,c=n?n/o:i;if(i===1)return r.isConstant?()=>e[0]:_=>{const b=s+c*_;return e[b]};let f;return r.isConstant?(f=Array.from(e),()=>f):(f=new Array(i),_=>{const b=s+c*_;for(let T=0;T<i;T++)f[T]=e[b+T];return f})}class UA{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const t=this.props;if(e.binOptions&&(Ki(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==t.operations[n]&&this.setNeedsUpdate(n);if(e.customOperations)for(let n=0;n<this.channelCount;n++)!!e.customOperations[n]!=!!t.customOperations[n]&&this.setNeedsUpdate(n);e.pointCount!==void 0&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){var e,t,n,i;if(this.needsUpdate===!0){this.bins=pCe({pointCount:this.props.pointCount,getBinId:YF(this.props.getBin,this.props.attributes,this.props.binOptions)});const o=gCe({bins:this.bins,dimensions:this.dimensions,target:(e=this.binIds)==null?void 0:e.value});this.binIds={value:o,type:"float32",size:this.dimensions}}for(let o=0;o<this.channelCount;o++)if(this.needsUpdate===!0||this.needsUpdate[o]){const s=this.props.customOperations[o]||bCe[this.props.operations[o]],{value:c,domain:f}=xCe({bins:this.bins,getValue:YF(this.props.getValue[o],this.props.attributes,void 0),operation:s,target:(t=this.results[o])==null?void 0:t.value});this.results[o]={value:c,domain:f,type:"float32",size:1},(i=(n=this.props).onUpdate)==null||i.call(n,{channel:o})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){var t;return((t=this.results[e])==null?void 0:t.domain)??[1/0,-1/0]}getBin(e){const t=this.bins[e];if(!t)return null;const n=new Array(this.channelCount);for(let i=0;i<n.length;i++){const o=this.results[i];n[i]=o==null?void 0:o.value[e]}return{id:t.id,value:n,count:t.points.length,pointIndices:t.points}}}function o9(r,e,t){return r.createFramebuffer({width:e,height:t,colorAttachments:[r.createTexture({width:e,height:t,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const CCe=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,ECe={name:"binSorter",vs:CCe,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},a9=[1,2,4,8],TCe=3e38,BCe={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Hm=1024;class SCe{constructor(e,t){this.binsFBO=null,this.device=e,this.model=MCe(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var e,t;this.model.destroy(),(e=this.binsFBO)==null||e.colorAttachments[0].texture.destroy(),(t=this.binsFBO)==null||t.destroy()}getBinValues(e){if(!this.binsFBO)return null;const t=e%Hm,n=Math.floor(e/Hm),i=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(i)}setDimensions(e,t){var s,c;const n=Hm,i=Math.ceil(e/n);this.binsFBO?this.binsFBO.height<i&&this.binsFBO.resize({width:n,height:i}):this.binsFBO=o9(this.device,n,i);const o={binIdRange:[t[0][0],t[0][1],((s=t[1])==null?void 0:s[0])||0,((c=t[1])==null?void 0:c[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(e){const t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const t=ICe(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(t===0)return;t|=a9[3];const n=this.model,i=this.binsFBO,o=e==="MAX"?-3e38:e==="MIN"?TCe:0,s=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:i,parameters:{viewport:[0,0,i.width,i.height],colorMask:t},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(s),s.end()}}function ICe(r){const e={...BCe};for(let t=0;t<r.length;t++){const n=r[t];n&&(e[n]+=a9[t])}return e}function MCe(r,e){let t=e.vs;e.dimensions===2&&(t+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${t}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Bi(r,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],ECe],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:n,fs:i,topology:"point-list",disableWarnings:!0})}const PCe=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,RCe={name:"aggregatorTransform",vs:PCe,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class FCe{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=OCe(e,t),this.domainFBO=o9(e,2,1)}destroy(){var e,t;this.transform.destroy(),(e=this.binBuffer)==null||e.destroy(),(t=this.valueBuffer)==null||t.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){var f,_,b,T;const{model:n,transformFeedback:i}=this.transform;n.setVertexCount(e);const o={binIdRange:[t[0][0],t[0][1],((f=t[1])==null?void 0:f[0])||0,((_=t[1])==null?void 0:_[1])||0]};n.shaderInputs.setProps({aggregatorTransform:o});const s=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<s)&&((b=this.binBuffer)==null||b.destroy(),this.binBuffer=this.device.createBuffer({byteLength:s}),i.setBuffer("binIds",this.binBuffer));const c=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<c)&&((T=this.valueBuffer)==null||T.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:c}),i.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;const n=this.transform,i=this.domainFBO,o=[0,1,2].map(f=>t[f]==="COUNT"?1:0),s=[0,1,2].map(f=>t[f]==="MEAN"?1:0),c={isCount:o,isMean:s,bins:e};n.model.shaderInputs.setProps({aggregatorTransform:c}),n.run({id:"gpu-aggregation-domain",framebuffer:i,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function OCe(r,e){const t=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new yA(r,{vs:t,fs:n,topology:"point-list",modules:[RCe],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:Hm},varyings:["binIds","values"],disableWarnings:!0})}class Ra{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new SCe(e,t),this.aggregationTransform=new FCe(e,t),this.setProps(t)}getBins(){var t;const e=this.aggregationTransform.binBuffer;return e?(((t=this.binIds)==null?void 0:t.buffer)!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){var n;const t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(((n=this.results[e])==null?void 0:n.buffer)!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:t}=this.props;let n;if(this.dimensions===1)n=[e+t[0][0]];else{const[[c,f],[_]]=t,b=f-c;n=[e%b+c,Math.floor(e/b)+_]}const i=this.binSorter.getBinValues(e);if(!i)return null;const o=i[3],s=[];for(let c=0;c<this.channelCount;c++){const f=this.props.operations[c];f==="COUNT"?s[c]=o:o===0?s[c]=NaN:s[c]=f==="MEAN"?i[c]/o:i[c]}return{id:n,value:s,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const t=this.props;if("binIdRange"in e&&!Ki(e.binIdRange,t.binIdRange,2)){const n=e.binIdRange;if($r.assert(n.length===this.dimensions),this.dimensions===1){const[[i,o]]=n;this.binCount=o-i}else{const[[i,o],[s,c]]=n;this.binCount=(o-i)*(c-s)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==t.operations[n]&&this.setNeedsUpdate(n);if(e.pointCount!==void 0&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(Ki(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const n={},i={};for(const o of Object.values(e.attributes))for(const[s,c]of Object.entries(o.getValue()))ArrayBuffer.isView(c)?i[s]=c:c&&(n[s]=c);this.binSorter.setModelProps({attributes:n,constantAttributes:i})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){var n,i;if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,t=this.needsUpdate.map((o,s)=>o?e[s]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let o=0;o<this.channelCount;o++)this.needsUpdate[o]&&(this.needsUpdate[o]=!1,(i=(n=this.props).onUpdate)==null||i.call(n,{channel:o}))}}let zA=class extends ys{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var n,i;super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){(n=this.state.aggregator)==null||n.destroy();const o=this.createAggregator(t);return o.setProps({attributes:(i=this.getAttributeManager())==null?void 0:i.attributes}),this.setState({aggregator:o,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const n in e)this.onAttributeChange(n);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new Ay(this.context.device,{id:this.props.id,stats:this.context.stats})}};zA.layerName="AggregationLayer";const rv=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function c9(r,e=!1,t=Float32Array){let n;if(Number.isFinite(r[0]))n=new t(r);else{n=new t(r.length*4);let i=0;for(let o=0;o<r.length;o++){const s=r[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let i=0;i<n.length;i++)n[i]/=255;return n}const G_={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function DE(r,e){r.setSampler({minFilter:G_[e],magFilter:G_[e]})}function LE(r,e,t="linear"){const n=c9(e,!1,Uint8Array);return r.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:G_[t],magFilter:G_[t],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const DCe=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,LCe=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,kCe=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,NCe={name:"screenGrid",vs:kCe,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class l9 extends _s{getShaders(){return super.getShaders({vs:DCe,fs:LCe,modules:[ca,NCe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){var s;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,o=this.state.model;if(n.colorRange!==t.colorRange){(s=this.state.colorTexture)==null||s.destroy(),this.state.colorTexture=LE(this.context.device,t.colorRange,t.colorScaleType);const c={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:c})}else n.colorScaleType!==t.colorScaleType&&DE(this.state.colorTexture,t.colorScaleType);if(n.cellMarginPixels!==t.cellMarginPixels||n.cellSizePixels!==t.cellSizePixels||i.viewportChanged){const{width:c,height:f}=this.context.viewport,{cellSizePixels:_,cellMarginPixels:b}=this.props,T=Math.max(_-b,0),S={gridSizeClipspace:[_/c*2,_/f*2],cellSizeClipspace:[T/c*2,T/f*2]};o.shaderInputs.setProps({screenGrid:S})}}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const t=this.props.colorDomain(),n=this.state.model,i={colorDomain:t};n.shaderInputs.setProps({screenGrid:i}),n.draw(this.context.renderPass)}_getModel(){return new Bi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $s({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}l9.layerName="ScreenGridCellLayer";const UCe=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,zCe={name:"binOptions",vs:UCe,uniformTypes:{cellSizePixels:"f32"}},GCe={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:rv,colorScaleType:"linear",getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class kE extends zA{getAggregatorType(){return this.props.gpuAggregation&&Ra.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!Ra.isSupported(this.context.device)?new UA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},n,i)=>{const o=this.context.viewport,s=o.project(t),c=i.cellSizePixels;return s[0]<0||s[0]>=o.width||s[1]<0||s[1]>=o.height?null:[Math.floor(s[0]/c),Math.floor(s[1]/c)]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}]}):new Ra(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Is,zCe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{cellSizePixels:s,aggregation:c}=n;if(t||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||c!==i.aggregation||s!==i.cellSizePixels){const{width:f,height:_}=this.context.viewport,{aggregator:b}=this.state;b instanceof Ra&&b.setProps({binIdRange:[[0,Math.ceil(f/s)],[0,Math.ceil(_/s)]]}),b.setProps({pointCount:this.getNumInstances(),operations:[c],binOptions:{cellSizePixels:s}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),t}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate();break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:e}=this.state,t=this.getSubLayerClass("cells",l9),n=e.getBins(),i=e.getResult(0);return new t(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:n,getWeight:i}},dataComparator:(o,s)=>o.length===s.length,updateTriggers:{getBin:[n],getWeight:[i]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const i=this.state.aggregator.getBin(n);let o;i&&(o={col:i.id[0],row:i.id[1],value:i.value[0],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),t.object=o}return t}}kE.layerName="ScreenGridLayer";kE.defaultProps=GCe;class V_{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=qF(this.input,this.inputLength);this._percentile=HCe(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=qF(this.input,this.inputLength);this._ordinal=VCe(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:t,upperPercentile:n}){if(e==="quantile")return[t,n-1];if(t>0||n<100){const{domain:i}=this.getScalePercentile();let o=i[Math.floor(t)-1]??-1/0,s=i[Math.floor(n)-1]??1/0;if(e==="ordinal"){const{domain:c}=this.getScaleOrdinal();o=c.findIndex(f=>f>=o),s=c.findIndex(f=>f>s)-1,s===-2&&(s=c.length-1)}return[o,s]}return null}update(e){const t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:i}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,i.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==t.scaleType||e.lowerPercentile!==t.lowerPercentile||e.upperPercentile!==t.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function VCe(r){const e=new Set;for(const i of r)Number.isFinite(i)&&e.add(i);const t=Array.from(e).sort(),n=new Map;for(let i=0;i<t.length;i++)n.set(t[i],i);return{attribute:{value:r.map(i=>Number.isFinite(i)?n.get(i):NaN),type:"float32",size:1},domain:t}}function HCe(r,e=100){const t=Array.from(r).filter(Number.isFinite).sort(jCe);let n=0;const i=Math.max(1,e),o=new Array(i-1);for(;++n<i;)o[n-1]=$Ce(t,n/i);return{attribute:{value:r.map(s=>Number.isFinite(s)?WCe(o,s):NaN),type:"float32",size:1},domain:o}}function qF(r,e){var s;const t=(r.stride??4)/4,n=(r.offset??0)/4;let i=r.value;if(!i){const c=(s=r.buffer)==null?void 0:s.readSyncWebGL(0,t*4*e);c&&(i=new Float32Array(c.buffer),r.value=i)}if(t===1)return i.subarray(0,e);const o=new Float32Array(e);for(let c=0;c<e;c++)o[c]=i[c*t+n];return o}function jCe(r,e){return r-e}function $Ce(r,e){const t=r.length;if(e<=0||t<2)return r[0];if(e>=1)return r[t-1];const n=(t-1)*e,i=Math.floor(n),o=r[i],s=r[i+1];return o+(s-o)*(n-i)}function WCe(r,e){let t=0,n=r.length;for(;t<n;){const i=t+n>>>1;r[i]>e?n=i:t=i+1}return t}function NE({dataBounds:r,getBinId:e,padding:t=0}){const n=[r[0],r[1],[r[0][0],r[1][1]],[r[1][0],r[0][1]]].map(f=>e(f)),i=Math.min(...n.map(f=>f[0]))-t,o=Math.min(...n.map(f=>f[1]))-t,s=Math.max(...n.map(f=>f[0]))+t+1,c=Math.max(...n.map(f=>f[1]))+t+1;return[[i,s],[o,c]]}const u9=Math.PI/3,nv=2*Math.sin(u9),iv=1.5,JCe=Array.from({length:6},(r,e)=>{const t=e*u9;return[Math.sin(t),-Math.cos(t)]});function q1([r,e],t){let n=Math.round(e=e/t/iv),i=Math.round(r=r/t/nv-(n&1)/2);const o=e-n;if(Math.abs(o)*3>1){const s=r-i,c=i+(r<i?-1:1)/2,f=n+(e<n?-1:1),_=r-c,b=e-f;s*s+o*o>_*_+b*b&&(i=c+(n&1?1:-1)/2,n=f)}return[i,n]}const XCe=`
const vec2 DIST = vec2(${nv}, ${iv});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function ZF([r,e],t){return[(r+(e&1)/2)*t*nv,e*t*iv]}const KCe=`
const vec2 DIST = vec2(${nv}, ${iv});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,YCe=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${KCe}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,qCe=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,ZCe={name:"hexagon",vs:qCe,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class f9 extends ol{getShaders(){const e=super.getShaders();return e.modules.push(ZCe),{...e,vs:YCe}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var o;super.updateState(e);const{props:t,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==t.colorRange){(o=this.state.colorTexture)==null||o.destroy(),this.state.colorTexture=LE(this.context.device,t.colorRange,t.colorScaleType);const s={colorRange:this.state.colorTexture};i.shaderInputs.setProps({hexagon:s})}else n.colorScaleType!==t.colorScaleType&&DE(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const{radius:t,hexOriginCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:c,colorDomain:f,elevationDomain:_}=this.props,b=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel;S.vertexArray.indexBuffer&&S.setIndexBuffer(null),S.setVertexCount(this.state.fillVertexCount);const D={colorDomain:[Math.max(f[0],b[0]),Math.min(f[1],b[1]),Math.max(f[0]-1,b[0]),Math.min(f[1]+1,b[1])],elevationDomain:[Math.max(_[0],T[0]),Math.min(_[1],T[1]),Math.max(_[0]-1,T[0]),Math.min(_[1]+1,T[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:n};S.shaderInputs.setProps({column:{extruded:s,coverage:c,radius:t},hexagon:D}),S.draw(this.context.renderPass)}}f9.layerName="HexagonCellLayer";const QCe=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,eEe={name:"binOptions",vs:QCe,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function QF(){}const tEe={gpuAggregation:!0,colorDomain:null,colorRange:rv,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:QF,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:QF,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:r=>r.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class UE extends zA{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:t,getColorValue:n,getElevationValue:i}=this.props;return e&&(t||n||i)?($r.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Ra.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:t,radius:n}=this.props;return new UA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(t)return t(i,n);const f=this.state.aggregatorViewport.projectPosition(i),{radiusCommon:_,hexOriginCommon:b}=s;return q1([f[0]-b[0],f[1]-b[1]],_)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new Ra(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Is,eEe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${XCe}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(sl(n.data).iterable)),t||o.dataChanged||n.radius!==i.radius||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{radiusCommon:c,hexOriginCommon:f,binIdRange:_,dataAsArray:b}=this.state;if(s.setProps({binIdRange:_,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:c,hexOriginCommon:f},onUpdate:this._onAggregationUpdate.bind(this)}),b){const{getColorValue:T,getElevationValue:S}=this.props;s.setProps({customOperations:[T&&(D=>T(D.map(N=>b[N]),{indices:D,data:n.data})),S&&(D=>S(D.map(N=>b[N]),{indices:D,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds();let t=1,n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:c}=this.props,{unitsPerMeter:f}=o.getDistanceScales(s);t=f[0]*c;const _=q1(o.projectFlat(s),t);s=o.unprojectFlat(ZF(_,t));const b=o.constructor;o=o.isGeospatial?new b({longitude:s[0],latitude:s[1],zoom:12}):new jl({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=NE({dataBounds:e,getBinId:T=>{const S=o.projectFlat(T);return S[0]-=n[0],S[1]-=n[1],q1(S,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new V_(i,n.binCount)}),t.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new V_(i,n.binCount)}),t.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:i,binIdRange:o}=this.state;t.setProps({binIdRange:o,binOptions:{radiusCommon:n,hexOriginCommon:i}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var Be,Le;const{aggregator:e,radiusCommon:t,hexOriginCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:c,coverage:f,material:_,transitions:b,colorScaleType:T,lowerPercentile:S,upperPercentile:D,colorDomain:N,elevationScaleType:G,elevationLowerPercentile:W,elevationUpperPercentile:z,elevationDomain:j}=this.props,K=this.getSubLayerClass("cells",f9),fe=e.getBins(),Z=(Be=this.state.colors)==null?void 0:Be.update({scaleType:T,lowerPercentile:S,upperPercentile:D}),ae=(Le=this.state.elevations)==null?void 0:Le.update({scaleType:G,lowerPercentile:W,upperPercentile:z});return!Z||!ae?null:new K(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:fe,getColorValue:Z.attribute,getElevationValue:ae.attribute}},dataComparator:(de,_e)=>de.length===_e.length,updateTriggers:{getBin:[fe],getColorValue:[Z.attribute],getElevationValue:[ae.attribute]},diskResolution:6,vertices:JCe,radius:t,hexOriginCommon:n,elevationScale:i,colorRange:o,colorScaleType:T,elevationRange:s,extruded:c,coverage:f,material:_,colorDomain:Z.domain||N||e.getResultDomain(0),elevationDomain:ae.domain||j||e.getResultDomain(1),colorCutoff:Z.cutoff,elevationCutoff:ae.cutoff,transitions:b&&{getFillColor:b.getColorValue||b.getColorWeight,getElevation:b.getElevationValue||b.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const i=this.state.aggregator.getBin(n);let o;if(i){const s=ZF(i.id,this.state.radiusCommon),c=this.context.viewport.unprojectFlat(s);o={col:i.id[0],row:i.id[1],position:c,colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(f=>this.props.data[f]):[])}t.object=o}return t}}UE.layerName="HexagonLayer";UE.defaultProps=tEe;const pn=.5,xn=1/6,bt={N:[0,pn],E:[pn,0],S:[0,-.5],W:[-.5,0],NE:[pn,pn],NW:[-.5,pn],SE:[pn,-.5],SW:[-.5,-.5]},Md=[bt.W,bt.SW,bt.S],Pd=[bt.S,bt.SE,bt.E],Rd=[bt.E,bt.NE,bt.N],Fd=[bt.NW,bt.W,bt.N],Od=[[-.5,xn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[xn,-.5]],Dd=[[-.16666666666666666,-.5],[xn,-.5],[pn,-.16666666666666666],[pn,xn]],Ld=[[pn,-.16666666666666666],[pn,xn],[xn,pn],[-.16666666666666666,pn]],kd=[[-.5,xn],[-.5,-.16666666666666666],[xn,pn],[-.16666666666666666,pn]],eO=[bt.W,bt.SW,bt.SE,bt.E],tO=[bt.S,bt.SE,bt.NE,bt.N],rO=[bt.NW,bt.W,bt.E,bt.NE],nO=[bt.NW,bt.SW,bt.S,bt.N],iO=[[-.5,xn],[-.5,-.16666666666666666],[pn,-.16666666666666666],[pn,xn]],sO=[[-.16666666666666666,-.5],[xn,-.5],[xn,pn],[-.16666666666666666,pn]],rEe=[bt.NW,bt.SW,bt.SE,bt.NE],oO=[bt.NW,bt.SW,bt.SE,bt.E,bt.N],aO=[bt.W,bt.SW,bt.SE,bt.NE,bt.N],cO=[bt.NW,bt.W,bt.S,bt.SE,bt.NE],lO=[bt.NW,bt.SW,bt.S,bt.E,bt.NE],uO=[bt.NW,bt.W,[pn,-.16666666666666666],[pn,xn],bt.N],fO=[[-.16666666666666666,-.5],[xn,-.5],bt.E,bt.NE,bt.N],hO=[[-.5,xn],[-.5,-.16666666666666666],bt.S,bt.SE,bt.E],dO=[bt.W,bt.SW,bt.S,[xn,pn],[-.16666666666666666,pn]],AO=[bt.NW,bt.W,[-.16666666666666666,-.5],[xn,-.5],bt.N],pO=[[-.5,xn],[-.5,-.16666666666666666],bt.E,bt.NE,bt.N],gO=[bt.S,bt.SE,bt.E,[xn,pn],[-.16666666666666666,pn]],mO=[bt.W,bt.SW,bt.S,[pn,-.16666666666666666],[pn,xn]],_O=[bt.W,bt.SW,bt.SE,bt.E,[xn,pn],[-.16666666666666666,pn]],yO=[[-.5,xn],[-.5,-.16666666666666666],bt.S,bt.SE,bt.NE,bt.N],vO=[bt.NW,bt.W,[-.16666666666666666,-.5],[xn,-.5],bt.E,bt.NE],bO=[bt.NW,bt.SW,bt.S,[pn,-.16666666666666666],[pn,xn],bt.N],Nd=[bt.W,bt.SW,bt.S,bt.E,bt.NE,bt.N],Ud=[bt.NW,bt.W,bt.S,bt.SE,bt.E,bt.N],_m=[[-.5,xn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[xn,-.5],bt.E,bt.NE,bt.N],ym=[bt.W,bt.SW,bt.S,[pn,-.16666666666666666],[pn,xn],[xn,pn],[-.16666666666666666,pn]],vm=[bt.NW,bt.W,[-.16666666666666666,-.5],[xn,-.5],[pn,-.16666666666666666],[pn,xn],bt.N],bm=[[-.5,xn],[-.5,-.16666666666666666],bt.S,bt.SE,bt.E,[xn,pn],[-.16666666666666666,pn]],xO=[[-.5,xn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[xn,-.5],[pn,-.16666666666666666],[pn,xn],[xn,pn],[-.16666666666666666,pn]],nEe={0:[],1:[[bt.W,bt.S]],2:[[bt.S,bt.E]],3:[[bt.W,bt.E]],4:[[bt.N,bt.E]],5:{0:[[bt.W,bt.S],[bt.N,bt.E]],1:[[bt.W,bt.N],[bt.S,bt.E]]},6:[[bt.N,bt.S]],7:[[bt.W,bt.N]],8:[[bt.W,bt.N]],9:[[bt.N,bt.S]],10:{0:[[bt.W,bt.N],[bt.S,bt.E]],1:[[bt.W,bt.S],[bt.N,bt.E]]},11:[[bt.N,bt.E]],12:[[bt.W,bt.E]],13:[[bt.S,bt.E]],14:[[bt.W,bt.S]],15:[]};function ar(r){return parseInt(r,4)}const iEe={[ar("0000")]:[],[ar("2222")]:[],[ar("2221")]:[Md],[ar("2212")]:[Pd],[ar("2122")]:[Rd],[ar("1222")]:[Fd],[ar("0001")]:[Md],[ar("0010")]:[Pd],[ar("0100")]:[Rd],[ar("1000")]:[Fd],[ar("2220")]:[Od],[ar("2202")]:[Dd],[ar("2022")]:[Ld],[ar("0222")]:[kd],[ar("0002")]:[Od],[ar("0020")]:[Dd],[ar("0200")]:[Ld],[ar("2000")]:[kd],[ar("0011")]:[eO],[ar("0110")]:[tO],[ar("1100")]:[rO],[ar("1001")]:[nO],[ar("2211")]:[eO],[ar("2112")]:[tO],[ar("1122")]:[rO],[ar("1221")]:[nO],[ar("2200")]:[iO],[ar("2002")]:[sO],[ar("0022")]:[iO],[ar("0220")]:[sO],[ar("1111")]:[rEe],[ar("1211")]:[oO],[ar("2111")]:[aO],[ar("1112")]:[cO],[ar("1121")]:[lO],[ar("1011")]:[oO],[ar("0111")]:[aO],[ar("1110")]:[cO],[ar("1101")]:[lO],[ar("1200")]:[uO],[ar("0120")]:[fO],[ar("0012")]:[hO],[ar("2001")]:[dO],[ar("1022")]:[uO],[ar("2102")]:[fO],[ar("2210")]:[hO],[ar("0221")]:[dO],[ar("1002")]:[AO],[ar("2100")]:[pO],[ar("0210")]:[gO],[ar("0021")]:[mO],[ar("1220")]:[AO],[ar("0122")]:[pO],[ar("2012")]:[gO],[ar("2201")]:[mO],[ar("0211")]:[_O],[ar("2110")]:[yO],[ar("1102")]:[vO],[ar("1021")]:[bO],[ar("2011")]:[_O],[ar("0112")]:[yO],[ar("1120")]:[vO],[ar("1201")]:[bO],[ar("2101")]:[Nd],[ar("0121")]:[Nd],[ar("1012")]:[Ud],[ar("1210")]:[Ud],[ar("0101")]:{0:[Md,Rd],1:[Nd],2:[Nd]},[ar("1010")]:{0:[Fd,Pd],1:[Ud],2:[Ud]},[ar("2121")]:{0:[Nd],1:[Nd],2:[Md,Rd]},[ar("1212")]:{0:[Ud],1:[Ud],2:[Fd,Pd]},[ar("2120")]:{0:[_m],1:[_m],2:[Od,Rd]},[ar("2021")]:{0:[ym],1:[ym],2:[Md,Ld]},[ar("1202")]:{0:[vm],1:[vm],2:[Fd,Dd]},[ar("0212")]:{0:[bm],1:[bm],2:[Pd,kd]},[ar("0102")]:{0:[Od,Rd],1:[_m],2:[_m]},[ar("0201")]:{0:[Md,Ld],1:[ym],2:[ym]},[ar("1020")]:{0:[Fd,Dd],1:[vm],2:[vm]},[ar("2010")]:{0:[Pd,kd],1:[bm],2:[bm]},[ar("2020")]:{0:[kd,Dd],1:[xO],2:[Od,Ld]},[ar("0202")]:{0:[Ld,Od],1:[xO],2:[kd,Dd]}};function Mp(r,e){return Number.isNaN(r)?0:Array.isArray(e)?r<e[0]?0:r<e[1]?1:2:r>=e?1:0}function sEe(r){const{x:e,y:t,xRange:n,yRange:i,getValue:o,threshold:s}=r,c=e<n[0],f=e>=n[1]-1,_=t<i[0],b=t>=i[1]-1,T=c||f||_||b;let S=0,D,N,G,W;if(c||b)G=0;else{const K=o(e,t+1);G=Mp(K,s),S+=K}if(f||b)W=0;else{const K=o(e+1,t+1);W=Mp(K,s),S+=K}if(f||_)N=0;else{const K=o(e+1,t);N=Mp(K,s),S+=K}if(c||_)D=0;else{const K=o(e,t);D=Mp(K,s),S+=K}let z=-1;Number.isFinite(s)&&(z=G<<3|W<<2|N<<1|D),Array.isArray(s)&&(z=G<<6|W<<4|N<<2|D);let j=0;return T||(j=Mp(S/4,s)),{code:z,meanCode:j}}function oEe(r){const{x:e,y:t,z:n,code:i,meanCode:o}=r;let s=iEe[i];Array.isArray(s)||(s=s[o]);const c=e+1,f=t+1,_=[];return s.forEach(b=>{const T=[];b.forEach(S=>{const D=c+S[0],N=f+S[1];T.push([D,N,n])}),_.push(T)}),_}function aEe(r){const{x:e,y:t,z:n,code:i,meanCode:o}=r;let s=nEe[i];Array.isArray(s)||(s=s[o]);const c=e+1,f=t+1,_=[];return s.forEach(b=>{b.forEach(T=>{const S=c+T[0],D=f+T[1];_.push([S,D,n])})}),_}function cEe({contours:r,getValue:e,xRange:t,yRange:n}){const i=[],o=[];let s=0,c=0;for(let f=0;f<r.length;f++){const _=r[f],b=_.zIndex??f,{threshold:T}=_;for(let S=t[0]-1;S<t[1];S++)for(let D=n[0]-1;D<n[1];D++){const{code:N,meanCode:G}=sEe({getValue:e,threshold:T,x:S,y:D,xRange:t,yRange:n}),W={x:S,y:D,z:b,code:N,meanCode:G};if(Array.isArray(T)){const z=oEe(W);for(const j of z)o[c++]={vertices:j,contour:_}}else{const z=aEe(W);z.length>0&&(i[s++]={vertices:z,contour:_})}}}return{lines:i,polygons:o}}function lEe(r){var i,o,s;const{aggregator:e,binIdRange:t,channel:n}=r;if(e instanceof Ra){const c=(i=e.getResult(n))==null?void 0:i.buffer;if(c){const f=new Float32Array(c.readSyncWebGL().buffer);return uEe(f,t)}}if(e instanceof UA){const c=(o=e.getResult(n))==null?void 0:o.value,f=(s=e.getBins())==null?void 0:s.value;if(f&&c)return fEe(c,f,e.binCount)}return null}function uEe(r,e){const[[t,n],[i,o]]=e,s=n-t,c=o-i;return(f,_)=>(f-=t,_-=i,f<0||f>=s||_<0||_>=c?NaN:r[_*s+f])}function fEe(r,e,t){const n={};for(let i=0;i<t;i++){const o=e[i*2],s=e[i*2+1];n[o]=n[o]||{},n[o][s]=r[i]}return(i,o)=>{var s;return((s=n[i])==null?void 0:s[o])??NaN}}const hEe=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,dEe={name:"binOptions",vs:hEe,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},wO=[255,255,255,255],AEe=1,pEe={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let zE=class extends zA{getAggregatorType(){return this.props.gpuAggregation&&Ra.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new UA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},n,i)=>{const s=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:c,cellOriginCommon:f}=i;return[Math.floor((s[0]-f[0])/c[0]),Math.floor((s[1]-f[1])/c[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new Ra(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Is,dEe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if(t||o.dataChanged||n.cellSize!==i.cellSize||!Ki(n.gridOrigin,i.gridOrigin,1)||n.aggregation!==i.aggregation){this._updateBinOptions();const{cellSizeCommon:c,cellOriginCommon:f,binIdRange:_}=this.state;s.setProps({binIdRange:_,pointCount:this.getNumInstances(),operations:[n.aggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:f}})}return Ki(i.contours,n.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:c,gridOrigin:f}=this.props,{unitsPerMeter:_}=o.getDistanceScales(s);t[0]=_[0]*c,t[1]=_[1]*c;const b=o.projectFlat(s);n=[Math.floor((b[0]-f[0])/t[0])*t[0]+f[0],Math.floor((b[1]-f[1])/t[1])*t[1]+f[1]],s=o.unprojectFlat(n);const T=o.constructor;o=o.isGeospatial?new T({longitude:s[0],latitude:s[1],zoom:12}):new jl({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=NE({dataBounds:e,getBinId:S=>{const D=o.projectFlat(S);return[Math.floor((D[0]-n[0])/t[0]),Math.floor((D[1]-n[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){const{aggregator:e,binIdRange:t}=this.state;this.setState({aggregatedValueReader:lEe({aggregator:e,binIdRange:t,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){const{binIdRange:t}=this.state,{contours:n}=this.props,i=cEe({contours:n,getValue:e,xRange:t[0],yRange:t[1]});this.state.contourData=i}return this.state.contourData}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:o}=this.state;t.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const e=this._getContours();if(!e)return null;const{lines:t,polygons:n}=e,{zOffset:i}=this.props,{cellOriginCommon:o,cellSizeCommon:s}=this.state,c=this.getSubLayerClass("lines",Zu),f=this.getSubLayerClass("bands",Qu),_=new dn().translate([o[0],o[1],0]).scale([s[0],s[1],i]),b=t&&t.length>0&&new c(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:Jr.CARTESIAN,modelMatrix:_,getPath:S=>S.vertices,getColor:S=>S.contour.color??wO,getWidth:S=>S.contour.strokeWidth??AEe,widthUnits:"pixels"}),T=n&&n.length>0&&new f(this.getSubLayerProps({id:"bands"}),{data:n,coordinateSystem:Jr.CARTESIAN,modelMatrix:_,getPolygon:S=>S.vertices,getFillColor:S=>S.contour.color??wO});return[b,T]}getPickingInfo(e){const t=e.info,{object:n}=t;return n&&(t.object={contour:n.contour}),t}};zE.layerName="ContourLayer";zE.defaultProps=pEe;const gEe=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,mEe=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,_Ee={name:"grid",vs:mEe,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class h9 extends ol{getShaders(){const e=super.getShaders();return e.modules.push(_Ee),{...e,vs:gEe}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var o;super.updateState(e);const{props:t,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==t.colorRange){(o=this.state.colorTexture)==null||o.destroy(),this.state.colorTexture=LE(this.context.device,t.colorRange,t.colorScaleType);const s={colorRange:this.state.colorTexture};i.shaderInputs.setProps({grid:s})}else n.colorScaleType!==t.colorScaleType&&DE(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}_updateGeometry(){const e=new H6;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{cellOriginCommon:t,cellSizeCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:c,colorDomain:f,elevationDomain:_}=this.props,b=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel,D={colorDomain:[Math.max(f[0],b[0]),Math.min(f[1],b[1]),Math.max(f[0]-1,b[0]),Math.min(f[1]+1,b[1])],elevationDomain:[Math.max(_[0],T[0]),Math.min(_[1],T[1]),Math.max(_[0]-1,T[0]),Math.min(_[1]+1,T[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:t,sizeCommon:n};S.shaderInputs.setProps({column:{extruded:s,coverage:c},grid:D}),S.draw(this.context.renderPass)}}h9.layerName="GridCellLayer";const yEe=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,vEe={name:"binOptions",vs:yEe,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function CO(){}const bEe={gpuAggregation:!0,colorDomain:null,colorRange:rv,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:CO,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:CO,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:r=>r.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class GE extends zA{getAggregatorType(){const{gpuAggregation:e,gridAggregator:t,getColorValue:n,getElevationValue:i}=this.props;return e&&(t||n||i)?($r.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Ra.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{gridAggregator:t,cellSize:n}=this.props;return new UA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(t)return t(i,n);const f=this.state.aggregatorViewport.projectPosition(i),{cellSizeCommon:_,cellOriginCommon:b}=s;return[Math.floor((f[0]-b[0])/_[0]),Math.floor((f[1]-b[1])/_[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new Ra(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Is,vEe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(sl(n.data).iterable)),t||o.dataChanged||n.cellSize!==i.cellSize||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:c,cellOriginCommon:f,binIdRange:_,dataAsArray:b}=this.state;if(s.setProps({binIdRange:_,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:f},onUpdate:this._onAggregationUpdate.bind(this)}),b){const{getColorValue:T,getElevationValue:S}=this.props;s.setProps({customOperations:[T&&(D=>T(D.map(N=>b[N]),{indices:D,data:n.data})),S&&(D=>S(D.map(N=>b[N]),{indices:D,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:c}=this.props,{unitsPerMeter:f}=o.getDistanceScales(s);t[0]=f[0]*c,t[1]=f[1]*c;const _=o.projectFlat(s);n=[Math.floor(_[0]/t[0])*t[0],Math.floor(_[1]/t[1])*t[1]],s=o.unprojectFlat(n);const b=o.constructor;o=o.isGeospatial?new b({longitude:s[0],latitude:s[1],zoom:12}):new jl({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=NE({dataBounds:e,getBinId:T=>{const S=o.projectFlat(T);return[Math.floor((S[0]-n[0])/t[0]),Math.floor((S[1]-n[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new V_(i,n.binCount)}),t.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new V_(i,n.binCount)}),t.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:o}=this.state;t.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var Be,Le;const{aggregator:e,cellOriginCommon:t,cellSizeCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:c,coverage:f,material:_,transitions:b,colorScaleType:T,lowerPercentile:S,upperPercentile:D,colorDomain:N,elevationScaleType:G,elevationLowerPercentile:W,elevationUpperPercentile:z,elevationDomain:j}=this.props,K=this.getSubLayerClass("cells",h9),fe=e.getBins(),Z=(Be=this.state.colors)==null?void 0:Be.update({scaleType:T,lowerPercentile:S,upperPercentile:D}),ae=(Le=this.state.elevations)==null?void 0:Le.update({scaleType:G,lowerPercentile:W,upperPercentile:z});return!Z||!ae?null:new K(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:fe,getColorValue:Z.attribute,getElevationValue:ae.attribute}},dataComparator:(de,_e)=>de.length===_e.length,updateTriggers:{getBin:[fe],getColorValue:[Z.attribute],getElevationValue:[ae.attribute]},cellOriginCommon:t,cellSizeCommon:n,elevationScale:i,colorRange:o,colorScaleType:T,elevationRange:s,extruded:c,coverage:f,material:_,colorDomain:Z.domain||N||e.getResultDomain(0),elevationDomain:ae.domain||j||e.getResultDomain(1),colorCutoff:Z.cutoff,elevationCutoff:ae.cutoff,transitions:b&&{getFillColor:b.getColorValue||b.getColorWeight,getElevation:b.getElevationValue||b.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const i=this.state.aggregator.getBin(n);let o;i&&(o={col:i.id[0],row:i.id[1],colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),t.object=o}return t}}GE.layerName="GridLayer";GE.defaultProps=bEe;function xEe(r){const e=r.map(c=>c[0]),t=r.map(c=>c[1]),n=Math.min.apply(null,e),i=Math.max.apply(null,e),o=Math.min.apply(null,t),s=Math.max.apply(null,t);return[n,o,i,s]}function wEe(r,e){return e[0]>=r[0]&&e[2]<=r[2]&&e[1]>=r[1]&&e[3]<=r[3]}const EO=new Float32Array(12);function TO(r,e=2){let t=0;for(const n of r)for(let i=0;i<e;i++)EO[t++]=n[i]||0;return EO}function CEe(r,e,t){const[n,i,o,s]=r,c=o-n,f=s-i;let _=c,b=f;c/f<e/t?_=e/t*f:b=t/e*c,_<e&&(_=e,b=t);const T=(o+n)/2,S=(s+i)/2;return[T-_/2,S-b/2,T+_/2,S+b/2]}function EEe(r,e){const[t,n,i,o]=e;return[(r[0]-t)/(i-t),(r[1]-n)/(o-n)]}const TEe=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,BEe=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,BO=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,SEe={name:"triangle",vs:BO,fs:BO,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class d9 extends _s{getShaders(){return super.getShaders({vs:TEe,fs:BEe,modules:[Is,SEe]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:n}=this.props;return new Bi(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:c,weightsTexture:f}=this.props,_={aggregationMode:t,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:c,weightsTexture:f};e.shaderInputs.setProps({triangle:_}),e.draw(this.context.renderPass)}}d9.layerName="TriangleLayer";function IEe(r,e){const t={};for(const n in r)e.includes(n)||(t[n]=r[n]);return t}class A9 extends ys{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:IEe(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:n,oldProps:i,changeFlags:o}=e,{compareAll:s=!1,dimension:c}=t,{ignoreProps:f}=this.state,{props:_,accessors:b=[]}=c,{updateTriggersChanged:T}=o;if(o.dataChanged)return!0;if(T){if(T.all)return!0;for(const S of b)if(T[S])return!0}if(s)return o.extensionsChanged?!0:Lw({oldProps:i,newProps:n,ignoreProps:f,propTypes:this.constructor._propTypes});for(const S of _)if(n[S]!==i[S])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!MEe(t)}_getAttributeManager(){return new Ay(this.context.device,{id:this.props.id,stats:this.context.stats})}}A9.layerName="AggregationLayer";function MEe(r){let e=!0;for(const t in r){e=!1;break}return e}const SO=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,IO=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,PEe=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,REe=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,FEe=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,OEe={name:"weight",vs:FEe,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},DEe={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},LEe=2,Z1={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},MO=[0,0],kEe={SUM:0,MEAN:1},NEe={getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:rv,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},UEe=["float32-renderable-webgl","texture-blend-float-webgl"],zEe={data:{props:["radiusPixels"]}};class VE extends A9{getShaders(e){let t=[Is];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(zEe),this.setState({colorDomain:MO}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:n}=e,i=this._getChangeFlags(e);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:c,intensity:f,threshold:_,aggregation:b}=this.props,T=this.getSubLayerClass("triangle",d9);return new T(this.getSubLayerProps({id:"triangle-layer",updateTriggers:c}),{coordinateSystem:Jr.DEFAULT,data:{attributes:{positions:t,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:kEe[b]||0,weightsTexture:e,intensity:f,threshold:_,colorDomain:s})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:c,colorTexture:f,updateTimer:_}=this.state;t==null||t.destroy(),n==null||n.destroy(),i==null||i.destroy(),o==null||o.destroy(),s==null||s.destroy(),c==null||c.destroy(),f==null||f.destroy(),_&&clearTimeout(_)}_getAttributeManager(){return new Ay(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:n}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==i)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Z1,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...Z1,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,n=Math.min(t,e.limits.maxTextureDimension2D),i=UEe.every(c=>e.features.has(c)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||$r.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:n}=this.state,i=this.getAttributeManager();t==null||t.destroy(),t=new eI(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,OEe]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:SO,fs:IO});this._createWeightsTransform(o);const s=this.getShaders({vs:PEe,fs:REe,modules:[DEe]}),c=new eI(e,{id:`${this.id}-max-weights-transform`,targetTexture:i,...s,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),f={inTexture:n,textureSize:t};c.model.shaderInputs.setProps({maxWeight:f}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:c,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:SO,fs:IO,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,n=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(c=>c.map(Math.fround)),i=xEe(n),o={visibleWorldBounds:i,viewportCorners:n};let s=!1;if(e||!this.state.worldBounds||!wEe(this.state.worldBounds,i)){const c=this._worldToCommonBounds(i),f=this._commonToWorldBounds(c);this.props.coordinateSystem===Jr.LNGLAT&&(f[1]=Math.max(f[1],-85.051129),f[3]=Math.min(f[3],85.051129),f[0]=Math.max(f[0],-360),f[2]=Math.min(f[2],360));const _=this._worldToCommonBounds(f);o.worldBounds=f,o.normalizedCommonBounds=_,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;e.write(TO(i,3));const s=i.map(c=>EEe(o.projectPosition(c),n));t.write(TO(s,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const i=c9(t,!1,Uint8Array);n&&(n==null?void 0:n.width)===t.length?n.setTexture2DData({data:i}):(n==null||n.destroy(),n=this.context.device.createTexture({...Z1,data:i,width:t.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s,weightsTexture:c}=this.state,f=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const _=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(t&&n==="SUM"){const{viewport:K}=this.context,fe=K.distanceScales.metersPerUnit[2]*(_[2]-_[0])/o;this.state.colorDomain=t.map(Z=>Z*fe*s)}else this.state.colorDomain=t||MO;const T=this.getAttributeManager().getAttributes(),S=this.getModuleSettings();this._setModelAttributes(f.model,T),f.model.setVertexCount(this.getNumInstances());const D={radiusPixels:e,commonBounds:_,textureWidth:o,weightsScale:s,weightsTexture:c},{viewport:N,devicePixelRatio:G,coordinateSystem:W,coordinateOrigin:z}=S,{modelMatrix:j}=this.props;f.model.shaderInputs.setProps({project:{viewport:N,devicePixelRatio:G,modelMatrix:j,coordinateSystem:W,coordinateOrigin:z},weight:D}),f.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:n}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:n=!1}=t,[i,o,s,c]=e,{viewport:f}=this.context,{textureSize:_}=this.state,{coordinateSystem:b}=this.props,T=n&&(b===Jr.LNGLAT_OFFSETS||b===Jr.METER_OFFSETS),S=T?f.projectPosition(this.props.coordinateOrigin):[0,0],D=_*LEe/f.scale;let N,G;return n&&!T?(N=this.projectPosition([i,o,0]),G=this.projectPosition([s,c,0])):(N=f.projectPosition([i,o,0]),G=f.projectPosition([s,c,0])),CEe([N[0]-S[0],N[1]-S[1],G[0]-S[0],G[1]-S[1]],D,D)}_commonToWorldBounds(e){const[t,n,i,o]=e,{viewport:s}=this.context,c=s.unprojectPosition([t,n]),f=s.unprojectPosition([i,o]);return c.slice(0,2).concat(f.slice(0,2))}}VE.layerName="HeatmapLayer";VE.defaultProps=NEe;const GEe=Object.freeze(Object.defineProperty({__proto__:null,CPUAggregator:UA,ContourLayer:zE,GridLayer:GE,HeatmapLayer:VE,HexagonLayer:UE,ScreenGridLayer:kE,WebGLAggregator:Ra,_AggregationLayer:zA},Symbol.toStringTag,{value:"Module"})),VEe={ClusterTileLayer:xE,H3TileLayer:wE,HeatmapTileLayer:EE,PointLabelLayer:tv,QuadbinTileLayer:ev,RasterTileLayer:SE,VectorTileLayer:ME};function qx(r,e=""){if(!r)throw new Error(`JSON conversion error ${e}`)}function HEe(r,e){const t=$Ee(e);let n=r;for(const i of t)n=jEe(n)?n[i]:void 0;return n}function jEe(r){return r!==null&&typeof r=="object"}const PO={};function $Ee(r){if(typeof r=="string"){let e=PO[r];return e||(e=r.split("."),PO[r]=e),e}return Array.isArray(r)?r:[r]}var xm={exports:{}},RO;function WEe(){return RO||(RO=1,function(r,e){(function(t){var n="Compound",i="Identifier",o="MemberExpression",s="Literal",c="ThisExpression",f="CallExpression",_="UnaryExpression",b="BinaryExpression",T="LogicalExpression",S="ConditionalExpression",D="ArrayExpression",N=46,G=44,W=39,z=34,j=40,K=41,fe=91,Z=93,ae=63,Be=59,Le=58,de=function(Tt,nt){var cr=new Error(Tt+" at character "+nt);throw cr.index=nt,cr.description=Tt,cr},_e=!0,pe={"-":_e,"!":_e,"~":_e,"+":_e},J={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ne=function(Tt){var nt=0,cr;for(var Xt in Tt)(cr=Xt.length)>nt&&Tt.hasOwnProperty(Xt)&&(nt=cr);return nt},ye=ne(pe),Ye=ne(J),we={true:!0,false:!1,null:null},Ne="this",Ge=function(Tt){return J[Tt]||0},Qe=function(Tt,nt,cr){var Xt=Tt==="||"||Tt==="&&"?T:b;return{type:Xt,operator:Tt,left:nt,right:cr}},rt=function(Tt){return Tt>=48&&Tt<=57},tt=function(Tt){return Tt===36||Tt===95||Tt>=65&&Tt<=90||Tt>=97&&Tt<=122||Tt>=128&&!J[String.fromCharCode(Tt)]},lt=function(Tt){return Tt===36||Tt===95||Tt>=65&&Tt<=90||Tt>=97&&Tt<=122||Tt>=48&&Tt<=57||Tt>=128&&!J[String.fromCharCode(Tt)]},mt=function(Tt){for(var nt=0,cr=Tt.charAt,Xt=Tt.charCodeAt,$t=function(Ut){return cr.call(Tt,Ut)},Lt=function(Ut){return Xt.call(Tt,Ut)},lr=Tt.length,tn=function(){for(var Ut=Lt(nt);Ut===32||Ut===9||Ut===10||Ut===13;)Ut=Lt(++nt)},Er=function(){var Ut=Mn(),dr,Tr;if(tn(),Lt(nt)===ae){if(nt++,dr=Er(),dr||de("Expected expression",nt),tn(),Lt(nt)===Le)return nt++,Tr=Er(),Tr||de("Expected expression",nt),{type:S,test:Ut,consequent:dr,alternate:Tr};de("Expected :",nt)}else return Ut},Ar=function(){tn();for(var Ut=Tt.substr(nt,Ye),dr=Ut.length;dr>0;){if(J.hasOwnProperty(Ut)&&(!tt(Lt(nt))||nt+Ut.length<Tt.length&&!lt(Lt(nt+Ut.length))))return nt+=dr,Ut;Ut=Ut.substr(0,--dr)}return!1},Mn=function(){var Ut,dr,Tr,qr,ui,Pe,Dt,Vt,sr;if(Pe=hr(),dr=Ar(),!dr)return Pe;for(ui={value:dr,prec:Ge(dr)},Dt=hr(),Dt||de("Expected expression after "+dr,nt),qr=[Pe,ui,Dt];(dr=Ar())&&(Tr=Ge(dr),Tr!==0);){for(ui={value:dr,prec:Tr},sr=dr;qr.length>2&&Tr<=qr[qr.length-2].prec;)Dt=qr.pop(),dr=qr.pop().value,Pe=qr.pop(),Ut=Qe(dr,Pe,Dt),qr.push(Ut);Ut=hr(),Ut||de("Expected expression after "+sr,nt),qr.push(ui,Ut)}for(Vt=qr.length-1,Ut=qr[Vt];Vt>1;)Ut=Qe(qr[Vt-1].value,qr[Vt-2],Ut),Vt-=2;return Ut},hr=function(){var Ut,dr,Tr;if(tn(),Ut=Lt(nt),rt(Ut)||Ut===N)return pr();if(Ut===W||Ut===z)return rn();if(Ut===fe)return Xn();for(dr=Tt.substr(nt,ye),Tr=dr.length;Tr>0;){if(pe.hasOwnProperty(dr)&&(!tt(Lt(nt))||nt+dr.length<Tt.length&&!lt(Lt(nt+dr.length))))return nt+=Tr,{type:_,operator:dr,argument:hr(),prefix:!0};dr=dr.substr(0,--Tr)}return tt(Ut)||Ut===j?$n():!1},pr=function(){for(var Ut="",dr,Tr;rt(Lt(nt));)Ut+=$t(nt++);if(Lt(nt)===N)for(Ut+=$t(nt++);rt(Lt(nt));)Ut+=$t(nt++);if(dr=$t(nt),dr==="e"||dr==="E"){for(Ut+=$t(nt++),dr=$t(nt),(dr==="+"||dr==="-")&&(Ut+=$t(nt++));rt(Lt(nt));)Ut+=$t(nt++);rt(Lt(nt-1))||de("Expected exponent ("+Ut+$t(nt)+")",nt)}return Tr=Lt(nt),tt(Tr)?de("Variable names cannot start with a number ("+Ut+$t(nt)+")",nt):Tr===N&&de("Unexpected period",nt),{type:s,value:parseFloat(Ut),raw:Ut}},rn=function(){for(var Ut="",dr=$t(nt++),Tr=!1,qr;nt<lr;)if(qr=$t(nt++),qr===dr){Tr=!0;break}else if(qr==="\\")switch(qr=$t(nt++),qr){case"n":Ut+=`
`;break;case"r":Ut+="\r";break;case"t":Ut+="	";break;case"b":Ut+="\b";break;case"f":Ut+="\f";break;case"v":Ut+="\v";break;default:Ut+=qr}else Ut+=qr;return Tr||de('Unclosed quote after "'+Ut+'"',nt),{type:s,value:Ut,raw:dr+Ut+dr}},Sr=function(){var Ut=Lt(nt),dr=nt,Tr;for(tt(Ut)?nt++:de("Unexpected "+$t(nt),nt);nt<lr&&(Ut=Lt(nt),lt(Ut));)nt++;return Tr=Tt.slice(dr,nt),we.hasOwnProperty(Tr)?{type:s,value:we[Tr],raw:Tr}:Tr===Ne?{type:c}:{type:i,name:Tr}},ei=function(Ut){for(var dr,Tr=[],qr,ui=!1,Pe=0;nt<lr;)if(tn(),dr=Lt(nt),dr===Ut){ui=!0,nt++,Ut===K&&Pe&&Pe>=Tr.length&&de("Unexpected token "+String.fromCharCode(Ut),nt);break}else if(dr===G){if(nt++,Pe++,Pe!==Tr.length){if(Ut===K)de("Unexpected token ,",nt);else if(Ut===Z)for(var Dt=Tr.length;Dt<Pe;Dt++)Tr.push(null)}}else qr=Er(),(!qr||qr.type===n)&&de("Expected comma",nt),Tr.push(qr);return ui||de("Expected "+String.fromCharCode(Ut),nt),Tr},$n=function(){var Ut,dr;for(Ut=Lt(nt),Ut===j?dr=un():dr=Sr(),tn(),Ut=Lt(nt);Ut===N||Ut===fe||Ut===j;)nt++,Ut===N?(tn(),dr={type:o,computed:!1,object:dr,property:Sr()}):Ut===fe?(dr={type:o,computed:!0,object:dr,property:Er()},tn(),Ut=Lt(nt),Ut!==Z&&de("Unclosed [",nt),nt++):Ut===j&&(dr={type:f,arguments:ei(K),callee:dr}),tn(),Ut=Lt(nt);return dr},un=function(){nt++;var Ut=Er();if(tn(),Lt(nt)===K)return nt++,Ut;de("Unclosed (",nt)},Xn=function(){return nt++,{type:D,elements:ei(Z)}},Nn=[],bn,Wn;nt<lr;)bn=Lt(nt),bn===Be||bn===G?nt++:(Wn=Er())?Nn.push(Wn):nt<lr&&de('Unexpected "'+$t(nt)+'"',nt);return Nn.length===1?Nn[0]:{type:n,body:Nn}};mt.version="0.3.5",mt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+mt.version},mt.addUnaryOp=function(Tt){return ye=Math.max(Tt.length,ye),pe[Tt]=_e,this},mt.addBinaryOp=function(Tt,nt){return Ye=Math.max(Tt.length,Ye),J[Tt]=nt,this},mt.addLiteral=function(Tt,nt){return we[Tt]=nt,this},mt.removeUnaryOp=function(Tt){return delete pe[Tt],Tt.length===ye&&(ye=ne(pe)),this},mt.removeAllUnaryOps=function(){return pe={},ye=0,this},mt.removeBinaryOp=function(Tt){return delete J[Tt],Tt.length===Ye&&(Ye=ne(J)),this},mt.removeAllBinaryOps=function(){return J={},Ye=0,this},mt.removeLiteral=function(Tt){return delete we[Tt],this},mt.removeAllLiterals=function(){return we={},this},r.exports?e=r.exports=mt:e.parse=mt})()}(xm,xm.exports)),xm.exports}var JEe=WEe();const XEe=sh(JEe),FO={"||":(r,e)=>r||e,"&&":(r,e)=>r&&e,"|":(r,e)=>r|e,"^":(r,e)=>r^e,"&":(r,e)=>r&e,"==":(r,e)=>r==e,"!=":(r,e)=>r!=e,"===":(r,e)=>r===e,"!==":(r,e)=>r!==e,"<":(r,e)=>r<e,">":(r,e)=>r>e,"<=":(r,e)=>r<=e,">=":(r,e)=>r>=e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e},KEe={"-":r=>-r,"+":r=>+r,"~":r=>~r,"!":r=>!r};function OO(r,e){return r.map(function(t){return Hs(t,e)})}function DO(r,e){const t=Hs(r.object,e);let n;if(r.computed?n=Hs(r.property,e):n=r.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[t,t[n]]}function Hs(r,e){const t=r;switch(t.type){case"ArrayExpression":return OO(t.elements,e);case"BinaryExpression":return FO[t.operator](Hs(t.left,e),Hs(t.right,e));case"CallExpression":let n,i,o;return t.callee.type==="MemberExpression"?(o=DO(t.callee,e),n=o[0],i=o[1]):i=Hs(t.callee,e),typeof i!="function"?void 0:i.apply(n,OO(t.arguments,e));case"ConditionalExpression":return Hs(t.test,e)?Hs(t.consequent,e):Hs(t.alternate,e);case"Identifier":return e[t.name];case"Literal":return t.value;case"LogicalExpression":return t.operator==="||"?Hs(t.left,e)||Hs(t.right,e):t.operator==="&&"?Hs(t.left,e)&&Hs(t.right,e):FO[t.operator](Hs(t.left,e),Hs(t.right,e));case"MemberExpression":return DO(t,e)[1];case"ThisExpression":return e;case"UnaryExpression":return KEe[t.operator](Hs(t.argument,e));default:return}}const Q1={"-":r=>r};function p9(r,e){if(r in Q1)return Q1[r];let t;const n=XEe(r);return n.type==="Identifier"?t=i=>HEe(i,r):(Zx(n,i=>{if(i.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),t=i=>Hs(n,i)),Q1[r]=t,t}function Zx(r,e){if(Array.isArray(r))r.forEach(t=>Zx(t,e));else if(r&&typeof r=="object"){r.type&&e(r);for(const t in r)Zx(r[t],e)}}const H_="@@=",LO="@@#",YEe="@@type",g9="@@function",kO=r=>r&&typeof r=="object";class Qx{constructor(...e){this.typeKey=YEe,this.functionKey=g9,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=p9,this.preProcessClassProps=(t,n)=>n,this.postProcessConvertedJson=t=>t;for(const t of e)this.merge(t)}merge(e){for(const t in e)switch(t){case"layers":case"views":Object.assign(this.classes,e[t]);break;default:if(t in this){const n=e[t];this[t]=kO(this[t])?Object.assign(this[t],n):n}}}validate(e){return qx(!this.typeKey||typeof this.typeKey=="string"),qx(kO(this.classes)),!0}}function qEe(r){return typeof r=="string"&&r.startsWith(H_)}function ZEe(r){return r.replace(H_,"")}function m9(r,e){const t={};for(const n in r){let i=r[n];qEe(i)&&(i=ZEe(i),i=p9(i)),t[n]=i}return t}function QEe(r,e,t){const n=t.classes[r],i=t.reactComponents[r];if(!n&&!i){const{log:o}=t;if(o){const s=JSON.stringify(e,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${r}(${s}...)  `)}return null}return n?eTe(n,e,t):tTe(i,e,t)}function eTe(r,e,t){return t.preProcessClassProps&&(e=t.preProcessClassProps(r,e,t)),e=m9(e),new r(e)}function tTe(r,e,t){const{React:n}=t,{children:i=[]}=e;return delete e.children,t.preProcessClassProps&&(e=t.preProcessClassProps(r,e,t)),e=m9(e),n.createElement(r,e,i)}function rTe(r,e,t){const n=t.functions[r];if(!n){const{log:i}=t;if(i){const o=JSON.stringify(e,null,0).slice(0,40);i.warn(`JSON converter: No registered function ${r}(${o}...)  `)}return null}return n(e)}function nTe(r){return typeof r=="string"?JSON.parse(r):r}const HE=r=>r&&typeof r=="object";class iTe{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof Qx?e.configuration:new Qx(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;const t=nTe(e);let n=sTe(t,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(e){return this.convert(e)}}function sTe(r,e){return e=new Qx(e),jE(r,"",e)}function jE(r,e,t){return Array.isArray(r)?r.map((n,i)=>jE(n,String(i),t)):oTe(r,t)?aTe(r,t):HE(r)?g9 in r?cTe(r,t):$E(r,t):typeof r=="string"?lTe(r,e,t):r}function oTe(r,e){const{typeKey:t}=e;return HE(r)&&!!r[t]}function aTe(r,e){const{typeKey:t}=e,n=r[t];let i={...r};return delete i[t],i=$E(i,e),QEe(n,i,e)}function cTe(r,e){const{functionKey:t}=e,n=r[t];let i={...r};return delete i[t],i=$E(i,e),rTe(n,i,e)}function $E(r,e){qx(HE(r));const t={};for(const n in r){const i=r[n];t[n]=jE(i,n,e)}return t}function lTe(r,e,t){if(r.startsWith(H_)&&t.convertFunction)return r=r.replace(H_,""),t.convertFunction(r,t);if(r.startsWith(LO)){if(r=r.replace(LO,""),t.constants[r])return t.constants[r];const[n,i]=r.split(".");return t.enumerations[n][i]}return r}const uTe={classes:{...Rue,...GEe,...B2e,...bme,...VEe},functions:{colorBins:hCe,colorCategories:dCe,colorContinuous:ACe}},_9=new iTe({configuration:uTe}),fTe={[Ky.layerName]:["getFillColor"],[Ny.layerName]:["getFillColor"],[al.layerName]:["getFillColor"],[LA.layerName]:["getFillColor"],[Ry.layerName]:["getFillColor"],[Py.layerName]:["getFillColor"],[Dy.layerName]:["getColor"],[Pg.layerName]:["getTargetColor","getSourceColor"],[ol.layerName]:["getFillColor"],[Wl.layerName]:["getFillColor"],[DA.layerName]:["getColor"],[By.layerName]:["getColor"],[Zu.layerName]:["getColor"],[Rg.layerName]:["getColor"],[ef.layerName]:["getFillColor"],[Fg.layerName]:["getFillColor","getColor","getLineColor"],[Qu.layerName]:["getFillColor"],[Ah.layerName]:["getColor"],[zg.layerName]:["getColor"],[rh.layerName]:["getColor"]},hTe=({object:r,objectInfo:e,originalFillFunction:t})=>{const n=typeof t=="function"?t(r,e):t;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const i=_9.convert({originalColor:n}).originalColor(r);return[i[0]||0,i[1]||0,i[2]||0,i[3]||255]}return null},NO=({isSelected:r,object:e,objectInfo:t,opacity:n,originalFillFunction:i})=>{const o=hTe({object:e,objectInfo:t,originalFillFunction:i});if(!o)return null;let s=0;return r?s=Math.max(typeof o[3]=="number"?o[3]:n,n):s=Math.min(typeof o[3]=="number"?o[3]:n,n),[o[0]||0,o[1]||0,o[2]||0,s]},dTe=({isSelected:r,object:e,objectInfo:t,originalFillFunction:n,selectedColor:i,selectedOpacity:o=255,unselectedColor:s,unselectedOpacity:c=Math.floor(255*.4)})=>r?NO({opacity:o,isSelected:!0,object:e,objectInfo:t,originalFillFunction:n})||i:NO({opacity:c,isSelected:!1,object:e,objectInfo:t,originalFillFunction:n})||s,bg={selection:{indices:{},objects:{}}},UO=(r,e)=>{const t=e.match(/{(.*?)}/g);return t&&t.forEach(n=>{const i=n.substring(1,n.length-1);r.object.hasOwnProperty(i)?e=e.replace(n,r.object[i]):r.object.hasOwnProperty("properties")&&r.object.properties.hasOwnProperty(i)&&(e=e.replace(n,r.object.properties[i]))}),e};function ATe(r,e){return e.id?r.getElementState(e.id,"selection")??bg:bg}function pTe(r,e){if(!e.id)return bg;const t=r.getStringValue(e);return(t?r2.parse(t):null)??bg}function gTe(r,e,t,n){r.id&&e.setStringValue(r,JSON.stringify(t.value),{fromUi:t.fromUi},n)}const mTe=r=>{var J;const{height:e,width:t,expanded:n}=WO(JO),{element:i,fragmentId:o,isLightTheme:s,theme:c,widgetMgr:f}=r,{selectionMode:_,tooltip:b,useContainerWidth:T}=i,S=n??!1,[D,N]=f5({element:i,getDefaultState:ATe,getStateFromWidgetMgr:pTe,updateWidgetMgrState:gTe,widgetMgr:f,fragmentId:o}),[G,W]=Bt.useState(null),{height:z,width:j}=_ce({element:i,isFullScreen:S,shouldUseContainerWidth:T,container:{height:e,width:t},heightFallback:((J=G==null?void 0:G.initialViewState)==null?void 0:J.height)||c.sizes.defaultMapHeight}),[K,fe]=Bt.useState(null),Z=_[0],ae=Z!==void 0,Be=ae&&Object.keys(D.selection.indices).length>0,Le=Bt.useMemo(()=>Object.freeze(r2.parse(i.json)),[S,s,i.json]),de=Bt.useMemo(()=>{const ne={...Le};if(ne.mapStyle||(ne.mapStyle=`mapbox://styles/mapbox/${s?"light":"dark"}-v9`),ne.layers){const ye=Object.values(D.selection.indices).some(we=>we==null?void 0:we.length),Ye=ne.layers.some(we=>Object.hasOwn(we,"pickable"));ne.layers=ne.layers.map(we=>{var tt,lt;if(!we||Array.isArray(we)||!ae)return we;Ye||(we.pickable=!0);const Ne=`${we.id||null}`,Ge=((lt=(tt=D==null?void 0:D.selection)==null?void 0:tt.indices)==null?void 0:lt[Ne])||[],Qe=fTe[we["@@type"]];if(!Qe)return we;const rt={...we};return Qe.forEach(mt=>{var Ar;rt.updateTriggers={[mt]:[...((Ar=rt.updateTriggers)==null?void 0:Ar[mt])||[],Ge,ye]};const Tt=!ye,nt=we[mt];if(Tt||!nt)return rt;const cr=255,Xt=Math.floor(255*.4),$t=AB(c.colors.primary),Lt=[$t[0],$t[1],$t[2],cr],lr=AB(c.colors.gray20),tn=[lr[0],lr[1],lr[2],Xt],Er=(Mn,hr)=>dTe({isSelected:Ge.includes(hr.index),object:Mn,objectInfo:hr,originalFillFunction:nt,selectedColor:Lt,unselectedColor:tn,selectedOpacity:cr,unselectedOpacity:Xt});rt[mt]=Er}),rt})}return ne==null||delete ne.views,_9.convert(ne)},[D.selection.indices,s,ae,Le,c.colors.gray20,c.colors.primary]);Bt.useEffect(()=>{if(!n5(de.initialViewState,K)){const ne=Object.keys(de.initialViewState).reduce((ye,Ye)=>de.initialViewState[Ye]===(K==null?void 0:K[Ye])?ye:{...ye,[Ye]:de.initialViewState[Ye]},{});W(ye=>({...ye,...ne})),fe(de.initialViewState)}},[de.initialViewState,K,G]);const _e=Bt.useCallback(ne=>{if(!ne||!ne.object||!b)return null;const ye=r2.parse(b);return ye.html?ye.html=UO(ne,ye.html):ye.text=UO(ne,ye.text),ye},[b]),pe=Bt.useCallback(({viewState:ne})=>{W(ne)},[W]);return{createTooltip:_e,data:D,deck:de,hasActiveSelection:Be,height:z,isSelectionModeActivated:ae,onViewStateChange:pe,selectionMode:Z,setSelection:N,viewState:G,width:j}};Mg([Qw,mx]);const e2=bg.selection,_Te=[],yTe=r=>{const{disabled:e,disableFullscreenMode:t,element:n,fragmentId:i,mapboxToken:o,widgetMgr:s}=r,{mapboxToken:c}=n,f=i5(),{expanded:_,expand:b,collapse:T}=WO(JO),{createTooltip:S,data:D,deck:N,hasActiveSelection:G,height:W,isSelectionModeActivated:z,onViewStateChange:j,selectionMode:K,setSelection:fe,viewState:Z,width:ae}=mTe({element:n,fragmentId:i,isLightTheme:$O(f),theme:f,widgetMgr:s}),[Be,Le]=Bt.useState(!1);Bt.useEffect(()=>{Le(!0)},[]);const de=Bt.useCallback(pe=>{var Qe;if(K===void 0)return;const{index:J,object:ne}=pe,ye=`${((Qe=pe.layer)==null?void 0:Qe.id)||null}`,Ye=D,we=J===-1,Ge=(()=>{var rt;if(we)return e2;switch(K){case pB.SelectionMode.SINGLE_OBJECT:return((rt=Ye.selection.indices[ye])==null?void 0:rt[0])===J?e2:{indices:{[`${ye}`]:[J]},objects:{[`${ye}`]:[ne]}};case pB.SelectionMode.MULTI_OBJECT:{const tt=new Map((()=>{var mt,Tt;return(((Tt=(mt=Ye==null?void 0:Ye.selection)==null?void 0:mt.indices)==null?void 0:Tt[ye])||[]).map((nt,cr)=>{var Xt,$t,Lt;return[nt,(Lt=($t=(Xt=Ye.selection)==null?void 0:Xt.objects)==null?void 0:$t[ye])==null?void 0:Lt[cr]]})})());if(tt.has(J)?tt.delete(J):tt.set(J,ne),tt.size===0){const{[ye]:lt,...mt}=Ye.selection.indices,{[ye]:Tt,...nt}=Ye.selection.objects;return{indices:mt,objects:nt}}return{indices:{...Ye.selection.indices,[`${ye}`]:Array.from(tt.keys())},objects:{...Ye.selection.objects,[`${ye}`]:Array.from(tt.values())}}}default:throw s5(K),new Error("Invalid selection mode")}})();JSON.stringify(Ge)!==JSON.stringify(Ye.selection)&&fe({fromUi:!0,value:{selection:Ge}})},[K,D,fe]),_e=Bt.useCallback(()=>{fe({value:{selection:e2},fromUi:!0})},[fe]);return Jc(BM,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:W,children:[Ss(l5,{isFullScreen:_,disableFullscreenMode:t,onExpand:b,onCollapse:T,target:BM,locked:G&&!e?!0:void 0,children:G&&!e&&Ss(c5,{label:"Clear selection",onClick:_e,icon:a5})}),Z&&Jc(TZ,{viewState:Z,onViewStateChange:j,height:W,width:ae,layers:Be?N.layers:_Te,getTooltip:S,ContextProvider:fh.Provider,controller:!0,onClick:z&&!e?de:void 0,children:[Ss($l,{height:W,width:ae,mapStyle:N.mapStyle&&(typeof N.mapStyle=="string"?N.mapStyle:N.mapStyle[0]),mapboxApiAccessToken:c||o}),Ss(mce,{children:Ss(zte,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},vTe=u5(gce("st.pydeck_chart")(yTe)),TBe=Bt.memo(vTe);export{TBe as default};
